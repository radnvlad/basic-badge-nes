Disassembly Listing for badge1
Generated From:
/Users/nitro/basic-badge/firmware/badge1.X/dist/default/debug/badge1.X.debug.elf
May 27, 2018 2:40:52 AM

---  /Users/nitro/basic-badge/firmware/badge1.X/src/vt100.c  --------------------------------------------
1:                   #include <string.h>
2:                   #include <stdlib.h>
3:                   #include <stdio.h>
4:                   #include "vt100.h"
5:                   #include "badge.h"
6:                   #include "hw.h"
7:                   
8:                   #define MAX_BUF 50
9:                   
10:                  uint8_t msg1[50];
11:                  
12:                  uint8_t color_composite;
13:                  uint16_t count;
14:                  volatile uint16_t bufhead;
15:                  volatile uint16_t buftail;
16:                  volatile uint16_t bufsize;
17:                  static int8_t cx;
18:                  static int8_t cy;
19:                  static uint8_t showcursor;
20:                  /* parameters from setup */
21:                  static uint8_t newlineseq;
22:                  static uint8_t process_escseqs;
23:                  static uint8_t local_echo;
24:                  /* escape sequence processing */
25:                  static uint8_t in_esc;
26:                  static int8_t paramstr[MAX_ESC_LEN+1];
27:                  static int8_t *paramptr;
28:                  static uint8_t paramch;
29:                  /* current attributes */
30:                  static uint8_t graphicchars;  /* set to 1 with an SI and set to 0 with an SO */
31:                  static uint8_t revvideo;      /* reverse video attribute */
32:                  static termstate_t savedstate;/* state used for save/restore sequences */
33:                  /* Vertical margins */
34:                  static int8_t mtop;
35:                  static int8_t mbottom;
36:                  
37:                  /* reverse video */
38:                  static uint8_t revvideo;
39:                  
40:                  uint8_t cur_type,cur_blink;
41:                  
42:                  extern int8_t disp_buffer[DISP_BUFFER_HIGH+1][DISP_BUFFER_WIDE];
43:                  extern int8_t color_buffer[DISP_BUFFER_HIGH+1][DISP_BUFFER_WIDE];
44:                  volatile uint8_t buf[MAX_BUF];
45:                  
46:                  void video_set_color(uint8_t fg, uint8_t bg)
47:                  	{
48:                  	color_composite = (fg&0xF) | ((bg&0xF)<<4);
9D01B1B0  00052900   SLL A1, A1, 4
9D01B1B4  3084000F   ANDI A0, A0, 15
9D01B1B8  00A41025   OR V0, A1, A0
9D01B1BC  03E00008   JR RA
9D01B1C0  A38281C1   SB V0, -32319(GP)
9D01B518  2404000F   ADDIU A0, ZERO, 15
9D01B51C  A38481C1   SB A0, -32319(GP)
49:                  	}
50:                  
51:                  void term_init (void)
52:                  	{
9D01B4E0  27BDFFE8   ADDIU SP, SP, -24
9D01B4E4  AFBF0014   SW RA, 20(SP)
53:                  	video_reset_margins();
9D01B4E8  0F406D30   JAL video_reset_margins
9D01B4EC  00000000   NOP
54:                  	reset_term();
9D01B4F0  0F406CDE   JAL reset_term
9D01B4F4  00000000   NOP
55:                  	process_escseqs = 1;
9D01B4F8  24020001   ADDIU V0, ZERO, 1
9D01B4FC  A3828071   SB V0, -32655(GP)
56:                  	buftail = 0;
9D01B500  A78081C2   SH ZERO, -32318(GP)
57:                  	bufhead = 0;
9D01B504  A78081BA   SH ZERO, -32326(GP)
58:                  	bufsize = 0;
9D01B508  A78081B8   SH ZERO, -32328(GP)
59:                  	cur_blink = 1;
9D01B50C  A38281C0   SB V0, -32320(GP)
60:                  	cur_type = 2;
9D01B510  24030002   ADDIU V1, ZERO, 2
9D01B514  A38381BC   SB V1, -32324(GP)
61:                  	video_set_color(15,0);
62:                  	}
9D01B520  8FBF0014   LW RA, 20(SP)
9D01B524  03E00008   JR RA
9D01B528  27BD0018   ADDIU SP, SP, 24
63:                  
64:                  void buf_enqueue(uint8_t c)
65:                  	{
66:                  	if (bufsize < MAX_BUF)
9D01B1C4  978281B8   LHU V0, -32328(GP)
9D01B1C8  3043FFFF   ANDI V1, V0, -1
9D01B1CC  2C650032   SLTIU A1, V1, 50
9D01B1D0  10A00012   BEQ A1, ZERO, 0x9D01B21C
9D01B1D4  00000000   NOP
67:                  		{
68:                  		buf[buftail] = c;
9D01B1D8  978681C2   LHU A2, -32318(GP)
9D01B1DC  30C7FFFF   ANDI A3, A2, -1
9D01B1E0  3C08A000   LUI T0, -24576
9D01B1E4  250914BC   ADDIU T1, T0, 5308
9D01B1E8  00E95021   ADDU T2, A3, T1
9D01B1EC  A1440000   SB A0, 0(T2)
69:                  		if (++buftail >= MAX_BUF) buftail = 0;
9D01B1F0  978481C2   LHU A0, -32318(GP)
9D01B1F4  248B0001   ADDIU T3, A0, 1
9D01B1F8  316CFFFF   ANDI T4, T3, -1
9D01B1FC  A78C81C2   SH T4, -32318(GP)
9D01B200  2D8D0032   SLTIU T5, T4, 50
9D01B204  51A00001   BEQL T5, ZERO, 0x9D01B20C
9D01B208  A78081C2   SH ZERO, -32318(GP)
70:                  		bufsize++;
9D01B20C  978E81B8   LHU T6, -32328(GP)
9D01B210  25CF0001   ADDIU T7, T6, 1
9D01B214  31F8FFFF   ANDI T8, T7, -1
9D01B218  A79881B8   SH T8, -32328(GP)
9D01B21C  03E00008   JR RA
9D01B220  00000000   NOP
71:                  		}
72:                  	}
73:                  
74:                  uint8_t buf_dequeue()
75:                  	{
76:                  	uint8_t ret = 0;
77:                  	if (bufsize > 0)
9D01B224  978381B8   LHU V1, -32328(GP)
9D01B228  3064FFFF   ANDI A0, V1, -1
9D01B22C  10800013   BEQ A0, ZERO, .LBE2
9D01B230  00001021   ADDU V0, ZERO, ZERO
78:                  		{
79:                  		uint8_t c = buf[bufhead];
9D01B234  978281BA   LHU V0, -32326(GP)
9D01B238  3045FFFF   ANDI A1, V0, -1
9D01B23C  3C06A000   LUI A2, -24576
9D01B240  24C714BC   ADDIU A3, A2, 5308
9D01B244  00A74021   ADDU T0, A1, A3
9D01B248  91090000   LBU T1, 0(T0)
9D01B24C  312200FF   ANDI V0, T1, 255
80:                  		if (++bufhead >= MAX_BUF) bufhead = 0;
9D01B250  978A81BA   LHU T2, -32326(GP)
9D01B254  254B0001   ADDIU T3, T2, 1
9D01B258  316CFFFF   ANDI T4, T3, -1
9D01B25C  A78C81BA   SH T4, -32326(GP)
9D01B260  2D8D0032   SLTIU T5, T4, 50
9D01B264  51A00001   BEQL T5, ZERO, 0x9D01B26C
9D01B268  A78081BA   SH ZERO, -32326(GP)
81:                  		bufsize--;
9D01B26C  978E81B8   LHU T6, -32328(GP)
9D01B270  25CFFFFF   ADDIU T7, T6, -1
9D01B274  31F8FFFF   ANDI T8, T7, -1
9D01B278  A79881B8   SH T8, -32328(GP)
82:                  		ret = c;
83:                  		}
84:                  	return ret;
85:                  	}
9D01B27C  03E00008   JR RA
9D01B280  00000000   NOP
86:                  
87:                  uint8_t buf_size()
88:                  	{
89:                  	uint8_t sz;
90:                  	sz = bufsize;
9D01B284  978281B8   LHU V0, -32328(GP)
91:                  	return sz;
92:                  	}
9D01B288  03E00008   JR RA
9D01B28C  304200FF   ANDI V0, V0, 255
93:                  
94:                  //jar
95:                  /*
96:                  ISR(USART_RX_vect)
97:                  {
98:                  	buf_enqueue(RCREG);
99:                  }
100:                 
101:                 */
102:                 
103:                 
104:                 
105:                 void receive_char(uint8_t c)
106:                 	{
9D01C798  27BDFFE8   ADDIU SP, SP, -24
9D01C79C  AFBF0014   SW RA, 20(SP)
107:                 	if (!process_escseqs)
9D01C7A0  93828071   LBU V0, -32655(GP)
9D01C7A4  14400005   BNE V0, ZERO, 0x9D01C7BC
9D01C7A8  00000000   NOP
108:                 		{
109:                 		video_putc_raw(c);
9D01C7AC  0F4071C9   JAL video_putc_raw
9D01C7B0  7C042420   SEB A0, A0
110:                 		return;
9D01C7B4  0B40722E   J 0x9D01C8B8
9D01C7B8  8FBF0014   LW RA, 20(SP)
111:                 		}
112:                 
113:                 	if (c)
9D01C7BC  1080003D   BEQ A0, ZERO, .LVL260
9D01C7C0  93838070   LBU V1, -32656(GP)
114:                 		{
115:                 		if (in_esc)
9D01C7C4  10600005   BEQ V1, ZERO, 0x9D01C7DC
9D01C7C8  2405000D   ADDIU A1, ZERO, 13
116:                 			escseq_process(c);
9D01C7CC  0F40717D   JAL escseq_process
9D01C7D0  7C042420   SEB A0, A0
9D01C7D4  0B40722E   J 0x9D01C8B8
9D01C7D8  8FBF0014   LW RA, 20(SP)
117:                 		else switch (c)
9D01C7DC  10850035   BEQ A0, A1, .LVL260
9D01C7E0  2C86000E   SLTIU A2, A0, 14
9D01C7E4  10C0000F   BEQ A2, ZERO, 0x9D01C824
9D01C7E8  240B000F   ADDIU T3, ZERO, 15
9D01C7EC  24070008   ADDIU A3, ZERO, 8
9D01C7F0  10870017   BEQ A0, A3, 0x9D01C850
9D01C7F4  2C880009   SLTIU T0, A0, 9
9D01C7F8  11000006   BEQ T0, ZERO, 0x9D01C814
9D01C7FC  2C8A000A   SLTIU T2, A0, 10
9D01C800  24090007   ADDIU T1, ZERO, 7
9D01C804  1089002C   BEQ A0, T1, 0x9D01C8B8
9D01C808  8FBF0014   LW RA, 20(SP)
9D01C814  11400016   BEQ T2, ZERO, 0x9D01C870
9D01C818  2C8F0020   SLTIU T7, A0, 32
9D01C81C  0B407229   J 0x9D01C8A4
9D01C820  00000000   NOP
9D01C824  108B001B   BEQ A0, T3, 0x9D01C894
9D01C828  2C8C000F   SLTIU T4, A0, 15
9D01C82C  15800016   BNE T4, ZERO, 0x9D01C888
9D01C830  240D001B   ADDIU T5, ZERO, 27
9D01C834  508D0019   BEQL A0, T5, 0x9D01C89C
9D01C838  24040001   ADDIU A0, ZERO, 1
9D01C83C  240E007F   ADDIU T6, ZERO, 127
9D01C840  148E0018   BNE A0, T6, 0x9D01C8A4
9D01C844  2C8F0020   SLTIU T7, A0, 32
118:                 				{
119:                 				case 0x07: /* BEL */
120:                 					break;   /* ignore bells */
121:                 				case '\b': /* backspace */
122:                 					video_cback();
9D01C850  0F406D99   JAL video_cback
9D01C854  00000000   NOP
123:                 					video_putc_raw(' ');
9D01C858  0F4071C9   JAL video_putc_raw
9D01C85C  24040020   ADDIU A0, ZERO, 32
124:                 					video_cback();
9D01C860  0F406D99   JAL video_cback
9D01C864  00000000   NOP
125:                 					break;
9D01C868  0B40722E   J 0x9D01C8B8
9D01C86C  8FBF0014   LW RA, 20(SP)
126:                 				case 0x0A: /* LF, VT, and FF all print a linefeed */
127:                 				case 0x0B:
128:                 				case 0x0C:
129:                 					video_setx(0);
9D01C870  0F406CFF   JAL video_setx
9D01C874  00002021   ADDU A0, ZERO, ZERO
130:                 					video_lf();
9D01C878  0F406D7E   JAL video_lf
9D01C87C  00000000   NOP
131:                 					break;
9D01C880  0B40722E   J 0x9D01C8B8
9D01C884  8FBF0014   LW RA, 20(SP)
132:                 				case 0x0D: /* CR */
133:                 //       video_setx(0);
134:                 					break;
135:                 				case 0x0E: /* SO; enable box-drawing characters */
136:                 					graphicchars = 1;
9D01C888  24180001   ADDIU T8, ZERO, 1
137:                 					break;
9D01C88C  0B40722D   J .LVL260
9D01C890  A3988069   SB T8, -32663(GP)
138:                 				case 0x0F: /* SI; return to normal characters */
139:                 					graphicchars = 0;
140:                 					break;
9D01C894  0B40722D   J .LVL260
9D01C898  A3808069   SB ZERO, -32663(GP)
141:                 				case 0x1B: /* ESC */
142:                 					in_esc = ESC_GOT_1B;
143:                 					break;
9D01C89C  0B40722D   J .LVL260
9D01C8A0  A3848070   SB A0, -32656(GP)
144:                 				case 0x7F: /* DEL */
145:                 					break;
146:                 				default:
147:                 					if (c >= ' ')
9D01C80C  0B407229   J 0x9D01C8A4
9D01C810  2C8F0020   SLTIU T7, A0, 32
9D01C8A4  15E00004   BNE T7, ZERO, 0x9D01C8B8
9D01C8A8  8FBF0014   LW RA, 20(SP)
148:                 						{
149:                 //jar
150:                 						/*
151:                 						          if (graphicchars && c >= '_' && c <= '~')
152:                 						            c -= 95;
153:                 						          c |= revvideo;
154:                 						*/
155:                 						video_putc_raw(c);
9D01C8AC  0F4071C9   JAL video_putc_raw
9D01C8B0  7C042420   SEB A0, A0
156:                 						}
157:                 				}
158:                 		}
159:                 	}
9D01C848  0B40722E   J 0x9D01C8B8
9D01C84C  8FBF0014   LW RA, 20(SP)
9D01C8B4  8FBF0014   LW RA, 20(SP)
9D01C8B8  03E00008   JR RA
9D01C8BC  27BD0018   ADDIU SP, SP, 24
160:                 
161:                 
162:                 void escseq_process(int8_t c)
163:                 	{
9D01C5F4  27BDFFE8   ADDIU SP, SP, -24
164:                 	/* CAN and SUB interrupt escape sequences */
165:                 	if (c == 0x18 || c == 0x1A)
9D01C5F8  2402FFFD   ADDIU V0, ZERO, -3
9D01C5FC  00821824   AND V1, A0, V0
9D01C600  24050018   ADDIU A1, ZERO, 24
9D01C604  14650003   BNE V1, A1, 0x9D01C614
9D01C608  AFBF0014   SW RA, 20(SP)
166:                 		{
167:                 		in_esc = NOT_IN_ESC;
168:                 		return;
9D01C60C  0B407196   J .LVL232
9D01C610  A3808070   SB ZERO, -32656(GP)
169:                 		}
170:                 
171:                 	if (in_esc == ESC_CSI)
9D01C614  93868070   LBU A2, -32656(GP)
9D01C618  24070002   ADDIU A3, ZERO, 2
9D01C61C  14C70005   BNE A2, A3, 0x9D01C634
9D01C620  24080003   ADDIU T0, ZERO, 3
172:                 		escseq_process_csi(c);
9D01C624  0F40700A   JAL escseq_process_csi
9D01C628  00000000   NOP
9D01C62C  0B407197   J 0x9D01C65C
9D01C630  8FBF0014   LW RA, 20(SP)
173:                 	else if (in_esc == ESC_NONCSI)
9D01C634  14C80003   BNE A2, T0, 0x9D01C644
9D01C638  24090001   ADDIU T1, ZERO, 1
9D01C63C  0B407196   J .LVL232
9D01C640  A3808070   SB ZERO, -32656(GP)
174:                 		{
175:                 		/* received a non-CSI sequence that requires a parameter
176:                 		 * (ESC #, ESC %, etc)
177:                 		 * These aren't supported, so eat this character */
178:                 		in_esc = NOT_IN_ESC;
179:                 		}
180:                 	else if (in_esc == ESC_GOT_1B)
9D01C644  14C90005   BNE A2, T1, 0x9D01C65C
9D01C648  8FBF0014   LW RA, 20(SP)
181:                 		{
182:                 		in_esc = ESC_NONCSI;
9D01C64C  240A0003   ADDIU T2, ZERO, 3
183:                 		escseq_process_noncsi(c);
9D01C650  0F406DCD   JAL escseq_process_noncsi
9D01C654  A38A8070   SB T2, -32656(GP)
184:                 		}
185:                 	}
9D01C658  8FBF0014   LW RA, 20(SP)
9D01C65C  03E00008   JR RA
9D01C660  27BD0018   ADDIU SP, SP, 24
186:                 
187:                 /* Process sequences that begin with ESC */
188:                 void escseq_process_noncsi(int8_t c)
189:                 	{
9D01B734  27BDFFE8   ADDIU SP, SP, -24
190:                 	switch (c)
9D01B738  2484FFDD   ADDIU A0, A0, -35
9D01B73C  308200FF   ANDI V0, A0, 255
9D01B740  2C430041   SLTIU V1, V0, 65
9D01B744  10600074   BEQ V1, ZERO, .LVL117, .L152
9D01B748  AFBF0014   SW RA, 20(SP)
9D01B74C  308500FF   ANDI A1, A0, 255
9D01B750  00053080   SLL A2, A1, 2
9D01B754  3C079D02   LUI A3, -25342
9D01B758  24E8B76C   ADDIU T0, A3, -18580
9D01B75C  01064821   ADDU T1, T0, A2
9D01B760  8D2A0000   LW T2, 0(T1)
9D01B764  01400008   JR T2
9D01B768  00000000   NOP
191:                 		{
192:                 		case '[': /* got the [; this is a CSI sequence */
193:                 			escseq_csi_start();
9D01B870  0F406CA4   JAL escseq_csi_start
9D01B874  00000000   NOP
194:                 			in_esc = ESC_CSI;
9D01B878  240B0002   ADDIU T3, ZERO, 2
195:                 			break;
9D01B87C  0B406E47   J 0x9D01B91C
9D01B880  A38B8070   SB T3, -32656(GP)
196:                 		case '%': /* non-CSI codes that require parameters */
197:                 		case '#': /* (we don't support these) */
198:                 		case '(':
199:                 		case ')':
200:                 			break;  /* return without setting in_esc to NOT_IN_ESC */
201:                 		case '7': /* save cursor position and attributes */
202:                 			save_term_state();
9D01B884  0F406CD4   JAL save_term_state
9D01B888  00000000   NOP
203:                 			goto esc_done;
9D01B88C  0B406E47   J 0x9D01B91C
9D01B890  A3808070   SB ZERO, -32656(GP)
204:                 		case '8': /* restore cursor position and attributes */
205:                 			restore_term_state();
9D01B894  0F406CD9   JAL restore_term_state
9D01B898  00000000   NOP
206:                 			goto esc_done;
9D01B89C  0B406E47   J 0x9D01B91C
9D01B8A0  A3808070   SB ZERO, -32656(GP)
207:                 		case 'E': /* next line */
208:                 			video_movesol(); /* fall through */
209:                 		case 'D': /* index */
210:                 
211:                 			if (video_gety() == video_bottom_margin())
9D01B8A8  838E8073   LB T6, -32653(GP)
9D01B8AC  838F8060   LB T7, -32672(GP)
9D01B8B0  15CF0005   BNE T6, T7, 0x9D01B8C8
9D01B8B4  00000000   NOP
212:                 				video_scrollup();
213:                 			else
214:                 				video_movey(1);
9D01B8C8  0F406D58   JAL video_movey
9D01B8CC  24040001   ADDIU A0, ZERO, 1
215:                 			goto esc_done;
216:                 		case 'M': /* reverse index */
217:                 			if (video_gety() == video_top_margin())
9D01B8D8  838C8073   LB T4, -32653(GP)
9D01B8DC  838D8061   LB T5, -32671(GP)
9D01B8E0  158D0005   BNE T4, T5, 0x9D01B8F8
9D01B8E4  00000000   NOP
218:                 				video_scrolldown();
219:                 			else
220:                 				video_movey(-1);
9D01B8F8  0F406D58   JAL video_movey
9D01B8FC  2404FFFF   ADDIU A0, ZERO, -1
221:                 			goto esc_done;
222:                 		case 'c': /* reset */
223:                 			video_clrscr();
9D01B908  0F406DBA   JAL video_clrscr
9D01B90C  00000000   NOP
224:                 			reset_term();
9D01B910  0F406CDE   JAL reset_term
9D01B914  00000000   NOP
225:                 			goto esc_done;
226:                 		default: /* other non-CSI codes */
227:                 esc_done:
228:                 			in_esc = NOT_IN_ESC; /* unimplemented */
9D01B8C0  0B406E47   J 0x9D01B91C
9D01B8C4  A3808070   SB ZERO, -32656(GP)
9D01B8D0  0B406E47   J 0x9D01B91C
9D01B8D4  A3808070   SB ZERO, -32656(GP)
9D01B8F0  0B406E47   J 0x9D01B91C
9D01B8F4  A3808070   SB ZERO, -32656(GP)
9D01B900  0B406E47   J 0x9D01B91C
9D01B904  A3808070   SB ZERO, -32656(GP)
9D01B918  A3808070   SB ZERO, -32656(GP)
229:                 			break;
230:                 		}
231:                 	}
9D01B91C  8FBF0014   LW RA, 20(SP)
9D01B920  03E00008   JR RA
9D01B924  27BD0018   ADDIU SP, SP, 24
232:                 
233:                 /* Process sequences that begin with ESC [ */
234:                 void escseq_process_csi(int8_t c)
235:                 	{
9D01C028  27BDFFE0   ADDIU SP, SP, -32
9D01C02C  AFBF001C   SW RA, 28(SP)
9D01C030  AFB20018   SW S2, 24(SP)
9D01C034  AFB10014   SW S1, 20(SP)
236:                 	if ((c >= '0' && c <= '9') || c == ';' || c == '?') /* digit or separator */
9D01C038  2482FFD0   ADDIU V0, A0, -48
9D01C03C  304300FF   ANDI V1, V0, 255
9D01C040  2C65000A   SLTIU A1, V1, 10
9D01C044  14A00006   BNE A1, ZERO, 0x9D01C060
9D01C048  AFB00010   SW S0, 16(SP)
9D01C04C  2406FFFB   ADDIU A2, ZERO, -5
9D01C050  00863824   AND A3, A0, A2
9D01C054  2408003B   ADDIU T0, ZERO, 59
9D01C058  54E8000D   BNEL A3, T0, 0x9D01C090
9D01C05C  2484FFBF   ADDIU A0, A0, -65
237:                 		{
238:                 		/* save the character */
239:                 		if (paramch >= MAX_ESC_LEN) /* received too many characters */
9D01C060  939F806A   LBU RA, -32662(GP)
9D01C064  2FF10030   SLTIU S1, RA, 48
9D01C068  16200003   BNE S1, ZERO, 0x9D01C078
9D01C06C  3C18A001   LUI T8, -24575
240:                 			{
241:                 			in_esc = NOT_IN_ESC;
242:                 			return;
9D01C070  0B407150   J 0x9D01C540
9D01C074  A3808070   SB ZERO, -32656(GP)
243:                 			}
244:                 		paramstr[paramch] = c;
9D01C078  271956D0   ADDIU T9, T8, 22224
9D01C07C  03F93821   ADDU A3, RA, T9
9D01C080  A0E40000   SB A0, 0(A3)
245:                 		paramch++;
9D01C084  27E40001   ADDIU A0, RA, 1
9D01C088  0B407150   J 0x9D01C540
9D01C08C  A384806A   SB A0, -32662(GP)
246:                 		}
247:                 	else
248:                 		{
249:                 		/* take the appropriate action */
250:                 		switch (c)
9D01C090  308900FF   ANDI T1, A0, 255
9D01C094  2D2A0032   SLTIU T2, T1, 50
9D01C098  11400128   BEQ T2, ZERO, .LVL227, .LBE55
9D01C09C  308B00FF   ANDI T3, A0, 255
9D01C0A0  000B6080   SLL T4, T3, 2
9D01C0A4  3C0D9D02   LUI T5, -25342
9D01C0A8  25AEC0BC   ADDIU T6, T5, -16196
9D01C0AC  01CC7821   ADDU T7, T6, T4
9D01C0B0  8DF00000   LW S0, 0(T7)
9D01C0B4  02000008   JR S0
9D01C0B8  00000000   NOP
251:                 			{
252:                 			case 'A': /* cursor up */
253:                 				video_movey(-escseq_get_param(1));
9D01C194  0F406CB6   JAL escseq_get_param
9D01C198  24040001   ADDIU A0, ZERO, 1
9D01C19C  00028023   SUBU S0, ZERO, V0
9D01C1A0  0F406D58   JAL video_movey
9D01C1A4  7C102420   SEB A0, S0
254:                 				break;
9D01C1A8  0B407150   J 0x9D01C540
9D01C1AC  A3808070   SB ZERO, -32656(GP)
255:                 			case 'B': /* cursor down */
256:                 				video_movey(escseq_get_param(1));
9D01C1B0  0F406CB6   JAL escseq_get_param
9D01C1B4  24040001   ADDIU A0, ZERO, 1
9D01C1B8  0F406D58   JAL video_movey
9D01C1BC  7C022420   SEB A0, V0
257:                 				break;
9D01C1C0  0B407150   J 0x9D01C540
9D01C1C4  A3808070   SB ZERO, -32656(GP)
258:                 			case 'C': /* cursor forward */
259:                 				video_movex(escseq_get_param(1));
9D01C1C8  0F406CB6   JAL escseq_get_param
9D01C1CC  24040001   ADDIU A0, ZERO, 1
9D01C1D0  0F406D4B   JAL video_movex
9D01C1D4  7C022420   SEB A0, V0
260:                 				break;
9D01C1D8  0B407150   J 0x9D01C540
9D01C1DC  A3808070   SB ZERO, -32656(GP)
261:                 			case 'D': /* cursor back */
262:                 				video_movex(-escseq_get_param(1));
9D01C1E0  0F406CB6   JAL escseq_get_param
9D01C1E4  24040001   ADDIU A0, ZERO, 1
9D01C1E8  00027023   SUBU T6, ZERO, V0
9D01C1EC  0F406D4B   JAL video_movex
9D01C1F0  7C0E2420   SEB A0, T6
263:                 				break;
9D01C1F4  0B407150   J 0x9D01C540
9D01C1F8  A3808070   SB ZERO, -32656(GP)
264:                 			case 'E': /* cursor to next line */
265:                 				video_movey(escseq_get_param(1));
9D01C1FC  0F406CB6   JAL escseq_get_param
9D01C200  24040001   ADDIU A0, ZERO, 1
9D01C204  0F406D58   JAL video_movey
9D01C208  7C022420   SEB A0, V0
266:                 				video_movesol();
267:                 				break;
268:                 			case 'F': /* cursor to previous line */
269:                 				video_movey(-escseq_get_param(1));
9D01C214  0F406CB6   JAL escseq_get_param
9D01C218  24040001   ADDIU A0, ZERO, 1
9D01C21C  00026823   SUBU T5, ZERO, V0
9D01C220  0F406D58   JAL video_movey
9D01C224  7C0D2420   SEB A0, T5
270:                 				video_movesol();
271:                 				break;
272:                 			case 'G': /* cursor horizontal absolute */
273:                 				video_setx(escseq_get_param(1)-1); /* one-indexed */
9D01C230  0F406CB6   JAL escseq_get_param
9D01C234  24040001   ADDIU A0, ZERO, 1
9D01C238  244CFFFF   ADDIU T4, V0, -1
9D01C23C  0F406CFF   JAL video_setx
9D01C240  7C0C2420   SEB A0, T4
274:                 				break;
9D01C244  0B407150   J 0x9D01C540
9D01C248  A3808070   SB ZERO, -32656(GP)
275:                 			case 'H':
276:                 			case 'f': /* horizonal and vertical position */
277:                 				{
278:                 				uint8_t y = escseq_get_param(1);
9D01C24C  0F406CB6   JAL escseq_get_param
9D01C250  24040001   ADDIU A0, ZERO, 1
9D01C254  00409021   ADDU S2, V0, ZERO
279:                 				uint8_t x = escseq_get_param(1);
9D01C258  0F406CB6   JAL escseq_get_param
9D01C25C  24040001   ADDIU A0, ZERO, 1
280:                 				video_gotoxy(x-1, y-1);
9D01C260  2442FFFF   ADDIU V0, V0, -1
9D01C264  264BFFFF   ADDIU T3, S2, -1
9D01C268  7C022420   SEB A0, V0
9D01C26C  0F406D09   JAL video_gotoxy
9D01C270  7C0B2C20   SEB A1, T3
281:                 				break;
9D01C274  0B407150   J 0x9D01C540
9D01C278  A3808070   SB ZERO, -32656(GP)
282:                 				}
283:                 			case 'J': /* erase */
284:                 				video_erase(escseq_get_param(0));
9D01C27C  0F406CB6   JAL escseq_get_param
9D01C280  00002021   ADDU A0, ZERO, ZERO
9D01C284  0F406E7F   JAL video_erase
9D01C288  00402021   ADDU A0, V0, ZERO
285:                 				break;
9D01C28C  0B407150   J 0x9D01C540
9D01C290  A3808070   SB ZERO, -32656(GP)
286:                 			case 'K': /* erase in line */
287:                 				video_eraseline(escseq_get_param(0));
9D01C294  0F406CB6   JAL escseq_get_param
9D01C298  00002021   ADDU A0, ZERO, ZERO
9D01C29C  0F406F59   JAL video_eraseline
9D01C2A0  00402021   ADDU A0, V0, ZERO
288:                 				break;
9D01C2A4  0B407150   J 0x9D01C540
9D01C2A8  A3808070   SB ZERO, -32656(GP)
289:                 			case 'L': /* erase in line */
290:                 //jar
291:                 				_video_scrolldown_lin(video_gety());
9D01C2AC  938C8073   LBU T4, -32653(GP)
292:                 				break;
293:                 			case 'M': /* erase in line */
294:                 //jar
295:                 				_video_scrollup_lin(video_gety());
296:                 				break;
297:                 
298:                 			case 'm': /* set graphic rendition */
299:                 				while (paramptr) /* read attributes until we reach the end */
9D01C500  8F99806C   LW T9, -32660(GP)
9D01C504  1720FFF4   BNE T9, ZERO, .LBE53, .LBE52
9D01C508  00000000   NOP
9D01C50C  0B407150   J 0x9D01C540
9D01C510  A3808070   SB ZERO, -32656(GP)
300:                 					{
301:                 					uint8_t attr = escseq_get_param(0);
9D01C4D8  0F406CB6   JAL escseq_get_param
9D01C4DC  00002021   ADDU A0, ZERO, ZERO
302:                 					if (attr == 0 || attr == 27)
9D01C184  2410001B   ADDIU S0, ZERO, 27
9D01C4E0  50400007   BEQL V0, ZERO, 0x9D01C500
9D01C4E4  A3808068   SB ZERO, -32664(GP)
9D01C4E8  14500003   BNE V0, S0, 0x9D01C4F8
9D01C4EC  00000000   NOP
303:                 						revvideo = 0;
9D01C4F0  0B407140   J 0x9D01C500
9D01C4F4  A3808068   SB ZERO, -32664(GP)
304:                 					else if (attr == 7)
9D01C188  24110007   ADDIU S1, ZERO, 7
9D01C4F8  50510001   BEQL V0, S1, 0x9D01C500
9D01C4FC  A3928068   SB S2, -32664(GP)
305:                 						revvideo = 0x80;
9D01C18C  0B407140   J 0x9D01C500
9D01C190  2412FF80   ADDIU S2, ZERO, -128
306:                 					}
307:                 				break;
308:                 			case 'r': /* set top and bottom margins */
309:                 				{
310:                 				uint8_t top = escseq_get_param(1);
9D01C514  0F406CB6   JAL escseq_get_param
9D01C518  24040001   ADDIU A0, ZERO, 1
9D01C51C  00408821   ADDU S1, V0, ZERO
311:                 				uint8_t bottom = escseq_get_param(DISP_BUFFER_HIGH);
9D01C520  0F406CB6   JAL escseq_get_param
9D01C524  24040014   ADDIU A0, ZERO, 20
312:                 				video_set_margins(top-1, bottom-1);
9D01C528  2632FFFF   ADDIU S2, S1, -1
9D01C52C  2458FFFF   ADDIU T8, V0, -1
9D01C530  7C122420   SEB A0, S2
9D01C534  0F406D1B   JAL video_set_margins
9D01C538  7C182C20   SEB A1, T8
313:                 				break;
314:                 				}
315:                 			default: /* unknown */
316:                 				break;
317:                 			}
318:                 
319:                 		in_esc = NOT_IN_ESC;
9D01C53C  A3808070   SB ZERO, -32656(GP)
320:                 		}
321:                 	}
9D01C540  8FBF001C   LW RA, 28(SP)
9D01C544  8FB20018   LW S2, 24(SP)
9D01C548  8FB10014   LW S1, 20(SP)
9D01C54C  8FB00010   LW S0, 16(SP)
9D01C550  03E00008   JR RA
9D01C554  27BD0020   ADDIU SP, SP, 32
9D01C558  1320FF5D   BEQ T9, ZERO, 0x9D01C2D0
9D01C55C  24030001   ADDIU V1, ZERO, 1
9D01C560  13230017   BEQ T9, V1, 0x9D01C5C0
9D01C564  24050002   ADDIU A1, ZERO, 2
322:                 
323:                 void escseq_csi_start()
324:                 	{
325:                 	paramch = 0;
9D01B290  A380806A   SB ZERO, -32662(GP)
326:                 	memset(paramstr, 0, MAX_ESC_LEN+1);
9D01B294  3C02A001   LUI V0, -24575
9D01B298  AC4056D0   SW ZERO, 22224(V0)
9D01B29C  244356D0   ADDIU V1, V0, 22224
9D01B2A0  AC600004   SW ZERO, 4(V1)
9D01B2A4  AC600008   SW ZERO, 8(V1)
9D01B2A8  AC60000C   SW ZERO, 12(V1)
9D01B2AC  AC600010   SW ZERO, 16(V1)
9D01B2B0  AC600014   SW ZERO, 20(V1)
9D01B2B4  AC600018   SW ZERO, 24(V1)
9D01B2B8  AC60001C   SW ZERO, 28(V1)
9D01B2BC  AC600020   SW ZERO, 32(V1)
9D01B2C0  AC600024   SW ZERO, 36(V1)
9D01B2C4  AC600028   SW ZERO, 40(V1)
9D01B2C8  AC60002C   SW ZERO, 44(V1)
9D01B2CC  A0600030   SB ZERO, 48(V1)
327:                 	paramptr = &paramstr[0];
9D01B2D0  03E00008   JR RA
9D01B2D4  AF83806C   SW V1, -32660(GP)
328:                 	}
329:                 
330:                 uint8_t escseq_get_param(uint8_t defaultval)
331:                 	{
9D01B2D8  27BDFFE0   ADDIU SP, SP, -32
9D01B2DC  AFBF001C   SW RA, 28(SP)
9D01B2E0  AFB10018   SW S1, 24(SP)
9D01B2E4  AFB00014   SW S0, 20(SP)
332:                 	uint8_t val;
333:                 	int8_t *startptr;
334:                 	int8_t *endptr;
335:                 
336:                 	if (!paramptr)
9D01B2E8  8F90806C   LW S0, -32660(GP)
9D01B2EC  12000012   BEQ S0, ZERO, 0x9D01B338
9D01B2F0  00808821   ADDU S1, A0, ZERO
337:                 		return defaultval;
338:                 
339:                 	val = defaultval;
340:                 	startptr = paramptr;
341:                 	/* get everything up to the semicolon, move past it */
342:                 	endptr = strchr(paramptr, ';');
9D01B2F4  02002021   ADDU A0, S0, ZERO
9D01B2F8  0F40FBCB   JAL strchr
9D01B2FC  2405003B   ADDIU A1, ZERO, 59
343:                 	if (endptr)
9D01B300  10400004   BEQ V0, ZERO, 0x9D01B314
9D01B304  24430001   ADDIU V1, V0, 1
344:                 		{
345:                 		*endptr = '\0'; /* replace the semicolon to make atoi stop here */
9D01B308  A0400000   SB ZERO, 0(V0)
9D01B30C  0B406CC6   J 0x9D01B318
9D01B310  AF83806C   SW V1, -32660(GP)
346:                 		paramptr = endptr+1;
347:                 		}
348:                 	else
349:                 		paramptr = NULL;
9D01B314  AF80806C   SW ZERO, -32660(GP)
350:                 
351:                 	/* ascii to integer, as long as the string isn't empty */
352:                 	/* default value is given if the string is empty */
353:                 	if (*startptr)
9D01B318  82020000   LB V0, 0(S0)
9D01B31C  10400007   BEQ V0, ZERO, 0x9D01B33C
9D01B320  02201021   ADDU V0, S1, ZERO
354:                 		val = atoi(startptr); /* will read up to the null */
9D01B324  02002021   ADDU A0, S0, ZERO
9D01B328  00002821   ADDU A1, ZERO, ZERO
9D01B32C  0F40E9B1   JAL strtol
9D01B330  2406000A   ADDIU A2, ZERO, 10
9D01B334  305100FF   ANDI S1, V0, 255
355:                 
356:                 
357:                 	return val;
358:                 	}
9D01B338  02201021   ADDU V0, S1, ZERO
9D01B33C  8FBF001C   LW RA, 28(SP)
9D01B340  8FB10018   LW S1, 24(SP)
9D01B344  8FB00014   LW S0, 20(SP)
9D01B348  03E00008   JR RA
9D01B34C  27BD0020   ADDIU SP, SP, 32
359:                 
360:                 void save_term_state()
361:                 	{
362:                 //jar
363:                 //  savedstate.cx = video_getx();
364:                 //  savedstate.cy = video_gety();
365:                 	savedstate.graphicchars = graphicchars;
9D01B350  93828069   LBU V0, -32663(GP)
9D01B354  A3828066   SB V0, -32666(GP)
366:                 	savedstate.revvideo = revvideo;
9D01B358  93838068   LBU V1, -32664(GP)
9D01B35C  03E00008   JR RA
9D01B360  A3838067   SB V1, -32665(GP)
367:                 	}
368:                 
369:                 void restore_term_state()
370:                 	{
371:                 //jar
372:                 //  video_gotoxy(savedstate.cx, savedstate.cy);
373:                 	graphicchars = savedstate.graphicchars;
9D01B364  93828066   LBU V0, -32666(GP)
9D01B368  A3828069   SB V0, -32663(GP)
374:                 	revvideo = savedstate.revvideo;
9D01B36C  93838067   LBU V1, -32665(GP)
9D01B370  03E00008   JR RA
9D01B374  A3838068   SB V1, -32664(GP)
375:                 	}
376:                 
377:                 void reset_term()
378:                 	{
9D01B378  27BDFFE8   ADDIU SP, SP, -24
9D01B37C  AFBF0014   SW RA, 20(SP)
379:                 	graphicchars = 0;
9D01B380  A3808069   SB ZERO, -32663(GP)
380:                 	revvideo = 0;
9D01B384  A3808068   SB ZERO, -32664(GP)
381:                 	in_esc = 0;
382:                 	save_term_state();
9D01B388  0F406CD4   JAL save_term_state
9D01B38C  A3808070   SB ZERO, -32656(GP)
383:                 	}
9D01B390  8FBF0014   LW RA, 20(SP)
9D01B394  03E00008   JR RA
9D01B398  27BD0018   ADDIU SP, SP, 24
384:                 
385:                 
386:                 void video_reset_margins()
387:                 	{
9D01B4C0  27BDFFE8   ADDIU SP, SP, -24
9D01B4C4  AFBF0014   SW RA, 20(SP)
388:                 	video_set_margins(0, DISP_BUFFER_HIGH-1);
9D01B4C8  00002021   ADDU A0, ZERO, ZERO
9D01B4CC  0F406D1B   JAL video_set_margins
9D01B4D0  24050013   ADDIU A1, ZERO, 19
389:                 	}
9D01B4D4  8FBF0014   LW RA, 20(SP)
9D01B4D8  03E00008   JR RA
9D01B4DC  27BD0018   ADDIU SP, SP, 24
390:                 
391:                 void video_set_margins(int8_t top, int8_t bottom)
392:                 	{
9D01B46C  27BDFFE8   ADDIU SP, SP, -24
9D01B470  AFBF0014   SW RA, 20(SP)
9D01B474  00041027   NOR V0, ZERO, A0
9D01B478  00021FC3   SRA V1, V0, 31
9D01B47C  00A03021   ADDU A2, A1, ZERO
9D01B480  28A50014   SLTI A1, A1, 20
9D01B484  14A00002   BNE A1, ZERO, 0x9D01B490
9D01B488  00642024   AND A0, V1, A0
9D01B48C  24060013   ADDIU A2, ZERO, 19
9D01B490  7C063C20   SEB A3, A2
393:                 	/* sanitize input */
394:                 	if (top < 0) top = 0;
395:                 	if (bottom >= DISP_BUFFER_HIGH) bottom = DISP_BUFFER_HIGH-1;
396:                 	if (top >= bottom)
9D01B494  0087402A   SLT T0, A0, A3
397:                 		{
398:                 		top = 0;
399:                 		bottom = DISP_BUFFER_HIGH-1;
9D01B498  24090013   ADDIU T1, ZERO, 19
9D01B49C  0128380A   MOVZ A3, T1, T0
9D01B4A0  0008200A   MOVZ A0, ZERO, T0
400:                 		}
401:                 
402:                 	mtop = top;
9D01B4A4  A3848061   SB A0, -32671(GP)
403:                 	mbottom = bottom;
9D01B4A8  A3878060   SB A3, -32672(GP)
404:                 	video_gotoxy(mtop, 0);
9D01B4AC  0F406D09   JAL video_gotoxy
9D01B4B0  00002821   ADDU A1, ZERO, ZERO
405:                 	}
9D01B4B4  8FBF0014   LW RA, 20(SP)
9D01B4B8  03E00008   JR RA
9D01B4BC  27BD0018   ADDIU SP, SP, 24
406:                 
407:                 int8_t video_top_margin()
408:                 	{
409:                 	return mtop;
410:                 	}
9D01B39C  03E00008   JR RA
9D01B3A0  83828061   LB V0, -32671(GP)
411:                 
412:                 int8_t video_bottom_margin()
413:                 	{
414:                 	return mbottom;
415:                 	}
9D01B3A4  03E00008   JR RA
9D01B3A8  83828060   LB V0, -32672(GP)
416:                 
417:                 void video_set_reverse(uint8_t val)
418:                 	{
419:                 	revvideo = (val) ? 0x80 : 0;
9D01B3AC  24020080   ADDIU V0, ZERO, 128
9D01B3B0  0004100A   MOVZ V0, ZERO, A0
9D01B3B4  03E00008   JR RA
9D01B3B8  A3828068   SB V0, -32664(GP)
420:                 	}
421:                 
422:                 static void _video_scrollup()
423:                 	{
424:                 	uint8_t i,j;
425:                 //jar
426:                 	/*
427:                 	  memmove(&disp_buffer[mtop], &disp_buffer[mtop+1], (mbottom-mtop)*DISP_BUFFER_WIDE);
428:                 	  memset(&disp_buffer[mbottom], revvideo, DISP_BUFFER_WIDE);
429:                 	*/
430:                 	for (j=1; j<(mbottom+1); j++)
9D01AC1C  838C8060   LB T4, -32672(GP)
9D01AC20  25890001   ADDIU T1, T4, 1
9D01AC24  29220002   SLTI V0, T1, 2
9D01AC28  14400063   BNE V0, ZERO, 0x9D01ADB8
9D01AC2C  24050001   ADDIU A1, ZERO, 1
9D01AC30  24070001   ADDIU A3, ZERO, 1
9D01AC34  3C08A000   LUI T0, -24576
9D01AC38  250F198C   ADDIU T7, T0, 6540
9D01AC3C  3C0BA000   LUI T3, -24576
9D01AC40  25781644   ADDIU T8, T3, 5700
9D01AC44  0B406B3C   J 0x9D01ACF0
9D01AC48  25EA0028   ADDIU T2, T7, 40
9D01ACDC  24E70001   ADDIU A3, A3, 1
9D01ACE0  30E700FF   ANDI A3, A3, 255
9D01ACE4  00E9702A   SLT T6, A3, T1
9D01ACE8  11C00033   BEQ T6, ZERO, 0x9D01ADB8
9D01ACEC  00E02821   ADDU A1, A3, ZERO
9D01ACF0  000530C0   SLL A2, A1, 3
9D01ACF4  00051940   SLL V1, A1, 5
9D01ACF8  00C36821   ADDU T5, A2, V1
9D01ACFC  01ED2021   ADDU A0, T7, T5
9D01AD00  030D2821   ADDU A1, T8, T5
9D01AD04  0B406B13   J 0x9D01AC4C
9D01AD08  014D7021   ADDU T6, T2, T5
9D01AD0C  01641021   ADDU V0, T3, A0
9D01ADDC  00002021   ADDU A0, ZERO, ZERO
431:                 		{
432:                 		for (i=0; i<DISP_BUFFER_WIDE; i++)
9D01ACD4  148EFFDD   BNE A0, T6, 0x9D01AC4C
9D01ACD8  24A50008   ADDIU A1, A1, 8
433:                 			{
434:                 			disp_buffer[j-1][i] = disp_buffer[j][i];
9D01AC4C  90990000   LBU T9, 0(A0)
9D01AC50  A099FFD8   SB T9, -40(A0)
9D01AC60  908B0001   LBU T3, 1(A0)
9D01AC64  A10BFFD8   SB T3, -40(T0)
9D01AC70  91030001   LBU V1, 1(T0)
9D01AC74  A103FFD9   SB V1, -39(T0)
9D01AC80  91040002   LBU A0, 2(T0)
9D01AC84  A104FFDA   SB A0, -38(T0)
9D01AC90  91020003   LBU V0, 3(T0)
9D01AC94  A102FFDB   SB V0, -37(T0)
9D01ACA0  91060004   LBU A2, 4(T0)
9D01ACA4  A106FFDC   SB A2, -36(T0)
9D01ACB0  910D0005   LBU T5, 5(T0)
9D01ACB4  A10DFFDD   SB T5, -35(T0)
9D01ACC0  91190006   LBU T9, 6(T0)
9D01ACC4  A119FFDE   SB T9, -34(T0)
435:                 			color_buffer[j-1][i] = color_buffer[j][i];
9D01AC54  90A20000   LBU V0, 0(A1)
9D01AC58  A0A2FFD8   SB V0, -40(A1)
9D01AC5C  24880001   ADDIU T0, A0, 1
9D01AC68  90A60001   LBU A2, 1(A1)
9D01AC6C  A0A6FFD9   SB A2, -39(A1)
9D01AC78  90AD0002   LBU T5, 2(A1)
9D01AC7C  A0ADFFDA   SB T5, -38(A1)
9D01AC88  90B90003   LBU T9, 3(A1)
9D01AC8C  A0B9FFDB   SB T9, -37(A1)
9D01AC98  90AB0004   LBU T3, 4(A1)
9D01AC9C  A0ABFFDC   SB T3, -36(A1)
9D01ACA8  90A30005   LBU V1, 5(A1)
9D01ACAC  A0A3FFDD   SB V1, -35(A1)
9D01ACB8  90A40006   LBU A0, 6(A1)
9D01ACBC  A0A4FFDE   SB A0, -34(A1)
9D01ACC8  90A20007   LBU V0, 7(A1)
9D01ACCC  A0A2FFDF   SB V0, -33(A1)
9D01ACD0  25040007   ADDIU A0, T0, 7
436:                 			}
437:                 		}
438:                 	for (i=0; i<DISP_BUFFER_WIDE; i++)
9D01ADA8  1499FFD8   BNE A0, T9, 0x9D01AD0C
9D01ADAC  A0400000   SB ZERO, 0(V0)
9D01ADB0  03E00008   JR RA
9D01ADB4  00000000   NOP
9D01ADB8  000C78C0   SLL T7, T4, 3
9D01ADBC  000C4940   SLL T1, T4, 5
9D01ADC0  01E95021   ADDU T2, T7, T1
9D01ADC4  3C18A000   LUI T8, -24576
9D01ADC8  270C198C   ADDIU T4, T8, 6540
9D01ADCC  018A5821   ADDU T3, T4, T2
9D01ADD0  3C08A000   LUI T0, -24576
9D01ADD4  25061644   ADDIU A2, T0, 5700
9D01ADD8  00CA6821   ADDU T5, A2, T2
9D01ADE4  0B406B43   J 0x9D01AD0C
9D01ADE8  24190028   ADDIU T9, ZERO, 40
439:                 		{
440:                 		disp_buffer[mbottom][i] = ' ';
9D01AD10  A0430000   SB V1, 0(V0)
9D01AD14  01A43821   ADDU A3, T5, A0
9D01AD24  A1E30000   SB V1, 0(T7)
9D01AD28  01A54821   ADDU T1, T5, A1
9D01AD38  A3030000   SB V1, 0(T8)
9D01AD3C  01AA6021   ADDU T4, T5, T2
9D01AD4C  A0C30000   SB V1, 0(A2)
9D01AD50  01A82021   ADDU A0, T5, T0
9D01AD60  A0E30000   SB V1, 0(A3)
9D01AD64  01A27021   ADDU T6, T5, V0
9D01AD74  A1230000   SB V1, 0(T1)
9D01AD78  01AF5021   ADDU T2, T5, T7
9D01AD88  A1830000   SB V1, 0(T4)
9D01AD8C  01B84021   ADDU T0, T5, T8
9D01AD9C  A0830000   SB V1, 0(A0)
9D01ADA0  01A61021   ADDU V0, T5, A2
9D01ADA4  24A40007   ADDIU A0, A1, 7
9D01ADE0  24030020   ADDIU V1, ZERO, 32
441:                 		color_buffer[mbottom][i] = 0;
9D01AD18  A0E00000   SB ZERO, 0(A3)
9D01AD1C  24850001   ADDIU A1, A0, 1
9D01AD20  01657821   ADDU T7, T3, A1
9D01AD2C  A1200000   SB ZERO, 0(T1)
9D01AD30  24AA0001   ADDIU T2, A1, 1
9D01AD34  016AC021   ADDU T8, T3, T2
9D01AD40  A1800000   SB ZERO, 0(T4)
9D01AD44  24A80002   ADDIU T0, A1, 2
9D01AD48  01683021   ADDU A2, T3, T0
9D01AD54  A0800000   SB ZERO, 0(A0)
9D01AD58  24A20003   ADDIU V0, A1, 3
9D01AD5C  01623821   ADDU A3, T3, V0
9D01AD68  A1C00000   SB ZERO, 0(T6)
9D01AD6C  24AF0004   ADDIU T7, A1, 4
9D01AD70  016F4821   ADDU T1, T3, T7
9D01AD7C  A1400000   SB ZERO, 0(T2)
9D01AD80  24B80005   ADDIU T8, A1, 5
9D01AD84  01786021   ADDU T4, T3, T8
9D01AD90  A1000000   SB ZERO, 0(T0)
9D01AD94  24A60006   ADDIU A2, A1, 6
9D01AD98  01662021   ADDU A0, T3, A2
9D01AD9C  A0830000   SB V1, 0(A0)
9D01ADA0  01A61021   ADDU V0, T5, A2
9D01ADA4  24A40007   ADDIU A0, A1, 7
9D01ADA8  1499FFD8   BNE A0, T9, 0x9D01AD0C
9D01ADAC  A0400000   SB ZERO, 0(V0)
9D01ADB0  03E00008   JR RA
9D01ADB4  00000000   NOP
9D01ADB8  000C78C0   SLL T7, T4, 3
9D01ADBC  000C4940   SLL T1, T4, 5
9D01ADC0  01E95021   ADDU T2, T7, T1
9D01ADC4  3C18A000   LUI T8, -24576
9D01ADC8  270C198C   ADDIU T4, T8, 6540
9D01ADCC  018A5821   ADDU T3, T4, T2
9D01ADD0  3C08A000   LUI T0, -24576
9D01ADD4  25061644   ADDIU A2, T0, 5700
9D01ADD8  00CA6821   ADDU T5, A2, T2
9D01ADDC  00002021   ADDU A0, ZERO, ZERO
9D01ADE0  24030020   ADDIU V1, ZERO, 32
9D01ADE4  0B406B43   J 0x9D01AD0C
9D01ADE8  24190028   ADDIU T9, ZERO, 40
442:                 		}
443:                 
444:                 	}
445:                 
446:                 static void _video_scrollup_lin(uint8_t lin)
447:                 	{
448:                 	uint8_t i,j;
449:                 //jar
450:                 	/*
451:                 	  memmove(&disp_buffer[mtop], &disp_buffer[mtop+1], (mbottom-mtop)*DISP_BUFFER_WIDE);
452:                 	  memset(&disp_buffer[mbottom], revvideo, DISP_BUFFER_WIDE);
453:                 	*/
454:                 	for (j=(lin+1); j<(mbottom+1); j++)
9D01C3E0  939F8073   LBU RA, -32653(GP)
9D01C4A8  24E70001   ADDIU A3, A3, 1
455:                 		{
456:                 		for (i=0; i<DISP_BUFFER_WIDE; i++)
9D01C4A0  15F9FFDD   BNE T7, T9, 0x9D01C418
457:                 			{
458:                 			disp_buffer[j-1][i] = disp_buffer[j][i];
9D01C418  91F00000   LBU S0, 0(T7)
9D01C42C  91FF0001   LBU RA, 1(T7)
9D01C43C  92430001   LBU V1, 1(S2)
9D01C44C  92460002   LBU A2, 2(S2)
9D01C45C  924C0003   LBU T4, 3(S2)
9D01C46C  924E0004   LBU T6, 4(S2)
9D01C47C  92500005   LBU S0, 5(S2)
9D01C48C  925F0006   LBU RA, 6(S2)
459:                 			color_buffer[j-1][i] = color_buffer[j][i];
9D01C420  93110000   LBU S1, 0(T8)
9D01C434  93020001   LBU V0, 1(T8)
9D01C444  93050002   LBU A1, 2(T8)
9D01C454  93040003   LBU A0, 3(T8)
9D01C464  930D0004   LBU T5, 4(T8)
9D01C474  930F0005   LBU T7, 5(T8)
9D01C484  93110006   LBU S1, 6(T8)
9D01C494  93020007   LBU V0, 7(T8)
9D01C498  A302FFDF   SB V0, -33(T8)
9D01C49C  264F0007   ADDIU T7, S2, 7
9D01C4A0  15F9FFDD   BNE T7, T9, 0x9D01C418
9D01C4A4  27180008   ADDIU T8, T8, 8
9D01C4A8  24E70001   ADDIU A3, A3, 1
9D01C4AC  30E700FF   ANDI A3, A3, 255
9D01C4B0  00E9C82A   SLT T9, A3, T1
9D01C4B4  13200021   BEQ T9, ZERO, .LVL227, .LBE55
9D01C4B8  00E0C021   ADDU T8, A3, ZERO
9D01C4BC  001860C0   SLL T4, T8, 3
9D01C4C0  00186940   SLL T5, T8, 5
9D01C4C4  018D7021   ADDU T6, T4, T5
9D01C4C8  010E7821   ADDU T7, T0, T6
9D01C4CC  016EC021   ADDU T8, T3, T6
9D01C4D0  0B407106   J 0x9D01C418
9D01C4D4  014EC821   ADDU T9, T2, T6
460:                 			}
461:                 		}
462:                 	/*
463:                 	for (i=0;i<DISP_BUFFER_WIDE;i++)
464:                 		{
465:                 		disp_buffer[lin][i] = ' ';
466:                 		}
467:                 	*/
468:                 	}
469:                 
470:                 static void _video_scrolldown()
471:                 	{
472:                 	uint8_t i,j;
473:                 //  memmove(&disp_buffer[mtop+1], &disp_buffer[mtop], (mbottom-mtop)*DISP_BUFFER_WIDE);
474:                 //  memset(&disp_buffer[mtop], revvideo, DISP_BUFFER_WIDE);
475:                 	for (j=mbottom; j>0; j--)
9D01ADEC  938A8060   LBU T2, -32672(GP)
9D01ADF0  11400074   BEQ T2, ZERO, 0x9D01AFC4
9D01ADF4  3C0BA000   LUI T3, -24576
9D01ADF8  256B198C   ADDIU T3, T3, 6540
9D01ADFC  3C0CA000   LUI T4, -24576
9D01AE00  0B406BAF   J 0x9D01AEBC
9D01AE04  258C1644   ADDIU T4, T4, 5700
9D01AEAC  254AFFFF   ADDIU T2, T2, -1
9D01AEB0  314A00FF   ANDI T2, T2, 255
9D01AEB4  11400044   BEQ T2, ZERO, 0x9D01AFC8
9D01AEB8  838F8061   LB T7, -32671(GP)
9D01AF10  0B406BAC   J 0x9D01AEB0
9D01AF14  254AFFFF   ADDIU T2, T2, -1
9D01AF18  03253821   ADDU A3, T9, A1
9D01B090  0B406BAC   J 0x9D01AEB0
9D01B094  254AFFFF   ADDIU T2, T2, -1
476:                 		{
477:                 		for (i=0; i<DISP_BUFFER_WIDE; i++)
9D01AEA4  1489FFD8   BNE A0, T1, 0x9D01AE08
9D01AEA8  27270003   ADDIU A3, T9, 3
9D01AF08  1489003C   BNE A0, T1, 0x9D01AFFC
9D01AF0C  25C70001   ADDIU A3, T6, 1
9D01B088  1489FF5F   BNE A0, T1, 0x9D01AE08
9D01B08C  24E70001   ADDIU A3, A3, 1
478:                 			{
479:                 			disp_buffer[j][i] = disp_buffer[j-1][i];
9D01AE08  808E0000   LB T6, 0(A0)
9D01AE0C  00832821   ADDU A1, A0, V1
9D01AE10  00AF1021   ADDU V0, A1, T7
9D01AE14  A04E0028   SB T6, 40(V0)
9D01AE30  808E0001   LB T6, 1(A0)
9D01AE34  03032021   ADDU A0, T8, V1
9D01AE38  008F2821   ADDU A1, A0, T7
9D01AE3C  A0AE0028   SB T6, 40(A1)
9D01AE58  83080001   LB T0, 1(T8)
9D01AE5C  01A32021   ADDU A0, T5, V1
9D01AE60  008F2821   ADDU A1, A0, T7
9D01AE64  A0A80028   SB T0, 40(A1)
9D01AE80  83080002   LB T0, 2(T8)
9D01AE84  01A32021   ADDU A0, T5, V1
9D01AE88  008F2821   ADDU A1, A0, T7
9D01AE8C  A0A80028   SB T0, 40(A1)
9D01AEBC  2542FFFF   ADDIU V0, T2, -1
9D01AEC0  000230C0   SLL A2, V0, 3
9D01AEC4  00021940   SLL V1, V0, 5
9D01AEC8  00C32021   ADDU A0, A2, V1
9D01AECC  01642821   ADDU A1, T3, A0
9D01AED0  01847021   ADDU T6, T4, A0
9D01AED4  000A38C0   SLL A3, T2, 3
9D01AED8  000A4140   SLL T0, T2, 5
9D01AEDC  00E87821   ADDU T7, A3, T0
9D01AEE0  016F4821   ADDU T1, T3, T7
9D01AEE4  00056827   NOR T5, ZERO, A1
9D01AEE8  01A9C021   ADDU T8, T5, T1
9D01AEEC  33190003   ANDI T9, T8, 3
9D01AEF0  80A20000   LB V0, 0(A1)
9D01AEF4  A0A20028   SB V0, 40(A1)
9D01B00C  532D000C   BEQL T9, T5, 0x9D01B040
9D01B010  80880000   LB T0, 0(A0)
9D01B014  80B80001   LB T8, 1(A1)
9D01B018  00832821   ADDU A1, A0, V1
9D01B01C  00AFC821   ADDU T9, A1, T7
9D01B020  A3380028   SB T8, 40(T9)
9D01B03C  80880000   LB T0, 0(A0)
9D01B040  00836821   ADDU T5, A0, V1
9D01B044  01AFC021   ADDU T8, T5, T7
9D01B048  A3080028   SB T0, 40(T8)
9D01B064  80820000   LB V0, 0(A0)
9D01B068  00833021   ADDU A2, A0, V1
9D01B06C  00CF4021   ADDU T0, A2, T7
9D01B070  A1020028   SB V0, 40(T0)
480:                 			color_buffer[j][i] = color_buffer[j-1][i];
9D01AE18  80E60000   LB A2, 0(A3)
9D01AE1C  00E34021   ADDU T0, A3, V1
9D01AE20  010F6821   ADDU T5, T0, T7
9D01AE24  A1A60028   SB A2, 40(T5)
9D01AE28  24980001   ADDIU T8, A0, 1
9D01AE2C  24F90001   ADDIU T9, A3, 1
9D01AE40  80E70001   LB A3, 1(A3)
9D01AE44  03231021   ADDU V0, T9, V1
9D01AE48  004F3021   ADDU A2, V0, T7
9D01AE4C  A0C70028   SB A3, 40(A2)
9D01AE50  270D0001   ADDIU T5, T8, 1
9D01AE54  272E0001   ADDIU T6, T9, 1
9D01AE68  83270001   LB A3, 1(T9)
9D01AE6C  01C31021   ADDU V0, T6, V1
9D01AE70  004F3021   ADDU A2, V0, T7
9D01AE74  A0C70028   SB A3, 40(A2)
9D01AE78  270D0002   ADDIU T5, T8, 2
9D01AE7C  272E0002   ADDIU T6, T9, 2
9D01AE90  83270002   LB A3, 2(T9)
9D01AE94  01C31021   ADDU V0, T6, V1
9D01AE98  004F3021   ADDU A2, V0, T7
9D01AE9C  A0C70028   SB A3, 40(A2)
9D01AEA0  27040003   ADDIU A0, T8, 3
9D01AEF8  81C60000   LB A2, 0(T6)
9D01AEFC  000F1823   SUBU V1, ZERO, T7
9D01AF00  A1C60028   SB A2, 40(T6)
9D01AF04  24A40001   ADDIU A0, A1, 1
9D01B024  81CE0001   LB T6, 1(T6)
9D01B028  00E31021   ADDU V0, A3, V1
9D01B02C  004F3021   ADDU A2, V0, T7
9D01B030  A0CE0028   SB T6, 40(A2)
9D01B034  24840001   ADDIU A0, A0, 1
9D01B038  24E70001   ADDIU A3, A3, 1
9D01B04C  80F90000   LB T9, 0(A3)
9D01B050  00E32821   ADDU A1, A3, V1
9D01B054  00AF7021   ADDU T6, A1, T7
9D01B058  A1D90028   SB T9, 40(T6)
9D01B05C  24840001   ADDIU A0, A0, 1
9D01B060  24E70001   ADDIU A3, A3, 1
9D01B074  80ED0000   LB T5, 0(A3)
9D01B078  00E3C021   ADDU T8, A3, V1
9D01B07C  030FC821   ADDU T9, T8, T7
9D01B080  A32D0028   SB T5, 40(T9)
9D01B084  24840001   ADDIU A0, A0, 1
481:                 			}
482:                 		}
483:                 	for (i=0; i<DISP_BUFFER_WIDE; i++)
9D01AFB4  14A8FFD8   BNE A1, T0, 0x9D01AF18
9D01AFB8  A0400000   SB ZERO, 0(V0)
9D01AFBC  03E00008   JR RA
9D01AFC0  00000000   NOP
9D01AFC4  838F8061   LB T7, -32671(GP)
9D01AFC8  000F48C0   SLL T1, T7, 3
9D01AFCC  000F1940   SLL V1, T7, 5
9D01AFD0  01235821   ADDU T3, T1, V1
9D01AFD4  3C0CA000   LUI T4, -24576
9D01AFD8  2598198C   ADDIU T8, T4, 6540
9D01AFDC  030BC821   ADDU T9, T8, T3
9D01AFE0  3C0DA000   LUI T5, -24576
9D01AFE4  25AE1644   ADDIU T6, T5, 5700
9D01AFE8  01CB2021   ADDU A0, T6, T3
9D01AFF4  0B406BC6   J 0x9D01AF18
9D01AFF8  24080028   ADDIU T0, ZERO, 40
9D01AFFC  1320FF82   BEQ T9, ZERO, 0x9D01AE08
9D01B000  24080001   ADDIU T0, ZERO, 1
9D01B004  13280017   BEQ T9, T0, 0x9D01B064
9D01B008  240D0002   ADDIU T5, ZERO, 2
484:                 		{
485:                 		disp_buffer[mtop][i] = ' ';
9D01AF1C  A0EA0000   SB T2, 0(A3)
9D01AF20  00851021   ADDU V0, A0, A1
9D01AF30  A12A0000   SB T2, 0(T1)
9D01AF34  008F1821   ADDU V1, A0, T7
9D01AF44  A18A0000   SB T2, 0(T4)
9D01AF48  008BC021   ADDU T8, A0, T3
9D01AF58  A1CA0000   SB T2, 0(T6)
9D01AF5C  008D2821   ADDU A1, A0, T5
9D01AF6C  A0EA0000   SB T2, 0(A3)
9D01AF70  00823021   ADDU A2, A0, V0
9D01AF80  A06A0000   SB T2, 0(V1)
9D01AF84  00895821   ADDU T3, A0, T1
9D01AF94  A30A0000   SB T2, 0(T8)
9D01AF98  008C6821   ADDU T5, A0, T4
9D01AFA8  A0AA0000   SB T2, 0(A1)
9D01AFAC  008E1021   ADDU V0, A0, T6
9D01AFB0  25E50007   ADDIU A1, T7, 7
9D01AFEC  00002821   ADDU A1, ZERO, ZERO
9D01AFF0  240A0020   ADDIU T2, ZERO, 32
486:                 		color_buffer[mtop][i] = 0;
9D01AF24  A0400000   SB ZERO, 0(V0)
9D01AF28  24AF0001   ADDIU T7, A1, 1
9D01AF2C  032F4821   ADDU T1, T9, T7
9D01AF38  A0600000   SB ZERO, 0(V1)
9D01AF3C  25EB0001   ADDIU T3, T7, 1
9D01AF40  032B6021   ADDU T4, T9, T3
9D01AF4C  A3000000   SB ZERO, 0(T8)
9D01AF50  25ED0002   ADDIU T5, T7, 2
9D01AF54  032D7021   ADDU T6, T9, T5
9D01AF60  A0A00000   SB ZERO, 0(A1)
9D01AF64  25E20003   ADDIU V0, T7, 3
9D01AF68  03223821   ADDU A3, T9, V0
9D01AF74  A0C00000   SB ZERO, 0(A2)
9D01AF78  25E90004   ADDIU T1, T7, 4
9D01AF7C  03291821   ADDU V1, T9, T1
9D01AF88  A1600000   SB ZERO, 0(T3)
9D01AF8C  25EC0005   ADDIU T4, T7, 5
9D01AF90  032CC021   ADDU T8, T9, T4
9D01AF9C  A1A00000   SB ZERO, 0(T5)
9D01AFA0  25EE0006   ADDIU T6, T7, 6
9D01AFA4  032E2821   ADDU A1, T9, T6
9D01AFA8  A0AA0000   SB T2, 0(A1)
9D01AFAC  008E1021   ADDU V0, A0, T6
9D01AFB0  25E50007   ADDIU A1, T7, 7
9D01AFB4  14A8FFD8   BNE A1, T0, 0x9D01AF18
9D01AFB8  A0400000   SB ZERO, 0(V0)
9D01AFBC  03E00008   JR RA
9D01AFC0  00000000   NOP
9D01AFC4  838F8061   LB T7, -32671(GP)
9D01AFC8  000F48C0   SLL T1, T7, 3
9D01AFCC  000F1940   SLL V1, T7, 5
9D01AFD0  01235821   ADDU T3, T1, V1
9D01AFD4  3C0CA000   LUI T4, -24576
9D01AFD8  2598198C   ADDIU T8, T4, 6540
9D01AFDC  030BC821   ADDU T9, T8, T3
9D01AFE0  3C0DA000   LUI T5, -24576
9D01AFE4  25AE1644   ADDIU T6, T5, 5700
9D01AFE8  01CB2021   ADDU A0, T6, T3
9D01AFEC  00002821   ADDU A1, ZERO, ZERO
9D01AFF0  240A0020   ADDIU T2, ZERO, 32
9D01AFF4  0B406BC6   J 0x9D01AF18
9D01AFF8  24080028   ADDIU T0, ZERO, 40
9D01AFFC  1320FF82   BEQ T9, ZERO, 0x9D01AE08
9D01B000  24080001   ADDIU T0, ZERO, 1
9D01B004  13280017   BEQ T9, T0, 0x9D01B064
9D01B008  240D0002   ADDIU T5, ZERO, 2
9D01B00C  532D000C   BEQL T9, T5, 0x9D01B040
9D01B010  80880000   LB T0, 0(A0)
9D01B014  80B80001   LB T8, 1(A1)
9D01B018  00832821   ADDU A1, A0, V1
9D01B01C  00AFC821   ADDU T9, A1, T7
9D01B020  A3380028   SB T8, 40(T9)
9D01B024  81CE0001   LB T6, 1(T6)
9D01B028  00E31021   ADDU V0, A3, V1
9D01B02C  004F3021   ADDU A2, V0, T7
9D01B030  A0CE0028   SB T6, 40(A2)
9D01B034  24840001   ADDIU A0, A0, 1
9D01B038  24E70001   ADDIU A3, A3, 1
9D01B03C  80880000   LB T0, 0(A0)
9D01B040  00836821   ADDU T5, A0, V1
9D01B044  01AFC021   ADDU T8, T5, T7
9D01B048  A3080028   SB T0, 40(T8)
9D01B04C  80F90000   LB T9, 0(A3)
9D01B050  00E32821   ADDU A1, A3, V1
9D01B054  00AF7021   ADDU T6, A1, T7
9D01B058  A1D90028   SB T9, 40(T6)
9D01B05C  24840001   ADDIU A0, A0, 1
9D01B060  24E70001   ADDIU A3, A3, 1
9D01B064  80820000   LB V0, 0(A0)
9D01B068  00833021   ADDU A2, A0, V1
9D01B06C  00CF4021   ADDU T0, A2, T7
9D01B070  A1020028   SB V0, 40(T0)
9D01B074  80ED0000   LB T5, 0(A3)
9D01B078  00E3C021   ADDU T8, A3, V1
9D01B07C  030FC821   ADDU T9, T8, T7
9D01B080  A32D0028   SB T5, 40(T9)
9D01B084  24840001   ADDIU A0, A0, 1
9D01B088  1489FF5F   BNE A0, T1, 0x9D01AE08
9D01B08C  24E70001   ADDIU A3, A3, 1
9D01B090  0B406BAC   J 0x9D01AEB0
9D01B094  254AFFFF   ADDIU T2, T2, -1
487:                 		}
488:                 	}
489:                 
490:                 static void _video_scrolldown_lin(uint8_t line)
491:                 	{
492:                 	uint8_t i,j;
493:                 //  memmove(&disp_buffer[mtop+1], &disp_buffer[mtop], (mbottom-mtop)*DISP_BUFFER_WIDE);
494:                 //  memset(&disp_buffer[mtop], revvideo, DISP_BUFFER_WIDE);
495:                 	for (j=mbottom; j>(line); j--)
9D01C2B0  938A8060   LBU T2, -32672(GP)
9D01C2B4  018A402B   SLTU T0, T4, T2
9D01C2B8  110000A0   BEQ T0, ZERO, .LVL227, .LBE55
9D01C2BC  3C09A000   LUI T1, -24576
9D01C2C0  252B198C   ADDIU T3, T1, 6540
9D01C2C4  3C12A000   LUI S2, -24576
9D01C2C8  0B4070E1   J 0x9D01C384
9D01C2CC  264D1644   ADDIU T5, S2, 5700
9D01C374  254AFFFF   ADDIU T2, T2, -1
9D01C378  314A00FF   ANDI T2, T2, 255
9D01C37C  518A0070   BEQL T4, T2, 0x9D01C540
9D01C380  A3808070   SB ZERO, -32656(GP)
9D01C3D8  0B4070DE   J 0x9D01C378
9D01C3DC  254AFFFF   ADDIU T2, T2, -1
9D01C5EC  0B4070DE   J 0x9D01C378
9D01C5F0  254AFFFF   ADDIU T2, T2, -1
496:                 		{
497:                 		for (i=0; i<DISP_BUFFER_WIDE; i++)
9D01C36C  1482FFD8   BNE A0, V0, 0x9D01C2D0
9D01C370  26070003   ADDIU A3, S0, 3
9D01C3D0  14820061   BNE A0, V0, 0x9D01C558
9D01C3D4  26070001   ADDIU A3, S0, 1
9D01C5E4  1482FF3A   BNE A0, V0, 0x9D01C2D0
9D01C5E8  24E70001   ADDIU A3, A3, 1
498:                 			{
499:                 			disp_buffer[j][i] = disp_buffer[j-1][i];
9D01C2D0  80880000   LB T0, 0(A0)
9D01C2D4  00924821   ADDU T1, A0, S2
9D01C2D8  013F1821   ADDU V1, T1, RA
9D01C2DC  A0680028   SB T0, 40(V1)
9D01C2F8  80910001   LB S1, 1(A0)
9D01C2FC  01D2C021   ADDU T8, T6, S2
9D01C300  031FC821   ADDU T9, T8, RA
9D01C304  A3310028   SB S1, 40(T9)
9D01C320  81C60001   LB A2, 1(T6)
9D01C324  01322821   ADDU A1, T1, S2
9D01C328  00BF7821   ADDU T7, A1, RA
9D01C32C  A1E60028   SB A2, 40(T7)
9D01C348  81C80002   LB T0, 2(T6)
9D01C34C  00F24821   ADDU T1, A3, S2
9D01C350  013F1821   ADDU V1, T1, RA
9D01C354  A0680028   SB T0, 40(V1)
9D01C384  2543FFFF   ADDIU V1, T2, -1
9D01C388  000328C0   SLL A1, V1, 3
9D01C38C  00033140   SLL A2, V1, 5
9D01C390  00A62021   ADDU A0, A1, A2
9D01C394  01647821   ADDU T7, T3, A0
9D01C398  01A48021   ADDU S0, T5, A0
9D01C39C  000A70C0   SLL T6, T2, 3
9D01C3A0  000A8940   SLL S1, T2, 5
9D01C3A4  01D1F821   ADDU RA, T6, S1
9D01C3A8  017F1021   ADDU V0, T3, RA
9D01C3AC  000F3827   NOR A3, ZERO, T7
9D01C3B0  00E2C021   ADDU T8, A3, V0
9D01C3B4  33190003   ANDI T9, T8, 3
9D01C3B8  81E80000   LB T0, 0(T7)
9D01C3BC  A1E80028   SB T0, 40(T7)
9D01C568  5325000C   BEQL T9, A1, 0x9D01C59C
9D01C56C  80990000   LB T9, 0(A0)
9D01C570  81E60001   LB A2, 1(T7)
9D01C574  00927821   ADDU T7, A0, S2
9D01C578  01FF7021   ADDU T6, T7, RA
9D01C57C  A1C60028   SB A2, 40(T6)
9D01C598  80990000   LB T9, 0(A0)
9D01C59C  00924021   ADDU T0, A0, S2
9D01C5A0  011F4821   ADDU T1, T0, RA
9D01C5A4  A1390028   SB T9, 40(T1)
9D01C5C0  808F0000   LB T7, 0(A0)
9D01C5C4  00927021   ADDU T6, A0, S2
9D01C5C8  01DF8021   ADDU S0, T6, RA
9D01C5CC  A20F0028   SB T7, 40(S0)
500:                 			color_buffer[j][i] = color_buffer[j-1][i];
9D01C2E0  80E60000   LB A2, 0(A3)
9D01C2E4  02472821   ADDU A1, S2, A3
9D01C2E8  00BF7821   ADDU T7, A1, RA
9D01C2EC  A1E60028   SB A2, 40(T7)
9D01C2F0  248E0001   ADDIU T6, A0, 1
9D01C2F4  24F00001   ADDIU S0, A3, 1
9D01C308  80E70001   LB A3, 1(A3)
9D01C30C  02502021   ADDU A0, S2, S0
9D01C310  009F4021   ADDU T0, A0, RA
9D01C314  A1070028   SB A3, 40(T0)
9D01C318  25C90001   ADDIU T1, T6, 1
9D01C31C  26030001   ADDIU V1, S0, 1
9D01C330  82110001   LB S1, 1(S0)
9D01C334  0243C021   ADDU T8, S2, V1
9D01C338  031FC821   ADDU T9, T8, RA
9D01C33C  A3310028   SB S1, 40(T9)
9D01C340  25C70002   ADDIU A3, T6, 2
9D01C344  26040002   ADDIU A0, S0, 2
9D01C358  82060002   LB A2, 2(S0)
9D01C35C  02442821   ADDU A1, S2, A0
9D01C360  00BF7821   ADDU T7, A1, RA
9D01C364  A1E60028   SB A2, 40(T7)
9D01C368  25C40003   ADDIU A0, T6, 3
9D01C3C0  82090000   LB T1, 0(S0)
9D01C3C4  001F9023   SUBU S2, ZERO, RA
9D01C3C8  A2090028   SB T1, 40(S0)
9D01C3CC  25E40001   ADDIU A0, T7, 1
9D01C580  82100001   LB S0, 1(S0)
9D01C584  02478821   ADDU S1, S2, A3
9D01C588  023FC021   ADDU T8, S1, RA
9D01C58C  A3100028   SB S0, 40(T8)
9D01C590  24840001   ADDIU A0, A0, 1
9D01C594  24E70001   ADDIU A3, A3, 1
9D01C5A8  80E30000   LB V1, 0(A3)
9D01C5AC  02472821   ADDU A1, S2, A3
9D01C5B0  00BF3021   ADDU A2, A1, RA
9D01C5B4  A0C30028   SB V1, 40(A2)
9D01C5B8  24840001   ADDIU A0, A0, 1
9D01C5BC  24E70001   ADDIU A3, A3, 1
9D01C5D0  80F10000   LB S1, 0(A3)
9D01C5D4  0247C021   ADDU T8, S2, A3
9D01C5D8  031FC821   ADDU T9, T8, RA
9D01C5DC  A3310028   SB S1, 40(T9)
9D01C5E0  24840001   ADDIU A0, A0, 1
501:                 			}
502:                 		}
503:                 	/*
504:                 	for (i=0;i<DISP_BUFFER_WIDE;i++)
505:                 		{
506:                 		disp_buffer[mtop][i] = '-';
507:                 		}
508:                 	*/
509:                 	}
510:                 
511:                 
512:                 
513:                 void video_scrollup()
514:                 	{
9D01B3BC  27BDFFE8   ADDIU SP, SP, -24
9D01B3C0  AFBF0014   SW RA, 20(SP)
515:                 	CURSOR_INVERT();
516:                 	_video_scrollup();
9D01B3C4  0F406B07   JAL .Letext0, .LFE17, .LFB27, _video_scrollup, .Ltext0
9D01B3C8  00000000   NOP
9D01B8B8  0F406B07   JAL .Letext0, .LFE17, .LFB27, _video_scrollup, .Ltext0
9D01B8BC  00000000   NOP
517:                 	CURSOR_INVERT();
518:                 	}
9D01B3CC  8FBF0014   LW RA, 20(SP)
9D01B3D0  03E00008   JR RA
9D01B3D4  27BD0018   ADDIU SP, SP, 24
519:                 
520:                 void video_scrolldown()
521:                 	{
9D01B3D8  27BDFFE8   ADDIU SP, SP, -24
9D01B3DC  AFBF0014   SW RA, 20(SP)
522:                 	CURSOR_INVERT();
523:                 	_video_scrolldown();
9D01B3E0  0F406B7B   JAL .LFB29, _video_scrolldown, .LFE27
9D01B3E4  00000000   NOP
9D01B8E8  0F406B7B   JAL .LFB29, _video_scrolldown, .LFE27
9D01B8EC  00000000   NOP
524:                 	CURSOR_INVERT();
525:                 	}
9D01B3E8  8FBF0014   LW RA, 20(SP)
9D01B3EC  03E00008   JR RA
9D01B3F0  27BD0018   ADDIU SP, SP, 24
526:                 
527:                 void video_movesol()
528:                 	{
529:                 	CURSOR_INVERT();
530:                 	cx = 0;
9D01B3F4  03E00008   JR RA
9D01B3F8  A3808074   SB ZERO, -32652(GP)
9D01B8A4  A3808074   SB ZERO, -32652(GP)
9D01C20C  0B40714F   J .LVL227, .LBE55
9D01C210  A3808074   SB ZERO, -32652(GP)
9D01C228  0B40714F   J .LVL227, .LBE55
9D01C22C  A3808074   SB ZERO, -32652(GP)
9D01C230  0F406CB6   JAL escseq_get_param
9D01C234  24040001   ADDIU A0, ZERO, 1
9D01C238  244CFFFF   ADDIU T4, V0, -1
9D01C23C  0F406CFF   JAL video_setx
9D01C240  7C0C2420   SEB A0, T4
9D01C244  0B407150   J 0x9D01C540
9D01C248  A3808070   SB ZERO, -32656(GP)
9D01C24C  0F406CB6   JAL escseq_get_param
9D01C250  24040001   ADDIU A0, ZERO, 1
9D01C254  00409021   ADDU S2, V0, ZERO
9D01C258  0F406CB6   JAL escseq_get_param
9D01C25C  24040001   ADDIU A0, ZERO, 1
9D01C260  2442FFFF   ADDIU V0, V0, -1
9D01C264  264BFFFF   ADDIU T3, S2, -1
9D01C268  7C022420   SEB A0, V0
9D01C26C  0F406D09   JAL video_gotoxy
9D01C270  7C0B2C20   SEB A1, T3
9D01C274  0B407150   J 0x9D01C540
9D01C278  A3808070   SB ZERO, -32656(GP)
9D01C27C  0F406CB6   JAL escseq_get_param
9D01C280  00002021   ADDU A0, ZERO, ZERO
9D01C284  0F406E7F   JAL video_erase
9D01C288  00402021   ADDU A0, V0, ZERO
9D01C28C  0B407150   J 0x9D01C540
9D01C290  A3808070   SB ZERO, -32656(GP)
9D01C294  0F406CB6   JAL escseq_get_param
9D01C298  00002021   ADDU A0, ZERO, ZERO
9D01C29C  0F406F59   JAL video_eraseline
9D01C2A0  00402021   ADDU A0, V0, ZERO
9D01C2A4  0B407150   J 0x9D01C540
9D01C2A8  A3808070   SB ZERO, -32656(GP)
9D01C2AC  938C8073   LBU T4, -32653(GP)
9D01C2B0  938A8060   LBU T2, -32672(GP)
9D01C2B4  018A402B   SLTU T0, T4, T2
9D01C2B8  110000A0   BEQ T0, ZERO, .LVL227, .LBE55
9D01C2BC  3C09A000   LUI T1, -24576
9D01C2C0  252B198C   ADDIU T3, T1, 6540
9D01C2C4  3C12A000   LUI S2, -24576
9D01C2C8  0B4070E1   J 0x9D01C384
9D01C2CC  264D1644   ADDIU T5, S2, 5700
9D01C2D0  80880000   LB T0, 0(A0)
9D01C2D4  00924821   ADDU T1, A0, S2
9D01C2D8  013F1821   ADDU V1, T1, RA
9D01C2DC  A0680028   SB T0, 40(V1)
9D01C2E0  80E60000   LB A2, 0(A3)
9D01C2E4  02472821   ADDU A1, S2, A3
9D01C2E8  00BF7821   ADDU T7, A1, RA
9D01C2EC  A1E60028   SB A2, 40(T7)
9D01C2F0  248E0001   ADDIU T6, A0, 1
9D01C2F4  24F00001   ADDIU S0, A3, 1
9D01C2F8  80910001   LB S1, 1(A0)
9D01C2FC  01D2C021   ADDU T8, T6, S2
9D01C300  031FC821   ADDU T9, T8, RA
9D01C304  A3310028   SB S1, 40(T9)
9D01C308  80E70001   LB A3, 1(A3)
9D01C30C  02502021   ADDU A0, S2, S0
9D01C310  009F4021   ADDU T0, A0, RA
9D01C314  A1070028   SB A3, 40(T0)
9D01C318  25C90001   ADDIU T1, T6, 1
9D01C31C  26030001   ADDIU V1, S0, 1
9D01C320  81C60001   LB A2, 1(T6)
9D01C324  01322821   ADDU A1, T1, S2
9D01C328  00BF7821   ADDU T7, A1, RA
9D01C32C  A1E60028   SB A2, 40(T7)
9D01C330  82110001   LB S1, 1(S0)
9D01C334  0243C021   ADDU T8, S2, V1
9D01C338  031FC821   ADDU T9, T8, RA
9D01C33C  A3310028   SB S1, 40(T9)
9D01C340  25C70002   ADDIU A3, T6, 2
9D01C344  26040002   ADDIU A0, S0, 2
9D01C348  81C80002   LB T0, 2(T6)
9D01C34C  00F24821   ADDU T1, A3, S2
9D01C350  013F1821   ADDU V1, T1, RA
9D01C354  A0680028   SB T0, 40(V1)
9D01C358  82060002   LB A2, 2(S0)
9D01C35C  02442821   ADDU A1, S2, A0
9D01C360  00BF7821   ADDU T7, A1, RA
9D01C364  A1E60028   SB A2, 40(T7)
9D01C368  25C40003   ADDIU A0, T6, 3
9D01C36C  1482FFD8   BNE A0, V0, 0x9D01C2D0
9D01C370  26070003   ADDIU A3, S0, 3
9D01C374  254AFFFF   ADDIU T2, T2, -1
9D01C378  314A00FF   ANDI T2, T2, 255
9D01C37C  518A0070   BEQL T4, T2, 0x9D01C540
9D01C380  A3808070   SB ZERO, -32656(GP)
9D01C384  2543FFFF   ADDIU V1, T2, -1
9D01C388  000328C0   SLL A1, V1, 3
9D01C38C  00033140   SLL A2, V1, 5
9D01C390  00A62021   ADDU A0, A1, A2
9D01C394  01647821   ADDU T7, T3, A0
9D01C398  01A48021   ADDU S0, T5, A0
9D01C39C  000A70C0   SLL T6, T2, 3
9D01C3A0  000A8940   SLL S1, T2, 5
9D01C3A4  01D1F821   ADDU RA, T6, S1
9D01C3A8  017F1021   ADDU V0, T3, RA
9D01C3AC  000F3827   NOR A3, ZERO, T7
9D01C3B0  00E2C021   ADDU T8, A3, V0
9D01C3B4  33190003   ANDI T9, T8, 3
9D01C3B8  81E80000   LB T0, 0(T7)
9D01C3BC  A1E80028   SB T0, 40(T7)
9D01C3C0  82090000   LB T1, 0(S0)
9D01C3C4  001F9023   SUBU S2, ZERO, RA
9D01C3C8  A2090028   SB T1, 40(S0)
9D01C3CC  25E40001   ADDIU A0, T7, 1
9D01C3D0  14820061   BNE A0, V0, 0x9D01C558
9D01C3D4  26070001   ADDIU A3, S0, 1
9D01C3D8  0B4070DE   J 0x9D01C378
9D01C3DC  254AFFFF   ADDIU T2, T2, -1
9D01C3E0  939F8073   LBU RA, -32653(GP)
9D01C3E4  27E20001   ADDIU V0, RA, 1
9D01C3E8  304700FF   ANDI A3, V0, 255
9D01C3EC  83838060   LB V1, -32672(GP)
9D01C3F0  24690001   ADDIU T1, V1, 1
9D01C3F4  00E9282A   SLT A1, A3, T1
9D01C3F8  10A00050   BEQ A1, ZERO, .LVL227, .LBE55
9D01C3FC  00E0C021   ADDU T8, A3, ZERO
9D01C400  3C06A000   LUI A2, -24576
9D01C404  24C8198C   ADDIU T0, A2, 6540
9D01C408  3C04A000   LUI A0, -24576
9D01C40C  248B1644   ADDIU T3, A0, 5700
9D01C410  0B40712F   J 0x9D01C4BC
9D01C414  250A0028   ADDIU T2, T0, 40
9D01C418  91F00000   LBU S0, 0(T7)
9D01C41C  A1F0FFD8   SB S0, -40(T7)
9D01C420  93110000   LBU S1, 0(T8)
9D01C424  A311FFD8   SB S1, -40(T8)
9D01C428  25F20001   ADDIU S2, T7, 1
9D01C42C  91FF0001   LBU RA, 1(T7)
9D01C430  A25FFFD8   SB RA, -40(S2)
9D01C434  93020001   LBU V0, 1(T8)
9D01C438  A302FFD9   SB V0, -39(T8)
9D01C43C  92430001   LBU V1, 1(S2)
9D01C440  A243FFD9   SB V1, -39(S2)
9D01C444  93050002   LBU A1, 2(T8)
9D01C448  A305FFDA   SB A1, -38(T8)
9D01C44C  92460002   LBU A2, 2(S2)
9D01C450  A246FFDA   SB A2, -38(S2)
9D01C454  93040003   LBU A0, 3(T8)
9D01C458  A304FFDB   SB A0, -37(T8)
9D01C45C  924C0003   LBU T4, 3(S2)
9D01C460  A24CFFDB   SB T4, -37(S2)
9D01C464  930D0004   LBU T5, 4(T8)
9D01C468  A30DFFDC   SB T5, -36(T8)
9D01C46C  924E0004   LBU T6, 4(S2)
9D01C470  A24EFFDC   SB T6, -36(S2)
9D01C474  930F0005   LBU T7, 5(T8)
9D01C478  A30FFFDD   SB T7, -35(T8)
9D01C47C  92500005   LBU S0, 5(S2)
9D01C480  A250FFDD   SB S0, -35(S2)
9D01C484  93110006   LBU S1, 6(T8)
9D01C488  A311FFDE   SB S1, -34(T8)
9D01C48C  925F0006   LBU RA, 6(S2)
9D01C490  A25FFFDE   SB RA, -34(S2)
9D01C494  93020007   LBU V0, 7(T8)
9D01C498  A302FFDF   SB V0, -33(T8)
9D01C49C  264F0007   ADDIU T7, S2, 7
9D01C4A0  15F9FFDD   BNE T7, T9, 0x9D01C418
9D01C4A4  27180008   ADDIU T8, T8, 8
9D01C4A8  24E70001   ADDIU A3, A3, 1
9D01C4AC  30E700FF   ANDI A3, A3, 255
9D01C4B0  00E9C82A   SLT T9, A3, T1
9D01C4B4  13200021   BEQ T9, ZERO, .LVL227, .LBE55
9D01C4B8  00E0C021   ADDU T8, A3, ZERO
9D01C4BC  001860C0   SLL T4, T8, 3
9D01C4C0  00186940   SLL T5, T8, 5
9D01C4C4  018D7021   ADDU T6, T4, T5
9D01C4C8  010E7821   ADDU T7, T0, T6
9D01C4CC  016EC021   ADDU T8, T3, T6
9D01C4D0  0B407106   J 0x9D01C418
9D01C4D4  014EC821   ADDU T9, T2, T6
9D01C4D8  0F406CB6   JAL escseq_get_param
9D01C4DC  00002021   ADDU A0, ZERO, ZERO
9D01C4E0  50400007   BEQL V0, ZERO, 0x9D01C500
9D01C4E4  A3808068   SB ZERO, -32664(GP)
9D01C4E8  14500003   BNE V0, S0, 0x9D01C4F8
9D01C4EC  00000000   NOP
9D01C4F0  0B407140   J 0x9D01C500
9D01C4F4  A3808068   SB ZERO, -32664(GP)
9D01C4F8  50510001   BEQL V0, S1, 0x9D01C500
9D01C4FC  A3928068   SB S2, -32664(GP)
9D01C500  8F99806C   LW T9, -32660(GP)
9D01C504  1720FFF4   BNE T9, ZERO, .LBE53, .LBE52
9D01C508  00000000   NOP
9D01C50C  0B407150   J 0x9D01C540
9D01C510  A3808070   SB ZERO, -32656(GP)
9D01C514  0F406CB6   JAL escseq_get_param
9D01C518  24040001   ADDIU A0, ZERO, 1
9D01C51C  00408821   ADDU S1, V0, ZERO
9D01C520  0F406CB6   JAL escseq_get_param
9D01C524  24040014   ADDIU A0, ZERO, 20
9D01C528  2632FFFF   ADDIU S2, S1, -1
9D01C52C  2458FFFF   ADDIU T8, V0, -1
9D01C530  7C122420   SEB A0, S2
9D01C534  0F406D1B   JAL video_set_margins
9D01C538  7C182C20   SEB A1, T8
9D01C53C  A3808070   SB ZERO, -32656(GP)
9D01C540  8FBF001C   LW RA, 28(SP)
9D01C544  8FB20018   LW S2, 24(SP)
9D01C548  8FB10014   LW S1, 20(SP)
9D01C54C  8FB00010   LW S0, 16(SP)
9D01C550  03E00008   JR RA
9D01C554  27BD0020   ADDIU SP, SP, 32
9D01C558  1320FF5D   BEQ T9, ZERO, 0x9D01C2D0
9D01C55C  24030001   ADDIU V1, ZERO, 1
9D01C560  13230017   BEQ T9, V1, 0x9D01C5C0
9D01C564  24050002   ADDIU A1, ZERO, 2
9D01C568  5325000C   BEQL T9, A1, 0x9D01C59C
9D01C56C  80990000   LB T9, 0(A0)
9D01C570  81E60001   LB A2, 1(T7)
9D01C574  00927821   ADDU T7, A0, S2
9D01C578  01FF7021   ADDU T6, T7, RA
9D01C57C  A1C60028   SB A2, 40(T6)
9D01C580  82100001   LB S0, 1(S0)
9D01C584  02478821   ADDU S1, S2, A3
9D01C588  023FC021   ADDU T8, S1, RA
9D01C58C  A3100028   SB S0, 40(T8)
9D01C590  24840001   ADDIU A0, A0, 1
9D01C594  24E70001   ADDIU A3, A3, 1
9D01C598  80990000   LB T9, 0(A0)
9D01C59C  00924021   ADDU T0, A0, S2
9D01C5A0  011F4821   ADDU T1, T0, RA
9D01C5A4  A1390028   SB T9, 40(T1)
9D01C5A8  80E30000   LB V1, 0(A3)
9D01C5AC  02472821   ADDU A1, S2, A3
9D01C5B0  00BF3021   ADDU A2, A1, RA
9D01C5B4  A0C30028   SB V1, 40(A2)
9D01C5B8  24840001   ADDIU A0, A0, 1
9D01C5BC  24E70001   ADDIU A3, A3, 1
9D01C5C0  808F0000   LB T7, 0(A0)
9D01C5C4  00927021   ADDU T6, A0, S2
9D01C5C8  01DF8021   ADDU S0, T6, RA
9D01C5CC  A20F0028   SB T7, 40(S0)
9D01C5D0  80F10000   LB S1, 0(A3)
9D01C5D4  0247C021   ADDU T8, S2, A3
9D01C5D8  031FC821   ADDU T9, T8, RA
9D01C5DC  A3310028   SB S1, 40(T9)
9D01C5E0  24840001   ADDIU A0, A0, 1
9D01C5E4  1482FF3A   BNE A0, V0, 0x9D01C2D0
9D01C5E8  24E70001   ADDIU A3, A3, 1
9D01C5EC  0B4070DE   J 0x9D01C378
9D01C5F0  254AFFFF   ADDIU T2, T2, -1
531:                 	CURSOR_INVERT();
532:                 	}
533:                 
534:                 void video_setx(int8_t x)
535:                 	{
536:                 	CURSOR_INVERT();
537:                 	cx = x;
538:                 	if (cx < 0) cx = 0;
9D01B3FC  04810003   BGEZ A0, 0x9D01B40C
9D01B400  A3848074   SB A0, -32652(GP)
9D01B404  03E00008   JR RA
9D01B408  A3808074   SB ZERO, -32652(GP)
539:                 	if (cx >= DISP_BUFFER_WIDE) cx = DISP_BUFFER_WIDE-1;
9D01B40C  28840028   SLTI A0, A0, 40
9D01B410  14800002   BNE A0, ZERO, 0x9D01B41C
9D01B414  24020027   ADDIU V0, ZERO, 39
9D01B418  A3828074   SB V0, -32652(GP)
9D01B41C  03E00008   JR RA
9D01B420  00000000   NOP
540:                 	CURSOR_INVERT();
541:                 	}
542:                 
543:                 /* Absolute positioning does not respect top/bottom margins */
544:                 void video_gotoxy(int8_t x, int8_t y)
545:                 	{
546:                 	CURSOR_INVERT();
547:                 	cx = x;
548:                 	if (cx < 0) cx = 0;
9D01B424  04810003   BGEZ A0, 0x9D01B434
9D01B428  A3848074   SB A0, -32652(GP)
9D01B42C  0B406D11   J 0x9D01B444
9D01B430  A3808074   SB ZERO, -32652(GP)
549:                 	if (cx >= DISP_BUFFER_WIDE) cx = DISP_BUFFER_WIDE-1;
9D01B434  28840028   SLTI A0, A0, 40
9D01B438  14800002   BNE A0, ZERO, 0x9D01B444
9D01B43C  24020027   ADDIU V0, ZERO, 39
9D01B440  A3828074   SB V0, -32652(GP)
550:                 	cy = y;
551:                 	if (cy < 0) cy = 0;
9D01B444  04A10003   BGEZ A1, 0x9D01B454
9D01B448  A3858073   SB A1, -32653(GP)
9D01B44C  03E00008   JR RA
9D01B450  A3808073   SB ZERO, -32653(GP)
552:                 	if (cy >= DISP_BUFFER_HIGH) cy = DISP_BUFFER_HIGH-1;
9D01B454  28A50014   SLTI A1, A1, 20
9D01B458  14A00002   BNE A1, ZERO, 0x9D01B464
9D01B45C  24030013   ADDIU V1, ZERO, 19
9D01B460  A3838073   SB V1, -32653(GP)
9D01B464  03E00008   JR RA
9D01B468  00000000   NOP
553:                 	CURSOR_INVERT();
554:                 	}
555:                 
556:                 void video_movex(int8_t dx)
557:                 	{
558:                 	CURSOR_INVERT();
559:                 	cx += dx;
9D01B52C  93828074   LBU V0, -32652(GP)
9D01B530  00822021   ADDU A0, A0, V0
9D01B534  7C041C20   SEB V1, A0
560:                 	if (cx < 0) cx = 0;
9D01B538  04610003   BGEZ V1, 0x9D01B548
9D01B53C  A3838074   SB V1, -32652(GP)
9D01B540  03E00008   JR RA
9D01B544  A3808074   SB ZERO, -32652(GP)
561:                 	if (cx >= DISP_BUFFER_WIDE) cx = DISP_BUFFER_WIDE-1;
9D01B548  28650028   SLTI A1, V1, 40
9D01B54C  14A00002   BNE A1, ZERO, 0x9D01B558
9D01B550  24060027   ADDIU A2, ZERO, 39
9D01B554  A3868074   SB A2, -32652(GP)
9D01B558  03E00008   JR RA
9D01B55C  00000000   NOP
562:                 	CURSOR_INVERT();
563:                 	}
564:                 
565:                 void video_movey(int8_t dy)
566:                 	{
567:                 	CURSOR_INVERT();
568:                 	cy += dy;
9D01B560  93828073   LBU V0, -32653(GP)
9D01B564  00822021   ADDU A0, A0, V0
9D01B568  7C041C20   SEB V1, A0
9D01B56C  A3838073   SB V1, -32653(GP)
569:                 	if (cy < mtop) cy = mtop;
9D01B570  83858061   LB A1, -32671(GP)
9D01B574  0065302A   SLT A2, V1, A1
9D01B578  54C00001   BNEL A2, ZERO, 0x9D01B580
9D01B57C  A3858073   SB A1, -32653(GP)
570:                 	if (cy > mbottom) cy = mbottom;
9D01B580  83878060   LB A3, -32672(GP)
9D01B584  83888073   LB T0, -32653(GP)
9D01B588  00E8482A   SLT T1, A3, T0
9D01B58C  55200001   BNEL T1, ZERO, 0x9D01B594
9D01B590  A3878073   SB A3, -32653(GP)
9D01B594  03E00008   JR RA
9D01B598  00000000   NOP
571:                 	CURSOR_INVERT();
572:                 	}
573:                 
574:                 static void _video_lfwd()
575:                 	{
9D01B098  27BDFFE8   ADDIU SP, SP, -24
9D01B09C  AFBF0014   SW RA, 20(SP)
576:                 	cx = 0;
9D01B0A0  A3808074   SB ZERO, -32652(GP)
577:                 	if (++cy > mbottom)
9D01B0A4  93828073   LBU V0, -32653(GP)
9D01B0A8  24430001   ADDIU V1, V0, 1
9D01B0AC  7C032420   SEB A0, V1
9D01B0B0  A3848073   SB A0, -32653(GP)
9D01B0B4  83858060   LB A1, -32672(GP)
9D01B0B8  00A4302A   SLT A2, A1, A0
9D01B0BC  10C00004   BEQ A2, ZERO, 0x9D01B0D0
9D01B0C0  8FBF0014   LW RA, 20(SP)
578:                 		{
579:                 		cy = mbottom;
580:                 		_video_scrollup();
9D01B0C4  0F406B07   JAL .Letext0, .LFE17, .LFB27, _video_scrollup, .Ltext0
9D01B0C8  A3858073   SB A1, -32653(GP)
581:                 		}
582:                 	}
9D01B0CC  8FBF0014   LW RA, 20(SP)
9D01B0D0  03E00008   JR RA
9D01B0D4  27BD0018   ADDIU SP, SP, 24
583:                 
584:                 static void _video_cfwd()
585:                 	{
9D01B0D8  27BDFFE8   ADDIU SP, SP, -24
9D01B0DC  AFBF0014   SW RA, 20(SP)
586:                 	if (++cx > DISP_BUFFER_WIDE)
9D01B0E0  93828074   LBU V0, -32652(GP)
9D01B0E4  24430001   ADDIU V1, V0, 1
9D01B0E8  7C032420   SEB A0, V1
9D01B0EC  28850029   SLTI A1, A0, 41
9D01B0F0  14A00003   BNE A1, ZERO, .LVL49
9D01B0F4  A3848074   SB A0, -32652(GP)
587:                 		_video_lfwd();
9D01B0F8  0F406C26   JAL .LFB38, _video_lfwd, .LFE29
9D01B0FC  00000000   NOP
588:                 	}
9D01B100  8FBF0014   LW RA, 20(SP)
9D01B104  03E00008   JR RA
9D01B108  27BD0018   ADDIU SP, SP, 24
589:                 
590:                 void video_cfwd()
591:                 	{
9D01B59C  27BDFFE8   ADDIU SP, SP, -24
9D01B5A0  AFBF0014   SW RA, 20(SP)
592:                 	CURSOR_INVERT();
593:                 	_video_cfwd();
9D01B5A4  0F406C36   JAL .LFB39, _video_cfwd, .LFE38
9D01B5A8  00000000   NOP
594:                 	CURSOR_INVERT();
595:                 	}
9D01B5AC  8FBF0014   LW RA, 20(SP)
9D01B5B0  03E00008   JR RA
9D01B5B4  27BD0018   ADDIU SP, SP, 24
596:                 
597:                 void video_lfwd()
598:                 	{
9D01B5B8  27BDFFE8   ADDIU SP, SP, -24
9D01B5BC  AFBF0014   SW RA, 20(SP)
599:                 	CURSOR_INVERT();
600:                 	cx = 0;
9D01B5C0  A3808074   SB ZERO, -32652(GP)
601:                 	if (++cy > mbottom)
9D01B5C4  93828073   LBU V0, -32653(GP)
9D01B5C8  24430001   ADDIU V1, V0, 1
9D01B5CC  7C032420   SEB A0, V1
9D01B5D0  A3848073   SB A0, -32653(GP)
9D01B5D4  83858060   LB A1, -32672(GP)
9D01B5D8  00A4302A   SLT A2, A1, A0
9D01B5DC  10C00004   BEQ A2, ZERO, 0x9D01B5F0
9D01B5E0  8FBF0014   LW RA, 20(SP)
602:                 		{
603:                 		cy = mbottom;
604:                 		_video_scrollup();
9D01B5E4  0F406B07   JAL .Letext0, .LFE17, .LFB27, _video_scrollup, .Ltext0
9D01B5E8  A3858073   SB A1, -32653(GP)
605:                 		}
606:                 	CURSOR_INVERT();
607:                 	}
9D01B5EC  8FBF0014   LW RA, 20(SP)
9D01B5F0  03E00008   JR RA
9D01B5F4  27BD0018   ADDIU SP, SP, 24
608:                 
609:                 void video_lf()
610:                 	{
9D01B5F8  27BDFFE8   ADDIU SP, SP, -24
9D01B5FC  AFBF0014   SW RA, 20(SP)
611:                 	CURSOR_INVERT();
612:                 	if (++cy > mbottom)
9D01B600  93828073   LBU V0, -32653(GP)
9D01B604  24430001   ADDIU V1, V0, 1
9D01B608  7C032420   SEB A0, V1
9D01B60C  A3848073   SB A0, -32653(GP)
9D01B610  83858060   LB A1, -32672(GP)
9D01B614  00A4302A   SLT A2, A1, A0
9D01B618  10C00004   BEQ A2, ZERO, 0x9D01B62C
9D01B61C  8FBF0014   LW RA, 20(SP)
613:                 		{
614:                 		cy = mbottom;
615:                 		_video_scrollup();
9D01B620  0F406B07   JAL .Letext0, .LFE17, .LFB27, _video_scrollup, .Ltext0
9D01B624  A3858073   SB A1, -32653(GP)
616:                 		}
617:                 	CURSOR_INVERT();
618:                 	}
9D01B628  8FBF0014   LW RA, 20(SP)
9D01B62C  03E00008   JR RA
9D01B630  27BD0018   ADDIU SP, SP, 24
619:                 
620:                 static void _video_lback()
621:                 	{
622:                 	cx = DISP_BUFFER_WIDE-1;
9D01B680  A3858074   SB A1, -32652(GP)
623:                 	if (--cy < 0)
9D01B684  93868073   LBU A2, -32653(GP)
624:                 		{
625:                 		cx = 0;
9D01B698  A3808074   SB ZERO, -32652(GP)
626:                 		cy = mtop;
9D01B69C  93898061   LBU T1, -32671(GP)
9D01B6A0  A3898073   SB T1, -32653(GP)
9D01B6A4  03E00008   JR RA
9D01B6A8  00000000   NOP
627:                 		}
628:                 	}
629:                 
630:                 void video_lback()
631:                 	{
632:                 	CURSOR_INVERT();
633:                 	cx = DISP_BUFFER_WIDE-1;
9D01B634  24020027   ADDIU V0, ZERO, 39
9D01B638  A3828074   SB V0, -32652(GP)
634:                 	if (--cy < 0)
9D01B63C  93838073   LBU V1, -32653(GP)
9D01B640  2464FFFF   ADDIU A0, V1, -1
9D01B644  7C042C20   SEB A1, A0
9D01B648  04A10004   BGEZ A1, 0x9D01B65C
9D01B64C  A3858073   SB A1, -32653(GP)
635:                 		{
636:                 		cx = 0;
9D01B650  A3808074   SB ZERO, -32652(GP)
637:                 		cy = mtop;
9D01B654  93868061   LBU A2, -32671(GP)
9D01B658  A3868073   SB A2, -32653(GP)
9D01B65C  03E00008   JR RA
9D01B660  00000000   NOP
638:                 		}
639:                 	CURSOR_INVERT();
640:                 	}
641:                 
642:                 void video_cback()
643:                 	{
644:                 	CURSOR_INVERT();
645:                 	if (--cx < 0)
9D01B664  93828074   LBU V0, -32652(GP)
9D01B668  2443FFFF   ADDIU V1, V0, -1
9D01B66C  7C032420   SEB A0, V1
9D01B670  04800003   BLTZ A0, .LBB9
9D01B674  24050027   ADDIU A1, ZERO, 39
9D01B678  03E00008   JR RA
9D01B67C  A3848074   SB A0, -32652(GP)
9D01B680  A3858074   SB A1, -32652(GP)
9D01B684  93868073   LBU A2, -32653(GP)
9D01B688  24C7FFFF   ADDIU A3, A2, -1
9D01B68C  7C074420   SEB T0, A3
9D01B690  05010004   BGEZ T0, 0x9D01B6A4
9D01B694  A3888073   SB T0, -32653(GP)
9D01B698  A3808074   SB ZERO, -32652(GP)
9D01B69C  93898061   LBU T1, -32671(GP)
9D01B6A0  A3898073   SB T1, -32653(GP)
9D01B6A4  03E00008   JR RA
9D01B6A8  00000000   NOP
646:                 		_video_lback();
647:                 	CURSOR_INVERT();
648:                 	}
649:                 
650:                 int8_t video_getx()
651:                 	{
652:                 	return cx;
653:                 	}
9D01B6AC  03E00008   JR RA
9D01B6B0  83828074   LB V0, -32652(GP)
654:                 
655:                 int8_t video_gety(void)
656:                 	{
657:                 	return cy;
658:                 	}
9D01B6B4  03E00008   JR RA
9D01B6B8  83828073   LB V0, -32653(GP)
659:                 
660:                 int8_t video_charat(int8_t x, int8_t y)
661:                 	{
662:                 	return disp_buffer[cy][cx];
9D01B6BC  83828073   LB V0, -32653(GP)
9D01B6C0  83838074   LB V1, -32652(GP)
9D01B6C4  000220C0   SLL A0, V0, 3
9D01B6C8  00022940   SLL A1, V0, 5
9D01B6CC  00853021   ADDU A2, A0, A1
9D01B6D0  00C33821   ADDU A3, A2, V1
9D01B6D4  3C08A000   LUI T0, -24576
9D01B6D8  2509198C   ADDIU T1, T0, 6540
9D01B6DC  00E95021   ADDU T2, A3, T1
663:                 	}
9D01B6E0  03E00008   JR RA
9D01B6E4  81420000   LB V0, 0(T2)
664:                 
665:                 void video_clrscr()
666:                 	{
9D01B6E8  27BDFFE8   ADDIU SP, SP, -24
9D01B6EC  AFBF0014   SW RA, 20(SP)
667:                 	CURSOR_INVERT();
668:                 	video_reset_margins();
9D01B6F0  0F406D30   JAL video_reset_margins
9D01B6F4  00000000   NOP
669:                 	memset(disp_buffer, revvideo, DISP_BUFFER_WIDE*DISP_BUFFER_HIGH);
9D01B6F8  3C04A000   LUI A0, -24576
9D01B6FC  2484198C   ADDIU A0, A0, 6540
9D01B700  93858068   LBU A1, -32664(GP)
9D01B704  0F4100B4   JAL .Letext0, .LFE0, memset
9D01B708  24060320   ADDIU A2, ZERO, 800
670:                 	memset(color_buffer, 0, DISP_BUFFER_WIDE*DISP_BUFFER_HIGH);
9D01B70C  3C02A000   LUI V0, -24576
9D01B710  24441644   ADDIU A0, V0, 5700
9D01B714  00002821   ADDU A1, ZERO, ZERO
9D01B718  0F4100B4   JAL .Letext0, .LFE0, memset
9D01B71C  24060320   ADDIU A2, ZERO, 800
671:                 	cx = cy = 0;
9D01B720  A3808073   SB ZERO, -32653(GP)
9D01B724  A3808074   SB ZERO, -32652(GP)
672:                 	CURSOR_INVERT();
673:                 	}
9D01B728  8FBF0014   LW RA, 20(SP)
9D01B72C  03E00008   JR RA
9D01B730  27BD0018   ADDIU SP, SP, 24
674:                 
675:                 void video_clrline()
676:                 	{
9D01B928  27BDFFE8   ADDIU SP, SP, -24
9D01B92C  AFBF0014   SW RA, 20(SP)
9D01B930  AFB00010   SW S0, 16(SP)
677:                 	CURSOR_INVERT();
678:                 	memset(&disp_buffer[cy], revvideo, DISP_BUFFER_WIDE);
9D01B934  83828073   LB V0, -32653(GP)
9D01B938  000280C0   SLL S0, V0, 3
9D01B93C  00021940   SLL V1, V0, 5
9D01B940  02038021   ADDU S0, S0, V1
9D01B944  3C04A000   LUI A0, -24576
9D01B948  2485198C   ADDIU A1, A0, 6540
9D01B94C  00B02021   ADDU A0, A1, S0
9D01B950  93858068   LBU A1, -32664(GP)
9D01B954  0F4100B4   JAL .Letext0, .LFE0, memset
9D01B958  24060028   ADDIU A2, ZERO, 40
679:                 	memset(&color_buffer[cy], 0, DISP_BUFFER_WIDE);
9D01B95C  3C06A000   LUI A2, -24576
9D01B960  24C71644   ADDIU A3, A2, 5700
9D01B964  00F02021   ADDU A0, A3, S0
9D01B968  00002821   ADDU A1, ZERO, ZERO
9D01B96C  0F4100B4   JAL .Letext0, .LFE0, memset
9D01B970  24060028   ADDIU A2, ZERO, 40
680:                 	cx = 0;
9D01B974  A3808074   SB ZERO, -32652(GP)
681:                 	CURSOR_INVERT();
682:                 	}
9D01B978  8FBF0014   LW RA, 20(SP)
9D01B97C  8FB00010   LW S0, 16(SP)
9D01B980  03E00008   JR RA
9D01B984  27BD0018   ADDIU SP, SP, 24
683:                 
684:                 void video_clreol()
685:                 	{
9D01B988  27BDFFE0   ADDIU SP, SP, -32
9D01B98C  AFBF001C   SW RA, 28(SP)
9D01B990  AFB10018   SW S1, 24(SP)
9D01B994  AFB00014   SW S0, 20(SP)
686:                 	memset(&disp_buffer[cy][cx], revvideo, DISP_BUFFER_WIDE-cx);
9D01B998  83838073   LB V1, -32653(GP)
9D01B99C  83828074   LB V0, -32652(GP)
9D01B9A0  24100028   ADDIU S0, ZERO, 40
9D01B9A4  02028023   SUBU S0, S0, V0
9D01B9A8  000388C0   SLL S1, V1, 3
9D01B9AC  00032140   SLL A0, V1, 5
9D01B9B0  02242821   ADDU A1, S1, A0
9D01B9B4  00A28821   ADDU S1, A1, V0
9D01B9B8  3C06A000   LUI A2, -24576
9D01B9BC  24C7198C   ADDIU A3, A2, 6540
9D01B9C0  00F12021   ADDU A0, A3, S1
9D01B9C4  93858068   LBU A1, -32664(GP)
9D01B9C8  0F4100B4   JAL .Letext0, .LFE0, memset
9D01B9CC  02003021   ADDU A2, S0, ZERO
687:                 	memset(&color_buffer[cy][cx], 0, DISP_BUFFER_WIDE-cx);
9D01B9D0  3C08A000   LUI T0, -24576
9D01B9D4  25091644   ADDIU T1, T0, 5700
9D01B9D8  01312021   ADDU A0, T1, S1
9D01B9DC  00002821   ADDU A1, ZERO, ZERO
9D01B9E0  0F4100B4   JAL .Letext0, .LFE0, memset
9D01B9E4  02003021   ADDU A2, S0, ZERO
688:                 	}
9D01B9E8  8FBF001C   LW RA, 28(SP)
9D01B9EC  8FB10018   LW S1, 24(SP)
9D01B9F0  8FB00014   LW S0, 20(SP)
9D01B9F4  03E00008   JR RA
9D01B9F8  27BD0020   ADDIU SP, SP, 32
689:                 
690:                 void video_erase(uint8_t erasemode)
691:                 	{
692:                 	uint8_t x,y;
693:                 	CURSOR_INVERT();
694:                 	switch(erasemode)
9D01B9FC  24020001   ADDIU V0, ZERO, 1
9D01BA00  1082000C   BEQ A0, V0, 0x9D01BA34
9D01BA04  838C8074   LB T4, -32652(GP)
9D01BA08  10800015   BEQ A0, ZERO, 0x9D01BA60
9D01BA0C  24030002   ADDIU V1, ZERO, 2
9D01BA10  1483005C   BNE A0, V1, 0x9D01BB84
9D01BA14  3C04A000   LUI A0, -24576
9D01BA18  2483198C   ADDIU V1, A0, 6540
9D01BA1C  3C05A000   LUI A1, -24576
9D01BA20  24A51644   ADDIU A1, A1, 5700
9D01BA24  24690028   ADDIU T1, V1, 40
695:                 		{
696:                 		case 0: /* erase from cursor to end of screen */
697:                 //jar
698:                 //      memset(&disp_buffer[cy][cx], revvideo,
699:                 //          (DISP_BUFFER_WIDE*DISP_BUFFER_HIGH)-(cy*DISP_BUFFER_WIDE+cx));
700:                 			for (x=cx; x<DISP_BUFFER_WIDE; x++)
9D01BA60  93838074   LBU V1, -32652(GP)
9D01BA64  2C6A0028   SLTIU T2, V1, 40
9D01BA68  11400046   BEQ T2, ZERO, 0x9D01BB84
9D01BA6C  938C8073   LBU T4, -32653(GP)
9D01BA8C  240A0028   ADDIU T2, ZERO, 40
9D01BAC8  0B406EDE   J 0x9D01BB78
9D01BACC  24630001   ADDIU V1, V1, 1
9D01BB74  24630001   ADDIU V1, V1, 1
9D01BB78  306300FF   ANDI V1, V1, 255
9D01BB7C  146AFFC4   BNE V1, T2, 0x9D01BA90
9D01BB80  00000000   NOP
9D01BB84  03E00008   JR RA
9D01BB88  00000000   NOP
9D01BD5C  0B406EDE   J 0x9D01BB78
9D01BD60  24630001   ADDIU V1, V1, 1
701:                 				for (y=cy; y<DISP_BUFFER_HIGH; y++)
9D01BA70  2D8B0014   SLTIU T3, T4, 20
9D01BA88  24090014   ADDIU T1, ZERO, 20
9D01BA90  11600038   BEQ T3, ZERO, 0x9D01BB74
9D01BA94  000C3827   NOR A3, ZERO, T4
9D01BA98  30EF0003   ANDI T7, A3, 3
9D01BAB8  258E0001   ADDIU T6, T4, 1
9D01BABC  31C200FF   ANDI V0, T6, 255
9D01BAC0  14490080   BNE V0, T1, 0x9D01BCC4
9D01BAC4  A0E00000   SB ZERO, 0(A3)
9D01BAF0  24580001   ADDIU T8, V0, 1
9D01BAF4  330200FF   ANDI V0, T8, 255
9D01BB18  24580001   ADDIU T8, V0, 1
9D01BB1C  330200FF   ANDI V0, T8, 255
9D01BB40  24580001   ADDIU T8, V0, 1
9D01BB44  330200FF   ANDI V0, T8, 255
9D01BB64  24580001   ADDIU T8, V0, 1
9D01BB68  330200FF   ANDI V0, T8, 255
9D01BB6C  1449FFD8   BNE V0, T1, 0x9D01BAD0
9D01BB70  A1A00000   SB ZERO, 0(T5)
9D01BD00  24420001   ADDIU V0, V0, 1
9D01BD04  304200FF   ANDI V0, V0, 255
9D01BD28  24590001   ADDIU T9, V0, 1
9D01BD2C  332200FF   ANDI V0, T9, 255
9D01BD4C  24420001   ADDIU V0, V0, 1
9D01BD50  304200FF   ANDI V0, V0, 255
9D01BD54  1449FF5E   BNE V0, T1, 0x9D01BAD0
9D01BD58  A3000000   SB ZERO, 0(T8)
702:                 					{
703:                 					disp_buffer[y][x] = ' ';
9D01BA74  3C08A000   LUI T0, -24576
9D01BA78  2506198C   ADDIU A2, T0, 6540
9D01BA7C  24050020   ADDIU A1, ZERO, 32
9D01BA9C  000C68C0   SLL T5, T4, 3
9D01BAA0  000CC140   SLL T8, T4, 5
9D01BAA4  01B8C821   ADDU T9, T5, T8
9D01BAA8  03231021   ADDU V0, T9, V1
9D01BAAC  00464021   ADDU T0, V0, A2
9D01BAB0  A1050000   SB A1, 0(T0)
9D01BAD0  0002C8C0   SLL T9, V0, 3
9D01BAD4  00024140   SLL T0, V0, 5
9D01BAD8  03287021   ADDU T6, T9, T0
9D01BADC  01C33821   ADDU A3, T6, V1
9D01BAE0  00E67821   ADDU T7, A3, A2
9D01BAE4  A1E50000   SB A1, 0(T7)
9D01BAF8  0002C8C0   SLL T9, V0, 3
9D01BAFC  00024140   SLL T0, V0, 5
9D01BB00  03287021   ADDU T6, T9, T0
9D01BB04  01C33821   ADDU A3, T6, V1
9D01BB08  00E67821   ADDU T7, A3, A2
9D01BB0C  A1E50000   SB A1, 0(T7)
9D01BB20  0002C8C0   SLL T9, V0, 3
9D01BB24  00024140   SLL T0, V0, 5
9D01BB28  03287021   ADDU T6, T9, T0
9D01BB2C  01C33821   ADDU A3, T6, V1
9D01BB30  00E67821   ADDU T7, A3, A2
9D01BB34  A1E50000   SB A1, 0(T7)
9D01BB48  0002C8C0   SLL T9, V0, 3
9D01BB4C  00024140   SLL T0, V0, 5
9D01BB50  03287021   ADDU T6, T9, T0
9D01BB54  01C33821   ADDU A3, T6, V1
9D01BB58  00E67821   ADDU T7, A3, A2
9D01BB5C  A1E50000   SB A1, 0(T7)
9D01BCD8  11E8000C   BEQ T7, T0, 0x9D01BD0C
9D01BCDC  000240C0   SLL T0, V0, 3
9D01BCE0  000270C0   SLL T6, V0, 3
9D01BCE4  00023940   SLL A3, V0, 5
9D01BCE8  01C77821   ADDU T7, T6, A3
9D01BCEC  01E36821   ADDU T5, T7, V1
9D01BCF0  01A6C021   ADDU T8, T5, A2
9D01BCF4  A3050000   SB A1, 0(T8)
9D01BD08  000240C0   SLL T0, V0, 3
9D01BD0C  00027140   SLL T6, V0, 5
9D01BD10  010E3821   ADDU A3, T0, T6
9D01BD14  00E37821   ADDU T7, A3, V1
9D01BD18  01E66821   ADDU T5, T7, A2
9D01BD1C  A1A50000   SB A1, 0(T5)
9D01BD30  000240C0   SLL T0, V0, 3
9D01BD34  00027140   SLL T6, V0, 5
9D01BD38  010E3821   ADDU A3, T0, T6
9D01BD3C  00E37821   ADDU T7, A3, V1
9D01BD40  01E66821   ADDU T5, T7, A2
9D01BD44  A1A50000   SB A1, 0(T5)
704:                 					color_buffer[y][x] = 0;
9D01BA80  3C09A000   LUI T1, -24576
9D01BA84  25241644   ADDIU A0, T1, 5700
9D01BAB4  00443821   ADDU A3, V0, A0
9D01BAE8  00E46821   ADDU T5, A3, A0
9D01BAEC  A1A00000   SB ZERO, 0(T5)
9D01BB10  00E46821   ADDU T5, A3, A0
9D01BB14  A1A00000   SB ZERO, 0(T5)
9D01BB38  00E46821   ADDU T5, A3, A0
9D01BB3C  A1A00000   SB ZERO, 0(T5)
9D01BB60  00E46821   ADDU T5, A3, A0
9D01BCF8  01A4C821   ADDU T9, T5, A0
9D01BCFC  A3200000   SB ZERO, 0(T9)
9D01BD20  01E4C021   ADDU T8, T7, A0
9D01BD24  A3000000   SB ZERO, 0(T8)
9D01BD48  01E4C021   ADDU T8, T7, A0
705:                 					}
706:                 			break;
707:                 		case 1: /* erase from beginning of screen to cursor */
708:                 //jar
709:                 //      memset(disp_buffer, revvideo, cy*DISP_BUFFER_WIDE+cx+1);
710:                 			for (x=0; x<cx; x++)
9D01BA34  19800053   BLEZ T4, 0x9D01BB84
9D01BA38  838B8073   LB T3, -32653(GP)
9D01BA40  00002821   ADDU A1, ZERO, ZERO
9D01BA44  00005021   ADDU T2, ZERO, ZERO
9D01BBC0  25450001   ADDIU A1, T2, 1
9D01BBC4  30AA00FF   ANDI T2, A1, 255
9D01BBC8  014C102A   SLT V0, T2, T4
9D01BBCC  1040FFED   BEQ V0, ZERO, 0x9D01BB84
9D01BBD0  01402821   ADDU A1, T2, ZERO
9D01BCBC  0B406EF9   J 0x9D01BBE4
9D01BCC0  00003821   ADDU A3, ZERO, ZERO
9D01BCC4  7C0F7C20   SEB T7, T7
9D01BCC8  11E0FF81   BEQ T7, ZERO, 0x9D01BAD0
9D01BCCC  24180001   ADDIU T8, ZERO, 1
9D01BCD0  11F80017   BEQ T7, T8, 0x9D01BD30
9D01BCD4  24080002   ADDIU T0, ZERO, 2
711:                 				for (y=0; y<cy; y++)
9D01BA3C  01604821   ADDU T1, T3, ZERO
9D01BBAC  24590001   ADDIU T9, V0, 1
9D01BBB0  332200FF   ANDI V0, T9, 255
9D01BBB4  0049782A   SLT T7, V0, T1
9D01BBB8  15E0FFF4   BNE T7, ZERO, 0x9D01BB8C
9D01BBBC  0040C821   ADDU T9, V0, ZERO
9D01BBD4  1960FFFA   BLEZ T3, 0x9D01BBC0
9D01BBD8  00001021   ADDU V0, ZERO, ZERO
9D01BBDC  0B406EE3   J 0x9D01BB8C
9D01BBE0  0000C821   ADDU T9, ZERO, ZERO
9D01BBE4  00673021   ADDU A2, V1, A3
712:                 					{
713:                 					disp_buffer[y][x] = ' ';
9D01BA48  3C04A000   LUI A0, -24576
9D01BA4C  2488198C   ADDIU T0, A0, 6540
9D01BA50  24070020   ADDIU A3, ZERO, 32
9D01BB8C  001978C0   SLL T7, T9, 3
9D01BB90  00196940   SLL T5, T9, 5
9D01BB94  01EDC021   ADDU T8, T7, T5
9D01BB98  03051821   ADDU V1, T8, A1
9D01BB9C  00682021   ADDU A0, V1, T0
9D01BBA0  A0870000   SB A3, 0(A0)
714:                 					color_buffer[y][x] = 0;
9D01BA54  3C06A000   LUI A2, -24576
9D01BA58  0B406EF5   J 0x9D01BBD4
9D01BA5C  24CE1644   ADDIU T6, A2, 5700
9D01BBA4  006E3021   ADDU A2, V1, T6
9D01BBA8  A0C00000   SB ZERO, 0(A2)
715:                 					}
716:                 			break;
717:                 		case 2: /* erase entire screen */
718:                 //jar
719:                 //      memset(disp_buffer, revvideo, DISP_BUFFER_WIDE*DISP_BUFFER_HIGH);
720:                 			for (x=0; x<DISP_BUFFER_WIDE; x++)
9D01BCB4  1069FFB3   BEQ V1, T1, 0x9D01BB84
9D01BCB8  24A50001   ADDIU A1, A1, 1
721:                 				for (y=0; y<DISP_BUFFER_HIGH; y++)
9D01BA2C  0B406F2F   J 0x9D01BCBC
9D01BA30  24080320   ADDIU T0, ZERO, 800
9D01BCA8  14E8FFCE   BNE A3, T0, 0x9D01BBE4
9D01BCAC  A08A0000   SB T2, 0(A0)
9D01BCB0  24630001   ADDIU V1, V1, 1
722:                 					{
723:                 					disp_buffer[y][x] = ' ';
9D01BA28  240A0020   ADDIU T2, ZERO, 32
9D01BBE8  A0CA0000   SB T2, 0(A2)
9D01BBEC  00A75821   ADDU T3, A1, A3
9D01BBFC  A1CA0000   SB T2, 0(T6)
9D01BC00  00AC7821   ADDU T7, A1, T4
9D01BC10  A32A0000   SB T2, 0(T9)
9D01BC14  00B81021   ADDU V0, A1, T8
9D01BC24  A0EA0000   SB T2, 0(A3)
9D01BC28  00A43021   ADDU A2, A1, A0
9D01BC38  A1AA0000   SB T2, 0(T5)
9D01BC3C  00AB7021   ADDU T6, A1, T3
9D01BC4C  A30A0000   SB T2, 0(T8)
9D01BC50  00AFC821   ADDU T9, A1, T7
9D01BC60  A08A0000   SB T2, 0(A0)
9D01BC64  00A23821   ADDU A3, A1, V0
9D01BC74  A16A0000   SB T2, 0(T3)
9D01BC78  00A66821   ADDU T5, A1, A2
9D01BC88  A1EA0000   SB T2, 0(T7)
9D01BC8C  00AEC021   ADDU T8, A1, T6
9D01BC9C  A04A0000   SB T2, 0(V0)
9D01BCA0  00B92021   ADDU A0, A1, T9
9D01BCA4  25870168   ADDIU A3, T4, 360
724:                 					color_buffer[y][x] = ' ';
9D01BBF0  A16A0000   SB T2, 0(T3)
9D01BBF4  24EC0028   ADDIU T4, A3, 40
9D01BBF8  006C7021   ADDU T6, V1, T4
9D01BC04  A1EA0000   SB T2, 0(T7)
9D01BC08  25980028   ADDIU T8, T4, 40
9D01BC0C  0078C821   ADDU T9, V1, T8
9D01BC18  A04A0000   SB T2, 0(V0)
9D01BC1C  25840050   ADDIU A0, T4, 80
9D01BC20  00643821   ADDU A3, V1, A0
9D01BC2C  A0CA0000   SB T2, 0(A2)
9D01BC30  258B0078   ADDIU T3, T4, 120
9D01BC34  006B6821   ADDU T5, V1, T3
9D01BC40  A1CA0000   SB T2, 0(T6)
9D01BC44  258F00A0   ADDIU T7, T4, 160
9D01BC48  006FC021   ADDU T8, V1, T7
9D01BC54  A32A0000   SB T2, 0(T9)
9D01BC58  258200C8   ADDIU V0, T4, 200
9D01BC5C  00622021   ADDU A0, V1, V0
9D01BC68  A0EA0000   SB T2, 0(A3)
9D01BC6C  258600F0   ADDIU A2, T4, 240
9D01BC70  00665821   ADDU T3, V1, A2
9D01BC7C  A1AA0000   SB T2, 0(T5)
9D01BC80  258E0118   ADDIU T6, T4, 280
9D01BC84  006E7821   ADDU T7, V1, T6
9D01BC90  A30A0000   SB T2, 0(T8)
9D01BC94  25990140   ADDIU T9, T4, 320
9D01BC98  00791021   ADDU V0, V1, T9
9D01BC9C  A04A0000   SB T2, 0(V0)
9D01BCA0  00B92021   ADDU A0, A1, T9
9D01BCA4  25870168   ADDIU A3, T4, 360
9D01BCA8  14E8FFCE   BNE A3, T0, 0x9D01BBE4
9D01BCAC  A08A0000   SB T2, 0(A0)
9D01BCB0  24630001   ADDIU V1, V1, 1
9D01BCB4  1069FFB3   BEQ V1, T1, 0x9D01BB84
9D01BCB8  24A50001   ADDIU A1, A1, 1
9D01BCBC  0B406EF9   J 0x9D01BBE4
9D01BCC0  00003821   ADDU A3, ZERO, ZERO
9D01BCC4  7C0F7C20   SEB T7, T7
9D01BCC8  11E0FF81   BEQ T7, ZERO, 0x9D01BAD0
9D01BCCC  24180001   ADDIU T8, ZERO, 1
9D01BCD0  11F80017   BEQ T7, T8, 0x9D01BD30
9D01BCD4  24080002   ADDIU T0, ZERO, 2
9D01BCD8  11E8000C   BEQ T7, T0, 0x9D01BD0C
9D01BCDC  000240C0   SLL T0, V0, 3
9D01BCE0  000270C0   SLL T6, V0, 3
9D01BCE4  00023940   SLL A3, V0, 5
9D01BCE8  01C77821   ADDU T7, T6, A3
9D01BCEC  01E36821   ADDU T5, T7, V1
9D01BCF0  01A6C021   ADDU T8, T5, A2
9D01BCF4  A3050000   SB A1, 0(T8)
9D01BCF8  01A4C821   ADDU T9, T5, A0
9D01BCFC  A3200000   SB ZERO, 0(T9)
9D01BD00  24420001   ADDIU V0, V0, 1
9D01BD04  304200FF   ANDI V0, V0, 255
9D01BD08  000240C0   SLL T0, V0, 3
9D01BD0C  00027140   SLL T6, V0, 5
9D01BD10  010E3821   ADDU A3, T0, T6
9D01BD14  00E37821   ADDU T7, A3, V1
9D01BD18  01E66821   ADDU T5, T7, A2
9D01BD1C  A1A50000   SB A1, 0(T5)
9D01BD20  01E4C021   ADDU T8, T7, A0
9D01BD24  A3000000   SB ZERO, 0(T8)
9D01BD28  24590001   ADDIU T9, V0, 1
9D01BD2C  332200FF   ANDI V0, T9, 255
9D01BD30  000240C0   SLL T0, V0, 3
9D01BD34  00027140   SLL T6, V0, 5
9D01BD38  010E3821   ADDU A3, T0, T6
9D01BD3C  00E37821   ADDU T7, A3, V1
9D01BD40  01E66821   ADDU T5, T7, A2
9D01BD44  A1A50000   SB A1, 0(T5)
9D01BD48  01E4C021   ADDU T8, T7, A0
9D01BD4C  24420001   ADDIU V0, V0, 1
9D01BD50  304200FF   ANDI V0, V0, 255
9D01BD54  1449FF5E   BNE V0, T1, 0x9D01BAD0
9D01BD58  A3000000   SB ZERO, 0(T8)
9D01BD5C  0B406EDE   J 0x9D01BB78
9D01BD60  24630001   ADDIU V1, V1, 1
725:                 					}
726:                 			break;
727:                 		}
728:                 	CURSOR_INVERT();
729:                 	}
730:                 
731:                 void video_eraseline(uint8_t erasemode)
732:                 	{
733:                 	uint8_t y,x;
734:                 	CURSOR_INVERT();
735:                 	switch(erasemode)
9D01BD64  24020001   ADDIU V0, ZERO, 1
9D01BD68  10820007   BEQ A0, V0, 0x9D01BD88
9D01BD6C  838B8074   LB T3, -32652(GP)
9D01BD70  10800009   BEQ A0, ZERO, 0x9D01BD98
9D01BD74  24030002   ADDIU V1, ZERO, 2
9D01BD78  10830055   BEQ A0, V1, 0x9D01BED0
9D01BD7C  83848073   LB A0, -32653(GP)
9D01BD80  03E00008   JR RA
9D01BD84  00000000   NOP
736:                 		{
737:                 		case 0: /* erase from cursor to end of line */
738:                 //jar
739:                 			for (x=cx; x<DISP_BUFFER_WIDE; x++)
9D01BD98  938D8074   LBU T5, -32652(GP)
9D01BD9C  2DAA0028   SLTIU T2, T5, 40
9D01BDA0  1140FFF7   BEQ T2, ZERO, 0x9D01BD80
9D01BDA4  838E8073   LB T6, -32653(GP)
9D01BDC8  240C0028   ADDIU T4, ZERO, 40
9D01BDCC  000D3827   NOR A3, ZERO, T5
9D01BDD0  30E90003   ANDI T1, A3, 3
9D01BDE4  25AD0001   ADDIU T5, T5, 1
9D01BDE8  31A200FF   ANDI V0, T5, 255
9D01BDEC  144C006F   BNE V0, T4, 0x9D01BFAC
9D01BDF0  A1400000   SB ZERO, 0(T2)
9D01BDF4  03E00008   JR RA
9D01BDF8  00000000   NOP
9D01BE10  244D0001   ADDIU T5, V0, 1
9D01BE14  31AE00FF   ANDI T6, T5, 255
9D01BE2C  25C80001   ADDIU T0, T6, 1
9D01BE30  310200FF   ANDI V0, T0, 255
9D01BE48  244A0001   ADDIU T2, V0, 1
9D01BE4C  314D00FF   ANDI T5, T2, 255
9D01BE60  25A30001   ADDIU V1, T5, 1
9D01BE64  306200FF   ANDI V0, V1, 255
9D01BE68  144CFFE4   BNE V0, T4, 0x9D01BDFC
9D01BE6C  A3200000   SB ZERO, 0(T9)
9D01BE70  03E00008   JR RA
9D01BE74  00000000   NOP
9D01BFDC  24420001   ADDIU V0, V0, 1
9D01BFE0  304200FF   ANDI V0, V0, 255
9D01BFF8  244F0001   ADDIU T7, V0, 1
9D01BFFC  31E200FF   ANDI V0, T7, 255
9D01C010  24470001   ADDIU A3, V0, 1
9D01C014  30E200FF   ANDI V0, A3, 255
9D01C018  144CFF78   BNE V0, T4, 0x9D01BDFC
9D01C01C  A1000000   SB ZERO, 0(T0)
9D01C020  03E00008   JR RA
9D01C024  00000000   NOP
740:                 				{
741:                 				disp_buffer[cy][x] = ' ';
9D01BDA8  000E78C0   SLL T7, T6, 3
9D01BDAC  000EC940   SLL T9, T6, 5
9D01BDB0  01F93021   ADDU A2, T7, T9
9D01BDB4  3C03A000   LUI V1, -24576
9D01BDB8  2465198C   ADDIU A1, V1, 6540
9D01BDBC  24040020   ADDIU A0, ZERO, 32
9D01BDD4  00CDC021   ADDU T8, A2, T5
9D01BDD8  03051021   ADDU V0, T8, A1
9D01BDDC  A0440000   SB A0, 0(V0)
9D01BDFC  00C2C021   ADDU T8, A2, V0
9D01BE00  03054821   ADDU T1, T8, A1
9D01BE04  A1240000   SB A0, 0(T1)
9D01BE18  00CE7821   ADDU T7, A2, T6
9D01BE1C  01E5C821   ADDU T9, T7, A1
9D01BE20  A3240000   SB A0, 0(T9)
9D01BE34  00C23821   ADDU A3, A2, V0
9D01BE38  00E5C021   ADDU T8, A3, A1
9D01BE3C  A3040000   SB A0, 0(T8)
9D01BE50  00CD7021   ADDU T6, A2, T5
9D01BE54  01C57821   ADDU T7, T6, A1
9D01BE58  A1E40000   SB A0, 0(T7)
9D01BFC0  11C80009   BEQ T6, T0, 0x9D01BFE8
9D01BFC4  00C25021   ADDU T2, A2, V0
9D01BFC8  00C23821   ADDU A3, A2, V0
9D01BFCC  00E54821   ADDU T1, A3, A1
9D01BFD0  A1240000   SB A0, 0(T1)
9D01BFE4  00C25021   ADDU T2, A2, V0
9D01BFE8  01456821   ADDU T5, T2, A1
9D01BFEC  A1A40000   SB A0, 0(T5)
9D01C000  00C2C821   ADDU T9, A2, V0
9D01C004  03251821   ADDU V1, T9, A1
9D01C008  A0640000   SB A0, 0(V1)
742:                 				color_buffer[cy][x] = 0;
9D01BDC0  3C08A000   LUI T0, -24576
9D01BDC4  250B1644   ADDIU T3, T0, 5700
9D01BDE0  030B5021   ADDU T2, T8, T3
9D01BE08  030B5021   ADDU T2, T8, T3
9D01BE0C  A1400000   SB ZERO, 0(T2)
9D01BE24  01EB1821   ADDU V1, T7, T3
9D01BE28  A0600000   SB ZERO, 0(V1)
9D01BE40  00EB4821   ADDU T1, A3, T3
9D01BE44  A1200000   SB ZERO, 0(T1)
9D01BE5C  01CBC821   ADDU T9, T6, T3
9D01BFD4  00EBC021   ADDU T8, A3, T3
9D01BFD8  A3000000   SB ZERO, 0(T8)
9D01BFF0  014B7021   ADDU T6, T2, T3
9D01BFF4  A1C00000   SB ZERO, 0(T6)
9D01C00C  032B4021   ADDU T0, T9, T3
743:                 				}
744:                 //      memset(&disp_buffer[cy][cx], revvideo, DISP_BUFFER_WIDE-cx);
745:                 			break;
746:                 		case 1: /* erase from beginning of line to cursor */
747:                 //jar
748:                 			for (x=0; x<cx; x++)
9D01BD88  1D60003B   BGTZ T3, 0x9D01BE78
9D01BD8C  83868073   LB A2, -32653(GP)
9D01BD90  03E00008   JR RA
9D01BD94  00000000   NOP
9D01BE78  00001821   ADDU V1, ZERO, ZERO
9D01BE7C  0000C821   ADDU T9, ZERO, ZERO
9D01BEB4  27220001   ADDIU V0, T9, 1
9D01BEB8  305900FF   ANDI T9, V0, 255
9D01BEBC  032B302A   SLT A2, T9, T3
9D01BEC0  14C0FFF7   BNE A2, ZERO, 0x9D01BEA0
9D01BEC4  03201821   ADDU V1, T9, ZERO
9D01BEC8  03E00008   JR RA
9D01BECC  00000000   NOP
9D01BED0  000428C0   SLL A1, A0, 3
9D01BED4  00043140   SLL A2, A0, 5
9D01BED8  00A63821   ADDU A3, A1, A2
9D01BEDC  3C08A000   LUI T0, -24576
9D01BEE0  2509198C   ADDIU T1, T0, 6540
9D01BEE4  01275021   ADDU T2, T1, A3
9D01BEE8  3C0BA000   LUI T3, -24576
9D01BEEC  256C1644   ADDIU T4, T3, 5700
9D01BEF0  01876821   ADDU T5, T4, A3
749:                 				{
750:                 				disp_buffer[cy][x] = ' ';
9D01BE80  000628C0   SLL A1, A2, 3
9D01BE84  00062140   SLL A0, A2, 5
9D01BE88  00A46021   ADDU T4, A1, A0
9D01BE8C  3C08A000   LUI T0, -24576
9D01BE90  2507198C   ADDIU A3, T0, 6540
9D01BE94  24180020   ADDIU T8, ZERO, 32
9D01BEA0  01836821   ADDU T5, T4, V1
9D01BEA4  01A77021   ADDU T6, T5, A3
9D01BEA8  A1D80000   SB T8, 0(T6)
751:                 				color_buffer[cy][x] = 0;
9D01BE98  3C09A000   LUI T1, -24576
9D01BE9C  252A1644   ADDIU T2, T1, 5700
9D01BEAC  01AA7821   ADDU T7, T5, T2
9D01BEB0  A1E00000   SB ZERO, 0(T7)
752:                 				}
753:                 
754:                 //      memset(&disp_buffer[cy], revvideo, cx+1);
755:                 			break;
756:                 		case 2: /* erase entire line */
757:                 //jar
758:                 			for (x=0; x<DISP_BUFFER_WIDE; x++)
9D01BEFC  240F0028   ADDIU T7, ZERO, 40
9D01BF00  0142C021   ADDU T8, T2, V0
9D01BF9C  144FFFD8   BNE V0, T7, 0x9D01BF00
9D01BFA0  A3000000   SB ZERO, 0(T8)
9D01BFA4  03E00008   JR RA
9D01BFA8  00000000   NOP
9D01BFAC  7C097420   SEB T6, T1
9D01BFB0  11C0FF92   BEQ T6, ZERO, 0x9D01BDFC
9D01BFB4  24190001   ADDIU T9, ZERO, 1
9D01BFB8  11D90011   BEQ T6, T9, 0x9D01C000
9D01BFBC  24080002   ADDIU T0, ZERO, 2
759:                 				{
760:                 				disp_buffer[cy][x] = ' ';
9D01BEF4  00001021   ADDU V0, ZERO, ZERO
9D01BEF8  240E0020   ADDIU T6, ZERO, 32
9D01BF04  A30E0000   SB T6, 0(T8)
9D01BF08  01A2C821   ADDU T9, T5, V0
9D01BF18  A08E0000   SB T6, 0(A0)
9D01BF1C  01A22821   ADDU A1, T5, V0
9D01BF2C  A0EE0000   SB T6, 0(A3)
9D01BF30  01A64021   ADDU T0, T5, A2
9D01BF40  A16E0000   SB T6, 0(T3)
9D01BF44  01A96021   ADDU T4, T5, T1
9D01BF54  A32E0000   SB T6, 0(T9)
9D01BF58  01B81821   ADDU V1, T5, T8
9D01BF68  A0AE0000   SB T6, 0(A1)
9D01BF6C  01A43021   ADDU A2, T5, A0
9D01BF7C  A0EE0000   SB T6, 0(A3)
9D01BF80  01A84821   ADDU T1, T5, T0
9D01BF90  A18E0000   SB T6, 0(T4)
9D01BF94  01ABC021   ADDU T8, T5, T3
9D01BF98  24420007   ADDIU V0, V0, 7
761:                 				color_buffer[cy][x] = 0;
9D01BF0C  A3200000   SB ZERO, 0(T9)
9D01BF10  24420001   ADDIU V0, V0, 1
9D01BF14  01422021   ADDU A0, T2, V0
9D01BF20  A0A00000   SB ZERO, 0(A1)
9D01BF24  24460001   ADDIU A2, V0, 1
9D01BF28  01463821   ADDU A3, T2, A2
9D01BF34  A1000000   SB ZERO, 0(T0)
9D01BF38  24490002   ADDIU T1, V0, 2
9D01BF3C  01495821   ADDU T3, T2, T1
9D01BF48  A1800000   SB ZERO, 0(T4)
9D01BF4C  24580003   ADDIU T8, V0, 3
9D01BF50  0158C821   ADDU T9, T2, T8
9D01BF5C  A0600000   SB ZERO, 0(V1)
9D01BF60  24440004   ADDIU A0, V0, 4
9D01BF64  01442821   ADDU A1, T2, A0
9D01BF70  A0C00000   SB ZERO, 0(A2)
9D01BF74  24480005   ADDIU T0, V0, 5
9D01BF78  01483821   ADDU A3, T2, T0
9D01BF84  A1200000   SB ZERO, 0(T1)
9D01BF88  244B0006   ADDIU T3, V0, 6
9D01BF8C  014B6021   ADDU T4, T2, T3
9D01BF90  A18E0000   SB T6, 0(T4)
9D01BF94  01ABC021   ADDU T8, T5, T3
9D01BF98  24420007   ADDIU V0, V0, 7
9D01BF9C  144FFFD8   BNE V0, T7, 0x9D01BF00
9D01BFA0  A3000000   SB ZERO, 0(T8)
9D01BFA4  03E00008   JR RA
9D01BFA8  00000000   NOP
9D01BFAC  7C097420   SEB T6, T1
9D01BFB0  11C0FF92   BEQ T6, ZERO, 0x9D01BDFC
9D01BFB4  24190001   ADDIU T9, ZERO, 1
9D01BFB8  11D90011   BEQ T6, T9, 0x9D01C000
9D01BFBC  24080002   ADDIU T0, ZERO, 2
9D01BFC0  11C80009   BEQ T6, T0, 0x9D01BFE8
9D01BFC4  00C25021   ADDU T2, A2, V0
9D01BFC8  00C23821   ADDU A3, A2, V0
9D01BFCC  00E54821   ADDU T1, A3, A1
9D01BFD0  A1240000   SB A0, 0(T1)
9D01BFD4  00EBC021   ADDU T8, A3, T3
9D01BFD8  A3000000   SB ZERO, 0(T8)
9D01BFDC  24420001   ADDIU V0, V0, 1
9D01BFE0  304200FF   ANDI V0, V0, 255
9D01BFE4  00C25021   ADDU T2, A2, V0
9D01BFE8  01456821   ADDU T5, T2, A1
9D01BFEC  A1A40000   SB A0, 0(T5)
9D01BFF0  014B7021   ADDU T6, T2, T3
9D01BFF4  A1C00000   SB ZERO, 0(T6)
9D01BFF8  244F0001   ADDIU T7, V0, 1
9D01BFFC  31E200FF   ANDI V0, T7, 255
9D01C000  00C2C821   ADDU T9, A2, V0
9D01C004  03251821   ADDU V1, T9, A1
9D01C008  A0640000   SB A0, 0(V1)
9D01C00C  032B4021   ADDU T0, T9, T3
9D01C010  24470001   ADDIU A3, V0, 1
9D01C014  30E200FF   ANDI V0, A3, 255
9D01C018  144CFF78   BNE V0, T4, 0x9D01BDFC
9D01C01C  A1000000   SB ZERO, 0(T0)
9D01C020  03E00008   JR RA
9D01C024  00000000   NOP
762:                 				}
763:                 
764:                 //      memset(&disp_buffer[cy], revvideo, DISP_BUFFER_WIDE);
765:                 			break;
766:                 		}
767:                 	CURSOR_INVERT();
768:                 	}
769:                 
770:                 /* Does not respect top/bottom margins */
771:                 void video_putcxy(int8_t x, int8_t y, int8_t c)
772:                 	{
773:                 	if (x < 0 || x >= DISP_BUFFER_WIDE) return;
9D01C664  308200FF   ANDI V0, A0, 255
9D01C668  2C430028   SLTIU V1, V0, 40
9D01C66C  10600012   BEQ V1, ZERO, 0x9D01C6B8
9D01C670  30A700FF   ANDI A3, A1, 255
774:                 	if (y < 0 || y >= DISP_BUFFER_HIGH) return;
9D01C674  2CE80014   SLTIU T0, A3, 20
9D01C678  1100000F   BEQ T0, ZERO, 0x9D01C6B8
9D01C67C  000548C0   SLL T1, A1, 3
775:                 	disp_buffer[y][x] = c ^ revvideo;
9D01C680  00052940   SLL A1, A1, 5
9D01C684  01255021   ADDU T2, T1, A1
9D01C688  01442021   ADDU A0, T2, A0
9D01C68C  3C0BA000   LUI T3, -24576
9D01C690  256C198C   ADDIU T4, T3, 6540
9D01C694  008C6821   ADDU T5, A0, T4
9D01C698  938E8068   LBU T6, -32664(GP)
9D01C69C  00CE3026   XOR A2, A2, T6
9D01C6A0  A1A60000   SB A2, 0(T5)
776:                 	color_buffer[y][x] = color_composite;
9D01C6A4  3C0FA000   LUI T7, -24576
9D01C6A8  25F81644   ADDIU T8, T7, 5700
9D01C6AC  0098C821   ADDU T9, A0, T8
9D01C6B0  938281C1   LBU V0, -32319(GP)
9D01C6B4  A3220000   SB V0, 0(T9)
9D01C6B8  03E00008   JR RA
9D01C6BC  00000000   NOP
777:                 	}
778:                 
779:                 /* Does not respect top/bottom margins */
780:                 void video_putsxy(int8_t x, int8_t y, int8_t *str)
781:                 	{
9D01CABC  27BDFFD8   ADDIU SP, SP, -40
9D01CAC0  AFBF0024   SW RA, 36(SP)
9D01CAC4  AFB40020   SW S4, 32(SP)
9D01CAC8  AFB3001C   SW S3, 28(SP)
9D01CACC  AFB20018   SW S2, 24(SP)
9D01CAD0  AFB10014   SW S1, 20(SP)
9D01CAD4  AFB00010   SW S0, 16(SP)
782:                 	int16_t len;
783:                 	if (x < 0 || x >= DISP_BUFFER_WIDE) return;
9D01CAD8  308200FF   ANDI V0, A0, 255
9D01CADC  2C430028   SLTIU V1, V0, 40
9D01CAE0  10600026   BEQ V1, ZERO, .LVL288
9D01CAE4  00808021   ADDU S0, A0, ZERO
9D01CAE8  00A08821   ADDU S1, A1, ZERO
784:                 	if (y < 0 || y >= DISP_BUFFER_HIGH) return;
9D01CAEC  30A400FF   ANDI A0, A1, 255
9D01CAF0  2C850014   SLTIU A1, A0, 20
9D01CAF4  10A00021   BEQ A1, ZERO, .LVL288
9D01CAF8  00C09821   ADDU S3, A2, ZERO
785:                 	len = strlen(str);
9D01CAFC  0F40F2B0   JAL strlen
9D01CB00  00C02021   ADDU A0, A2, ZERO
9D01CB04  7C029620   SEH S2, V0
786:                 	if (len > DISP_BUFFER_WIDE-x) len = DISP_BUFFER_WIDE-x;
9D01CB08  24060028   ADDIU A2, ZERO, 40
9D01CB0C  00D03823   SUBU A3, A2, S0
9D01CB10  00F2402A   SLT T0, A3, S2
9D01CB14  11000003   BEQ T0, ZERO, 0x9D01CB24
9D01CB18  0011A0C0   SLL S4, S1, 3
9D01CB1C  24120028   ADDIU S2, ZERO, 40
9D01CB20  02509023   SUBU S2, S2, S0
787:                 	memcpy((int8_t *)(&disp_buffer[y][x]), str, len);
9D01CB24  00114940   SLL T1, S1, 5
9D01CB28  02895021   ADDU T2, S4, T1
9D01CB2C  0150A021   ADDU S4, T2, S0
9D01CB30  3C0BA000   LUI T3, -24576
9D01CB34  256C198C   ADDIU T4, T3, 6540
9D01CB38  01942021   ADDU A0, T4, S4
9D01CB3C  02602821   ADDU A1, S3, ZERO
9D01CB40  0F40F256   JAL .Letext0, .LFE1, memcpy
9D01CB44  02403021   ADDU A2, S2, ZERO
788:                 	memset((int8_t *)(&color_buffer[y][x]), color_composite, len);
9D01CB48  3C0DA000   LUI T5, -24576
9D01CB4C  25AE1644   ADDIU T6, T5, 5700
9D01CB50  01D42021   ADDU A0, T6, S4
9D01CB54  938581C1   LBU A1, -32319(GP)
9D01CB58  0F4100B4   JAL .Letext0, .LFE0, memset
9D01CB5C  02403021   ADDU A2, S2, ZERO
789:                 	if (revvideo) video_invert_range(x, y, len);
9D01CB60  938F8068   LBU T7, -32664(GP)
9D01CB64  11E00006   BEQ T7, ZERO, 0x9D01CB80
9D01CB68  8FBF0024   LW RA, 36(SP)
9D01CB6C  02002021   ADDU A0, S0, ZERO
9D01CB70  02202821   ADDU A1, S1, ZERO
9D01CB74  0F40724D   JAL video_invert_range
9D01CB78  324600FF   ANDI A2, S2, 255
790:                 	}
9D01CB7C  8FBF0024   LW RA, 36(SP)
9D01CB80  8FB40020   LW S4, 32(SP)
9D01CB84  8FB3001C   LW S3, 28(SP)
9D01CB88  8FB20018   LW S2, 24(SP)
9D01CB8C  8FB10014   LW S1, 20(SP)
9D01CB90  8FB00010   LW S0, 16(SP)
9D01CB94  03E00008   JR RA
9D01CB98  27BD0028   ADDIU SP, SP, 40
791:                 
792:                 
793:                 /* Does not respect top/bottom margins */
794:                 void video_putline(int8_t y, int8_t *str)
795:                 	{
9D01CB9C  27BDFFE0   ADDIU SP, SP, -32
9D01CBA0  AFBF001C   SW RA, 28(SP)
9D01CBA4  AFB20018   SW S2, 24(SP)
9D01CBA8  AFB10014   SW S1, 20(SP)
9D01CBAC  AFB00010   SW S0, 16(SP)
796:                 	if (y < 0 || y >= DISP_BUFFER_HIGH) return;
9D01CBB0  308200FF   ANDI V0, A0, 255
9D01CBB4  2C430014   SLTIU V1, V0, 20
9D01CBB8  1060001A   BEQ V1, ZERO, .LVL295
9D01CBBC  00808021   ADDU S0, A0, ZERO
9D01CBC0  00A08821   ADDU S1, A1, ZERO
797:                 	/* strncpy fills unused bytes in the destination with nulls */
798:                 	strncpy((int8_t *)(&disp_buffer[y]), str, DISP_BUFFER_WIDE);
9D01CBC4  000490C0   SLL S2, A0, 3
9D01CBC8  00042140   SLL A0, A0, 5
9D01CBCC  02449021   ADDU S2, S2, A0
9D01CBD0  3C05A000   LUI A1, -24576
9D01CBD4  24A6198C   ADDIU A2, A1, 6540
9D01CBD8  00D22021   ADDU A0, A2, S2
9D01CBDC  02202821   ADDU A1, S1, ZERO
9D01CBE0  0F40FA4F   JAL .LFE23, strncpy
9D01CBE4  24060028   ADDIU A2, ZERO, 40
799:                 	memset((int8_t *)(&color_buffer[y]), color_composite, strlen(str));
9D01CBE8  0F40F2B0   JAL strlen
9D01CBEC  02202021   ADDU A0, S1, ZERO
9D01CBF0  3C07A000   LUI A3, -24576
9D01CBF4  24E81644   ADDIU T0, A3, 5700
9D01CBF8  01122021   ADDU A0, T0, S2
9D01CBFC  938581C1   LBU A1, -32319(GP)
9D01CC00  0F4100B4   JAL .Letext0, .LFE0, memset
9D01CC04  00403021   ADDU A2, V0, ZERO
800:                 	if (revvideo) video_invert_range(0, y, DISP_BUFFER_WIDE);
9D01CC08  93898068   LBU T1, -32664(GP)
9D01CC0C  11200006   BEQ T1, ZERO, 0x9D01CC28
9D01CC10  8FBF001C   LW RA, 28(SP)
9D01CC14  00002021   ADDU A0, ZERO, ZERO
9D01CC18  02002821   ADDU A1, S0, ZERO
9D01CC1C  0F40724D   JAL video_invert_range
9D01CC20  24060028   ADDIU A2, ZERO, 40
801:                 	}
9D01CC24  8FBF001C   LW RA, 28(SP)
9D01CC28  8FB20018   LW S2, 24(SP)
9D01CC2C  8FB10014   LW S1, 20(SP)
9D01CC30  8FB00010   LW S0, 16(SP)
9D01CC34  03E00008   JR RA
9D01CC38  27BD0020   ADDIU SP, SP, 32
802:                 
803:                 void video_setc(int8_t c)
804:                 	{
805:                 	CURSOR_INVERT();
806:                 	disp_buffer[cy][cx] = c ^ revvideo;
9D01C6C0  83838073   LB V1, -32653(GP)
9D01C6C4  83858074   LB A1, -32652(GP)
9D01C6C8  000310C0   SLL V0, V1, 3
9D01C6CC  00033140   SLL A2, V1, 5
9D01C6D0  00463821   ADDU A3, V0, A2
9D01C6D4  00E54021   ADDU T0, A3, A1
9D01C6D8  3C09A000   LUI T1, -24576
9D01C6DC  252A198C   ADDIU T2, T1, 6540
9D01C6E0  010A5821   ADDU T3, T0, T2
9D01C6E4  938C8068   LBU T4, -32664(GP)
9D01C6E8  008C2026   XOR A0, A0, T4
9D01C6EC  A1640000   SB A0, 0(T3)
807:                 	color_buffer[cy][cx] = color_composite;
9D01C6F0  3C0DA000   LUI T5, -24576
9D01C6F4  25AE1644   ADDIU T6, T5, 5700
9D01C6F8  010E7821   ADDU T7, T0, T6
9D01C6FC  939881C1   LBU T8, -32319(GP)
9D01C700  03E00008   JR RA
9D01C704  A1F80000   SB T8, 0(T7)
808:                 	CURSOR_INVERT();
809:                 	}
810:                 
811:                 static void _video_putc(int8_t c)
812:                 	{
9D01B10C  27BDFFE8   ADDIU SP, SP, -24
9D01B110  AFBF0014   SW RA, 20(SP)
9D01B114  AFB00010   SW S0, 16(SP)
813:                 	/* If the last character printed exceeded the right boundary,
814:                 	 * we have to go to a new line. */
815:                 	if (cx >= DISP_BUFFER_WIDE) _video_lfwd();
9D01B118  83828074   LB V0, -32652(GP)
9D01B11C  28430028   SLTI V1, V0, 40
9D01B120  14600003   BNE V1, ZERO, .LVL51
9D01B124  00808021   ADDU S0, A0, ZERO
9D01B128  0F406C26   JAL .LFB38, _video_lfwd, .LFE29
9D01B12C  00000000   NOP
816:                 
817:                 	if (c == '\r') cx = 0;
9D01B130  2404000D   ADDIU A0, ZERO, 13
9D01B134  16040003   BNE S0, A0, 0x9D01B144
9D01B138  2405000A   ADDIU A1, ZERO, 10
9D01B13C  0B406C68   J .LVL53
9D01B140  A3808074   SB ZERO, -32652(GP)
818:                 	else if (c == '\n') _video_lfwd();
9D01B144  16050005   BNE S0, A1, 0x9D01B15C
9D01B148  83868073   LB A2, -32653(GP)
9D01B14C  0F406C26   JAL .LFB38, _video_lfwd, .LFE29
9D01B150  00000000   NOP
9D01B154  0B406C69   J 0x9D01B1A4
9D01B158  8FBF0014   LW RA, 20(SP)
819:                 	else
820:                 		{
821:                 		disp_buffer[cy][cx] = c ^ revvideo;
9D01B15C  83878074   LB A3, -32652(GP)
9D01B160  000640C0   SLL T0, A2, 3
9D01B164  00064940   SLL T1, A2, 5
9D01B168  01095021   ADDU T2, T0, T1
9D01B16C  01475821   ADDU T3, T2, A3
9D01B170  3C0CA000   LUI T4, -24576
9D01B174  258D198C   ADDIU T5, T4, 6540
9D01B178  016D7021   ADDU T6, T3, T5
9D01B17C  938F8068   LBU T7, -32664(GP)
9D01B180  020FC026   XOR T8, S0, T7
9D01B184  A1D80000   SB T8, 0(T6)
822:                 		color_buffer[cy][cx] = color_composite;
9D01B188  3C19A000   LUI T9, -24576
9D01B18C  273F1644   ADDIU RA, T9, 5700
9D01B190  017F8021   ADDU S0, T3, RA
9D01B194  938281C1   LBU V0, -32319(GP)
823:                 		_video_cfwd();
9D01B198  0F406C36   JAL .LFB39, _video_cfwd, .LFE38
9D01B19C  A2020000   SB V0, 0(S0)
824:                 		}
825:                 	}
9D01B1A0  8FBF0014   LW RA, 20(SP)
9D01B1A4  8FB00010   LW S0, 16(SP)
9D01B1A8  03E00008   JR RA
9D01B1AC  27BD0018   ADDIU SP, SP, 24
826:                 
827:                 void video_putc(int8_t c)
828:                 	{
9D01C708  27BDFFE8   ADDIU SP, SP, -24
9D01C70C  AFBF0014   SW RA, 20(SP)
829:                 	CURSOR_INVERT();
830:                 	_video_putc(c);
9D01C710  0F406C43   JAL .LFB58, _video_putc, .LFE39
9D01C714  00000000   NOP
831:                 	CURSOR_INVERT();
832:                 	}
9D01C718  8FBF0014   LW RA, 20(SP)
9D01C71C  03E00008   JR RA
9D01C720  27BD0018   ADDIU SP, SP, 24
833:                 
834:                 void video_putc_raw(int8_t c)
835:                 	{
9D01C724  27BDFFE8   ADDIU SP, SP, -24
9D01C728  AFBF0014   SW RA, 20(SP)
9D01C72C  AFB00010   SW S0, 16(SP)
836:                 	CURSOR_INVERT();
837:                 
838:                 	/* If the last character printed exceeded the right boundary,
839:                 	 * we have to go to a new line. */
840:                 	if (cx >= DISP_BUFFER_WIDE) _video_lfwd();
9D01C730  83828074   LB V0, -32652(GP)
9D01C734  28430028   SLTI V1, V0, 40
9D01C738  14600003   BNE V1, ZERO, .LVL244
9D01C73C  00808021   ADDU S0, A0, ZERO
9D01C740  0F406C26   JAL .LFB38, _video_lfwd, .LFE29
9D01C744  00000000   NOP
841:                 //jar
842:                 //  disp_buffer[cy][cx] = c ^ revvideo;
843:                 	disp_buffer[cy][cx] = c;
9D01C748  83858073   LB A1, -32653(GP)
9D01C74C  83848074   LB A0, -32652(GP)
9D01C750  000530C0   SLL A2, A1, 3
9D01C754  00053940   SLL A3, A1, 5
9D01C758  00C74021   ADDU T0, A2, A3
9D01C75C  01044821   ADDU T1, T0, A0
9D01C760  3C0AA000   LUI T2, -24576
9D01C764  254B198C   ADDIU T3, T2, 6540
9D01C768  012B6021   ADDU T4, T1, T3
9D01C76C  A1900000   SB S0, 0(T4)
844:                 	color_buffer[cy][cx] = color_composite;
9D01C770  3C0DA000   LUI T5, -24576
9D01C774  25AE1644   ADDIU T6, T5, 5700
9D01C778  012E7821   ADDU T7, T1, T6
9D01C77C  939881C1   LBU T8, -32319(GP)
845:                 	_video_cfwd();
9D01C780  0F406C36   JAL .LFB39, _video_cfwd, .LFE38
9D01C784  A1F80000   SB T8, 0(T7)
846:                 	CURSOR_INVERT();
847:                 	}
9D01C788  8FBF0014   LW RA, 20(SP)
9D01C78C  8FB00010   LW S0, 16(SP)
9D01C790  03E00008   JR RA
9D01C794  27BD0018   ADDIU SP, SP, 24
848:                 
849:                 void video_puts(int8_t *str)
850:                 	{
9D01C8C0  27BDFFE8   ADDIU SP, SP, -24
9D01C8C4  AFBF0014   SW RA, 20(SP)
9D01C8C8  AFB00010   SW S0, 16(SP)
851:                 	/* Characters are interpreted and printed one at a time. */
852:                 	int8_t c;
853:                 	CURSOR_INVERT();
854:                 	while ((c = *str++))
9D01C8CC  24900001   ADDIU S0, A0, 1
9D01C8D0  80840000   LB A0, 0(A0)
9D01C8D4  10800006   BEQ A0, ZERO, 0x9D01C8F0
9D01C8D8  8FBF0014   LW RA, 20(SP)
9D01C8E4  8204FFFF   LB A0, -1(S0)
9D01C8E8  1480FFFC   BNE A0, ZERO, 0x9D01C8DC
9D01C8EC  8FBF0014   LW RA, 20(SP)
855:                 		_video_putc(c);
9D01C8DC  0F406C43   JAL .LFB58, _video_putc, .LFE39
9D01C8E0  26100001   ADDIU S0, S0, 1
856:                 	CURSOR_INVERT();
857:                 	}
9D01C8F0  8FB00010   LW S0, 16(SP)
9D01C8F4  03E00008   JR RA
9D01C8F8  27BD0018   ADDIU SP, SP, 24
858:                 
859:                 void video_show_cursor()
860:                 	{
861:                 	if (!showcursor)
9D01C8FC  93828072   LBU V0, -32654(GP)
9D01C900  14400002   BNE V0, ZERO, 0x9D01C90C
9D01C904  2403FF80   ADDIU V1, ZERO, -128
862:                 		{
863:                 		showcursor = 0x80;
9D01C908  A3838072   SB V1, -32654(GP)
9D01C90C  03E00008   JR RA
9D01C910  00000000   NOP
864:                 		CURSOR_INVERT();
865:                 		}
866:                 	}
867:                 
868:                 void video_hide_cursor()
869:                 	{
870:                 	if (showcursor)
9D01C914  93828072   LBU V0, -32654(GP)
9D01C918  54400001   BNEL V0, ZERO, 0x9D01C920
9D01C91C  A3808072   SB ZERO, -32654(GP)
9D01C920  03E00008   JR RA
9D01C924  00000000   NOP
871:                 		{
872:                 		CURSOR_INVERT();
873:                 		showcursor = 0;
874:                 		}
875:                 	}
876:                 
877:                 uint8_t video_cursor_visible()
878:                 	{
879:                 	return showcursor != 0;
9D01C928  93828072   LBU V0, -32654(GP)
880:                 	}
9D01C92C  03E00008   JR RA
9D01C930  0002102B   SLTU V0, ZERO, V0
881:                 
882:                 void video_invert_range(int8_t x, int8_t y, uint8_t rangelen)
883:                 	{
884:                 	int8_t *start = &disp_buffer[y][x];
9D01C934  000510C0   SLL V0, A1, 3
9D01C938  00052940   SLL A1, A1, 5
9D01C93C  00451821   ADDU V1, V0, A1
9D01C940  00642021   ADDU A0, V1, A0
9D01C944  3C07A000   LUI A3, -24576
9D01C948  24E8198C   ADDIU T0, A3, 6540
885:                 	uint8_t i;
886:                 	for (i = 0; i < rangelen; i++)
9D01C94C  10C0000E   BEQ A2, ZERO, 0x9D01C988
9D01C950  01044821   ADDU T1, T0, A0
9D01C954  24C6FFFF   ADDIU A2, A2, -1
9D01C958  30CA00FF   ANDI T2, A2, 255
9D01C95C  254B0001   ADDIU T3, T2, 1
9D01C960  012B6021   ADDU T4, T1, T3
9D01C980  144C0020   BNE V0, T4, 0x9D01CA04
9D01C984  31F80007   ANDI T8, T7, 7
9D01C988  03E00008   JR RA
9D01C98C  00000000   NOP
9D01C9F4  144CFFE6   BNE V0, T4, 0x9D01C990
9D01C9F8  A1CF0006   SB T7, 6(T6)
9D01C9FC  03E00008   JR RA
9D01CA00  00000000   NOP
9D01CA04  1300FFE2   BEQ T8, ZERO, 0x9D01C990
9D01CA08  24050001   ADDIU A1, ZERO, 1
9D01CA0C  13050023   BEQ T8, A1, 0x9D01CA9C
9D01CA10  24030002   ADDIU V1, ZERO, 2
9D01CA14  1303001D   BEQ T8, V1, 0x9D01CA8C
9D01CA18  24040003   ADDIU A0, ZERO, 3
9D01CA1C  13040017   BEQ T8, A0, 0x9D01CA7C
9D01CA20  24070004   ADDIU A3, ZERO, 4
9D01CA24  13070011   BEQ T8, A3, 0x9D01CA6C
9D01CA28  24080005   ADDIU T0, ZERO, 5
9D01CA2C  1308000B   BEQ T8, T0, 0x9D01CA5C
9D01CA30  24090006   ADDIU T1, ZERO, 6
9D01CAAC  544CFFB9   BNEL V0, T4, 0x9D01C994
9D01CAB0  904A0000   LBU T2, 0(V0)
9D01CAB4  03E00008   JR RA
9D01CAB8  00000000   NOP
887:                 		{
888:                 		*start ^= 0x80;
9D01C964  240DFF80   ADDIU T5, ZERO, -128
9D01C968  00097027   NOR T6, ZERO, T1
9D01C96C  018E7821   ADDU T7, T4, T6
9D01C970  91390000   LBU T9, 0(T1)
9D01C974  032D1026   XOR V0, T9, T5
9D01C978  A1220000   SB V0, 0(T1)
9D01C990  904A0000   LBU T2, 0(V0)
9D01C994  014D5826   XOR T3, T2, T5
9D01C998  A04B0000   SB T3, 0(V0)
9D01C9A0  904F0001   LBU T7, 1(V0)
9D01C9A4  01EDC026   XOR T8, T7, T5
9D01C9A8  A0580001   SB T8, 1(V0)
9D01C9AC  91D90001   LBU T9, 1(T6)
9D01C9B0  032D2826   XOR A1, T9, T5
9D01C9B4  A1C50001   SB A1, 1(T6)
9D01C9B8  91C30002   LBU V1, 2(T6)
9D01C9BC  006D2026   XOR A0, V1, T5
9D01C9C0  A1C40002   SB A0, 2(T6)
9D01C9C4  91C70003   LBU A3, 3(T6)
9D01C9C8  00ED4026   XOR T0, A3, T5
9D01C9CC  A1C80003   SB T0, 3(T6)
9D01C9D0  91C90004   LBU T1, 4(T6)
9D01C9D4  012D3026   XOR A2, T1, T5
9D01C9D8  A1C60004   SB A2, 4(T6)
9D01C9DC  91C20005   LBU V0, 5(T6)
9D01C9E0  004D5026   XOR T2, V0, T5
9D01C9E4  A1CA0005   SB T2, 5(T6)
9D01C9E8  91CB0006   LBU T3, 6(T6)
9D01C9EC  016D7826   XOR T7, T3, T5
9D01CA34  53090006   BEQL T8, T1, 0x9D01CA50
9D01CA38  904B0000   LBU T3, 0(V0)
9D01CA3C  90460000   LBU A2, 0(V0)
9D01CA40  00CD5026   XOR T2, A2, T5
9D01CA44  A04A0000   SB T2, 0(V0)
9D01CA4C  904B0000   LBU T3, 0(V0)
9D01CA50  016D7026   XOR T6, T3, T5
9D01CA54  A04E0000   SB T6, 0(V0)
9D01CA5C  904F0000   LBU T7, 0(V0)
9D01CA60  01EDC026   XOR T8, T7, T5
9D01CA64  A0580000   SB T8, 0(V0)
9D01CA6C  90590000   LBU T9, 0(V0)
9D01CA70  032D2826   XOR A1, T9, T5
9D01CA74  A0450000   SB A1, 0(V0)
9D01CA7C  90430000   LBU V1, 0(V0)
9D01CA80  006D2026   XOR A0, V1, T5
9D01CA84  A0440000   SB A0, 0(V0)
9D01CA8C  90470000   LBU A3, 0(V0)
9D01CA90  00ED4026   XOR T0, A3, T5
9D01CA94  A0480000   SB T0, 0(V0)
9D01CA9C  90490000   LBU T1, 0(V0)
9D01CAA0  012D3026   XOR A2, T1, T5
9D01CAA4  A0460000   SB A2, 0(V0)
889:                 		start++;
9D01C97C  25220001   ADDIU V0, T1, 1
9D01C99C  244E0001   ADDIU T6, V0, 1
9D01C9F0  25C20007   ADDIU V0, T6, 7
9D01CA48  24420001   ADDIU V0, V0, 1
9D01CA58  24420001   ADDIU V0, V0, 1
9D01CA68  24420001   ADDIU V0, V0, 1
9D01CA78  24420001   ADDIU V0, V0, 1
9D01CA88  24420001   ADDIU V0, V0, 1
9D01CA98  24420001   ADDIU V0, V0, 1
9D01CAA8  24420001   ADDIU V0, V0, 1
9D01CAAC  544CFFB9   BNEL V0, T4, 0x9D01C994
9D01CAB0  904A0000   LBU T2, 0(V0)
9D01CAB4  03E00008   JR RA
9D01CAB8  00000000   NOP
890:                 		}
891:                 	}
892:                 
893:                 static void CURSOR_INVERT(void)
894:                 	{
895:                 //jar
896:                 //  disp_buffer[cy][cx] ^= showcursor;
897:                 	}
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/vid_drv.c  ---------------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** vid_drv.c
21:                  **
22:                  ** Video driver
23:                  ** $Id: vid_drv.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <string.h>
27:                  #include <noftypes.h>
28:                  #include <log.h>
29:                  #include <bitmap.h>
30:                  #include <vid_drv.h>
31:                  #include <gui.h>
32:                  #include <osd.h>
33:                  
34:                  /* hardware surface */
35:                  static bitmap_t *screen = NULL;
36:                  
37:                  /* primary / backbuffer surfaces */
38:                  static bitmap_t *primary_buffer = NULL; //, *back_buffer = NULL;
39:                  
40:                  static viddriver_t *driver = NULL;
41:                  
42:                  /* fast automagic loop unrolling */
43:                  #define  DUFFS_DEVICE(transfer, count) \
44:                  { \
45:                     register int n = (count + 7) / 8; \
46:                     switch (count % 8) \
47:                     { \
48:                     case 0:  do {  { transfer; } \
49:                     case 7:        { transfer; } \
50:                     case 6:        { transfer; } \
51:                     case 5:        { transfer; } \
52:                     case 4:        { transfer; } \
53:                     case 3:        { transfer; } \
54:                     case 2:        { transfer; } \
55:                     case 1:        { transfer; } \
56:                              } while (--n > 0); \
57:                     } \
58:                  }
59:                  
60:                  /* some system dependent replacement routines (for speed) */
61:                  INLINE int vid_memcmp(const void *p1, const void *p2, int len)
62:                  {
63:                     /* check for 32-bit aligned data */
64:                     if (0 == (((uint32) p1 & 3) | ((uint32) p2 & 3)))
65:                     {
66:                        uint32 *dw1 = (uint32 *) p1;
67:                        uint32 *dw2 = (uint32 *) p2;
68:                  
69:                        len >>= 2;
70:                  
71:                        DUFFS_DEVICE(if (*dw1++ != *dw2++) return -1, len);
72:                     }
73:                     else
74:                     /* fall back to 8-bit compares */
75:                     {
76:                        uint8 *b1 = (uint8 *) p1;
77:                        uint8 *b2 = (uint8 *) p2;
78:                        
79:                        DUFFS_DEVICE(if (*b1++ != *b2++) return -1, len);
80:                     }
81:                     
82:                     return 0;
83:                  }
84:                  
85:                  /* super-dooper assembly memcpy (thanks, SDL!) */
86:                  #if defined(__GNUC__) && defined(i386)
87:                  #define vid_memcpy(dest, src, len) \
88:                  { \
89:                     int u0, u1, u2; \
90:                     __asm__ __volatile__ ( \
91:                        "  cld            \n" \
92:                        "  rep            \n" \
93:                        "  movsl          \n" \
94:                        "  testb $2,%b4   \n" \
95:                        "  je    1f       \n" \
96:                        "  movsw          \n" \
97:                        "1:               \n" \
98:                        "  testb $1,%b4   \n" \
99:                        "  je 2f          \n" \
100:                       "  movsb          \n" \
101:                       "2:               \n" \
102:                       : "=&c" (u0), "=&D" (u1), "=&S" (u2) \
103:                       : "0" ((len)/4), "q" (len), "1" (dest), "2" (src) \
104:                       : "memory"); \
105:                 }
106:                 #else /* !(defined(__GNUC__) && defined(i386)) */
107:                 INLINE void vid_memcpy(void *dest, const void *src, int len)
108:                 {
109:                    uint32 *s = (uint32 *) src;
110:                    uint32 *d = (uint32 *) dest;
111:                 
112:                    ASSERT(0 == ((len & 3) | ((uint32) src & 3) | ((uint32) dest & 3)));
113:                    len >>= 2;
9D034450  0009C083   SRA T8, T1, 2
114:                 
115:                    DUFFS_DEVICE(*d++ = *s++, len);
9D034454  270B0007   ADDIU T3, T8, 7
9D034458  2704000E   ADDIU A0, T8, 14
9D03445C  296C0000   SLTI T4, T3, 0
9D034460  008C580B   MOVN T3, A0, T4
9D034464  000BC8C3   SRA T9, T3, 3
9D034468  00094FC3   SRA T1, T1, 31
9D03446C  00093742   SRL A2, T1, 29
9D034470  03066821   ADDU T5, T8, A2
9D034474  31A30007   ANDI V1, T5, 7
9D034478  00661023   SUBU V0, V1, A2
9D03447C  2C4B0008   SLTIU T3, V0, 8
9D034480  00024080   SLL T0, V0, 2
9D034484  3C189D03   LUI T8, -25341
9D034488  270444A8   ADDIU A0, T8, 17576
9D03448C  00886021   ADDU T4, A0, T0
9D034494  5160004F   BEQL T3, ZERO, 0x9D0345D4
9D034498  00AE2821   ADDU A1, A1, T6
9D03449C  8D890000   LW T1, 0(T4)
9D0344A0  01200008   JR T1
9D0344A4  00000000   NOP
9D0344C8  03201021   ADDU V0, T9, ZERO
9D0344CC  00E03021   ADDU A2, A3, ZERO
9D0344D0  00A02021   ADDU A0, A1, ZERO
9D0344D4  24D80004   ADDIU T8, A2, 4
9D0344D8  24890004   ADDIU T1, A0, 4
9D0344DC  8C830000   LW V1, 0(A0)
9D0344E0  0B40D13D   J 0x9D0344F4
9D0344E4  ACC30000   SW V1, 0(A2)
9D0344E8  03201021   ADDU V0, T9, ZERO
9D0344EC  00E0C021   ADDU T8, A3, ZERO
9D0344F0  00A04821   ADDU T1, A1, ZERO
9D0344F4  27030004   ADDIU V1, T8, 4
9D0344F8  25260004   ADDIU A2, T1, 4
9D0344FC  8D280000   LW T0, 0(T1)
9D034500  0B40D145   J 0x9D034514
9D034504  AF080000   SW T0, 0(T8)
9D034508  03201021   ADDU V0, T9, ZERO
9D03450C  00E01821   ADDU V1, A3, ZERO
9D034510  00A03021   ADDU A2, A1, ZERO
9D034514  24780004   ADDIU T8, V1, 4
9D034518  24C80004   ADDIU T0, A2, 4
9D03451C  8CC60000   LW A2, 0(A2)
9D034520  0B40D14D   J 0x9D034534
9D034524  AC660000   SW A2, 0(V1)
9D034528  03201021   ADDU V0, T9, ZERO
9D03452C  00E0C021   ADDU T8, A3, ZERO
9D034530  00A04021   ADDU T0, A1, ZERO
9D034534  27030004   ADDIU V1, T8, 4
9D034538  25060004   ADDIU A2, T0, 4
9D03453C  8D040000   LW A0, 0(T0)
9D034540  0B40D155   J 0x9D034554
9D034544  AF040000   SW A0, 0(T8)
9D034548  03201021   ADDU V0, T9, ZERO
9D03454C  00E01821   ADDU V1, A3, ZERO
9D034550  00A03021   ADDU A2, A1, ZERO
9D034554  24640004   ADDIU A0, V1, 4
9D034558  24C90004   ADDIU T1, A2, 4
9D03455C  8CD80000   LW T8, 0(A2)
9D034560  0B40D15D   J 0x9D034574
9D034564  AC780000   SW T8, 0(V1)
9D034568  03201021   ADDU V0, T9, ZERO
9D03456C  00E02021   ADDU A0, A3, ZERO
9D034570  00A04821   ADDU T1, A1, ZERO
9D034574  24980004   ADDIU T8, A0, 4
9D034578  25280004   ADDIU T0, T1, 4
9D03457C  8D230000   LW V1, 0(T1)
9D034580  0B40D165   J 0x9D034594
9D034584  AC830000   SW V1, 0(A0)
9D034588  03201021   ADDU V0, T9, ZERO
9D03458C  00E0C021   ADDU T8, A3, ZERO
9D034590  00A04021   ADDU T0, A1, ZERO
9D034594  27040004   ADDIU A0, T8, 4
9D034598  25030004   ADDIU V1, T0, 4
9D03459C  8D090000   LW T1, 0(T0)
9D0345A0  0B40D16D   J 0x9D0345B4
9D0345A4  AF090000   SW T1, 0(T8)
9D0345A8  03201021   ADDU V0, T9, ZERO
9D0345AC  00E02021   ADDU A0, A3, ZERO
9D0345B0  00A01821   ADDU V1, A1, ZERO
9D0345B4  8C680000   LW T0, 0(V1)
9D0345B8  2442FFFF   ADDIU V0, V0, -1
9D0345BC  18400004   BLEZ V0, 0x9D0345D0
9D0345C0  AC880000   SW T0, 0(A0)
9D0345C4  24860004   ADDIU A2, A0, 4
9D0345C8  0B40D135   J 0x9D0344D4
9D0345CC  24640004   ADDIU A0, V1, 4
116:                 }
117:                 #endif /* !(defined(__GNUC__) && defined(i386)) */
118:                 
119:                 
120:                 /* TODO: any way to remove this filth (GUI needs it)? */
121:                 bitmap_t *vid_getbuffer(void)
122:                 {
123:                    return primary_buffer;
124:                 }
9D03433C  03E00008   JR RA
9D034340  8F828088   LW V0, -32632(GP)
125:                 
126:                 void vid_setpalette(rgb_t *p)
127:                 {
9D034344  27BDFFE8   ADDIU SP, SP, -24
9D034348  AFBF0014   SW RA, 20(SP)
128:                    ASSERT(driver);
129:                    ASSERT(p);
130:                 
131:                    driver->set_palette(p);
9D03434C  8F828084   LW V0, -32636(GP)
9D034350  8C430010   LW V1, 16(V0)
9D034354  0060F809   JALR V1
9D034358  00000000   NOP
132:                 }
9D03435C  8FBF0014   LW RA, 20(SP)
9D034360  03E00008   JR RA
9D034364  27BD0018   ADDIU SP, SP, 24
133:                 
134:                 /* blits a bitmap onto primary buffer */
135:                 void vid_blit(bitmap_t *bitmap, int src_x, int src_y, int dest_x, int dest_y, 
136:                               int width, int height)
137:                 {
9D034368  8FA30010   LW V1, 16(SP)
138:                    int bitmap_pitch, primary_pitch;
139:                    uint8 *dest_ptr, *src_ptr;
140:                 
141:                    ASSERT(bitmap);
142:                 
143:                    /* clip to source */
144:                    if (src_y >= bitmap->height)
9D03436C  8C820004   LW V0, 4(A0)
9D034370  00C2482A   SLT T1, A2, V0
9D034374  1120009A   BEQ T1, ZERO, 0x9D0345E0
9D034378  8FA80018   LW T0, 24(SP)
145:                       return;
146:                    if (src_y + height > bitmap->height)
9D03437C  00C85021   ADDU T2, A2, T0
9D034380  004A582A   SLT T3, V0, T2
147:                       height = bitmap->height - src_y;
9D034384  00466023   SUBU T4, V0, A2
148:                 
149:                    if (src_x >= bitmap->width)
9D034388  8C8D0000   LW T5, 0(A0)
9D03438C  00AD702A   SLT T6, A1, T5
9D034390  11C00093   BEQ T6, ZERO, 0x9D0345E0
9D034394  018B400B   MOVN T0, T4, T3
150:                       return;
151:                    if (src_x + width > bitmap->width)
9D034398  8FAF0014   LW T7, 20(SP)
9D03439C  00AFC021   ADDU T8, A1, T7
9D0343A0  01B8C82A   SLT T9, T5, T8
152:                       width = bitmap->width - src_x;
9D0343A4  01A54823   SUBU T1, T5, A1
153:                 
154:                    /* clip to dest */
155:                    if (dest_y + height <= 0)
9D0343A8  00681021   ADDU V0, V1, T0
9D0343AC  1840008C   BLEZ V0, 0x9D0345E0
9D0343B0  01F9480A   MOVZ T1, T7, T9
156:                    {
157:                       return;
158:                    }
159:                    else if (dest_y < 0)
9D0343B4  04610004   BGEZ V1, 0x9D0343C8
9D0343B8  8F8A8088   LW T2, -32632(GP)
160:                    {
161:                       height += dest_y;
9D0343C0  00404021   ADDU T0, V0, ZERO
162:                       src_y -= dest_y;
9D0343BC  00C33023   SUBU A2, A2, V1
163:                       dest_y = 0;
9D0343C4  00001821   ADDU V1, ZERO, ZERO
164:                    }
165:                 
166:                    if (dest_y >= primary_buffer->height)
9D0343C8  8D4C0004   LW T4, 4(T2)
9D0343CC  006C582A   SLT T3, V1, T4
9D0343D0  11600083   BEQ T3, ZERO, 0x9D0345E0
9D0343D4  00686821   ADDU T5, V1, T0
167:                       return;
168:                    if (dest_y + height > primary_buffer->height)
9D0343D8  018D702A   SLT T6, T4, T5
169:                       height = primary_buffer->height - dest_y;
9D0343DC  0183C023   SUBU T8, T4, V1
170:                 
171:                    if (dest_x + width <= 0)
9D0343E0  00E97821   ADDU T7, A3, T1
9D0343E4  19E0007E   BLEZ T7, 0x9D0345E0
9D0343E8  010EC00A   MOVZ T8, T0, T6
172:                    {
173:                       return;
174:                    }
175:                    else if (dest_x < 0)
9D0343EC  04E10004   BGEZ A3, 0x9D034400
9D0343F0  8D590000   LW T9, 0(T2)
176:                    {
177:                       width += dest_x;
9D0343F8  01E04821   ADDU T1, T7, ZERO
178:                       src_x -= dest_x;
9D0343F4  00A72823   SUBU A1, A1, A3
179:                       dest_x = 0;
9D0343FC  00003821   ADDU A3, ZERO, ZERO
180:                    }
181:                 
182:                    if (dest_x >= primary_buffer->width)
9D034400  00F9102A   SLT V0, A3, T9
9D034404  10400076   BEQ V0, ZERO, 0x9D0345E0
9D034408  00E94021   ADDU T0, A3, T1
183:                       return;
184:                    if (dest_x + width > primary_buffer->width)
9D03440C  0328602A   SLT T4, T9, T0
185:                       width = primary_buffer->width - dest_x;   
9D034410  03275823   SUBU T3, T9, A3
9D034414  016C480B   MOVN T1, T3, T4
186:                 
187:                    src_ptr = bitmap->line[src_y] + src_x;
9D034418  24C60004   ADDIU A2, A2, 4
9D03441C  00066880   SLL T5, A2, 2
9D034420  008D7021   ADDU T6, A0, T5
9D034424  8DCF0004   LW T7, 4(T6)
9D034428  01E52821   ADDU A1, T7, A1
188:                    dest_ptr = primary_buffer->line[dest_y] + dest_x;
9D03442C  24630004   ADDIU V1, V1, 4
9D034430  0003C880   SLL T9, V1, 2
9D034434  01591021   ADDU V0, T2, T9
9D034438  8C480004   LW T0, 4(V0)
9D03443C  01073821   ADDU A3, T0, A3
189:                 
190:                    /* Avoid doing unnecessary indexed lookups */
191:                    bitmap_pitch = bitmap->pitch;
9D034440  8C8E0008   LW T6, 8(A0)
192:                    primary_pitch = primary_buffer->pitch;
9D034444  8D4F0008   LW T7, 8(T2)
193:                 
194:                    /* do the copy */
195:                    while (height--)
9D034448  13000065   BEQ T8, ZERO, 0x9D0345E0
9D03444C  270AFFFF   ADDIU T2, T8, -1
9D034490  240DFFFF   ADDIU T5, ZERO, -1
9D0345D4  254AFFFF   ADDIU T2, T2, -1
9D0345D8  154DFFAE   BNE T2, T5, 0x9D034494
9D0345DC  00EF3821   ADDU A3, A3, T7
9D0345E0  03E00008   JR RA
9D0345E4  00000000   NOP
196:                    {
197:                       vid_memcpy(dest_ptr, src_ptr, width);
198:                       src_ptr += bitmap_pitch;
9D0345D0  00AE2821   ADDU A1, A1, T6
9D0345D4  254AFFFF   ADDIU T2, T2, -1
9D0345D8  154DFFAE   BNE T2, T5, 0x9D034494
9D0345DC  00EF3821   ADDU A3, A3, T7
9D0345E0  03E00008   JR RA
9D0345E4  00000000   NOP
199:                       dest_ptr += primary_pitch;
200:                    }
201:                 }
202:                 
203:                 static void vid_blitscreen(int num_dirties, rect_t *dirty_rects)
204:                 {
205:                    int src_x, src_y, dest_x, dest_y;
206:                    int blit_width, blit_height;
207:                 
208:                    screen = driver->lock_write();
209:                 
210:                    /* center in y direction */
211:                    if (primary_buffer->height <= screen->height)
212:                    {
213:                       src_y = 0;
214:                       blit_height = primary_buffer->height;
215:                       dest_y = (screen->height - blit_height) >> 1;
216:                    }
217:                    else
218:                    {
219:                       src_y = (primary_buffer->height - screen->height) >> 1;
220:                       blit_height = screen->height;
221:                       dest_y = 0;
222:                    }
223:                 
224:                    /* and in x */
225:                    if (primary_buffer->width <= screen->width)
226:                    {
227:                       src_x = 0;
228:                       blit_width = primary_buffer->width;
229:                       dest_x = (screen->width - blit_width) >> 1;
230:                    }
231:                    else
232:                    {
233:                       src_x = (primary_buffer->width - screen->width) >> 1;
234:                       blit_width = screen->width;
235:                       dest_x = 0;
236:                    }
237:                    
238:                    /* should we just copy the entire screen? */
239:                    if (-1 == num_dirties)
240:                    {
241:                       uint8 *dest, *src;
242:                 
243:                       src = primary_buffer->line[src_y] + src_x;
244:                       dest = screen->line[dest_y] + dest_x;
245:                 
246:                       while (blit_height--)
247:                       {
248:                          vid_memcpy(dest, src, primary_buffer->width);
249:                          src += primary_buffer->pitch;
250:                          dest += screen->pitch;
251:                       }
252:                    }
253:                    else
254:                    {
255:                       /* we need to blit just a bunch of dirties */
256:                       int i, j, height;
257:                       rect_t *rects = dirty_rects;
258:                 
259:                       for (i = 0; i < num_dirties && blit_height; i++)
260:                       {
261:                          height = rects->h;
262:                          if (blit_height < height)
263:                             height = blit_height;
264:                 
265:                          j = 0;
266:                          DUFFS_DEVICE(  
267:                          {
268:                             vid_memcpy(screen->line[dest_y + rects->y + j] + rects->x + dest_x,
269:                                        primary_buffer->line[src_y + rects->y + j] + rects->x + src_x,
270:                                        rects->w);
271:                             j++;
272:                             blit_height--;
273:                          }, height);
274:                 
275:                          rects++;
276:                       }
277:                    }
278:                 
279:                    if (driver->free_write)
280:                       driver->free_write(num_dirties, dirty_rects);
281:                 }
282:                 
283:                 /* TODO: this code is sickly */
284:                 
285:                 #define  CHUNK_WIDTH    256
286:                 #define  CHUNK_HEIGHT   16
287:                 #define  MAX_DIRTIES    ((256 / CHUNK_WIDTH) * (240 / CHUNK_HEIGHT))
288:                 #define  DIRTY_CUTOFF   ((3 * MAX_DIRTIES) / 4)
289:                 
290:                 #if 0
291:                 INLINE int calc_dirties(rect_t *list)
292:                 {
293:                    bool dirty;
294:                    int num_dirties = 0;
295:                    int i = 0, j, line_offset = 0;
296:                    int iterations = primary_buffer->height / CHUNK_HEIGHT;
297:                 
298:                    for (i = 0; i < iterations; i++)
299:                    {
300:                       dirty = false;
301:                 
302:                       j = line_offset;
303:                       DUFFS_DEVICE(
304:                       { 
305:                          if (vid_memcmp(back_buffer->line[j], primary_buffer->line[j], 
306:                                         CHUNK_WIDTH))
307:                          { 
308:                             dirty = true; 
309:                             break; 
310:                          } 
311:                 
312:                          j++; 
313:                       }, CHUNK_HEIGHT);
314:                 
315:                       if (true == dirty)
316:                       {
317:                          list->h = CHUNK_HEIGHT;
318:                          list->w = CHUNK_WIDTH;
319:                          list->x = 0;
320:                          list->y = line_offset;
321:                          list++;
322:                 
323:                          /* totally arbitrary at this point */
324:                          if (++num_dirties > DIRTY_CUTOFF)
325:                             return -1;
326:                       }
327:                 
328:                       line_offset += CHUNK_HEIGHT;
329:                    }
330:                 
331:                    return num_dirties;
332:                 }
333:                 #endif
334:                 
335:                 void vid_flush(void)
336:                 {
9D0345E8  03E00008   JR RA
9D0345EC  00000000   NOP
337:                    bitmap_t *temp;
338:                    int num_dirties;
339:                    rect_t dirty_rects[MAX_DIRTIES];
340:                 
341:                    //ASSERT(driver);
342:                 
343:                 //   if (true == driver->invalidate)
344:                 //   {
345:                 //      driver->invalidate = false;
346:                 //      num_dirties = -1;
347:                 //   }
348:                    //else
349:                    //{
350:                       //num_dirties = calc_dirties(dirty_rects);
351:                       num_dirties = -1;
352:                    //}
353:                 
354:                    //if (driver->custom_blit)
355:                    //   driver->custom_blit(primary_buffer, num_dirties, dirty_rects);
356:                    //else
357:                       //vid_blitscreen(num_dirties, dirty_rects);
358:                 
359:                    /* Swap pointers to the main/back buffers */
360:                 //   temp = back_buffer;
361:                 //   back_buffer = primary_buffer;
362:                 //   primary_buffer = temp;
363:                 }
364:                 
365:                 /* emulated machine tells us which resolution it wants */
366:                 int vid_setmode(int width, int height)
367:                 {
9D0345F0  27BDFFE0   ADDIU SP, SP, -32
9D0345F4  AFBF001C   SW RA, 28(SP)
9D0345F8  AFB10018   SW S1, 24(SP)
9D0345FC  AFB00014   SW S0, 20(SP)
9D034600  00808821   ADDU S1, A0, ZERO
368:                    if (NULL != primary_buffer)
9D034604  8F828088   LW V0, -32632(GP)
9D034608  10400003   BEQ V0, ZERO, .LVL57
9D03460C  00A08021   ADDU S0, A1, ZERO
369:                       bmp_destroy(&primary_buffer);
9D034610  0F40E130   JAL bmp_destroy
9D034614  27848088   ADDIU A0, GP, -32632
370:                 //   if (NULL != back_buffer)
371:                 //      bmp_destroy(&back_buffer);
372:                 
373:                    primary_buffer = bmp_create(width, height, 0); /* no overdraw */
9D034618  02202021   ADDU A0, S1, ZERO
9D03461C  02002821   ADDU A1, S0, ZERO
9D034620  0F40E105   JAL bmp_create
9D034624  00003021   ADDU A2, ZERO, ZERO
374:                    if (NULL == primary_buffer)
9D034628  10400006   BEQ V0, ZERO, 0x9D034644
9D03462C  AF828088   SW V0, -32632(GP)
375:                       return -1;
9D034644  2402FFFF   ADDIU V0, ZERO, -1
376:                 
377:                    /* Create our backbuffer */
378:                 #if 0
379:                    back_buffer = bmp_create(width, height, 0); /* no overdraw */
380:                    if (NULL == back_buffer)
381:                    {
382:                       bmp_destroy(&primary_buffer);
383:                       return -1;
384:                    }
385:                    bmp_clear(back_buffer, GUI_BLACK);
386:                 #endif
387:                    bmp_clear(primary_buffer, GUI_BLACK);
9D034630  00402021   ADDU A0, V0, ZERO
9D034634  0F40E0FB   JAL bmp_clear
9D034638  240500C0   ADDIU A1, ZERO, 192
388:                 
389:                    return 0;
9D03463C  0B40D192   J 0x9D034648
9D034640  00001021   ADDU V0, ZERO, ZERO
390:                 }
9D034648  8FBF001C   LW RA, 28(SP)
9D03464C  8FB10018   LW S1, 24(SP)
9D034650  8FB00014   LW S0, 20(SP)
9D034654  03E00008   JR RA
9D034658  27BD0020   ADDIU SP, SP, 32
391:                 
392:                 static int vid_findmode(int width, int height, viddriver_t *osd_driver)
393:                 {
394:                    if (osd_driver->init(width, height))
9D03467C  8CC20004   LW V0, 4(A2)
9D034680  0040F809   JALR V0
9D034684  00C08021   ADDU S0, A2, ZERO
9D034688  1040000A   BEQ V0, ZERO, 0x9D0346B4
9D03468C  00408821   ADDU S1, V0, ZERO
395:                    {
396:                       driver = NULL;
9D034690  AF808084   SW ZERO, -32636(GP)
397:                       return -1; /* mode not available! */
398:                    }
399:                 
400:                    /* we got our driver */
401:                    driver = osd_driver;
9D0346B4  AF908084   SW S0, -32636(GP)
402:                 
403:                    /* re-assert dimensions, clear the surface */
404:                    screen = driver->lock_write();
9D0346B8  8E130018   LW S3, 24(S0)
9D0346BC  0260F809   JALR S3
9D0346C0  00000000   NOP
9D0346C4  AF82808C   SW V0, -32628(GP)
405:                 
406:                    /* use custom pageclear, if necessary */
407:                    if (driver->clear)
9D0346C8  8F838084   LW V1, -32636(GP)
9D0346CC  8C650014   LW A1, 20(V1)
9D0346D0  50A00005   BEQL A1, ZERO, 0x9D0346E8
9D0346D4  00402021   ADDU A0, V0, ZERO
408:                       driver->clear(GUI_BLACK);
9D0346D8  00A0F809   JALR A1
9D0346DC  240400C0   ADDIU A0, ZERO, 192
409:                    else
410:                       bmp_clear(screen, GUI_BLACK);
9D0346E8  0F40E0FB   JAL bmp_clear
9D0346EC  240500C0   ADDIU A1, ZERO, 192
411:                 
412:                    /* release surface */
413:                    if (driver->free_write)
9D0346E0  0B40D1BD   J 0x9D0346F4
9D0346E4  8F848084   LW A0, -32636(GP)
9D0346F0  8F848084   LW A0, -32636(GP)
9D0346F4  8C86001C   LW A2, 28(A0)
9D0346F8  50C00005   BEQL A2, ZERO, 0x9D034710
9D0346FC  8F87808C   LW A3, -32628(GP)
414:                       driver->free_write(-1, NULL);
9D034700  2404FFFF   ADDIU A0, ZERO, -1
9D034704  00C0F809   JALR A2
9D034708  00002821   ADDU A1, ZERO, ZERO
415:                 
416:                    log_printf("video driver: %s at %dx%d\n", driver->name,
9D034710  3C089D04   LUI T0, -25340
9D034714  2504181C   ADDIU A0, T0, 6172
9D034718  8F898084   LW T1, -32636(GP)
9D03471C  8D250000   LW A1, 0(T1)
9D034720  8CE60000   LW A2, 0(A3)
9D034724  0F410817   JAL log_printf
9D034728  8CE70004   LW A3, 4(A3)
417:                               screen->width, screen->height);
9D03470C  8F87808C   LW A3, -32628(GP)
418:                 
419:                    return 0;
420:                 }
421:                 
422:                 /* This is the interface to the drivers, used in nofrendo.c */
423:                 int vid_init(int width, int height, viddriver_t *osd_driver)
424:                 {
9D03465C  27BDFFD8   ADDIU SP, SP, -40
9D034660  AFBF0024   SW RA, 36(SP)
9D034664  AFB30020   SW S3, 32(SP)
9D034668  AFB2001C   SW S2, 28(SP)
9D03466C  AFB10018   SW S1, 24(SP)
9D034670  AFB00014   SW S0, 20(SP)
9D034674  00809821   ADDU S3, A0, ZERO
9D034678  00A09021   ADDU S2, A1, ZERO
425:                    if (vid_findmode(width, height, osd_driver))
426:                    {
427:                       log_printf("video initialization failed for %s at %dx%d\n",
9D034694  3C0B9D04   LUI T3, -25340
9D034698  256417EC   ADDIU A0, T3, 6124
9D03469C  8E050000   LW A1, 0(S0)
9D0346A0  02603021   ADDU A2, S3, ZERO
9D0346A4  0F410817   JAL log_printf
9D0346A8  02403821   ADDU A3, S2, ZERO
428:                                  osd_driver->name, width, height);
429:                       return -1;
9D0346AC  0B40D1CE   J .LVL72
9D0346B0  2411FFFF   ADDIU S1, ZERO, -1
430:                    }
431:                 	log_printf("vid_init done\n");
9D03472C  3C0A9D04   LUI T2, -25340
9D034730  0F410817   JAL log_printf
9D034734  25441838   ADDIU A0, T2, 6200
432:                 
433:                    return 0;
434:                 }
9D034738  02201021   ADDU V0, S1, ZERO
9D03473C  8FBF0024   LW RA, 36(SP)
9D034740  8FB30020   LW S3, 32(SP)
9D034744  8FB2001C   LW S2, 28(SP)
9D034748  8FB10018   LW S1, 24(SP)
9D03474C  8FB00014   LW S0, 20(SP)
9D034750  03E00008   JR RA
9D034754  27BD0028   ADDIU SP, SP, 40
435:                 
436:                 void vid_shutdown(void)
437:                 {
9D034758  27BDFFE8   ADDIU SP, SP, -24
9D03475C  AFBF0014   SW RA, 20(SP)
438:                    if (NULL == driver)
9D034760  8F828084   LW V0, -32636(GP)
9D034764  1040000D   BEQ V0, ZERO, 0x9D03479C
9D034768  8F838088   LW V1, -32632(GP)
439:                       return;
440:                 
441:                    if (NULL != primary_buffer)
9D03476C  50600007   BEQL V1, ZERO, 0x9D03478C
9D034770  8C440008   LW A0, 8(V0)
442:                       bmp_destroy(&primary_buffer);
9D034774  0F40E130   JAL bmp_destroy
9D034778  27848088   ADDIU A0, GP, -32632
443:                 #if 0
444:                    if (NULL != back_buffer)
445:                       bmp_destroy(&back_buffer);
446:                 #endif
447:                 
448:                    if (driver && driver->shutdown)
9D03477C  8F828084   LW V0, -32636(GP)
9D034780  10400007   BEQ V0, ZERO, 0x9D0347A0
9D034784  8FBF0014   LW RA, 20(SP)
9D034788  8C440008   LW A0, 8(V0)
9D03478C  10800004   BEQ A0, ZERO, 0x9D0347A0
9D034790  8FBF0014   LW RA, 20(SP)
449:                       driver->shutdown();
9D034794  0080F809   JALR A0
9D034798  00000000   NOP
450:                 }
9D03479C  8FBF0014   LW RA, 20(SP)
9D0347A0  03E00008   JR RA
9D0347A4  27BD0018   ADDIU SP, SP, 24
451:                 
452:                 
453:                 /*
454:                 ** $Log: vid_drv.c,v $
455:                 ** Revision 1.2  2001/04/27 14:37:11  neil
456:                 ** wheeee
457:                 **
458:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
459:                 ** initial
460:                 **
461:                 ** Revision 1.40  2000/11/25 20:26:42  matt
462:                 ** not much
463:                 **
464:                 ** Revision 1.39  2000/11/16 14:27:27  matt
465:                 ** even more crash-proofness
466:                 **
467:                 ** Revision 1.38  2000/11/16 14:11:18  neil
468:                 ** Better *not* to crash in case of catastrophic failure in the driver
469:                 **
470:                 ** Revision 1.37  2000/11/13 00:55:16  matt
471:                 ** no dirties seems to be faster (!?!?)
472:                 **
473:                 ** Revision 1.36  2000/11/06 05:16:18  matt
474:                 ** minor clipping bug
475:                 **
476:                 ** Revision 1.35  2000/11/06 02:16:26  matt
477:                 ** cleanups
478:                 **
479:                 ** Revision 1.34  2000/11/05 22:53:13  matt
480:                 ** only one video driver per system, please
481:                 **
482:                 ** Revision 1.33  2000/11/05 16:37:18  matt
483:                 ** rolled rgb.h into bitmap.h
484:                 **
485:                 ** Revision 1.32  2000/11/05 06:23:41  matt
486:                 ** thinlib spawns changes
487:                 **
488:                 ** Revision 1.31  2000/10/10 13:58:14  matt
489:                 ** stroustrup squeezing his way in the door
490:                 **
491:                 ** Revision 1.30  2000/10/10 13:03:53  matt
492:                 ** Mr. Clean makes a guest appearance
493:                 **
494:                 ** Revision 1.29  2000/10/08 17:58:23  matt
495:                 ** lock_read() should not allow us to clear the bitmap
496:                 **
497:                 ** Revision 1.28  2000/09/18 02:06:48  matt
498:                 ** -pedantic is your friend
499:                 **
500:                 ** Revision 1.27  2000/08/16 02:53:05  matt
501:                 ** changed init() interface a wee bit
502:                 **
503:                 ** Revision 1.26  2000/08/14 02:45:59  matt
504:                 ** fixed nasty bug in vid_blitscreen
505:                 **
506:                 ** Revision 1.24  2000/08/11 01:44:37  matt
507:                 ** clipping bugfix
508:                 **
509:                 ** Revision 1.23  2000/07/31 04:28:47  matt
510:                 ** one million cleanups
511:                 **
512:                 ** Revision 1.22  2000/07/28 07:25:49  neil
513:                 ** Video driver has an invalidate flag, telling vid_drv not to calculate dirties for the next frame
514:                 **
515:                 ** Revision 1.21  2000/07/28 03:51:45  matt
516:                 ** lock_read used instead of lock_write in some places
517:                 **
518:                 ** Revision 1.20  2000/07/28 01:24:05  matt
519:                 ** dirty rectangle support
520:                 **
521:                 ** Revision 1.19  2000/07/27 23:49:52  matt
522:                 ** no more getmode
523:                 **
524:                 ** Revision 1.18  2000/07/27 04:30:37  matt
525:                 ** change to get_mode api
526:                 **
527:                 ** Revision 1.17  2000/07/27 04:05:58  matt
528:                 ** changed place where name goes
529:                 **
530:                 ** Revision 1.16  2000/07/27 01:16:22  matt
531:                 ** api changes for new main and dirty rects
532:                 **
533:                 ** Revision 1.15  2000/07/26 21:36:13  neil
534:                 ** Big honkin' change -- see the mailing list
535:                 **
536:                 ** Revision 1.14  2000/07/24 04:33:57  matt
537:                 ** skeleton of dirty rectangle code in place
538:                 **
539:                 ** Revision 1.13  2000/07/23 14:35:39  matt
540:                 ** cleanups
541:                 **
542:                 ** Revision 1.12  2000/07/18 19:41:26  neil
543:                 ** use screen->pitch in blitscreen, not screen_width
544:                 **
545:                 ** Revision 1.11  2000/07/11 04:30:16  matt
546:                 ** overdraw unnecessary!
547:                 **
548:                 ** Revision 1.10  2000/07/10 19:07:57  matt
549:                 ** added custom clear() member call to video driver
550:                 **
551:                 ** Revision 1.9  2000/07/10 03:06:49  matt
552:                 ** my dependency file is broken... *snif*
553:                 **
554:                 ** Revision 1.8  2000/07/10 03:04:15  matt
555:                 ** removed scanlines, backbuffer from custom blit
556:                 **
557:                 ** Revision 1.7  2000/07/10 01:03:20  neil
558:                 ** New video scheme allows for custom blitters to be determined by the driver at runtime
559:                 **
560:                 ** Revision 1.6  2000/07/09 03:34:46  matt
561:                 ** temporary cleanup
562:                 **
563:                 ** Revision 1.5  2000/07/08 23:48:29  neil
564:                 ** Another assumption GGI kills: pitch == width for hardware bitmaps
565:                 **
566:                 ** Revision 1.4  2000/07/07 20:18:03  matt
567:                 ** added overdraw, fixed some bugs in blitters
568:                 **
569:                 ** Revision 1.3  2000/07/07 18:33:55  neil
570:                 ** no need to lock for reading just to get the dimensions
571:                 **
572:                 ** Revision 1.2  2000/07/07 18:11:37  neil
573:                 ** Generalizing the video driver
574:                 **
575:                 ** Revision 1.1  2000/07/06 16:48:47  matt
576:                 ** initial revision
577:                 **
578:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/sndhrdw/vrcvisnd.c  ------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** vrcvisnd.c
21:                  **
22:                  ** VRCVI sound hardware emulation
23:                  ** $Id: vrcvisnd.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <vrcvisnd.h>
28:                  #include <nes_apu.h>
29:                  
30:                  typedef struct vrcvirectangle_s
31:                  {
32:                     bool enabled;
33:                  
34:                     uint8 reg[3];
35:                     
36:                     float accum;
37:                     uint8 adder;
38:                  
39:                     int32 freq;
40:                     int32 volume;
41:                     uint8 duty_flip;
42:                  } vrcvirectangle_t;
43:                  
44:                  typedef struct vrcvisawtooth_s
45:                  {
46:                     bool enabled;
47:                     
48:                     uint8 reg[3];
49:                     
50:                     float accum;
51:                     uint8 adder;
52:                     uint8 output_acc;
53:                  
54:                     int32 freq;
55:                     uint8 volume;
56:                  } vrcvisawtooth_t;
57:                  
58:                  typedef struct vrcvisnd_s
59:                  {
60:                     vrcvirectangle_t rectangle[2];
61:                     vrcvisawtooth_t saw;
62:                     float incsize;
63:                  } vrcvisnd_t;
64:                  
65:                  
66:                  static vrcvisnd_t vrcvi;
67:                  
68:                  /* VRCVI rectangle wave generation */
69:                  static int32 vrcvi_rectangle(vrcvirectangle_t *chan)
70:                  {
9D032E44  27BDFFD8   ADDIU SP, SP, -40
9D032E48  AFBF0024   SW RA, 36(SP)
9D032E4C  AFB30020   SW S3, 32(SP)
9D032E50  AFB2001C   SW S2, 28(SP)
9D032E54  AFB10018   SW S1, 24(SP)
9D032E58  AFB00014   SW S0, 20(SP)
9D032E5C  00809821   ADDU S3, A0, ZERO
71:                     /* reg0: 0-3=volume, 4-6=duty cycle
72:                     ** reg1: 8 bits of freq
73:                     ** reg2: 0-3=high freq, 7=enable
74:                     */
75:                  
76:                     chan->accum -= vrcvi.incsize; /* # of clocks per wave cycle */
9D032E60  8C840008   LW A0, 8(A0)
9D032E64  3C02A001   LUI V0, -24575
9D032E68  0F40EA50   JAL __subsf3
9D032E6C  8C454D6C   LW A1, 19820(V0)
9D032E70  00408021   ADDU S0, V0, ZERO
9D032E74  AE620008   SW V0, 8(S3)
77:                     while (chan->accum < 0)
9D032E78  00402021   ADDU A0, V0, ZERO
9D032E7C  0F4101F6   JAL __lesf2
9D032E80  00002821   ADDU A1, ZERO, ZERO
9D032E84  04430013   BGEZL V0, 0x9D032ED4
9D032E88  8E640000   LW A0, 0(S3)
9D032EB4  00402021   ADDU A0, V0, ZERO
9D032EB8  0F4101F6   JAL __lesf2
9D032EBC  00002821   ADDU A1, ZERO, ZERO
9D032EC0  0440FFF7   BLTZ V0, 0x9D032EA0
9D032EC4  02002021   ADDU A0, S0, ZERO
9D032EC8  AE700008   SW S0, 8(S3)
9D032ECC  A271000C   SB S1, 12(S3)
78:                     {
79:                        chan->accum += chan->freq;
9D032E8C  0F4105E3   JAL sitofp
9D032E90  8E640010   LW A0, 16(S3)
9D032E94  00409021   ADDU S2, V0, ZERO
9D032E98  9271000C   LBU S1, 12(S3)
9D032E9C  02002021   ADDU A0, S0, ZERO
9D032EA0  0F40EA52   JAL fpadd
9D032EA4  02402821   ADDU A1, S2, ZERO
9D032EA8  00408021   ADDU S0, V0, ZERO
80:                        chan->adder = (chan->adder + 1) & 0x0F;
9D032EAC  26230001   ADDIU V1, S1, 1
9D032EB0  3071000F   ANDI S1, V1, 15
81:                     }
82:                  
83:                     /* return if not enabled */
84:                     if (false == chan->enabled)
9D032ED0  8E640000   LW A0, 0(S3)
9D032ED4  10800008   BEQ A0, ZERO, 0x9D032EF8
9D032ED8  00001021   ADDU V0, ZERO, ZERO
85:                        return 0;
86:                  
87:                     if (chan->adder < chan->duty_flip)
9D032EDC  9265000C   LBU A1, 12(S3)
9D032EE0  92660018   LBU A2, 24(S3)
9D032EE4  00A6382B   SLTU A3, A1, A2
9D032EE8  50E00003   BEQL A3, ZERO, 0x9D032EF8
9D032EEC  8E620014   LW V0, 20(S3)
88:                        return -(chan->volume);
9D032EF0  8E680014   LW T0, 20(S3)
9D032EF4  00081023   SUBU V0, ZERO, T0
89:                     else
90:                        return chan->volume;
91:                  }
9D032EF8  8FBF0024   LW RA, 36(SP)
9D032EFC  8FB30020   LW S3, 32(SP)
9D032F00  8FB2001C   LW S2, 28(SP)
9D032F04  8FB10018   LW S1, 24(SP)
9D032F08  8FB00014   LW S0, 20(SP)
9D032F0C  03E00008   JR RA
9D032F10  27BD0028   ADDIU SP, SP, 40
92:                  
93:                  /* VRCVI sawtooth wave generation */
94:                  static int32 vrcvi_sawtooth(vrcvisawtooth_t *chan)
95:                  {
96:                     /* reg0: 0-5=phase accumulator bits
97:                     ** reg1: 8 bits of freq
98:                     ** reg2: 0-3=high freq, 7=enable
99:                     */
100:                 
101:                    chan->accum -= vrcvi.incsize; /* # of clocks per wav cycle */
9D032F5C  26114D1C   ADDIU S1, S0, 19740
9D032F60  8E240040   LW A0, 64(S1)
9D032F64  0F40EA50   JAL __subsf3
9D032F68  8E250050   LW A1, 80(S1)
102:                    while (chan->accum < 0)
9D032FB4  00402021   ADDU A0, V0, ZERO
9D032FB8  0F4101F6   JAL __lesf2
9D032FBC  00002821   ADDU A1, ZERO, ZERO
9D032FC0  0440005B   BLTZ V0, 0x9D033130
9D032FC4  3C1FA001   LUI RA, -24575
9D032FC8  0B40CC03   J 0x9D03300C
9D032FCC  27E24D1C   ADDIU V0, RA, 19740
9D032FEC  1460001D   BNE V1, ZERO, 0x9D033064
9D032FF0  02002021   ADDU A0, S0, ZERO
9D032FF4  02002021   ADDU A0, S0, ZERO
9D032FF8  0F4101F6   JAL __lesf2
9D032FFC  00002821   ADDU A1, ZERO, ZERO
9D033000  0440FFE1   BLTZ V0, 0x9D032F88
9D033004  3C1FA001   LUI RA, -24575
9D033008  27E24D1C   ADDIU V0, RA, 19740
9D03300C  AC500040   SW S0, 64(V0)
9D033010  A0520045   SB S2, 69(V0)
9D033014  A0510044   SB S1, 68(V0)
9D033064  0F4101F6   JAL __lesf2
9D033068  00002821   ADDU A1, ZERO, ZERO
9D03306C  0441FFE6   BGEZ V0, 0x9D033008
9D033070  3C1FA001   LUI RA, -24575
9D0330AC  10C90011   BEQ A2, T1, 0x9D0330F4
9D0330B0  02002021   ADDU A0, S0, ZERO
9D0330B4  00402021   ADDU A0, V0, ZERO
9D0330B8  0F4101F6   JAL __lesf2
9D0330BC  00002821   ADDU A1, ZERO, ZERO
9D0330C0  0441FFD1   BGEZ V0, 0x9D033008
9D0330C4  3C1FA001   LUI RA, -24575
9D0330F0  02002021   ADDU A0, S0, ZERO
9D0330F4  0F4101F6   JAL __lesf2
9D0330F8  00002821   ADDU A1, ZERO, ZERO
9D0330FC  0441FFC2   BGEZ V0, 0x9D033008
9D033100  3C1FA001   LUI RA, -24575
9D033158  00402021   ADDU A0, V0, ZERO
9D03315C  0F4101F6   JAL __lesf2
9D033160  00002821   ADDU A1, ZERO, ZERO
9D033164  0441FFA8   BGEZ V0, 0x9D033008
9D033168  3C1FA001   LUI RA, -24575
9D033194  00402021   ADDU A0, V0, ZERO
9D033198  0F4101F6   JAL __lesf2
9D03319C  00002821   ADDU A1, ZERO, ZERO
9D0331A0  0441FF99   BGEZ V0, 0x9D033008
9D0331A4  3C1FA001   LUI RA, -24575
103:                    {
104:                       chan->accum += chan->freq;
9D032F6C  8E340048   LW S4, 72(S1)
9D032F88  0F4105E3   JAL sitofp
9D032F8C  02802021   ADDU A0, S4, ZERO
9D032F90  00402021   ADDU A0, V0, ZERO
9D032F94  0F40EA52   JAL fpadd
9D032F98  02002821   ADDU A1, S0, ZERO
9D032F9C  02537021   ADDU T6, S2, S3
9D032FA0  262F0001   ADDIU T7, S1, 1
9D032FA4  31F100FF   ANDI S1, T7, 255
9D032FB0  00408021   ADDU S0, V0, ZERO
9D032FD0  00408021   ADDU S0, V0, ZERO
9D033074  0F4105E3   JAL sitofp
9D033078  02802021   ADDU A0, S4, ZERO
9D03307C  00402021   ADDU A0, V0, ZERO
9D033080  0F40EA52   JAL fpadd
9D033084  02002821   ADDU A1, S0, ZERO
9D033088  02539021   ADDU S2, S2, S3
9D03308C  325200FF   ANDI S2, S2, 255
9D033090  26250001   ADDIU A1, S1, 1
9D033094  30B100FF   ANDI S1, A1, 255
9D033098  7C173420   SEB A2, S7
9D03309C  24070001   ADDIU A3, ZERO, 1
9D0330A0  10C7FFD4   BEQ A2, A3, 0x9D032FF4
9D0330A4  00408021   ADDU S0, V0, ZERO
9D0330A8  24090002   ADDIU T1, ZERO, 2
9D0330C8  0F4105E3   JAL sitofp
9D0330CC  02802021   ADDU A0, S4, ZERO
9D0330D0  00402021   ADDU A0, V0, ZERO
9D0330D4  0F40EA52   JAL fpadd
9D0330D8  02002821   ADDU A1, S0, ZERO
9D0330DC  02535021   ADDU T2, S2, S3
9D0330E0  315200FF   ANDI S2, T2, 255
9D0330E4  262B0001   ADDIU T3, S1, 1
9D0330E8  317100FF   ANDI S1, T3, 255
9D0330EC  00408021   ADDU S0, V0, ZERO
9D033104  0F4105E3   JAL sitofp
9D033108  02802021   ADDU A0, S4, ZERO
9D03310C  00402021   ADDU A0, V0, ZERO
9D033110  0F40EA52   JAL fpadd
9D033114  02002821   ADDU A1, S0, ZERO
9D033118  02536021   ADDU T4, S2, S3
9D03311C  319200FF   ANDI S2, T4, 255
9D033120  262D0001   ADDIU T5, S1, 1
9D033124  31B100FF   ANDI S1, T5, 255
9D033128  0B40CBFD   J 0x9D032FF4
9D03312C  00408021   ADDU S0, V0, ZERO
9D033130  0F4105E3   JAL sitofp
9D033134  02802021   ADDU A0, S4, ZERO
9D033138  00402021   ADDU A0, V0, ZERO
9D03313C  0F40EA52   JAL fpadd
9D033140  02002821   ADDU A1, S0, ZERO
9D033144  0253C021   ADDU T8, S2, S3
9D033148  331200FF   ANDI S2, T8, 255
9D03314C  26390001   ADDIU T9, S1, 1
9D033150  333100FF   ANDI S1, T9, 255
9D033154  00408021   ADDU S0, V0, ZERO
9D03316C  0F4105E3   JAL sitofp
9D033170  02802021   ADDU A0, S4, ZERO
9D033174  00402021   ADDU A0, V0, ZERO
9D033178  0F40EA52   JAL fpadd
9D03317C  02002821   ADDU A1, S0, ZERO
9D033180  02538021   ADDU S0, S2, S3
9D033184  321200FF   ANDI S2, S0, 255
9D033188  26240001   ADDIU A0, S1, 1
9D03318C  309100FF   ANDI S1, A0, 255
9D033190  00408021   ADDU S0, V0, ZERO
9D0331A8  0F4105E3   JAL sitofp
9D0331AC  02802021   ADDU A0, S4, ZERO
9D0331B0  00402021   ADDU A0, V0, ZERO
9D0331B4  0F40EA52   JAL fpadd
9D0331B8  02002821   ADDU A1, S0, ZERO
9D0331BC  02533021   ADDU A2, S2, S3
9D0331C0  30D200FF   ANDI S2, A2, 255
9D0331C4  26270001   ADDIU A3, S1, 1
9D0331C8  30F100FF   ANDI S1, A3, 255
9D0331CC  0B40CBFD   J 0x9D032FF4
9D0331D0  00408021   ADDU S0, V0, ZERO
105:                       chan->output_acc += chan->volume;
9D032F70  9233004C   LBU S3, 76(S1)
9D032F74  92320045   LBU S2, 69(S1)
9D032F78  92310044   LBU S1, 68(S1)
9D032F7C  00408021   ADDU S0, V0, ZERO
106:                       
107:                       chan->adder++;
108:                       if (7 == chan->adder)
9D032F80  0B40CBF7   J 0x9D032FDC
9D032F84  24150007   ADDIU S5, ZERO, 7
9D032FA8  12350009   BEQ S1, S5, 0x9D032FD0
9D032FAC  31D200FF   ANDI S2, T6, 255
109:                       {
110:                          chan->adder = 0;
9D032FD8  00008821   ADDU S1, ZERO, ZERO
9D032FDC  0011B827   NOR S7, ZERO, S1
9D032FE0  02F51021   ADDU V0, S7, S5
9D032FE4  30570003   ANDI S7, V0, 3
9D032FE8  7C171C20   SEB V1, S7
111:                          chan->output_acc = 0;
9D032FD4  00009021   ADDU S2, ZERO, ZERO
112:                       }
113:                    }
114:                 
115:                    /* return if not enabled */
116:                    if (false == chan->enabled)
9D033018  8C510038   LW S1, 56(V0)
9D03301C  12200005   BEQ S1, ZERO, 0x9D033034
9D033020  00002821   ADDU A1, ZERO, ZERO
117:                       return 0;
118:                 
119:                    return (chan->output_acc >> 3) << 9;
9D033024  3C17A001   LUI S7, -24575
9D033028  92E34D61   LBU V1, 19809(S7)
9D03302C  000390C2   SRL S2, V1, 3
9D033030  00122A40   SLL A1, S2, 9
120:                 }
121:                 
122:                 /* mix vrcvi sound channels together */
123:                 static int32 vrcvi_process(void)
124:                 {
9D032F14  27BDFFC8   ADDIU SP, SP, -56
9D032F18  AFBF0034   SW RA, 52(SP)
9D032F1C  AFB70030   SW S7, 48(SP)
9D032F20  AFB6002C   SW S6, 44(SP)
9D032F24  AFB50028   SW S5, 40(SP)
9D032F28  AFB40024   SW S4, 36(SP)
9D032F2C  AFB30020   SW S3, 32(SP)
9D032F30  AFB2001C   SW S2, 28(SP)
9D032F34  AFB10018   SW S1, 24(SP)
9D032F38  AFB00014   SW S0, 20(SP)
125:                    int32 output;
126:                 
127:                    output = vrcvi_rectangle(&vrcvi.rectangle[0]);
9D032F3C  3C10A001   LUI S0, -24575
9D032F40  0F40CB91   JAL .Letext0, .LFE14, .LFB0, vrcvi_rectangle, .Ltext0
9D032F44  26044D1C   ADDIU A0, S0, 19740
9D032F48  0040B021   ADDU S6, V0, ZERO
128:                    output += vrcvi_rectangle(&vrcvi.rectangle[1]);
9D032F4C  3C04A001   LUI A0, -24575
9D032F50  0F40CB91   JAL .Letext0, .LFE14, .LFB0, vrcvi_rectangle, .Ltext0
9D032F54  24844D38   ADDIU A0, A0, 19768
9D032F58  0056B021   ADDU S6, V0, S6
129:                    output += vrcvi_sawtooth(&vrcvi.saw);
130:                 
131:                    return output;
132:                 }
9D033034  02C51021   ADDU V0, S6, A1
9D033038  8FBF0034   LW RA, 52(SP)
9D03303C  8FB70030   LW S7, 48(SP)
9D033040  8FB6002C   LW S6, 44(SP)
9D033044  8FB50028   LW S5, 40(SP)
9D033048  8FB40024   LW S4, 36(SP)
9D03304C  8FB30020   LW S3, 32(SP)
9D033050  8FB2001C   LW S2, 28(SP)
9D033054  8FB10018   LW S1, 24(SP)
9D033058  8FB00014   LW S0, 20(SP)
9D03305C  03E00008   JR RA
9D033060  27BD0038   ADDIU SP, SP, 56
9D033064  0F4101F6   JAL __lesf2
9D033068  00002821   ADDU A1, ZERO, ZERO
9D03306C  0441FFE6   BGEZ V0, 0x9D033008
9D033070  3C1FA001   LUI RA, -24575
9D033074  0F4105E3   JAL sitofp
9D033078  02802021   ADDU A0, S4, ZERO
9D03307C  00402021   ADDU A0, V0, ZERO
9D033080  0F40EA52   JAL fpadd
9D033084  02002821   ADDU A1, S0, ZERO
9D033088  02539021   ADDU S2, S2, S3
9D03308C  325200FF   ANDI S2, S2, 255
9D033090  26250001   ADDIU A1, S1, 1
9D033094  30B100FF   ANDI S1, A1, 255
9D033098  7C173420   SEB A2, S7
9D03309C  24070001   ADDIU A3, ZERO, 1
9D0330A0  10C7FFD4   BEQ A2, A3, 0x9D032FF4
9D0330A4  00408021   ADDU S0, V0, ZERO
9D0330A8  24090002   ADDIU T1, ZERO, 2
9D0330AC  10C90011   BEQ A2, T1, 0x9D0330F4
9D0330B0  02002021   ADDU A0, S0, ZERO
9D0330B4  00402021   ADDU A0, V0, ZERO
9D0330B8  0F4101F6   JAL __lesf2
9D0330BC  00002821   ADDU A1, ZERO, ZERO
9D0330C0  0441FFD1   BGEZ V0, 0x9D033008
9D0330C4  3C1FA001   LUI RA, -24575
9D0330C8  0F4105E3   JAL sitofp
9D0330CC  02802021   ADDU A0, S4, ZERO
9D0330D0  00402021   ADDU A0, V0, ZERO
9D0330D4  0F40EA52   JAL fpadd
9D0330D8  02002821   ADDU A1, S0, ZERO
9D0330DC  02535021   ADDU T2, S2, S3
9D0330E0  315200FF   ANDI S2, T2, 255
9D0330E4  262B0001   ADDIU T3, S1, 1
9D0330E8  317100FF   ANDI S1, T3, 255
9D0330EC  00408021   ADDU S0, V0, ZERO
9D0330F0  02002021   ADDU A0, S0, ZERO
9D0330F4  0F4101F6   JAL __lesf2
9D0330F8  00002821   ADDU A1, ZERO, ZERO
9D0330FC  0441FFC2   BGEZ V0, 0x9D033008
9D033100  3C1FA001   LUI RA, -24575
9D033104  0F4105E3   JAL sitofp
9D033108  02802021   ADDU A0, S4, ZERO
9D03310C  00402021   ADDU A0, V0, ZERO
9D033110  0F40EA52   JAL fpadd
9D033114  02002821   ADDU A1, S0, ZERO
9D033118  02536021   ADDU T4, S2, S3
9D03311C  319200FF   ANDI S2, T4, 255
9D033120  262D0001   ADDIU T5, S1, 1
9D033124  31B100FF   ANDI S1, T5, 255
9D033128  0B40CBFD   J 0x9D032FF4
9D03312C  00408021   ADDU S0, V0, ZERO
9D033130  0F4105E3   JAL sitofp
9D033134  02802021   ADDU A0, S4, ZERO
9D033138  00402021   ADDU A0, V0, ZERO
9D03313C  0F40EA52   JAL fpadd
9D033140  02002821   ADDU A1, S0, ZERO
9D033144  0253C021   ADDU T8, S2, S3
9D033148  331200FF   ANDI S2, T8, 255
9D03314C  26390001   ADDIU T9, S1, 1
9D033150  333100FF   ANDI S1, T9, 255
9D033154  00408021   ADDU S0, V0, ZERO
9D033158  00402021   ADDU A0, V0, ZERO
9D03315C  0F4101F6   JAL __lesf2
9D033160  00002821   ADDU A1, ZERO, ZERO
9D033164  0441FFA8   BGEZ V0, 0x9D033008
9D033168  3C1FA001   LUI RA, -24575
9D03316C  0F4105E3   JAL sitofp
9D033170  02802021   ADDU A0, S4, ZERO
9D033174  00402021   ADDU A0, V0, ZERO
9D033178  0F40EA52   JAL fpadd
9D03317C  02002821   ADDU A1, S0, ZERO
9D033180  02538021   ADDU S0, S2, S3
9D033184  321200FF   ANDI S2, S0, 255
9D033188  26240001   ADDIU A0, S1, 1
9D03318C  309100FF   ANDI S1, A0, 255
9D033190  00408021   ADDU S0, V0, ZERO
9D033194  00402021   ADDU A0, V0, ZERO
9D033198  0F4101F6   JAL __lesf2
9D03319C  00002821   ADDU A1, ZERO, ZERO
9D0331A0  0441FF99   BGEZ V0, 0x9D033008
9D0331A4  3C1FA001   LUI RA, -24575
9D0331A8  0F4105E3   JAL sitofp
9D0331AC  02802021   ADDU A0, S4, ZERO
9D0331B0  00402021   ADDU A0, V0, ZERO
9D0331B4  0F40EA52   JAL fpadd
9D0331B8  02002821   ADDU A1, S0, ZERO
9D0331BC  02533021   ADDU A2, S2, S3
9D0331C0  30D200FF   ANDI S2, A2, 255
9D0331C4  26270001   ADDIU A3, S1, 1
9D0331C8  30F100FF   ANDI S1, A3, 255
9D0331CC  0B40CBFD   J 0x9D032FF4
9D0331D0  00408021   ADDU S0, V0, ZERO
133:                 
134:                 /* write to registers */
135:                 static void vrcvi_write(uint32 address, uint8 value)
136:                 {
137:                    int chan = (address >> 12) - 9;
9D0331D4  00041302   SRL V0, A0, 12
138:                 
139:                    switch (address & 0xB003)
9D0331D8  3084B003   ANDI A0, A0, -20477
9D0331DC  3403A001   ORI V1, ZERO, -24575
9D0331E0  10830033   BEQ A0, V1, 0x9D0332B0
9D0331E4  2446FFF7   ADDIU A2, V0, -9
9D0331E8  3407A002   ORI A3, ZERO, -24574
9D0331EC  0087402B   SLTU T0, A0, A3
9D0331F0  11000012   BEQ T0, ZERO, 0x9D03323C
9D0331F4  3409B000   ORI T1, ZERO, -20480
9D0331F8  34099001   ORI T1, ZERO, -28671
9D0331FC  1089002C   BEQ A0, T1, 0x9D0332B0
9D033200  340A9002   ORI T2, ZERO, -28670
9D033204  008A582B   SLTU T3, A0, T2
9D033208  11600006   BEQ T3, ZERO, 0x9D033224
9D03320C  340D9002   ORI T5, ZERO, -28670
9D033210  340C9000   ORI T4, ZERO, -28672
9D033214  108C0019   BEQ A0, T4, 0x9D03327C
9D033218  00067880   SLL T7, A2, 2
9D03321C  03E00008   JR RA
9D033220  00000000   NOP
9D033224  108D0030   BEQ A0, T5, 0x9D0332E8
9D033228  340EA000   ORI T6, ZERO, -24576
9D03322C  108E0013   BEQ A0, T6, 0x9D03327C
9D033230  00067880   SLL T7, A2, 2
9D033234  03E00008   JR RA
9D033238  00000000   NOP
9D03323C  1089003A   BEQ A0, T1, 0x9D033328
9D033240  340AB001   ORI T2, ZERO, -20479
9D033244  008A582B   SLTU T3, A0, T2
9D033248  51600006   BEQL T3, ZERO, 0x9D033264
9D03324C  3409B001   ORI T1, ZERO, -20479
9D033250  340CA002   ORI T4, ZERO, -24574
9D033254  108C0025   BEQ A0, T4, 0x9D0332EC
9D033258  00066880   SLL T5, A2, 2
9D03325C  03E00008   JR RA
9D033260  00000000   NOP
9D033264  10890036   BEQ A0, T1, 0x9D033340
9D033268  340AB002   ORI T2, ZERO, -20478
9D03326C  108A003F   BEQ A0, T2, 0x9D03336C
9D033270  3C0BA001   LUI T3, -24575
9D033274  03E00008   JR RA
9D033278  00000000   NOP
140:                    {
141:                    case 0x9000:
142:                    case 0xA000:
143:                       vrcvi.rectangle[chan].reg[0] = value;
9D03327C  0006C140   SLL T8, A2, 5
9D033280  030FC823   SUBU T9, T8, T7
9D033284  3C02A001   LUI V0, -24575
9D033288  24464D1C   ADDIU A2, V0, 19740
9D03328C  03262021   ADDU A0, T9, A2
9D033290  A0850004   SB A1, 4(A0)
144:                       vrcvi.rectangle[chan].volume = (value & 0x0F) << 8;
9D033294  30A3000F   ANDI V1, A1, 15
9D033298  00033A00   SLL A3, V1, 8
9D03329C  AC870014   SW A3, 20(A0)
145:                       vrcvi.rectangle[chan].duty_flip = (value >> 4) + 1;
9D0332A0  00052902   SRL A1, A1, 4
9D0332A4  24A80001   ADDIU T0, A1, 1
146:                       break;
9D0332A8  03E00008   JR RA
9D0332AC  A0880018   SB T0, 24(A0)
147:                 
148:                    case 0x9001:
149:                    case 0xA001:
150:                       vrcvi.rectangle[chan].reg[1] = value;
9D0332B0  00067880   SLL T7, A2, 2
9D0332B4  0006C140   SLL T8, A2, 5
9D0332B8  030FC823   SUBU T9, T8, T7
9D0332BC  3C06A001   LUI A2, -24575
9D0332C0  24C24D1C   ADDIU V0, A2, 19740
9D0332C4  03222021   ADDU A0, T9, V0
9D0332C8  A0850005   SB A1, 5(A0)
151:                       vrcvi.rectangle[chan].freq = ((vrcvi.rectangle[chan].reg[2] & 0x0F) << 8) + value + 1;
9D0332CC  90870006   LBU A3, 6(A0)
9D0332D0  30E3000F   ANDI V1, A3, 15
9D0332D4  00034200   SLL T0, V1, 8
9D0332D8  01054821   ADDU T1, T0, A1
9D0332DC  25250001   ADDIU A1, T1, 1
152:                       break;
9D0332E0  03E00008   JR RA
9D0332E4  AC850010   SW A1, 16(A0)
153:                 
154:                    case 0x9002:
155:                    case 0xA002:
156:                       vrcvi.rectangle[chan].reg[2] = value;
9D0332E8  00066880   SLL T5, A2, 2
9D0332EC  00067140   SLL T6, A2, 5
9D0332F0  01CD7823   SUBU T7, T6, T5
9D0332F4  3C18A001   LUI T8, -24575
9D0332F8  27194D1C   ADDIU T9, T8, 19740
9D0332FC  01F93021   ADDU A2, T7, T9
9D033300  A0C50006   SB A1, 6(A2)
157:                       vrcvi.rectangle[chan].freq = ((value & 0x0F) << 8) + vrcvi.rectangle[chan].reg[1] + 1;
9D033304  30A2000F   ANDI V0, A1, 15
9D033308  00022200   SLL A0, V0, 8
9D03330C  90C30005   LBU V1, 5(A2)
9D033310  00833821   ADDU A3, A0, V1
9D033314  24E80001   ADDIU T0, A3, 1
9D033318  ACC80010   SW T0, 16(A2)
158:                       vrcvi.rectangle[chan].enabled = (value & 0x80) ? true : false;
9D03331C  000529C2   SRL A1, A1, 7
159:                       break;
9D033320  03E00008   JR RA
9D033324  ACC50000   SW A1, 0(A2)
160:                 
161:                    case 0xB000:
162:                       vrcvi.saw.reg[0] = value;
9D033328  3C0CA001   LUI T4, -24575
9D03332C  258D4D1C   ADDIU T5, T4, 19740
9D033330  A1A5003C   SB A1, 60(T5)
163:                       vrcvi.saw.volume = value & 0x3F;
9D033334  30AE003F   ANDI T6, A1, 63
164:                       break;
9D033338  03E00008   JR RA
9D03333C  A1AE004C   SB T6, 76(T5)
165:                 
166:                    case 0xB001:
167:                       vrcvi.saw.reg[1] = value;
9D033340  3C04A001   LUI A0, -24575
9D033344  24874D1C   ADDIU A3, A0, 19740
9D033348  A0E5003D   SB A1, 61(A3)
168:                       vrcvi.saw.freq = (((vrcvi.saw.reg[2] & 0x0F) << 8) + value + 1) << 1;
9D03334C  90E3003E   LBU V1, 62(A3)
9D033350  3068000F   ANDI T0, V1, 15
9D033354  00084A00   SLL T1, T0, 8
9D033358  01252821   ADDU A1, T1, A1
9D03335C  24AA0001   ADDIU T2, A1, 1
9D033360  000A5840   SLL T3, T2, 1
169:                       break;
9D033364  03E00008   JR RA
9D033368  ACEB0048   SW T3, 72(A3)
170:                 
171:                    case 0xB002:
172:                       vrcvi.saw.reg[2] = value;
9D03336C  256C4D1C   ADDIU T4, T3, 19740
9D033370  A185003E   SB A1, 62(T4)
173:                       vrcvi.saw.freq = (((value & 0x0F) << 8) + vrcvi.saw.reg[1] + 1) << 1;
9D033374  30AD000F   ANDI T5, A1, 15
9D033378  000D7200   SLL T6, T5, 8
9D03337C  918F003D   LBU T7, 61(T4)
9D033380  01CFC021   ADDU T8, T6, T7
9D033384  27190001   ADDIU T9, T8, 1
9D033388  00193040   SLL A2, T9, 1
9D03338C  AD860048   SW A2, 72(T4)
174:                       vrcvi.saw.enabled = (value & 0x80) ? true : false;
9D033390  000511C2   SRL V0, A1, 7
9D033394  03E00008   JR RA
9D033398  AD820038   SW V0, 56(T4)
175:                       break;
176:                 
177:                    default:
178:                       break;
179:                    }
180:                 }
181:                 
182:                 /* reset state of vrcvi sound channels */
183:                 static void vrcvi_reset(void)
184:                 {
9D03339C  27BDFE70   ADDIU SP, SP, -400
9D0333A0  AFBF018C   SW RA, 396(SP)
9D0333A4  AFB10188   SW S1, 392(SP)
9D0333A8  AFB00184   SW S0, 388(SP)
185:                    int i;
186:                    apu_t apu;
187:                 
188:                    /* get the phase period from the apu */
189:                    apu_getcontext(&apu);
9D0333AC  0F407DCC   JAL apu_getcontext
9D0333B0  27A40010   ADDIU A0, SP, 16
190:                    vrcvi.incsize = apu.cycle_rate;
9D0333B4  8FA3015C   LW V1, 348(SP)
9D0333B8  3C02A001   LUI V0, -24575
9D0333BC  AC434D6C   SW V1, 19820(V0)
9D0333C0  34109000   ORI S0, ZERO, -28672
191:                 
192:                    /* preload regs */
193:                    for (i = 0; i < 3; i++)
194:                    {
195:                       vrcvi_write(0x9000 + i, 0);
9D0333C4  02002021   ADDU A0, S0, ZERO
9D0333C8  0F40CC75   JAL .LFB3, vrcvi_write, .LFE2
9D0333CC  00002821   ADDU A1, ZERO, ZERO
9D0333EC  02002021   ADDU A0, S0, ZERO
9D0333F0  0F40CC75   JAL .LFB3, vrcvi_write, .LFE2
9D0333F4  00002821   ADDU A1, ZERO, ZERO
9D033414  02002021   ADDU A0, S0, ZERO
9D033418  0F40CC75   JAL .LFB3, vrcvi_write, .LFE2
9D03341C  00002821   ADDU A1, ZERO, ZERO
196:                       vrcvi_write(0xA000 + i, 0);
9D0333D0  26041000   ADDIU A0, S0, 4096
9D0333D4  0F40CC75   JAL .LFB3, vrcvi_write, .LFE2
9D0333D8  00002821   ADDU A1, ZERO, ZERO
9D0333F8  26041000   ADDIU A0, S0, 4096
9D0333FC  0F40CC75   JAL .LFB3, vrcvi_write, .LFE2
9D033400  00002821   ADDU A1, ZERO, ZERO
9D033420  26041000   ADDIU A0, S0, 4096
9D033424  0F40CC75   JAL .LFB3, vrcvi_write, .LFE2
9D033428  00002821   ADDU A1, ZERO, ZERO
197:                       vrcvi_write(0xB000 + i, 0);
9D0333DC  26042000   ADDIU A0, S0, 8192
9D0333E0  0F40CC75   JAL .LFB3, vrcvi_write, .LFE2
9D0333E4  00002821   ADDU A1, ZERO, ZERO
9D0333E8  26100001   ADDIU S0, S0, 1
9D033404  26042000   ADDIU A0, S0, 8192
9D033408  0F40CC75   JAL .LFB3, vrcvi_write, .LFE2
9D03340C  00002821   ADDU A1, ZERO, ZERO
9D033410  26100001   ADDIU S0, S0, 1
9D03342C  26042000   ADDIU A0, S0, 8192
9D033430  0F40CC75   JAL .LFB3, vrcvi_write, .LFE2
9D033434  00002821   ADDU A1, ZERO, ZERO
198:                    }
199:                 }
9D033438  8FBF018C   LW RA, 396(SP)
9D03343C  8FB10188   LW S1, 392(SP)
9D033440  8FB00184   LW S0, 388(SP)
9D033444  03E00008   JR RA
9D033448  27BD0190   ADDIU SP, SP, 400
200:                 
201:                 static apu_memwrite vrcvi_memwrite[] =
202:                 {
203:                    { 0x9000, 0x9002, vrcvi_write }, /* vrc6 */
204:                    { 0xA000, 0xA002, vrcvi_write },
205:                    { 0xB000, 0xB002, vrcvi_write },
206:                    {     -1,     -1, NULL }
207:                 };
208:                 
209:                 apuext_t vrcvi_ext =
210:                 {
211:                    NULL, /* no init */
212:                    NULL, /* no shutdown */
213:                    vrcvi_reset,
214:                    vrcvi_process,
215:                    NULL, /* no reads */
216:                    vrcvi_memwrite
217:                 };
218:                 
219:                 /*
220:                 ** $Log: vrcvisnd.c,v $
221:                 ** Revision 1.2  2001/04/27 14:37:11  neil
222:                 ** wheeee
223:                 **
224:                 ** Revision 1.1  2001/04/27 12:54:40  neil
225:                 ** blah
226:                 **
227:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
228:                 ** initial
229:                 **
230:                 ** Revision 1.2  2000/11/05 22:21:00  matt
231:                 ** help me!
232:                 **
233:                 ** Revision 1.1  2000/10/24 12:20:00  matt
234:                 ** changed directory structure
235:                 **
236:                 ** Revision 1.17  2000/10/10 13:58:18  matt
237:                 ** stroustrup squeezing his way in the door
238:                 **
239:                 ** Revision 1.16  2000/10/03 11:56:20  matt
240:                 ** better support for optional sound ext routines
241:                 **
242:                 ** Revision 1.15  2000/09/27 12:26:03  matt
243:                 ** changed sound accumulators back to floats
244:                 **
245:                 ** Revision 1.14  2000/09/15 13:38:40  matt
246:                 ** changes for optimized apu core
247:                 **
248:                 ** Revision 1.13  2000/09/15 04:58:07  matt
249:                 ** simplifying and optimizing APU core
250:                 **
251:                 ** Revision 1.12  2000/07/30 04:32:59  matt
252:                 ** no more apu_getcyclerate hack
253:                 **
254:                 ** Revision 1.11  2000/07/17 01:52:31  matt
255:                 ** made sure last line of all source files is a newline
256:                 **
257:                 ** Revision 1.10  2000/07/06 11:42:41  matt
258:                 ** forgot to remove FDS register range
259:                 **
260:                 ** Revision 1.9  2000/07/04 04:51:41  matt
261:                 ** cleanups
262:                 **
263:                 ** Revision 1.8  2000/07/03 02:18:53  matt
264:                 ** much better external module exporting
265:                 **
266:                 ** Revision 1.7  2000/06/20 04:06:16  matt
267:                 ** migrated external sound definition to apu module
268:                 **
269:                 ** Revision 1.6  2000/06/20 00:08:58  matt
270:                 ** changed to driver based API
271:                 **
272:                 ** Revision 1.5  2000/06/09 16:49:02  matt
273:                 ** removed all floating point from sound generation
274:                 **
275:                 ** Revision 1.4  2000/06/09 15:12:28  matt
276:                 ** initial revision
277:                 **
278:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/sndhrdw/nes_apu.c  -------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** nes_apu.c
21:                  **
22:                  ** NES APU emulation
23:                  ** $Id: nes_apu.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <string.h>
27:                  #include <noftypes.h>
28:                  #include <log.h>
29:                  #include <nes_apu.h>
30:                  #include "nes6502.h"
31:                   
32:                  
33:                  #define  APU_OVERSAMPLE
34:                  #define  APU_VOLUME_DECAY(x)  ((x) -= ((x) >> 7))
35:                  
36:                  /* the following seem to be the correct (empirically determined)
37:                  ** relative volumes between the sound channels
38:                  */
39:                  #define  APU_RECTANGLE_OUTPUT(channel) (apu.rectangle[channel].output_vol)
40:                  #define  APU_TRIANGLE_OUTPUT           (apu.triangle.output_vol + (apu.triangle.output_vol >> 2))
41:                  #define  APU_NOISE_OUTPUT              ((apu.noise.output_vol + apu.noise.output_vol + apu.noise.output_vol) >> 2)
42:                  #define  APU_DMC_OUTPUT                ((apu.dmc.output_vol + apu.dmc.output_vol + apu.dmc.output_vol) >> 2)
43:                  
44:                  /* active APU */
45:                  static apu_t apu;
46:                  
47:                  /* look up table madness */
48:                  static int32 decay_lut[16];
49:                  static int vbl_lut[32];
50:                  static int trilength_lut[128];
51:                  
52:                  /* noise lookups for both modes */
53:                  #ifndef REALTIME_NOISE
54:                  static int8 noise_long_lut[APU_NOISE_32K];
55:                  static int8 noise_short_lut[APU_NOISE_93];
56:                  #endif /* !REALTIME_NOISE */
57:                  
58:                  
59:                  /* vblank length table used for rectangles, triangle, noise */
60:                  static const uint8 vbl_length[32] =
61:                  {
62:                      5, 127,
63:                     10,   1,
64:                     19,   2,
65:                     40,   3,
66:                     80,   4,
67:                     30,   5,
68:                      7,   6,
69:                     13,   7,
70:                      6,   8,
71:                     12,   9,
72:                     24,  10,
73:                     48,  11,
74:                     96,  12,
75:                     36,  13,
76:                      8,  14,
77:                     16,  15
78:                  };
79:                  
80:                  /* frequency limit of rectangle channels */
81:                  static const int freq_limit[8] =
82:                  {
83:                     0x3FF, 0x555, 0x666, 0x71C, 0x787, 0x7C1, 0x7E0, 0x7F0
84:                  };
85:                  
86:                  /* noise frequency lookup table */
87:                  static const int noise_freq[16] =
88:                  {
89:                       4,    8,   16,   32,   64,   96,  128,  160,
90:                     202,  254,  380,  508,  762, 1016, 2034, 4068
91:                  };
92:                  
93:                  /* DMC transfer freqs */
94:                  const int dmc_clocks[16] =
95:                  {
96:                     428, 380, 340, 320, 286, 254, 226, 214,
97:                     190, 160, 142, 128, 106,  85,  72,  54
98:                  };
99:                  
100:                 /* ratios of pos/neg pulse for rectangle waves */
101:                 static const int duty_flip[4] = { 2, 4, 8, 12 };
102:                 
103:                 
104:                 void apu_setcontext(apu_t *src_apu)
105:                 {
106:                    apu = *src_apu;
9D01F5E8  00801821   ADDU V1, A0, ZERO
9D01F5EC  3C02A001   LUI V0, -24575
9D01F5F0  2449332C   ADDIU T1, V0, 13100
9D01F5F4  24840160   ADDIU A0, A0, 352
9D01F5F8  8C680000   LW T0, 0(V1)
9D01F5FC  8C670004   LW A3, 4(V1)
9D01F600  8C660008   LW A2, 8(V1)
9D01F604  8C65000C   LW A1, 12(V1)
9D01F608  AD280000   SW T0, 0(T1)
9D01F60C  AD270004   SW A3, 4(T1)
9D01F610  AD260008   SW A2, 8(T1)
9D01F614  AD25000C   SW A1, 12(T1)
9D01F618  24780010   ADDIU T8, V1, 16
9D01F61C  25220010   ADDIU V0, T1, 16
9D01F620  8F0A0000   LW T2, 0(T8)
9D01F624  8F0B0004   LW T3, 4(T8)
9D01F628  8F0C0008   LW T4, 8(T8)
9D01F62C  8F0D000C   LW T5, 12(T8)
9D01F630  AC4A0000   SW T2, 0(V0)
9D01F634  AC4B0004   SW T3, 4(V0)
9D01F638  AC4C0008   SW T4, 8(V0)
9D01F63C  AC4D000C   SW T5, 12(V0)
9D01F640  270E0010   ADDIU T6, T8, 16
9D01F644  244F0010   ADDIU T7, V0, 16
9D01F648  8F180010   LW T8, 16(T8)
9D01F64C  8DD90004   LW T9, 4(T6)
9D01F650  8DC90008   LW T1, 8(T6)
9D01F654  8DC3000C   LW V1, 12(T6)
9D01F658  AC580010   SW T8, 16(V0)
9D01F65C  ADF90004   SW T9, 4(T7)
9D01F660  ADE90008   SW T1, 8(T7)
9D01F664  ADE3000C   SW V1, 12(T7)
9D01F668  8DC20010   LW V0, 16(T6)
9D01F66C  8DC80014   LW T0, 20(T6)
9D01F670  8DC70018   LW A3, 24(T6)
9D01F674  8DC6001C   LW A2, 28(T6)
9D01F678  ADE20010   SW V0, 16(T7)
9D01F67C  ADE80014   SW T0, 20(T7)
9D01F680  ADE70018   SW A3, 24(T7)
9D01F684  ADE6001C   SW A2, 28(T7)
9D01F688  8DC50020   LW A1, 32(T6)
9D01F68C  8DCA0024   LW T2, 36(T6)
9D01F690  8DCB0028   LW T3, 40(T6)
9D01F694  8DCC002C   LW T4, 44(T6)
9D01F698  ADE50020   SW A1, 32(T7)
9D01F69C  ADEA0024   SW T2, 36(T7)
9D01F6A0  ADEB0028   SW T3, 40(T7)
9D01F6A4  ADEC002C   SW T4, 44(T7)
9D01F6A8  8DCD0030   LW T5, 48(T6)
9D01F6AC  8DD80034   LW T8, 52(T6)
9D01F6B0  8DD90038   LW T9, 56(T6)
9D01F6B4  8DC9003C   LW T1, 60(T6)
9D01F6B8  ADED0030   SW T5, 48(T7)
9D01F6BC  ADF80034   SW T8, 52(T7)
9D01F6C0  ADF90038   SW T9, 56(T7)
9D01F6C4  ADE9003C   SW T1, 60(T7)
9D01F6C8  8DC20040   LW V0, 64(T6)
9D01F6CC  8DC80044   LW T0, 68(T6)
9D01F6D0  8DC70048   LW A3, 72(T6)
9D01F6D4  8DC3004C   LW V1, 76(T6)
9D01F6D8  ADE20040   SW V0, 64(T7)
9D01F6DC  ADE80044   SW T0, 68(T7)
9D01F6E0  ADE70048   SW A3, 72(T7)
9D01F6E4  ADE3004C   SW V1, 76(T7)
9D01F6E8  8DC60050   LW A2, 80(T6)
9D01F6EC  8DC50054   LW A1, 84(T6)
9D01F6F0  8DCA0058   LW T2, 88(T6)
9D01F6F4  8DCB005C   LW T3, 92(T6)
9D01F6F8  ADE60050   SW A2, 80(T7)
9D01F6FC  ADE50054   SW A1, 84(T7)
9D01F700  ADEA0058   SW T2, 88(T7)
9D01F704  ADEB005C   SW T3, 92(T7)
9D01F708  25D80060   ADDIU T8, T6, 96
9D01F70C  1704FFC4   BNE T8, A0, 0x9D01F620
9D01F710  25E20060   ADDIU V0, T7, 96
9D01F714  8F0E0000   LW T6, 0(T8)
9D01F718  8F040004   LW A0, 4(T8)
9D01F71C  8F0F0008   LW T7, 8(T8)
9D01F720  AC4E0000   SW T6, 0(V0)
9D01F724  AC440004   SW A0, 4(V0)
9D01F728  03E00008   JR RA
9D01F72C  AC4F0008   SW T7, 8(V0)
107:                 }
108:                 
109:                 void apu_getcontext(apu_t *dest_apu)
110:                 {
111:                    *dest_apu = apu;
9D01F730  3C02A001   LUI V0, -24575
9D01F734  2449332C   ADDIU T1, V0, 13100
9D01F738  25280160   ADDIU T0, T1, 352
9D01F73C  8D270000   LW A3, 0(T1)
9D01F740  8D260004   LW A2, 4(T1)
9D01F744  8D250008   LW A1, 8(T1)
9D01F748  8D23000C   LW V1, 12(T1)
9D01F74C  AC870000   SW A3, 0(A0)
9D01F750  AC860004   SW A2, 4(A0)
9D01F754  AC850008   SW A1, 8(A0)
9D01F758  AC83000C   SW V1, 12(A0)
9D01F75C  25380010   ADDIU T8, T1, 16
9D01F760  24870010   ADDIU A3, A0, 16
9D01F764  8F0A0000   LW T2, 0(T8)
9D01F768  8F0B0004   LW T3, 4(T8)
9D01F76C  8F0C0008   LW T4, 8(T8)
9D01F770  8F0D000C   LW T5, 12(T8)
9D01F774  ACEA0000   SW T2, 0(A3)
9D01F778  ACEB0004   SW T3, 4(A3)
9D01F77C  ACEC0008   SW T4, 8(A3)
9D01F780  ACED000C   SW T5, 12(A3)
9D01F784  270E0010   ADDIU T6, T8, 16
9D01F788  24EF0010   ADDIU T7, A3, 16
9D01F78C  8F180010   LW T8, 16(T8)
9D01F790  8DD90004   LW T9, 4(T6)
9D01F794  8DC90008   LW T1, 8(T6)
9D01F798  8DC2000C   LW V0, 12(T6)
9D01F79C  ACF80010   SW T8, 16(A3)
9D01F7A0  ADF90004   SW T9, 4(T7)
9D01F7A4  ADE90008   SW T1, 8(T7)
9D01F7A8  ADE2000C   SW V0, 12(T7)
9D01F7AC  8DC50010   LW A1, 16(T6)
9D01F7B0  8DC70014   LW A3, 20(T6)
9D01F7B4  8DC60018   LW A2, 24(T6)
9D01F7B8  8DC4001C   LW A0, 28(T6)
9D01F7BC  ADE50010   SW A1, 16(T7)
9D01F7C0  ADE70014   SW A3, 20(T7)
9D01F7C4  ADE60018   SW A2, 24(T7)
9D01F7C8  ADE4001C   SW A0, 28(T7)
9D01F7CC  8DC30020   LW V1, 32(T6)
9D01F7D0  8DCA0024   LW T2, 36(T6)
9D01F7D4  8DCB0028   LW T3, 40(T6)
9D01F7D8  8DCC002C   LW T4, 44(T6)
9D01F7DC  ADE30020   SW V1, 32(T7)
9D01F7E0  ADEA0024   SW T2, 36(T7)
9D01F7E4  ADEB0028   SW T3, 40(T7)
9D01F7E8  ADEC002C   SW T4, 44(T7)
9D01F7EC  8DCD0030   LW T5, 48(T6)
9D01F7F0  8DD80034   LW T8, 52(T6)
9D01F7F4  8DD90038   LW T9, 56(T6)
9D01F7F8  8DC9003C   LW T1, 60(T6)
9D01F7FC  ADED0030   SW T5, 48(T7)
9D01F800  ADF80034   SW T8, 52(T7)
9D01F804  ADF90038   SW T9, 56(T7)
9D01F808  ADE9003C   SW T1, 60(T7)
9D01F80C  8DC20040   LW V0, 64(T6)
9D01F810  8DC50044   LW A1, 68(T6)
9D01F814  8DC70048   LW A3, 72(T6)
9D01F818  8DC6004C   LW A2, 76(T6)
9D01F81C  ADE20040   SW V0, 64(T7)
9D01F820  ADE50044   SW A1, 68(T7)
9D01F824  ADE70048   SW A3, 72(T7)
9D01F828  ADE6004C   SW A2, 76(T7)
9D01F82C  8DC30050   LW V1, 80(T6)
9D01F830  8DCA0054   LW T2, 84(T6)
9D01F834  8DCB0058   LW T3, 88(T6)
9D01F838  8DC4005C   LW A0, 92(T6)
9D01F83C  ADE30050   SW V1, 80(T7)
9D01F840  ADEA0054   SW T2, 84(T7)
9D01F844  ADEB0058   SW T3, 88(T7)
9D01F848  ADE4005C   SW A0, 92(T7)
9D01F84C  25D80060   ADDIU T8, T6, 96
9D01F850  1708FFC4   BNE T8, T0, 0x9D01F764
9D01F854  25E70060   ADDIU A3, T7, 96
9D01F858  8F080000   LW T0, 0(T8)
9D01F85C  8F0E0004   LW T6, 4(T8)
9D01F860  8F0F0008   LW T7, 8(T8)
9D01F864  ACE80000   SW T0, 0(A3)
9D01F868  ACEE0004   SW T6, 4(A3)
9D01F86C  03E00008   JR RA
9D01F870  ACEF0008   SW T7, 8(A3)
112:                 }
113:                 
114:                 void apu_setchan(int chan, bool enabled)
115:                 {
116:                    if (enabled)
9D01F874  10A00009   BEQ A1, ZERO, 0x9D01F89C
9D01F878  3C02A001   LUI V0, -24575
117:                       apu.mix_enable |= (1 << chan);
9D01F87C  3C09A001   LUI T1, -24575
9D01F880  252A332C   ADDIU T2, T1, 13100
9D01F884  240B0001   ADDIU T3, ZERO, 1
9D01F888  008B6004   SLLV T4, T3, A0
9D01F88C  914D0140   LBU T5, 320(T2)
9D01F890  018D7025   OR T6, T4, T5
9D01F894  03E00008   JR RA
9D01F898  A14E0140   SB T6, 320(T2)
118:                    else
119:                       apu.mix_enable &= ~(1 << chan);
9D01F89C  2445332C   ADDIU A1, V0, 13100
9D01F8A0  24030001   ADDIU V1, ZERO, 1
9D01F8A4  00832004   SLLV A0, V1, A0
9D01F8A8  00043027   NOR A2, ZERO, A0
9D01F8AC  90A70140   LBU A3, 320(A1)
9D01F8B0  00C74024   AND T0, A2, A3
9D01F8B4  03E00008   JR RA
9D01F8B8  A0A80140   SB T0, 320(A1)
120:                 }
121:                 
122:                 /* emulation of the 15-bit shift register the
123:                 ** NES uses to generate pseudo-random series
124:                 ** for the white noise channel
125:                 */
126:                 #ifdef REALTIME_NOISE
127:                 INLINE int8 shift_register15(uint8 xor_tap)
128:                 {
129:                    static int sreg = 0x4000;
130:                    int bit0, tap, bit14;
131:                 
132:                    bit0 = sreg & 1;
9D01F270  32EE0001   ANDI T6, S7, 1
133:                    tap = (sreg & xor_tap) ? 1 : 0;
9D01F24C  92ED00FC   LBU T5, 252(S7)
9D01F250  AFAD0020   SW T5, 32(SP)
9D01F254  8F97802C   LW S7, -32724(GP)
9D01F274  8FAF0020   LW T7, 32(SP)
9D01F278  02EFC024   AND T8, S7, T7
9D01F27C  0018C82B   SLTU T9, ZERO, T8
134:                    bit14 = (bit0 ^ tap);
9D01F280  032E4026   XOR T0, T9, T6
135:                    sreg >>= 1;
9D01F288  00173043   SRA A2, S7, 1
136:                    sreg |= (bit14 << 14);
9D01F284  00084B80   SLL T1, T0, 14
9D01F28C  0126B825   OR S7, T1, A2
137:                    return (bit0 ^ 1);
138:                 }
139:                 #else /* !REALTIME_NOISE */
140:                 static void shift_register15(int8 *buf, int count)
141:                 {
142:                    static int sreg = 0x4000;
143:                    int bit0, bit1, bit6, bit14;
144:                 
145:                    if (count == APU_NOISE_93)
146:                    {
147:                       while (count--)
148:                       {
149:                          bit0 = sreg & 1;
150:                          bit6 = (sreg & 0x40) >> 6;
151:                          bit14 = (bit0 ^ bit6);
152:                          sreg >>= 1;
153:                          sreg |= (bit14 << 14);
154:                          *buf++ = bit0 ^ 1;
155:                       }
156:                    }
157:                    else /* 32K noise */
158:                    {
159:                       while (count--)
160:                       {
161:                          bit0 = sreg & 1;
162:                          bit1 = (sreg & 2) >> 1;
163:                          bit14 = (bit0 ^ bit1);
164:                          sreg >>= 1;
165:                          sreg |= (bit14 << 14);
166:                          *buf++ = bit0 ^ 1;
167:                       }
168:                    }
169:                 }
170:                 #endif /* !REALTIME_NOISE */
171:                 
172:                 /* RECTANGLE WAVE
173:                 ** ==============
174:                 ** reg0: 0-3=volume, 4=envelope, 5=hold, 6-7=duty cycle
175:                 ** reg1: 0-2=sweep shifts, 3=sweep inc/dec, 4-6=sweep length, 7=sweep on
176:                 ** reg2: 8 bits of freq
177:                 ** reg3: 0-2=high freq, 7-4=vbl length counter
178:                 */
179:                 #ifdef APU_OVERSAMPLE
180:                 
181:                 #define  APU_MAKE_RECTANGLE(ch) \
182:                 static int32 apu_rectangle_##ch(void) \
183:                 { \
184:                    int32 output, total; \
185:                    int num_times; \
186:                 \
187:                    APU_VOLUME_DECAY(apu.rectangle[ch].output_vol); \
188:                 \
189:                    if (false == apu.rectangle[ch].enabled || 0 == apu.rectangle[ch].vbl_length) \
190:                       return APU_RECTANGLE_OUTPUT(ch); \
191:                 \
192:                    /* vbl length counter */ \
193:                    if (false == apu.rectangle[ch].holdnote) \
194:                       apu.rectangle[ch].vbl_length--; \
195:                 \
196:                    /* envelope decay at a rate of (env_delay + 1) / 240 secs */ \
197:                    apu.rectangle[ch].env_phase -= 4; /* 240/60 */ \
198:                    while (apu.rectangle[ch].env_phase < 0) \
199:                    { \
200:                       apu.rectangle[ch].env_phase += apu.rectangle[ch].env_delay; \
201:                 \
202:                       if (apu.rectangle[ch].holdnote) \
203:                          apu.rectangle[ch].env_vol = (apu.rectangle[ch].env_vol + 1) & 0x0F; \
204:                       else if (apu.rectangle[ch].env_vol < 0x0F) \
205:                          apu.rectangle[ch].env_vol++; \
206:                    } \
207:                 \
208:                    /* TODO: find true relation of freq_limit to register values */ \
209:                    if (apu.rectangle[ch].freq < 8 \
210:                        || (false == apu.rectangle[ch].sweep_inc \
211:                            && apu.rectangle[ch].freq > apu.rectangle[ch].freq_limit)) \
212:                       return APU_RECTANGLE_OUTPUT(ch); \
213:                 \
214:                    /* frequency sweeping at a rate of (sweep_delay + 1) / 120 secs */ \
215:                    if (apu.rectangle[ch].sweep_on && apu.rectangle[ch].sweep_shifts) \
216:                    { \
217:                       apu.rectangle[ch].sweep_phase -= 2; /* 120/60 */ \
218:                       while (apu.rectangle[ch].sweep_phase < 0) \
219:                       { \
220:                          apu.rectangle[ch].sweep_phase += apu.rectangle[ch].sweep_delay; \
221:                 \
222:                          if (apu.rectangle[ch].sweep_inc) /* ramp up */ \
223:                          { \
224:                             if (0 == ch) \
225:                                apu.rectangle[ch].freq += ~(apu.rectangle[ch].freq >> apu.rectangle[ch].sweep_shifts); \
226:                             else \
227:                                apu.rectangle[ch].freq -= (apu.rectangle[ch].freq >> apu.rectangle[ch].sweep_shifts); \
228:                          } \
229:                          else /* ramp down */ \
230:                          { \
231:                             apu.rectangle[ch].freq += (apu.rectangle[ch].freq >> apu.rectangle[ch].sweep_shifts); \
232:                          } \
233:                       } \
234:                    } \
235:                 \
236:                    apu.rectangle[ch].accum -= apu.cycle_rate; \
237:                    if (apu.rectangle[ch].accum >= 0) \
238:                       return APU_RECTANGLE_OUTPUT(ch); \
239:                 \
240:                    if (apu.rectangle[ch].fixed_envelope) \
241:                       output = apu.rectangle[ch].volume << 8; /* fixed volume */ \
242:                    else \
243:                       output = (apu.rectangle[ch].env_vol ^ 0x0F) << 8; \
244:                 \
245:                    num_times = total = 0; \
246:                 \
247:                    while (apu.rectangle[ch].accum < 0) \
248:                    { \
249:                       apu.rectangle[ch].accum += apu.rectangle[ch].freq + 1; \
250:                       apu.rectangle[ch].adder = (apu.rectangle[ch].adder + 1) & 0x0F; \
251:                 \
252:                       if (apu.rectangle[ch].adder < apu.rectangle[ch].duty_flip) \
253:                          total += output; \
254:                       else \
255:                          total -= output; \
256:                 \
257:                       num_times++; \
258:                    } \
259:                 \
260:                    apu.rectangle[ch].output_vol = total / num_times; \
261:                    return APU_RECTANGLE_OUTPUT(ch); \
262:                 } 
263:                 
264:                 #else /* !APU_OVERSAMPLE */
265:                 #define  APU_MAKE_RECTANGLE(ch) \
266:                 static int32 apu_rectangle_##ch(void) \
267:                 { \
268:                    int32 output; \
269:                 \
270:                    APU_VOLUME_DECAY(apu.rectangle[ch].output_vol); \
271:                 \
272:                    if (false == apu.rectangle[ch].enabled || 0 == apu.rectangle[ch].vbl_length) \
273:                       return APU_RECTANGLE_OUTPUT(ch); \
274:                 \
275:                    /* vbl length counter */ \
276:                    if (false == apu.rectangle[ch].holdnote) \
277:                       apu.rectangle[ch].vbl_length--; \
278:                 \
279:                    /* envelope decay at a rate of (env_delay + 1) / 240 secs */ \
280:                    apu.rectangle[ch].env_phase -= 4; /* 240/60 */ \
281:                    while (apu.rectangle[ch].env_phase < 0) \
282:                    { \
283:                       apu.rectangle[ch].env_phase += apu.rectangle[ch].env_delay; \
284:                 \
285:                       if (apu.rectangle[ch].holdnote) \
286:                          apu.rectangle[ch].env_vol = (apu.rectangle[ch].env_vol + 1) & 0x0F; \
287:                       else if (apu.rectangle[ch].env_vol < 0x0F) \
288:                          apu.rectangle[ch].env_vol++; \
289:                    } \
290:                 \
291:                    /* TODO: find true relation of freq_limit to register values */ \
292:                    if (apu.rectangle[ch].freq < 8 || (false == apu.rectangle[ch].sweep_inc && apu.rectangle[ch].freq > apu.rectangle[ch].freq_limit)) \
293:                       return APU_RECTANGLE_OUTPUT(ch); \
294:                 \
295:                    /* frequency sweeping at a rate of (sweep_delay + 1) / 120 secs */ \
296:                    if (apu.rectangle[ch].sweep_on && apu.rectangle[ch].sweep_shifts) \
297:                    { \
298:                       apu.rectangle[ch].sweep_phase -= 2; /* 120/60 */ \
299:                       while (apu.rectangle[ch].sweep_phase < 0) \
300:                       { \
301:                          apu.rectangle[ch].sweep_phase += apu.rectangle[ch].sweep_delay; \
302:                 \
303:                          if (apu.rectangle[ch].sweep_inc) /* ramp up */ \
304:                          { \
305:                             if (0 == ch) \
306:                                apu.rectangle[ch].freq += ~(apu.rectangle[ch].freq >> apu.rectangle[ch].sweep_shifts); \
307:                             else \
308:                                apu.rectangle[ch].freq -= (apu.rectangle[ch].freq >> apu.rectangle[ch].sweep_shifts); \
309:                          } \
310:                          else /* ramp down */ \
311:                          { \
312:                             apu.rectangle[ch].freq += (apu.rectangle[ch].freq >> apu.rectangle[ch].sweep_shifts); \
313:                          } \
314:                       } \
315:                    } \
316:                 \
317:                    apu.rectangle[ch].accum -= apu.cycle_rate; \
318:                    if (apu.rectangle[ch].accum >= 0) \
319:                       return APU_RECTANGLE_OUTPUT(ch); \
320:                 \
321:                    while (apu.rectangle[ch].accum < 0) \
322:                    { \
323:                       apu.rectangle[ch].accum += (apu.rectangle[ch].freq + 1); \
324:                       apu.rectangle[ch].adder = (apu.rectangle[ch].adder + 1) & 0x0F; \
325:                    } \
326:                 \
327:                    if (apu.rectangle[ch].fixed_envelope) \
328:                       output = apu.rectangle[ch].volume << 8; /* fixed volume */ \
329:                    else \
330:                       output = (apu.rectangle[ch].env_vol ^ 0x0F) << 8; \
331:                 \
332:                    if (0 == apu.rectangle[ch].adder) \
333:                       apu.rectangle[ch].output_vol = output; \
334:                    else if (apu.rectangle[ch].adder == apu.rectangle[ch].duty_flip) \
335:                       apu.rectangle[ch].output_vol = -output; \
336:                 \
337:                    return APU_RECTANGLE_OUTPUT(ch); \
338:                 }
339:                 
340:                 #endif /* !APU_OVERSAMPLE */
341:                 
342:                 /* generate the functions */
343:                 APU_MAKE_RECTANGLE(0)
9D01EB30  2605332C   ADDIU A1, S0, 13100
9D01EB34  8CA60010   LW A2, 16(A1)
9D01EB38  000689C3   SRA S1, A2, 7
9D01EB3C  00D18823   SUBU S1, A2, S1
9D01EB40  ACB10010   SW S1, 16(A1)
9D01EB44  8CA70004   LW A3, 4(A1)
9D01EB48  10E00084   BEQ A3, ZERO, 0x9D01ED5C
9D01EB4C  2608332C   ADDIU T0, S0, 13100
9D01EB50  8D090044   LW T1, 68(T0)
9D01EB54  11200081   BEQ T1, ZERO, 0x9D01ED5C
9D01EB58  260A332C   ADDIU T2, S0, 13100
9D01EB5C  8D480018   LW T0, 24(T2)
9D01EB60  15000003   BNE T0, ZERO, 0x9D01EB70
9D01EB64  260C332C   ADDIU T4, S0, 13100
9D01EB68  252BFFFF   ADDIU T3, T1, -1
9D01EB6C  AD4B0044   SW T3, 68(T2)
9D01EB70  91840040   LBU A0, 64(T4)
9D01EB74  8D86003C   LW A2, 60(T4)
9D01EB78  8D8D0038   LW T5, 56(T4)
9D01EB7C  0B407AEB   J 0x9D01EBAC
9D01EB80  25A2FFFC   ADDIU V0, T5, -4
9D01EB84  11000004   BEQ T0, ZERO, 0x9D01EB98
9D01EB88  2C89000F   SLTIU T1, A0, 15
9D01EB8C  24850001   ADDIU A1, A0, 1
9D01EB90  0B407AEA   J 0x9D01EBA8
9D01EB94  30A4000F   ANDI A0, A1, 15
9D01EB98  51200004   BEQL T1, ZERO, 0x9D01EBAC
9D01EB9C  00461021   ADDU V0, V0, A2
9D01EBA0  24830001   ADDIU V1, A0, 1
9D01EBA4  306400FF   ANDI A0, V1, 255
9D01EBA8  00461021   ADDU V0, V0, A2
9D01EBAC  0440FFF5   BLTZ V0, 0x9D01EB84
9D01EBB0  260F332C   ADDIU T7, S0, 13100
9D01EBB4  ADE20038   SW V0, 56(T7)
9D01EBB8  A1E40040   SB A0, 64(T7)
9D01EBBC  8DF7000C   LW S7, 12(T7)
9D01EBC0  2AF80008   SLTI T8, S7, 8
9D01EBC4  17000065   BNE T8, ZERO, 0x9D01ED5C
9D01EBC8  2619332C   ADDIU T9, S0, 13100
9D01EBCC  8F2C0030   LW T4, 48(T9)
9D01EBD0  15800005   BNE T4, ZERO, 0x9D01EBE8
9D01EBD4  2602332C   ADDIU V0, S0, 13100
9D01EBD8  8F3E0034   LW FP, 52(T9)
9D01EBDC  03D7F82A   SLT RA, FP, S7
9D01EBE0  17E0005F   BNE RA, ZERO, 0x9D01ED60
9D01EBE4  325F0002   ANDI RA, S2, 2
9D01EBE8  8C430028   LW V1, 40(V0)
9D01EBEC  10600017   BEQ V1, ZERO, 0x9D01EC4C
9D01EBF0  2617332C   ADDIU S7, S0, 13100
9D01EBF4  2606332C   ADDIU A2, S0, 13100
9D01EBF8  90CD002C   LBU T5, 44(A2)
9D01EBFC  51A00014   BEQL T5, ZERO, 0x9D01EC50
9D01EC00  8EE40008   LW A0, 8(S7)
9D01EC04  8CD7000C   LW S7, 12(A2)
9D01EC08  8CCE0024   LW T6, 36(A2)
9D01EC0C  8CC80020   LW T0, 32(A2)
9D01EC10  0B407B0E   J 0x9D01EC38
9D01EC14  251EFFFE   ADDIU FP, T0, -2
9D01EC18  11800005   BEQ T4, ZERO, 0x9D01EC30
9D01EC1C  01B77807   SRAV T7, S7, T5
9D01EC20  01B7C007   SRAV T8, S7, T5
9D01EC24  0018C827   NOR T9, ZERO, T8
9D01EC28  0B407B0D   J 0x9D01EC34
9D01EC2C  0337B821   ADDU S7, T9, S7
9D01EC30  01F7B821   ADDU S7, T7, S7
9D01EC34  03CEF021   ADDU FP, FP, T6
9D01EC38  07C0FFF7   BLTZ FP, 0x9D01EC18
9D01EC3C  2604332C   ADDIU A0, S0, 13100
9D01EC40  AC97000C   SW S7, 12(A0)
9D01EC44  AC9E0020   SW FP, 32(A0)
9D01EC48  2617332C   ADDIU S7, S0, 13100
9D01EC4C  8EE40008   LW A0, 8(S7)
9D01EC50  0F40EA50   JAL __subsf3
9D01EC54  8EE5014C   LW A1, 332(S7)
9D01EC58  0040F021   ADDU FP, V0, ZERO
9D01EC5C  AEE20008   SW V0, 8(S7)
9D01EC60  00002021   ADDU A0, ZERO, ZERO
9D01EC64  0F4101F6   JAL __lesf2
9D01EC68  00402821   ADDU A1, V0, ZERO
9D01EC6C  1840003C   BLEZ V0, 0x9D01ED60
9D01EC70  325F0002   ANDI RA, S2, 2
9D01EC74  8EF10014   LW S1, 20(S7)
9D01EC78  12200005   BEQ S1, ZERO, 0x9D01EC90
9D01EC7C  2607332C   ADDIU A3, S0, 13100
9D01EC80  92EE001C   LBU T6, 28(S7)
9D01EC84  000E7A00   SLL T7, T6, 8
9D01EC88  0B407B28   J 0x9D01ECA0
9D01EC8C  AFAF0014   SW T7, 20(SP)
9D01EC90  90EA0040   LBU T2, 64(A3)
9D01EC94  394B000F   XORI T3, T2, 15
9D01EC98  000B6200   SLL T4, T3, 8
9D01EC9C  AFAC0014   SW T4, 20(SP)
9D01ECA0  03C02021   ADDU A0, FP, ZERO
9D01ECA4  0F4101F6   JAL __lesf2
9D01ECA8  00002821   ADDU A1, ZERO, ZERO
9D01ECAC  04410022   BGEZ V0, 0x9D01ED38
9D01ECB0  2611332C   ADDIU S1, S0, 13100
9D01ECB4  8E38000C   LW T8, 12(S1)
9D01ECB8  0F4105E3   JAL sitofp
9D01ECBC  27040001   ADDIU A0, T8, 1
9D01ECC0  AFA20018   SW V0, 24(SP)
9D01ECC4  8E39004C   LW T9, 76(S1)
9D01ECC8  AFB9001C   SW T9, 28(SP)
9D01ECCC  92310048   LBU S1, 72(S1)
9D01ECD0  AFA00010   SW ZERO, 16(SP)
9D01ECD4  0000B821   ADDU S7, ZERO, ZERO
9D01ECD8  03C02021   ADDU A0, FP, ZERO
9D01ECDC  0F40EA52   JAL fpadd
9D01ECE0  8FA50018   LW A1, 24(SP)
9D01ECE4  0040F021   ADDU FP, V0, ZERO
9D01ECE8  26220001   ADDIU V0, S1, 1
9D01ECEC  3051000F   ANDI S1, V0, 15
9D01ECF0  8FA3001C   LW V1, 28(SP)
9D01ECF4  0223302A   SLT A2, S1, V1
9D01ECF8  8FA80014   LW T0, 20(SP)
9D01ECFC  02E84821   ADDU T1, S7, T0
9D01ED00  02E8B823   SUBU S7, S7, T0
9D01ED04  0126B80B   MOVN S7, T1, A2
9D01ED08  8FA40010   LW A0, 16(SP)
9D01ED0C  24850001   ADDIU A1, A0, 1
9D01ED10  AFA50010   SW A1, 16(SP)
9D01ED14  03C02021   ADDU A0, FP, ZERO
9D01ED18  0F4101F6   JAL __lesf2
9D01ED1C  00002821   ADDU A1, ZERO, ZERO
9D01ED20  0440FFEE   BLTZ V0, 0x9D01ECDC
9D01ED24  03C02021   ADDU A0, FP, ZERO
9D01ED28  261F332C   ADDIU RA, S0, 13100
9D01ED2C  AFFE0008   SW FP, 8(RA)
9D01ED30  0B407B50   J 0x9D01ED40
9D01ED34  A3F10048   SB S1, 72(RA)
9D01ED38  AFA00010   SW ZERO, 16(SP)
9D01ED3C  0000B821   ADDU S7, ZERO, ZERO
9D01ED40  8FA70010   LW A3, 16(SP)
9D01ED44  02E7001A   DIV S7, A3
9D01ED48  00E001F4   TEQ A3, ZERO
9D01ED4C  00005012   MFLO T2
9D01ED50  00008812   MFLO S1
9D01ED54  260B332C   ADDIU T3, S0, 13100
9D01ED58  AD6A0010   SW T2, 16(T3)
344:                 APU_MAKE_RECTANGLE(1)
9D01ED6C  260A332C   ADDIU T2, S0, 13100
9D01ED70  8D4B0060   LW T3, 96(T2)
9D01ED74  000B61C3   SRA T4, T3, 7
9D01ED78  016CF023   SUBU FP, T3, T4
9D01ED7C  AD5E0060   SW FP, 96(T2)
9D01ED80  8D4D0054   LW T5, 84(T2)
9D01ED84  11A00085   BEQ T5, ZERO, 0x9D01EF9C
9D01ED88  03C04021   ADDU T0, FP, ZERO
9D01ED8C  260E332C   ADDIU T6, S0, 13100
9D01ED90  8DCF0094   LW T7, 148(T6)
9D01ED94  11E00081   BEQ T7, ZERO, 0x9D01EF9C
9D01ED98  2617332C   ADDIU S7, S0, 13100
9D01ED9C  8EEA0068   LW T2, 104(S7)
9D01EDA0  15400003   BNE T2, ZERO, 0x9D01EDB0
9D01EDA4  2619332C   ADDIU T9, S0, 13100
9D01EDA8  25F8FFFF   ADDIU T8, T7, -1
9D01EDAC  AEF80094   SW T8, 148(S7)
9D01EDB0  932E0090   LBU T6, 144(T9)
9D01EDB4  8F2B008C   LW T3, 140(T9)
9D01EDB8  8F280088   LW T0, 136(T9)
9D01EDBC  0B407B7B   J 0x9D01EDEC
9D01EDC0  251FFFFC   ADDIU RA, T0, -4
9D01EDC4  11400004   BEQ T2, ZERO, 0x9D01EDD8
9D01EDC8  2DCC000F   SLTIU T4, T6, 15
9D01EDCC  25CF0001   ADDIU T7, T6, 1
9D01EDD0  0B407B7A   J 0x9D01EDE8
9D01EDD4  31EE000F   ANDI T6, T7, 15
9D01EDD8  51800004   BEQL T4, ZERO, 0x9D01EDEC
9D01EDDC  03EBF821   ADDU RA, RA, T3
9D01EDE0  25CD0001   ADDIU T5, T6, 1
9D01EDE4  31AE00FF   ANDI T6, T5, 255
9D01EDE8  03EBF821   ADDU RA, RA, T3
9D01EDEC  07E0FFF5   BLTZ RA, 0x9D01EDC4
9D01EDF0  2606332C   ADDIU A2, S0, 13100
9D01EDF4  ACDF0088   SW RA, 136(A2)
9D01EDF8  A0CE0090   SB T6, 144(A2)
9D01EDFC  8CC5005C   LW A1, 92(A2)
9D01EE00  28A40008   SLTI A0, A1, 8
9D01EE04  14800065   BNE A0, ZERO, 0x9D01EF9C
9D01EE08  03C04021   ADDU T0, FP, ZERO
9D01EE0C  2603332C   ADDIU V1, S0, 13100
9D01EE10  8C640080   LW A0, 128(V1)
9D01EE14  14800005   BNE A0, ZERO, 0x9D01EE2C
9D01EE18  2607332C   ADDIU A3, S0, 13100
9D01EE1C  8C620084   LW V0, 132(V1)
9D01EE20  0045F82A   SLT RA, V0, A1
9D01EE24  57E0005E   BNEL RA, ZERO, 0x9D01EFA0
9D01EE28  02288821   ADDU S1, S1, T0
9D01EE2C  8CEA0078   LW T2, 120(A3)
9D01EE30  11400016   BEQ T2, ZERO, 0x9D01EE8C
9D01EE34  2617332C   ADDIU S7, S0, 13100
9D01EE38  260B332C   ADDIU T3, S0, 13100
9D01EE3C  9165007C   LBU A1, 124(T3)
9D01EE40  50A00013   BEQL A1, ZERO, 0x9D01EE90
9D01EE44  8EE40058   LW A0, 88(S7)
9D01EE48  8D63005C   LW V1, 92(T3)
9D01EE4C  8D670074   LW A3, 116(T3)
9D01EE50  8D6C0070   LW T4, 112(T3)
9D01EE54  0B407B9E   J 0x9D01EE78
9D01EE58  2582FFFE   ADDIU V0, T4, -2
9D01EE5C  10800004   BEQ A0, ZERO, 0x9D01EE70
9D01EE60  00A33007   SRAV A2, V1, A1
9D01EE64  00A3B807   SRAV S7, V1, A1
9D01EE68  0B407B9D   J 0x9D01EE74
9D01EE6C  00771823   SUBU V1, V1, S7
9D01EE70  00C31821   ADDU V1, A2, V1
9D01EE74  00471021   ADDU V0, V0, A3
9D01EE78  0440FFF8   BLTZ V0, 0x9D01EE5C
9D01EE7C  260E332C   ADDIU T6, S0, 13100
9D01EE80  ADC3005C   SW V1, 92(T6)
9D01EE84  ADC20070   SW V0, 112(T6)
9D01EE88  2617332C   ADDIU S7, S0, 13100
9D01EE8C  8EE40058   LW A0, 88(S7)
9D01EE90  0F40EA50   JAL __subsf3
9D01EE94  8EE5014C   LW A1, 332(S7)
9D01EE98  AFA20010   SW V0, 16(SP)
9D01EE9C  AEE20058   SW V0, 88(S7)
9D01EEA0  00002021   ADDU A0, ZERO, ZERO
9D01EEA4  0F4101F6   JAL __lesf2
9D01EEA8  00402821   ADDU A1, V0, ZERO
9D01EEAC  1840003B   BLEZ V0, 0x9D01EF9C
9D01EEB0  03C04021   ADDU T0, FP, ZERO
9D01EEB4  8EEF0064   LW T7, 100(S7)
9D01EEB8  11E00005   BEQ T7, ZERO, 0x9D01EED0
9D01EEBC  2618332C   ADDIU T8, S0, 13100
9D01EEC0  92E5006C   LBU A1, 108(S7)
9D01EEC4  00052200   SLL A0, A1, 8
9D01EEC8  0B407BB8   J 0x9D01EEE0
9D01EECC  AFA40018   SW A0, 24(SP)
9D01EED0  93190090   LBU T9, 144(T8)
9D01EED4  3B28000F   XORI T0, T9, 15
9D01EED8  00084A00   SLL T1, T0, 8
9D01EEDC  AFA90018   SW T1, 24(SP)
9D01EEE0  8FA40010   LW A0, 16(SP)
9D01EEE4  0F4101F6   JAL __lesf2
9D01EEE8  00002821   ADDU A1, ZERO, ZERO
9D01EEEC  04410023   BGEZ V0, 0x9D01EF7C
9D01EEF0  2617332C   ADDIU S7, S0, 13100
9D01EEF4  8EE3005C   LW V1, 92(S7)
9D01EEF8  0F4105E3   JAL sitofp
9D01EEFC  24640001   ADDIU A0, V1, 1
9D01EF00  AFA2001C   SW V0, 28(SP)
9D01EF04  8EE2009C   LW V0, 156(S7)
9D01EF08  AFA20020   SW V0, 32(SP)
9D01EF0C  92F70098   LBU S7, 152(S7)
9D01EF10  AFA00014   SW ZERO, 20(SP)
9D01EF14  0000F021   ADDU FP, ZERO, ZERO
9D01EF18  8FA40010   LW A0, 16(SP)
9D01EF1C  0F40EA52   JAL fpadd
9D01EF20  8FA5001C   LW A1, 28(SP)
9D01EF24  AFA20010   SW V0, 16(SP)
9D01EF28  26E70001   ADDIU A3, S7, 1
9D01EF2C  30F7000F   ANDI S7, A3, 15
9D01EF30  8FAA0020   LW T2, 32(SP)
9D01EF34  02EA582A   SLT T3, S7, T2
9D01EF38  8FAC0018   LW T4, 24(SP)
9D01EF3C  03CC6821   ADDU T5, FP, T4
9D01EF40  03CCF023   SUBU FP, FP, T4
9D01EF44  01ABF00B   MOVN FP, T5, T3
9D01EF48  8FAE0014   LW T6, 20(SP)
9D01EF4C  25CF0001   ADDIU T7, T6, 1
9D01EF50  AFAF0014   SW T7, 20(SP)
9D01EF54  8FA40010   LW A0, 16(SP)
9D01EF58  0F4101F6   JAL __lesf2
9D01EF5C  00002821   ADDU A1, ZERO, ZERO
9D01EF60  0440FFEE   BLTZ V0, 0x9D01EF1C
9D01EF64  8FA40010   LW A0, 16(SP)
9D01EF68  261F332C   ADDIU RA, S0, 13100
9D01EF6C  8FB80010   LW T8, 16(SP)
9D01EF70  AFF80058   SW T8, 88(RA)
9D01EF74  0B407BE1   J 0x9D01EF84
9D01EF78  A3F70098   SB S7, 152(RA)
9D01EF7C  AFA00014   SW ZERO, 20(SP)
9D01EF80  0000F021   ADDU FP, ZERO, ZERO
9D01EF84  8FB90014   LW T9, 20(SP)
9D01EF88  03D9001A   DIV FP, T9
9D01EF8C  032001F4   TEQ T9, ZERO
9D01EF90  00004012   MFLO T0
9D01EF94  2609332C   ADDIU T1, S0, 13100
9D01EF98  AD280060   SW T0, 96(T1)
345:                 
346:                 
347:                 /* TRIANGLE WAVE
348:                 ** =============
349:                 ** reg0: 7=holdnote, 6-0=linear length counter
350:                 ** reg2: low 8 bits of frequency
351:                 ** reg3: 7-3=length counter, 2-0=high 3 bits of frequency
352:                 */
353:                 static int32 apu_triangle(void)
354:                 {
355:                    APU_VOLUME_DECAY(apu.triangle.output_vol);
9D01EFB0  2608332C   ADDIU T0, S0, 13100
9D01EFB4  8D0500B0   LW A1, 176(T0)
9D01EFB8  000521C3   SRA A0, A1, 7
9D01EFBC  00A43823   SUBU A3, A1, A0
9D01EFC0  AD0700B0   SW A3, 176(T0)
356:                 
357:                    if (false == apu.triangle.enabled || 0 == apu.triangle.vbl_length)
9D01EFC4  8D0900A4   LW T1, 164(T0)
9D01EFC8  11200004   BEQ T1, ZERO, 0x9D01EFDC
9D01EFCC  261E332C   ADDIU FP, S0, 13100
9D01EFD0  8FC600C4   LW A2, 196(FP)
9D01EFD4  14C00004   BNE A2, ZERO, 0x9D01EFE8
9D01EFD8  2603332C   ADDIU V1, S0, 13100
358:                       return APU_TRIANGLE_OUTPUT;
9D01EFDC  00071883   SRA V1, A3, 2
9D01EFE0  0B407C42   J 0x9D01F108
9D01EFE4  00E36021   ADDU T4, A3, V1
359:                 
360:                    if (apu.triangle.counter_started)
9D01EFE8  8C7700BC   LW S7, 188(V1)
9D01EFEC  12E0000B   BEQ S7, ZERO, 0x9D01F01C
9D01EFF0  2602332C   ADDIU V0, S0, 13100
361:                    {
362:                       if (apu.triangle.linear_length > 0)
9D01EFF4  261F332C   ADDIU RA, S0, 13100
9D01EFF8  8FF800C8   LW T8, 200(RA)
9D01EFFC  1B000168   BLEZ T8, 0x9D01F5A0
9D01F000  2619332C   ADDIU T9, S0, 13100
363:                          apu.triangle.linear_length--;
9D01F004  2708FFFF   ADDIU T0, T8, -1
9D01F008  0B407D68   J 0x9D01F5A0
9D01F00C  AF2800C8   SW T0, 200(T9)
364:                       if (apu.triangle.vbl_length && false == apu.triangle.holdnote)
9D01F5A0  2605332C   ADDIU A1, S0, 13100
9D01F5A4  8CA400B8   LW A0, 184(A1)
9D01F5A8  1080FE99   BEQ A0, ZERO, 0x9D01F010
9D01F5AC  2609332C   ADDIU T1, S0, 13100
365:                          apu.triangle.vbl_length--;
9D01F010  24DEFFFF   ADDIU FP, A2, -1
9D01F014  0B407C13   J 0x9D01F04C
9D01F018  AD3E00C4   SW FP, 196(T1)
366:                    }
367:                    else if (false == apu.triangle.holdnote && apu.triangle.write_latency)
9D01F01C  8C4A00B8   LW T2, 184(V0)
9D01F020  1540000B   BNE T2, ZERO, 0x9D01F050
9D01F024  2606332C   ADDIU A2, S0, 13100
9D01F028  260B332C   ADDIU T3, S0, 13100
9D01F02C  8D6C00C0   LW T4, 192(T3)
9D01F030  51800008   BEQL T4, ZERO, 0x9D01F054
9D01F034  8CC300C8   LW V1, 200(A2)
368:                    {
369:                       if (--apu.triangle.write_latency == 0)
9D01F038  258DFFFF   ADDIU T5, T4, -1
9D01F03C  260E332C   ADDIU T6, S0, 13100
9D01F040  15A00003   BNE T5, ZERO, 0x9D01F050
9D01F044  ADCD00C0   SW T5, 192(T6)
370:                          apu.triangle.counter_started = true;
9D01EB14  24160001   ADDIU S6, ZERO, 1
9D01F048  ADD600BC   SW S6, 188(T6)
371:                    }
372:                 
373:                    if (0 == apu.triangle.linear_length || apu.triangle.freq < 4) /* inaudible */
9D01F04C  2606332C   ADDIU A2, S0, 13100
9D01F050  8CC300C8   LW V1, 200(A2)
9D01F054  10600005   BEQ V1, ZERO, 0x9D01F06C
9D01F058  2617332C   ADDIU S7, S0, 13100
9D01F05C  8EE200AC   LW V0, 172(S7)
9D01F060  284A0004   SLTI T2, V0, 4
9D01F064  11400004   BEQ T2, ZERO, 0x9D01F078
9D01F068  AFA20014   SW V0, 20(SP)
9D01F5B0  0B407C14   J 0x9D01F050
9D01F5B4  2606332C   ADDIU A2, S0, 13100
374:                       return APU_TRIANGLE_OUTPUT;
9D01F06C  00073083   SRA A2, A3, 2
9D01F070  0B407C42   J 0x9D01F108
9D01F074  00E66021   ADDU T4, A3, A2
375:                 
376:                    apu.triangle.accum -= apu.cycle_rate; \
9D01F078  261E332C   ADDIU FP, S0, 13100
9D01F07C  8FC400A8   LW A0, 168(FP)
9D01F080  0F40EA50   JAL __subsf3
9D01F084  8FC5014C   LW A1, 332(FP)
9D01F088  8FC700B0   LW A3, 176(FP)
9D01F08C  AFA70010   SW A3, 16(SP)
9D01F090  93DE00B4   LBU FP, 180(FP)
9D01F094  0B407C37   J 0x9D01F0DC
9D01F098  0040B821   ADDU S7, V0, ZERO
377:                    while (apu.triangle.accum < 0)
9D01F0DC  02E02021   ADDU A0, S7, ZERO
9D01F0E0  0F4101F6   JAL __lesf2
9D01F0E4  00002821   ADDU A1, ZERO, ZERO
9D01F0E8  0440FFEC   BLTZ V0, 0x9D01F09C
9D01F0EC  260B332C   ADDIU T3, S0, 13100
9D01F0F0  8FA50010   LW A1, 16(SP)
9D01F0F4  AD6500B0   SW A1, 176(T3)
9D01F0F8  AD7700A8   SW S7, 168(T3)
9D01F0FC  A17E00B4   SB FP, 180(T3)
378:                    {
379:                       apu.triangle.accum += apu.triangle.freq;
9D01F09C  0F4105E3   JAL sitofp
9D01F0A0  8FA40014   LW A0, 20(SP)
9D01F0A4  00402021   ADDU A0, V0, ZERO
9D01F0A8  0F40EA52   JAL fpadd
9D01F0AC  02E02821   ADDU A1, S7, ZERO
9D01F0D4  0040B821   ADDU S7, V0, ZERO
380:                       apu.triangle.adder = (apu.triangle.adder + 1) & 0x1F;
9D01F0B0  27CD0001   ADDIU T5, FP, 1
9D01F0B4  31AE00FF   ANDI T6, T5, 255
9D01F0D8  31DE001F   ANDI FP, T6, 31
381:                 
382:                       if (apu.triangle.adder & 0x10)
9D01F0B8  31CF0010   ANDI T7, T6, 16
9D01F0BC  31F800FF   ANDI T8, T7, 255
383:                          apu.triangle.output_vol -= (2 << 8);
9D01F0C0  8FB90010   LW T9, 16(SP)
9D01F0C4  2728FE00   ADDIU T0, T9, -512
9D01F0C8  27290200   ADDIU T1, T9, 512
9D01F0CC  0138400A   MOVZ T0, T1, T8
9D01F0D0  AFA80010   SW T0, 16(SP)
384:                       else
385:                          apu.triangle.output_vol += (2 << 8);
386:                    }
387:                 
388:                    return APU_TRIANGLE_OUTPUT;
9D01F100  00052083   SRA A0, A1, 2
9D01F104  00A46021   ADDU T4, A1, A0
389:                 }
390:                 
391:                 
392:                 /* WHITE NOISE CHANNEL
393:                 ** ===================
394:                 ** reg0: 0-3=volume, 4=envelope, 5=hold
395:                 ** reg2: 7=small(93 byte) sample,3-0=freq lookup
396:                 ** reg3: 7-4=vbl length counter
397:                 */
398:                 /* TODO: AAAAAAAAAAAAAAAAAAAAAAAA!  #ifdef MADNESS! */
399:                 static int32 apu_noise(void)
400:                 {
401:                    int32 outvol;
402:                 
403:                 #if defined(APU_OVERSAMPLE) && defined(REALTIME_NOISE)
404:                 #else /* !(APU_OVERSAMPLE && REALTIME_NOISE) */
405:                    int32 noise_bit;
406:                 #endif /* !(APU_OVERSAMPLE && REALTIME_NOISE) */
407:                 #ifdef APU_OVERSAMPLE
408:                    int num_times;
409:                    int32 total;
410:                 #endif /* APU_OVERSAMPLE */
411:                 
412:                    APU_VOLUME_DECAY(apu.noise.output_vol);
9D01F11C  260A332C   ADDIU T2, S0, 13100
9D01F120  8D4700DC   LW A3, 220(T2)
9D01F124  000759C3   SRA T3, A3, 7
9D01F128  00EBB823   SUBU S7, A3, T3
9D01F12C  AD5700DC   SW S7, 220(T2)
413:                 
414:                    if (false == apu.noise.enabled || 0 == apu.noise.vbl_length)
9D01F130  8D4500D0   LW A1, 208(T2)
9D01F134  10A00004   BEQ A1, ZERO, 0x9D01F148
9D01F138  2604332C   ADDIU A0, S0, 13100
9D01F13C  8C8C00F8   LW T4, 248(A0)
9D01F140  15800005   BNE T4, ZERO, 0x9D01F158
9D01F144  260D332C   ADDIU T5, S0, 13100
415:                       return APU_NOISE_OUTPUT;
9D01F148  00172040   SLL A0, S7, 1
9D01F14C  02E4F821   ADDU RA, S7, A0
9D01F150  0B407CC3   J 0x9D01F30C
9D01F154  001FC883   SRA T9, RA, 2
416:                 
417:                    /* vbl length counter */
418:                    if (false == apu.noise.holdnote)
9D01F158  8DAA00F0   LW T2, 240(T5)
9D01F15C  15400003   BNE T2, ZERO, 0x9D01F16C
9D01F160  260F332C   ADDIU T7, S0, 13100
419:                       apu.noise.vbl_length--;
9D01F164  258EFFFF   ADDIU T6, T4, -1
9D01F168  ADAE00F8   SW T6, 248(T5)
9D01F16C  91EB00E8   LBU T3, 232(T7)
9D01F170  8DE600E4   LW A2, 228(T7)
420:                 
421:                    /* envelope decay at a rate of (env_delay + 1) / 240 secs */
422:                    apu.noise.env_phase -= 4; /* 240/60 */
9D01F174  8DF800E0   LW T8, 224(T7)
9D01F178  0B407C6A   J 0x9D01F1A8
9D01F17C  2702FFFC   ADDIU V0, T8, -4
423:                    while (apu.noise.env_phase < 0)
9D01F1A8  0440FFF5   BLTZ V0, 0x9D01F180
9D01F1AC  3C08A001   LUI T0, -24575
9D01F1B0  2509332C   ADDIU T1, T0, 13100
9D01F1B4  AD2200E0   SW V0, 224(T1)
9D01F1B8  A12B00E8   SB T3, 232(T1)
424:                    {
425:                       apu.noise.env_phase += apu.noise.env_delay;
426:                 
427:                       if (apu.noise.holdnote)
9D01F180  11400004   BEQ T2, ZERO, 0x9D01F194
9D01F184  2D67000F   SLTIU A3, T3, 15
428:                          apu.noise.env_vol = (apu.noise.env_vol + 1) & 0x0F;
9D01F188  25650001   ADDIU A1, T3, 1
9D01F18C  0B407C69   J 0x9D01F1A4
9D01F190  30AB000F   ANDI T3, A1, 15
429:                       else if (apu.noise.env_vol < 0x0F)
9D01F194  50E00004   BEQL A3, ZERO, 0x9D01F1A8
9D01F198  00461021   ADDU V0, V0, A2
430:                          apu.noise.env_vol++;
9D01F19C  25630001   ADDIU V1, T3, 1
9D01F1A0  306B00FF   ANDI T3, V1, 255
9D01F1A4  00461021   ADDU V0, V0, A2
431:                    }
432:                 
433:                    apu.noise.accum -= apu.cycle_rate;
9D01F1BC  8D2400D4   LW A0, 212(T1)
9D01F1C0  0F40EA50   JAL __subsf3
9D01F1C4  8D25014C   LW A1, 332(T1)
9D01F1C8  0040F021   ADDU FP, V0, ZERO
9D01F1CC  3C06A001   LUI A2, -24575
9D01F1D0  24C3332C   ADDIU V1, A2, 13100
9D01F1D4  AC6200D4   SW V0, 212(V1)
434:                    if (apu.noise.accum >= 0)
9D01F1D8  00002021   ADDU A0, ZERO, ZERO
9D01F1DC  0F4101F6   JAL __lesf2
9D01F1E0  00402821   ADDU A1, V0, ZERO
9D01F1E4  1C400004   BGTZ V0, 0x9D01F1F8
9D01F1E8  00174040   SLL T0, S7, 1
435:                       return APU_NOISE_OUTPUT;
9D01F1EC  02E84821   ADDU T1, S7, T0
9D01F1F0  0B407CC3   J 0x9D01F30C
9D01F1F4  0009C883   SRA T9, T1, 2
436:                    
437:                 #ifdef APU_OVERSAMPLE
438:                    if (apu.noise.fixed_envelope)
9D01F1F8  2617332C   ADDIU S7, S0, 13100
9D01F1FC  8EFF00EC   LW RA, 236(S7)
9D01F200  13E00006   BEQ RA, ZERO, 0x9D01F21C
9D01F204  2602332C   ADDIU V0, S0, 13100
439:                       outvol = apu.noise.volume << 8; /* fixed volume */
9D01F208  2605332C   ADDIU A1, S0, 13100
9D01F20C  90A400F4   LBU A0, 244(A1)
9D01F210  00046200   SLL T4, A0, 8
9D01F214  0B407C8B   J 0x9D01F22C
9D01F218  AFAC0018   SW T4, 24(SP)
440:                    else
441:                       outvol = (apu.noise.env_vol ^ 0x0F) << 8;
9D01F21C  904A00E8   LBU T2, 232(V0)
9D01F220  3947000F   XORI A3, T2, 15
9D01F224  00075A00   SLL T3, A3, 8
9D01F228  AFAB0018   SW T3, 24(SP)
442:                 
443:                    num_times = total = 0;
9D01F258  AFA00014   SW ZERO, 20(SP)
9D01F25C  AFA00010   SW ZERO, 16(SP)
9D01F2DC  AFA00014   SW ZERO, 20(SP)
9D01F2E0  AFA00010   SW ZERO, 16(SP)
444:                 #endif /* APU_OVERSAMPLE */
445:                 
446:                    while (apu.noise.accum < 0)
9D01F22C  03C02021   ADDU A0, FP, ZERO
9D01F230  0F4101F6   JAL __lesf2
9D01F234  00002821   ADDU A1, ZERO, ZERO
9D01F238  04410028   BGEZ V0, 0x9D01F2DC
9D01F23C  2617332C   ADDIU S7, S0, 13100
9D01F2B8  03C02021   ADDU A0, FP, ZERO
9D01F2BC  0F4101F6   JAL __lesf2
9D01F2C0  00002821   ADDU A1, ZERO, ZERO
9D01F2C4  0440FFE7   BLTZ V0, 0x9D01F264
9D01F2C8  03C02021   ADDU A0, FP, ZERO
9D01F2CC  261F332C   ADDIU RA, S0, 13100
9D01F2D0  AFFE00D4   SW FP, 212(RA)
9D01F2D4  0B407CB9   J 0x9D01F2E4
9D01F2D8  AF97802C   SW S7, -32724(GP)
447:                    {
448:                       apu.noise.accum += apu.noise.freq;
9D01F240  0F4105E3   JAL sitofp
9D01F244  8EE400D8   LW A0, 216(S7)
9D01F248  AFA2001C   SW V0, 28(SP)
9D01F260  03C02021   ADDU A0, FP, ZERO
9D01F264  0F40EA52   JAL fpadd
9D01F268  8FA5001C   LW A1, 28(SP)
9D01F26C  0040F021   ADDU FP, V0, ZERO
449:                 
450:                 #ifdef REALTIME_NOISE
451:                 
452:                 #ifdef APU_OVERSAMPLE
453:                       if (shift_register15(apu.noise.xor_tap))
454:                          total += outvol;
9D01F290  8FA20010   LW V0, 16(SP)
9D01F294  8FAA0018   LW T2, 24(SP)
9D01F298  004A1821   ADDU V1, V0, T2
9D01F29C  004A3823   SUBU A3, V0, T2
9D01F2A0  01D65826   XOR T3, T6, S6
9D01F2A4  00EB180A   MOVZ V1, A3, T3
9D01F2A8  AFA30010   SW V1, 16(SP)
455:                       else
456:                          total -= outvol;
457:                 
458:                       num_times++;
9D01F2AC  8FA50014   LW A1, 20(SP)
9D01F2B0  24A40001   ADDIU A0, A1, 1
9D01F2B4  AFA40014   SW A0, 20(SP)
459:                 #else /* !APU_OVERSAMPLE */
460:                       noise_bit = shift_register15(apu.noise.xor_tap);
461:                 #endif /* !APU_OVERSAMPLE */
462:                 
463:                 #else /* !REALTIME_NOISE */
464:                       apu.noise.cur_pos++;
465:                 
466:                       if (apu.noise.short_sample)
467:                       {
468:                          if (APU_NOISE_93 == apu.noise.cur_pos)
469:                             apu.noise.cur_pos = 0;
470:                       }
471:                       else
472:                       {
473:                          if (APU_NOISE_32K == apu.noise.cur_pos)
474:                             apu.noise.cur_pos = 0;
475:                       }
476:                 
477:                 #ifdef APU_OVERSAMPLE
478:                       if (apu.noise.short_sample)
479:                          noise_bit = noise_short_lut[apu.noise.cur_pos];
480:                       else
481:                          noise_bit = noise_long_lut[apu.noise.cur_pos];
482:                 
483:                       if (noise_bit)
484:                          total += outvol;
485:                       else
486:                          total -= outvol;
487:                 
488:                       num_times++;
489:                 #endif /* APU_OVERSAMPLE */
490:                 #endif /* !REALTIME_NOISE */
491:                    }
492:                 
493:                 #ifdef APU_OVERSAMPLE
494:                    apu.noise.output_vol = total / num_times;
9D01F2E4  8FAC0010   LW T4, 16(SP)
9D01F2E8  8FAD0014   LW T5, 20(SP)
9D01F2EC  018D001A   DIV T4, T5
9D01F2F0  01A001F4   TEQ T5, ZERO
9D01F2F4  0000F012   MFLO FP
9D01F2F8  260E332C   ADDIU T6, S0, 13100
9D01F2FC  ADDE00DC   SW FP, 220(T6)
495:                 #else /* !APU_OVERSAMPLE */
496:                    if (apu.noise.fixed_envelope)
497:                       outvol = apu.noise.volume << 8; /* fixed volume */
498:                    else
499:                       outvol = (apu.noise.env_vol ^ 0x0F) << 8;
500:                 
501:                 #ifndef REALTIME_NOISE
502:                    if (apu.noise.short_sample)
503:                       noise_bit = noise_short_lut[apu.noise.cur_pos];
504:                    else
505:                       noise_bit = noise_long_lut[apu.noise.cur_pos];
506:                 #endif /* !REALTIME_NOISE */
507:                 
508:                    if (noise_bit)
509:                       apu.noise.output_vol = outvol;
510:                    else
511:                       apu.noise.output_vol = -outvol;
512:                 #endif /* !APU_OVERSAMPLE */
513:                 
514:                    return APU_NOISE_OUTPUT;
9D01F300  001E7840   SLL T7, FP, 1
9D01F304  03CFC021   ADDU T8, FP, T7
9D01F308  0018C883   SRA T9, T8, 2
515:                 }
516:                 
517:                 
518:                 INLINE void apu_dmcreload(void)
519:                 {
520:                    apu.dmc.address = apu.dmc.cached_addr;
9D01F3DC  8C860118   LW A2, 280(A0)
9D01FE14  3C02A001   LUI V0, -24575
521:                    apu.dmc.dma_length = apu.dmc.cached_dmalength;
9D01F3E4  8C870120   LW A3, 288(A0)
9D01FE24  8CA60120   LW A2, 288(A1)
522:                    apu.dmc.irq_occurred = false;
9D01F3EC  0B407D09   J 0x9D01F424
9D01F3F0  AC800130   SW ZERO, 304(A0)
523:                 }
524:                 
525:                 /* DELTA MODULATION CHANNEL
526:                 ** =========================
527:                 ** reg0: 7=irq gen, 6=looping, 3-0=pointer to clock table
528:                 ** reg1: output dc level, 6 bits unsigned
529:                 ** reg2: 8 bits of 64-byte aligned address offset : $C000 + (value * 64)
530:                 ** reg3: length, (value * 16) + 1
531:                 */
532:                 static int32 apu_dmc(void)
533:                 {
534:                    int delta_bit;
535:                 
536:                    APU_VOLUME_DECAY(apu.dmc.output_vol);
9D01F320  261E332C   ADDIU FP, S0, 13100
9D01F324  8FC60110   LW A2, 272(FP)
9D01F328  000639C3   SRA A3, A2, 7
9D01F32C  00C77023   SUBU T6, A2, A3
9D01F330  AFCE0110   SW T6, 272(FP)
537:                 
538:                    /* only process when channel is alive */
539:                    if (apu.dmc.dma_length)
9D01F334  8FCF011C   LW T7, 284(FP)
9D01F338  11E0005C   BEQ T7, ZERO, 0x9D01F4AC
9D01F33C  2612332C   ADDIU S2, S0, 13100
540:                    {
541:                       apu.dmc.accum -= apu.cycle_rate;
9D01F340  8E440108   LW A0, 264(S2)
9D01F344  0F40EA50   JAL __subsf3
9D01F348  8E45014C   LW A1, 332(S2)
9D01F34C  0B407D24   J 0x9D01F490
9D01F350  AE420108   SW V0, 264(S2)
542:                       
543:                       while (apu.dmc.accum < 0)
9D01F490  2618332C   ADDIU T8, S0, 13100
9D01F494  8F170108   LW S7, 264(T8)
9D01F498  02E02021   ADDU A0, S7, ZERO
9D01F49C  0F4101F6   JAL __lesf2
9D01F4A0  00002821   ADDU A1, ZERO, ZERO
9D01F4A4  0440FFAB   BLTZ V0, 0x9D01F354
9D01F4A8  261E332C   ADDIU FP, S0, 13100
544:                       {
545:                          apu.dmc.accum += apu.dmc.freq;
9D01F354  0F4105E3   JAL sitofp
9D01F358  8FC4010C   LW A0, 268(FP)
9D01F35C  00402021   ADDU A0, V0, ZERO
9D01F360  0F40EA52   JAL fpadd
9D01F364  02E02821   ADDU A1, S7, ZERO
9D01F368  AFC20108   SW V0, 264(FP)
546:                          
547:                          delta_bit = (apu.dmc.dma_length & 7) ^ 7;
9D01F36C  8FD9011C   LW T9, 284(FP)
9D01F370  00194027   NOR T0, ZERO, T9
9D01F374  31120007   ANDI S2, T0, 7
548:                          
549:                          if (7 == delta_bit)
9D01F378  16540011   BNE S2, S4, 0x9D01F3C0
9D01F37C  2604332C   ADDIU A0, S0, 13100
550:                          {
551:                             apu.dmc.cur_byte = nes6502_getbyte(apu.dmc.address);
9D01F380  2617332C   ADDIU S7, S0, 13100
9D01F384  0F4031DE   JAL nes6502_getbyte
9D01F388  8EE40114   LW A0, 276(S7)
9D01F38C  A2E20124   SB V0, 292(S7)
552:                             
553:                             /* steal a cycle from CPU*/
554:                             nes6502_burn(1);
9D01F390  0F40575A   JAL nes6502_burn
9D01F394  02C02021   ADDU A0, S6, ZERO
555:                 
556:                             /* prevent wraparound */
557:                             if (0xFFFF == apu.dmc.address)
9D01F398  8EE90114   LW T1, 276(S7)
9D01F39C  340AFFFF   ORI T2, ZERO, -1
9D01F3A0  152A0004   BNE T1, T2, 0x9D01F3B4
9D01F3A4  2603332C   ADDIU V1, S0, 13100
558:                                apu.dmc.address = 0x8000;
9D01F3A8  34028000   ORI V0, ZERO, -32768
9D01F3AC  0B407CEF   J 0x9D01F3BC
9D01F3B0  AEE20114   SW V0, 276(S7)
559:                             else
560:                                apu.dmc.address++;
9D01F3B4  252B0001   ADDIU T3, T1, 1
9D01F3B8  AC6B0114   SW T3, 276(V1)
561:                          }
562:                 
563:                          if (--apu.dmc.dma_length == 0)
9D01F3BC  2604332C   ADDIU A0, S0, 13100
9D01F3C0  8C9F011C   LW RA, 284(A0)
9D01F3C4  27ECFFFF   ADDIU T4, RA, -1
9D01F3C8  15800016   BNE T4, ZERO, 0x9D01F424
9D01F3CC  AC8C011C   SW T4, 284(A0)
564:                          {
565:                             /* if loop bit set, we're cool to retrigger sample */
566:                             if (apu.dmc.looping)
9D01F3D0  8C860128   LW A2, 296(A0)
9D01F3D4  10C00007   BEQ A2, ZERO, 0x9D01F3F4
9D01F3D8  2607332C   ADDIU A3, S0, 13100
567:                             {
568:                                apu_dmcreload();
569:                             }
570:                             else
571:                             {
572:                                /* check to see if we should generate an irq */
573:                                if (apu.dmc.irq_gen)
9D01F3F4  8CEE012C   LW T6, 300(A3)
9D01F3F8  11C00007   BEQ T6, ZERO, 0x9D01F418
9D01F3FC  260F332C   ADDIU T7, S0, 13100
574:                                {
575:                                   apu.dmc.irq_occurred = true;
9D01F400  ADF60130   SW S6, 304(T7)
576:                                   if (apu.irq_callback)
9D01F404  8DF80160   LW T8, 352(T7)
9D01F408  13000004   BEQ T8, ZERO, 0x9D01F41C
9D01F40C  261E332C   ADDIU FP, S0, 13100
577:                                      apu.irq_callback();
9D01F410  0300F809   JALR T8
9D01F414  00000000   NOP
578:                                }
579:                 
580:                                /* bodge for timestamp queue */
581:                                apu.dmc.enabled = false;
9D01F418  261E332C   ADDIU FP, S0, 13100
9D01F41C  0B407D2B   J 0x9D01F4AC
9D01F420  AFC00104   SW ZERO, 260(FP)
582:                                break;
583:                             }
584:                          }
585:                 
586:                          /* positive delta */
587:                          if (apu.dmc.cur_byte & (1 << delta_bit))
9D01F424  2603332C   ADDIU V1, S0, 13100
9D01F428  90650124   LBU A1, 292(V1)
9D01F42C  02457007   SRAV T6, A1, S2
9D01F430  31C20001   ANDI V0, T6, 1
9D01F434  1040000D   BEQ V0, ZERO, 0x9D01F46C
9D01F438  260F332C   ADDIU T7, S0, 13100
588:                          {
589:                             if (apu.dmc.regs[1] < 0x7D)
9D01F43C  260A332C   ADDIU T2, S0, 13100
9D01F440  91440101   LBU A0, 257(T2)
9D01F444  2C8B007D   SLTIU T3, A0, 125
9D01F448  11600012   BEQ T3, ZERO, 0x9D01F494
9D01F44C  2618332C   ADDIU T8, S0, 13100
590:                             {
591:                                apu.dmc.regs[1] += 2;
9D01F450  261E332C   ADDIU FP, S0, 13100
9D01F454  249F0002   ADDIU RA, A0, 2
9D01F458  A3DF0101   SB RA, 257(FP)
592:                                apu.dmc.output_vol += (2 << 8);
9D01F45C  8FCC0110   LW T4, 272(FP)
9D01F460  258D0200   ADDIU T5, T4, 512
9D01F464  0B407D25   J 0x9D01F494
9D01F468  AFCD0110   SW T5, 272(FP)
593:                             }
594:                          }
595:                          /* negative delta */
596:                          else            
597:                          {
598:                             if (apu.dmc.regs[1] > 1)
9D01F46C  91F80101   LBU T8, 257(T7)
9D01F470  2F190002   SLTIU T9, T8, 2
9D01F474  17200006   BNE T9, ZERO, 0x9D01F490
9D01F478  2608332C   ADDIU T0, S0, 13100
599:                             {
600:                                apu.dmc.regs[1] -= 2;
9D01F47C  2712FFFE   ADDIU S2, T8, -2
9D01F480  A1120101   SB S2, 257(T0)
601:                                apu.dmc.output_vol -= (2 << 8);
9D01F484  8D170110   LW S7, 272(T0)
9D01F488  26E9FE00   ADDIU T1, S7, -512
9D01F48C  AD090110   SW T1, 272(T0)
602:                             }
603:                          }
604:                       }
605:                    }
606:                 
607:                    return APU_DMC_OUTPUT;
9D01F4AC  2619332C   ADDIU T9, S0, 13100
9D01F4B0  8F280110   LW T0, 272(T9)
9D01F4B4  00089040   SLL S2, T0, 1
9D01F4B8  01121821   ADDU V1, T0, S2
9D01F4BC  00032883   SRA A1, V1, 2
608:                 }
609:                 
610:                 
611:                 void apu_write(uint32 address, uint8 value)
612:                 {  
9D01F8CC  27BDFFE0   ADDIU SP, SP, -32
9D01F8D0  AFBF001C   SW RA, 28(SP)
9D01F8D4  AFB10018   SW S1, 24(SP)
9D01F8D8  AFB00014   SW S0, 20(SP)
9D01F8DC  00A08021   ADDU S0, A1, ZERO
613:                    int chan;
614:                 
615:                    switch (address)
9D01F8BC  2482C000   ADDIU V0, A0, -16384
9D01F8C0  2C430016   SLTIU V1, V0, 22
9D01F8C4  10600161   BEQ V1, ZERO, 0x9D01FE4C
9D01F8C8  3C069D02   LUI A2, -25342
9D01F8E0  00022880   SLL A1, V0, 2
9D01F8E4  24C7F8F8   ADDIU A3, A2, -1800
9D01F8E8  00E54021   ADDU T0, A3, A1
9D01F8EC  8D090000   LW T1, 0(T0)
9D01F8F0  01200008   JR T1
9D01F8F4  00000000   NOP
616:                    {
617:                    /* rectangles */
618:                    case APU_WRA0:
619:                    case APU_WRB0:
620:                       chan = (address & 4) >> 2;
9D01F950  7C840080   EXT A0, A0, 2, 1
621:                       apu.rectangle[chan].regs[0] = value;
9D01F954  00045100   SLL T2, A0, 4
9D01F958  00045980   SLL T3, A0, 6
9D01F95C  014B6021   ADDU T4, T2, T3
9D01F960  3C0DA001   LUI T5, -24575
9D01F964  25AE332C   ADDIU T6, T5, 13100
9D01F968  018E7821   ADDU T7, T4, T6
9D01F96C  A1F00000   SB S0, 0(T7)
622:                       apu.rectangle[chan].volume = value & 0x0F;
9D01F970  3218000F   ANDI T8, S0, 15
9D01F974  A1F8001C   SB T8, 28(T7)
623:                       apu.rectangle[chan].env_delay = decay_lut[value & 0x0F];
9D01F978  0018F880   SLL RA, T8, 2
9D01F97C  3C11A001   LUI S1, -24575
9D01F980  263932EC   ADDIU T9, S1, 13036
9D01F984  03F91021   ADDU V0, RA, T9
9D01F988  8C430000   LW V1, 0(V0)
9D01F98C  ADE3003C   SW V1, 60(T7)
624:                       apu.rectangle[chan].holdnote = (value & 0x20) ? true : false;
9D01F990  7E050140   EXT A1, S0, 5, 1
9D01F994  ADE50018   SW A1, 24(T7)
625:                       apu.rectangle[chan].fixed_envelope = (value & 0x10) ? true : false;
9D01F998  7E060100   EXT A2, S0, 4, 1
9D01F99C  ADE60014   SW A2, 20(T7)
626:                       apu.rectangle[chan].duty_flip = duty_flip[value >> 6];
9D01F9A0  00108182   SRL S0, S0, 6
9D01F9A4  00103880   SLL A3, S0, 2
9D01F9A8  3C089D04   LUI T0, -25340
9D01F9AC  2509F494   ADDIU T1, T0, -2924
9D01F9B0  00E92021   ADDU A0, A3, T1
9D01F9B4  8C8A0000   LW T2, 0(A0)
627:                       break;
9D01F9B8  0B407F8F   J 0x9D01FE3C
9D01F9BC  ADEA004C   SW T2, 76(T7)
628:                 
629:                    case APU_WRA1:
630:                    case APU_WRB1:
631:                       chan = (address & 4) >> 2;
9D01F9C0  7C880080   EXT T0, A0, 2, 1
632:                       apu.rectangle[chan].regs[1] = value;
9D01F9C4  00084900   SLL T1, T0, 4
9D01F9C8  00082180   SLL A0, T0, 6
9D01F9CC  01245021   ADDU T2, T1, A0
9D01F9D0  3C0BA001   LUI T3, -24575
9D01F9D4  256C332C   ADDIU T4, T3, 13100
9D01F9D8  014C6821   ADDU T5, T2, T4
9D01F9DC  A1B00001   SB S0, 1(T5)
633:                       apu.rectangle[chan].sweep_on = (value & 0x80) ? true : false;
9D01F9E0  001071C2   SRL T6, S0, 7
9D01F9E4  ADAE0028   SW T6, 40(T5)
634:                       apu.rectangle[chan].sweep_shifts = value & 7;
9D01F9E8  320F0007   ANDI T7, S0, 7
9D01F9EC  A1AF002C   SB T7, 44(T5)
635:                       apu.rectangle[chan].sweep_delay = decay_lut[(value >> 4) & 7];
9D01F9F0  7E181100   EXT T8, S0, 4, 3
9D01F9F4  0018F880   SLL RA, T8, 2
9D01F9F8  3C11A001   LUI S1, -24575
9D01F9FC  263932EC   ADDIU T9, S1, 13036
9D01FA00  03F91021   ADDU V0, RA, T9
9D01FA04  8C430000   LW V1, 0(V0)
9D01FA08  ADA30024   SW V1, 36(T5)
636:                       apu.rectangle[chan].sweep_inc = (value & 0x08) ? true : false;
9D01FA0C  7E1000C0   EXT S0, S0, 3, 1
9D01FA10  ADB00030   SW S0, 48(T5)
637:                       apu.rectangle[chan].freq_limit = freq_limit[value & 7];
9D01FA14  000F2880   SLL A1, T7, 2
9D01FA18  3C069D04   LUI A2, -25340
9D01FA1C  24C7F524   ADDIU A3, A2, -2780
9D01FA20  00A74021   ADDU T0, A1, A3
9D01FA24  8D090000   LW T1, 0(T0)
638:                       break;
9D01FA28  0B407F8F   J 0x9D01FE3C
9D01FA2C  ADA90034   SW T1, 52(T5)
639:                 
640:                    case APU_WRA2:
641:                    case APU_WRB2:
642:                       chan = (address & 4) >> 2;
9D01FA30  7C980080   EXT T8, A0, 2, 1
643:                       apu.rectangle[chan].regs[2] = value;
9D01FA34  0018F900   SLL RA, T8, 4
9D01FA38  00188980   SLL S1, T8, 6
9D01FA3C  03F1C821   ADDU T9, RA, S1
9D01FA40  3C02A001   LUI V0, -24575
9D01FA44  2443332C   ADDIU V1, V0, 13100
9D01FA48  03232821   ADDU A1, T9, V1
9D01FA4C  A0B00002   SB S0, 2(A1)
644:                       apu.rectangle[chan].freq = (apu.rectangle[chan].freq & ~0xFF) | value;
9D01FA50  8CA6000C   LW A2, 12(A1)
9D01FA54  7C063804   INS A2, ZERO, 0, 8
9D01FA58  02063825   OR A3, S0, A2
645:                       break;
9D01FA5C  0B407F8F   J 0x9D01FE3C
9D01FA60  ACA7000C   SW A3, 12(A1)
646:                 
647:                    case APU_WRA3:
648:                    case APU_WRB3:
649:                       chan = (address & 4) >> 2;
9D01FA64  7C910080   EXT S1, A0, 2, 1
650:                       apu.rectangle[chan].regs[3] = value;
9D01FA68  0011C900   SLL T9, S1, 4
9D01FA6C  00111180   SLL V0, S1, 6
9D01FA70  03221821   ADDU V1, T9, V0
9D01FA74  3C05A001   LUI A1, -24575
9D01FA78  24A6332C   ADDIU A2, A1, 13100
9D01FA7C  00663821   ADDU A3, V1, A2
9D01FA80  A0F00003   SB S0, 3(A3)
651:                       apu.rectangle[chan].vbl_length = vbl_lut[value >> 3];
9D01FA84  001040C2   SRL T0, S0, 3
9D01FA88  00084880   SLL T1, T0, 2
9D01FA8C  3C04A001   LUI A0, -24575
9D01FA90  248A326C   ADDIU T2, A0, 12908
9D01FA94  012A5821   ADDU T3, T1, T2
9D01FA98  8D6C0000   LW T4, 0(T3)
9D01FA9C  ACEC0044   SW T4, 68(A3)
652:                       apu.rectangle[chan].env_vol = 0;
9D01FAA0  A0E00040   SB ZERO, 64(A3)
653:                       apu.rectangle[chan].freq = ((value & 7) << 8) | (apu.rectangle[chan].freq & 0xFF);
9D01FAA4  320D0007   ANDI T5, S0, 7
9D01FAA8  000D8200   SLL S0, T5, 8
9D01FAAC  90EE000C   LBU T6, 12(A3)
9D01FAB0  020E7825   OR T7, S0, T6
9D01FAB4  ACEF000C   SW T7, 12(A3)
654:                       apu.rectangle[chan].adder = 0;
655:                       break;
9D01FAB8  0B407F8F   J 0x9D01FE3C
9D01FABC  A0E00048   SB ZERO, 72(A3)
656:                 
657:                    /* triangle */
658:                    case APU_WRC0:
659:                       apu.triangle.regs[0] = value;
9D01FAC0  3C07A001   LUI A3, -24575
9D01FAC4  24E8332C   ADDIU T0, A3, 13100
9D01FAC8  A11000A0   SB S0, 160(T0)
660:                       apu.triangle.holdnote = (value & 0x80) ? true : false;
9D01FACC  001049C2   SRL T1, S0, 7
9D01FAD0  AD0900B8   SW T1, 184(T0)
661:                 
662:                       if (false == apu.triangle.counter_started && apu.triangle.vbl_length)
9D01FAD4  8D0400BC   LW A0, 188(T0)
9D01FAD8  148000D8   BNE A0, ZERO, 0x9D01FE3C
9D01FADC  3C0AA001   LUI T2, -24575
9D01FAE0  8D4B33F0   LW T3, 13296(T2)
9D01FAE4  116000D6   BEQ T3, ZERO, 0x9D01FE40
9D01FAE8  8FBF001C   LW RA, 28(SP)
663:                          apu.triangle.linear_length = trilength_lut[value & 0x7F];
9D01FAEC  320C007F   ANDI T4, S0, 127
9D01FAF0  000C6880   SLL T5, T4, 2
9D01FAF4  3C10A001   LUI S0, -24575
9D01FAF8  260E306C   ADDIU T6, S0, 12396
9D01FAFC  01AE7821   ADDU T7, T5, T6
9D01FB00  8DF80000   LW T8, 0(T7)
9D01FB04  3C1FA001   LUI RA, -24575
9D01FB08  0B407F8F   J 0x9D01FE3C
9D01FB0C  AFF833F4   SW T8, 13300(RA)
664:                 
665:                       break;
666:                 
667:                    case APU_WRC2:
668:                       apu.triangle.regs[1] = value;
9D01FB10  3C1FA001   LUI RA, -24575
9D01FB14  27F1332C   ADDIU S1, RA, 13100
9D01FB18  A23000A1   SB S0, 161(S1)
669:                       apu.triangle.freq = (((apu.triangle.regs[2] & 7) << 8) + value) + 1;
9D01FB1C  923900A2   LBU T9, 162(S1)
9D01FB20  33220007   ANDI V0, T9, 7
9D01FB24  00021A00   SLL V1, V0, 8
9D01FB28  00702821   ADDU A1, V1, S0
9D01FB2C  24A60001   ADDIU A2, A1, 1
670:                       break;
9D01FB30  0B407F8F   J 0x9D01FE3C
9D01FB34  AE2600AC   SW A2, 172(S1)
671:                 
672:                    case APU_WRC3:
673:                 
674:                       apu.triangle.regs[2] = value;
9D01FB38  3C0EA001   LUI T6, -24575
9D01FB3C  25D1332C   ADDIU S1, T6, 13100
9D01FB40  A23000A2   SB S0, 162(S1)
675:                   
676:                       /* this is somewhat of a hack.  there appears to be some latency on 
677:                       ** the Real Thing between when trireg0 is written to and when the 
678:                       ** linear length counter actually begins its countdown.  we want to 
679:                       ** prevent the case where the program writes to the freq regs first, 
680:                       ** then to reg 0, and the counter accidentally starts running because 
681:                       ** of the sound queue's timestamp processing.
682:                       **
683:                       ** set latency to a couple hundred cycles -- should be plenty of time 
684:                       ** for the 6502 code to do a couple of table dereferences and load up 
685:                       ** the other triregs
686:                       */
687:                       apu.triangle.write_latency = (int) (228 / apu.cycle_rate);
9D01FB44  3C0F9D04   LUI T7, -25340
9D01FB48  8DE4F564   LW A0, -2716(T7)
9D01FB4C  0F40ED27   JAL __divsf3
9D01FB50  8E25014C   LW A1, 332(S1)
9D01FB54  0F41039C   JAL __fixsfsi
9D01FB58  00402021   ADDU A0, V0, ZERO
9D01FB5C  AE2200C0   SW V0, 192(S1)
688:                       apu.triangle.freq = (((value & 7) << 8) + apu.triangle.regs[1]) + 1;
9D01FB60  32180007   ANDI T8, S0, 7
9D01FB64  0018CA00   SLL T9, T8, 8
9D01FB68  922200A1   LBU V0, 161(S1)
9D01FB6C  03221821   ADDU V1, T9, V0
9D01FB70  24650001   ADDIU A1, V1, 1
9D01FB74  AE2500AC   SW A1, 172(S1)
689:                       apu.triangle.vbl_length = vbl_lut[value >> 3];
9D01FB78  001030C2   SRL A2, S0, 3
9D01FB7C  00063880   SLL A3, A2, 2
9D01FB80  3C08A001   LUI T0, -24575
9D01FB84  2509326C   ADDIU T1, T0, 12908
9D01FB88  00E92021   ADDU A0, A3, T1
9D01FB8C  8C8A0000   LW T2, 0(A0)
9D01FB90  AE2A00C4   SW T2, 196(S1)
690:                       apu.triangle.counter_started = false;
9D01FB94  AE2000BC   SW ZERO, 188(S1)
691:                       apu.triangle.linear_length = trilength_lut[apu.triangle.regs[0] & 0x7F];
9D01FB98  922B00A0   LBU T3, 160(S1)
9D01FB9C  316C007F   ANDI T4, T3, 127
9D01FBA0  000C6880   SLL T5, T4, 2
9D01FBA4  3C10A001   LUI S0, -24575
9D01FBA8  260E306C   ADDIU T6, S0, 12396
9D01FBAC  01AE7821   ADDU T7, T5, T6
9D01FBB0  8DF80000   LW T8, 0(T7)
692:                       break;
9D01FBB4  0B407F8F   J 0x9D01FE3C
9D01FBB8  AE3800C8   SW T8, 200(S1)
693:                 
694:                    /* noise */
695:                    case APU_WRD0:
696:                       apu.noise.regs[0] = value;
9D01FBBC  3C06A001   LUI A2, -24575
9D01FBC0  24C7332C   ADDIU A3, A2, 13100
9D01FBC4  A0F000CC   SB S0, 204(A3)
697:                       apu.noise.env_delay = decay_lut[value & 0x0F];
9D01FBC8  3208000F   ANDI T0, S0, 15
9D01FBCC  00084880   SLL T1, T0, 2
9D01FBD0  3C04A001   LUI A0, -24575
9D01FBD4  248A32EC   ADDIU T2, A0, 13036
9D01FBD8  012A5821   ADDU T3, T1, T2
9D01FBDC  8D6C0000   LW T4, 0(T3)
9D01FBE0  ACEC00E4   SW T4, 228(A3)
698:                       apu.noise.holdnote = (value & 0x20) ? true : false;
9D01FBE4  7E0D0140   EXT T5, S0, 5, 1
9D01FBE8  ACED00F0   SW T5, 240(A3)
699:                       apu.noise.fixed_envelope = (value & 0x10) ? true : false;
9D01FBEC  7E100100   EXT S0, S0, 4, 1
9D01FBF0  ACF000EC   SW S0, 236(A3)
700:                       apu.noise.volume = value & 0x0F;
701:                       break;
9D01FBF4  0B407F8F   J 0x9D01FE3C
9D01FBF8  A0E800F4   SB T0, 244(A3)
702:                 
703:                    case APU_WRD2:
704:                       apu.noise.regs[1] = value;
9D01FBFC  3C0AA001   LUI T2, -24575
9D01FC00  254B332C   ADDIU T3, T2, 13100
9D01FC04  A17000CD   SB S0, 205(T3)
705:                       apu.noise.freq = noise_freq[value & 0x0F];
9D01FC08  320C000F   ANDI T4, S0, 15
9D01FC0C  000C6880   SLL T5, T4, 2
9D01FC10  3C0E9D04   LUI T6, -25340
9D01FC14  25CFF4E4   ADDIU T7, T6, -2844
9D01FC18  01AF8821   ADDU S1, T5, T7
9D01FC1C  8E380000   LW T8, 0(S1)
9D01FC20  AD7800D8   SW T8, 216(T3)
706:                 
707:                 #ifdef REALTIME_NOISE
708:                       apu.noise.xor_tap = (value & 0x80) ? 0x40: 0x02;
9D01FC24  0010C9C2   SRL T9, S0, 7
9D01FC28  241F0040   ADDIU RA, ZERO, 64
9D01FC2C  24020002   ADDIU V0, ZERO, 2
9D01FC30  0059F80A   MOVZ RA, V0, T9
9D01FC34  3C05A001   LUI A1, -24575
709:                 #else /* !REALTIME_NOISE */
710:                       /* detect transition from long->short sample */
711:                       if ((value & 0x80) && false == apu.noise.short_sample)
712:                       {
713:                          /* recalculate short noise buffer */
714:                          shift_register15(noise_short_lut, APU_NOISE_93);
715:                          apu.noise.cur_pos = 0;
716:                       }
717:                       apu.noise.short_sample = (value & 0x80) ? true : false;
718:                 #endif /* !REALTIME_NOISE */
719:                       break;
9D01FC38  0B407F8F   J 0x9D01FE3C
9D01FC3C  A0BF3428   SB RA, 13352(A1)
720:                 
721:                    case APU_WRD3:
722:                       apu.noise.regs[2] = value;
9D01FC40  3C03A001   LUI V1, -24575
9D01FC44  2465332C   ADDIU A1, V1, 13100
9D01FC48  A0B000CE   SB S0, 206(A1)
723:                       apu.noise.vbl_length = vbl_lut[value >> 3];
9D01FC4C  001080C2   SRL S0, S0, 3
9D01FC50  00103080   SLL A2, S0, 2
9D01FC54  3C07A001   LUI A3, -24575
9D01FC58  24E8326C   ADDIU T0, A3, 12908
9D01FC5C  00C84821   ADDU T1, A2, T0
9D01FC60  8D240000   LW A0, 0(T1)
9D01FC64  ACA400F8   SW A0, 248(A1)
724:                       apu.noise.env_vol = 0; /* reset envelope */
725:                       break;
9D01FC68  0B407F8F   J 0x9D01FE3C
9D01FC6C  A0A000E8   SB ZERO, 232(A1)
726:                 
727:                    /* DMC */
728:                    case APU_WRE0:
729:                       apu.dmc.regs[0] = value;
9D01FC70  3C08A001   LUI T0, -24575
9D01FC74  2509332C   ADDIU T1, T0, 13100
9D01FC78  A1300100   SB S0, 256(T1)
730:                       apu.dmc.freq = dmc_clocks[value & 0x0F];
9D01FC7C  3204000F   ANDI A0, S0, 15
9D01FC80  00045080   SLL T2, A0, 2
9D01FC84  3C0B9D04   LUI T3, -25340
9D01FC88  256CF4A4   ADDIU T4, T3, -2908
9D01FC8C  014C6821   ADDU T5, T2, T4
9D01FC90  8DAE0000   LW T6, 0(T5)
9D01FC94  AD2E010C   SW T6, 268(T1)
731:                       apu.dmc.looping = (value & 0x40) ? true : false;
9D01FC98  7E0F0180   EXT T7, S0, 6, 1
732:                 
733:                       if (value & 0x80)
9D01FC9C  7C108C20   SEB S1, S0
9D01FCA0  06210005   BGEZ S1, 0x9D01FCB8
9D01FCA4  AD2F0128   SW T7, 296(T1)
734:                       {
735:                          apu.dmc.irq_gen = true;
9D01FCA8  241F0001   ADDIU RA, ZERO, 1
9D01FCAC  3C02A001   LUI V0, -24575
9D01FCB0  0B407F8F   J 0x9D01FE3C
9D01FCB4  AC5F3458   SW RA, 13400(V0)
736:                       }
737:                       else
738:                       {
739:                          apu.dmc.irq_gen = false;
9D01FCB8  3C18A001   LUI T8, -24575
9D01FCBC  2719332C   ADDIU T9, T8, 13100
9D01FCC0  AF20012C   SW ZERO, 300(T9)
740:                          apu.dmc.irq_occurred = false;
9D01FCC4  0B407F8F   J 0x9D01FE3C
9D01FCC8  AF200130   SW ZERO, 304(T9)
741:                       }
742:                       break;
743:                 
744:                    case APU_WRE1: /* 7-bit DAC */
745:                       /* add the _delta_ between written value and
746:                       ** current output level of the volume reg
747:                       */
748:                       value &= 0x7F; /* bit 7 ignored */
9D01FCCC  3219007F   ANDI T9, S0, 127
749:                       apu.dmc.output_vol += ((value - apu.dmc.regs[1]) << 8);
9D01FCD0  3C1FA001   LUI RA, -24575
9D01FCD4  27E2332C   ADDIU V0, RA, 13100
9D01FCD8  90430101   LBU V1, 257(V0)
9D01FCDC  03238023   SUBU S0, T9, V1
9D01FCE0  00102A00   SLL A1, S0, 8
9D01FCE4  8C460110   LW A2, 272(V0)
9D01FCE8  00C53821   ADDU A3, A2, A1
9D01FCEC  AC470110   SW A3, 272(V0)
750:                       apu.dmc.regs[1] = value;
751:                       break;
9D01FCF0  0B407F8F   J 0x9D01FE3C
9D01FCF4  A0590101   SB T9, 257(V0)
752:                 
753:                    case APU_WRE2:
754:                       apu.dmc.regs[2] = value;
9D01FCF8  3C0DA001   LUI T5, -24575
9D01FCFC  25AE332C   ADDIU T6, T5, 13100
9D01FD00  A1D00102   SB S0, 258(T6)
755:                       apu.dmc.cached_addr = 0xC000 + (uint16) (value << 6);
9D01FD04  00107980   SLL T7, S0, 6
9D01FD08  3411C000   ORI S1, ZERO, -16384
9D01FD0C  01F1C021   ADDU T8, T7, S1
756:                       break;
9D01FD10  0B407F8F   J 0x9D01FE3C
9D01FD14  ADD80118   SW T8, 280(T6)
757:                 
758:                    case APU_WRE3:
759:                       apu.dmc.regs[3] = value;
9D01FD18  3C04A001   LUI A0, -24575
9D01FD1C  248A332C   ADDIU T2, A0, 13100
9D01FD20  A1500103   SB S0, 259(T2)
760:                       apu.dmc.cached_dmalength = ((value << 4) + 1) << 3;
9D01FD24  001059C0   SLL T3, S0, 7
9D01FD28  256C0008   ADDIU T4, T3, 8
761:                       break;
9D01FD2C  0B407F8F   J 0x9D01FE3C
9D01FD30  AD4C0120   SW T4, 288(T2)
762:                 
763:                    case APU_SMASK:
764:                       /* bodge for timestamp queue */
765:                       apu.dmc.enabled = (value & 0x10) ? true : false;
9D01FD34  7E0B0100   EXT T3, S0, 4, 1
9D01FD38  3C0CA001   LUI T4, -24575
9D01FD3C  258D332C   ADDIU T5, T4, 13100
9D01FD40  ADAB0104   SW T3, 260(T5)
766:                       apu.enable_reg = value;
767:                 
768:                       for (chan = 0; chan < 2; chan++)
769:                       {
770:                          if (value & (1 << chan))
9D01FD44  320E0001   ANDI T6, S0, 1
9D01FD48  15C00006   BNE T6, ZERO, 0x9D01FD64
9D01FD4C  A1B00134   SB S0, 308(T5)
9D01FD70  7E190040   EXT T9, S0, 1, 1
9D01FD74  13200005   BEQ T9, ZERO, 0x9D01FD8C
9D01FD78  3C02A001   LUI V0, -24575
771:                          {
772:                             apu.rectangle[chan].enabled = true;
9D01FD64  241F0001   ADDIU RA, ZERO, 1
9D01FD68  3C11A001   LUI S1, -24575
9D01FD6C  AE3F3330   SW RA, 13104(S1)
9D01FD7C  24050001   ADDIU A1, ZERO, 1
9D01FD80  3C06A001   LUI A2, -24575
9D01FD84  0B407F66   J 0x9D01FD98
9D01FD88  ACC53380   SW A1, 13184(A2)
773:                          }
774:                          else
775:                          {
776:                             apu.rectangle[chan].enabled = false;
9D01FD50  3C0FA001   LUI T7, -24575
9D01FD54  25F8332C   ADDIU T8, T7, 13100
9D01FD58  AF000004   SW ZERO, 4(T8)
9D01FD8C  2443332C   ADDIU V1, V0, 13100
9D01FD90  AC600054   SW ZERO, 84(V1)
777:                             apu.rectangle[chan].vbl_length = 0;
9D01FD5C  0B407F5C   J 0x9D01FD70
9D01FD60  AF000044   SW ZERO, 68(T8)
9D01FD94  AC600094   SW ZERO, 148(V1)
778:                          }
779:                       }
780:                 
781:                       if (value & 0x04)
9D01FD98  32070004   ANDI A3, S0, 4
9D01FD9C  30E800FF   ANDI T0, A3, 255
9D01FDA0  11000005   BEQ T0, ZERO, 0x9D01FDB8
9D01FDA4  3C09A001   LUI T1, -24575
782:                       {
783:                          apu.triangle.enabled = true;
9D01FDA8  240A0001   ADDIU T2, ZERO, 1
9D01FDAC  3C0CA001   LUI T4, -24575
9D01FDB0  0B407F74   J 0x9D01FDD0
9D01FDB4  AD8A33D0   SW T2, 13264(T4)
784:                       }
785:                       else
786:                       {
787:                          apu.triangle.enabled = false;
9D01FDB8  2524332C   ADDIU A0, T1, 13100
9D01FDBC  AC8000A4   SW ZERO, 164(A0)
788:                          apu.triangle.vbl_length = 0;
9D01FDC0  AC8000C4   SW ZERO, 196(A0)
789:                          apu.triangle.linear_length = 0;
9D01FDC4  AC8000C8   SW ZERO, 200(A0)
790:                          apu.triangle.counter_started = false;
9D01FDC8  AC8000BC   SW ZERO, 188(A0)
791:                          apu.triangle.write_latency = 0;
9D01FDCC  AC8000C0   SW ZERO, 192(A0)
792:                       }
793:                 
794:                       if (value & 0x08)
9D01FDD0  32100008   ANDI S0, S0, 8
9D01FDD4  320D00FF   ANDI T5, S0, 255
9D01FDD8  11A00005   BEQ T5, ZERO, 0x9D01FDF0
9D01FDDC  3C0EA001   LUI T6, -24575
795:                       {
796:                          apu.noise.enabled = true;
9D01FDE0  24180001   ADDIU T8, ZERO, 1
9D01FDE4  3C1FA001   LUI RA, -24575
9D01FDE8  0B407F7F   J 0x9D01FDFC
9D01FDEC  AFF833FC   SW T8, 13308(RA)
797:                       }
798:                       else
799:                       {
800:                          apu.noise.enabled = false;
9D01FDF0  25CF332C   ADDIU T7, T6, 13100
9D01FDF4  ADE000D0   SW ZERO, 208(T7)
801:                          apu.noise.vbl_length = 0;
9D01FDF8  ADE000F8   SW ZERO, 248(T7)
802:                       }
803:                 
804:                       if (value & 0x10)
9D01FDFC  5160000C   BEQL T3, ZERO, 0x9D01FE30
9D01FE00  3C0BA001   LUI T3, -24575
805:                       {
806:                          if (0 == apu.dmc.dma_length)
9D01FE04  3C11A001   LUI S1, -24575
9D01FE08  8E393448   LW T9, 13384(S1)
9D01FE0C  1720000A   BNE T9, ZERO, 0x9D01FE38
9D01FE10  3C07A001   LUI A3, -24575
807:                             apu_dmcreload();
808:                       }
809:                       else
810:                       {
811:                          apu.dmc.dma_length = 0;
9D01FE30  AD603448   SW ZERO, 13384(T3)
812:                       }
813:                 
814:                       apu.dmc.irq_occurred = false;
9D01FE34  3C07A001   LUI A3, -24575
9D01FE38  ACE0345C   SW ZERO, 13404(A3)
815:                       break;
816:                 
817:                       /* unused, but they get hit in some mem-clear loops */
818:                    case 0x4009:
819:                    case 0x400D:
820:                       break;
821:                    
822:                    default:
823:                       break;
824:                    }
825:                 }
9D01FE3C  8FBF001C   LW RA, 28(SP)
9D01FE40  8FB10018   LW S1, 24(SP)
9D01FE44  8FB00014   LW S0, 20(SP)
9D01FE48  27BD0020   ADDIU SP, SP, 32
9D01FE4C  03E00008   JR RA
9D01FE50  00000000   NOP
826:                 
827:                 /* Read from $4000-$4017 */
828:                 uint8 apu_read(uint32 address)
829:                 {
9D01FE54  27BDFFE8   ADDIU SP, SP, -24
9D01FE58  AFBF0014   SW RA, 20(SP)
9D01FE5C  AFB00010   SW S0, 16(SP)
830:                    uint8 value;
831:                 
832:                    switch (address)
9D01FE60  24024015   ADDIU V0, ZERO, 16405
9D01FE64  1482002D   BNE A0, V0, 0x9D01FF1C
9D01FE68  7C903A00   EXT S0, A0, 8, 8
833:                    {
834:                    case APU_SMASK:
835:                       value = 0;
9D01FE84  0010802B   SLTU S0, ZERO, S0
836:                       /* Return 1 in 0-5 bit pos if a channel is playing */
837:                       if (apu.rectangle[0].enabled && apu.rectangle[0].vbl_length)
9D01FE6C  3C03A001   LUI V1, -24575
9D01FE70  8C643330   LW A0, 13104(V1)
9D01FE74  10800004   BEQ A0, ZERO, 0x9D01FE88
9D01FE78  00008021   ADDU S0, ZERO, ZERO
9D01FE7C  3C05A001   LUI A1, -24575
9D01FE80  8CB03370   LW S0, 13168(A1)
838:                          value |= 0x01;
839:                       if (apu.rectangle[1].enabled && apu.rectangle[1].vbl_length)
9D01FE88  3C06A001   LUI A2, -24575
9D01FE8C  8CC73380   LW A3, 13184(A2)
9D01FE90  10E00005   BEQ A3, ZERO, 0x9D01FEA8
9D01FE94  3C0BA001   LUI T3, -24575
9D01FE98  3C08A001   LUI T0, -24575
9D01FE9C  8D0933C0   LW T1, 13248(T0)
840:                          value |= 0x02;
9D01FEA0  360A0002   ORI T2, S0, 2
9D01FEA4  0149800B   MOVN S0, T2, T1
841:                       if (apu.triangle.enabled && apu.triangle.vbl_length)
9D01FEA8  8D6C33D0   LW T4, 13264(T3)
9D01FEAC  11800005   BEQ T4, ZERO, 0x9D01FEC4
9D01FEB0  3C18A001   LUI T8, -24575
9D01FEB4  3C0DA001   LUI T5, -24575
9D01FEB8  8DAE33F0   LW T6, 13296(T5)
842:                          value |= 0x04;
9D01FEBC  360F0004   ORI T7, S0, 4
9D01FEC0  01EE800B   MOVN S0, T7, T6
843:                       if (apu.noise.enabled && apu.noise.vbl_length)
9D01FEC4  8F1933FC   LW T9, 13308(T8)
9D01FEC8  13200005   BEQ T9, ZERO, 0x9D01FEE0
9D01FECC  3C04A001   LUI A0, -24575
9D01FED0  3C1FA001   LUI RA, -24575
9D01FED4  8FE33424   LW V1, 13348(RA)
844:                          value |= 0x08;
9D01FED8  36020008   ORI V0, S0, 8
9D01FEDC  0043800B   MOVN S0, V0, V1
845:                 
846:                       /* bodge for timestamp queue */
847:                       if (apu.dmc.enabled)
9D01FEE0  8C853430   LW A1, 13360(A0)
848:                          value |= 0x10;
9D01FEE4  36060010   ORI A2, S0, 16
9D01FEE8  00C5800B   MOVN S0, A2, A1
849:                 
850:                       if (apu.dmc.irq_occurred)
9D01FEEC  3C07A001   LUI A3, -24575
9D01FEF0  8CE8345C   LW T0, 13404(A3)
851:                          value |= 0x80;
9D01FEF4  36090080   ORI T1, S0, 128
852:                 
853:                       if (apu.irqclear_callback)
9D01FEF8  3C0AA001   LUI T2, -24575
9D01FEFC  8D423490   LW V0, 13456(T2)
9D01FF00  10400006   BEQ V0, ZERO, 0x9D01FF1C
9D01FF04  0128800B   MOVN S0, T1, T0
854:                          value |= apu.irqclear_callback();
9D01FF08  0040F809   JALR V0
9D01FF0C  00000000   NOP
9D01FF10  00508025   OR S0, V0, S0
9D01FF14  0B407FC7   J 0x9D01FF1C
9D01FF18  321000FF   ANDI S0, S0, 255
855:                 
856:                       break;
857:                 
858:                    default:
859:                       value = (address >> 8); /* heavy capacitance on data bus */
860:                       break;
861:                    }
862:                 
863:                    return value;
864:                 }
9D01FF1C  02001021   ADDU V0, S0, ZERO
9D01FF20  8FBF0014   LW RA, 20(SP)
9D01FF24  8FB00010   LW S0, 16(SP)
9D01FF28  03E00008   JR RA
9D01FF2C  27BD0018   ADDIU SP, SP, 24
865:                 
866:                 #define CLIP_OUTPUT16(out) \
867:                 { \
868:                    /*out <<= 1;*/ \
869:                    if (out > 0x7FFF) \
870:                       out = 0x7FFF; \
871:                    else if (out < -0x8000) \
872:                       out = -0x8000; \
873:                 }
874:                 
875:                 void apu_process(void *buffer, int num_samples)
876:                 {
9D01EACC  27BDFFB0   ADDIU SP, SP, -80
9D01EAD0  AFBF004C   SW RA, 76(SP)
9D01EAD4  AFBE0048   SW FP, 72(SP)
9D01EAD8  AFB70044   SW S7, 68(SP)
9D01EADC  AFB60040   SW S6, 64(SP)
9D01EAE0  AFB5003C   SW S5, 60(SP)
9D01EAE4  AFB40038   SW S4, 56(SP)
9D01EAE8  AFB30034   SW S3, 52(SP)
9D01EAEC  AFB20030   SW S2, 48(SP)
9D01EAF0  AFB1002C   SW S1, 44(SP)
9D01EAF4  AFB00028   SW S0, 40(SP)
877:                    static int32 prev_sample = 0;
878:                 
879:                    int16 *buf16;
880:                    uint8 *buf8;
881:                 
882:                    if (NULL != buffer)
9D01EAF8  108002AF   BEQ A0, ZERO, 0x9D01F5B8
9D01EAFC  AFA40050   SW A0, 80(SP)
883:                    {
884:                       /* bleh */
885:                       apu.buffer = buffer;
9D01EB00  3C02A001   LUI V0, -24575
9D01EB04  AC443464   SW A0, 13412(V0)
9D01EB08  00A09821   ADDU S3, A1, ZERO
886:                 
887:                       buf16 = (int16 *) buffer;
888:                       buf8 = (uint8 *) buffer;
9D01EB0C  0080A821   ADDU S5, A0, ZERO
889:                 
890:                       while (num_samples--)
9D01EB18  0B407D64   J 0x9D01F590
9D01EB1C  24140007   ADDIU S4, ZERO, 7
9D01F590  1660FD63   BNE S3, ZERO, 0x9D01EB20
9D01F594  2603332C   ADDIU V1, S0, 13100
9D01F598  0B407D6F   J 0x9D01F5BC
9D01F59C  8FBF004C   LW RA, 76(SP)
891:                       {
892:                          int32 next_sample, accum = 0;
893:                 
894:                          if (apu.mix_enable & 0x01)
9D01EB10  3C10A001   LUI S0, -24575
9D01EB20  90720140   LBU S2, 320(V1)
9D01EB24  32440001   ANDI A0, S2, 1
9D01EB28  1080008C   BEQ A0, ZERO, 0x9D01ED5C
9D01EB2C  00008821   ADDU S1, ZERO, ZERO
895:                             accum += apu_rectangle_0();
896:                          if (apu.mix_enable & 0x02)
9D01ED5C  325F0002   ANDI RA, S2, 2
9D01ED60  33E700FF   ANDI A3, RA, 255
9D01ED64  10E0008F   BEQ A3, ZERO, 0x9D01EFA4
9D01ED68  32580004   ANDI T8, S2, 4
897:                             accum += apu_rectangle_1();
9D01EF9C  02288821   ADDU S1, S1, T0
898:                          if (apu.mix_enable & 0x04)
9D01EFA0  32580004   ANDI T8, S2, 4
9D01EFA4  331900FF   ANDI T9, T8, 255
9D01EFA8  13200059   BEQ T9, ZERO, 0x9D01F110
9D01EFAC  325F0008   ANDI RA, S2, 8
899:                             accum += apu_triangle();
9D01F108  022C8821   ADDU S1, S1, T4
900:                          if (apu.mix_enable & 0x08)
9D01F10C  325F0008   ANDI RA, S2, 8
9D01F110  33E200FF   ANDI V0, RA, 255
9D01F114  1040007F   BEQ V0, ZERO, 0x9D01F314
9D01F118  324C0010   ANDI T4, S2, 16
901:                             accum += apu_noise();
9D01F30C  02398821   ADDU S1, S1, T9
902:                          if (apu.mix_enable & 0x10)
9D01F310  324C0010   ANDI T4, S2, 16
9D01F314  318D00FF   ANDI T5, T4, 255
9D01F318  11A0006B   BEQ T5, ZERO, 0x9D01F4C8
9D01F31C  2617332C   ADDIU S7, S0, 13100
903:                             accum += apu_dmc();
9D01F4C0  02258821   ADDU S1, S1, A1
904:                          if (apu.ext && (apu.mix_enable & 0x20))
9D01F4C4  2617332C   ADDIU S7, S0, 13100
9D01F4C8  8EE90168   LW T1, 360(S7)
9D01F4CC  1120000A   BEQ T1, ZERO, 0x9D01F4F8
9D01F4D0  260A332C   ADDIU T2, S0, 13100
9D01F4D4  914B0140   LBU T3, 320(T2)
9D01F4D8  31620020   ANDI V0, T3, 32
9D01F4DC  304400FF   ANDI A0, V0, 255
9D01F4E0  10800006   BEQ A0, ZERO, 0x9D01F4FC
9D01F4E4  261F332C   ADDIU RA, S0, 13100
905:                             accum += apu.ext->process();
9D01F4E8  8D3E000C   LW FP, 12(T1)
9D01F4EC  03C0F809   JALR FP
9D01F4F0  00000000   NOP
9D01F4F4  02228821   ADDU S1, S1, V0
906:                 
907:                          /* do any filtering */
908:                          if (APU_FILTER_NONE != apu.filter_type)
9D01F4F8  261F332C   ADDIU RA, S0, 13100
9D01F4FC  8FEC0144   LW T4, 324(RA)
9D01F500  1180000E   BEQ T4, ZERO, 0x9D01F53C
9D01F504  2A2F8000   SLTI T7, S1, -32768
909:                          {
910:                             next_sample = accum;
911:                 
912:                             if (APU_FILTER_LOWPASS == apu.filter_type)
9D01F508  15960005   BNE T4, S6, 0x9D01F520
9D01F50C  00116840   SLL T5, S1, 1
913:                             {
914:                                accum += prev_sample;
9D01F510  8F8E80EC   LW T6, -32532(GP)
9D01F514  022E1021   ADDU V0, S1, T6
9D01F518  0B407D4C   J 0x9D01F530
9D01F51C  00022843   SRA A1, V0, 1
915:                                accum >>= 1;
916:                             }
917:                             else
918:                                accum = (accum + accum + accum + prev_sample) >> 2;
9D01F520  01B13021   ADDU A2, T5, S1
9D01F524  8F8780EC   LW A3, -32532(GP)
9D01F528  00C71821   ADDU V1, A2, A3
9D01F52C  00032883   SRA A1, V1, 2
919:                 
920:                             prev_sample = next_sample;
9D01F530  AF9180EC   SW S1, -32532(GP)
9D01F534  00A08821   ADDU S1, A1, ZERO
9D01F538  2A2F8000   SLTI T7, S1, -32768
9D01F53C  24188000   ADDIU T8, ZERO, -32768
9D01F540  030F880B   MOVN S1, T8, T7
9D01F544  34198000   ORI T9, ZERO, -32768
9D01F548  0239402A   SLT T0, S1, T9
9D01F54C  24127FFF   ADDIU S2, ZERO, 32767
921:                          }
922:                 
923:                          /* do clipping */
924:                          CLIP_OUTPUT16(accum);
925:                 
926:                          /* signed 16-bit output, unsigned 8-bit */
927:                          if (16 == apu.sample_bits)
9D01F550  2617332C   ADDIU S7, S0, 13100
9D01F554  8EE90154   LW T1, 340(S7)
9D01F558  240A0010   ADDIU T2, ZERO, 16
9D01F55C  152A0006   BNE T1, T2, 0x9D01F578
9D01F560  0248880A   MOVZ S1, S2, T0
928:                             *buf16++ = (int16) accum;
9D01F564  8FBF0050   LW RA, 80(SP)
9D01F568  A7F10000   SH S1, 0(RA)
9D01F56C  27EC0002   ADDIU T4, RA, 2
9D01F570  0B407D63   J 0x9D01F58C
9D01F574  AFAC0050   SW T4, 80(SP)
929:                          else
930:                             *buf8++ = (accum >> 8) ^ 0x80;
9D01F578  00112203   SRA A0, S1, 8
9D01F57C  240BFF80   ADDIU T3, ZERO, -128
9D01F580  008BF026   XOR FP, A0, T3
9D01F584  A2BE0000   SB FP, 0(S5)
9D01F588  26B50001   ADDIU S5, S5, 1
9D01F58C  2673FFFF   ADDIU S3, S3, -1
931:                       }
932:                    }
933:                 }
9D01F5B8  8FBF004C   LW RA, 76(SP)
9D01F5BC  8FBE0048   LW FP, 72(SP)
9D01F5C0  8FB70044   LW S7, 68(SP)
9D01F5C4  8FB60040   LW S6, 64(SP)
9D01F5C8  8FB5003C   LW S5, 60(SP)
9D01F5CC  8FB40038   LW S4, 56(SP)
9D01F5D0  8FB30034   LW S3, 52(SP)
9D01F5D4  8FB20030   LW S2, 48(SP)
9D01F5D8  8FB1002C   LW S1, 44(SP)
9D01F5DC  8FB00028   LW S0, 40(SP)
9D01F5E0  03E00008   JR RA
9D01F5E4  27BD0050   ADDIU SP, SP, 80
934:                 
935:                 /* set the filter type */
936:                 void apu_setfilter(int filter_type)
937:                 {
938:                    apu.filter_type = filter_type;
9D01FF30  3C02A001   LUI V0, -24575
9D01FF34  03E00008   JR RA
9D01FF38  AC443470   SW A0, 13424(V0)
9D0203F8  24040002   ADDIU A0, ZERO, 2
9D0203FC  3C05A001   LUI A1, -24575
9D020400  ACA43470   SW A0, 13424(A1)
939:                 }
940:                 
941:                 void apu_reset(void)
942:                 {
9D01FF3C  27BDFFE0   ADDIU SP, SP, -32
9D01FF40  AFBF001C   SW RA, 28(SP)
9D01FF44  AFB10018   SW S1, 24(SP)
9D01FF48  AFB00014   SW S0, 20(SP)
943:                    uint32 address;
944:                 
945:                    /* initialize all channel members */
946:                    for (address = 0x4000; address <= 0x4013; address++)
9D01FF4C  24104000   ADDIU S0, ZERO, 16384
9D01FF50  24114014   ADDIU S1, ZERO, 16404
9D01FF60  26100001   ADDIU S0, S0, 1
9D01FFD0  26100009   ADDIU S0, S0, 9
9D01FFD4  1611FFE0   BNE S0, S1, 0x9D01FF58
9D01FFD8  02002021   ADDU A0, S0, ZERO
947:                       apu_write(address, 0);
9D01FF54  02002021   ADDU A0, S0, ZERO
9D01FF58  0F407E2F   JAL apu_write
9D01FF5C  00002821   ADDU A1, ZERO, ZERO
9D01FF64  02002021   ADDU A0, S0, ZERO
9D01FF68  0F407E2F   JAL apu_write
9D01FF6C  00002821   ADDU A1, ZERO, ZERO
9D01FF70  26040001   ADDIU A0, S0, 1
9D01FF74  0F407E2F   JAL apu_write
9D01FF78  00002821   ADDU A1, ZERO, ZERO
9D01FF7C  26040002   ADDIU A0, S0, 2
9D01FF80  0F407E2F   JAL apu_write
9D01FF84  00002821   ADDU A1, ZERO, ZERO
9D01FF88  26040003   ADDIU A0, S0, 3
9D01FF8C  0F407E2F   JAL apu_write
9D01FF90  00002821   ADDU A1, ZERO, ZERO
9D01FF94  26040004   ADDIU A0, S0, 4
9D01FF98  0F407E2F   JAL apu_write
9D01FF9C  00002821   ADDU A1, ZERO, ZERO
9D01FFA0  26040005   ADDIU A0, S0, 5
9D01FFA4  0F407E2F   JAL apu_write
9D01FFA8  00002821   ADDU A1, ZERO, ZERO
9D01FFAC  26040006   ADDIU A0, S0, 6
9D01FFB0  0F407E2F   JAL apu_write
9D01FFB4  00002821   ADDU A1, ZERO, ZERO
9D01FFB8  26040007   ADDIU A0, S0, 7
9D01FFBC  0F407E2F   JAL apu_write
9D01FFC0  00002821   ADDU A1, ZERO, ZERO
9D01FFC4  26040008   ADDIU A0, S0, 8
9D01FFC8  0F407E2F   JAL apu_write
9D01FFCC  00002821   ADDU A1, ZERO, ZERO
948:                 
949:                    apu_write(0x4015, 0);
9D01FFDC  24044015   ADDIU A0, ZERO, 16405
9D01FFE0  0F407E2F   JAL apu_write
9D01FFE4  00002821   ADDU A1, ZERO, ZERO
950:                 
951:                    if (apu.ext && NULL != apu.ext->reset)
9D01FFE8  3C02A001   LUI V0, -24575
9D01FFEC  8C433494   LW V1, 13460(V0)
9D01FFF0  10600007   BEQ V1, ZERO, 0x9D020010
9D01FFF4  8FBF001C   LW RA, 28(SP)
9D01FFF8  8C640008   LW A0, 8(V1)
9D01FFFC  10800005   BEQ A0, ZERO, 0x9D020014
9D020000  8FB10018   LW S1, 24(SP)
952:                       apu.ext->reset();
9D020004  0080F809   JALR A0
9D020008  00000000   NOP
953:                 }
9D02000C  8FBF001C   LW RA, 28(SP)
9D020010  8FB10018   LW S1, 24(SP)
9D020014  8FB00014   LW S0, 20(SP)
9D020018  03E00008   JR RA
9D02001C  27BD0020   ADDIU SP, SP, 32
954:                 
955:                 void apu_build_luts(int num_samples)
956:                 {
9D020020  27BDFFD0   ADDIU SP, SP, -48
9D020024  AFBF002C   SW RA, 44(SP)
9D020028  AFB60028   SW S6, 40(SP)
9D02002C  AFB50024   SW S5, 36(SP)
9D020030  AFB40020   SW S4, 32(SP)
9D020034  AFB3001C   SW S3, 28(SP)
9D020038  AFB20018   SW S2, 24(SP)
9D02003C  AFB10014   SW S1, 20(SP)
9D020040  AFB00010   SW S0, 16(SP)
9D020044  00808021   ADDU S0, A0, ZERO
957:                    int i;
958:                 
959:                    /* lut used for enveloping and frequency sweeps */
960:                    for (i = 0; i < 16; i++)
961:                       decay_lut[i] = num_samples * (i + 1);
9D020048  3C02A001   LUI V0, -24575
9D02004C  AC4432EC   SW A0, 13036(V0)
9D020050  00041840   SLL V1, A0, 1
9D020054  244432EC   ADDIU A0, V0, 13036
9D020058  AC830004   SW V1, 4(A0)
9D02005C  00702821   ADDU A1, V1, S0
9D020060  AC850008   SW A1, 8(A0)
9D020064  00B03021   ADDU A2, A1, S0
9D020068  AC86000C   SW A2, 12(A0)
9D02006C  00D03821   ADDU A3, A2, S0
9D020070  AC870010   SW A3, 16(A0)
9D020074  00F04021   ADDU T0, A3, S0
9D020078  AC880014   SW T0, 20(A0)
9D02007C  01104821   ADDU T1, T0, S0
9D020080  AC890018   SW T1, 24(A0)
9D020084  01305021   ADDU T2, T1, S0
9D020088  AC8A001C   SW T2, 28(A0)
9D02008C  01505821   ADDU T3, T2, S0
9D020090  AC8B0020   SW T3, 32(A0)
9D020094  01706021   ADDU T4, T3, S0
9D020098  AC8C0024   SW T4, 36(A0)
9D02009C  01906821   ADDU T5, T4, S0
9D0200A0  AC8D0028   SW T5, 40(A0)
9D0200A4  01B07021   ADDU T6, T5, S0
9D0200A8  AC8E002C   SW T6, 44(A0)
9D0200AC  01D07821   ADDU T7, T6, S0
9D0200B0  AC8F0030   SW T7, 48(A0)
9D0200B4  01F08821   ADDU S1, T7, S0
9D0200B8  AC910034   SW S1, 52(A0)
9D0200BC  02309021   ADDU S2, S1, S0
9D0200C0  AC920038   SW S2, 56(A0)
9D0200C4  02509821   ADDU S3, S2, S0
9D0200C8  AC93003C   SW S3, 60(A0)
9D0200CC  3C149D04   LUI S4, -25340
9D0200D0  2692F544   ADDIU S2, S4, -2748
9D0200D4  3C15A001   LUI S5, -24575
9D0200D8  26A5326C   ADDIU A1, S5, 12908
9D0200DC  26560020   ADDIU S6, S2, 32
962:                 
963:                    /* used for note length, based on vblanks and size of audio buffer */
964:                    for (i = 0; i < 32; i++)
9D020148  1656FFE5   BNE S2, S6, 0x9D0200E0
9D02014C  24A50020   ADDIU A1, A1, 32
9D020150  3C13A001   LUI S3, -24575
9D020154  2673306C   ADDIU S3, S3, 12396
9D020158  00008821   ADDU S1, ZERO, ZERO
965:                       vbl_lut[i] = vbl_length[i] * num_samples;
9D0200E0  92580000   LBU T8, 0(S2)
9D0200E4  7310C802   MUL T9, T8, S0
9D0200E8  ACB90000   SW T9, 0(A1)
9D0200EC  265F0001   ADDIU RA, S2, 1
9D0200F0  92420001   LBU V0, 1(S2)
9D0200F4  70501802   MUL V1, V0, S0
9D0200F8  ACA30004   SW V1, 4(A1)
9D0200FC  93E40001   LBU A0, 1(RA)
9D020100  70903002   MUL A2, A0, S0
9D020104  ACA60008   SW A2, 8(A1)
9D020108  93E70002   LBU A3, 2(RA)
9D02010C  70F04002   MUL T0, A3, S0
9D020110  ACA8000C   SW T0, 12(A1)
9D020114  93E90003   LBU T1, 3(RA)
9D020118  71305002   MUL T2, T1, S0
9D02011C  ACAA0010   SW T2, 16(A1)
9D020120  93EB0004   LBU T3, 4(RA)
9D020124  71706002   MUL T4, T3, S0
9D020128  ACAC0014   SW T4, 20(A1)
9D02012C  93ED0005   LBU T5, 5(RA)
9D020130  71B07002   MUL T6, T5, S0
9D020134  ACAE0018   SW T6, 24(A1)
9D020138  93EF0006   LBU T7, 6(RA)
9D02013C  71F08802   MUL S1, T7, S0
9D020140  ACB1001C   SW S1, 28(A1)
9D020144  27F20007   ADDIU S2, RA, 7
966:                 
967:                    /* triangle wave channel's linear length table */
968:                    for (i = 0; i < 128; i++)
9D020164  24150080   ADDIU S5, ZERO, 128
9D0201A0  26310001   ADDIU S1, S1, 1
9D0201A4  26740004   ADDIU S4, S3, 4
9D020250  26310003   ADDIU S1, S1, 3
9D020254  1635FFC4   BNE S1, S5, 0x9D020168
9D020258  2693000C   ADDIU S3, S4, 12
969:                       trilength_lut[i] = (int) (0.25 * i * num_samples);
9D02015C  3C149D04   LUI S4, -25340
9D020160  8E92F568   LW S2, -2712(S4)
9D020168  0F4105E3   JAL sitofp
9D02016C  02202021   ADDU A0, S1, ZERO
9D020170  00402021   ADDU A0, V0, ZERO
9D020174  0F40EEB0   JAL __mulsf3
9D020178  02402821   ADDU A1, S2, ZERO
9D02017C  0040B021   ADDU S6, V0, ZERO
9D020180  0F4105E3   JAL sitofp
9D020184  02002021   ADDU A0, S0, ZERO
9D020188  02C02021   ADDU A0, S6, ZERO
9D02018C  0F40EEB0   JAL __mulsf3
9D020190  00402821   ADDU A1, V0, ZERO
9D020194  0F41039C   JAL __fixsfsi
9D020198  00402021   ADDU A0, V0, ZERO
9D02019C  AE620000   SW V0, 0(S3)
9D0201A8  0F4105E3   JAL sitofp
9D0201AC  02202021   ADDU A0, S1, ZERO
9D0201B0  00402021   ADDU A0, V0, ZERO
9D0201B4  0F40EEB0   JAL __mulsf3
9D0201B8  02402821   ADDU A1, S2, ZERO
9D0201BC  0040B021   ADDU S6, V0, ZERO
9D0201C0  0F4105E3   JAL sitofp
9D0201C4  02002021   ADDU A0, S0, ZERO
9D0201C8  02C02021   ADDU A0, S6, ZERO
9D0201CC  0F40EEB0   JAL __mulsf3
9D0201D0  00402821   ADDU A1, V0, ZERO
9D0201D4  0F41039C   JAL __fixsfsi
9D0201D8  00402021   ADDU A0, V0, ZERO
9D0201DC  AE620004   SW V0, 4(S3)
9D0201E0  0F4105E3   JAL sitofp
9D0201E4  26240001   ADDIU A0, S1, 1
9D0201E8  00402021   ADDU A0, V0, ZERO
9D0201EC  0F40EEB0   JAL __mulsf3
9D0201F0  02402821   ADDU A1, S2, ZERO
9D0201F4  00409821   ADDU S3, V0, ZERO
9D0201F8  0F4105E3   JAL sitofp
9D0201FC  02002021   ADDU A0, S0, ZERO
9D020200  02602021   ADDU A0, S3, ZERO
9D020204  0F40EEB0   JAL __mulsf3
9D020208  00402821   ADDU A1, V0, ZERO
9D02020C  0F41039C   JAL __fixsfsi
9D020210  00402021   ADDU A0, V0, ZERO
9D020214  AE820004   SW V0, 4(S4)
9D020218  0F4105E3   JAL sitofp
9D02021C  26240002   ADDIU A0, S1, 2
9D020220  00402021   ADDU A0, V0, ZERO
9D020224  0F40EEB0   JAL __mulsf3
9D020228  02402821   ADDU A1, S2, ZERO
9D02022C  0040B021   ADDU S6, V0, ZERO
9D020230  0F4105E3   JAL sitofp
9D020234  02002021   ADDU A0, S0, ZERO
9D020238  02C02021   ADDU A0, S6, ZERO
9D02023C  0F40EEB0   JAL __mulsf3
9D020240  00402821   ADDU A1, V0, ZERO
9D020244  0F41039C   JAL __fixsfsi
9D020248  00402021   ADDU A0, V0, ZERO
9D02024C  AE820008   SW V0, 8(S4)
970:                 
971:                 #ifndef REALTIME_NOISE
972:                    /* generate noise samples */
973:                    shift_register15(noise_long_lut, APU_NOISE_32K);
974:                    shift_register15(noise_short_lut, APU_NOISE_93);
975:                 #endif /* !REALTIME_NOISE */
976:                 }
9D02025C  8FBF002C   LW RA, 44(SP)
9D020260  8FB60028   LW S6, 40(SP)
9D020264  8FB50024   LW S5, 36(SP)
9D020268  8FB40020   LW S4, 32(SP)
9D02026C  8FB3001C   LW S3, 28(SP)
9D020270  8FB20018   LW S2, 24(SP)
9D020274  8FB10014   LW S1, 20(SP)
9D020278  8FB00010   LW S0, 16(SP)
9D02027C  03E00008   JR RA
9D020280  27BD0030   ADDIU SP, SP, 48
977:                 
978:                 void apu_setparams(double base_freq, int sample_rate, int refresh_rate, int sample_bits)
979:                 {
9D020284  27BDFFE0   ADDIU SP, SP, -32
9D020288  AFBF001C   SW RA, 28(SP)
9D02028C  AFB20018   SW S2, 24(SP)
9D020290  AFB10014   SW S1, 20(SP)
9D020294  AFB00010   SW S0, 16(SP)
9D020298  00809021   ADDU S2, A0, ZERO
9D02029C  00A08021   ADDU S0, A1, ZERO
980:                    apu.sample_rate = sample_rate;
9D0202A0  3C02A001   LUI V0, -24575
9D0202A4  2443332C   ADDIU V1, V0, 13100
9D0202A8  AC650150   SW A1, 336(V1)
981:                    apu.refresh_rate = refresh_rate;
9D0202AC  AC660158   SW A2, 344(V1)
982:                    apu.sample_bits = sample_bits;
9D0202B0  AC670154   SW A3, 340(V1)
983:                    apu.num_samples = sample_rate / refresh_rate;
9D0202B4  00A6001A   DIV A1, A2
9D0202B8  00C001F4   TEQ A2, ZERO
9D0202BC  00008812   MFLO S1
9D0202C0  AC71013C   SW S1, 316(V1)
984:                    if (0 == base_freq)
9D0202C4  0F4101F6   JAL __lesf2
9D0202C8  00002821   ADDU A1, ZERO, ZERO
9D0202CC  54400006   BNEL V0, ZERO, 0x9D0202E8
9D0202D0  3C04A001   LUI A0, -24575
985:                       apu.base_freq = APU_BASEFREQ;
9D0202D4  3C059D04   LUI A1, -25340
9D0202D8  8CA6F56C   LW A2, -2708(A1)
9D0202DC  3C07A001   LUI A3, -24575
9D0202E0  0B4080BB   J 0x9D0202EC
9D0202E4  ACE63474   SW A2, 13428(A3)
986:                    else
987:                       apu.base_freq = base_freq;
9D0202E8  AC923474   SW S2, 13428(A0)
988:                    apu.cycle_rate = (float) (apu.base_freq / sample_rate);
9D0202EC  3C08A001   LUI T0, -24575
9D0202F0  2512332C   ADDIU S2, T0, 13100
9D0202F4  0F4105E3   JAL sitofp
9D0202F8  02002021   ADDU A0, S0, ZERO
9D0202FC  8E440148   LW A0, 328(S2)
9D020300  0F40ED27   JAL __divsf3
9D020304  00402821   ADDU A1, V0, ZERO
9D020308  AE42014C   SW V0, 332(S2)
989:                 
990:                    /* build various lookup tables for apu */
991:                    apu_build_luts(apu.num_samples);
9D02030C  0F408008   JAL apu_build_luts
9D020310  02202021   ADDU A0, S1, ZERO
992:                 
993:                    apu_reset();
9D020314  0F407FCF   JAL apu_reset
9D020318  00000000   NOP
994:                 }
9D02031C  8FBF001C   LW RA, 28(SP)
9D020320  8FB20018   LW S2, 24(SP)
9D020324  8FB10014   LW S1, 20(SP)
9D020328  8FB00010   LW S0, 16(SP)
9D02032C  03E00008   JR RA
9D020330  27BD0020   ADDIU SP, SP, 32
995:                 
996:                 /* Initializes emulated sound hardware, creates waveforms/voices */
997:                 apu_t *apu_create(double base_freq, int sample_rate, int refresh_rate, int sample_bits)
998:                 {
9D020334  27BDFFD8   ADDIU SP, SP, -40
9D020338  AFBF0024   SW RA, 36(SP)
9D02033C  AFB40020   SW S4, 32(SP)
9D020340  AFB3001C   SW S3, 28(SP)
9D020344  AFB20018   SW S2, 24(SP)
9D020348  AFB10014   SW S1, 20(SP)
9D02034C  AFB00010   SW S0, 16(SP)
9D020350  0080A021   ADDU S4, A0, ZERO
9D020354  00A09821   ADDU S3, A1, ZERO
9D020358  00C09021   ADDU S2, A2, ZERO
9D02035C  00E08821   ADDU S1, A3, ZERO
999:                    apu_t *temp_apu;
1000:                   int channel;
1001:                
1002:                   temp_apu = malloc(sizeof(apu_t));
9D020360  0F40F30A   JAL _my_malloc
9D020364  2404016C   ADDIU A0, ZERO, 364
1003:                   if (NULL == temp_apu)
9D020368  1040002A   BEQ V0, ZERO, 0x9D020414
9D02036C  00408021   ADDU S0, V0, ZERO
1004:                      return NULL;
9D020414  00001021   ADDU V0, ZERO, ZERO
1005:                
1006:                   memset(temp_apu, 0, sizeof(apu_t));
9D020370  00402021   ADDU A0, V0, ZERO
9D020374  00002821   ADDU A1, ZERO, ZERO
9D020378  0F4100B4   JAL .Letext0, .LFE0, memset
9D02037C  2406016C   ADDIU A2, ZERO, 364
1007:                
1008:                   /* set the update routine */
1009:                   temp_apu->process = apu_process;
9D020380  3C029D02   LUI V0, -25342
9D020384  2443EACC   ADDIU V1, V0, -5428
9D020388  AE03015C   SW V1, 348(S0)
1010:                   temp_apu->ext = NULL;
1011:                
1012:                   /* clear the callbacks */
1013:                   temp_apu->irq_callback = NULL;
1014:                   temp_apu->irqclear_callback = NULL;
1015:                
1016:                   apu_setcontext(temp_apu);
9D02038C  0F407D7A   JAL apu_setcontext
9D020390  02002021   ADDU A0, S0, ZERO
1017:                
1018:                   apu_setparams(base_freq, sample_rate, refresh_rate, sample_bits);
9D020394  02802021   ADDU A0, S4, ZERO
9D020398  02602821   ADDU A1, S3, ZERO
9D02039C  02403021   ADDU A2, S2, ZERO
9D0203A0  0F4080A1   JAL apu_setparams
9D0203A4  02203821   ADDU A3, S1, ZERO
1019:                
1020:                   for (channel = 0; channel < 6; channel++)
9D0203A8  0000A021   ADDU S4, ZERO, ZERO
9D0203B8  26930001   ADDIU S3, S4, 1
1021:                      apu_setchan(channel, true);
9D0203AC  02802021   ADDU A0, S4, ZERO
9D0203B0  0F407E1D   JAL apu_setchan
9D0203B4  24050001   ADDIU A1, ZERO, 1
9D0203BC  02602021   ADDU A0, S3, ZERO
9D0203C0  0F407E1D   JAL apu_setchan
9D0203C4  24050001   ADDIU A1, ZERO, 1
9D0203C8  26640001   ADDIU A0, S3, 1
9D0203CC  0F407E1D   JAL apu_setchan
9D0203D0  24050001   ADDIU A1, ZERO, 1
9D0203D4  26640002   ADDIU A0, S3, 2
9D0203D8  0F407E1D   JAL apu_setchan
9D0203DC  24050001   ADDIU A1, ZERO, 1
9D0203E0  26640003   ADDIU A0, S3, 3
9D0203E4  0F407E1D   JAL apu_setchan
9D0203E8  24050001   ADDIU A1, ZERO, 1
9D0203EC  26640004   ADDIU A0, S3, 4
9D0203F0  0F407E1D   JAL apu_setchan
9D0203F4  24050001   ADDIU A1, ZERO, 1
1022:                
1023:                   apu_setfilter(APU_FILTER_WEIGHTED);
1024:                
1025:                   apu_getcontext(temp_apu);
9D020404  0F407DCC   JAL apu_getcontext
9D020408  02002021   ADDU A0, S0, ZERO
1026:                
1027:                   return temp_apu;
9D02040C  0B408106   J 0x9D020418
9D020410  02001021   ADDU V0, S0, ZERO
1028:                }
9D020418  8FBF0024   LW RA, 36(SP)
9D02041C  8FB40020   LW S4, 32(SP)
9D020420  8FB3001C   LW S3, 28(SP)
9D020424  8FB20018   LW S2, 24(SP)
9D020428  8FB10014   LW S1, 20(SP)
9D02042C  8FB00010   LW S0, 16(SP)
9D020430  03E00008   JR RA
9D020434  27BD0028   ADDIU SP, SP, 40
1029:                
1030:                void apu_destroy(apu_t **src_apu)
1031:                {
9D020438  27BDFFE8   ADDIU SP, SP, -24
9D02043C  AFBF0014   SW RA, 20(SP)
9D020440  AFB00010   SW S0, 16(SP)
1032:                   if (*src_apu)
9D020444  8C820000   LW V0, 0(A0)
9D020448  1040000C   BEQ V0, ZERO, 0x9D02047C
9D02044C  00808021   ADDU S0, A0, ZERO
1033:                   {
1034:                      if ((*src_apu)->ext && NULL != (*src_apu)->ext->shutdown)
9D020450  8C430168   LW V1, 360(V0)
9D020454  10600006   BEQ V1, ZERO, 0x9D020470
9D020458  00000000   NOP
9D02045C  8C640004   LW A0, 4(V1)
9D020460  10800003   BEQ A0, ZERO, 0x9D020470
9D020464  00000000   NOP
1035:                         (*src_apu)->ext->shutdown();
9D020468  0080F809   JALR A0
9D02046C  00000000   NOP
1036:                      free(*src_apu);
9D020470  0F40F31D   JAL _my_free
9D020474  02002021   ADDU A0, S0, ZERO
1037:                      *src_apu = NULL;
9D020478  AE000000   SW ZERO, 0(S0)
1038:                   }
1039:                }
9D02047C  8FBF0014   LW RA, 20(SP)
9D020480  8FB00010   LW S0, 16(SP)
9D020484  03E00008   JR RA
9D020488  27BD0018   ADDIU SP, SP, 24
1040:                
1041:                void apu_setext(apu_t *src_apu, apuext_t *ext)
1042:                {
9D0204A0  27BDFFE8   ADDIU SP, SP, -24
9D0204A4  AFBF0014   SW RA, 20(SP)
1043:                   ASSERT(src_apu);
1044:                
1045:                   src_apu->ext = ext;
1046:                
1047:                   /* initialize it */
1048:                   if (src_apu->ext && NULL != src_apu->ext->init)
9D02048C  10A0000A   BEQ A1, ZERO, 0x9D0204B8
9D020490  AC850168   SW A1, 360(A0)
9D020494  8CA20000   LW V0, 0(A1)
9D020498  10400007   BEQ V0, ZERO, 0x9D0204B8
9D02049C  00000000   NOP
1049:                      src_apu->ext->init();
9D0204A8  0040F809   JALR V0
9D0204AC  00000000   NOP
1050:                }
9D0204B0  8FBF0014   LW RA, 20(SP)
9D0204B4  27BD0018   ADDIU SP, SP, 24
9D0204B8  03E00008   JR RA
9D0204BC  00000000   NOP
1051:                
1052:                /*
1053:                ** $Log: nes_apu.c,v $
1054:                ** Revision 1.2  2001/04/27 14:37:11  neil
1055:                ** wheeee
1056:                **
1057:                ** Revision 1.1  2001/04/27 12:54:40  neil
1058:                ** blah
1059:                **
1060:                ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
1061:                ** initial
1062:                **
1063:                ** Revision 1.6  2000/12/08 02:36:14  matt
1064:                ** bye bye apu queue (for now)
1065:                **
1066:                ** Revision 1.5  2000/11/27 19:33:53  matt
1067:                ** no special treatment for nsf
1068:                **
1069:                ** Revision 1.4  2000/11/25 20:29:17  matt
1070:                ** weighted filter is now default
1071:                **
1072:                ** Revision 1.3  2000/11/21 13:28:19  matt
1073:                ** take care to zero allocated mem
1074:                **
1075:                ** Revision 1.2  2000/10/28 15:20:59  matt
1076:                ** irq callbacks in nes_apu
1077:                **
1078:                ** Revision 1.1  2000/10/24 12:19:59  matt
1079:                ** changed directory structure
1080:                **
1081:                ** Revision 1.44  2000/10/23 17:53:06  matt
1082:                ** set ptr to NULL after freeing
1083:                **
1084:                ** Revision 1.43  2000/10/17 11:56:42  matt
1085:                ** selectable apu base frequency
1086:                **
1087:                ** Revision 1.42  2000/10/13 12:16:01  matt
1088:                ** macro-ized the stuff that should be removed
1089:                **
1090:                ** Revision 1.41  2000/10/10 13:58:18  matt
1091:                ** stroustrup squeezing his way in the door
1092:                **
1093:                ** Revision 1.40  2000/10/03 11:56:20  matt
1094:                ** better support for optional sound ext routines
1095:                **
1096:                ** Revision 1.39  2000/09/27 12:26:03  matt
1097:                ** changed sound accumulators back to floats
1098:                **
1099:                ** Revision 1.38  2000/09/18 02:12:55  matt
1100:                ** more optimizations
1101:                **
1102:                ** Revision 1.37  2000/09/15 13:38:40  matt
1103:                ** changes for optimized apu core
1104:                **
1105:                ** Revision 1.36  2000/09/15 04:58:07  matt
1106:                ** simplifying and optimizing APU core
1107:                **
1108:                ** Revision 1.35  2000/09/07 21:57:14  matt
1109:                ** api change
1110:                **
1111:                ** Revision 1.34  2000/08/16 05:01:01  matt
1112:                ** small buglet fixed
1113:                **
1114:                ** Revision 1.33  2000/08/15 12:38:04  matt
1115:                ** removed debug output
1116:                **
1117:                ** Revision 1.32  2000/08/15 12:36:51  matt
1118:                ** calling apu_process with buffer=NULL causes silent emulation of APU
1119:                **
1120:                ** Revision 1.31  2000/08/11 02:27:21  matt
1121:                ** general cleanups, plus apu_setparams routine
1122:                **
1123:                ** Revision 1.30  2000/07/31 04:32:52  matt
1124:                ** fragsize problem fixed, perhaps
1125:                **
1126:                ** Revision 1.29  2000/07/30 04:32:59  matt
1127:                ** no more apu_getcyclerate hack
1128:                **
1129:                ** Revision 1.28  2000/07/28 03:15:46  matt
1130:                ** accuracy changes for rectangle frequency sweeps
1131:                **
1132:                ** Revision 1.27  2000/07/27 02:49:50  matt
1133:                ** eccentricity in sweeping hardware now emulated correctly
1134:                **
1135:                ** Revision 1.26  2000/07/25 02:25:14  matt
1136:                ** safer apu_destroy
1137:                **
1138:                ** Revision 1.25  2000/07/23 15:10:54  matt
1139:                ** hacks for win32
1140:                **
1141:                ** Revision 1.24  2000/07/17 01:52:31  matt
1142:                ** made sure last line of all source files is a newline
1143:                **
1144:                ** Revision 1.23  2000/07/10 19:24:55  matt
1145:                ** irqs are not supported in NSF playing mode
1146:                **
1147:                ** Revision 1.22  2000/07/10 13:54:32  matt
1148:                ** using generic nes_irq() now
1149:                **
1150:                ** Revision 1.21  2000/07/10 05:29:34  matt
1151:                ** moved joypad/oam dma from apu to ppu
1152:                **
1153:                ** Revision 1.20  2000/07/09 03:49:31  matt
1154:                ** apu irqs now draw an irq line (bleh)
1155:                **
1156:                ** Revision 1.19  2000/07/04 04:53:26  matt
1157:                ** minor changes, sound amplification
1158:                **
1159:                ** Revision 1.18  2000/07/03 02:18:53  matt
1160:                ** much better external module exporting
1161:                **
1162:                ** Revision 1.17  2000/06/26 11:01:55  matt
1163:                ** made triangle a tad quieter
1164:                **
1165:                ** Revision 1.16  2000/06/26 05:10:33  matt
1166:                ** fixed cycle rate generation accuracy
1167:                **
1168:                ** Revision 1.15  2000/06/26 05:00:37  matt
1169:                ** cleanups
1170:                **
1171:                ** Revision 1.14  2000/06/23 11:06:24  matt
1172:                ** more faithful mixing of channels
1173:                **
1174:                ** Revision 1.13  2000/06/23 03:29:27  matt
1175:                ** cleaned up external sound inteface
1176:                **
1177:                ** Revision 1.12  2000/06/20 00:08:39  matt
1178:                ** bugfix to rectangle wave
1179:                **
1180:                ** Revision 1.11  2000/06/13 13:48:58  matt
1181:                ** fixed triangle write latency for fixed point apu cycle rate
1182:                **
1183:                ** Revision 1.10  2000/06/12 01:14:36  matt
1184:                ** minor change to clipping extents
1185:                **
1186:                ** Revision 1.9  2000/06/09 20:00:56  matt
1187:                ** fixed noise hiccup in NSF player mode
1188:                **
1189:                ** Revision 1.8  2000/06/09 16:49:02  matt
1190:                ** removed all floating point from sound generation
1191:                **
1192:                ** Revision 1.7  2000/06/09 15:12:28  matt
1193:                ** initial revision
1194:                **
1195:                */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/sndhrdw/mmc5_snd.c  ------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** mmc5_snd.c
21:                  **
22:                  ** Nintendo MMC5 sound emulation
23:                  ** $Id: mmc5_snd.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <string.h>
27:                  #include <noftypes.h>
28:                  #include "mmc5_snd.h"
29:                  #include <nes_apu.h>
30:                  
31:                  /* TODO: encapsulate apu/mmc5 rectangle */
32:                  
33:                  #define  APU_OVERSAMPLE
34:                  #define  APU_VOLUME_DECAY(x)  ((x) -= ((x) >> 7))
35:                  
36:                  /* look up table madness */
37:                  static int32 decay_lut[16];
38:                  static int vbl_lut[32];
39:                  
40:                  /* various sound constants for sound emulation */
41:                  /* vblank length table used for rectangles, triangle, noise */
42:                  static const uint8 vbl_length[32] =
43:                  {
44:                     5, 127, 10, 1, 19,  2, 40,  3, 80,  4, 30,  5, 7,  6, 13,  7,
45:                     6,   8, 12, 9, 24, 10, 48, 11, 96, 12, 36, 13, 8, 14, 16, 15
46:                  };
47:                  
48:                  /* ratios of pos/neg pulse for rectangle waves
49:                  ** 2/16 = 12.5%, 4/16 = 25%, 8/16 = 50%, 12/16 = 75% 
50:                  ** (4-bit adder in rectangles, hence the 16)
51:                  */
52:                  static const int duty_lut[4] =
53:                  {
54:                     2, 4, 8, 12
55:                  };
56:                  
57:                  
58:                  #define  MMC5_WRA0    0x5000
59:                  #define  MMC5_WRA1    0x5001
60:                  #define  MMC5_WRA2    0x5002
61:                  #define  MMC5_WRA3    0x5003
62:                  #define  MMC5_WRB0    0x5004
63:                  #define  MMC5_WRB1    0x5005
64:                  #define  MMC5_WRB2    0x5006
65:                  #define  MMC5_WRB3    0x5007
66:                  #define  MMC5_SMASK   0x5015
67:                  
68:                  typedef struct mmc5rectangle_s
69:                  {
70:                     uint8 regs[4];
71:                  
72:                     bool enabled;
73:                     
74:                     float accum;
75:                     int32 freq;
76:                     int32 output_vol;
77:                     bool fixed_envelope;
78:                     bool holdnote;
79:                     uint8 volume;
80:                  
81:                     int32 env_phase;
82:                     int32 env_delay;
83:                     uint8 env_vol;
84:                  
85:                     int vbl_length;
86:                     uint8 adder;
87:                     int duty_flip;
88:                  } mmc5rectangle_t;
89:                  
90:                  typedef struct mmc5dac_s
91:                  {
92:                     int32 output;
93:                     bool enabled;
94:                  } mmc5dac_t;
95:                  
96:                  
97:                  static struct
98:                  {
99:                     float incsize;
100:                    uint8 mul[2];
101:                    mmc5rectangle_t rect[2];
102:                    mmc5dac_t dac;
103:                 } mmc5;
104:                 
105:                 
106:                 #define  MMC5_RECTANGLE_OUTPUT   chan->output_vol
107:                 static int32 mmc5_rectangle(mmc5rectangle_t *chan)
108:                 {
9D032140  27BDFFC8   ADDIU SP, SP, -56
9D032144  AFBF0034   SW RA, 52(SP)
9D032148  AFB70030   SW S7, 48(SP)
9D03214C  AFB6002C   SW S6, 44(SP)
9D032150  AFB50028   SW S5, 40(SP)
9D032154  AFB40024   SW S4, 36(SP)
9D032158  AFB30020   SW S3, 32(SP)
9D03215C  AFB2001C   SW S2, 28(SP)
9D032160  AFB10018   SW S1, 24(SP)
9D032164  AFB00014   SW S0, 20(SP)
9D032168  00808021   ADDU S0, A0, ZERO
109:                    int32 output;
110:                 
111:                 #ifdef APU_OVERSAMPLE
112:                    int num_times;
113:                    int32 total;
114:                 #endif /* APU_OVERSAMPLE */
115:                 
116:                    /* reg0: 0-3=volume, 4=envelope, 5=hold, 6-7=duty cycle
117:                    ** reg1: 0-2=sweep shifts, 3=sweep inc/dec, 4-6=sweep length, 7=sweep on
118:                    ** reg2: 8 bits of freq
119:                    ** reg3: 0-2=high freq, 7-4=vbl length counter
120:                    */
121:                 
122:                    APU_VOLUME_DECAY(chan->output_vol);
9D03216C  8C820010   LW V0, 16(A0)
9D032170  000289C3   SRA S1, V0, 7
9D032174  0051A823   SUBU S5, V0, S1
9D032178  AC950010   SW S5, 16(A0)
123:                 
124:                    if (false == chan->enabled || 0 == chan->vbl_length)
9D03217C  8C840004   LW A0, 4(A0)
9D032180  10800058   BEQ A0, ZERO, 0x9D0322E4
9D032184  02A0C021   ADDU T8, S5, ZERO
9D032188  8E05002C   LW A1, 44(S0)
9D03218C  50A00056   BEQL A1, ZERO, 0x9D0322E8
9D032190  03001021   ADDU V0, T8, ZERO
125:                       return MMC5_RECTANGLE_OUTPUT;
126:                 
127:                    /* vbl length counter */
128:                    if (false == chan->holdnote)
9D032194  8E190018   LW T9, 24(S0)
9D032198  57200004   BNEL T9, ZERO, 0x9D0321AC
9D03219C  8E060020   LW A2, 32(S0)
129:                       chan->vbl_length--;
9D0321A0  24A3FFFF   ADDIU V1, A1, -1
9D0321A4  AE03002C   SW V1, 44(S0)
130:                 
131:                    /* envelope decay at a rate of (env_delay + 1) / 240 secs */
132:                    chan->env_phase -= 4; /* 240/60 */
9D0321A8  8E060020   LW A2, 32(S0)
9D0321AC  24C7FFFC   ADDIU A3, A2, -4
133:                    while (chan->env_phase < 0)
9D0321B0  0B40C87C   J 0x9D0321F0
9D0321B4  AE070020   SW A3, 32(S0)
9D0321F0  8E080020   LW T0, 32(S0)
9D0321F4  0502FFF0   BLTZL T0, 0x9D0321B8
9D0321F8  8E1F0024   LW RA, 36(S0)
134:                    {
135:                       chan->env_phase += chan->env_delay;
9D0321B8  011F1021   ADDU V0, T0, RA
136:                 
137:                       if (chan->holdnote)
9D0321BC  13200006   BEQ T9, ZERO, 0x9D0321D8
9D0321C0  AE020020   SW V0, 32(S0)
138:                          chan->env_vol = (chan->env_vol + 1) & 0x0F;
9D0321C4  92060028   LBU A2, 40(S0)
9D0321C8  24C70001   ADDIU A3, A2, 1
9D0321CC  30E8000F   ANDI T0, A3, 15
9D0321D0  0B40C87C   J 0x9D0321F0
9D0321D4  A2080028   SB T0, 40(S0)
139:                       else if (chan->env_vol < 0x0F)
9D0321D8  92040028   LBU A0, 40(S0)
9D0321DC  2C85000F   SLTIU A1, A0, 15
9D0321E0  50A00004   BEQL A1, ZERO, 0x9D0321F4
9D0321E4  8E080020   LW T0, 32(S0)
140:                          chan->env_vol++;
9D0321E8  24830001   ADDIU V1, A0, 1
9D0321EC  A2030028   SB V1, 40(S0)
141:                    }
142:                 
143:                    if (chan->freq < 4)
9D0321FC  8E16000C   LW S6, 12(S0)
9D032200  2AC90004   SLTI T1, S6, 4
9D032204  15200037   BNE T1, ZERO, 0x9D0322E4
9D032208  02A0C021   ADDU T8, S5, ZERO
144:                       return MMC5_RECTANGLE_OUTPUT;
145:                 
146:                    chan->accum -= mmc5.incsize; /* # of cycles per sample */
9D03220C  8E040008   LW A0, 8(S0)
9D032210  3C0AA001   LUI T2, -24575
9D032214  0F40EA50   JAL __subsf3
9D032218  8D4543E8   LW A1, 17384(T2)
9D03221C  00409021   ADDU S2, V0, ZERO
9D032220  AE020008   SW V0, 8(S0)
147:                    if (chan->accum >= 0)
9D032224  00002021   ADDU A0, ZERO, ZERO
9D032228  0F4101F6   JAL __lesf2
9D03222C  00402821   ADDU A1, V0, ZERO
9D032230  1840002C   BLEZ V0, 0x9D0322E4
9D032234  02A0C021   ADDU T8, S5, ZERO
148:                       return MMC5_RECTANGLE_OUTPUT;
149:                 
150:                 #ifdef APU_OVERSAMPLE
151:                    num_times = total = 0;
152:                 
153:                    if (chan->fixed_envelope)
9D032238  8E0B0014   LW T3, 20(S0)
9D03223C  5160000B   BEQL T3, ZERO, 0x9D03226C
9D032240  92150028   LBU S5, 40(S0)
154:                       output = chan->volume << 8; /* fixed volume */
9D032244  920D001C   LBU T5, 28(S0)
9D032248  000DAA00   SLL S5, T5, 8
155:                    else
156:                       output = (chan->env_vol ^ 0x0F) << 8;
9D03226C  3AAC000F   XORI T4, S5, 15
9D032270  0B40C893   J 0x9D03224C
9D032274  000CAA00   SLL S5, T4, 8
9D032278  92130030   LBU S3, 48(S0)
157:                 #endif
158:                 
159:                    while (chan->accum < 0)
9D03224C  02402021   ADDU A0, S2, ZERO
9D032250  0F4101F6   JAL __lesf2
9D032254  00002821   ADDU A1, ZERO, ZERO
9D032258  00008821   ADDU S1, ZERO, ZERO
9D03225C  0441001D   BGEZ V0, 0x9D0322D4
9D032260  0000A021   ADDU S4, ZERO, ZERO
9D0322B8  00402021   ADDU A0, V0, ZERO
9D0322BC  0F4101F6   JAL __lesf2
9D0322C0  00002821   ADDU A1, ZERO, ZERO
9D0322C4  0440FFEF   BLTZ V0, 0x9D032284
9D0322C8  00000000   NOP
9D0322CC  AE120008   SW S2, 8(S0)
9D0322D0  A2130030   SB S3, 48(S0)
160:                    {
161:                       chan->accum += chan->freq;
9D032284  0F4105E3   JAL sitofp
9D032288  02C02021   ADDU A0, S6, ZERO
9D03228C  02402021   ADDU A0, S2, ZERO
9D032290  0F40EA52   JAL fpadd
9D032294  00402821   ADDU A1, V0, ZERO
9D032298  00409021   ADDU S2, V0, ZERO
162:                       chan->adder = (chan->adder + 1) & 0x0F;
9D03229C  26730001   ADDIU S3, S3, 1
9D0322A0  3273000F   ANDI S3, S3, 15
163:                 
164:                 #ifdef APU_OVERSAMPLE
165:                       if (chan->adder < chan->duty_flip)
9D032264  0B40C89E   J 0x9D032278
9D032268  8E170034   LW S7, 52(S0)
9D03227C  00008821   ADDU S1, ZERO, ZERO
9D032280  0000A021   ADDU S4, ZERO, ZERO
9D0322A4  0277702A   SLT T6, S3, S7
166:                          total += output;
9D0322A8  02357821   ADDU T7, S1, S5
9D0322AC  02358823   SUBU S1, S1, S5
9D0322B0  01EE880B   MOVN S1, T7, T6
167:                       else
168:                          total -= output;
169:                 
170:                       num_times++;
9D0322B4  26940001   ADDIU S4, S4, 1
171:                 #endif
172:                    }
173:                 
174:                 #ifdef APU_OVERSAMPLE
175:                    chan->output_vol = total / num_times;
9D0322D4  0234001A   DIV S1, S4
9D0322D8  028001F4   TEQ S4, ZERO
9D0322DC  0000C012   MFLO T8
9D0322E0  AE180010   SW T8, 16(S0)
176:                 #else
177:                    if (chan->fixed_envelope)
178:                       output = chan->volume << 8; /* fixed volume */
179:                    else
180:                       output = (chan->env_vol ^ 0x0F) << 8;
181:                 
182:                    if (0 == chan->adder)
183:                       chan->output_vol = output;
184:                    else if (chan->adder == chan->duty_flip)
185:                       chan->output_vol = -output;
186:                 #endif
187:                 
188:                    return MMC5_RECTANGLE_OUTPUT;
189:                 }
9D0322E4  03001021   ADDU V0, T8, ZERO
9D0322E8  8FBF0034   LW RA, 52(SP)
9D0322EC  8FB70030   LW S7, 48(SP)
9D0322F0  8FB6002C   LW S6, 44(SP)
9D0322F4  8FB50028   LW S5, 40(SP)
9D0322F8  8FB40024   LW S4, 36(SP)
9D0322FC  8FB30020   LW S3, 32(SP)
9D032300  8FB2001C   LW S2, 28(SP)
9D032304  8FB10018   LW S1, 24(SP)
9D032308  8FB00014   LW S0, 20(SP)
9D03230C  03E00008   JR RA
9D032310  27BD0038   ADDIU SP, SP, 56
190:                 
191:                 static uint8 mmc5_read(uint32 address)
192:                 {
193:                    uint32 retval;
194:                 
195:                    retval = (uint32) (mmc5.mul[0] * mmc5.mul[1]);
9D032314  3C03A001   LUI V1, -24575
9D032318  246243E8   ADDIU V0, V1, 17384
9D03231C  90450004   LBU A1, 4(V0)
9D032320  90460005   LBU A2, 5(V0)
196:                 
197:                    switch (address)
9D032324  24085205   ADDIU T0, ZERO, 20997
9D032328  10880006   BEQ A0, T0, 0x9D032344
9D03232C  70A63802   MUL A3, A1, A2
198:                    {
199:                    case 0x5205:
200:                       return (uint8) retval;
201:                 
202:                    case 0x5206:
203:                       return (uint8) (retval >> 8);
204:                 
205:                    default:
206:                       return 0xFF;
9D032330  00071202   SRL V0, A3, 8
9D032334  38845206   XORI A0, A0, 20998
9D032338  240900FF   ADDIU T1, ZERO, 255
9D03233C  03E00008   JR RA
9D032340  0124100B   MOVN V0, T1, A0
207:                    }
208:                 }
9D032344  03E00008   JR RA
9D032348  30E200FF   ANDI V0, A3, 255
209:                 
210:                 /* mix vrcvi sound channels together */
211:                 static int32 mmc5_process(void)
212:                 {
9D03234C  27BDFFE8   ADDIU SP, SP, -24
9D032350  AFBF0014   SW RA, 20(SP)
9D032354  AFB00010   SW S0, 16(SP)
213:                    int32 accum;
214:                 
215:                    accum = mmc5_rectangle(&mmc5.rect[0]);
9D032358  3C04A001   LUI A0, -24575
9D03235C  0F40C850   JAL .LFB5, mmc5_rectangle, .Ltext0, .Letext0, .LFE1
9D032360  248443F0   ADDIU A0, A0, 17392
9D032364  00408021   ADDU S0, V0, ZERO
216:                    accum += mmc5_rectangle(&mmc5.rect[1]);
9D032368  3C02A001   LUI V0, -24575
9D03236C  0F40C850   JAL .LFB5, mmc5_rectangle, .Ltext0, .Letext0, .LFE1
9D032370  24444428   ADDIU A0, V0, 17448
217:                    if (mmc5.dac.enabled)
9D032374  3C03A001   LUI V1, -24575
9D032378  8C654464   LW A1, 17508(V1)
9D03237C  10A00004   BEQ A1, ZERO, 0x9D032390
9D032380  00501021   ADDU V0, V0, S0
218:                       accum += mmc5.dac.output;
9D032384  3C06A001   LUI A2, -24575
9D032388  8CC74460   LW A3, 17504(A2)
9D03238C  00471021   ADDU V0, V0, A3
219:                 
220:                    return accum;
221:                 }
9D032390  8FBF0014   LW RA, 20(SP)
9D032394  8FB00010   LW S0, 16(SP)
9D032398  03E00008   JR RA
9D03239C  27BD0018   ADDIU SP, SP, 24
222:                 
223:                 /* write to registers */
224:                 static void mmc5_write(uint32 address, uint8 value)
225:                 {
226:                    int chan;
227:                 
228:                    switch (address)
9D0323A0  24025007   ADDIU V0, ZERO, 20487
9D0323A4  1082005B   BEQ A0, V0, 0x9D032514
9D0323A8  2C835008   SLTIU V1, A0, 20488
9D0323AC  10600013   BEQ V1, ZERO, 0x9D0323FC
9D0323B0  24095015   ADDIU T1, ZERO, 20501
9D0323B4  24065003   ADDIU A2, ZERO, 20483
9D0323B8  10860056   BEQ A0, A2, 0x9D032514
9D0323BC  2C875004   SLTIU A3, A0, 20484
9D0323C0  10E00007   BEQ A3, ZERO, 0x9D0323E0
9D0323C4  24085000   ADDIU T0, ZERO, 20480
9D0323C8  1088001D   BEQ A0, T0, 0x9D032440
9D0323CC  24095002   ADDIU T1, ZERO, 20482
9D0323D0  1089003C   BEQ A0, T1, 0x9D0324C4
9D0323D4  7C840080   EXT A0, A0, 2, 1
9D0323D8  03E00008   JR RA
9D0323DC  00000000   NOP
9D0323E0  240A5004   ADDIU T2, ZERO, 20484
9D0323E4  108A0016   BEQ A0, T2, 0x9D032440
9D0323E8  240B5006   ADDIU T3, ZERO, 20486
9D0323EC  108B0035   BEQ A0, T3, 0x9D0324C4
9D0323F0  7C840080   EXT A0, A0, 2, 1
9D0323F4  03E00008   JR RA
9D0323F8  00000000   NOP
9D0323FC  1089006A   BEQ A0, T1, 0x9D0325A8
9D032400  2C8A5016   SLTIU T2, A0, 20502
9D032404  11400007   BEQ T2, ZERO, 0x9D032424
9D032408  240B5010   ADDIU T3, ZERO, 20496
9D03240C  108B007C   BEQ A0, T3, 0x9D032600
9D032410  240C5011   ADDIU T4, ZERO, 20497
9D032414  108C0083   BEQ A0, T4, 0x9D032624
9D032418  38A40080   XORI A0, A1, 128
9D03241C  03E00008   JR RA
9D032420  00000000   NOP
9D032424  24035205   ADDIU V1, ZERO, 20997
9D032428  10830082   BEQ A0, V1, 0x9D032634
9D03242C  24025206   ADDIU V0, ZERO, 20998
9D032430  10820083   BEQ A0, V0, 0x9D032640
9D032434  3C06A001   LUI A2, -24575
9D032438  03E00008   JR RA
9D03243C  00000000   NOP
229:                    {
230:                    /* rectangles */
231:                    case MMC5_WRA0:
232:                    case MMC5_WRB0:
233:                       chan = (address & 4) ? 1 : 0;
9D032440  7C8D0080   EXT T5, A0, 2, 1
234:                       mmc5.rect[chan].regs[0] = value;
9D032444  000D70C0   SLL T6, T5, 3
9D032448  000D7980   SLL T7, T5, 6
9D03244C  01EEC023   SUBU T8, T7, T6
9D032450  3C19A001   LUI T9, -24575
9D032454  272343E8   ADDIU V1, T9, 17384
9D032458  03031021   ADDU V0, T8, V1
9D03245C  A0450008   SB A1, 8(V0)
235:                 
236:                       mmc5.rect[chan].volume = value & 0x0F;
9D032460  30A6000F   ANDI A2, A1, 15
9D032464  A0460024   SB A2, 36(V0)
237:                       mmc5.rect[chan].env_delay = decay_lut[value & 0x0F];
9D032468  00064080   SLL T0, A2, 2
9D03246C  3C07A001   LUI A3, -24575
9D032470  24E944E8   ADDIU T1, A3, 17640
9D032474  01095021   ADDU T2, T0, T1
9D032478  8D4B0000   LW T3, 0(T2)
9D03247C  AC4B002C   SW T3, 44(V0)
238:                       mmc5.rect[chan].holdnote = (value & 0x20) ? true : false;
9D032480  7CA40140   EXT A0, A1, 5, 1
9D032484  AC440020   SW A0, 32(V0)
239:                       mmc5.rect[chan].fixed_envelope = (value & 0x10) ? true : false;
9D032488  7CAC0100   EXT T4, A1, 4, 1
9D03248C  AC4C001C   SW T4, 28(V0)
240:                       mmc5.rect[chan].duty_flip = duty_lut[value >> 6];
9D032490  25AD0001   ADDIU T5, T5, 1
9D032494  000D70C0   SLL T6, T5, 3
9D032498  000D7980   SLL T7, T5, 6
9D03249C  01EEC023   SUBU T8, T7, T6
9D0324A0  0078C821   ADDU T9, V1, T8
9D0324A4  00052982   SRL A1, A1, 6
9D0324A8  00051880   SLL V1, A1, 2
9D0324AC  3C029D04   LUI V0, -25340
9D0324B0  24462190   ADDIU A2, V0, 8592
9D0324B4  00664021   ADDU T0, V1, A2
9D0324B8  8D070000   LW A3, 0(T0)
241:                       break;
9D0324BC  03E00008   JR RA
9D0324C0  AF270004   SW A3, 4(T9)
242:                 
243:                    case MMC5_WRA1:
244:                    case MMC5_WRB1:
245:                       break;
246:                 
247:                    case MMC5_WRA2:
248:                    case MMC5_WRB2:
249:                       chan = (address & 4) ? 1 : 0;
250:                       mmc5.rect[chan].regs[2] = value;
9D0324C4  000460C0   SLL T4, A0, 3
9D0324C8  00046980   SLL T5, A0, 6
9D0324CC  01AC7023   SUBU T6, T5, T4
9D0324D0  3C0FA001   LUI T7, -24575
9D0324D4  25F843E8   ADDIU T8, T7, 17384
9D0324D8  01D8C821   ADDU T9, T6, T8
9D0324DC  A325000A   SB A1, 10(T9)
251:                       if (mmc5.rect[chan].enabled)
9D0324E0  8F22000C   LW V0, 12(T9)
9D0324E4  1040FFBC   BEQ V0, ZERO, 0x9D0323D8
9D0324E8  000418C0   SLL V1, A0, 3
252:                          mmc5.rect[chan].freq = (((mmc5.rect[chan].regs[3] & 7) << 8) + value) + 1;
9D0324EC  00043180   SLL A2, A0, 6
9D0324F0  00C33823   SUBU A3, A2, V1
9D0324F4  03074821   ADDU T1, T8, A3
9D0324F8  912A000B   LBU T2, 11(T1)
9D0324FC  314B0007   ANDI T3, T2, 7
9D032500  000B2200   SLL A0, T3, 8
9D032504  00852821   ADDU A1, A0, A1
9D032508  24AC0001   ADDIU T4, A1, 1
9D03250C  03E00008   JR RA
9D032510  AD2C0014   SW T4, 20(T1)
253:                       break;
254:                 
255:                    case MMC5_WRA3:
256:                    case MMC5_WRB3:
257:                       chan = (address & 4) ? 1 : 0;
9D032514  7C880080   EXT T0, A0, 2, 1
258:                       mmc5.rect[chan].regs[3] = value;
9D032518  000810C0   SLL V0, T0, 3
9D03251C  00081980   SLL V1, T0, 6
9D032520  00623023   SUBU A2, V1, V0
9D032524  3C07A001   LUI A3, -24575
9D032528  24E943E8   ADDIU T1, A3, 17384
9D03252C  00C95021   ADDU T2, A2, T1
9D032530  A145000B   SB A1, 11(T2)
259:                 
260:                       if (mmc5.rect[chan].enabled)
9D032534  8D4B000C   LW T3, 12(T2)
9D032538  1160FFA7   BEQ T3, ZERO, 0x9D0323D8
9D03253C  3C0CA001   LUI T4, -24575
261:                       {
262:                          mmc5.rect[chan].vbl_length = vbl_lut[value >> 3];
9D032540  258D43E8   ADDIU T5, T4, 17384
9D032544  000820C0   SLL A0, T0, 3
9D032548  00087180   SLL T6, T0, 6
9D03254C  01C47823   SUBU T7, T6, A0
9D032550  01AFC021   ADDU T8, T5, T7
9D032554  0005C8C2   SRL T9, A1, 3
9D032558  00191080   SLL V0, T9, 2
9D03255C  3C03A001   LUI V1, -24575
9D032560  24664468   ADDIU A2, V1, 17512
9D032564  00463821   ADDU A3, V0, A2
9D032568  8CE90000   LW T1, 0(A3)
9D03256C  AF090034   SW T1, 52(T8)
263:                          mmc5.rect[chan].env_vol = 0;
9D032570  A3000030   SB ZERO, 48(T8)
264:                          mmc5.rect[chan].freq = (((value & 7) << 8) + mmc5.rect[chan].regs[2]) + 1;
9D032574  30A50007   ANDI A1, A1, 7
9D032578  00055200   SLL T2, A1, 8
9D03257C  930B000A   LBU T3, 10(T8)
9D032580  014B6021   ADDU T4, T2, T3
9D032584  25840001   ADDIU A0, T4, 1
9D032588  AF040014   SW A0, 20(T8)
265:                          mmc5.rect[chan].adder = 0;
9D03258C  25080001   ADDIU T0, T0, 1
9D032590  000870C0   SLL T6, T0, 3
9D032594  00087980   SLL T7, T0, 6
9D032598  01EEC023   SUBU T8, T7, T6
9D03259C  030D6821   ADDU T5, T8, T5
9D0325A0  03E00008   JR RA
9D0325A4  A1A00000   SB ZERO, 0(T5)
266:                       }
267:                       break;
268:                    
269:                    case MMC5_SMASK:
270:                       if (value & 0x01)
9D0325A8  30A70001   ANDI A3, A1, 1
9D0325AC  10E00005   BEQ A3, ZERO, 0x9D0325C4
9D0325B0  3C09A001   LUI T1, -24575
271:                       {
272:                          mmc5.rect[0].enabled = true;
9D0325B4  240B0001   ADDIU T3, ZERO, 1
9D0325B8  3C0CA001   LUI T4, -24575
9D0325BC  0B40C974   J 0x9D0325D0
9D0325C0  AD8B43F4   SW T3, 17396(T4)
273:                       }
274:                       else
275:                       {
276:                          mmc5.rect[0].enabled = false;
9D0325C4  252A43E8   ADDIU T2, T1, 17384
9D0325C8  AD40000C   SW ZERO, 12(T2)
277:                          mmc5.rect[0].vbl_length = 0;
9D0325CC  AD400034   SW ZERO, 52(T2)
278:                       }
279:                 
280:                       if (value & 0x02)
9D0325D0  30A40002   ANDI A0, A1, 2
9D0325D4  308D00FF   ANDI T5, A0, 255
9D0325D8  11A00005   BEQ T5, ZERO, 0x9D0325F0
9D0325DC  3C0EA001   LUI T6, -24575
281:                       {
282:                          mmc5.rect[1].enabled = true;
9D0325E0  24180001   ADDIU T8, ZERO, 1
9D0325E4  3C19A001   LUI T9, -24575
9D0325E8  03E00008   JR RA
9D0325EC  AF38442C   SW T8, 17452(T9)
283:                       }
284:                       else
285:                       {
286:                          mmc5.rect[1].enabled = false;
9D0325F0  25CF43E8   ADDIU T7, T6, 17384
9D0325F4  ADE00044   SW ZERO, 68(T7)
287:                          mmc5.rect[1].vbl_length = 0;
9D0325F8  03E00008   JR RA
9D0325FC  ADE0006C   SW ZERO, 108(T7)
288:                       }
289:                 
290:                       break;
291:                 
292:                    case 0x5010:
293:                       if (value & 0x01)
9D032600  30AF0001   ANDI T7, A1, 1
9D032604  11E00005   BEQ T7, ZERO, 0x9D03261C
9D032608  3C18A001   LUI T8, -24575
294:                          mmc5.dac.enabled = true;
9D03260C  24190001   ADDIU T9, ZERO, 1
9D032610  3C05A001   LUI A1, -24575
9D032614  03E00008   JR RA
9D032618  ACB94464   SW T9, 17508(A1)
295:                       else
296:                          mmc5.dac.enabled = false;
9D03261C  03E00008   JR RA
9D032620  AF004464   SW ZERO, 17508(T8)
297:                       break;
298:                 
299:                    case 0x5011:
300:                       mmc5.dac.output = (value ^ 0x80) << 8;
9D032624  00046A00   SLL T5, A0, 8
9D032628  3C0EA001   LUI T6, -24575
301:                       break;
9D03262C  03E00008   JR RA
9D032630  ADCD4460   SW T5, 17504(T6)
302:                 
303:                    case 0x5205:
304:                       mmc5.mul[0] = value;
9D032634  3C08A001   LUI T0, -24575
305:                       break;
9D032638  03E00008   JR RA
9D03263C  A10543EC   SB A1, 17388(T0)
306:                 
307:                    case 0x5206:
308:                       mmc5.mul[1] = value;
9D032640  A0C543ED   SB A1, 17389(A2)
9D032644  03E00008   JR RA
9D032648  00000000   NOP
309:                       break;
310:                 
311:                    case 0x5114:
312:                    case 0x5115:
313:                       /* ???? */
314:                       break;
315:                    
316:                    default:
317:                       break;
318:                    }
319:                 }
320:                 
321:                 /* reset state of vrcvi sound channels */
322:                 static void mmc5_reset(void)
323:                 {
9D03264C  27BDFE78   ADDIU SP, SP, -392
9D032650  AFBF0184   SW RA, 388(SP)
9D032654  AFB00180   SW S0, 384(SP)
324:                    int i;
325:                    apu_t apu;
326:                 
327:                 
328:                    /* get the phase period from the apu */
329:                    apu_getcontext(&apu);
9D032658  0F407DCC   JAL apu_getcontext
9D03265C  27A40010   ADDIU A0, SP, 16
330:                    mmc5.incsize = apu.cycle_rate;
9D032660  8FA3015C   LW V1, 348(SP)
9D032664  3C02A001   LUI V0, -24575
9D032668  AC4343E8   SW V1, 17384(V0)
331:                 
332:                    for (i = 0x5000; i < 0x5008; i++)
9D03266C  24105000   ADDIU S0, ZERO, 20480
9D03267C  26100001   ADDIU S0, S0, 1
333:                       mmc5_write(i, 0);
9D032670  02002021   ADDU A0, S0, ZERO
9D032674  0F40C8E8   JAL .LFB8, mmc5_write, .LFE7
9D032678  00002821   ADDU A1, ZERO, ZERO
9D032680  02002021   ADDU A0, S0, ZERO
9D032684  0F40C8E8   JAL .LFB8, mmc5_write, .LFE7
9D032688  00002821   ADDU A1, ZERO, ZERO
9D03268C  26040001   ADDIU A0, S0, 1
9D032690  0F40C8E8   JAL .LFB8, mmc5_write, .LFE7
9D032694  00002821   ADDU A1, ZERO, ZERO
9D032698  26040002   ADDIU A0, S0, 2
9D03269C  0F40C8E8   JAL .LFB8, mmc5_write, .LFE7
9D0326A0  00002821   ADDU A1, ZERO, ZERO
9D0326A4  26040003   ADDIU A0, S0, 3
9D0326A8  0F40C8E8   JAL .LFB8, mmc5_write, .LFE7
9D0326AC  00002821   ADDU A1, ZERO, ZERO
9D0326B0  26040004   ADDIU A0, S0, 4
9D0326B4  0F40C8E8   JAL .LFB8, mmc5_write, .LFE7
9D0326B8  00002821   ADDU A1, ZERO, ZERO
9D0326BC  26040005   ADDIU A0, S0, 5
9D0326C0  0F40C8E8   JAL .LFB8, mmc5_write, .LFE7
9D0326C4  00002821   ADDU A1, ZERO, ZERO
9D0326C8  26040006   ADDIU A0, S0, 6
9D0326CC  0F40C8E8   JAL .LFB8, mmc5_write, .LFE7
9D0326D0  00002821   ADDU A1, ZERO, ZERO
334:                 
335:                    mmc5_write(0x5010, 0);
9D0326D4  24045010   ADDIU A0, ZERO, 20496
9D0326D8  0F40C8E8   JAL .LFB8, mmc5_write, .LFE7
9D0326DC  00002821   ADDU A1, ZERO, ZERO
336:                    mmc5_write(0x5011, 0);
9D0326E0  24045011   ADDIU A0, ZERO, 20497
9D0326E4  0F40C8E8   JAL .LFB8, mmc5_write, .LFE7
9D0326E8  00002821   ADDU A1, ZERO, ZERO
337:                 }
9D0326EC  8FBF0184   LW RA, 388(SP)
9D0326F0  8FB00180   LW S0, 384(SP)
9D0326F4  03E00008   JR RA
9D0326F8  27BD0188   ADDIU SP, SP, 392
338:                 
339:                 static int mmc5_init(void)
340:                 {
9D0326FC  27BDFE78   ADDIU SP, SP, -392
9D032700  AFBF0184   SW RA, 388(SP)
341:                    int i, num_samples;
342:                    apu_t apu;
343:                 
344:                    apu_getcontext(&apu);
9D032704  0F407DCC   JAL apu_getcontext
9D032708  27A40010   ADDIU A0, SP, 16
345:                    num_samples = apu.num_samples;
9D03270C  8FA2014C   LW V0, 332(SP)
346:                 
347:                    /* lut used for enveloping and frequency sweeps */
348:                    for (i = 0; i < 16; i++)
349:                       decay_lut[i] = num_samples * (i + 1);
9D032710  3C03A001   LUI V1, -24575
9D032714  AC6244E8   SW V0, 17640(V1)
9D032718  00022040   SLL A0, V0, 1
9D03271C  246544E8   ADDIU A1, V1, 17640
9D032720  ACA40004   SW A0, 4(A1)
9D032724  00823021   ADDU A2, A0, V0
9D032728  ACA60008   SW A2, 8(A1)
9D03272C  00C23821   ADDU A3, A2, V0
9D032730  ACA7000C   SW A3, 12(A1)
9D032734  00E24021   ADDU T0, A3, V0
9D032738  ACA80010   SW T0, 16(A1)
9D03273C  01024821   ADDU T1, T0, V0
9D032740  ACA90014   SW T1, 20(A1)
9D032744  01225021   ADDU T2, T1, V0
9D032748  ACAA0018   SW T2, 24(A1)
9D03274C  01425821   ADDU T3, T2, V0
9D032750  ACAB001C   SW T3, 28(A1)
9D032754  01626021   ADDU T4, T3, V0
9D032758  ACAC0020   SW T4, 32(A1)
9D03275C  01826821   ADDU T5, T4, V0
9D032760  ACAD0024   SW T5, 36(A1)
9D032764  01A27021   ADDU T6, T5, V0
9D032768  ACAE0028   SW T6, 40(A1)
9D03276C  01C27821   ADDU T7, T6, V0
9D032770  ACAF002C   SW T7, 44(A1)
9D032774  01E2C021   ADDU T8, T7, V0
9D032778  ACB80030   SW T8, 48(A1)
9D03277C  0302C821   ADDU T9, T8, V0
9D032780  ACB90034   SW T9, 52(A1)
9D032784  03221821   ADDU V1, T9, V0
9D032788  ACA30038   SW V1, 56(A1)
9D03278C  00622021   ADDU A0, V1, V0
9D032790  ACA4003C   SW A0, 60(A1)
9D032794  3C059D04   LUI A1, -25340
9D032798  24AB21A0   ADDIU T3, A1, 8608
9D03279C  3C06A001   LUI A2, -24575
9D0327A0  24C64468   ADDIU A2, A2, 17512
9D0327A4  25670020   ADDIU A3, T3, 32
350:                 
351:                    /* used for note length, based on vblanks and size of audio buffer */
352:                    for (i = 0; i < 32; i++)
9D032810  1567FFE5   BNE T3, A3, 0x9D0327A8
9D032814  24C60020   ADDIU A2, A2, 32
353:                       vbl_lut[i] = vbl_length[i] * num_samples;
9D0327A8  917F0000   LBU RA, 0(T3)
9D0327AC  73E24002   MUL T0, RA, V0
9D0327B0  ACC80000   SW T0, 0(A2)
9D0327B4  25690001   ADDIU T1, T3, 1
9D0327B8  916A0001   LBU T2, 1(T3)
9D0327BC  71425802   MUL T3, T2, V0
9D0327C0  ACCB0004   SW T3, 4(A2)
9D0327C4  912C0001   LBU T4, 1(T1)
9D0327C8  71826802   MUL T5, T4, V0
9D0327CC  ACCD0008   SW T5, 8(A2)
9D0327D0  912E0002   LBU T6, 2(T1)
9D0327D4  71C27802   MUL T7, T6, V0
9D0327D8  ACCF000C   SW T7, 12(A2)
9D0327DC  91380003   LBU T8, 3(T1)
9D0327E0  7302C802   MUL T9, T8, V0
9D0327E4  ACD90010   SW T9, 16(A2)
9D0327E8  91230004   LBU V1, 4(T1)
9D0327EC  70622002   MUL A0, V1, V0
9D0327F0  ACC40014   SW A0, 20(A2)
9D0327F4  91250005   LBU A1, 5(T1)
9D0327F8  70A2F802   MUL RA, A1, V0
9D0327FC  ACDF0018   SW RA, 24(A2)
9D032800  91280006   LBU T0, 6(T1)
9D032804  71025002   MUL T2, T0, V0
9D032808  ACCA001C   SW T2, 28(A2)
9D03280C  252B0007   ADDIU T3, T1, 7
354:                 
355:                    return 0;
356:                 }
9D032818  00001021   ADDU V0, ZERO, ZERO
9D03281C  8FBF0184   LW RA, 388(SP)
9D032820  03E00008   JR RA
9D032824  27BD0188   ADDIU SP, SP, 392
357:                 
358:                 static apu_memread mmc5_memread[] =
359:                 {
360:                    { 0x5205, 0x5206, mmc5_read },
361:                    {     -1,     -1, NULL }
362:                 };
363:                 
364:                 static apu_memwrite mmc5_memwrite[] =
365:                 {
366:                    { 0x5000, 0x5015, mmc5_write },
367:                    { 0x5114, 0x5115, mmc5_write },
368:                    { 0x5205, 0x5206, mmc5_write },
369:                    {     -1,     -1, NULL }
370:                 };
371:                 
372:                 apuext_t mmc5_ext =
373:                 {
374:                    mmc5_init,
375:                    NULL, /* no shutdown */
376:                    mmc5_reset,
377:                    mmc5_process,
378:                    mmc5_memread,
379:                    mmc5_memwrite
380:                 };
381:                 
382:                 /*
383:                 ** $Log: mmc5_snd.c,v $
384:                 ** Revision 1.2  2001/04/27 14:37:11  neil
385:                 ** wheeee
386:                 **
387:                 ** Revision 1.1  2001/04/27 12:54:40  neil
388:                 ** blah
389:                 **
390:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
391:                 ** initial
392:                 **
393:                 ** Revision 1.2  2000/11/13 00:57:08  matt
394:                 ** doesn't look as nasty now
395:                 **
396:                 ** Revision 1.1  2000/10/24 12:19:59  matt
397:                 ** changed directory structure
398:                 **
399:                 ** Revision 1.16  2000/10/17 11:56:42  matt
400:                 ** selectable apu base frequency
401:                 **
402:                 ** Revision 1.15  2000/10/10 14:04:29  matt
403:                 ** make way for bjarne
404:                 **
405:                 ** Revision 1.14  2000/10/10 13:58:18  matt
406:                 ** stroustrup squeezing his way in the door
407:                 **
408:                 ** Revision 1.13  2000/10/08 17:50:18  matt
409:                 ** appears $5114/$5115 do something
410:                 **
411:                 ** Revision 1.12  2000/10/03 11:56:20  matt
412:                 ** better support for optional sound ext routines
413:                 **
414:                 ** Revision 1.11  2000/09/27 12:26:03  matt
415:                 ** changed sound accumulators back to floats
416:                 **
417:                 ** Revision 1.10  2000/09/15 13:38:40  matt
418:                 ** changes for optimized apu core
419:                 **
420:                 ** Revision 1.9  2000/09/15 04:58:07  matt
421:                 ** simplifying and optimizing APU core
422:                 **
423:                 ** Revision 1.8  2000/07/30 04:32:59  matt
424:                 ** no more apu_getcyclerate hack
425:                 **
426:                 ** Revision 1.7  2000/07/17 01:52:31  matt
427:                 ** made sure last line of all source files is a newline
428:                 **
429:                 ** Revision 1.6  2000/07/04 04:51:41  matt
430:                 ** cleanups
431:                 **
432:                 ** Revision 1.5  2000/07/03 02:18:53  matt
433:                 ** much better external module exporting
434:                 **
435:                 ** Revision 1.4  2000/06/28 22:03:51  matt
436:                 ** fixed stupid oversight
437:                 **
438:                 ** Revision 1.3  2000/06/20 20:46:58  matt
439:                 ** minor cleanups
440:                 **
441:                 ** Revision 1.2  2000/06/20 04:06:16  matt
442:                 ** migrated external sound definition to apu module
443:                 **
444:                 ** Revision 1.1  2000/06/20 00:06:47  matt
445:                 ** initial revision
446:                 **
447:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/sndhrdw/fds_snd.c  -------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** fds_snd.c
21:                  **
22:                  ** Famicom Disk System sound emulation
23:                  ** $Id: fds_snd.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_apu.h>
28:                  #include <fds_snd.h>
29:                  
30:                  static int32 fds_incsize = 0;
31:                  
32:                  /* mix sound channels together */
33:                  static int32 fds_process(void)
34:                  {
35:                     int32 output;
36:                     output = 0;
37:                  
38:                     return output;
39:                  }
9D041B0C  03E00008   JR RA
9D041B10  00001021   ADDU V0, ZERO, ZERO
40:                  
41:                  /* write to registers */
42:                  static void fds_write(uint32 address, uint8 value)
43:                  {
9D041B14  03E00008   JR RA
9D041B18  00000000   NOP
44:                     UNUSED(address);
45:                     UNUSED(value);
46:                  }
47:                  
48:                  /* reset state of vrcvi sound channels */
49:                  static void fds_reset(void)
50:                  {
9D041B1C  27BDFE78   ADDIU SP, SP, -392
9D041B20  AFBF0184   SW RA, 388(SP)
51:                     apu_t apu;
52:                  
53:                     apu_getcontext(&apu);
9D041B24  0F407DCC   JAL apu_getcontext
9D041B28  27A40010   ADDIU A0, SP, 16
54:                  //   fds_incsize = apu.cycle_rate;
55:                     fds_incsize = (int32) (APU_BASEFREQ * 65536.0 / (float) apu.sample_rate);
9D041B2C  0F4105E3   JAL sitofp
9D041B30  8FA40160   LW A0, 352(SP)
9D041B34  3C039D04   LUI V1, -25340
9D041B38  8C642998   LW A0, 10648(V1)
9D041B3C  0F40ED27   JAL __divsf3
9D041B40  00402821   ADDU A1, V0, ZERO
9D041B44  0F41039C   JAL __fixsfsi
9D041B48  00402021   ADDU A0, V0, ZERO
9D041B4C  AF8280F0   SW V0, -32528(GP)
56:                  }
9D041B50  8FBF0184   LW RA, 388(SP)
9D041B54  03E00008   JR RA
9D041B58  27BD0188   ADDIU SP, SP, 392
57:                  
58:                  static apu_memwrite fds_memwrite[] =
59:                  {
60:                     { 0x4040, 0x4092, fds_write }, 
61:                     {     -1,     -1, NULL }
62:                  };
63:                  
64:                  apuext_t fds_ext = 
65:                  {
66:                     NULL, /* no init */
67:                     NULL, /* no shutdown */
68:                     fds_reset,
69:                     fds_process,
70:                     NULL, /* no reads */
71:                     fds_memwrite
72:                  };
73:                  
74:                  /*
75:                  ** $Log: fds_snd.c,v $
76:                  ** Revision 1.2  2001/04/27 14:37:11  neil
77:                  ** wheeee
78:                  **
79:                  ** Revision 1.1  2001/04/27 12:54:40  neil
80:                  ** blah
81:                  **
82:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
83:                  ** initial
84:                  **
85:                  ** Revision 1.1  2000/10/24 12:19:59  matt
86:                  ** changed directory structure
87:                  **
88:                  ** Revision 1.9  2000/10/11 12:13:15  matt
89:                  ** quelled warnings
90:                  **
91:                  ** Revision 1.8  2000/10/03 11:56:20  matt
92:                  ** better support for optional sound ext routines
93:                  **
94:                  ** Revision 1.7  2000/09/15 13:38:40  matt
95:                  ** changes for optimized apu core
96:                  **
97:                  ** Revision 1.6  2000/09/15 04:58:07  matt
98:                  ** simplifying and optimizing APU core
99:                  **
100:                 ** Revision 1.5  2000/07/30 04:32:59  matt
101:                 ** no more apu_getcyclerate hack
102:                 **
103:                 ** Revision 1.4  2000/07/17 01:52:30  matt
104:                 ** made sure last line of all source files is a newline
105:                 **
106:                 ** Revision 1.3  2000/07/03 02:18:53  matt
107:                 ** much better external module exporting
108:                 **
109:                 ** Revision 1.2  2000/06/20 04:06:16  matt
110:                 ** migrated external sound definition to apu module
111:                 **
112:                 ** Revision 1.1  2000/06/20 00:06:47  matt
113:                 ** initial revision
114:                 **
115:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/pcx.c  -------------------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** pcx.c
21:                  **
22:                  ** PCX format screen-saving routines
23:                  ** $Id: pcx.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <stdio.h>
27:                  #include <string.h>
28:                  #include <noftypes.h>
29:                  #include <bitmap.h>
30:                  #include <pcx.h>
31:                  
32:                  /* Save a PCX snapshot from a given NES bitmap */
33:                  int pcx_write(char *filename, bitmap_t *bmp, rgb_t *pal)
34:                  {
9D0358D4  27BDFF40   ADDIU SP, SP, -192
9D0358D8  AFBF00BC   SW RA, 188(SP)
9D0358DC  AFBE00B8   SW FP, 184(SP)
9D0358E0  AFB700B4   SW S7, 180(SP)
9D0358E4  AFB600B0   SW S6, 176(SP)
9D0358E8  AFB500AC   SW S5, 172(SP)
9D0358EC  AFB400A8   SW S4, 168(SP)
9D0358F0  AFB300A4   SW S3, 164(SP)
9D0358F4  AFB200A0   SW S2, 160(SP)
9D0358F8  AFB1009C   SW S1, 156(SP)
9D0358FC  AFB00098   SW S0, 152(SP)
9D035900  00A0F021   ADDU FP, A1, ZERO
9D035904  AFA600C8   SW A2, 200(SP)
35:                     FILE *fp;
36:                     pcxheader_t header;
37:                     int i, line;
38:                     int width, height, x_min, y_min;
39:                  
40:                     ASSERT(bmp);
41:                  
42:                     width = bmp->width;
9D035908  8CB30000   LW S3, 0(A1)
43:                     height = bmp->height;
9D03590C  8CA20004   LW V0, 4(A1)
9D035910  AFA20090   SW V0, 144(SP)
44:                     x_min = 0;
45:                     y_min = 0;
46:                  
47:                     fp = fopen(filename, "wb");
9D035914  3C059D04   LUI A1, -25340
9D035918  0F40F363   JAL .Letext0, .LFE12, fopen
9D03591C  24A52994   ADDIU A1, A1, 10644
48:                     if (NULL == fp)
9D035920  10400094   BEQ V0, ZERO, 0x9D035B74
9D035924  0040A021   ADDU S4, V0, ZERO
49:                        return -1;
9D035B74  2402FFFF   ADDIU V0, ZERO, -1
50:                  
51:                     /* Fill in the header nonsense */
52:                     memset(&header, 0, sizeof(header));
9D035928  27A40010   ADDIU A0, SP, 16
9D03592C  00002821   ADDU A1, ZERO, ZERO
9D035930  0F4100B4   JAL .Letext0, .LFE0, memset
9D035934  24060080   ADDIU A2, ZERO, 128
53:                  
54:                     header.Manufacturer = 10;
9D035938  2403000A   ADDIU V1, ZERO, 10
9D03593C  A3A30010   SB V1, 16(SP)
55:                     header.Version = 5;
9D035940  24040005   ADDIU A0, ZERO, 5
9D035944  A3A40011   SB A0, 17(SP)
56:                     header.Encoding = 1;
9D035948  24070001   ADDIU A3, ZERO, 1
9D03594C  A3A70012   SB A3, 18(SP)
57:                     header.BitsPerPixel = 8;
9D035950  24060008   ADDIU A2, ZERO, 8
9D035954  A3A60013   SB A2, 19(SP)
58:                     header.Xmin = x_min;
59:                     header.Ymin = y_min;
60:                     header.Xmax = width - 1;
9D035958  3268FFFF   ANDI T0, S3, -1
9D03595C  2509FFFF   ADDIU T1, T0, -1
9D035960  312AFFFF   ANDI T2, T1, -1
9D035964  A7AA0018   SH T2, 24(SP)
61:                     header.Ymax = height - 1;
9D035968  8FAB0090   LW T3, 144(SP)
9D03596C  256CFFFF   ADDIU T4, T3, -1
9D035970  318DFFFF   ANDI T5, T4, -1
9D035974  A7AD001A   SH T5, 26(SP)
62:                     header.NPlanes = 1;
9D035978  A3A70051   SB A3, 81(SP)
63:                     header.BytesPerLine = width;
9D03597C  A7A80052   SH T0, 82(SP)
64:                     header.PaletteInfo = 1;
9D035980  240E0001   ADDIU T6, ZERO, 1
9D035984  A7AE0054   SH T6, 84(SP)
65:                     header.HscreenSize = width - 1;
9D035988  A7AA0056   SH T2, 86(SP)
66:                     header.VscreenSize = height - 1;
9D03598C  A7AD0058   SH T5, 88(SP)
67:                  
68:                     fwrite(&header, 1, sizeof(header), fp);
9D035990  27A40010   ADDIU A0, SP, 16
9D035994  24050001   ADDIU A1, ZERO, 1
9D035998  24060080   ADDIU A2, ZERO, 128
9D03599C  0F4108EC   JAL fwrite
9D0359A0  02803821   ADDU A3, S4, ZERO
69:                  
70:                     /* RLE encoding */
71:                     for (line = 0; line < height; line++)
9D0359A4  8FAF0090   LW T7, 144(SP)
9D0359A8  19E0002F   BLEZ T7, 0x9D035A68
9D0359AC  2404000C   ADDIU A0, ZERO, 12
9D0359B0  0000B821   ADDU S7, ZERO, ZERO
9D035A54  26F70001   ADDIU S7, S7, 1
9D035A58  8FAF0090   LW T7, 144(SP)
9D035A5C  16EFFFD6   BNE S7, T7, 0x9D0359B8
9D035A60  27DE0004   ADDIU FP, FP, 4
72:                     {
73:                        uint8 last, *mem;
74:                        int xpos = 0;
9D0359C0  00008821   ADDU S1, ZERO, ZERO
9D0359C4  24B5003F   ADDIU S5, A1, 63
9D0359C8  00A08021   ADDU S0, A1, ZERO
75:                  
76:                        mem = bmp->line[line + y_min] + x_min;
77:                  
78:                        while (xpos < width)
9D0359B8  1A600026   BLEZ S3, 0x9D035A54
9D0359BC  8FC50014   LW A1, 20(FP)
9D035A48  02B3702A   SLT T6, S5, S3
9D035A4C  15C0FFDD   BNE T6, ZERO, 0x9D0359C4
9D035A50  02002821   ADDU A1, S0, ZERO
79:                        {
80:                           int rle_count = 0;
81:                  
82:                           do
83:                           {
84:                              last = *mem++;
9D0359CC  26180001   ADDIU T8, S0, 1
9D0359D0  03008021   ADDU S0, T8, ZERO
9D0359D4  930BFFFF   LBU T3, -1(T8)
9D035BA8  920BFFFF   LBU T3, -1(S0)
9D035BC8  27100002   ADDIU S0, T8, 2
9D035BCC  920BFFFF   LBU T3, -1(S0)
9D035BEC  27100003   ADDIU S0, T8, 3
9D035BF0  920BFFFF   LBU T3, -1(S0)
9D035C10  27100004   ADDIU S0, T8, 4
9D035C14  920BFFFF   LBU T3, -1(S0)
9D035C34  27100005   ADDIU S0, T8, 5
9D035C38  920BFFFF   LBU T3, -1(S0)
9D035C58  27100006   ADDIU S0, T8, 6
9D035C5C  920BFFFF   LBU T3, -1(S0)
9D035C7C  27100007   ADDIU S0, T8, 7
9D035C80  920BFFFF   LBU T3, -1(S0)
9D035CA0  27100008   ADDIU S0, T8, 8
9D035CA4  920BFFFF   LBU T3, -1(S0)
85:                              xpos++;
9D0359D8  26390001   ADDIU T9, S1, 1
9D0359DC  03208821   ADDU S1, T9, ZERO
9D035A00  0220A821   ADDU S5, S1, ZERO
9D035A04  01609021   ADDU S2, T3, ZERO
9D035BAC  27310001   ADDIU S1, T9, 1
9D035BD0  27310002   ADDIU S1, T9, 2
9D035BF4  27310003   ADDIU S1, T9, 3
9D035C18  27310004   ADDIU S1, T9, 4
9D035C3C  27310005   ADDIU S1, T9, 5
9D035C60  27310006   ADDIU S1, T9, 6
9D035C84  27310007   ADDIU S1, T9, 7
9D035CA8  27310008   ADDIU S1, T9, 8
9D035CCC  0B40D682   J 0x9D035A08
86:                              rle_count++;
87:                           }
88:                           while (*mem == last && xpos < width && rle_count < 0x3F);
9D0359E0  93120000   LBU S2, 0(T8)
9D0359E4  164B0006   BNE S2, T3, 0x9D035A00
9D0359E8  03052023   SUBU A0, T8, A1
9D0359EC  0333F82A   SLT RA, T9, S3
9D0359F0  57E0006D   BNEL RA, ZERO, 0x9D035BA8
9D0359F4  27100001   ADDIU S0, T8, 1
9D0359F8  0B40D682   J 0x9D035A08
9D0359FC  0220A821   ADDU S5, S1, ZERO
9D035BB0  93120001   LBU S2, 1(T8)
9D035BB4  164BFF92   BNE S2, T3, 0x9D035A00
9D035BB8  02052023   SUBU A0, S0, A1
9D035BBC  0233102A   SLT V0, S1, S3
9D035BC0  5040FF91   BEQL V0, ZERO, 0x9D035A08
9D035BC4  0220A821   ADDU S5, S1, ZERO
9D035BD4  93120002   LBU S2, 2(T8)
9D035BD8  164BFF89   BNE S2, T3, 0x9D035A00
9D035BDC  02052023   SUBU A0, S0, A1
9D035BE0  0233182A   SLT V1, S1, S3
9D035BE4  5060FF88   BEQL V1, ZERO, 0x9D035A08
9D035BE8  0220A821   ADDU S5, S1, ZERO
9D035BF8  93120003   LBU S2, 3(T8)
9D035BFC  164BFF80   BNE S2, T3, 0x9D035A00
9D035C00  02052023   SUBU A0, S0, A1
9D035C04  0233382A   SLT A3, S1, S3
9D035C08  50E0FF7F   BEQL A3, ZERO, 0x9D035A08
9D035C0C  0220A821   ADDU S5, S1, ZERO
9D035C1C  93120004   LBU S2, 4(T8)
9D035C20  164BFF77   BNE S2, T3, 0x9D035A00
9D035C24  02052023   SUBU A0, S0, A1
9D035C28  0233302A   SLT A2, S1, S3
9D035C2C  50C0FF76   BEQL A2, ZERO, 0x9D035A08
9D035C30  0220A821   ADDU S5, S1, ZERO
9D035C40  93120005   LBU S2, 5(T8)
9D035C44  164BFF6E   BNE S2, T3, 0x9D035A00
9D035C48  02052023   SUBU A0, S0, A1
9D035C4C  0233402A   SLT T0, S1, S3
9D035C50  5100FF6D   BEQL T0, ZERO, 0x9D035A08
9D035C54  0220A821   ADDU S5, S1, ZERO
9D035C64  93120006   LBU S2, 6(T8)
9D035C68  164BFF65   BNE S2, T3, 0x9D035A00
9D035C6C  02052023   SUBU A0, S0, A1
9D035C70  0233482A   SLT T1, S1, S3
9D035C74  5120FF64   BEQL T1, ZERO, 0x9D035A08
9D035C78  0220A821   ADDU S5, S1, ZERO
9D035C88  93120007   LBU S2, 7(T8)
9D035C8C  164BFF5C   BNE S2, T3, 0x9D035A00
9D035C90  02052023   SUBU A0, S0, A1
9D035C94  0233502A   SLT T2, S1, S3
9D035C98  5140FF5B   BEQL T2, ZERO, 0x9D035A08
9D035C9C  0220A821   ADDU S5, S1, ZERO
9D035CAC  93120008   LBU S2, 8(T8)
9D035CB0  164BFF53   BNE S2, T3, 0x9D035A00
9D035CB4  02052023   SUBU A0, S0, A1
9D035CB8  0233602A   SLT T4, S1, S3
9D035CBC  5180FF52   BEQL T4, ZERO, 0x9D035A08
9D035CC0  0220A821   ADDU S5, S1, ZERO
9D035CC4  1615FF42   BNE S0, S5, 0x9D0359D0
9D035CC8  26180001   ADDIU T8, S0, 1
89:                  
90:                           if (rle_count > 1 || 0xC0 == (last & 0xC0))
9D0359B4  241600C0   ADDIU S6, ZERO, 192
9D035A08  28850002   SLTI A1, A0, 2
9D035A0C  50A00005   BEQL A1, ZERO, 0x9D035A24
9D035A10  348400C0   ORI A0, A0, 192
9D035A14  324D00C0   ANDI T5, S2, 192
9D035A18  55B60009   BNEL T5, S6, 0x9D035A40
9D035A1C  02402021   ADDU A0, S2, ZERO
91:                           {
92:                              fputc(0xC0 | rle_count, fp);
9D035A20  348400C0   ORI A0, A0, 192
9D035A24  0F410009   JAL .Letext0, .LFE0, fputc
9D035A28  02802821   ADDU A1, S4, ZERO
93:                              fputc(last, fp);
9D035A2C  02402021   ADDU A0, S2, ZERO
9D035A30  0F410009   JAL .Letext0, .LFE0, fputc
9D035A34  02802821   ADDU A1, S4, ZERO
9D035A38  0B40D693   J 0x9D035A4C
9D035A3C  02B3702A   SLT T6, S5, S3
94:                           }
95:                           else
96:                           {
97:                              fputc(last, fp);
9D035A40  0F410009   JAL .Letext0, .LFE0, fputc
9D035A44  02802821   ADDU A1, S4, ZERO
98:                           }
99:                        }
100:                    }
101:                 
102:                    /* Write palette */
103:                    fputc(0x0C, fp); /* $0C signifies 256 color palette */
9D035A64  2404000C   ADDIU A0, ZERO, 12
9D035A68  0F410009   JAL .Letext0, .LFE0, fputc
9D035A6C  02802821   ADDU A1, S4, ZERO
9D035A70  8FB000C8   LW S0, 200(SP)
104:                    for (i = 0; i < 256; i++)
9D035B5C  1640FFD0   BNE S2, ZERO, 0x9D035AA0
9D035B60  26710030   ADDIU S1, S3, 48
105:                    {
106:                       fputc(pal[i].r, fp);
9D035A74  8E040000   LW A0, 0(S0)
9D035A78  0F410009   JAL .Letext0, .LFE0, fputc
9D035A7C  02802821   ADDU A1, S4, ZERO
9D035AA0  8E240000   LW A0, 0(S1)
9D035AA4  0F410009   JAL .Letext0, .LFE0, fputc
9D035AA8  02802821   ADDU A1, S4, ZERO
9D035AC8  8E24000C   LW A0, 12(S1)
9D035ACC  0F410009   JAL .Letext0, .LFE0, fputc
9D035AD0  02802821   ADDU A1, S4, ZERO
9D035AEC  8E64000C   LW A0, 12(S3)
9D035AF0  0F410009   JAL .Letext0, .LFE0, fputc
9D035AF4  02802821   ADDU A1, S4, ZERO
9D035B10  8E640018   LW A0, 24(S3)
9D035B14  0F410009   JAL .Letext0, .LFE0, fputc
9D035B18  02802821   ADDU A1, S4, ZERO
9D035B34  8E640024   LW A0, 36(S3)
9D035B38  0F410009   JAL .Letext0, .LFE0, fputc
9D035B3C  02802821   ADDU A1, S4, ZERO
107:                       fputc(pal[i].g, fp);
9D035A80  8E040004   LW A0, 4(S0)
9D035A84  0F410009   JAL .Letext0, .LFE0, fputc
9D035A88  02802821   ADDU A1, S4, ZERO
9D035AAC  8E240004   LW A0, 4(S1)
9D035AB0  0F410009   JAL .Letext0, .LFE0, fputc
9D035AB4  02802821   ADDU A1, S4, ZERO
9D035AD4  8E240010   LW A0, 16(S1)
9D035AD8  0F410009   JAL .Letext0, .LFE0, fputc
9D035ADC  02802821   ADDU A1, S4, ZERO
9D035AF8  8E640010   LW A0, 16(S3)
9D035AFC  0F410009   JAL .Letext0, .LFE0, fputc
9D035B00  02802821   ADDU A1, S4, ZERO
9D035B1C  8E64001C   LW A0, 28(S3)
9D035B20  0F410009   JAL .Letext0, .LFE0, fputc
9D035B24  02802821   ADDU A1, S4, ZERO
9D035B40  8E640028   LW A0, 40(S3)
9D035B44  0F410009   JAL .Letext0, .LFE0, fputc
9D035B48  02802821   ADDU A1, S4, ZERO
108:                       fputc(pal[i].b, fp);
9D035A8C  8E040008   LW A0, 8(S0)
9D035A90  0F410009   JAL .Letext0, .LFE0, fputc
9D035A94  02802821   ADDU A1, S4, ZERO
9D035A98  241200FF   ADDIU S2, ZERO, 255
9D035A9C  2611000C   ADDIU S1, S0, 12
9D035AB8  8E240008   LW A0, 8(S1)
9D035ABC  0F410009   JAL .Letext0, .LFE0, fputc
9D035AC0  02802821   ADDU A1, S4, ZERO
9D035AC4  2633000C   ADDIU S3, S1, 12
9D035AE0  8E240014   LW A0, 20(S1)
9D035AE4  0F410009   JAL .Letext0, .LFE0, fputc
9D035AE8  02802821   ADDU A1, S4, ZERO
9D035B04  8E640014   LW A0, 20(S3)
9D035B08  0F410009   JAL .Letext0, .LFE0, fputc
9D035B0C  02802821   ADDU A1, S4, ZERO
9D035B28  8E640020   LW A0, 32(S3)
9D035B2C  0F410009   JAL .Letext0, .LFE0, fputc
9D035B30  02802821   ADDU A1, S4, ZERO
9D035B4C  8E64002C   LW A0, 44(S3)
9D035B50  0F410009   JAL .Letext0, .LFE0, fputc
9D035B54  02802821   ADDU A1, S4, ZERO
9D035B58  2652FFFB   ADDIU S2, S2, -5
109:                    }
110:                 
111:                    /* We're done! */
112:                    fclose(fp);
9D035B64  0F4102B5   JAL .Letext0, .LFE1, fclose
9D035B68  02802021   ADDU A0, S4, ZERO
113:                    return 0;
9D035B6C  0B40D6DE   J 0x9D035B78
9D035B70  00001021   ADDU V0, ZERO, ZERO
114:                 }
9D035B78  8FBF00BC   LW RA, 188(SP)
9D035B7C  8FBE00B8   LW FP, 184(SP)
9D035B80  8FB700B4   LW S7, 180(SP)
9D035B84  8FB600B0   LW S6, 176(SP)
9D035B88  8FB500AC   LW S5, 172(SP)
9D035B8C  8FB400A8   LW S4, 168(SP)
9D035B90  8FB300A4   LW S3, 164(SP)
9D035B94  8FB200A0   LW S2, 160(SP)
9D035B98  8FB1009C   LW S1, 156(SP)
9D035B9C  8FB00098   LW S0, 152(SP)
9D035BA0  03E00008   JR RA
9D035BA4  27BD00C0   ADDIU SP, SP, 192
9D035BA8  920BFFFF   LBU T3, -1(S0)
9D035BAC  27310001   ADDIU S1, T9, 1
9D035BB0  93120001   LBU S2, 1(T8)
9D035BB4  164BFF92   BNE S2, T3, 0x9D035A00
9D035BB8  02052023   SUBU A0, S0, A1
9D035BBC  0233102A   SLT V0, S1, S3
9D035BC0  5040FF91   BEQL V0, ZERO, 0x9D035A08
9D035BC4  0220A821   ADDU S5, S1, ZERO
9D035BC8  27100002   ADDIU S0, T8, 2
9D035BCC  920BFFFF   LBU T3, -1(S0)
9D035BD0  27310002   ADDIU S1, T9, 2
9D035BD4  93120002   LBU S2, 2(T8)
9D035BD8  164BFF89   BNE S2, T3, 0x9D035A00
9D035BDC  02052023   SUBU A0, S0, A1
9D035BE0  0233182A   SLT V1, S1, S3
9D035BE4  5060FF88   BEQL V1, ZERO, 0x9D035A08
9D035BE8  0220A821   ADDU S5, S1, ZERO
9D035BEC  27100003   ADDIU S0, T8, 3
9D035BF0  920BFFFF   LBU T3, -1(S0)
9D035BF4  27310003   ADDIU S1, T9, 3
9D035BF8  93120003   LBU S2, 3(T8)
9D035BFC  164BFF80   BNE S2, T3, 0x9D035A00
9D035C00  02052023   SUBU A0, S0, A1
9D035C04  0233382A   SLT A3, S1, S3
9D035C08  50E0FF7F   BEQL A3, ZERO, 0x9D035A08
9D035C0C  0220A821   ADDU S5, S1, ZERO
9D035C10  27100004   ADDIU S0, T8, 4
9D035C14  920BFFFF   LBU T3, -1(S0)
9D035C18  27310004   ADDIU S1, T9, 4
9D035C1C  93120004   LBU S2, 4(T8)
9D035C20  164BFF77   BNE S2, T3, 0x9D035A00
9D035C24  02052023   SUBU A0, S0, A1
9D035C28  0233302A   SLT A2, S1, S3
9D035C2C  50C0FF76   BEQL A2, ZERO, 0x9D035A08
9D035C30  0220A821   ADDU S5, S1, ZERO
9D035C34  27100005   ADDIU S0, T8, 5
9D035C38  920BFFFF   LBU T3, -1(S0)
9D035C3C  27310005   ADDIU S1, T9, 5
9D035C40  93120005   LBU S2, 5(T8)
9D035C44  164BFF6E   BNE S2, T3, 0x9D035A00
9D035C48  02052023   SUBU A0, S0, A1
9D035C4C  0233402A   SLT T0, S1, S3
9D035C50  5100FF6D   BEQL T0, ZERO, 0x9D035A08
9D035C54  0220A821   ADDU S5, S1, ZERO
9D035C58  27100006   ADDIU S0, T8, 6
9D035C5C  920BFFFF   LBU T3, -1(S0)
9D035C60  27310006   ADDIU S1, T9, 6
9D035C64  93120006   LBU S2, 6(T8)
9D035C68  164BFF65   BNE S2, T3, 0x9D035A00
9D035C6C  02052023   SUBU A0, S0, A1
9D035C70  0233482A   SLT T1, S1, S3
9D035C74  5120FF64   BEQL T1, ZERO, 0x9D035A08
9D035C78  0220A821   ADDU S5, S1, ZERO
9D035C7C  27100007   ADDIU S0, T8, 7
9D035C80  920BFFFF   LBU T3, -1(S0)
9D035C84  27310007   ADDIU S1, T9, 7
9D035C88  93120007   LBU S2, 7(T8)
9D035C8C  164BFF5C   BNE S2, T3, 0x9D035A00
9D035C90  02052023   SUBU A0, S0, A1
9D035C94  0233502A   SLT T2, S1, S3
9D035C98  5140FF5B   BEQL T2, ZERO, 0x9D035A08
9D035C9C  0220A821   ADDU S5, S1, ZERO
9D035CA0  27100008   ADDIU S0, T8, 8
9D035CA4  920BFFFF   LBU T3, -1(S0)
9D035CA8  27310008   ADDIU S1, T9, 8
9D035CAC  93120008   LBU S2, 8(T8)
9D035CB0  164BFF53   BNE S2, T3, 0x9D035A00
9D035CB4  02052023   SUBU A0, S0, A1
9D035CB8  0233602A   SLT T4, S1, S3
9D035CBC  5180FF52   BEQL T4, ZERO, 0x9D035A08
9D035CC0  0220A821   ADDU S5, S1, ZERO
9D035CC4  1615FF42   BNE S0, S5, 0x9D0359D0
9D035CC8  26180001   ADDIU T8, S0, 1
9D035CCC  0B40D682   J 0x9D035A08
9D035CD0  0220A821   ADDU S5, S1, ZERO
115:                 
116:                 /*
117:                 ** $Log: pcx.c,v $
118:                 ** Revision 1.2  2001/04/27 14:37:11  neil
119:                 ** wheeee
120:                 **
121:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
122:                 ** initial
123:                 **
124:                 ** Revision 1.8  2000/11/06 05:17:48  matt
125:                 ** better!
126:                 **
127:                 ** Revision 1.7  2000/11/05 16:37:18  matt
128:                 ** rolled rgb.h into bitmap.h
129:                 **
130:                 ** Revision 1.6  2000/07/17 01:52:27  matt
131:                 ** made sure last line of all source files is a newline
132:                 **
133:                 ** Revision 1.5  2000/06/26 04:55:13  matt
134:                 ** changed routine name, big whoop
135:                 **
136:                 ** Revision 1.4  2000/06/09 15:12:25  matt
137:                 ** initial revision
138:                 **
139:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/nofrendo.c  --------------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** nofrendo.c
21:                  **
22:                  ** Entry point of program
23:                  ** Note: all architectures should call these functions
24:                  ** $Id: nofrendo.c,v 1.3 2001/04/27 14:37:11 neil Exp $
25:                  */
26:                  
27:                  #include <stdio.h>
28:                  #include <stdlib.h>
29:                  #include <noftypes.h>
30:                  #include <nofrendo.h>
31:                  #include <event.h>
32:                  #include <nofconfig.h>
33:                  #include <log.h>
34:                  #include <osd.h>
35:                  #include <gui.h>
36:                  #include <vid_drv.h>
37:                  
38:                  /* emulated system includes */
39:                  #include <nes.h>
40:                  
41:                  /* our global machine structure */
42:                  static struct
43:                  {
44:                     char *filename, *nextfilename;
45:                     system_t type, nexttype;
46:                  
47:                     union 
48:                     {
49:                        nes_t *nes;
50:                     } machine;
51:                  
52:                     int refresh_rate;
53:                  
54:                     bool quit;
55:                  } console;
56:                  
57:                  /* our happy little timer ISR */
58:                  volatile int nofrendo_ticks = 0;
59:                  static void timer_isr(void)
60:                  {
61:                     nofrendo_ticks++;
62:                  }
63:                  
64:                  static void timer_isr_end(void) {} /* code marker for djgpp */
65:                  
66:                  static void shutdown_everything(void)
67:                  {
68:                     if (console.filename)
69:                     {
70:                        free(console.filename);
71:                        console.filename = NULL;
72:                     }
73:                     if (console.nextfilename)
74:                     {
75:                        free(console.nextfilename);
76:                        console.nextfilename = NULL;
77:                     }
78:                  
79:                     config.close();
80:                     //osd_shutdown();
81:                     gui_shutdown();
82:                     vid_shutdown();
83:                     log_shutdown();
84:                  }
85:                  
86:                  /* End the current context */
87:                  void main_eject(void)
88:                  {
9D039B2C  27BDFFE8   ADDIU SP, SP, -24
9D039B30  AFBF0014   SW RA, 20(SP)
9D039B34  AFB00010   SW S0, 16(SP)
89:                     switch (console.type)
9D039B38  3C02A001   LUI V0, -24575
9D039B3C  8C435894   LW V1, 22676(V0)
9D039B40  24040002   ADDIU A0, ZERO, 2
9D039B44  14640007   BNE V1, A0, 0x9D039B64
9D039B48  3C06A001   LUI A2, -24575
90:                     {
91:                     case system_nes:
92:                        nes_poweroff();
9D039B4C  0F4099B9   JAL nes_poweroff
9D039B50  00000000   NOP
93:                        nes_destroy(&(console.machine.nes));
9D039B54  3C05A001   LUI A1, -24575
9D039B58  0F409995   JAL nes_destroy
9D039B5C  24A4589C   ADDIU A0, A1, 22684
94:                        break;
95:                  
96:                     default:
97:                        break;
98:                     }
99:                  
100:                    if (NULL != console.filename)
9D039B60  3C06A001   LUI A2, -24575
9D039B64  8CC7588C   LW A3, 22668(A2)
9D039B68  10E00004   BEQ A3, ZERO, 0x9D039B7C
9D039B6C  3C10A001   LUI S0, -24575
101:                    {
102:                       free(console.filename);
9D039B70  0F40F31D   JAL _my_free
9D039B74  2604588C   ADDIU A0, S0, 22668
103:                       console.filename = NULL;
9D039B78  AE00588C   SW ZERO, 22668(S0)
104:                    }
105:                    console.type = system_unknown;
9D039B7C  3C08A001   LUI T0, -24575
9D039B80  AD005894   SW ZERO, 22676(T0)
106:                 }
9D039B84  8FBF0014   LW RA, 20(SP)
9D039B88  8FB00010   LW S0, 16(SP)
9D039B8C  03E00008   JR RA
9D039B90  27BD0018   ADDIU SP, SP, 24
107:                 
108:                 /* Act on the user's quit requests */
109:                 void main_quit(void)
110:                 {
9D039B94  27BDFFE8   ADDIU SP, SP, -24
9D039B98  AFBF0014   SW RA, 20(SP)
9D039B9C  AFB00010   SW S0, 16(SP)
111:                    console.quit = true;
9D039BA0  3C10A001   LUI S0, -24575
9D039BA4  2610588C   ADDIU S0, S0, 22668
9D039BA8  24020001   ADDIU V0, ZERO, 1
112:                 
113:                    main_eject();
9D039BAC  0F40E6CB   JAL main_eject
9D039BB0  AE020018   SW V0, 24(S0)
114:                 
115:                    /* if there's a pending filename / system, clear */
116:                    if (NULL != console.nextfilename)
9D039BB4  8E030004   LW V1, 4(S0)
9D039BB8  10600007   BEQ V1, ZERO, 0x9D039BD8
9D039BBC  3C06A001   LUI A2, -24575
117:                    {
118:                       free(console.nextfilename);
9D039BC0  3C04A001   LUI A0, -24575
9D039BC4  0F40F31D   JAL _my_free
9D039BC8  24845890   ADDIU A0, A0, 22672
119:                       console.nextfilename = NULL;
9D039BCC  3C05A001   LUI A1, -24575
9D039BD0  ACA05890   SW ZERO, 22672(A1)
120:                    }
121:                    console.nexttype = system_unknown;
9D039BD4  3C06A001   LUI A2, -24575
9D039BD8  ACC05898   SW ZERO, 22680(A2)
122:                 }
9D039BDC  8FBF0014   LW RA, 20(SP)
9D039BE0  8FB00010   LW S0, 16(SP)
9D039BE4  03E00008   JR RA
9D039BE8  27BD0018   ADDIU SP, SP, 24
123:                 
124:                 extern unsigned char _binary_SuperMarioBros_nes_start[];
125:                 
126:                 /* brute force system autodetection */
127:                 static system_t detect_systemtype(const char *filename)
128:                 {
129:                    if (NULL == filename)
9D039A38  50800006   BEQL A0, ZERO, 0x9D039A54
130:                       return system_unknown;
131:                 
132:                    if (0 == nes_isourfile(filename))
9D039A40  0F4097E0   JAL nes_isourfile
133:                       return system_nes;
9D039A48  24050002   ADDIU A1, ZERO, 2
134:                    
135:                    /* can't figure out what this thing is */
136:                    return system_unknown;
137:                 }
138:                 
139:                 static int install_timer(int hertz)
140:                 {
141:                    //return osd_installtimer(hertz, (void *) timer_isr,
142:                    //                        (int) timer_isr_end - (int) timer_isr,
143:                    //                        (void *) &nofrendo_ticks, 
144:                    //                        sizeof(nofrendo_ticks));
145:                 }
146:                 
147:                 /* This assumes there is no current context */
148:                 static int internal_insert(const char *filename, system_t type)
149:                 {
9D039A1C  27BDFFE0   ADDIU SP, SP, -32
9D039A20  AFBF001C   SW RA, 28(SP)
9D039A24  AFB10018   SW S1, 24(SP)
9D039A28  AFB00014   SW S0, 20(SP)
150:                    /* autodetect system type? */
151:                    if (system_autodetect == type)
9D039A2C  24020001   ADDIU V0, ZERO, 1
9D039A30  14A20008   BNE A1, V0, 0x9D039A54
9D039A34  00808821   ADDU S1, A0, ZERO
152:                       type = detect_systemtype(filename);
153:                 
154:                    //console.filename = strdup(filename);
155:                    console.type = type;
9D039A54  3C10A001   LUI S0, -24575
9D039A58  2610588C   ADDIU S0, S0, 22668
9D039A5C  AE050008   SW A1, 8(S0)
156:                 
157:                    /* set up the event system for this system type */
158:                    event_set_system(type);
9D039A60  0F40B249   JAL event_set_system
9D039A64  00A02021   ADDU A0, A1, ZERO
159:                 
160:                    switch (console.type)
9D039A68  8E030008   LW V1, 8(S0)
9D039A6C  24040002   ADDIU A0, ZERO, 2
9D039A70  1464001A   BNE V1, A0, 0x9D039ADC
9D039A74  3C059D04   LUI A1, -25340
161:                    {
162:                    case system_nes:
163:                       gui_setrefresh(NES_REFRESH_RATE);
9D039A78  0F4086E6   JAL gui_setrefresh
9D039A7C  2404003C   ADDIU A0, ZERO, 60
164:                 
165:                       console.machine.nes = nes_create();
9D039A80  0F409BEF   JAL nes_create
9D039A84  00000000   NOP
9D039A88  3C09A001   LUI T1, -24575
166:                       if (NULL == console.machine.nes)
9D039A8C  14400006   BNE V0, ZERO, 0x9D039AA8
9D039A90  AD22589C   SW V0, 22684(T1)
167:                       {
168:                          log_printf("Failed to create NES instance.\n");
9D039A94  3C0B9D04   LUI T3, -25340
9D039A98  0F410817   JAL log_printf
9D039A9C  25641848   ADDIU A0, T3, 6216
169:                          return -1;
9D039AA0  0B40E6C5   J 0x9D039B14
9D039AA4  2411FFFF   ADDIU S1, ZERO, -1
170:                       }
171:                 
172:                       if (nes_insertcart(&_binary_SuperMarioBros_nes_start, console.machine.nes))
9D039AA8  3C0AA000   LUI T2, -24576
9D039AAC  25446248   ADDIU A0, T2, 25160
9D039AB0  0F4099C3   JAL nes_insertcart
9D039AB4  00402821   ADDU A1, V0, ZERO
9D039AB8  14400015   BNE V0, ZERO, 0x9D039B10
9D039ABC  00408821   ADDU S1, V0, ZERO
173:                          return -1;
9D039B10  2411FFFF   ADDIU S1, ZERO, -1
174:                 
175:                       vid_setmode(NES_SCREEN_WIDTH, NES_VISIBLE_HEIGHT);
9D039AC0  24040100   ADDIU A0, ZERO, 256
9D039AC4  0F40D17C   JAL vid_setmode
9D039AC8  240500E0   ADDIU A1, ZERO, 224
176:                 
177:                       if (install_timer(NES_REFRESH_RATE))
178:                          return -1;
179:                 
180:                       nes_emulate();
9D039ACC  0F4098C7   JAL nes_emulate
9D039AD0  00000000   NOP
181:                       break;
182:                    
183:                    case system_unknown:
184:                    default:
185:                       log_printf("system type unknown, playing nofrendo NES intro.\n");
9D039ADC  0F410817   JAL log_printf
9D039AE0  24A41868   ADDIU A0, A1, 6248
186:                       if (NULL != console.filename)
9D039AE4  3C06A001   LUI A2, -24575
9D039AE8  8CC7588C   LW A3, 22668(A2)
9D039AEC  10E00003   BEQ A3, ZERO, .LVL14
9D039AF0  3C08A001   LUI T0, -24575
187:                          free(console.filename);
9D039AF4  0F40F31D   JAL _my_free
9D039AF8  2504588C   ADDIU A0, T0, 22668
188:                 
189:                       /* oooh, recursion */
190:                       return internal_insert(filename, system_nes);
9D039AFC  02202021   ADDU A0, S1, ZERO
9D039B00  0F40E687   JAL .Letext0, .LFE7, .LFB10, internal_insert, .Ltext0
9D039B04  24050002   ADDIU A1, ZERO, 2
9D039B08  0B40E6C5   J 0x9D039B14
9D039B0C  00408821   ADDU S1, V0, ZERO
191:                    }
192:                 
193:                    return 0;
9D039AD4  0B40E6C6   J 0x9D039B18
9D039AD8  02201021   ADDU V0, S1, ZERO
194:                 }
9D039B14  02201021   ADDU V0, S1, ZERO
9D039B18  8FBF001C   LW RA, 28(SP)
9D039B1C  8FB10018   LW S1, 24(SP)
9D039B20  8FB00014   LW S0, 20(SP)
9D039B24  03E00008   JR RA
9D039B28  27BD0020   ADDIU SP, SP, 32
195:                 
196:                 /* This tells main_loop to load this next image */
197:                 void main_insert(const char *filename, system_t type)
198:                 {
9D039BEC  27BDFFE8   ADDIU SP, SP, -24
9D039BF0  AFBF0014   SW RA, 20(SP)
9D039BF4  AFB00010   SW S0, 16(SP)
199:                    console.nextfilename = strdup(filename);
9D039BF8  0F40F347   JAL _my_strdup
9D039BFC  00A08021   ADDU S0, A1, ZERO
9D039C00  3C03A001   LUI V1, -24575
9D039C04  2464588C   ADDIU A0, V1, 22668
9D039C08  AC820004   SW V0, 4(A0)
200:                    console.nexttype = type;
201:                 
202:                    main_eject();
9D039C0C  0F40E6CB   JAL main_eject
9D039C10  AC90000C   SW S0, 12(A0)
203:                 }
9D039C14  8FBF0014   LW RA, 20(SP)
9D039C18  8FB00010   LW S0, 16(SP)
9D039C1C  03E00008   JR RA
9D039C20  27BD0018   ADDIU SP, SP, 24
204:                 
205:                 int nofrendo_main(int argc, char *argv[])
206:                 {
9D039C68  27BDFFE8   ADDIU SP, SP, -24
9D039C6C  AFBF0014   SW RA, 20(SP)
207:                    /* initialize our system structure */
208:                    console.filename = NULL;
9D039C70  3C02A001   LUI V0, -24575
9D039C74  AC40588C   SW ZERO, 22668(V0)
209:                    console.nextfilename = NULL;
9D039C78  2443588C   ADDIU V1, V0, 22668
9D039C7C  AC600004   SW ZERO, 4(V1)
210:                    console.type = system_unknown;
9D039C80  AC600008   SW ZERO, 8(V1)
211:                    console.nexttype = system_unknown;
9D039C84  AC60000C   SW ZERO, 12(V1)
212:                    console.refresh_rate = 0;
9D039C88  AC600014   SW ZERO, 20(V1)
213:                    console.quit = false;
214:                    
215:                    if (log_init())
9D039C8C  0F410811   JAL log_init
9D039C90  AC600018   SW ZERO, 24(V1)
9D039C94  14400007   BNE V0, ZERO, .LVL32
9D039C98  2402FFFF   ADDIU V0, ZERO, -1
216:                       return -1;
217:                 
218:                    event_init();
9D039C9C  0F40B240   JAL event_init
9D039CA0  00000000   NOP
219:                 
220:                    //return osd_main(argc, argv);
221:                    main_loop("test",system_nes);
9D039CA4  3C049D04   LUI A0, -25340
9D039CA8  2484189C   ADDIU A0, A0, 6300
9D039CAC  0F40E709   JAL main_loop
9D039CB0  24050002   ADDIU A1, ZERO, 2
222:                 }
9D039CB4  8FBF0014   LW RA, 20(SP)
9D039CB8  03E00008   JR RA
9D039CBC  27BD0018   ADDIU SP, SP, 24
223:                 
224:                 /* This is the final leg of main() */
225:                 int main_loop(const char *filename, system_t type)
226:                 {
9D039C24  27BDFFE8   ADDIU SP, SP, -24
9D039C28  AFBF0014   SW RA, 20(SP)
9D039C2C  AFB00010   SW S0, 16(SP)
227:                    vidinfo_t video;
228:                 
229:                    /* register shutdown, in case of assertions, etc. */
230:                 //   atexit(shutdown_everything);
231:                 
232:                 //   if (config.open())
233:                 //s      return -1;
234:                 
235:                    //if (osd_init())
236:                    //   return -1;
237:                 
238:                    //if (gui_init())
239:                    //   return -1;
240:                 
241:                    //osd_getvideoinfo(&video);
242:                 //   if (vid_init(video.default_width, video.default_height, video.driver))
243:                 //      return -1;
244:                 //	printf("vid_init done\n");
245:                 
246:                    console.nextfilename = strdup(filename);
9D039C30  0F40F347   JAL _my_strdup
9D039C34  00A08021   ADDU S0, A1, ZERO
9D039C38  3C03A001   LUI V1, -24575
9D039C3C  2464588C   ADDIU A0, V1, 22668
9D039C40  AC820004   SW V0, 4(A0)
247:                    console.nexttype = type;
9D039C44  AC90000C   SW S0, 12(A0)
248:                 
249:                    //while (false == console.quit)
250:                    //{
251:                       if (internal_insert(console.nextfilename, console.nexttype))
9D039C48  00402021   ADDU A0, V0, ZERO
9D039C4C  0F40E687   JAL .Letext0, .LFE7, .LFB10, internal_insert, .Ltext0
9D039C50  02002821   ADDU A1, S0, ZERO
252:                          return 1;
253:                    //}
254:                 
255:                    return 0;
256:                 }
9D039C54  0002102B   SLTU V0, ZERO, V0
9D039C58  8FBF0014   LW RA, 20(SP)
9D039C5C  8FB00010   LW S0, 16(SP)
9D039C60  03E00008   JR RA
9D039C64  27BD0018   ADDIU SP, SP, 24
257:                 
258:                 /*
259:                 ** $Log: nofrendo.c,v $
260:                 ** Revision 1.3  2001/04/27 14:37:11  neil
261:                 ** wheeee
262:                 **
263:                 ** Revision 1.2  2001/04/27 11:10:08  neil
264:                 ** compile
265:                 **
266:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
267:                 ** initial
268:                 **
269:                 ** Revision 1.48  2000/11/27 12:47:08  matt
270:                 ** free them strings
271:                 **
272:                 ** Revision 1.47  2000/11/25 20:26:05  matt
273:                 ** removed fds "system"
274:                 **
275:                 ** Revision 1.46  2000/11/25 01:51:53  matt
276:                 ** bool stinks sometimes
277:                 **
278:                 ** Revision 1.45  2000/11/20 13:22:12  matt
279:                 ** standardized timer ISR, added nofrendo_ticks
280:                 **
281:                 ** Revision 1.44  2000/11/05 22:53:13  matt
282:                 ** only one video driver per system, please
283:                 **
284:                 ** Revision 1.43  2000/11/01 14:15:35  matt
285:                 ** multi-system event system, or whatever
286:                 **
287:                 ** Revision 1.42  2000/10/28 15:16:24  matt
288:                 ** removed nsf_init
289:                 **
290:                 ** Revision 1.41  2000/10/27 12:58:44  matt
291:                 ** gui_init can now fail
292:                 **
293:                 ** Revision 1.40  2000/10/26 22:48:57  matt
294:                 ** prelim NSF support
295:                 **
296:                 ** Revision 1.39  2000/10/25 13:42:02  matt
297:                 ** strdup - giddyap!
298:                 **
299:                 ** Revision 1.38  2000/10/25 01:23:08  matt
300:                 ** basic system autodetection
301:                 **
302:                 ** Revision 1.37  2000/10/23 17:50:47  matt
303:                 ** adding fds support
304:                 **
305:                 ** Revision 1.36  2000/10/23 15:52:04  matt
306:                 ** better system handling
307:                 **
308:                 ** Revision 1.35  2000/10/21 19:25:59  matt
309:                 ** many more cleanups
310:                 **
311:                 ** Revision 1.34  2000/10/10 13:58:13  matt
312:                 ** stroustrup squeezing his way in the door
313:                 **
314:                 ** Revision 1.33  2000/10/10 13:03:54  matt
315:                 ** Mr. Clean makes a guest appearance
316:                 **
317:                 ** Revision 1.32  2000/09/15 04:58:06  matt
318:                 ** simplifying and optimizing APU core
319:                 **
320:                 ** Revision 1.31  2000/09/10 23:19:14  matt
321:                 ** i'm a sloppy coder
322:                 **
323:                 ** Revision 1.30  2000/09/07 01:30:57  matt
324:                 ** nes6502_init deprecated
325:                 **
326:                 ** Revision 1.29  2000/08/16 03:17:49  matt
327:                 ** bpb
328:                 **
329:                 ** Revision 1.28  2000/08/16 02:58:19  matt
330:                 ** changed video interface a wee bit
331:                 **
332:                 ** Revision 1.27  2000/07/31 04:28:46  matt
333:                 ** one million cleanups
334:                 **
335:                 ** Revision 1.26  2000/07/30 04:31:26  matt
336:                 ** automagic loading of the nofrendo intro
337:                 **
338:                 ** Revision 1.25  2000/07/27 01:16:36  matt
339:                 ** sorted out the video problems
340:                 **
341:                 ** Revision 1.24  2000/07/26 21:54:53  neil
342:                 ** eject has to clear the nextfilename and nextsystem
343:                 **
344:                 ** Revision 1.23  2000/07/26 21:36:13  neil
345:                 ** Big honkin' change -- see the mailing list
346:                 **
347:                 ** Revision 1.22  2000/07/25 02:21:36  matt
348:                 ** safer xxx_destroy calls
349:                 **
350:                 ** Revision 1.21  2000/07/23 16:46:47  matt
351:                 ** fixed crash in win32 by reodering shutdown calls
352:                 **
353:                 ** Revision 1.20  2000/07/23 15:18:23  matt
354:                 ** removed unistd.h from includes
355:                 **
356:                 ** Revision 1.19  2000/07/23 00:48:15  neil
357:                 ** Win32 SDL
358:                 **
359:                 ** Revision 1.18  2000/07/21 13:42:06  neil
360:                 ** get_options removed, as it should be handled by osd_main
361:                 **
362:                 ** Revision 1.17  2000/07/21 04:53:48  matt
363:                 ** moved palette calls out of nofrendo.c and into ppu_create
364:                 **
365:                 ** Revision 1.16  2000/07/21 02:40:43  neil
366:                 ** more main fixes
367:                 **
368:                 ** Revision 1.15  2000/07/21 02:09:07  neil
369:                 ** new main structure?
370:                 **
371:                 ** Revision 1.14  2000/07/20 17:05:12  neil
372:                 ** Moved osd_init before setup_video
373:                 **
374:                 ** Revision 1.13  2000/07/11 15:01:05  matt
375:                 ** moved config.close() into registered atexit() routine
376:                 **
377:                 ** Revision 1.12  2000/07/11 13:35:38  bsittler
378:                 ** Changed the config API, implemented config file "nofrendo.cfg". The
379:                 ** GGI drivers use the group [GGI]. Visual= and Mode= keys are understood.
380:                 **
381:                 ** Revision 1.11  2000/07/11 04:32:21  matt
382:                 ** less magic number nastiness for screen dimensions
383:                 **
384:                 ** Revision 1.10  2000/07/10 03:04:15  matt
385:                 ** removed scanlines, backbuffer from custom blit
386:                 **
387:                 ** Revision 1.9  2000/07/07 04:39:54  matt
388:                 ** removed garbage dpp shite
389:                 **
390:                 ** Revision 1.8  2000/07/06 16:48:25  matt
391:                 ** new video driver
392:                 **
393:                 ** Revision 1.7  2000/07/05 17:26:16  neil
394:                 ** Moved the externs in nofrendo.c to osd.h
395:                 **
396:                 ** Revision 1.6  2000/06/26 04:55:44  matt
397:                 ** cleaned up main()
398:                 **
399:                 ** Revision 1.5  2000/06/20 20:41:21  matt
400:                 ** moved <stdlib.h> include to top (duh)
401:                 **
402:                 ** Revision 1.4  2000/06/09 15:12:25  matt
403:                 ** initial revision
404:                 **
405:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/nes/nesstate.c  ----------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** nesstate.c
21:                  **
22:                  ** state saving/loading
23:                  ** $Id: nesstate.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <stdio.h>
27:                  #include <string.h>
28:                  #include <noftypes.h>
29:                  #include <nesstate.h>
30:                  #include <gui.h>
31:                  #include <nes.h>
32:                  #include <log.h>
33:                  #include <osd.h>
34:                  #include <libsnss.h>
35:                  #include "nes6502.h"
36:                  
37:                  #define  FIRST_STATE_SLOT  0
38:                  #define  LAST_STATE_SLOT   9
39:                  
40:                  static int state_slot = FIRST_STATE_SLOT;
41:                  
42:                  /* Set the state-save slot to use (0 - 9) */
43:                  void state_setslot(int slot)
44:                  {
9D0232B0  27BDFFE8   ADDIU SP, SP, -24
9D0232B4  AFBF0014   SW RA, 20(SP)
45:                     /* Don't send a message if we're already at that slot */
46:                     if (state_slot != slot && slot >= FIRST_STATE_SLOT
9D0232B8  8F8280DC   LW V0, -32548(GP)
9D0232BC  10440009   BEQ V0, A0, .LVL2
9D0232C0  00803021   ADDU A2, A0, ZERO
47:                         && slot <= LAST_STATE_SLOT)
9D0232C4  2C83000A   SLTIU V1, A0, 10
9D0232C8  10600007   BEQ V1, ZERO, 0x9D0232E8
9D0232CC  8FBF0014   LW RA, 20(SP)
48:                     {
49:                        state_slot = slot;
9D0232D0  AF8480DC   SW A0, -32548(GP)
50:                        gui_sendmsg(GUI_WHITE, "State slot set to %d", slot);
9D0232D4  240400C4   ADDIU A0, ZERO, 196
9D0232D8  3C059D04   LUI A1, -25340
9D0232DC  0F408633   JAL gui_sendmsg
9D0232E0  24A5FE18   ADDIU A1, A1, -488
51:                     }
52:                  }
9D0232E4  8FBF0014   LW RA, 20(SP)
9D0232E8  03E00008   JR RA
9D0232EC  27BD0018   ADDIU SP, SP, 24
53:                  
54:                  static int save_baseblock(nes_t *state, SNSS_FILE *snssFile)
55:                  {
56:                     int i;
57:                  
58:                     ASSERT(state);
59:                  
60:                     nes6502_getcontext(state->cpu);
9D023354  0F403159   JAL nes6502_getcontext
61:                     ppu_getcontext(state->ppu);
9D02335C  0F405812   JAL ppu_getcontext
62:                  
63:                     snssFile->baseBlock.regA = state->cpu->a_reg;
9D023364  8E030000   LW V1, 0(S0)
64:                     snssFile->baseBlock.regX = state->cpu->x_reg;
9D023370  8E060000   LW A2, 0(S0)
65:                     snssFile->baseBlock.regY = state->cpu->y_reg;
9D02337C  8E080000   LW T0, 0(S0)
66:                     snssFile->baseBlock.regFlags = state->cpu->p_reg;
9D023388  8E0A0000   LW T2, 0(S0)
67:                     snssFile->baseBlock.regStack = state->cpu->s_reg;
9D023394  8E0C0000   LW T4, 0(S0)
68:                     snssFile->baseBlock.regPc = state->cpu->pc_reg;
9D0233A0  8E0E0000   LW T6, 0(S0)
69:                  
70:                     snssFile->baseBlock.reg2000 = state->ppu->ctrl0;
9D0233AC  8E120304   LW S2, 772(S0)
71:                     snssFile->baseBlock.reg2001 = state->ppu->ctrl1;
9D0233B8  8E140304   LW S4, 772(S0)
72:                  
73:                     memcpy(snssFile->baseBlock.cpuRam, state->cpu->mem_page[0], 0x800);
9D0233C4  8E190000   LW T9, 0(S0)
74:                     memcpy(snssFile->baseBlock.spriteRam, state->ppu->oam, 0x100);
9D0234F8  8E070304   LW A3, 772(S0)
75:                     memcpy(snssFile->baseBlock.ppuRam, state->ppu->nametab, 0x1000);
9D02362C  8E030304   LW V1, 772(S0)
76:                  
77:                     /* Mask off priority color bits */
78:                     for (i = 0; i < 32; i++)
9D02375C  0000F821   ADDU RA, ZERO, ZERO
9D02377C  27FF0001   ADDIU RA, RA, 1
9D023798  27E90001   ADDIU T1, RA, 1
9D0237B4  27F90002   ADDIU T9, RA, 2
9D0237D0  27E60003   ADDIU A2, RA, 3
9D0237EC  27E90004   ADDIU T1, RA, 4
9D023808  27F90005   ADDIU T9, RA, 5
9D023824  27E60006   ADDIU A2, RA, 6
9D02383C  27FF0007   ADDIU RA, RA, 7
79:                        snssFile->baseBlock.palette[i] = state->ppu->palette[i] & 0x3F;
9D023768  8E080304   LW T0, 772(S0)
9D023784  8E020304   LW V0, 772(S0)
9D0237A0  8E120304   LW S2, 772(S0)
9D0237BC  8E080304   LW T0, 772(S0)
9D0237D8  8E020304   LW V0, 772(S0)
9D0237F4  8E120304   LW S2, 772(S0)
9D023810  8E080304   LW T0, 772(S0)
9D02382C  8E020304   LW V0, 772(S0)
80:                  
81:                     snssFile->baseBlock.mirrorState[0] = (state->ppu->page[8] + 0x2000 - state->ppu->nametab) / 0x400;
9D023848  8E0D0304   LW T5, 772(S0)
82:                     snssFile->baseBlock.mirrorState[1] = (state->ppu->page[9] + 0x2400 - state->ppu->nametab) / 0x400;
9D02386C  8E190304   LW T9, 772(S0)
83:                     snssFile->baseBlock.mirrorState[2] = (state->ppu->page[10] + 0x2800 - state->ppu->nametab) / 0x400;
9D023890  8E130304   LW S3, 772(S0)
84:                     snssFile->baseBlock.mirrorState[3] = (state->ppu->page[11] + 0x2C00 - state->ppu->nametab) / 0x400;
9D0238B4  8E090304   LW T1, 772(S0)
85:                  
86:                     snssFile->baseBlock.vramAddress = state->ppu->vaddr;
9D0238D8  8E0F0304   LW T7, 772(S0)
87:                     snssFile->baseBlock.spriteRamAddress = state->ppu->oam_addr;
9D0238E4  8E050304   LW A1, 772(S0)
88:                     snssFile->baseBlock.tileXOffset = state->ppu->tile_xofs;
9D0238F0  8E140304   LW S4, 772(S0)
9D0238F4  8E86116C   LW A2, 4460(S4)
9D0238F8  A2261945   SB A2, 6469(S1)
89:                  
90:                     return 0;
91:                  }
92:                  
93:                  static bool save_vramblock(nes_t *state, SNSS_FILE *snssFile)
94:                  {
95:                     ASSERT(state);
96:                  
97:                     if (NULL == state->rominfo->vram)
9D023910  8E130310   LW S3, 784(S0)
9D023914  8E62000C   LW V0, 12(S3)
9D023918  10400016   BEQ V0, ZERO, 0x9D023974
9D02391C  8FB10010   LW S1, 16(SP)
98:                        return -1;
99:                  
100:                    if (state->rominfo->vram_banks > 2)
9D023920  8E65001C   LW A1, 28(S3)
9D023924  28B80003   SLTI T8, A1, 3
9D023928  17000006   BNE T8, ZERO, 0x9D023944
9D02392C  3C1F9D04   LUI RA, -25340
101:                    {
102:                       log_printf("too many VRAM banks: %d\n", state->rominfo->vram_banks);
9D023930  27E4FE38   ADDIU A0, RA, -456
9D023934  0F410817   JAL log_printf
9D023938  00000000   NOP
103:                       return -1;
104:                    }
105:                 
106:                    snssFile->vramBlock.vramSize = VRAM_8K * state->rominfo->vram_banks;
9D023944  00056340   SLL T4, A1, 13
9D023948  3186FFFF   ANDI A2, T4, -1
9D02394C  A6261946   SH A2, 6470(S1)
107:                 
108:                    memcpy(snssFile->vramBlock.vram, state->rominfo->vram, snssFile->vramBlock.vramSize);
9D023950  8E0E0310   LW T6, 784(S0)
9D023954  26241948   ADDIU A0, S1, 6472
9D023958  0F40F256   JAL .Letext0, .LFE1, memcpy
9D02395C  8DC5000C   LW A1, 12(T6)
109:                    return 0;
110:                 }
111:                 
112:                 static int save_sramblock(nes_t *state, SNSS_FILE *snssFile)
113:                 {
114:                    int i;
115:                    bool written = false;
116:                    int sram_length;
117:                 
118:                    ASSERT(state);
119:                 
120:                    sram_length = state->rominfo->sram_banks * SRAM_1K;
9D023978  8E0D0310   LW T5, 784(S0)
9D02397C  8DA50018   LW A1, 24(T5)
9D023980  00054A80   SLL T1, A1, 10
121:                 
122:                    /* Check to see if any SRAM was written to */
123:                    for (i = 0; i < sram_length; i++)
9D023984  19200026   BLEZ T1, .LBB30
9D023988  8FB20010   LW S2, 16(SP)
9D0239CC  144AFFFA   BNE V0, T2, 0x9D0239B8
9D0239D0  24420001   ADDIU V0, V0, 1
124:                    {
125:                       if (state->rominfo->sram[i])
9D02398C  8DA70008   LW A3, 8(T5)
9D023990  90F20000   LBU S2, 0(A3)
9D023994  164000C8   BNE S2, ZERO, 0x9D023CB8
9D023998  24E20001   ADDIU V0, A3, 1
9D02399C  00E95021   ADDU T2, A3, T1
9D0239A0  01421823   SUBU V1, T2, V0
9D0239A4  30790007   ANDI T9, V1, 7
9D0239A8  572000D6   BNEL T9, ZERO, 0x9D023D04
9D0239AC  24420001   ADDIU V0, V0, 1
9D0239B0  0B408E73   J 0x9D0239CC
9D0239B4  00000000   NOP
9D0239B8  9047FFFF   LBU A3, -1(V0)
9D0239BC  50E000F5   BEQL A3, ZERO, 0x9D023D94
9D0239C0  90520000   LBU S2, 0(V0)
9D023D04  904FFFFF   LBU T7, -1(V0)
9D023D08  15E0FFEB   BNE T7, ZERO, 0x9D023CB8
9D023D0C  24080001   ADDIU T0, ZERO, 1
9D023D10  1328FF2E   BEQ T9, T0, 0x9D0239CC
9D023D14  240B0002   ADDIU T3, ZERO, 2
9D023D18  132B0018   BEQ T9, T3, 0x9D023D7C
9D023D1C  24140003   ADDIU S4, ZERO, 3
9D023D20  13340013   BEQ T9, S4, 0x9D023D70
9D023D24  24060004   ADDIU A2, ZERO, 4
9D023D28  1326000E   BEQ T9, A2, 0x9D023D64
9D023D2C  24110005   ADDIU S1, ZERO, 5
9D023D30  13310009   BEQ T9, S1, 0x9D023D58
9D023D34  24130006   ADDIU S3, ZERO, 6
9D023D38  53330005   BEQL T9, S3, 0x9D023D50
9D023D3C  904C0000   LBU T4, 0(V0)
9D023D40  90580000   LBU T8, 0(V0)
9D023D44  1700FFDC   BNE T8, ZERO, 0x9D023CB8
9D023D48  24420001   ADDIU V0, V0, 1
9D023D4C  904C0000   LBU T4, 0(V0)
9D023D50  1580FFD9   BNE T4, ZERO, 0x9D023CB8
9D023D54  24420001   ADDIU V0, V0, 1
9D023D58  904E0000   LBU T6, 0(V0)
9D023D5C  15C0FFD6   BNE T6, ZERO, 0x9D023CB8
9D023D60  24420001   ADDIU V0, V0, 1
9D023D64  905F0000   LBU RA, 0(V0)
9D023D68  17E0FFD3   BNE RA, ZERO, 0x9D023CB8
9D023D6C  24420001   ADDIU V0, V0, 1
9D023D70  904D0000   LBU T5, 0(V0)
9D023D74  15A0FFD0   BNE T5, ZERO, 0x9D023CB8
9D023D78  24420001   ADDIU V0, V0, 1
9D023D7C  24420001   ADDIU V0, V0, 1
9D023D80  9049FFFF   LBU T1, -1(V0)
9D023D84  1120FF11   BEQ T1, ZERO, 0x9D0239CC
9D023D88  00000000   NOP
9D023D94  5640FFC9   BNEL S2, ZERO, 0x9D023CBC
9D023D98  28AA0009   SLTI T2, A1, 9
9D023D9C  90430001   LBU V1, 1(V0)
9D023DA0  5460FFC6   BNEL V1, ZERO, 0x9D023CBC
9D023DA4  28AA0009   SLTI T2, A1, 9
9D023DA8  90590002   LBU T9, 2(V0)
9D023DAC  5720FFC3   BNEL T9, ZERO, 0x9D023CBC
9D023DB0  28AA0009   SLTI T2, A1, 9
9D023DB4  904F0003   LBU T7, 3(V0)
9D023DB8  55E0FFC0   BNEL T7, ZERO, 0x9D023CBC
9D023DBC  28AA0009   SLTI T2, A1, 9
9D023DC0  90480004   LBU T0, 4(V0)
9D023DC4  5500FFBD   BNEL T0, ZERO, 0x9D023CBC
9D023DC8  28AA0009   SLTI T2, A1, 9
9D023DCC  904B0005   LBU T3, 5(V0)
9D023DD0  1560FFB9   BNE T3, ZERO, 0x9D023CB8
9D023DD4  24420007   ADDIU V0, V0, 7
9D023DD8  9054FFFF   LBU S4, -1(V0)
9D023DDC  1280FEFB   BEQ S4, ZERO, 0x9D0239CC
9D023DE0  00000000   NOP
126:                       {
127:                          written = true;
128:                          break;
129:                       }
130:                    }
131:                 
132:                    if (false == written)
133:                       return -1;
134:                 
135:                    if (state->rominfo->sram_banks > 8)
9D0239C4  0B408F2F   J 0x9D023CBC
9D0239C8  28AA0009   SLTI T2, A1, 9
9D023CB8  28AA0009   SLTI T2, A1, 9
9D023CBC  5540FF4B   BNEL T2, ZERO, 0x9D0239EC
9D023CC0  00052A80   SLL A1, A1, 10
9D023D8C  0B408F2F   J 0x9D023CBC
9D023D90  28AA0009   SLTI T2, A1, 9
9D023DE4  0B408F2F   J 0x9D023CBC
9D023DE8  28AA0009   SLTI T2, A1, 9
136:                    {
137:                       log_printf("Unsupported number of SRAM banks: %d\n", state->rominfo->sram_banks);
9D0239DC  0F410817   JAL log_printf
9D0239E0  24C4FE54   ADDIU A0, A2, -428
9D023CC4  0B408E77   J 0x9D0239DC
9D023CC8  3C069D04   LUI A2, -25340
138:                       return -1;
139:                    }
140:                 
141:                    snssFile->sramBlock.sramSize = SRAM_1K * state->rominfo->sram_banks;
9D0239EC  30A6FFFF   ANDI A2, A1, -1
9D0239F0  A4865948   SH A2, 22856(A0)
142:                 
143:                    /* TODO: this should not always be true!! */
144:                    snssFile->sramBlock.sramEnabled = true;
9D0239F4  24110001   ADDIU S1, ZERO, 1
9D0239F8  A091594A   SB S1, 22858(A0)
145:                 
146:                    memcpy(snssFile->sramBlock.sram, state->rominfo->sram, snssFile->sramBlock.sramSize);
9D0239FC  8E130310   LW S3, 784(S0)
9D023A00  2484594B   ADDIU A0, A0, 22859
9D023A04  0F40F256   JAL .Letext0, .LFE1, memcpy
9D023A08  8E650008   LW A1, 8(S3)
147:                 
148:                    return 0;
149:                 }
150:                 
151:                 static int save_soundblock(nes_t *state, SNSS_FILE *snssFile)
152:                 {
153:                    ASSERT(state);
154:                 
155:                    apu_getcontext(state->apu);
9D023A20  0F407DCC   JAL apu_getcontext
156:                 
157:                    /* rect 0 */
158:                    snssFile->soundBlock.soundRegisters[0x00] = state->apu->rectangle[0].regs[0];
9D023A28  8E180308   LW T8, 776(S0)
159:                    snssFile->soundBlock.soundRegisters[0x01] = state->apu->rectangle[0].regs[1];
9D023A34  8E0E0308   LW T6, 776(S0)
160:                    snssFile->soundBlock.soundRegisters[0x02] = state->apu->rectangle[0].regs[2];
9D023A40  8E090308   LW T1, 776(S0)
161:                    snssFile->soundBlock.soundRegisters[0x03] = state->apu->rectangle[0].regs[3];
9D023A4C  8E070308   LW A3, 776(S0)
162:                    /* rect 1 */
163:                    snssFile->soundBlock.soundRegisters[0x04] = state->apu->rectangle[1].regs[0];
9D023A58  8E190308   LW T9, 776(S0)
164:                    snssFile->soundBlock.soundRegisters[0x05] = state->apu->rectangle[1].regs[1];
9D023A64  8E080308   LW T0, 776(S0)
165:                    snssFile->soundBlock.soundRegisters[0x06] = state->apu->rectangle[1].regs[2];
9D023A70  8E020308   LW V0, 776(S0)
166:                    snssFile->soundBlock.soundRegisters[0x07] = state->apu->rectangle[1].regs[3];
9D023A7C  8E0A0308   LW T2, 776(S0)
167:                    /* triangle */
168:                    snssFile->soundBlock.soundRegisters[0x08] = state->apu->triangle.regs[0];
9D023A88  8E110308   LW S1, 776(S0)
169:                    snssFile->soundBlock.soundRegisters[0x0A] = state->apu->triangle.regs[1];
9D023A94  8E060308   LW A2, 776(S0)
170:                    snssFile->soundBlock.soundRegisters[0x0B] = state->apu->triangle.regs[2];
9D023AA0  8E0C0308   LW T4, 776(S0)
171:                    /* noise */
172:                    snssFile->soundBlock.soundRegisters[0X0C] = state->apu->noise.regs[0];
9D023AAC  8E0D0308   LW T5, 776(S0)
173:                    snssFile->soundBlock.soundRegisters[0X0E] = state->apu->noise.regs[1];
9D023AB8  8E040308   LW A0, 776(S0)
174:                    snssFile->soundBlock.soundRegisters[0x0F] = state->apu->noise.regs[2];
9D023AC4  8E030308   LW V1, 776(S0)
175:                    /* dmc */
176:                    snssFile->soundBlock.soundRegisters[0x10] = state->apu->dmc.regs[0];
9D023AD0  8E0F0308   LW T7, 776(S0)
177:                    snssFile->soundBlock.soundRegisters[0x11] = state->apu->dmc.regs[1];
9D023ADC  8E0B0308   LW T3, 776(S0)
178:                    snssFile->soundBlock.soundRegisters[0x12] = state->apu->dmc.regs[2];
9D023AE8  8E140308   LW S4, 776(S0)
179:                    snssFile->soundBlock.soundRegisters[0x13] = state->apu->dmc.regs[3];
9D023AF4  8E050308   LW A1, 776(S0)
180:                    /* control */
181:                    snssFile->soundBlock.soundRegisters[0x15] = state->apu->enable_reg;
9D023B00  8E130308   LW S3, 776(S0)
182:                 
183:                    return 0;
184:                 }
185:                 
186:                 static int save_mapperblock(nes_t *state, SNSS_FILE *snssFile)
187:                 {
188:                    int i;
189:                    ASSERT(state);
190:                 
191:                    mmc_getcontext(state->mmc);
9D023B20  0F40CA11   JAL mmc_getcontext
9D023B24  8E04030C   LW A0, 780(S0)
192:                 
193:                    /* TODO: filthy hack in snss standard */
194:                    /* We don't need to write mapper state for mapper 0 */
195:                    if (0 == state->mmc->intf->number)
9D023B28  8E12030C   LW S2, 780(S0)
9D023B2C  8E580000   LW T8, 0(S2)
9D023B30  8F0C0000   LW T4, 0(T8)
9D023B34  1180004B   BEQ T4, ZERO, 0x9D023C64
9D023B38  00000000   NOP
196:                       return -1;
197:                 
198:                    nes6502_getcontext(state->cpu);
9D023B3C  0F403159   JAL nes6502_getcontext
9D023B40  8E040000   LW A0, 0(S0)
199:                 
200:                    /* TODO: snss spec should be updated, using 4kB ROM pages.. */
201:                    for (i = 0; i < 4; i++)
202:                       snssFile->mapperBlock.prgPages[i] = (state->cpu->mem_page[(i + 4) * 2] - state->rominfo->rom) >> 13;
9D023B44  8E0E0000   LW T6, 0(S0)
9D023B48  8E0D0310   LW T5, 784(S0)
9D023B4C  8DC90020   LW T1, 32(T6)
9D023B50  8DA40000   LW A0, 0(T5)
9D023B54  01243823   SUBU A3, T1, A0
9D023B58  00071B43   SRA V1, A3, 13
9D023B5C  A663794C   SH V1, 31052(S3)
9D023B60  8E190000   LW T9, 0(S0)
9D023B64  8E0F0310   LW T7, 784(S0)
9D023B68  8F280028   LW T0, 40(T9)
9D023B6C  8DEB0000   LW T3, 0(T7)
9D023B70  010B1023   SUBU V0, T0, T3
9D023B74  0002A343   SRA S4, V0, 13
9D023B78  A674794E   SH S4, 31054(S3)
9D023B7C  8E0A0000   LW T2, 0(S0)
9D023B80  8E050310   LW A1, 784(S0)
9D023B84  8D510030   LW S1, 48(T2)
9D023B88  8CA60000   LW A2, 0(A1)
9D023B8C  02269023   SUBU S2, S1, A2
9D023B90  0012C343   SRA T8, S2, 13
9D023B94  A6787950   SH T8, 31056(S3)
9D023B98  8E0C0000   LW T4, 0(S0)
9D023B9C  8E0E0310   LW T6, 784(S0)
9D023BA0  8D8D0038   LW T5, 56(T4)
9D023BA4  8DC90000   LW T1, 0(T6)
9D023BA8  01A92023   SUBU A0, T5, T1
9D023BAC  00043B43   SRA A3, A0, 13
9D023BB0  A6677952   SH A3, 31058(S3)
203:                 
204:                    if (state->rominfo->vrom_banks)
9D023BB4  8E030310   LW V1, 784(S0)
9D023BB8  8C790014   LW T9, 20(V1)
9D023BBC  53200012   BEQL T9, ZERO, 0x9D023C08
9D023BC0  A6607954   SH ZERO, 31060(S3)
9D023BC4  02609021   ADDU S2, S3, ZERO
9D023BC8  00008821   ADDU S1, ZERO, ZERO
205:                    {
206:                       for (i = 0; i < 8; i++)
9D023BCC  24140008   ADDIU S4, ZERO, 8
9D023BF4  26310001   ADDIU S1, S1, 1
9D023BF8  1634FFF5   BNE S1, S4, 0x9D023BD0
9D023BFC  26520002   ADDIU S2, S2, 2
207:                          snssFile->mapperBlock.chrPages[i] = (ppu_getpage(i) - state->rominfo->vrom + (i * 0x400)) >> 10;
9D023BD0  0F405918   JAL ppu_getpage
9D023BD4  02202021   ADDU A0, S1, ZERO
9D023BD8  8E050310   LW A1, 784(S0)
9D023BDC  8CA60004   LW A2, 4(A1)
9D023BE0  0046C023   SUBU T8, V0, A2
9D023BE4  00116280   SLL T4, S1, 10
9D023BE8  030C7021   ADDU T6, T8, T4
9D023BEC  000E6A83   SRA T5, T6, 10
9D023BF0  A64D7954   SH T5, 31060(S2)
208:                    }
209:                    else
210:                    {
211:                       /* bleh! slight hack */
212:                       for (i = 0; i < 8; i++)
213:                          snssFile->mapperBlock.chrPages[i] = i;
9D023C08  241F0001   ADDIU RA, ZERO, 1
9D023C0C  A67F7956   SH RA, 31062(S3)
9D023C10  240F0002   ADDIU T7, ZERO, 2
9D023C14  A66F7958   SH T7, 31064(S3)
9D023C18  24080003   ADDIU T0, ZERO, 3
9D023C1C  A668795A   SH T0, 31066(S3)
9D023C20  240B0004   ADDIU T3, ZERO, 4
9D023C24  A66B795C   SH T3, 31068(S3)
9D023C28  24020005   ADDIU V0, ZERO, 5
9D023C2C  A662795E   SH V0, 31070(S3)
9D023C30  24140006   ADDIU S4, ZERO, 6
9D023C34  A6747960   SH S4, 31072(S3)
9D023C38  240A0007   ADDIU T2, ZERO, 7
9D023C3C  A66A7962   SH T2, 31074(S3)
214:                    }
215:                 
216:                    if (state->mmc->intf->get_state)
9D023C00  0B408F11   J 0x9D023C44
9D023C04  8E10030C   LW S0, 780(S0)
9D023C40  8E10030C   LW S0, 780(S0)
9D023C44  8E090000   LW T1, 0(S0)
9D023C48  8D270014   LW A3, 20(T1)
9D023C4C  50E0001F   BEQL A3, ZERO, 0x9D023CCC
9D023C50  8FA40010   LW A0, 16(SP)
217:                       state->mmc->intf->get_state(&snssFile->mapperBlock);
9D023C54  00E0F809   JALR A3
9D023C58  2664794C   ADDIU A0, S3, 31052
218:                 
219:                    return 0;
220:                 }
221:                 
222:                 static void load_baseblock(nes_t *state, SNSS_FILE *snssFile)
223:                 {
224:                    int i;
225:                    
226:                    ASSERT(state);
227:                 
228:                    nes6502_getcontext(state->cpu);
9D023ED8  0F403159   JAL nes6502_getcontext
229:                    ppu_getcontext(state->ppu);
9D023EE0  0F405812   JAL ppu_getcontext
230:                 
231:                    state->cpu->a_reg = snssFile->baseBlock.regA;
9D023EE8  8E270000   LW A3, 0(S1)
232:                    state->cpu->x_reg = snssFile->baseBlock.regX;
9D023EF4  8E290000   LW T1, 0(S1)
233:                    state->cpu->y_reg = snssFile->baseBlock.regY;
9D023F00  8E2B0000   LW T3, 0(S1)
234:                    state->cpu->p_reg = snssFile->baseBlock.regFlags;
9D023F0C  8E2D0000   LW T5, 0(S1)
235:                    state->cpu->s_reg = snssFile->baseBlock.regStack;
9D023F18  8E2F0000   LW T7, 0(S1)
236:                    state->cpu->pc_reg = snssFile->baseBlock.regPc;
9D023F24  8E390000   LW T9, 0(S1)
237:                 
238:                    state->ppu->ctrl0 = snssFile->baseBlock.reg2000;
9D023F30  8E240304   LW A0, 772(S1)
239:                    state->ppu->ctrl1 = snssFile->baseBlock.reg2001;
9D023F3C  8E300304   LW S0, 772(S1)
240:                 
241:                    memcpy(state->cpu->mem_page[0], snssFile->baseBlock.cpuRam, 0x800);
9D023F48  8E320000   LW S2, 0(S1)
242:                    memcpy(state->ppu->oam, snssFile->baseBlock.spriteRam, 0x100);
9D02407C  8E270304   LW A3, 772(S1)
243:                    memcpy(state->ppu->nametab, snssFile->baseBlock.ppuRam, 0x1000);
9D0241B0  2667091E   ADDIU A3, S3, 2334
244:                    memcpy(state->ppu->palette, snssFile->baseBlock.palette, 0x20);
9D0242E0  8E2E0304   LW T6, 772(S1)
245:                 
246:                    /* TODO: argh, this is to handle nofrendo's filthy sprite priority method */
247:                    for (i = 0; i < 8; i++)
248:                       state->ppu->palette[i << 2] = state->ppu->palette[0] | 0x80;//BG_TRANS_MASK;
9D02436C  8E320304   LW S2, 772(S1)
249:                 
250:                    for (i = 0; i < 4; i++)
251:                    {
252:                       state->ppu->page[i + 8] = state->ppu->page[i + 12] =
9D024404  AC5F1150   SW RA, 4432(V0)
9D024420  AD391154   SW T9, 4436(T1)
9D02443C  AD8D1158   SW T5, 4440(T4)
9D024458  AD42115C   SW V0, 4444(T2)
253:                          state->ppu->nametab + (snssFile->baseBlock.mirrorState[i] * 0x400) - (0x2000 + (i * 0x400));
9D0243F0  8E220304   LW V0, 772(S1)
9D02440C  8E290304   LW T1, 772(S1)
9D024428  8E2C0304   LW T4, 772(S1)
9D024444  8E2A0304   LW T2, 772(S1)
254:                    }
255:                 
256:                    state->ppu->vaddr = snssFile->baseBlock.vramAddress;
9D024460  8E2E0304   LW T6, 772(S1)
257:                    state->ppu->oam_addr = snssFile->baseBlock.spriteRamAddress;
9D02446C  8E3F0304   LW RA, 772(S1)
258:                    state->ppu->tile_xofs = snssFile->baseBlock.tileXOffset;
9D024478  8E290304   LW T1, 772(S1)
259:                 
260:                    /* do some extra handling */
261:                    state->ppu->flipflop = 0;
9D024484  8E280304   LW T0, 772(S1)
262:                    state->ppu->strikeflag = false;
9D02448C  8E380304   LW T8, 772(S1)
263:                 
264:                    nes6502_setcontext(state->cpu);
9D024494  0F4030B1   JAL nes6502_setcontext
265:                    ppu_setcontext(state->ppu);
9D02449C  0F405782   JAL ppu_setcontext
266:                 
267:                    ppu_write(PPU_CTRL0, state->ppu->ctrl0);
9D0244A4  8E260304   LW A2, 772(S1)
268:                    ppu_write(PPU_CTRL1, state->ppu->ctrl1);
9D0244B4  8E390304   LW T9, 772(S1)
269:                    ppu_write(PPU_VADDR, (uint8) (state->ppu->vaddr >> 8));
9D0244C4  8E2C0304   LW T4, 772(S1)
270:                    ppu_write(PPU_VADDR, (uint8) (state->ppu->vaddr & 0xFF));
9D0244D4  8E300304   LW S0, 772(S1)
9D0244D8  24042006   ADDIU A0, ZERO, 8198
9D0244DC  0F405A62   JAL ppu_write
9D0244E0  92051164   LBU A1, 4452(S0)
271:                 }
272:                 
273:                 static void load_vramblock(nes_t *state, SNSS_FILE *snssFile)
274:                 {
275:                    ASSERT(state);
276:                 
277:                    ASSERT(snssFile->vramBlock.vramSize <= VRAM_8K); /* can't handle more than this! */
278:                    memcpy(state->rominfo->vram, snssFile->vramBlock.vram, snssFile->vramBlock.vramSize);
9D0244F0  8E250310   LW A1, 784(S1)
9D0244F4  8CA4000C   LW A0, 12(A1)
9D0244F8  26451948   ADDIU A1, S2, 6472
9D0244FC  0F40F256   JAL .Letext0, .LFE1, memcpy
9D024500  96461946   LHU A2, 6470(S2)
279:                 }
280:                 
281:                 static void load_sramblock(nes_t *state, SNSS_FILE *snssFile)
282:                 {
283:                    ASSERT(state);
284:                 
285:                    ASSERT(snssFile->sramBlock.sramSize <= SRAM_8K); /* can't handle more than this! */
286:                    memcpy(state->rominfo->sram, snssFile->sramBlock.sram, snssFile->sramBlock.sramSize);
9D024510  8E260310   LW A2, 784(S1)
9D024514  8CC40008   LW A0, 8(A2)
9D024518  2605594B   ADDIU A1, S0, 22859
9D02451C  0F40F256   JAL .Letext0, .LFE1, memcpy
9D024520  96065948   LHU A2, 22856(S0)
287:                 }
288:                 
289:                 static void load_controllerblock(nes_t *state, SNSS_FILE *snssFile)
290:                 {
291:                    UNUSED(state);
292:                    UNUSED(snssFile);
293:                 }
294:                 
295:                 static void load_soundblock(nes_t *state, SNSS_FILE *snssFile)
296:                 {
297:                    int i;
298:                 
299:                    ASSERT(state);
300:                 
301:                    for (i = 0; i < 0x15; i++)
9D024748  2A040015   SLTI A0, S0, 21
302:                    {
303:                       if (i != 0x13) /* do NOT trigger OAM DMA! */
9D024728  0B4091CD   J .LBB60, .LBB61
9D02472C  24120014   ADDIU S2, ZERO, 20
9D024730  26100001   ADDIU S0, S0, 1
9D024734  1212FFFE   BEQ S0, S2, 0x9D024730
9D024738  02706821   ADDU T5, S3, S0
304:                          apu_write(0x4000 + i, snssFile->soundBlock.soundRegisters[i]);
9D02473C  26043FFF   ADDIU A0, S0, 16383
9D024740  0F407E2F   JAL apu_write
9D024744  91A579E4   LBU A1, 31204(T5)
9D024748  2A040015   SLTI A0, S0, 21
9D02474C  5480FFF9   BNEL A0, ZERO, .LBB60, .LBB61
9D024750  26100001   ADDIU S0, S0, 1
305:                    }
306:                 }
307:                 
308:                 /* TODO: magic numbers galore */
309:                 static void load_mapperblock(nes_t *state, SNSS_FILE *snssFile)
310:                 {
311:                    int i;
312:                    
313:                    ASSERT(state);
314:                 
315:                    mmc_getcontext(state->mmc);
9D024530  0F40CA11   JAL mmc_getcontext
9D024534  8E24030C   LW A0, 780(S1)
9D024538  34138000   ORI S3, ZERO, -32768
316:                 
317:                    for (i = 0; i < 4; i++)
318:                       mmc_bankrom(8, 0x8000 + (i * 0x2000), snssFile->mapperBlock.prgPages[i]);
9D02453C  24040008   ADDIU A0, ZERO, 8
9D024540  02602821   ADDU A1, S3, ZERO
9D024544  0F40CA71   JAL mmc_bankrom
9D024548  9606794C   LHU A2, 31052(S0)
9D02454C  26732000   ADDIU S3, S3, 8192
9D024550  24040008   ADDIU A0, ZERO, 8
9D024554  02602821   ADDU A1, S3, ZERO
9D024558  0F40CA71   JAL mmc_bankrom
9D02455C  9606794E   LHU A2, 31054(S0)
9D024560  24040008   ADDIU A0, ZERO, 8
9D024564  26652000   ADDIU A1, S3, 8192
9D024568  0F40CA71   JAL mmc_bankrom
9D02456C  96067950   LHU A2, 31056(S0)
9D024570  24040008   ADDIU A0, ZERO, 8
9D024574  26654000   ADDIU A1, S3, 16384
9D024578  0F40CA71   JAL mmc_bankrom
9D02457C  96067952   LHU A2, 31058(S0)
319:                 
320:                    if (state->rominfo->vrom_banks)
9D024580  8E2B0310   LW T3, 784(S1)
9D024584  8D6C0014   LW T4, 20(T3)
9D024588  11800031   BEQ T4, ZERO, 0x9D024650
9D02458C  00009021   ADDU S2, ZERO, ZERO
321:                    {
322:                       for (i = 0; i < 8; i++)
323:                          mmc_bankvrom(1, i * 0x400, snssFile->mapperBlock.chrPages[i]);
9D024590  24040001   ADDIU A0, ZERO, 1
9D024594  00002821   ADDU A1, ZERO, ZERO
9D024598  0F40CA16   JAL mmc_bankvrom
9D02459C  96067954   LHU A2, 31060(S0)
9D0245A0  24120002   ADDIU S2, ZERO, 2
9D0245A4  02123821   ADDU A3, S0, S2
9D0245A8  24040001   ADDIU A0, ZERO, 1
9D0245AC  00122A40   SLL A1, S2, 9
9D0245B0  0F40CA16   JAL mmc_bankvrom
9D0245B4  94E67954   LHU A2, 31060(A3)
9D0245B8  26480002   ADDIU T0, S2, 2
9D0245BC  02084821   ADDU T1, S0, T0
9D0245C0  24040001   ADDIU A0, ZERO, 1
9D0245C4  00082A40   SLL A1, T0, 9
9D0245C8  0F40CA16   JAL mmc_bankvrom
9D0245CC  95267954   LHU A2, 31060(T1)
9D0245D0  264A0004   ADDIU T2, S2, 4
9D0245D4  020A5821   ADDU T3, S0, T2
9D0245D8  24040001   ADDIU A0, ZERO, 1
9D0245DC  000A2A40   SLL A1, T2, 9
9D0245E0  0F40CA16   JAL mmc_bankvrom
9D0245E4  95667954   LHU A2, 31060(T3)
9D0245E8  264C0006   ADDIU T4, S2, 6
9D0245EC  020C6821   ADDU T5, S0, T4
9D0245F0  24040001   ADDIU A0, ZERO, 1
9D0245F4  000C2A40   SLL A1, T4, 9
9D0245F8  0F40CA16   JAL mmc_bankvrom
9D0245FC  95A67954   LHU A2, 31060(T5)
9D024600  26530008   ADDIU S3, S2, 8
9D024604  02137021   ADDU T6, S0, S3
9D024608  24040001   ADDIU A0, ZERO, 1
9D02460C  00132A40   SLL A1, S3, 9
9D024610  0F40CA16   JAL mmc_bankvrom
9D024614  95C67954   LHU A2, 31060(T6)
9D024618  264F000A   ADDIU T7, S2, 10
9D02461C  020FC021   ADDU T8, S0, T7
9D024620  24040001   ADDIU A0, ZERO, 1
9D024624  000F2A40   SLL A1, T7, 9
9D024628  0F40CA16   JAL mmc_bankvrom
9D02462C  97067954   LHU A2, 31060(T8)
9D024630  2659000C   ADDIU T9, S2, 12
9D024634  02191021   ADDU V0, S0, T9
9D024638  24040001   ADDIU A0, ZERO, 1
9D02463C  00192A40   SLL A1, T9, 9
9D024640  0F40CA16   JAL mmc_bankvrom
9D024644  94467954   LHU A2, 31060(V0)
324:                    }
325:                    else
326:                    {
327:                       ASSERT(state->rominfo->vram);
328:                 
329:                       for (i = 0; i < 8; i++)
9D024664  26530001   ADDIU S3, S2, 1
330:                          ppu_setpage(1, i, state->rominfo->vram);
9D024650  8E2D0310   LW T5, 784(S1)
9D024654  24040001   ADDIU A0, ZERO, 1
9D024658  02402821   ADDU A1, S2, ZERO
9D02465C  0F4058B3   JAL ppu_setpage
9D024660  8DA6000C   LW A2, 12(T5)
9D024668  8E2E0310   LW T6, 784(S1)
9D02466C  24040001   ADDIU A0, ZERO, 1
9D024670  02602821   ADDU A1, S3, ZERO
9D024674  0F4058B3   JAL ppu_setpage
9D024678  8DC6000C   LW A2, 12(T6)
9D02467C  8E2F0310   LW T7, 784(S1)
9D024680  24040001   ADDIU A0, ZERO, 1
9D024684  26650001   ADDIU A1, S3, 1
9D024688  0F4058B3   JAL ppu_setpage
9D02468C  8DE6000C   LW A2, 12(T7)
9D024690  8E380310   LW T8, 784(S1)
9D024694  24040001   ADDIU A0, ZERO, 1
9D024698  26650002   ADDIU A1, S3, 2
9D02469C  0F4058B3   JAL ppu_setpage
9D0246A0  8F06000C   LW A2, 12(T8)
9D0246A4  8E390310   LW T9, 784(S1)
9D0246A8  24040001   ADDIU A0, ZERO, 1
9D0246AC  26650003   ADDIU A1, S3, 3
9D0246B0  0F4058B3   JAL ppu_setpage
9D0246B4  8F26000C   LW A2, 12(T9)
9D0246B8  8E220310   LW V0, 784(S1)
9D0246BC  24040001   ADDIU A0, ZERO, 1
9D0246C0  26650004   ADDIU A1, S3, 4
9D0246C4  0F4058B3   JAL ppu_setpage
9D0246C8  8C46000C   LW A2, 12(V0)
9D0246CC  8E230310   LW V1, 784(S1)
9D0246D0  24040001   ADDIU A0, ZERO, 1
9D0246D4  26650005   ADDIU A1, S3, 5
9D0246D8  0F4058B3   JAL ppu_setpage
9D0246DC  8C66000C   LW A2, 12(V1)
9D0246E0  8E260310   LW A2, 784(S1)
9D0246E4  24040001   ADDIU A0, ZERO, 1
9D0246E8  26650006   ADDIU A1, S3, 6
9D0246EC  0F4058B3   JAL ppu_setpage
9D0246F0  8CC6000C   LW A2, 12(A2)
331:                    }
332:                 
333:                    if (state->mmc->intf->set_state)
9D024648  0B4091BE   J 0x9D0246F8
9D02464C  8E3F030C   LW RA, 780(S1)
9D0246F4  8E3F030C   LW RA, 780(S1)
9D0246F8  8FE40000   LW A0, 0(RA)
9D0246FC  8C830018   LW V1, 24(A0)
9D024700  10600003   BEQ V1, ZERO, .LVL137
9D024704  00000000   NOP
334:                       state->mmc->intf->set_state(&snssFile->mapperBlock);
9D024708  0060F809   JALR V1
9D02470C  2604794C   ADDIU A0, S0, 31052
335:                 
336:                    mmc_setcontext(state->mmc);
9D024710  0F40CA0C   JAL mmc_setcontext
9D024714  8E24030C   LW A0, 780(S1)
337:                 }
338:                 
339:                 
340:                 int state_save(void)
341:                 {
9D0232F0  27BDFDC8   ADDIU SP, SP, -568
9D0232F4  AFBF0234   SW RA, 564(SP)
9D0232F8  AFB40230   SW S4, 560(SP)
9D0232FC  AFB3022C   SW S3, 556(SP)
9D023300  AFB20228   SW S2, 552(SP)
9D023304  AFB10224   SW S1, 548(SP)
342:                    SNSS_FILE *snssFile;
343:                    SNSS_RETURN_CODE status;
344:                    char fn[PATH_MAX + 1], ext[5];
345:                    nes_t *machine;
346:                 
347:                    /* get the pointer to our NES machine context */
348:                    machine = nes_getcontextptr();
9D023308  0F4097E7   JAL nes_getcontextptr
9D02330C  AFB00220   SW S0, 544(SP)
9D023310  00408021   ADDU S0, V0, ZERO
349:                    ASSERT(machine);
350:                    
351:                    /* build our filename using the image's name and the slot number */
352:                    strncpy(fn, machine->rominfo->filename, PATH_MAX - 4);
9D023314  8C450310   LW A1, 784(V0)
9D023318  27A40014   ADDIU A0, SP, 20
9D02331C  24A50029   ADDIU A1, A1, 41
9D023320  0F40FA4F   JAL .LFE23, strncpy
9D023324  240601FC   ADDIU A2, ZERO, 508
353:                    
354:                    ASSERT(state_slot >= FIRST_STATE_SLOT && state_slot <= LAST_STATE_SLOT);
355:                    sprintf(ext, ".ss%d", state_slot);
9D023328  27A40218   ADDIU A0, SP, 536
9D02332C  3C029D04   LUI V0, -25340
9D023330  2445FE30   ADDIU A1, V0, -464
9D023334  0F4104E0   JAL _sprintf_cdnopuxX, _sprintf_cdnopsuxX
9D023338  8F8680DC   LW A2, -32548(GP)
356:                    //osd_newextension(fn, ext);
357:                 
358:                    /* open our state file for writing */
359:                    status = SNSS_OpenFile(&snssFile, fn, SNSS_OPEN_WRITE);
9D02333C  27A40010   ADDIU A0, SP, 16
9D023340  27A50014   ADDIU A1, SP, 20
9D023344  0F408A19   JAL SNSS_OpenFile
9D023348  24060001   ADDIU A2, ZERO, 1
360:                    if (SNSS_OK != status)
9D02334C  1440024F   BNE V0, ZERO, .L6
9D023350  8FB10010   LW S1, 16(SP)
361:                       goto _error;
362:                 
363:                    /* now get all of our blocks */
364:                    if (0 == save_baseblock(machine, snssFile))
365:                    {
366:                       status = SNSS_WriteBlock(snssFile, SNSS_BASR);
9D0238FC  8FA40010   LW A0, 16(SP)
9D023900  0F408BCC   JAL SNSS_WriteBlock
9D023904  00002821   ADDU A1, ZERO, ZERO
367:                       if (SNSS_OK != status)
9D023908  144000E0   BNE V0, ZERO, .L6
9D02390C  00000000   NOP
368:                          goto _error;
369:                    }
370:                 
371:                    if (0 == save_vramblock(machine, snssFile))
372:                    {
373:                       status = SNSS_WriteBlock(snssFile, SNSS_VRAM);
9D023960  8FA40010   LW A0, 16(SP)
9D023964  0F408BCC   JAL SNSS_WriteBlock
9D023968  24050001   ADDIU A1, ZERO, 1
374:                       if (SNSS_OK != status)
9D02396C  144000C7   BNE V0, ZERO, .L6
9D023970  00000000   NOP
375:                          goto _error;
376:                    }
377:                 
378:                    if (0 == save_sramblock(machine, snssFile))
9D02393C  0B408E5E   J .LBB18
9D023940  8FA40010   LW A0, 16(SP)
9D023974  8FA40010   LW A0, 16(SP)
379:                    {
380:                       status = SNSS_WriteBlock(snssFile, SNSS_SRAM);
9D023A0C  8FA40010   LW A0, 16(SP)
9D023A10  0F408BCC   JAL SNSS_WriteBlock
9D023A14  24050002   ADDIU A1, ZERO, 2
381:                       if (SNSS_OK != status)
9D023A18  1440009C   BNE V0, ZERO, .L6
9D023A1C  8FB20010   LW S2, 16(SP)
382:                          goto _error;
383:                    }
384:                 
385:                    if (0 == save_soundblock(machine, snssFile))
9D0239D4  0B408E88   J .LBB30
9D0239D8  8FB20010   LW S2, 16(SP)
9D0239E4  0B408E88   J .LBB30
9D0239E8  8FB20010   LW S2, 16(SP)
386:                    {
387:                       status = SNSS_WriteBlock(snssFile, SNSS_SOUN);
9D023B0C  8FA40010   LW A0, 16(SP)
9D023B10  0F408BCC   JAL SNSS_WriteBlock
9D023B14  24050005   ADDIU A1, ZERO, 5
388:                       if (SNSS_OK != status)
9D023B18  1440005C   BNE V0, ZERO, .L6
9D023B1C  8FB30010   LW S3, 16(SP)
389:                          goto _error;
390:                    }
391:                 
392:                    if (0 == save_mapperblock(machine, snssFile))
393:                    {
394:                       status = SNSS_WriteBlock(snssFile, SNSS_MPRD);
9D023C5C  0B408F33   J 0x9D023CCC
9D023C60  8FA40010   LW A0, 16(SP)
9D023CCC  0F408BCC   JAL SNSS_WriteBlock
9D023CD0  24050003   ADDIU A1, ZERO, 3
395:                       if (SNSS_OK != status)
9D023CD4  1040FFE3   BEQ V0, ZERO, 0x9D023C64
9D023CD8  00000000   NOP
9D023CDC  0B408F23   J .L6
9D023CE0  00000000   NOP
396:                          goto _error;
397:                    }
398:                 
399:                    /* close the file, we're done */
400:                    status = SNSS_CloseFile(&snssFile);
9D023C64  0F408A71   JAL SNSS_CloseFile
9D023C68  27A40010   ADDIU A0, SP, 16
401:                    if (SNSS_OK != status)
9D023C6C  14400007   BNE V0, ZERO, .L6
9D023C70  3C139D04   LUI S3, -25340
402:                       goto _error;
403:                 
404:                    gui_sendmsg(GUI_GREEN, "State %d saved", state_slot);
9D023C74  240400C6   ADDIU A0, ZERO, 198
9D023C78  2665FE7C   ADDIU A1, S3, -388
9D023C7C  0F408633   JAL gui_sendmsg
9D023C80  8F8680DC   LW A2, -32548(GP)
405:                    return 0;
9D023C84  0B408F39   J 0x9D023CE4
9D023C88  00001021   ADDU V0, ZERO, ZERO
406:                 
407:                 _error:
408:                    gui_sendmsg(GUI_RED, "error: %s", SNSS_GetErrorString(status));
9D023C8C  0F4089ED   JAL SNSS_GetErrorString
9D023C90  00402021   ADDU A0, V0, ZERO
9D023C94  240400C5   ADDIU A0, ZERO, 197
9D023C98  3C039D04   LUI V1, -25340
9D023C9C  2465FE8C   ADDIU A1, V1, -372
9D023CA0  0F408633   JAL gui_sendmsg
9D023CA4  00403021   ADDU A2, V0, ZERO
409:                    SNSS_CloseFile(&snssFile);
9D023CA8  0F408A71   JAL SNSS_CloseFile
9D023CAC  27A40010   ADDIU A0, SP, 16
410:                    return -1;
9D023CB0  0B408F39   J 0x9D023CE4
9D023CB4  2402FFFF   ADDIU V0, ZERO, -1
411:                 }
9D023CE4  8FBF0234   LW RA, 564(SP)
9D023CE8  8FB40230   LW S4, 560(SP)
9D023CEC  8FB3022C   LW S3, 556(SP)
9D023CF0  8FB20228   LW S2, 552(SP)
9D023CF4  8FB10224   LW S1, 548(SP)
9D023CF8  8FB00220   LW S0, 544(SP)
9D023CFC  03E00008   JR RA
9D023D00  27BD0238   ADDIU SP, SP, 568
9D023D04  904FFFFF   LBU T7, -1(V0)
9D023D08  15E0FFEB   BNE T7, ZERO, 0x9D023CB8
9D023D0C  24080001   ADDIU T0, ZERO, 1
9D023D10  1328FF2E   BEQ T9, T0, 0x9D0239CC
9D023D14  240B0002   ADDIU T3, ZERO, 2
9D023D18  132B0018   BEQ T9, T3, 0x9D023D7C
9D023D1C  24140003   ADDIU S4, ZERO, 3
9D023D20  13340013   BEQ T9, S4, 0x9D023D70
9D023D24  24060004   ADDIU A2, ZERO, 4
9D023D28  1326000E   BEQ T9, A2, 0x9D023D64
9D023D2C  24110005   ADDIU S1, ZERO, 5
9D023D30  13310009   BEQ T9, S1, 0x9D023D58
9D023D34  24130006   ADDIU S3, ZERO, 6
9D023D38  53330005   BEQL T9, S3, 0x9D023D50
9D023D3C  904C0000   LBU T4, 0(V0)
9D023D40  90580000   LBU T8, 0(V0)
9D023D44  1700FFDC   BNE T8, ZERO, 0x9D023CB8
9D023D48  24420001   ADDIU V0, V0, 1
9D023D4C  904C0000   LBU T4, 0(V0)
9D023D50  1580FFD9   BNE T4, ZERO, 0x9D023CB8
9D023D54  24420001   ADDIU V0, V0, 1
9D023D58  904E0000   LBU T6, 0(V0)
9D023D5C  15C0FFD6   BNE T6, ZERO, 0x9D023CB8
9D023D60  24420001   ADDIU V0, V0, 1
9D023D64  905F0000   LBU RA, 0(V0)
9D023D68  17E0FFD3   BNE RA, ZERO, 0x9D023CB8
9D023D6C  24420001   ADDIU V0, V0, 1
9D023D70  904D0000   LBU T5, 0(V0)
9D023D74  15A0FFD0   BNE T5, ZERO, 0x9D023CB8
9D023D78  24420001   ADDIU V0, V0, 1
9D023D7C  24420001   ADDIU V0, V0, 1
9D023D80  9049FFFF   LBU T1, -1(V0)
9D023D84  1120FF11   BEQ T1, ZERO, 0x9D0239CC
9D023D88  00000000   NOP
9D023D8C  0B408F2F   J 0x9D023CBC
9D023D90  28AA0009   SLTI T2, A1, 9
9D023D94  5640FFC9   BNEL S2, ZERO, 0x9D023CBC
9D023D98  28AA0009   SLTI T2, A1, 9
9D023D9C  90430001   LBU V1, 1(V0)
9D023DA0  5460FFC6   BNEL V1, ZERO, 0x9D023CBC
9D023DA4  28AA0009   SLTI T2, A1, 9
9D023DA8  90590002   LBU T9, 2(V0)
9D023DAC  5720FFC3   BNEL T9, ZERO, 0x9D023CBC
9D023DB0  28AA0009   SLTI T2, A1, 9
9D023DB4  904F0003   LBU T7, 3(V0)
9D023DB8  55E0FFC0   BNEL T7, ZERO, 0x9D023CBC
9D023DBC  28AA0009   SLTI T2, A1, 9
9D023DC0  90480004   LBU T0, 4(V0)
9D023DC4  5500FFBD   BNEL T0, ZERO, 0x9D023CBC
9D023DC8  28AA0009   SLTI T2, A1, 9
9D023DCC  904B0005   LBU T3, 5(V0)
9D023DD0  1560FFB9   BNE T3, ZERO, 0x9D023CB8
9D023DD4  24420007   ADDIU V0, V0, 7
9D023DD8  9054FFFF   LBU S4, -1(V0)
9D023DDC  1280FEFB   BEQ S4, ZERO, 0x9D0239CC
9D023DE0  00000000   NOP
9D023DE4  0B408F2F   J 0x9D023CBC
9D023DE8  28AA0009   SLTI T2, A1, 9
412:                 
413:                 int state_load(void)
414:                 {
9D023DEC  27BDFDB8   ADDIU SP, SP, -584
9D023DF0  AFBF0244   SW RA, 580(SP)
9D023DF4  AFB60240   SW S6, 576(SP)
9D023DF8  AFB5023C   SW S5, 572(SP)
9D023DFC  AFB40238   SW S4, 568(SP)
9D023E00  AFB30234   SW S3, 564(SP)
9D023E04  AFB20230   SW S2, 560(SP)
9D023E08  AFB1022C   SW S1, 556(SP)
415:                    SNSS_FILE *snssFile;
416:                    SNSS_RETURN_CODE status;
417:                    SNSS_BLOCK_TYPE block_type;
418:                    char fn[PATH_MAX + 1], ext[5];
419:                    unsigned int i;
420:                    nes_t *machine;
421:                 
422:                    /* get our machine's context pointer */
423:                    machine = nes_getcontextptr();
9D023E0C  0F4097E7   JAL nes_getcontextptr
9D023E10  AFB00228   SW S0, 552(SP)
9D023E14  00408821   ADDU S1, V0, ZERO
424:                    ASSERT(machine);
425:                 
426:                    /* build the state name using the ROM's name and the slot number */
427:                    strncpy(fn, machine->rominfo->filename, PATH_MAX - 4);
9D023E18  8C450310   LW A1, 784(V0)
9D023E1C  27A40018   ADDIU A0, SP, 24
9D023E20  24A50029   ADDIU A1, A1, 41
9D023E24  0F40FA4F   JAL .LFE23, strncpy
9D023E28  240601FC   ADDIU A2, ZERO, 508
428:                 
429:                    ASSERT(state_slot >= FIRST_STATE_SLOT && state_slot <= LAST_STATE_SLOT);
430:                    sprintf(ext, ".ss%d", state_slot);
9D023E2C  27A4021C   ADDIU A0, SP, 540
9D023E30  3C029D04   LUI V0, -25340
9D023E34  2445FE30   ADDIU A1, V0, -464
9D023E38  0F4104E0   JAL _sprintf_cdnopuxX, _sprintf_cdnopsuxX
9D023E3C  8F8680DC   LW A2, -32548(GP)
431:                    //osd_newextension(fn, ext);
432:                    
433:                    /* open our file for writing */
434:                    status = SNSS_OpenFile(&snssFile, fn, SNSS_OPEN_READ);
9D023E40  27A40010   ADDIU A0, SP, 16
9D023E44  27A50018   ADDIU A1, SP, 24
9D023E48  0F408A19   JAL SNSS_OpenFile
9D023E4C  00003021   ADDU A2, ZERO, ZERO
435:                    if (SNSS_OK != status)
9D023E50  14400254   BNE V0, ZERO, .L81
9D023E54  8FA50010   LW A1, 16(SP)
436:                       goto _error;
437:                 
438:                    /* iterate through all present blocks */
439:                    for (i = 0; i < snssFile->headerBlock.numberOfBlocks; i++)
9D023E58  8CA30010   LW V1, 16(A1)
9D023E5C  10600247   BEQ V1, ZERO, 0x9D02477C
9D023E60  0000A021   ADDU S4, ZERO, ZERO
9D0244E4  0B4091DA   J 0x9D024768
9D0244E8  26940001   ADDIU S4, S4, 1
9D024504  0B4091DA   J 0x9D024768
9D024508  26940001   ADDIU S4, S4, 1
9D024524  0B4091DA   J 0x9D024768
9D024528  26940001   ADDIU S4, S4, 1
9D024718  0B4091DA   J 0x9D024768
9D02471C  26940001   ADDIU S4, S4, 1
9D024754  0B4091DA   J 0x9D024768
9D024758  26940001   ADDIU S4, S4, 1
9D024764  26940001   ADDIU S4, S4, 1
9D024768  8FA50010   LW A1, 16(SP)
9D02476C  8CAA0010   LW T2, 16(A1)
9D024770  028A782B   SLTU T7, S4, T2
9D024774  15E0FDBF   BNE T7, ZERO, 0x9D023E74
9D024778  00000000   NOP
440:                    {
441:                       status = SNSS_GetNextBlockType(&block_type, snssFile);
9D023E74  0F408A9E   JAL SNSS_GetNextBlockType
9D023E78  27A40014   ADDIU A0, SP, 20
442:                       if (SNSS_OK != status)
9D023E7C  14400249   BNE V0, ZERO, .L81
9D023E80  00000000   NOP
443:                          goto _error;
444:                 
445:                       status = SNSS_ReadBlock(snssFile, block_type);
9D023E84  8FA40010   LW A0, 16(SP)
9D023E88  0F408B11   JAL SNSS_ReadBlock
9D023E8C  8FA50014   LW A1, 20(SP)
446:                       if (SNSS_OK != status)
9D023E90  14400244   BNE V0, ZERO, .L81
9D023E94  00000000   NOP
447:                          goto _error;
448:                 
449:                       switch (block_type)
9D023E6C  3C159D02   LUI S5, -25342
9D023E70  26B53EBC   ADDIU S5, S5, 16060
9D023E98  8FA40014   LW A0, 20(SP)
9D023E9C  2C860006   SLTIU A2, A0, 6
9D023EA0  10C0022E   BEQ A2, ZERO, 0x9D02475C
9D023EA4  8FA70014   LW A3, 20(SP)
9D023EA8  00074080   SLL T0, A3, 2
9D023EAC  02A84821   ADDU T1, S5, T0
9D023EB0  8D2A0000   LW T2, 0(T1)
9D023EB4  01400008   JR T2
9D023EB8  00000000   NOP
450:                       {
451:                       case SNSS_BASR:
452:                          load_baseblock(machine, snssFile);
9D023ED4  8FB30010   LW S3, 16(SP)
453:                          break;
454:                 
455:                       case SNSS_VRAM:
456:                          load_vramblock(machine, snssFile);
9D0244EC  8FB20010   LW S2, 16(SP)
457:                          break;
458:                 
459:                       case SNSS_SRAM:
460:                          load_sramblock(machine, snssFile);
9D02450C  8FB00010   LW S0, 16(SP)
461:                          break;
462:                       
463:                       case SNSS_MPRD:
464:                          load_mapperblock(machine, snssFile);
9D02452C  8FB00010   LW S0, 16(SP)
465:                          break;
466:                       
467:                       case SNSS_CNTR:
468:                          load_controllerblock(machine, snssFile);
469:                          break;
470:                       
471:                       case SNSS_SOUN:
472:                          load_soundblock(machine, snssFile);
9D024720  8FB30010   LW S3, 16(SP)
9D024724  24100001   ADDIU S0, ZERO, 1
473:                          break;
474:                       
475:                       case SNSS_UNKNOWN_BLOCK:
476:                       default:
477:                          log_printf("unknown SNSS block type\n");
9D023E64  3C169D04   LUI S6, -25340
9D023E68  26D6FE98   ADDIU S6, S6, -360
9D02475C  0F410817   JAL log_printf
9D024760  02C02021   ADDU A0, S6, ZERO
478:                          break;
479:                       }
480:                    }
481:                 
482:                    /* close file, we're done */
483:                    status = SNSS_CloseFile(&snssFile);
9D02477C  0F408A71   JAL SNSS_CloseFile
9D024780  27A40010   ADDIU A0, SP, 16
484:                    if (SNSS_OK != status)
9D024784  14400007   BNE V0, ZERO, .L81
9D024788  3C079D04   LUI A3, -25340
485:                       goto _error;
486:                 
487:                    gui_sendmsg(GUI_GREEN, "State %d restored", state_slot);
9D02478C  240400C6   ADDIU A0, ZERO, 198
9D024790  24E5FEB4   ADDIU A1, A3, -332
9D024794  0F408633   JAL gui_sendmsg
9D024798  8F8680DC   LW A2, -32548(GP)
488:                 
489:                    return 0;
9D02479C  0B4091F3   J 0x9D0247CC
9D0247A0  00001021   ADDU V0, ZERO, ZERO
490:                 
491:                 _error:
492:                    gui_sendmsg(GUI_RED, "error: %s", SNSS_GetErrorString(status));
9D0247A4  0F4089ED   JAL SNSS_GetErrorString
9D0247A8  00402021   ADDU A0, V0, ZERO
9D0247AC  240400C5   ADDIU A0, ZERO, 197
9D0247B0  3C059D04   LUI A1, -25340
9D0247B4  24A5FE8C   ADDIU A1, A1, -372
9D0247B8  0F408633   JAL gui_sendmsg
9D0247BC  00403021   ADDU A2, V0, ZERO
493:                    SNSS_CloseFile(&snssFile);
9D0247C0  0F408A71   JAL SNSS_CloseFile
9D0247C4  27A40010   ADDIU A0, SP, 16
494:                    return -1;
9D0247C8  2402FFFF   ADDIU V0, ZERO, -1
495:                 }
9D0247CC  8FBF0244   LW RA, 580(SP)
9D0247D0  8FB60240   LW S6, 576(SP)
9D0247D4  8FB5023C   LW S5, 572(SP)
9D0247D8  8FB40238   LW S4, 568(SP)
9D0247DC  8FB30234   LW S3, 564(SP)
9D0247E0  8FB20230   LW S2, 560(SP)
9D0247E4  8FB1022C   LW S1, 556(SP)
9D0247E8  8FB00228   LW S0, 552(SP)
9D0247EC  03E00008   JR RA
9D0247F0  27BD0248   ADDIU SP, SP, 584
496:                 
497:                 /*
498:                 ** $Log: nesstate.c,v $
499:                 ** Revision 1.2  2001/04/27 14:37:11  neil
500:                 ** wheeee
501:                 **
502:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
503:                 ** initial
504:                 **
505:                 ** Revision 1.4  2000/11/11 14:52:33  matt
506:                 ** states finally bleepin' work again
507:                 **
508:                 ** Revision 1.3  2000/11/09 14:07:28  matt
509:                 ** state load fixed, state save mostly fixed
510:                 **
511:                 ** Revision 1.2  2000/10/25 00:23:16  matt
512:                 ** makefiles updated for new directory structure
513:                 **
514:                 ** Revision 1.1  2000/10/24 12:20:28  matt
515:                 ** initial revision
516:                 **
517:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/nes/nesinput.c  ----------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** nesinput.c
21:                  **
22:                  ** Event handling system routines
23:                  ** $Id: nesinput.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nesinput.h>
28:                  #include <log.h>
29:                  
30:                  /* TODO: make a linked list of inputs sources, so they
31:                  **       can be removed if need be
32:                  */
33:                  
34:                  static nesinput_t *nes_input[MAX_CONTROLLERS];
35:                  static int active_entries = 0;
36:                  
37:                  /* read counters */
38:                  static int pad0_readcount, pad1_readcount, ppad_readcount, ark_readcount;
39:                  
40:                  
41:                  static int retrieve_type(int type)
42:                  {
43:                     int i, value = 0;
9D035078  00001021   ADDU V0, ZERO, ZERO
9D03507C  01253821   ADDU A3, T1, A1
9D035080  24A6FFFC   ADDIU A2, A1, -4
44:                  
45:                     for (i = 0; i < active_entries; i++)
9D035064  8F8280D4   LW V0, -32556(GP)
9D035068  18400018   BLEZ V0, 0x9D0350CC
9D03506C  3C03A001   LUI V1, -24575
9D035070  24694B80   ADDIU T1, V1, 19328
9D035074  00022880   SLL A1, V0, 2
9D0350DC  1067005F   BEQ V1, A3, 0x9D03525C
9D0350E0  00000000   NOP
9D0350E4  1140FFED   BEQ T2, ZERO, 0x9D03509C
9D0350E8  240D0001   ADDIU T5, ZERO, 1
9D0350EC  114D002F   BEQ T2, T5, 0x9D0351AC
9D0350F0  240E0002   ADDIU T6, ZERO, 2
9D0350F4  114E0027   BEQ T2, T6, 0x9D035194
9D0350F8  240F0003   ADDIU T7, ZERO, 3
9D0350FC  114F001F   BEQ T2, T7, 0x9D03517C
9D035100  24180004   ADDIU T8, ZERO, 4
9D035104  11580017   BEQ T2, T8, 0x9D035164
9D035108  24190005   ADDIU T9, ZERO, 5
9D03510C  1159000F   BEQ T2, T9, 0x9D03514C
9D035110  24090006   ADDIU T1, ZERO, 6
9D0351C4  5467FFB6   BNEL V1, A3, 0x9D0350A0
9D0351C8  8C780000   LW T8, 0(V1)
9D0351CC  03E00008   JR RA
9D0351D0  00000000   NOP
9D035254  5467FF92   BNEL V1, A3, 0x9D0350A0
9D035258  8C780000   LW T8, 0(V1)
9D03525C  03E00008   JR RA
9D035260  00000000   NOP
46:                     {
47:                        ASSERT(nes_input[i]);
48:                  
49:                        if (type == nes_input[i]->type)
9D035084  8D2B0000   LW T3, 0(T1)
9D035088  8D680000   LW T0, 0(T3)
9D03508C  15040012   BNE T0, A0, 0x9D0350D8
9D035090  7CCA1080   EXT T2, A2, 2, 3
9D03509C  8C780000   LW T8, 0(V1)
9D0350A0  8F190000   LW T9, 0(T8)
9D0350A4  17240003   BNE T9, A0, 0x9D0350B4
9D0350A8  24650004   ADDIU A1, V1, 4
9D0350B4  8C630004   LW V1, 4(V1)
9D0350B8  8C660000   LW A2, 0(V1)
9D0350BC  54C40047   BNEL A2, A0, 0x9D0351DC
9D0350C0  8CAB0004   LW T3, 4(A1)
9D035114  51490008   BEQL T2, T1, 0x9D035138
9D035118  8C6B0000   LW T3, 0(V1)
9D03511C  8C650000   LW A1, 0(V1)
9D035120  8CA60000   LW A2, 0(A1)
9D035124  14C40003   BNE A2, A0, 0x9D035134
9D035128  24630004   ADDIU V1, V1, 4
9D035134  8C6B0000   LW T3, 0(V1)
9D035138  8D680000   LW T0, 0(T3)
9D03513C  15040003   BNE T0, A0, 0x9D03514C
9D035140  24630004   ADDIU V1, V1, 4
9D03514C  8C6D0000   LW T5, 0(V1)
9D035150  8DAE0000   LW T6, 0(T5)
9D035154  15C40003   BNE T6, A0, 0x9D035164
9D035158  24630004   ADDIU V1, V1, 4
9D035164  8C780000   LW T8, 0(V1)
9D035168  8F190000   LW T9, 0(T8)
9D03516C  17240003   BNE T9, A0, 0x9D03517C
9D035170  24630004   ADDIU V1, V1, 4
9D03517C  8C650000   LW A1, 0(V1)
9D035180  8CA60000   LW A2, 0(A1)
9D035184  14C40003   BNE A2, A0, 0x9D035194
9D035188  24630004   ADDIU V1, V1, 4
9D035194  8C6B0000   LW T3, 0(V1)
9D035198  8D680000   LW T0, 0(T3)
9D03519C  15040003   BNE T0, A0, 0x9D0351AC
9D0351A0  24630004   ADDIU V1, V1, 4
9D0351AC  8C6D0000   LW T5, 0(V1)
9D0351B0  8DAE0000   LW T6, 0(T5)
9D0351B4  15C40003   BNE T6, A0, 0x9D0351C4
9D0351B8  24630004   ADDIU V1, V1, 4
9D0351D8  8CAB0004   LW T3, 4(A1)
9D0351DC  8D680000   LW T0, 0(T3)
9D0351E0  15040003   BNE T0, A0, 0x9D0351F0
9D0351E4  8CAD0008   LW T5, 8(A1)
9D0351F0  8DAE0000   LW T6, 0(T5)
9D0351F4  15C40003   BNE T6, A0, 0x9D035204
9D0351F8  8CB8000C   LW T8, 12(A1)
9D035204  8F190000   LW T9, 0(T8)
9D035208  17240003   BNE T9, A0, 0x9D035218
9D03520C  8CA30010   LW V1, 16(A1)
9D035218  8C660000   LW A2, 0(V1)
9D03521C  14C40003   BNE A2, A0, 0x9D03522C
9D035220  8CAB0014   LW T3, 20(A1)
9D03522C  8D680000   LW T0, 0(T3)
9D035230  15040003   BNE T0, A0, 0x9D035240
9D035234  8CAD0018   LW T5, 24(A1)
9D035240  8DAE0000   LW T6, 0(T5)
9D035244  15C40003   BNE T6, A0, 0x9D035254
9D035248  24A3001C   ADDIU V1, A1, 28
50:                           value |= nes_input[i]->data;
9D035094  0B40D435   J 0x9D0350D4
9D035098  8D6C0004   LW T4, 4(T3)
9D0350AC  8F090004   LW T1, 4(T8)
9D0350B0  00491025   OR V0, V0, T1
9D0350C4  0B40D475   J 0x9D0351D4
9D0350C8  8C6A0004   LW T2, 4(V1)
9D0350D4  004C1025   OR V0, V0, T4
9D0350D8  25230004   ADDIU V1, T1, 4
9D03512C  8CAA0004   LW T2, 4(A1)
9D035130  004A1025   OR V0, V0, T2
9D035144  8D6C0004   LW T4, 4(T3)
9D035148  004C1025   OR V0, V0, T4
9D03515C  8DAF0004   LW T7, 4(T5)
9D035160  004F1025   OR V0, V0, T7
9D035174  8F090004   LW T1, 4(T8)
9D035178  00491025   OR V0, V0, T1
9D03518C  8CAA0004   LW T2, 4(A1)
9D035190  004A1025   OR V0, V0, T2
9D0351A4  8D6C0004   LW T4, 4(T3)
9D0351A8  004C1025   OR V0, V0, T4
9D0351BC  8DAF0004   LW T7, 4(T5)
9D0351C0  004F1025   OR V0, V0, T7
9D0351D4  004A1025   OR V0, V0, T2
9D0351E8  8D6C0004   LW T4, 4(T3)
9D0351EC  004C1025   OR V0, V0, T4
9D0351FC  8DAF0004   LW T7, 4(T5)
9D035200  004F1025   OR V0, V0, T7
9D035210  8F090004   LW T1, 4(T8)
9D035214  00491025   OR V0, V0, T1
9D035224  8C6A0004   LW T2, 4(V1)
9D035228  004A1025   OR V0, V0, T2
9D035238  8D6C0004   LW T4, 4(T3)
9D03523C  004C1025   OR V0, V0, T4
9D03524C  8DAF0004   LW T7, 4(T5)
9D035250  004F1025   OR V0, V0, T7
51:                     }
52:                  
53:                     return value;
54:                  }
9D0350CC  03E00008   JR RA
9D0350D0  00001021   ADDU V0, ZERO, ZERO
9D0350D4  004C1025   OR V0, V0, T4
9D0350D8  25230004   ADDIU V1, T1, 4
9D0350DC  1067005F   BEQ V1, A3, 0x9D03525C
9D0350E0  00000000   NOP
9D0350E4  1140FFED   BEQ T2, ZERO, 0x9D03509C
9D0350E8  240D0001   ADDIU T5, ZERO, 1
9D0350EC  114D002F   BEQ T2, T5, 0x9D0351AC
9D0350F0  240E0002   ADDIU T6, ZERO, 2
9D0350F4  114E0027   BEQ T2, T6, 0x9D035194
9D0350F8  240F0003   ADDIU T7, ZERO, 3
9D0350FC  114F001F   BEQ T2, T7, 0x9D03517C
9D035100  24180004   ADDIU T8, ZERO, 4
9D035104  11580017   BEQ T2, T8, 0x9D035164
9D035108  24190005   ADDIU T9, ZERO, 5
9D03510C  1159000F   BEQ T2, T9, 0x9D03514C
9D035110  24090006   ADDIU T1, ZERO, 6
9D035114  51490008   BEQL T2, T1, 0x9D035138
9D035118  8C6B0000   LW T3, 0(V1)
9D03511C  8C650000   LW A1, 0(V1)
9D035120  8CA60000   LW A2, 0(A1)
9D035124  14C40003   BNE A2, A0, 0x9D035134
9D035128  24630004   ADDIU V1, V1, 4
9D03512C  8CAA0004   LW T2, 4(A1)
9D035130  004A1025   OR V0, V0, T2
9D035134  8C6B0000   LW T3, 0(V1)
9D035138  8D680000   LW T0, 0(T3)
9D03513C  15040003   BNE T0, A0, 0x9D03514C
9D035140  24630004   ADDIU V1, V1, 4
9D035144  8D6C0004   LW T4, 4(T3)
9D035148  004C1025   OR V0, V0, T4
9D03514C  8C6D0000   LW T5, 0(V1)
9D035150  8DAE0000   LW T6, 0(T5)
9D035154  15C40003   BNE T6, A0, 0x9D035164
9D035158  24630004   ADDIU V1, V1, 4
9D03515C  8DAF0004   LW T7, 4(T5)
9D035160  004F1025   OR V0, V0, T7
9D035164  8C780000   LW T8, 0(V1)
9D035168  8F190000   LW T9, 0(T8)
9D03516C  17240003   BNE T9, A0, 0x9D03517C
9D035170  24630004   ADDIU V1, V1, 4
9D035174  8F090004   LW T1, 4(T8)
9D035178  00491025   OR V0, V0, T1
9D03517C  8C650000   LW A1, 0(V1)
9D035180  8CA60000   LW A2, 0(A1)
9D035184  14C40003   BNE A2, A0, 0x9D035194
9D035188  24630004   ADDIU V1, V1, 4
9D03518C  8CAA0004   LW T2, 4(A1)
9D035190  004A1025   OR V0, V0, T2
9D035194  8C6B0000   LW T3, 0(V1)
9D035198  8D680000   LW T0, 0(T3)
9D03519C  15040003   BNE T0, A0, 0x9D0351AC
9D0351A0  24630004   ADDIU V1, V1, 4
9D0351A4  8D6C0004   LW T4, 4(T3)
9D0351A8  004C1025   OR V0, V0, T4
9D0351AC  8C6D0000   LW T5, 0(V1)
9D0351B0  8DAE0000   LW T6, 0(T5)
9D0351B4  15C40003   BNE T6, A0, 0x9D0351C4
9D0351B8  24630004   ADDIU V1, V1, 4
9D0351BC  8DAF0004   LW T7, 4(T5)
9D0351C0  004F1025   OR V0, V0, T7
9D0351C4  5467FFB6   BNEL V1, A3, 0x9D0350A0
9D0351C8  8C780000   LW T8, 0(V1)
9D0351CC  03E00008   JR RA
9D0351D0  00000000   NOP
9D0351D4  004A1025   OR V0, V0, T2
9D0351D8  8CAB0004   LW T3, 4(A1)
9D0351DC  8D680000   LW T0, 0(T3)
9D0351E0  15040003   BNE T0, A0, 0x9D0351F0
9D0351E4  8CAD0008   LW T5, 8(A1)
9D0351E8  8D6C0004   LW T4, 4(T3)
9D0351EC  004C1025   OR V0, V0, T4
9D0351F0  8DAE0000   LW T6, 0(T5)
9D0351F4  15C40003   BNE T6, A0, 0x9D035204
9D0351F8  8CB8000C   LW T8, 12(A1)
9D0351FC  8DAF0004   LW T7, 4(T5)
9D035200  004F1025   OR V0, V0, T7
9D035204  8F190000   LW T9, 0(T8)
9D035208  17240003   BNE T9, A0, 0x9D035218
9D03520C  8CA30010   LW V1, 16(A1)
9D035210  8F090004   LW T1, 4(T8)
9D035214  00491025   OR V0, V0, T1
9D035218  8C660000   LW A2, 0(V1)
9D03521C  14C40003   BNE A2, A0, 0x9D03522C
9D035220  8CAB0014   LW T3, 20(A1)
9D035224  8C6A0004   LW T2, 4(V1)
9D035228  004A1025   OR V0, V0, T2
9D03522C  8D680000   LW T0, 0(T3)
9D035230  15040003   BNE T0, A0, 0x9D035240
9D035234  8CAD0018   LW T5, 24(A1)
9D035238  8D6C0004   LW T4, 4(T3)
9D03523C  004C1025   OR V0, V0, T4
9D035240  8DAE0000   LW T6, 0(T5)
9D035244  15C40003   BNE T6, A0, 0x9D035254
9D035248  24A3001C   ADDIU V1, A1, 28
9D03524C  8DAF0004   LW T7, 4(T5)
9D035250  004F1025   OR V0, V0, T7
9D035254  5467FF92   BNEL V1, A3, 0x9D0350A0
9D035258  8C780000   LW T8, 0(V1)
9D03525C  03E00008   JR RA
9D035260  00000000   NOP
55:                  
56:                  static uint8 get_pad0(void)
57:                  {
58:                     uint8 value;
59:                  
60:                     value = (uint8) retrieve_type(INP_JOYPAD0);
9D035284  0F40D419   JAL .LFB0, retrieve_type, .Ltext0, .Letext0, .LFE1
61:                  
62:                     /* mask out left/right simultaneous keypresses */
63:                     if ((value & INP_PAD_UP) && (value & INP_PAD_DOWN))
9D035290  30450030   ANDI A1, V0, 48
64:                        value &= ~(INP_PAD_UP | INP_PAD_DOWN);
9D035294  306400CF   ANDI A0, V1, 207
65:                  
66:                     if ((value & INP_PAD_LEFT) && (value & INP_PAD_RIGHT))
9D0352A0  30670040   ANDI A3, V1, 64
67:                        value &= ~(INP_PAD_LEFT | INP_PAD_RIGHT);
9D0352B0  306A003F   ANDI T2, V1, 63
68:                  
69:                     /* return (0x40 | value) due to bus conflicts */
70:                     return (0x40 | ((value >> pad0_readcount++) & 1));
9D0352BC  8F9180D0   LW S1, -32560(GP)
9D0352C0  262C0001   ADDIU T4, S1, 1
9D0352C4  AF8C80D0   SW T4, -32560(GP)
9D0352C8  02236807   SRAV T5, V1, S1
9D0352CC  31AE0001   ANDI T6, T5, 1
9D0352D0  35CF0040   ORI T7, T6, 64
9D0352D4  31F100FF   ANDI S1, T7, 255
71:                  }
72:                  
73:                  static uint8 get_pad1(void)
74:                  {
75:                     uint8 value;
76:                  
77:                     value = (uint8) retrieve_type(INP_JOYPAD1);
9D0352E4  0F40D419   JAL .LFB0, retrieve_type, .Ltext0, .Letext0, .LFE1
78:                  
79:                     /* mask out left/right simultaneous keypresses */
80:                     if ((value & INP_PAD_UP) && (value & INP_PAD_DOWN))
9D0352F0  30420030   ANDI V0, V0, 48
81:                        value &= ~(INP_PAD_UP | INP_PAD_DOWN);
9D0352F4  332300CF   ANDI V1, T9, 207
82:                  
83:                     if ((value & INP_PAD_LEFT) && (value & INP_PAD_RIGHT))
9D035300  33240040   ANDI A0, T9, 64
84:                        value &= ~(INP_PAD_LEFT | INP_PAD_RIGHT);
9D035310  3327003F   ANDI A3, T9, 63
85:                  
86:                     /* return (0x40 | value) due to bus conflicts */
87:                     return (0x40 | ((value >> pad1_readcount++) & 1));
9D03531C  8F8980CC   LW T1, -32564(GP)
9D035320  252A0001   ADDIU T2, T1, 1
9D035324  AF8A80CC   SW T2, -32564(GP)
9D035328  01395807   SRAV T3, T9, T1
9D03532C  316C0001   ANDI T4, T3, 1
9D035330  358D0040   ORI T5, T4, 64
88:                  }
89:                  
90:                  static uint8 get_zapper(void)
91:                  {
92:                     return (uint8) (retrieve_type(INP_ZAPPER));
9D035344  0F40D419   JAL .LFB0, retrieve_type, .Ltext0, .Letext0, .LFE1
9D035348  24040004   ADDIU A0, ZERO, 4
93:                  }
94:                  
95:                  static uint8 get_powerpad(void)
96:                  {
97:                     int value;
98:                     uint8 ret_val = 0;
9D035378  24050010   ADDIU A1, ZERO, 16
99:                     
100:                    value = retrieve_type(INP_POWERPAD);
9D035360  0F40D419   JAL .LFB0, retrieve_type, .Ltext0, .Letext0, .LFE1
101:                 
102:                    if (((value >> 8) >> ppad_readcount) & 1)
9D035368  8F9880C8   LW T8, -32568(GP)
103:                       ret_val |= 0x10;
104:                    if (((value & 0xFF) >> ppad_readcount) & 1)
9D035380  304200FF   ANDI V0, V0, 255
105:                       ret_val |= 0x08;
9D035394  34BF0008   ORI RA, A1, 8
106:                 
107:                    ppad_readcount++;
9D03539C  27090001   ADDIU T1, T8, 1
9D0353A0  AF8980C8   SW T1, -32568(GP)
108:                 
109:                    return ret_val;
110:                 }
111:                 
112:                 static uint8 get_vsdips0(void)
113:                 {
114:                    return (retrieve_type(INP_VSDIPSW0));
9D0353B4  0F40D419   JAL .LFB0, retrieve_type, .Ltext0, .Letext0, .LFE1
9D0353B8  24040020   ADDIU A0, ZERO, 32
115:                 }
116:                 
117:                 static uint8 get_vsdips1(void)
118:                 {
119:                    return (retrieve_type(INP_VSDIPSW1));
9D0353D0  0F40D419   JAL .LFB0, retrieve_type, .Ltext0, .Letext0, .LFE1
9D0353D4  24040040   ADDIU A0, ZERO, 64
120:                 }
121:                 
122:                 static uint8 get_arkanoid(void)
123:                 {
124:                    uint8 value = retrieve_type(INP_ARKANOID);
9D0353EC  0F40D419   JAL .LFB0, retrieve_type, .Ltext0, .Letext0, .LFE1
9D0353F0  24040010   ADDIU A0, ZERO, 16
125:                 
126:                    if ((value >> (7 - ark_readcount++)) & 1)
9D0353F4  8F8E80C4   LW T6, -32572(GP)
9D0353F8  25CF0001   ADDIU T7, T6, 1
9D0353FC  AF8F80C4   SW T7, -32572(GP)
9D035400  305800FF   ANDI T8, V0, 255
9D035404  24030007   ADDIU V1, ZERO, 7
9D035408  006EC823   SUBU T9, V1, T6
9D03540C  03382007   SRAV A0, T8, T9
9D035410  30850001   ANDI A1, A0, 1
127:                       return 0x02;
9D035414  24020002   ADDIU V0, ZERO, 2
9D035418  0005100A   MOVZ V0, ZERO, A1
128:                    else
129:                       return 0;
130:                 }
131:                 
132:                 /* return input state for all types indicated (can be ORed together) */
133:                 uint8 input_get(int types)
134:                 {
9D035264  27BDFFE0   ADDIU SP, SP, -32
9D035268  AFBF001C   SW RA, 28(SP)
9D03526C  AFB10018   SW S1, 24(SP)
9D035270  AFB00014   SW S0, 20(SP)
9D035274  00808021   ADDU S0, A0, ZERO
135:                    uint8 value = 0;
136:                 
137:                    if (types & INP_JOYPAD0)
9D035278  30820001   ANDI V0, A0, 1
9D03527C  10400016   BEQ V0, ZERO, .LBE17, .LBE16
9D035280  00008821   ADDU S1, ZERO, ZERO
138:                       value |= get_pad0();
139:                    if (types & INP_JOYPAD1)
9D0352D8  32180002   ANDI T8, S0, 2
9D0352DC  13000017   BEQ T8, ZERO, 0x9D03533C
9D0352E0  320E0004   ANDI T6, S0, 4
140:                       value |= get_pad1();
9D035334  022D8825   OR S1, S1, T5
141:                    if (types & INP_ZAPPER)
9D035338  320E0004   ANDI T6, S0, 4
9D03533C  11C00006   BEQ T6, ZERO, 0x9D035358
9D035340  320F0008   ANDI T7, S0, 8
142:                       value |= get_zapper();
9D03534C  02228825   OR S1, S1, V0
9D035350  323100FF   ANDI S1, S1, 255
143:                    if (types & INP_POWERPAD)
9D035354  320F0008   ANDI T7, S0, 8
9D035358  11E00014   BEQ T7, ZERO, 0x9D0353AC
9D03535C  320A0020   ANDI T2, S0, 32
144:                       value |= get_powerpad();
9D0353A4  01118825   OR S1, T0, S1
145:                    if (types & INP_VSDIPSW0)
9D0353A8  320A0020   ANDI T2, S0, 32
9D0353AC  11400006   BEQ T2, ZERO, 0x9D0353C8
9D0353B0  320C0040   ANDI T4, S0, 64
146:                       value |= get_vsdips0();
9D0353BC  02225825   OR T3, S1, V0
9D0353C0  317100FF   ANDI S1, T3, 255
147:                    if (types & INP_VSDIPSW1)
9D0353C4  320C0040   ANDI T4, S0, 64
9D0353C8  51800006   BEQL T4, ZERO, 0x9D0353E4
9D0353CC  32100010   ANDI S0, S0, 16
148:                       value |= get_vsdips1();
9D0353D8  02226825   OR T5, S1, V0
9D0353DC  31B100FF   ANDI S1, T5, 255
149:                    if (types & INP_ARKANOID)
9D0353E0  32100010   ANDI S0, S0, 16
9D0353E4  1200000F   BEQ S0, ZERO, 0x9D035424
9D0353E8  02201021   ADDU V0, S1, ZERO
150:                       value |= get_arkanoid();
9D03541C  00518825   OR S1, V0, S1
151:                 
152:                    return value;
153:                 }
9D035420  02201021   ADDU V0, S1, ZERO
9D035424  8FBF001C   LW RA, 28(SP)
9D035428  8FB10018   LW S1, 24(SP)
9D03542C  8FB00014   LW S0, 20(SP)
9D035430  03E00008   JR RA
9D035434  27BD0020   ADDIU SP, SP, 32
154:                 
155:                 /* register an input type */
156:                 void input_register(nesinput_t *input)
157:                 {
158:                    if (NULL == input)
9D035438  10800008   BEQ A0, ZERO, 0x9D03545C
9D03543C  8F8280D4   LW V0, -32556(GP)
159:                       return;
160:                 
161:                    nes_input[active_entries] = input;
9D035440  00022880   SLL A1, V0, 2
9D035444  3C03A001   LUI V1, -24575
9D035448  24664B80   ADDIU A2, V1, 19328
9D03544C  00A63821   ADDU A3, A1, A2
9D035450  ACE40000   SW A0, 0(A3)
162:                    active_entries++;
9D035454  24440001   ADDIU A0, V0, 1
9D035458  AF8480D4   SW A0, -32556(GP)
9D03545C  03E00008   JR RA
9D035460  00000000   NOP
163:                 }
164:                 
165:                 void input_event(nesinput_t *input, int state, int value)
166:                 {
167:                    ASSERT(input);
168:                 
169:                    if (state == INP_STATE_MAKE)
9D035464  24020001   ADDIU V0, ZERO, 1
9D035468  54A20005   BNEL A1, V0, 0x9D035480
9D03546C  00063027   NOR A2, ZERO, A2
170:                       input->data |= value;   /* OR it in */
9D035470  8C870004   LW A3, 4(A0)
9D035474  00E64025   OR T0, A3, A2
9D035478  03E00008   JR RA
9D03547C  AC880004   SW T0, 4(A0)
171:                    else /* break state */
172:                       input->data &= ~value;  /* mask it out */
9D035480  8C830004   LW V1, 4(A0)
9D035484  00662824   AND A1, V1, A2
9D035488  03E00008   JR RA
9D03548C  AC850004   SW A1, 4(A0)
173:                 }
174:                 
175:                 void input_strobe(void)
176:                 {
177:                    pad0_readcount = 0;
9D035490  AF8080D0   SW ZERO, -32560(GP)
178:                    pad1_readcount = 0;
9D035494  AF8080CC   SW ZERO, -32564(GP)
179:                    ppad_readcount = 0;
9D035498  AF8080C8   SW ZERO, -32568(GP)
180:                    ark_readcount = 0;
9D03549C  03E00008   JR RA
9D0354A0  AF8080C4   SW ZERO, -32572(GP)
181:                 }
182:                 
183:                 /*
184:                 ** $Log: nesinput.c,v $
185:                 ** Revision 1.2  2001/04/27 14:37:11  neil
186:                 ** wheeee
187:                 **
188:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
189:                 ** initial
190:                 **
191:                 ** Revision 1.1  2000/10/24 12:20:28  matt
192:                 ** changed directory structure
193:                 **
194:                 ** Revision 1.9  2000/09/10 23:25:03  matt
195:                 ** minor changes
196:                 **
197:                 ** Revision 1.8  2000/07/31 04:27:59  matt
198:                 ** one million cleanups
199:                 **
200:                 ** Revision 1.7  2000/07/23 15:11:45  matt
201:                 ** removed unused variables
202:                 **
203:                 ** Revision 1.6  2000/07/17 01:52:28  matt
204:                 ** made sure last line of all source files is a newline
205:                 **
206:                 ** Revision 1.5  2000/07/04 04:56:50  matt
207:                 ** include changes
208:                 **
209:                 ** Revision 1.4  2000/06/09 15:12:26  matt
210:                 ** initial revision
211:                 **
212:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/nes/nes_rom.c  -----------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** nes_rom.c
21:                  **
22:                  ** NES ROM loading/saving related functions
23:                  ** $Id: nes_rom.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  /* TODO: make this a generic ROM loading routine */
27:                  
28:                  #include <stdio.h>
29:                  #include <string.h>
30:                  #include <noftypes.h>
31:                  #include <nes_rom.h>
32:                  #include <intro.h>
33:                  #include <nes_mmc.h>
34:                  #include <nes_ppu.h>
35:                  #include <nes.h>
36:                  #include <gui.h>
37:                  #include <log.h>
38:                  #include <osd.h>
39:                  
40:                  extern char *osd_getromdata();
41:                  
42:                  /* Max length for displayed filename */
43:                  #define  ROM_DISP_MAXLEN   20
44:                  
45:                  
46:                  #ifdef ZLIB
47:                  #include <zlib.h>
48:                  #define  _fopen            gzopen
49:                  #define  _fclose           gzclose
50:                  #define  _fread(B,N,L,F)   gzread((F),(B),(L)*(N))
51:                  #else
52:                  #define  _fopen            fopen
53:                  #define  _fclose           fclose
54:                  #define  _fread(B,N,L,F)   fread((B),(N),(L),(F))
55:                  #endif
56:                  
57:                  #define  ROM_FOURSCREEN    0x08
58:                  #define  ROM_TRAINER       0x04
59:                  #define  ROM_BATTERY       0x02
60:                  #define  ROM_MIRRORTYPE    0x01
61:                  #define  ROM_INES_MAGIC    "NES\x1A"
62:                  
63:                  //ToDo: packed - JD
64:                  typedef struct inesheader_s
65:                  {
66:                     uint8 ines_magic[4]    ;
67:                     uint8 rom_banks        ;
68:                     uint8 vrom_banks       ;
69:                     uint8 rom_type         ;
70:                     uint8 mapper_hinybble  ;
71:                     uint8 reserved[8]      ;
72:                  } inesheader_t;
73:                  
74:                  
75:                  #define  TRAINER_OFFSET    0x1000
76:                  #define  TRAINER_LENGTH    0x200
77:                  #define  VRAM_LENGTH       0x2000
78:                  
79:                  #define  ROM_BANK_LENGTH   0x4000
80:                  #define  VROM_BANK_LENGTH  0x2000
81:                  
82:                  #define  SRAM_BANK_LENGTH  0x0400
83:                  #define  VRAM_BANK_LENGTH  0x2000
84:                  
85:                  /* Save battery-backed RAM */
86:                  static void rom_savesram(rominfo_t *rominfo)
87:                  {
9D0308CC  27BDFDD8   ADDIU SP, SP, -552
9D0308D0  AFBF0224   SW RA, 548(SP)
9D0308D4  AFB10220   SW S1, 544(SP)
9D0308D8  AFB0021C   SW S0, 540(SP)
88:                     FILE *fp;
89:                     char fn[PATH_MAX + 1];
90:                  
91:                     ASSERT(rominfo);
92:                  
93:                     if (rominfo->flags & ROM_FLAG_BATTERY)
9D0308DC  90820028   LBU V0, 40(A0)
9D0308E0  30430001   ANDI V1, V0, 1
9D0308E4  10600016   BEQ V1, ZERO, .LVL14
9D0308E8  00808021   ADDU S0, A0, ZERO
94:                     {
95:                        strncpy(fn, rominfo->filename, PATH_MAX);
9D0308EC  27A40010   ADDIU A0, SP, 16
9D0308F0  26050029   ADDIU A1, S0, 41
9D0308F4  0F40FA4F   JAL .LFE23, strncpy
9D0308F8  24060200   ADDIU A2, ZERO, 512
96:                        //osd_newextension(fn, ".sav");
97:                  
98:                        fp = fopen(fn, "wb");
9D0308FC  27A40010   ADDIU A0, SP, 16
9D030900  3C059D04   LUI A1, -25340
9D030904  0F40F363   JAL .Letext0, .LFE12, fopen
9D030908  24A5B8F0   ADDIU A1, A1, -18192
99:                        if (NULL != fp)
9D03090C  1040000C   BEQ V0, ZERO, .LVL14
9D030910  00408821   ADDU S1, V0, ZERO
100:                       {
101:                          fwrite(rominfo->sram, SRAM_BANK_LENGTH, rominfo->sram_banks, fp);
9D030914  8E040008   LW A0, 8(S0)
9D030918  24050400   ADDIU A1, ZERO, 1024
9D03091C  8E060018   LW A2, 24(S0)
9D030920  0F4108EC   JAL fwrite
9D030924  00403821   ADDU A3, V0, ZERO
102:                          fclose(fp);
9D030928  0F4102B5   JAL .Letext0, .LFE1, fclose
9D03092C  02202021   ADDU A0, S1, ZERO
103:                          log_printf("Wrote battery RAM to %s.\n", fn);
9D030930  3C049D04   LUI A0, -25340
9D030934  2484B8F4   ADDIU A0, A0, -18188
9D030938  0F410817   JAL log_printf
9D03093C  27A50010   ADDIU A1, SP, 16
104:                       }
105:                    }
106:                 }
9D030940  8FBF0224   LW RA, 548(SP)
9D030944  8FB10220   LW S1, 544(SP)
9D030948  8FB0021C   LW S0, 540(SP)
9D03094C  03E00008   JR RA
9D030950  27BD0228   ADDIU SP, SP, 552
107:                 
108:                 /* Load battery-backed RAM from disk */
109:                 static void rom_loadsram(rominfo_t *rominfo)
110:                 {
9D030844  27BDFDD8   ADDIU SP, SP, -552
9D030848  AFBF0224   SW RA, 548(SP)
9D03084C  AFB10220   SW S1, 544(SP)
9D030850  AFB0021C   SW S0, 540(SP)
111:                    FILE *fp;
112:                    char fn[PATH_MAX + 1];
113:                 
114:                    ASSERT(rominfo);
115:                 
116:                    if (rominfo->flags & ROM_FLAG_BATTERY)
9D030854  90820028   LBU V0, 40(A0)
9D030858  30430001   ANDI V1, V0, 1
9D03085C  10600016   BEQ V1, ZERO, .LVL6
9D030860  00808021   ADDU S0, A0, ZERO
117:                    {
118:                       strncpy(fn, rominfo->filename, PATH_MAX);
9D030864  27A40010   ADDIU A0, SP, 16
9D030868  26050029   ADDIU A1, S0, 41
9D03086C  0F40FA4F   JAL .LFE23, strncpy
9D030870  24060200   ADDIU A2, ZERO, 512
119:                       //osd_newextension(fn, ".sav");
120:                 
121:                       fp = fopen(fn, "rb");
9D030874  27A40010   ADDIU A0, SP, 16
9D030878  3C059D04   LUI A1, -25340
9D03087C  0F40F363   JAL .Letext0, .LFE12, fopen
9D030880  24A5B8D0   ADDIU A1, A1, -18224
122:                       if (NULL != fp)
9D030884  1040000C   BEQ V0, ZERO, .LVL6
9D030888  00408821   ADDU S1, V0, ZERO
123:                       {
124:                          fread(rominfo->sram, SRAM_BANK_LENGTH, rominfo->sram_banks, fp);
9D03088C  8E040008   LW A0, 8(S0)
9D030890  24050400   ADDIU A1, ZERO, 1024
9D030894  8E060018   LW A2, 24(S0)
9D030898  0F40E52C   JAL .Letext0, .LFE1, fread
9D03089C  00403821   ADDU A3, V0, ZERO
125:                          fclose(fp);
9D0308A0  0F4102B5   JAL .Letext0, .LFE1, fclose
9D0308A4  02202021   ADDU A0, S1, ZERO
126:                          log_printf("Read battery RAM from %s.\n", fn);
9D0308A8  3C049D04   LUI A0, -25340
9D0308AC  2484B8D4   ADDIU A0, A0, -18220
9D0308B0  0F410817   JAL log_printf
9D0308B4  27A50010   ADDIU A1, SP, 16
127:                       }
128:                    }
129:                 }
9D0308B8  8FBF0224   LW RA, 548(SP)
9D0308BC  8FB10220   LW S1, 544(SP)
9D0308C0  8FB0021C   LW S0, 540(SP)
9D0308C4  03E00008   JR RA
9D0308C8  27BD0228   ADDIU SP, SP, 552
130:                 
131:                 /* Allocate space for SRAM */
132:                 static int rom_allocsram(rominfo_t *rominfo)
133:                 {
134:                    /* Load up SRAM */
135:                    rominfo->sram = malloc(SRAM_BANK_LENGTH * rominfo->sram_banks);
9D030EDC  8E460018   LW A2, 24(S2)
136:                    if (NULL == rominfo->sram)
9D030EE8  14400007   BNE V0, ZERO, 0x9D030F08
137:                    {
138:                       gui_sendmsg(GUI_RED, "Could not allocate space for battery RAM");
9D030EF0  240400C5   ADDIU A0, ZERO, 197
139:                       return -1;
140:                    }
141:                 
142:                    /* make damn sure SRAM is clear */
143:                    memset(rominfo->sram, 0, SRAM_BANK_LENGTH * rominfo->sram_banks);
9D030F08  8E470018   LW A3, 24(S2)
9D030F0C  00402021   ADDU A0, V0, ZERO
9D030F10  00002821   ADDU A1, ZERO, ZERO
9D030F14  0F4100B4   JAL .Letext0, .LFE0, memset
9D030F18  00073280   SLL A2, A3, 10
144:                    return 0;
145:                 }
146:                 
147:                 /* If there's a trainer, load it in at $7000 */
148:                 static void rom_loadtrainer(unsigned char **rom, rominfo_t *rominfo)
149:                 {
150:                    ASSERT(rom);
151:                    ASSERT(rominfo);
152:                 
153:                    if (rominfo->flags & ROM_FLAG_TRAINER)
9D030F20  91090028   LBU T1, 40(T0)
154:                    {
155:                 //      fread(rominfo->sram + TRAINER_OFFSET, TRAINER_LENGTH, 1, fp);
156:                       memcpy(rominfo->sram + TRAINER_OFFSET, *rom, TRAINER_LENGTH);
9D030F34  8D0C0008   LW T4, 8(T0)
157:                       rom+=TRAINER_LENGTH;
158:                       log_printf("Read in trainer at $7000\n");
9D031068  3C0D9D04   LUI T5, -25340
9D03106C  0F410817   JAL log_printf
9D031070  25A4BA70   ADDIU A0, T5, -17808
159:                    }
160:                 }
161:                 
162:                 static int rom_loadrom(unsigned char **rom, rominfo_t *rominfo)
163:                 {
164:                    ASSERT(rom);
165:                    ASSERT(rominfo);
166:                 
167:                    /* Allocate ROM space, and load it up! */
168:                 /*
169:                    rominfo->rom = malloc((rominfo->rom_banks * ROM_BANK_LENGTH));
170:                    if (NULL == rominfo->rom)
171:                    {
172:                       gui_sendmsg(GUI_RED, "Could not allocate space for ROM image");
173:                       return -1;
174:                    }
175:                    _fread(rominfo->rom, ROM_BANK_LENGTH, rominfo->rom_banks, fp);
176:                 */
177:                    rominfo->rom=*rom;
9D031078  AE300000   SW S0, 0(S1)
178:                    *rom+=ROM_BANK_LENGTH*rominfo->rom_banks;
9D031088  00055B80   SLL T3, A1, 14
9D03108C  020B4821   ADDU T1, S0, T3
179:                 
180:                 
181:                    /* If there's VROM, allocate and stuff it in */
182:                    if (rominfo->vrom_banks)
9D03107C  8E280014   LW T0, 20(S1)
9D031080  11000005   BEQ T0, ZERO, 0x9D031098
9D031084  8E250010   LW A1, 16(S1)
183:                    {
184:                 /*
185:                       rominfo->vrom = malloc((rominfo->vrom_banks * VROM_BANK_LENGTH));
186:                       if (NULL == rominfo->vrom)
187:                       {
188:                          gui_sendmsg(GUI_RED, "Could not allocate space for VROM");
189:                          return -1;
190:                       }
191:                       _fread(rominfo->vrom, VROM_BANK_LENGTH, rominfo->vrom_banks, fp);
192:                 */
193:                       rominfo->vrom=*rom;
9D031090  0B40C443   J 0x9D03110C
9D031094  AE290004   SW T1, 4(S1)
194:                       *rom+=VROM_BANK_LENGTH*rominfo->vrom_banks;
195:                 
196:                    }
197:                    else
198:                    {
199:                       rominfo->vram = malloc(VRAM_LENGTH);
9D031098  0F40F30A   JAL _my_malloc
9D03109C  24042000   ADDIU A0, ZERO, 8192
200:                       if (NULL == rominfo->vram)
9D0310A0  14400007   BNE V0, ZERO, 0x9D0310C0
9D0310A4  AE22000C   SW V0, 12(S1)
201:                       {
202:                          gui_sendmsg(GUI_RED, "Could not allocate space for VRAM");
9D0310A8  240400C5   ADDIU A0, ZERO, 197
9D0310AC  3C109D04   LUI S0, -25340
9D0310B0  0F408633   JAL gui_sendmsg
9D0310B4  2605BA8C   ADDIU A1, S0, -17780
9D0310B8  0B40C436   J .L47
9D0310BC  00000000   NOP
203:                          return -1;
204:                       }
205:                       memset(rominfo->vram, 0, VRAM_LENGTH);
9D0310C0  00402021   ADDU A0, V0, ZERO
9D0310C4  00002821   ADDU A1, ZERO, ZERO
9D0310C8  0F4100B4   JAL .Letext0, .LFE0, memset
9D0310CC  24062000   ADDIU A2, ZERO, 8192
9D0310D0  0B40C443   J 0x9D03110C
9D0310D4  00000000   NOP
206:                    }
207:                 
208:                    return 0;
209:                 }
210:                 
211:                 /* If we've got a VS. system game, load in the palette, as well */
212:                 static void rom_checkforpal(rominfo_t *rominfo)
213:                 {
214:                    FILE *fp;
215:                    rgb_t vs_pal[64];
216:                    char filename[PATH_MAX + 1];
217:                    int i;
218:                 
219:                    ASSERT(rominfo);
220:                 
221:                    strncpy(filename, rominfo->filename, PATH_MAX);
222:                    //osd_newextension(filename, ".pal");
223:                 
224:                    fp = fopen(filename, "rb");
225:                    if (NULL == fp)
226:                       return; /* no palette found  */
227:                 
228:                    for (i = 0; i < 64; i++)
229:                    {
230:                       vs_pal[i].r = fgetc(fp);
231:                       vs_pal[i].g = fgetc(fp);
232:                       vs_pal[i].b = fgetc(fp);
233:                    }
234:                 
235:                    fclose(fp);
236:                    /* TODO: this should really be a *SYSTEM* flag */
237:                    rominfo->flags |= ROM_FLAG_VERSUS;
238:                    /* TODO: bad, BAD idea, calling nes_getcontextptr... */
239:                    ppu_setpal(nes_getcontextptr()->ppu, vs_pal);
240:                    log_printf("Game specific palette found -- assuming VS. UniSystem\n");
241:                 }
242:                 
243:                 static FILE *rom_findrom(const char *filename, rominfo_t *rominfo)
244:                 {
245:                    FILE *fp;
246:                 
247:                    ASSERT(rominfo);
248:                 
249:                    if (NULL == filename)
9D030954  1080002C   BEQ A0, ZERO, 0x9D030A08
9D030958  3C059D04   LUI A1, -25340
250:                       return NULL;
251:                 
252:                    /* Make a copy of the name so we can extend it */
253:                    //osd_fullname(rominfo->filename, filename);
254:                 
255:                    fp = _fopen(rominfo->filename, "rb");
9D030968  27A40049   ADDIU A0, SP, 73
9D03096C  0F40F363   JAL .Letext0, .LFE12, fopen
9D030970  24A5B8D0   ADDIU A1, A1, -18224
256:                    if (NULL == fp)
9D030974  14400015   BNE V0, ZERO, 0x9D0309CC
9D030978  00408021   ADDU S0, V0, ZERO
257:                    {
258:                       /* Didn't find the file?  Maybe the .NES extension was omitted */
259:                       if (NULL == strrchr(rominfo->filename, '.'))
9D03097C  27A40049   ADDIU A0, SP, 73
9D030980  0F4108DA   JAL .Letext0, .LFE0, strrchr
9D030984  2405002E   ADDIU A1, ZERO, 46
9D030988  1440000A   BNE V0, ZERO, 0x9D0309B4
9D03098C  27A40049   ADDIU A0, SP, 73
260:                          strncat(rominfo->filename, ".nes", PATH_MAX - strlen(rominfo->filename));
9D030990  0F40F2B0   JAL strlen
9D030994  27A40049   ADDIU A0, SP, 73
9D030998  27A40049   ADDIU A0, SP, 73
9D03099C  3C039D04   LUI V1, -25340
9D0309A0  2465B910   ADDIU A1, V1, -18160
9D0309A4  24060200   ADDIU A2, ZERO, 512
9D0309A8  0F4100DE   JAL strncat
9D0309AC  00C23023   SUBU A2, A2, V0
261:                 
262:                       /* this will either return NULL or a valid file pointer */
263:                       fp = _fopen(rominfo->filename, "rb");
9D0309B0  27A40049   ADDIU A0, SP, 73
9D0309B4  3C029D04   LUI V0, -25340
9D0309B8  0F40F363   JAL .Letext0, .LFE12, fopen
9D0309BC  2445B8D0   ADDIU A1, V0, -18224
9D0309C0  00408021   ADDU S0, V0, ZERO
264:                    }
265:                 
266:                    return fp;
267:                 }
268:                 
269:                 /* Add ROM name to a list with dirty headers */
270:                 static int rom_adddirty(char *filename)
271:                 {
272:                 #ifdef NOFRENDO_DEBUG
273:                 #define  MAX_BUFFER_LENGTH    255
274:                    char buffer[MAX_BUFFER_LENGTH + 1];
275:                    bool found = false;
276:                 
277:                    FILE *fp = fopen("dirtyrom.txt", "rt");
278:                    if (NULL == fp)
279:                       return -1;
280:                 
281:                    while (fgets(buffer, MAX_BUFFER_LENGTH, fp))
282:                    {
283:                       if (0 == strncmp(filename, buffer, strlen(filename)))
284:                       {
285:                          found = true;
286:                          break;
287:                       }
288:                    }
289:                 
290:                    if (false == found)
291:                    {
292:                       /* close up the file, open it back up for writing */
293:                       fclose(fp);
294:                       fp = fopen("dirtyrom.txt", "at");
295:                       fprintf(fp, "%s -- dirty header\n", filename);
296:                    }
297:                 
298:                    fclose(fp);
299:                 #endif /* NOFRENDO_DEBUG */
300:                 
301:                    return 0;
302:                 }
303:                 
304:                 /* return 0 if this *is* an iNES file */
305:                 int rom_checkmagic(const char *filename)
306:                 {
9D03095C  27BDFDA8   ADDIU SP, SP, -600
9D030960  AFBF0254   SW RA, 596(SP)
9D030964  AFB00250   SW S0, 592(SP)
307:                    inesheader_t head;
308:                    rominfo_t rominfo;
309:                    FILE *fp;
310:                 
311:                    fp = rom_findrom(filename, &rominfo);
312:                    if (NULL == fp)
9D0309C4  12000012   BEQ S0, ZERO, 0x9D030A10
9D0309C8  2402FFFF   ADDIU V0, ZERO, -1
313:                       return -1;
9D030A08  03E00008   JR RA
9D030A0C  2402FFFF   ADDIU V0, ZERO, -1
314:                 
315:                    _fread(&head, 1, sizeof(head), fp);
9D0309CC  27A40010   ADDIU A0, SP, 16
9D0309D0  24050001   ADDIU A1, ZERO, 1
9D0309D4  24060010   ADDIU A2, ZERO, 16
9D0309D8  0F40E52C   JAL .Letext0, .LFE1, fread
9D0309DC  02003821   ADDU A3, S0, ZERO
316:                 
317:                    _fclose(fp);
9D0309E0  0F4102B5   JAL .Letext0, .LFE1, fclose
9D0309E4  02002021   ADDU A0, S0, ZERO
318:                 
319:                    if (0 == memcmp(head.ines_magic, ROM_INES_MAGIC, 4))
9D0309E8  27A40010   ADDIU A0, SP, 16
9D0309EC  3C079D04   LUI A3, -25340
9D0309F0  24E5B918   ADDIU A1, A3, -18152
9D0309F4  0F410244   JAL .LFE0, memcmp
9D0309F8  24060004   ADDIU A2, ZERO, 4
9D0309FC  0002202B   SLTU A0, ZERO, V0
9D030A00  0B40C284   J 0x9D030A10
9D030A04  00041023   SUBU V0, ZERO, A0
320:                       /* not an iNES file */
321:                       return 0;
322:                 
323:                    return -1;
324:                 }
9D030A10  8FBF0254   LW RA, 596(SP)
9D030A14  8FB00250   LW S0, 592(SP)
9D030A18  03E00008   JR RA
9D030A1C  27BD0258   ADDIU SP, SP, 600
325:                 
326:                 static int rom_getheader(unsigned char **rom, rominfo_t *rominfo)
327:                 {
328:                 #define  RESERVED_LENGTH   8
329:                    inesheader_t head;
330:                    uint8 reserved[RESERVED_LENGTH];
331:                    bool header_dirty;
332:                 
333:                    ASSERT(rom);
334:                    ASSERT(*rom);
335:                    ASSERT(rominfo);
336:                 
337:                    /* Read in the header */
338:                 //   _fread(&head, 1, sizeof(head), fp);
339:                 	printf("Head: %p (%x %x %x %x)\n", *rom, (*rom)[0], (*rom)[1], (*rom)[2], (*rom)[3]);
9D030D08  92060000   LBU A2, 0(S0)
9D030D0C  92070001   LBU A3, 1(S0)
9D030D10  92020002   LBU V0, 2(S0)
9D030D14  AFA20010   SW V0, 16(SP)
9D030D18  92030003   LBU V1, 3(S0)
9D030D1C  AFA30014   SW V1, 20(SP)
9D030D20  3C049D04   LUI A0, -25340
9D030D24  2484B980   ADDIU A0, A0, -18048
9D030D28  0F4107C1   JAL _printf_cdnopuxX
9D030D2C  02002821   ADDU A1, S0, ZERO
340:                 	memcpy(&head, *rom, sizeof(head));
9D030D30  8A050003   LWL A1, 3(S0)
9D030D34  9A050000   LWR A1, 0(S0)
9D030D38  8A060007   LWL A2, 7(S0)
9D030D3C  9A060004   LWR A2, 4(S0)
9D030D40  8A07000B   LWL A3, 11(S0)
9D030D44  9A070008   LWR A3, 8(S0)
9D030D48  8A08000F   LWL T0, 15(S0)
9D030D4C  9A08000C   LWR T0, 12(S0)
9D030D50  AFA5001C   SW A1, 28(SP)
9D030D54  AFA60020   SW A2, 32(SP)
9D030D58  AFA70024   SW A3, 36(SP)
9D030D5C  AFA80028   SW T0, 40(SP)
341:                 	*rom+=sizeof(head);
9D030D60  26100010   ADDIU S0, S0, 16
342:                 
343:                    if (memcmp(head.ines_magic, ROM_INES_MAGIC, 4))
9D030D64  27A4001C   ADDIU A0, SP, 28
9D030D68  3C099D04   LUI T1, -25340
9D030D6C  2525B918   ADDIU A1, T1, -18152
9D030D70  0F410244   JAL .LFE0, memcmp
9D030D74  24060004   ADDIU A2, ZERO, 4
9D030D78  10400008   BEQ V0, ZERO, 0x9D030D9C
9D030D7C  93AA0020   LBU T2, 32(SP)
344:                    {
345:                       gui_sendmsg(GUI_RED, "%s is not a valid ROM image", rominfo->filename);
9D030D80  240400C5   ADDIU A0, ZERO, 197
9D030D84  3C189D04   LUI T8, -25340
9D030D88  2705B998   ADDIU A1, T8, -18024
9D030D8C  0F408633   JAL gui_sendmsg
9D030D90  26260029   ADDIU A2, S1, 41
9D030D94  0B40C436   J .L47
9D030D98  00000000   NOP
346:                       return -1;
347:                    }
348:                 
349:                    rominfo->rom_banks = head.rom_banks;
9D030D9C  AE2A0010   SW T2, 16(S1)
350:                    rominfo->vrom_banks = head.vrom_banks;
9D030DA0  93AB0021   LBU T3, 33(SP)
9D030DA4  AE2B0014   SW T3, 20(S1)
351:                    /* iNES assumptions */
352:                    rominfo->sram_banks = 8; /* 1kB banks, so 8KB */
9D030DA8  240C0008   ADDIU T4, ZERO, 8
9D030DAC  AE2C0018   SW T4, 24(S1)
353:                    rominfo->vram_banks = 1; /* 8kB banks, so 8KB */
9D030DB0  240D0001   ADDIU T5, ZERO, 1
9D030DB4  AE2D001C   SW T5, 28(S1)
354:                    rominfo->mirror = (head.rom_type & ROM_MIRRORTYPE) ? MIRROR_VERT : MIRROR_HORIZ;
9D030DB8  93AE0022   LBU T6, 34(SP)
9D030DBC  31CF0001   ANDI T7, T6, 1
355:                    rominfo->flags = 0;
9D030DD0  0B40C378   J 0x9D030DE0
9D030DD4  A2200028   SB ZERO, 40(S1)
356:                    if (head.rom_type & ROM_BATTERY)
9D030DC0  31D20002   ANDI S2, T6, 2
9D030DC4  325800FF   ANDI T8, S2, 255
9D030DC8  17000003   BNE T8, ZERO, 0x9D030DD8
9D030DCC  AE2F0024   SW T7, 36(S1)
357:                       rominfo->flags |= ROM_FLAG_BATTERY;
9D030DD8  24190001   ADDIU T9, ZERO, 1
9D030DDC  A2390028   SB T9, 40(S1)
358:                    if (head.rom_type & ROM_TRAINER)
9D030DE0  31DF0004   ANDI RA, T6, 4
9D030DE4  33E200FF   ANDI V0, RA, 255
9D030DE8  10400004   BEQ V0, ZERO, 0x9D030DFC
9D030DEC  31C50008   ANDI A1, T6, 8
359:                       rominfo->flags |= ROM_FLAG_TRAINER;
9D030DF0  92230028   LBU V1, 40(S1)
9D030DF4  34640002   ORI A0, V1, 2
9D030DF8  A2240028   SB A0, 40(S1)
360:                    if (head.rom_type & ROM_FOURSCREEN)
9D030DFC  30A600FF   ANDI A2, A1, 255
9D030E00  10C00004   BEQ A2, ZERO, 0x9D030E14
9D030E04  000E9102   SRL S2, T6, 4
361:                       rominfo->flags |= ROM_FLAG_FOURSCREEN;
9D030E08  92270028   LBU A3, 40(S1)
9D030E0C  34E80004   ORI T0, A3, 4
9D030E10  A2280028   SB T0, 40(S1)
362:                    /* TODO: fourscreen a mirroring type? */
363:                    rominfo->mapper_number = head.rom_type >> 4;
9D030E14  AE320020   SW S2, 32(S1)
364:                 
365:                    /* Do a compare - see if we've got a clean extended header */
366:                    memset(reserved, 0, RESERVED_LENGTH);
9D030E18  AFA0002C   SW ZERO, 44(SP)
9D030E1C  AFA00030   SW ZERO, 48(SP)
367:                    if (0 == memcmp(head.reserved, reserved, RESERVED_LENGTH))
9D030E20  27A40024   ADDIU A0, SP, 36
9D030E24  27A5002C   ADDIU A1, SP, 44
9D030E28  0F410244   JAL .LFE0, memcmp
9D030E2C  24060008   ADDIU A2, ZERO, 8
9D030E30  54400006   BNEL V0, ZERO, 0x9D030E4C
9D030E34  93B20023   LBU S2, 35(SP)
368:                    {
369:                       /* We were clean */
370:                       header_dirty = false;
371:                       rominfo->mapper_number |= (head.mapper_hinybble & 0xF0);
9D030E38  93B80023   LBU T8, 35(SP)
9D030E3C  331900F0   ANDI T9, T8, 240
9D030E40  0332F825   OR RA, T9, S2
9D030E44  0B40C3A8   J 0x9D030EA0
9D030E48  AE3F0020   SW RA, 32(S1)
372:                    }
373:                    else
374:                    {
375:                       header_dirty = true;
376:                 
377:                       /* @!?#@! DiskDude. */
378:                       if (('D' == head.mapper_hinybble) && (0 == memcmp(head.reserved, "iskDude!", 8)))
9D030E4C  24090044   ADDIU T1, ZERO, 68
9D030E50  1649000D   BNE S2, T1, 0x9D030E88
9D030E54  3C0B9D04   LUI T3, -25340
9D030E58  27A40024   ADDIU A0, SP, 36
9D030E5C  3C0A9D04   LUI T2, -25340
9D030E60  2545B9B4   ADDIU A1, T2, -17996
9D030E64  0F410244   JAL .LFE0, memcmp
9D030E68  24060008   ADDIU A2, ZERO, 8
9D030E6C  14400006   BNE V0, ZERO, 0x9D030E88
9D030E70  3C0B9D04   LUI T3, -25340
379:                          log_printf("`DiskDude!' found in ROM header, ignoring high mapper nybble\n");
9D030E74  3C0F9D04   LUI T7, -25340
9D030E78  0F410817   JAL log_printf
9D030E7C  25E4B9C0   ADDIU A0, T7, -17984
380:                       else
381:                       {
382:                          log_printf("ROM header dirty, possible problem\n");
9D030E88  0F410817   JAL log_printf
9D030E8C  2564BA00   ADDIU A0, T3, -17920
383:                          rominfo->mapper_number |= (head.mapper_hinybble & 0xF0);
9D030E90  324C00F0   ANDI T4, S2, 240
9D030E94  8E2D0020   LW T5, 32(S1)
9D030E98  01AC7025   OR T6, T5, T4
9D030E9C  AE2E0020   SW T6, 32(S1)
384:                       }
385:                 
386:                       rom_adddirty(rominfo->filename);
387:                    }
388:                 
389:                    /* TODO: this is an ugly hack, but necessary, I guess */
390:                    /* Check for VS unisystem mapper */
391:                    if (99 == rominfo->mapper_number)
9D030E80  0B40C3A9   J 0x9D030EA4
9D030E84  8E230020   LW V1, 32(S1)
9D030EA0  8E230020   LW V1, 32(S1)
9D030EA4  24020063   ADDIU V0, ZERO, 99
9D030EA8  54620092   BNEL V1, V0, 0x9D0310F4
9D030EAC  8FB10018   LW S1, 24(SP)
392:                       rominfo->flags |= ROM_FLAG_VERSUS;
9D030EB0  92240028   LBU A0, 40(S1)
9D030EB4  34850008   ORI A1, A0, 8
9D030EB8  0B40C43C   J 0x9D0310F0
9D030EBC  A2250028   SB A1, 40(S1)
393:                 
394:                    return 0;
395:                 }
396:                 
397:                 /* Build the info string for ROM display */
398:                 char *rom_getinfo(rominfo_t *rominfo)
399:                 {
9D030A20  27BDFBD0   ADDIU SP, SP, -1072
9D030A24  AFBF042C   SW RA, 1068(SP)
9D030A28  AFB10428   SW S1, 1064(SP)
9D030A2C  AFB00424   SW S0, 1060(SP)
9D030A30  00808021   ADDU S0, A0, ZERO
400:                    static char info[PATH_MAX + 1];
401:                    char romname[PATH_MAX + 1], temp[PATH_MAX + 1];
402:                 
403:                    /* Look to see if we were given a path along with filename */
404:                    /* TODO: strip extensions */
405:                    if (strrchr(rominfo->filename, PATH_SEP))
9D030A34  24910029   ADDIU S1, A0, 41
9D030A38  02202021   ADDU A0, S1, ZERO
9D030A3C  0F4108DA   JAL .Letext0, .LFE0, strrchr
9D030A40  2405002F   ADDIU A1, ZERO, 47
9D030A44  10400006   BEQ V0, ZERO, 0x9D030A60
9D030A48  24450001   ADDIU A1, V0, 1
406:                       strncpy(romname, strrchr(rominfo->filename, PATH_SEP) + 1, PATH_MAX);
9D030A4C  27A40018   ADDIU A0, SP, 24
9D030A50  0F40FA4F   JAL .LFE23, strncpy
9D030A54  24060200   ADDIU A2, ZERO, 512
9D030A58  0B40C29C   J .LVL34
9D030A5C  00000000   NOP
407:                    else
408:                       strncpy(romname, rominfo->filename, PATH_MAX);
9D030A60  27A40018   ADDIU A0, SP, 24
9D030A64  02202821   ADDU A1, S1, ZERO
9D030A68  0F40FA4F   JAL .LFE23, strncpy
9D030A6C  24060200   ADDIU A2, ZERO, 512
409:                 
410:                    /* If our filename is too long, truncate our displayed filename */
411:                    if (strlen(romname) > ROM_DISP_MAXLEN)
9D030A70  0F40F2B0   JAL strlen
9D030A74  27A40018   ADDIU A0, SP, 24
9D030A78  2C420015   SLTIU V0, V0, 21
9D030A7C  5440000D   BNEL V0, ZERO, 0x9D030AB4
9D030A80  3C04A001   LUI A0, -24575
412:                    {
413:                       strncpy(info, romname, ROM_DISP_MAXLEN - 3);
9D030A84  3C03A001   LUI V1, -24575
9D030A88  246441E4   ADDIU A0, V1, 16868
9D030A8C  27A50018   ADDIU A1, SP, 24
9D030A90  0F40FA4F   JAL .LFE23, strncpy
9D030A94  24060011   ADDIU A2, ZERO, 17
414:                       strcpy(info + (ROM_DISP_MAXLEN - 3), "...");
9D030A98  3C05A001   LUI A1, -24575
9D030A9C  3C069D04   LUI A2, -25340
9D030AA0  8CC7B920   LW A3, -18144(A2)
9D030AA4  24A841F5   ADDIU T0, A1, 16885
9D030AA8  A9070003   SWL A3, 3(T0)
9D030AAC  0B40C2B0   J .LVL37
9D030AB0  B8A741F5   SWR A3, 16885(A1)
415:                    }
416:                    else
417:                    {
418:                       strcpy(info, romname);
9D030AB4  248441E4   ADDIU A0, A0, 16868
9D030AB8  0F40EFF7   JAL .LFE23, strcpy
9D030ABC  27A50018   ADDIU A1, SP, 24
419:                    }
420:                 
421:                    sprintf(temp, " [%d] %dk/%dk %c", rominfo->mapper_number,
9D030AC0  8E060020   LW A2, 32(S0)
9D030AC4  8E090010   LW T1, 16(S0)
9D030AC8  8E0A0014   LW T2, 20(S0)
9D030ACC  000A58C0   SLL T3, T2, 3
9D030AD0  8E0C0024   LW T4, 36(S0)
9D030AD4  398D0001   XORI T5, T4, 1
9D030AD8  240E0056   ADDIU T6, ZERO, 86
9D030ADC  240F0048   ADDIU T7, ZERO, 72
9D030AE0  01ED700B   MOVN T6, T7, T5
9D030AE4  AFAB0010   SW T3, 16(SP)
9D030AE8  AFAE0014   SW T6, 20(SP)
9D030AEC  27A4021C   ADDIU A0, SP, 540
9D030AF0  3C199D04   LUI T9, -25340
9D030AF4  2725B924   ADDIU A1, T9, -18140
9D030AF8  0F4104E0   JAL _sprintf_cdnopuxX, _sprintf_cdnopsuxX
9D030AFC  00093900   SLL A3, T1, 4
422:                            rominfo->rom_banks * 16, rominfo->vrom_banks * 8,
423:                            (rominfo->mirror == MIRROR_VERT) ? 'V' : 'H');
424:                    
425:                    /* Stick it on there! */
426:                    strncat(info, temp, PATH_MAX - strlen(info));
9D030B00  3C11A001   LUI S1, -24575
9D030B04  0F40F2B0   JAL strlen
9D030B08  262441E4   ADDIU A0, S1, 16868
9D030B0C  262441E4   ADDIU A0, S1, 16868
9D030B10  27A5021C   ADDIU A1, SP, 540
9D030B14  24030200   ADDIU V1, ZERO, 512
9D030B18  0F4100DE   JAL strncat
9D030B1C  00623023   SUBU A2, V1, V0
427:                 
428:                    if (rominfo->flags & ROM_FLAG_BATTERY)
9D030B20  92020028   LBU V0, 40(S0)
9D030B24  30440001   ANDI A0, V0, 1
9D030B28  5080000A   BEQL A0, ZERO, 0x9D030B54
9D030B2C  921F0028   LBU RA, 40(S0)
429:                       strncat(info, "B", PATH_MAX - strlen(info));
9D030B30  0F40F2B0   JAL strlen
9D030B34  262441E4   ADDIU A0, S1, 16868
9D030B38  262441E4   ADDIU A0, S1, 16868
9D030B3C  3C059D04   LUI A1, -25340
9D030B40  24A5B938   ADDIU A1, A1, -18120
9D030B44  24060200   ADDIU A2, ZERO, 512
9D030B48  0F4100DE   JAL strncat
9D030B4C  00C23023   SUBU A2, A2, V0
430:                    if (rominfo->flags & ROM_FLAG_TRAINER)
9D030B50  921F0028   LBU RA, 40(S0)
9D030B54  33E70002   ANDI A3, RA, 2
9D030B58  30E800FF   ANDI T0, A3, 255
9D030B5C  5100000B   BEQL T0, ZERO, 0x9D030B8C
9D030B60  92100028   LBU S0, 40(S0)
431:                       strncat(info, "T", PATH_MAX - strlen(info));
9D030B64  3C11A001   LUI S1, -24575
9D030B68  0F40F2B0   JAL strlen
9D030B6C  262441E4   ADDIU A0, S1, 16868
9D030B70  262441E4   ADDIU A0, S1, 16868
9D030B74  3C099D04   LUI T1, -25340
9D030B78  2525B93C   ADDIU A1, T1, -18116
9D030B7C  240A0200   ADDIU T2, ZERO, 512
9D030B80  0F4100DE   JAL strncat
9D030B84  01423023   SUBU A2, T2, V0
432:                    if (rominfo->flags & ROM_FLAG_FOURSCREEN)
9D030B88  92100028   LBU S0, 40(S0)
9D030B8C  320B0004   ANDI T3, S0, 4
9D030B90  316C00FF   ANDI T4, T3, 255
9D030B94  1180000B   BEQ T4, ZERO, 0x9D030BC4
9D030B98  3C0FA001   LUI T7, -24575
433:                       strncat(info, "4", PATH_MAX - strlen(info));
9D030B9C  3C11A001   LUI S1, -24575
9D030BA0  0F40F2B0   JAL strlen
9D030BA4  262441E4   ADDIU A0, S1, 16868
9D030BA8  262441E4   ADDIU A0, S1, 16868
9D030BAC  3C0D9D04   LUI T5, -25340
9D030BB0  25A5B940   ADDIU A1, T5, -18112
9D030BB4  240E0200   ADDIU T6, ZERO, 512
9D030BB8  0F4100DE   JAL strncat
9D030BBC  01C23023   SUBU A2, T6, V0
434:                 
435:                    return info;
436:                 }
9D030BC0  3C0FA001   LUI T7, -24575
9D030BC4  25E241E4   ADDIU V0, T7, 16868
9D030BC8  8FBF042C   LW RA, 1068(SP)
9D030BCC  8FB10428   LW S1, 1064(SP)
9D030BD0  8FB00424   LW S0, 1060(SP)
9D030BD4  03E00008   JR RA
9D030BD8  27BD0430   ADDIU SP, SP, 1072
437:                 
438:                 /* Load a ROM image into memory */
439:                 rominfo_t *rom_load(const char *rom)
440:                 {
9D030CCC  27BDFFB8   ADDIU SP, SP, -72
9D030CD0  AFBF0044   SW RA, 68(SP)
9D030CD4  AFB20040   SW S2, 64(SP)
9D030CD8  AFB1003C   SW S1, 60(SP)
9D030CDC  AFB00038   SW S0, 56(SP)
9D030CE0  00808021   ADDU S0, A0, ZERO
441:                    rominfo_t *rominfo;
442:                 
443:                    rominfo = malloc(sizeof(rominfo_t));
9D030CE4  0F40F30A   JAL _my_malloc
9D030CE8  2404022C   ADDIU A0, ZERO, 556
444:                    if (NULL == rominfo)
9D030CEC  104000FE   BEQ V0, ZERO, 0x9D0310E8
9D030CF0  AFA20018   SW V0, 24(SP)
445:                       return NULL;
9D0310E8  0B40C44D   J 0x9D031134
9D0310EC  00001021   ADDU V0, ZERO, ZERO
446:                 
447:                    memset(rominfo, 0, sizeof(rominfo_t));
9D030CF4  00402021   ADDU A0, V0, ZERO
9D030CF8  00002821   ADDU A1, ZERO, ZERO
9D030CFC  0F4100B4   JAL .Letext0, .LFE0, memset
9D030D00  2406022C   ADDIU A2, ZERO, 556
448:                 
449:                    /* Get the header and stick it into rominfo struct */
450:                 	if (rom_getheader(&rom, rominfo))
9D030D04  8FB10018   LW S1, 24(SP)
451:                       goto _fail;
452:                 
453:                    /* Make sure we really support the mapper */
454:                    if (false == mmc_peek(rominfo->mapper_number))
9D0310F0  8FB10018   LW S1, 24(SP)
9D0310F4  0F40CAEF   JAL mmc_peek
9D0310F8  8E240020   LW A0, 32(S1)
9D0310FC  1440FF77   BNE V0, ZERO, .LBB24
9D031100  8FB20018   LW S2, 24(SP)
9D031104  0B40C3B0   J 0x9D030EC0
9D031108  240400C5   ADDIU A0, ZERO, 197
455:                    {
456:                       gui_sendmsg(GUI_RED, "Mapper %d not yet implemented", rominfo->mapper_number);
9D030EC0  3C0A9D04   LUI T2, -25340
9D030EC4  2545BA24   ADDIU A1, T2, -17884
9D030EC8  8FAF0018   LW T7, 24(SP)
9D030ECC  0F408633   JAL gui_sendmsg
9D030ED0  8DE60020   LW A2, 32(T7)
457:                       goto _fail;
9D030ED4  0B40C436   J .L47
9D030ED8  00000000   NOP
458:                    }
459:                 
460:                    /* iNES format doesn't tell us if we need SRAM, so
461:                    ** we have to always allocate it -- bleh!
462:                    ** UNIF, TAKE ME AWAY!  AAAAAAAAAA!!!
463:                    */
464:                    if (rom_allocsram(rominfo))
465:                       goto _fail;
466:                 
467:                       rom_loadtrainer(&rom, rominfo);
9D030F1C  8FA80018   LW T0, 24(SP)
468:                 
469:                 	if (rom_loadrom(&rom, rominfo))
9D031074  8FB10018   LW S1, 24(SP)
470:                       goto _fail;
471:                 
472:                    rom_loadsram(rominfo);
9D03110C  0F40C211   JAL .LFB6, rom_loadsram, .Ltext0, .Letext0, .LFE17
9D031110  8FA40018   LW A0, 24(SP)
473:                 
474:                    /* See if there's a palette we can load up */
475:                 //   rom_checkforpal(rominfo);
476:                 
477:                    gui_sendmsg(GUI_GREEN, "ROM loaded: %s", rom_getinfo(rominfo));
9D031114  0F40C288   JAL rom_getinfo
9D031118  8FA40018   LW A0, 24(SP)
9D03111C  240400C6   ADDIU A0, ZERO, 198
9D031120  3C0C9D04   LUI T4, -25340
9D031124  2585BAB0   ADDIU A1, T4, -17744
9D031128  0F408633   JAL gui_sendmsg
9D03112C  00403021   ADDU A2, V0, ZERO
478:                 
479:                    return rominfo;
9D031130  8FA20018   LW V0, 24(SP)
480:                 
481:                 _fail:
482:                    rom_free(&rominfo);
9D0310D8  0F40C2F7   JAL rom_free
9D0310DC  27A40018   ADDIU A0, SP, 24
483:                    return NULL;
9D0310E0  0B40C44D   J 0x9D031134
9D0310E4  00001021   ADDU V0, ZERO, ZERO
484:                 }
9D031134  8FBF0044   LW RA, 68(SP)
9D031138  8FB20040   LW S2, 64(SP)
9D03113C  8FB1003C   LW S1, 60(SP)
9D031140  8FB00038   LW S0, 56(SP)
9D031144  03E00008   JR RA
9D031148  27BD0048   ADDIU SP, SP, 72
485:                 
486:                 /* Free a ROM */
487:                 void rom_free(rominfo_t **rominfo)
488:                 {
9D030BDC  27BDFFE8   ADDIU SP, SP, -24
9D030BE0  AFBF0014   SW RA, 20(SP)
9D030BE4  AFB00010   SW S0, 16(SP)
489:                    if (NULL == *rominfo)
9D030BE8  8C820000   LW V0, 0(A0)
9D030BEC  14400007   BNE V0, ZERO, 0x9D030C0C
9D030BF0  00808021   ADDU S0, A0, ZERO
490:                    {
491:                       gui_sendmsg(GUI_GREEN, "ROM not loaded");
9D030BF4  240400C6   ADDIU A0, ZERO, 198
9D030BF8  3C0F9D04   LUI T7, -25340
9D030BFC  0F408633   JAL gui_sendmsg
9D030C00  25E5B944   ADDIU A1, T7, -18108
492:                       return;
9D030C04  0B40C330   J 0x9D030CC0
9D030C08  8FBF0014   LW RA, 20(SP)
493:                    }
494:                 
495:                    /* Restore palette if we loaded in a VS jobber */
496:                    if ((*rominfo)->flags & ROM_FLAG_VERSUS)
9D030C0C  90430028   LBU V1, 40(V0)
9D030C10  30640008   ANDI A0, V1, 8
9D030C14  308500FF   ANDI A1, A0, 255
9D030C18  10A00008   BEQ A1, ZERO, .LVL55
9D030C1C  00000000   NOP
497:                    {
498:                       /* TODO: bad idea calling nes_getcontextptr... */
499:                       ppu_setdefaultpal(nes_getcontextptr()->ppu);
9D030C20  0F4097E7   JAL nes_getcontextptr
9D030C24  00000000   NOP
9D030C28  0F405C58   JAL ppu_setdefaultpal
9D030C2C  8C440304   LW A0, 772(V0)
500:                       log_printf("Default NES palette restored\n");
9D030C30  3C069D04   LUI A2, -25340
9D030C34  0F410817   JAL log_printf
9D030C38  24C4B954   ADDIU A0, A2, -18092
501:                    }
502:                 
503:                    rom_savesram(*rominfo);
9D030C3C  0F40C233   JAL .LFB5, rom_savesram, .LFE6
9D030C40  8E040000   LW A0, 0(S0)
504:                 
505:                    if ((*rominfo)->sram)
9D030C44  8E070000   LW A3, 0(S0)
9D030C48  8CE80008   LW T0, 8(A3)
9D030C4C  51000004   BEQL T0, ZERO, 0x9D030C60
9D030C50  8E040000   LW A0, 0(S0)
506:                       free((*rominfo)->sram);
9D030C54  0F40F31D   JAL _my_free
9D030C58  24E40008   ADDIU A0, A3, 8
507:                    if ((*rominfo)->rom)
9D030C5C  8E040000   LW A0, 0(S0)
9D030C60  8C890000   LW T1, 0(A0)
9D030C64  51200004   BEQL T1, ZERO, 0x9D030C78
9D030C68  8E0A0000   LW T2, 0(S0)
508:                       free((*rominfo)->rom);
9D030C6C  0F40F31D   JAL _my_free
9D030C70  00000000   NOP
509:                    if ((*rominfo)->vrom)
9D030C74  8E0A0000   LW T2, 0(S0)
9D030C78  8D4B0004   LW T3, 4(T2)
9D030C7C  51600004   BEQL T3, ZERO, 0x9D030C90
9D030C80  8E0C0000   LW T4, 0(S0)
510:                       free((*rominfo)->vrom);
9D030C84  0F40F31D   JAL _my_free
9D030C88  25440004   ADDIU A0, T2, 4
511:                    if ((*rominfo)->vram)
9D030C8C  8E0C0000   LW T4, 0(S0)
9D030C90  8D8D000C   LW T5, 12(T4)
9D030C94  11A00003   BEQ T5, ZERO, .LVL60
9D030C98  00000000   NOP
512:                       free((*rominfo)->vram);
9D030C9C  0F40F31D   JAL _my_free
9D030CA0  2584000C   ADDIU A0, T4, 12
513:                 
514:                    free(*rominfo);
9D030CA4  0F40F31D   JAL _my_free
9D030CA8  02002021   ADDU A0, S0, ZERO
515:                 
516:                    gui_sendmsg(GUI_GREEN, "ROM freed");
9D030CAC  240400C6   ADDIU A0, ZERO, 198
9D030CB0  3C0E9D04   LUI T6, -25340
9D030CB4  0F408633   JAL gui_sendmsg
9D030CB8  25C5B974   ADDIU A1, T6, -18060
517:                 }
9D030CBC  8FBF0014   LW RA, 20(SP)
9D030CC0  8FB00010   LW S0, 16(SP)
9D030CC4  03E00008   JR RA
9D030CC8  27BD0018   ADDIU SP, SP, 24
518:                 
519:                 /*
520:                 ** $Log: nes_rom.c,v $
521:                 ** Revision 1.2  2001/04/27 14:37:11  neil
522:                 ** wheeee
523:                 **
524:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
525:                 ** initial
526:                 **
527:                 ** Revision 1.8  2000/11/21 13:28:40  matt
528:                 ** take care to zero allocated mem
529:                 **
530:                 ** Revision 1.7  2000/11/09 14:07:28  matt
531:                 ** state load fixed, state save mostly fixed
532:                 **
533:                 ** Revision 1.6  2000/10/28 14:24:54  matt
534:                 ** where did I put that underscore?
535:                 **
536:                 ** Revision 1.5  2000/10/27 12:56:35  matt
537:                 ** api change for ppu palette functions
538:                 **
539:                 ** Revision 1.4  2000/10/26 22:51:44  matt
540:                 ** correct NULL filename handling
541:                 **
542:                 ** Revision 1.3  2000/10/25 01:23:08  matt
543:                 ** basic system autodetection
544:                 **
545:                 ** Revision 1.2  2000/10/25 00:23:16  matt
546:                 ** makefiles updated for new directory structure
547:                 **
548:                 ** Revision 1.1  2000/10/24 12:20:28  matt
549:                 ** changed directory structure
550:                 **
551:                 ** Revision 1.19  2000/10/21 14:35:58  matt
552:                 ** typo
553:                 **
554:                 ** Revision 1.18  2000/10/17 03:22:37  matt
555:                 ** cleaning up rom module
556:                 **
557:                 ** Revision 1.17  2000/10/10 13:58:13  matt
558:                 ** stroustrup squeezing his way in the door
559:                 **
560:                 ** Revision 1.16  2000/10/10 13:03:54  matt
561:                 ** Mr. Clean makes a guest appearance
562:                 **
563:                 ** Revision 1.15  2000/07/31 04:28:46  matt
564:                 ** one million cleanups
565:                 **
566:                 ** Revision 1.14  2000/07/30 04:31:26  matt
567:                 ** automagic loading of the nofrendo intro
568:                 **
569:                 ** Revision 1.13  2000/07/25 02:20:58  matt
570:                 ** cleanups
571:                 **
572:                 ** Revision 1.12  2000/07/20 01:53:27  matt
573:                 ** snprintf() ain't no standard function, eh?
574:                 **
575:                 ** Revision 1.11  2000/07/19 16:06:54  neil
576:                 ** little error fixed (tempinfo vs rominfo->info)
577:                 **
578:                 ** Revision 1.10  2000/07/19 15:59:39  neil
579:                 ** PATH_MAX, strncpy, snprintf, and strncat are our friends
580:                 **
581:                 ** Revision 1.9  2000/07/17 01:52:27  matt
582:                 ** made sure last line of all source files is a newline
583:                 **
584:                 ** Revision 1.8  2000/07/06 16:47:50  matt
585:                 ** new ppu palette setting calls
586:                 **
587:                 ** Revision 1.7  2000/07/05 23:21:54  neil
588:                 ** fclose(fp) should not be done if fp == NULL
589:                 **
590:                 ** Revision 1.6  2000/07/04 04:45:14  matt
591:                 ** changed include
592:                 **
593:                 ** Revision 1.5  2000/06/26 04:56:10  matt
594:                 ** minor cleanup
595:                 **
596:                 ** Revision 1.4  2000/06/09 15:12:25  matt
597:                 ** initial revision
598:                 **
599:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/nes/nes_ppu.c  -----------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** nes_ppu.c
21:                  **
22:                  ** NES PPU emulation
23:                  ** $Id: nes_ppu.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <string.h>
27:                  #include <stdlib.h>
28:                  #include <noftypes.h>
29:                  #include <nes_ppu.h>
30:                  #include <nes.h>
31:                  #include <gui.h>
32:                  #include "nes6502.h"
33:                  #include <log.h>
34:                  #include <nes_mmc.h>
35:                  
36:                  #include <bitmap.h>
37:                  #include <vid_drv.h>
38:                  #include <nes_pal.h>
39:                  #include <nesinput.h>
40:                  
41:                  
42:                  /* PPU access */
43:                  #define  PPU_MEM(x)           ppu.page[(x) >> 10][(x)]
44:                  
45:                  /* Background (color 0) and solid sprite pixel flags */
46:                  #define  BG_TRANS             0x80
47:                  #define  SP_PIXEL             0x40
48:                  #define  BG_CLEAR(V)          ((V) & BG_TRANS)
49:                  #define  BG_SOLID(V)          (0 == BG_CLEAR(V))
50:                  #define  SP_CLEAR(V)          (0 == ((V) & SP_PIXEL))
51:                  
52:                  /* Full BG color */
53:                  #define  FULLBG               (ppu.palette[0] | BG_TRANS)
54:                  
55:                  /* the NES PPU */
56:                  static ppu_t ppu;
57:                  
58:                  
59:                  void ppu_displaysprites(bool display)
60:                  {
61:                     ppu.drawsprites = display;
9D015DFC  3C02A001   LUI V0, -24575
9D015E00  03E00008   JR RA
9D015E04  AC44200C   SW A0, 8204(V0)
62:                  }
63:                  
64:                  void ppu_setcontext(ppu_t *src_ppu)
65:                  {
66:                     int nametab[4];
67:                     ASSERT(src_ppu);
68:                     ppu = *src_ppu;
9D015E08  3C02A001   LUI V0, -24575
9D015E0C  24490258   ADDIU T1, V0, 600
9D015E10  248A1DB0   ADDIU T2, A0, 7600
9D015E14  8C880000   LW T0, 0(A0)
9D015E18  8C870004   LW A3, 4(A0)
9D015E1C  8C860008   LW A2, 8(A0)
9D015E20  8C85000C   LW A1, 12(A0)
9D015E24  AD280000   SW T0, 0(T1)
9D015E28  AD270004   SW A3, 4(T1)
9D015E2C  AD260008   SW A2, 8(T1)
9D015E30  AD25000C   SW A1, 12(T1)
9D015E34  248B0010   ADDIU T3, A0, 16
9D015E38  252D0010   ADDIU T5, T1, 16
9D015E3C  8D6F0000   LW T7, 0(T3)
9D015E40  8D780004   LW T8, 4(T3)
9D015E44  8D790008   LW T9, 8(T3)
9D015E48  8D63000C   LW V1, 12(T3)
9D015E4C  ADAF0000   SW T7, 0(T5)
9D015E50  ADB80004   SW T8, 4(T5)
9D015E54  ADB90008   SW T9, 8(T5)
9D015E58  ADA3000C   SW V1, 12(T5)
9D015E5C  8D620010   LW V0, 16(T3)
9D015E60  8D690014   LW T1, 20(T3)
9D015E64  8D680018   LW T0, 24(T3)
9D015E68  8D67001C   LW A3, 28(T3)
9D015E6C  ADA20010   SW V0, 16(T5)
9D015E70  ADA90014   SW T1, 20(T5)
9D015E74  ADA80018   SW T0, 24(T5)
9D015E78  ADA7001C   SW A3, 28(T5)
9D015E7C  25690020   ADDIU T1, T3, 32
9D015E80  25A20020   ADDIU V0, T5, 32
9D015E84  8D2B0000   LW T3, 0(T1)
9D015E88  8D2C0004   LW T4, 4(T1)
9D015E8C  8D260008   LW A2, 8(T1)
9D015E90  8D25000C   LW A1, 12(T1)
9D015E94  AC4B0000   SW T3, 0(V0)
9D015E98  AC4C0004   SW T4, 4(V0)
9D015E9C  AC460008   SW A2, 8(V0)
9D015EA0  AC45000C   SW A1, 12(V0)
9D015EA4  252D0010   ADDIU T5, T1, 16
9D015EA8  244E0010   ADDIU T6, V0, 16
9D015EAC  8D2F0010   LW T7, 16(T1)
9D015EB0  8DB80004   LW T8, 4(T5)
9D015EB4  8DB90008   LW T9, 8(T5)
9D015EB8  8DA3000C   LW V1, 12(T5)
9D015EBC  AC4F0010   SW T7, 16(V0)
9D015EC0  ADD80004   SW T8, 4(T6)
9D015EC4  ADD90008   SW T9, 8(T6)
9D015EC8  ADC3000C   SW V1, 12(T6)
9D015ECC  8DA20010   LW V0, 16(T5)
9D015ED0  8DA90014   LW T1, 20(T5)
9D015ED4  8DA80018   LW T0, 24(T5)
9D015ED8  8DA7001C   LW A3, 28(T5)
9D015EDC  ADC20010   SW V0, 16(T6)
9D015EE0  ADC90014   SW T1, 20(T6)
9D015EE4  ADC80018   SW T0, 24(T6)
9D015EE8  ADC7001C   SW A3, 28(T6)
9D015EEC  8DAB0020   LW T3, 32(T5)
9D015EF0  8DAC0024   LW T4, 36(T5)
9D015EF4  8DA60028   LW A2, 40(T5)
9D015EF8  8DA5002C   LW A1, 44(T5)
9D015EFC  ADCB0020   SW T3, 32(T6)
9D015F00  ADCC0024   SW T4, 36(T6)
9D015F04  ADC60028   SW A2, 40(T6)
9D015F08  ADC5002C   SW A1, 44(T6)
9D015F0C  8DAF0030   LW T7, 48(T5)
9D015F10  8DB80034   LW T8, 52(T5)
9D015F14  8DB90038   LW T9, 56(T5)
9D015F18  8DA3003C   LW V1, 60(T5)
9D015F1C  ADCF0030   SW T7, 48(T6)
9D015F20  ADD80034   SW T8, 52(T6)
9D015F24  ADD90038   SW T9, 56(T6)
9D015F28  ADC3003C   SW V1, 60(T6)
9D015F2C  8DA20040   LW V0, 64(T5)
9D015F30  8DA90044   LW T1, 68(T5)
9D015F34  8DA80048   LW T0, 72(T5)
9D015F38  8DA7004C   LW A3, 76(T5)
9D015F3C  ADC20040   SW V0, 64(T6)
9D015F40  ADC90044   SW T1, 68(T6)
9D015F44  ADC80048   SW T0, 72(T6)
9D015F48  ADC7004C   SW A3, 76(T6)
9D015F4C  8DAB0050   LW T3, 80(T5)
9D015F50  8DAC0054   LW T4, 84(T5)
9D015F54  8DA60058   LW A2, 88(T5)
9D015F58  8DA5005C   LW A1, 92(T5)
9D015F5C  ADCB0050   SW T3, 80(T6)
9D015F60  ADCC0054   SW T4, 84(T6)
9D015F64  ADC60058   SW A2, 88(T6)
9D015F68  ADC5005C   SW A1, 92(T6)
9D015F6C  8DAF0060   LW T7, 96(T5)
9D015F70  8DB80064   LW T8, 100(T5)
9D015F74  8DB90068   LW T9, 104(T5)
9D015F78  8DA3006C   LW V1, 108(T5)
9D015F7C  ADCF0060   SW T7, 96(T6)
9D015F80  ADD80064   SW T8, 100(T6)
9D015F84  ADD90068   SW T9, 104(T6)
9D015F88  ADC3006C   SW V1, 108(T6)
9D015F8C  25A90070   ADDIU T1, T5, 112
9D015F90  152AFFBC   BNE T1, T2, 0x9D015E84
9D015F94  25C20070   ADDIU V0, T6, 112
9D015F98  8D2A0000   LW T2, 0(T1)
9D015F9C  8D2D0004   LW T5, 4(T1)
9D015FA0  AC4A0000   SW T2, 0(V0)
9D015FA4  AC4D0004   SW T5, 4(V0)
69:                  
70:                     /* we can't just copy contexts here, because more than likely,
71:                     ** the top 8 pages of the ppu are pointing to internal PPU memory,
72:                     ** which means we need to recalculate the page pointers.
73:                     ** TODO: we can either get rid of the page pointing in the code,
74:                     ** or add more robust checks to make sure that pages 8-15 are
75:                     ** definitely pointing to internal PPU RAM, not just something
76:                     ** that some crazy mapper paged in.
77:                     */
78:                     nametab[0] = (src_ppu->page[8] - src_ppu->nametab + 0x2000) >> 10;
9D015FCC  8C991140   LW T9, 4416(A0)
9D015FD0  03242023   SUBU A0, T9, A0
9D015FD4  24832000   ADDIU V1, A0, 8192
79:                     nametab[1] = (src_ppu->page[9] - src_ppu->nametab + 0x2400) >> 10;
9D015FA8  8C8E1144   LW T6, 4420(A0)
9D015FAC  01C44023   SUBU T0, T6, A0
9D015FB0  250B2400   ADDIU T3, T0, 9216
80:                     nametab[2] = (src_ppu->page[10] - src_ppu->nametab + 0x2800) >> 10;
9D015FB4  8C871148   LW A3, 4424(A0)
9D015FB8  00E46023   SUBU T4, A3, A0
9D015FBC  258F2800   ADDIU T7, T4, 10240
81:                     nametab[3] = (src_ppu->page[11] - src_ppu->nametab + 0x2C00) >> 10;
9D015FC0  8C86114C   LW A2, 4428(A0)
9D015FC4  00C42823   SUBU A1, A2, A0
9D015FC8  24B82C00   ADDIU T8, A1, 11264
82:                  
83:                     ppu.page[8] = ppu.nametab + (nametab[0] << 10) - 0x2000;
9D015FD8  7C034804   INS V1, ZERO, 0, 10
9D015FDC  2469E000   ADDIU T1, V1, -8192
9D015FE0  3C02A001   LUI V0, -24575
9D015FE4  244A0258   ADDIU T2, V0, 600
9D015FE8  01496821   ADDU T5, T2, T1
9D015FEC  AD4D1140   SW T5, 4416(T2)
84:                     ppu.page[9] = ppu.nametab + (nametab[1] << 10) - 0x2400;
9D015FF0  7C0B4804   INS T3, ZERO, 0, 10
9D015FF4  256EDC00   ADDIU T6, T3, -9216
9D015FF8  014E5821   ADDU T3, T2, T6
9D015FFC  AD4B1144   SW T3, 4420(T2)
85:                     ppu.page[10] = ppu.nametab + (nametab[2] << 10) - 0x2800;
9D016000  2408FC00   ADDIU T0, ZERO, -1024
9D016004  01E83824   AND A3, T7, T0
9D016008  24ECD800   ADDIU T4, A3, -10240
9D01600C  014C7821   ADDU T7, T2, T4
9D016010  AD4F1148   SW T7, 4424(T2)
86:                     ppu.page[11] = ppu.nametab + (nametab[3] << 10) - 0x2C00;
9D016014  7C184804   INS T8, ZERO, 0, 10
9D016018  2706D400   ADDIU A2, T8, -11264
9D01601C  0146C021   ADDU T8, T2, A2
9D016020  AD58114C   SW T8, 4428(T2)
87:                     ppu.page[12] = ppu.page[8] - 0x1000;
9D016024  25A5F000   ADDIU A1, T5, -4096
9D016028  AD451150   SW A1, 4432(T2)
88:                     ppu.page[13] = ppu.page[9] - 0x1000;
9D01602C  2579F000   ADDIU T9, T3, -4096
9D016030  AD591154   SW T9, 4436(T2)
89:                     ppu.page[14] = ppu.page[10] - 0x1000;
9D016034  25E4F000   ADDIU A0, T7, -4096
9D016038  AD441158   SW A0, 4440(T2)
90:                     ppu.page[15] = ppu.page[11] - 0x1000;
9D01603C  2703F000   ADDIU V1, T8, -4096
9D016040  03E00008   JR RA
9D016044  AD43115C   SW V1, 4444(T2)
91:                  }
92:                  
93:                  void ppu_getcontext(ppu_t *dest_ppu)
94:                  {
95:                     int nametab[4];
96:                     
97:                     ASSERT(dest_ppu);
98:                     *dest_ppu = ppu;
9D016048  3C02A001   LUI V0, -24575
9D01604C  24490258   ADDIU T1, V0, 600
9D016050  252A1DB0   ADDIU T2, T1, 7600
9D016054  8D280000   LW T0, 0(T1)
9D016058  8D270004   LW A3, 4(T1)
9D01605C  8D260008   LW A2, 8(T1)
9D016060  8D25000C   LW A1, 12(T1)
9D016064  AC880000   SW T0, 0(A0)
9D016068  AC870004   SW A3, 4(A0)
9D01606C  AC860008   SW A2, 8(A0)
9D016070  AC85000C   SW A1, 12(A0)
9D016074  252B0010   ADDIU T3, T1, 16
9D016078  248D0010   ADDIU T5, A0, 16
9D01607C  8D6F0000   LW T7, 0(T3)
9D016080  8D780004   LW T8, 4(T3)
9D016084  8D790008   LW T9, 8(T3)
9D016088  8D62000C   LW V0, 12(T3)
9D01608C  ADAF0000   SW T7, 0(T5)
9D016090  ADB80004   SW T8, 4(T5)
9D016094  ADB90008   SW T9, 8(T5)
9D016098  ADA2000C   SW V0, 12(T5)
9D01609C  8D690010   LW T1, 16(T3)
9D0160A0  8D630014   LW V1, 20(T3)
9D0160A4  8D680018   LW T0, 24(T3)
9D0160A8  8D67001C   LW A3, 28(T3)
9D0160AC  ADA90010   SW T1, 16(T5)
9D0160B0  ADA30014   SW V1, 20(T5)
9D0160B4  ADA80018   SW T0, 24(T5)
9D0160B8  ADA7001C   SW A3, 28(T5)
9D0160BC  25690020   ADDIU T1, T3, 32
9D0160C0  25A80020   ADDIU T0, T5, 32
9D0160C4  8D2B0000   LW T3, 0(T1)
9D0160C8  8D2C0004   LW T4, 4(T1)
9D0160CC  8D260008   LW A2, 8(T1)
9D0160D0  8D25000C   LW A1, 12(T1)
9D0160D4  AD0B0000   SW T3, 0(T0)
9D0160D8  AD0C0004   SW T4, 4(T0)
9D0160DC  AD060008   SW A2, 8(T0)
9D0160E0  AD05000C   SW A1, 12(T0)
9D0160E4  252D0010   ADDIU T5, T1, 16
9D0160E8  250E0010   ADDIU T6, T0, 16
9D0160EC  8D2F0010   LW T7, 16(T1)
9D0160F0  8DB80004   LW T8, 4(T5)
9D0160F4  8DB90008   LW T9, 8(T5)
9D0160F8  8DA2000C   LW V0, 12(T5)
9D0160FC  AD0F0010   SW T7, 16(T0)
9D016100  ADD80004   SW T8, 4(T6)
9D016104  ADD90008   SW T9, 8(T6)
9D016108  ADC2000C   SW V0, 12(T6)
9D01610C  8DA90010   LW T1, 16(T5)
9D016110  8DA80014   LW T0, 20(T5)
9D016114  8DA70018   LW A3, 24(T5)
9D016118  8DA3001C   LW V1, 28(T5)
9D01611C  ADC90010   SW T1, 16(T6)
9D016120  ADC80014   SW T0, 20(T6)
9D016124  ADC70018   SW A3, 24(T6)
9D016128  ADC3001C   SW V1, 28(T6)
9D01612C  8DAB0020   LW T3, 32(T5)
9D016130  8DAC0024   LW T4, 36(T5)
9D016134  8DA60028   LW A2, 40(T5)
9D016138  8DA5002C   LW A1, 44(T5)
9D01613C  ADCB0020   SW T3, 32(T6)
9D016140  ADCC0024   SW T4, 36(T6)
9D016144  ADC60028   SW A2, 40(T6)
9D016148  ADC5002C   SW A1, 44(T6)
9D01614C  8DAF0030   LW T7, 48(T5)
9D016150  8DB80034   LW T8, 52(T5)
9D016154  8DB90038   LW T9, 56(T5)
9D016158  8DA2003C   LW V0, 60(T5)
9D01615C  ADCF0030   SW T7, 48(T6)
9D016160  ADD80034   SW T8, 52(T6)
9D016164  ADD90038   SW T9, 56(T6)
9D016168  ADC2003C   SW V0, 60(T6)
9D01616C  8DA90040   LW T1, 64(T5)
9D016170  8DA80044   LW T0, 68(T5)
9D016174  8DA70048   LW A3, 72(T5)
9D016178  8DA3004C   LW V1, 76(T5)
9D01617C  ADC90040   SW T1, 64(T6)
9D016180  ADC80044   SW T0, 68(T6)
9D016184  ADC70048   SW A3, 72(T6)
9D016188  ADC3004C   SW V1, 76(T6)
9D01618C  8DAB0050   LW T3, 80(T5)
9D016190  8DAC0054   LW T4, 84(T5)
9D016194  8DA60058   LW A2, 88(T5)
9D016198  8DA5005C   LW A1, 92(T5)
9D01619C  ADCB0050   SW T3, 80(T6)
9D0161A0  ADCC0054   SW T4, 84(T6)
9D0161A4  ADC60058   SW A2, 88(T6)
9D0161A8  ADC5005C   SW A1, 92(T6)
9D0161AC  8DAF0060   LW T7, 96(T5)
9D0161B0  8DB80064   LW T8, 100(T5)
9D0161B4  8DB90068   LW T9, 104(T5)
9D0161B8  8DA2006C   LW V0, 108(T5)
9D0161BC  ADCF0060   SW T7, 96(T6)
9D0161C0  ADD80064   SW T8, 100(T6)
9D0161C4  ADD90068   SW T9, 104(T6)
9D0161C8  ADC2006C   SW V0, 108(T6)
9D0161CC  25A90070   ADDIU T1, T5, 112
9D0161D0  152AFFBC   BNE T1, T2, 0x9D0160C4
9D0161D4  25C80070   ADDIU T0, T6, 112
9D0161D8  8D2A0000   LW T2, 0(T1)
9D0161DC  8D2D0004   LW T5, 4(T1)
9D0161E0  AD0A0000   SW T2, 0(T0)
9D0161E4  AD0D0004   SW T5, 4(T0)
99:                  
100:                    /* we can't just copy contexts here, because more than likely,
101:                    ** the top 8 pages of the ppu are pointing to internal PPU memory,
102:                    ** which means we need to recalculate the page pointers.
103:                    ** TODO: we can either get rid of the page pointing in the code,
104:                    ** or add more robust checks to make sure that pages 8-15 are
105:                    ** definitely pointing to internal PPU RAM, not just something
106:                    ** that some crazy mapper paged in.
107:                    */
108:                    nametab[0] = (ppu.page[8] - ppu.nametab + 0x2000) >> 10;
9D0161E8  3C0EA001   LUI T6, -24575
9D0161EC  25CB0258   ADDIU T3, T6, 600
9D016220  240D2000   ADDIU T5, ZERO, 8192
9D016224  01AB7023   SUBU T6, T5, T3
9D016228  8D6B1140   LW T3, 4416(T3)
9D01622C  016E3821   ADDU A3, T3, T6
109:                    nametab[1] = (ppu.page[9] - ppu.nametab + 0x2400) >> 10;
9D0161F0  24072400   ADDIU A3, ZERO, 9216
9D0161F4  00EB6023   SUBU T4, A3, T3
9D0161F8  8D631144   LW V1, 4420(T3)
9D0161FC  006C2821   ADDU A1, V1, T4
110:                    nametab[2] = (ppu.page[10] - ppu.nametab + 0x2800) >> 10;
9D016200  24062800   ADDIU A2, ZERO, 10240
9D016204  00CB7823   SUBU T7, A2, T3
9D016208  8D781148   LW T8, 4424(T3)
9D01620C  030FC821   ADDU T9, T8, T7
111:                    nametab[3] = (ppu.page[11] - ppu.nametab + 0x2C00) >> 10;
9D016210  24022C00   ADDIU V0, ZERO, 11264
9D016214  004B4823   SUBU T1, V0, T3
9D016218  8D68114C   LW T0, 4428(T3)
9D01621C  01095021   ADDU T2, T0, T1
112:                 
113:                    dest_ppu->page[8] = dest_ppu->nametab + (nametab[0] << 10) - 0x2000;
9D016230  7C074804   INS A3, ZERO, 0, 10
9D016234  24ECE000   ADDIU T4, A3, -8192
9D016238  008C3021   ADDU A2, A0, T4
9D01623C  AC861140   SW A2, 4416(A0)
114:                    dest_ppu->page[9] = dest_ppu->nametab + (nametab[1] << 10) - 0x2400;
9D016240  7C054804   INS A1, ZERO, 0, 10
9D016244  24A3DC00   ADDIU V1, A1, -9216
9D016248  00832821   ADDU A1, A0, V1
9D01624C  AC851144   SW A1, 4420(A0)
115:                    dest_ppu->page[10] = dest_ppu->nametab + (nametab[2] << 10) - 0x2800;
9D016250  7C194804   INS T9, ZERO, 0, 10
9D016254  272FD800   ADDIU T7, T9, -10240
9D016258  008FC021   ADDU T8, A0, T7
9D01625C  AC981148   SW T8, 4424(A0)
116:                    dest_ppu->page[11] = dest_ppu->nametab + (nametab[3] << 10) - 0x2C00;
9D016260  2419FC00   ADDIU T9, ZERO, -1024
9D016264  01591024   AND V0, T2, T9
9D016268  2449D400   ADDIU T1, V0, -11264
9D01626C  00894021   ADDU T0, A0, T1
9D016270  AC88114C   SW T0, 4428(A0)
117:                    dest_ppu->page[12] = dest_ppu->page[8] - 0x1000;
9D016274  24CAF000   ADDIU T2, A2, -4096
9D016278  AC8A1150   SW T2, 4432(A0)
118:                    dest_ppu->page[13] = dest_ppu->page[9] - 0x1000;
9D01627C  24ADF000   ADDIU T5, A1, -4096
9D016280  AC8D1154   SW T5, 4436(A0)
119:                    dest_ppu->page[14] = dest_ppu->page[10] - 0x1000;
9D016284  270EF000   ADDIU T6, T8, -4096
9D016288  AC8E1158   SW T6, 4440(A0)
120:                    dest_ppu->page[15] = dest_ppu->page[11] - 0x1000;
9D01628C  250BF000   ADDIU T3, T0, -4096
9D016290  03E00008   JR RA
9D016294  AC8B115C   SW T3, 4444(A0)
121:                 }
122:                 
123:                 ppu_t *ppu_create(void)
124:                 {
9D017180  27BDFFE8   ADDIU SP, SP, -24
9D017184  AFBF0014   SW RA, 20(SP)
9D017188  AFB00010   SW S0, 16(SP)
125:                    static bool pal_generated = false;
126:                    ppu_t *temp;
127:                 
128:                    temp = malloc(sizeof(ppu_t));
9D01718C  0F40F30A   JAL _my_malloc
9D017190  24041DB8   ADDIU A0, ZERO, 7608
129:                    if (NULL == temp)
9D017194  10400012   BEQ V0, ZERO, 0x9D0171E0
9D017198  00408021   ADDU S0, V0, ZERO
130:                       return NULL;
9D0171E0  00001021   ADDU V0, ZERO, ZERO
131:                 
132:                    memset(temp, 0, sizeof(ppu_t));
9D01719C  00402021   ADDU A0, V0, ZERO
9D0171A0  00002821   ADDU A1, ZERO, ZERO
9D0171A4  0F4100B4   JAL .Letext0, .LFE0, memset
9D0171A8  24061DB8   ADDIU A2, ZERO, 7608
133:                 
134:                    temp->latchfunc = NULL;
135:                    temp->vromswitch = NULL;
136:                    temp->vram_present = false;
137:                    temp->drawsprites = true;
9D0171AC  24020001   ADDIU V0, ZERO, 1
9D0171B0  AE021DB4   SW V0, 7604(S0)
138:                 
139:                    /* TODO: probably a better way to do this... */
140:                    if (false == pal_generated)
9D0171B4  8F8380D8   LW V1, -32552(GP)
9D0171B8  14600005   BNE V1, ZERO, 0x9D0171D0
9D0171BC  00000000   NOP
141:                    {
142:                       pal_generate();
9D0171C0  0F40DA2E   JAL pal_generate
9D0171C4  00000000   NOP
143:                       pal_generated = true;
9D0171C8  24040001   ADDIU A0, ZERO, 1
9D0171CC  AF8480D8   SW A0, -32552(GP)
144:                    }
145:                 
146:                    ppu_setdefaultpal(temp);
9D0171D0  0F405C58   JAL ppu_setdefaultpal
9D0171D4  02002021   ADDU A0, S0, ZERO
147:                 
148:                    return temp;
9D0171D8  0B405C79   J 0x9D0171E4
9D0171DC  02001021   ADDU V0, S0, ZERO
149:                 }
9D0171E4  8FBF0014   LW RA, 20(SP)
9D0171E8  8FB00010   LW S0, 16(SP)
9D0171EC  03E00008   JR RA
9D0171F0  27BD0018   ADDIU SP, SP, 24
150:                 
151:                 void ppu_destroy(ppu_t **src_ppu)
152:                 {
9D016298  27BDFFE8   ADDIU SP, SP, -24
9D01629C  AFBF0014   SW RA, 20(SP)
9D0162A0  AFB00010   SW S0, 16(SP)
153:                    if (*src_ppu)
9D0162A4  8C820000   LW V0, 0(A0)
9D0162A8  10400004   BEQ V0, ZERO, 0x9D0162BC
9D0162AC  00808021   ADDU S0, A0, ZERO
154:                    {
155:                       free(*src_ppu);
9D0162B0  0F40F31D   JAL _my_free
9D0162B4  00000000   NOP
156:                       *src_ppu = NULL;
9D0162B8  AE000000   SW ZERO, 0(S0)
157:                    }
158:                 }
9D0162BC  8FBF0014   LW RA, 20(SP)
9D0162C0  8FB00010   LW S0, 16(SP)
9D0162C4  03E00008   JR RA
9D0162C8  27BD0018   ADDIU SP, SP, 24
159:                 
160:                 void ppu_setpage(int size, int page_num, uint8 *location)
161:                 {
162:                    /* deliberately fall through */
163:                    switch (size)
9D0162CC  24020002   ADDIU V0, ZERO, 2
9D0162D0  1082002A   BEQ A0, V0, 0x9D01637C
9D0162D4  28830003   SLTI V1, A0, 3
9D0162D8  10600007   BEQ V1, ZERO, 0x9D0162F8
9D0162DC  24070004   ADDIU A3, ZERO, 4
9D0162E0  00A0C021   ADDU T8, A1, ZERO
9D0162E4  24050001   ADDIU A1, ZERO, 1
9D0162E8  1085002C   BEQ A0, A1, 0x9D01639C
9D0162EC  27080448   ADDIU T0, T8, 1096
9D0162F0  03E00008   JR RA
9D0162F4  00000000   NOP
9D0162F8  10870015   BEQ A0, A3, 0x9D016350
9D0162FC  24080008   ADDIU T0, ZERO, 8
9D016300  1488FFFB   BNE A0, T0, 0x9D0162F0
9D016304  24A40448   ADDIU A0, A1, 1096
164:                    {
165:                    case 8:  
166:                       ppu.page[page_num++] = location;
9D016308  00044880   SLL T1, A0, 2
9D01630C  3C0AA001   LUI T2, -24575
9D016310  254B0258   ADDIU T3, T2, 600
9D016314  012B6021   ADDU T4, T1, T3
9D016318  AD860000   SW A2, 0(T4)
167:                       ppu.page[page_num++] = location;
9D01631C  24AD0449   ADDIU T5, A1, 1097
9D016320  000D7080   SLL T6, T5, 2
9D016324  01CB7821   ADDU T7, T6, T3
9D016328  ADE60000   SW A2, 0(T7)
168:                       ppu.page[page_num++] = location;
9D01632C  24B8044A   ADDIU T8, A1, 1098
9D016330  0018C880   SLL T9, T8, 2
9D016334  032B1021   ADDU V0, T9, T3
9D016338  AC460000   SW A2, 0(V0)
169:                       ppu.page[page_num++] = location;
9D01633C  24A3044B   ADDIU V1, A1, 1099
9D016340  24A50004   ADDIU A1, A1, 4
9D016344  00033880   SLL A3, V1, 2
9D016348  00EB4021   ADDU T0, A3, T3
9D01634C  AD060000   SW A2, 0(T0)
170:                    case 4:  
171:                       ppu.page[page_num++] = location;
9D016350  24A40448   ADDIU A0, A1, 1096
9D016354  00044880   SLL T1, A0, 2
9D016358  3C0AA001   LUI T2, -24575
9D01635C  254B0258   ADDIU T3, T2, 600
9D016360  012B6021   ADDU T4, T1, T3
9D016364  AD860000   SW A2, 0(T4)
172:                       ppu.page[page_num++] = location;
9D016368  24AD0449   ADDIU T5, A1, 1097
9D01636C  24A50002   ADDIU A1, A1, 2
9D016370  000D7080   SLL T6, T5, 2
9D016374  01CB7821   ADDU T7, T6, T3
9D016378  ADE60000   SW A2, 0(T7)
173:                    case 2:
174:                       ppu.page[page_num++] = location;
9D01637C  24B80001   ADDIU T8, A1, 1
9D016380  24A50448   ADDIU A1, A1, 1096
9D016384  0005C880   SLL T9, A1, 2
9D016388  3C02A001   LUI V0, -24575
9D01638C  24430258   ADDIU V1, V0, 600
9D016390  03233821   ADDU A3, T9, V1
9D016394  ACE60000   SW A2, 0(A3)
175:                    case 1:
176:                       ppu.page[page_num++] = location;
9D016398  27080448   ADDIU T0, T8, 1096
9D01639C  00082080   SLL A0, T0, 2
9D0163A0  3C09A001   LUI T1, -24575
9D0163A4  252A0258   ADDIU T2, T1, 600
9D0163A8  008A5821   ADDU T3, A0, T2
9D0163AC  AD660000   SW A2, 0(T3)
9D0163B0  03E00008   JR RA
9D0163B4  00000000   NOP
177:                       break;
178:                    }
179:                 }
180:                 
181:                 /* make sure $3000-$3F00 mirrors $2000-$2F00 */
182:                 void ppu_mirrorhipages(void)
183:                 {
184:                    ppu.page[12] = ppu.page[8] - 0x1000;
9D0163B8  3C02A001   LUI V0, -24575
9D0163BC  24440258   ADDIU A0, V0, 600
9D0163C0  8C831140   LW V1, 4416(A0)
9D0163C4  2465F000   ADDIU A1, V1, -4096
9D0163C8  AC851150   SW A1, 4432(A0)
185:                    ppu.page[13] = ppu.page[9] - 0x1000;
9D0163CC  8C861144   LW A2, 4420(A0)
9D0163D0  24C7F000   ADDIU A3, A2, -4096
9D0163D4  AC871154   SW A3, 4436(A0)
186:                    ppu.page[14] = ppu.page[10] - 0x1000;
9D0163D8  8C881148   LW T0, 4424(A0)
9D0163DC  2509F000   ADDIU T1, T0, -4096
9D0163E0  AC891158   SW T1, 4440(A0)
187:                    ppu.page[15] = ppu.page[11] - 0x1000;
9D0163E4  8C8A114C   LW T2, 4428(A0)
9D0163E8  254BF000   ADDIU T3, T2, -4096
9D0163EC  03E00008   JR RA
9D0163F0  AC8B115C   SW T3, 4444(A0)
188:                 }
189:                 
190:                 void ppu_mirror(int nt1, int nt2, int nt3, int nt4)
191:                 {
192:                    ppu.page[8] = ppu.nametab + (nt1 << 10) - 0x2000;
9D0163F4  00042280   SLL A0, A0, 10
9D0163F8  2483E000   ADDIU V1, A0, -8192
9D0163FC  3C02A001   LUI V0, -24575
9D016400  24480258   ADDIU T0, V0, 600
9D016404  01034821   ADDU T1, T0, V1
9D016408  AD091140   SW T1, 4416(T0)
193:                    ppu.page[9] = ppu.nametab + (nt2 << 10) - 0x2400;
9D01640C  00052A80   SLL A1, A1, 10
9D016410  24AADC00   ADDIU T2, A1, -9216
9D016414  010A5821   ADDU T3, T0, T2
9D016418  AD0B1144   SW T3, 4420(T0)
194:                    ppu.page[10] = ppu.nametab + (nt3 << 10) - 0x2800;
9D01641C  00063280   SLL A2, A2, 10
9D016420  24CCD800   ADDIU T4, A2, -10240
9D016424  010C6821   ADDU T5, T0, T4
9D016428  AD0D1148   SW T5, 4424(T0)
195:                    ppu.page[11] = ppu.nametab + (nt4 << 10) - 0x2C00;
9D01642C  00073A80   SLL A3, A3, 10
9D016430  24EED400   ADDIU T6, A3, -11264
9D016434  010E7821   ADDU T7, T0, T6
9D016438  AD0F114C   SW T7, 4428(T0)
196:                    ppu.page[12] = ppu.page[8] - 0x1000;
9D01643C  2538F000   ADDIU T8, T1, -4096
9D016440  AD181150   SW T8, 4432(T0)
197:                    ppu.page[13] = ppu.page[9] - 0x1000;
9D016444  2579F000   ADDIU T9, T3, -4096
9D016448  AD191154   SW T9, 4436(T0)
198:                    ppu.page[14] = ppu.page[10] - 0x1000;
9D01644C  25A4F000   ADDIU A0, T5, -4096
9D016450  AD041158   SW A0, 4440(T0)
199:                    ppu.page[15] = ppu.page[11] - 0x1000;
9D016454  25E3F000   ADDIU V1, T7, -4096
9D016458  03E00008   JR RA
9D01645C  AD03115C   SW V1, 4444(T0)
200:                 }
201:                 
202:                 /* bleh, for snss */
203:                 uint8 *ppu_getpage(int page)
204:                 {
205:                    return ppu.page[page];
9D016460  24840448   ADDIU A0, A0, 1096
9D016464  00041080   SLL V0, A0, 2
9D016468  3C03A001   LUI V1, -24575
9D01646C  24650258   ADDIU A1, V1, 600
9D016470  00453021   ADDU A2, V0, A1
206:                 }
9D016474  03E00008   JR RA
9D016478  8CC20000   LW V0, 0(A2)
207:                 
208:                 static void mem_trash(uint8 *buffer, int length)
209:                 {
210:                    int i;
211:                 
212:                    for (i = 0; i < length; i++)
9D0164F4  1632FFED   BNE S1, S2, .LBB4, .LBB5
213:                       buffer[i] = (uint8) rand();
9D0164AC  0F410684   JAL .Letext0, .LFE0, rand
9D0164B0  00000000   NOP
9D0164B4  0F410684   JAL .Letext0, .LFE0, rand
9D0164B8  A2220000   SB V0, 0(S1)
9D0164BC  0F410684   JAL .Letext0, .LFE0, rand
9D0164C0  A2220001   SB V0, 1(S1)
9D0164C4  0F410684   JAL .Letext0, .LFE0, rand
9D0164C8  A2220002   SB V0, 2(S1)
9D0164CC  0F410684   JAL .Letext0, .LFE0, rand
9D0164D0  A2220003   SB V0, 3(S1)
9D0164D4  0F410684   JAL .Letext0, .LFE0, rand
9D0164D8  A2220004   SB V0, 4(S1)
9D0164DC  0F410684   JAL .Letext0, .LFE0, rand
9D0164E0  A2220005   SB V0, 5(S1)
9D0164E4  0F410684   JAL .Letext0, .LFE0, rand
9D0164E8  A2220006   SB V0, 6(S1)
9D0164EC  A2220007   SB V0, 7(S1)
9D0164F0  26310008   ADDIU S1, S1, 8
9D0164F4  1632FFED   BNE S1, S2, .LBB4, .LBB5
9D0164F8  3C08A001   LUI T0, -24575
214:                 }
215:                 
216:                 /* reset state of ppu */
217:                 void ppu_reset(int reset_type)
218:                 {
9D016488  27BDFFE0   ADDIU SP, SP, -32
9D01648C  AFBF001C   SW RA, 28(SP)
9D016490  AFB20018   SW S2, 24(SP)
9D016494  AFB10014   SW S1, 20(SP)
9D016498  AFB00010   SW S0, 16(SP)
9D01649C  3C11A001   LUI S1, -24575
9D0164A0  26311258   ADDIU S1, S1, 4696
9D0164A4  3C12A001   LUI S2, -24575
9D0164A8  26521358   ADDIU S2, S2, 4952
219:                    if (HARD_RESET == reset_type)
9D01647C  24020001   ADDIU V0, ZERO, 1
9D016480  14820032   BNE A0, V0, 0x9D01654C
9D016484  3C03A001   LUI V1, -24575
220:                       mem_trash(ppu.oam, 256);
221:                 
222:                    ppu.ctrl0 = 0;
9D0164FC  25090258   ADDIU T1, T0, 600
9D016500  A1201160   SB ZERO, 4448(T1)
9D01654C  24640258   ADDIU A0, V1, 600
9D016550  A0801160   SB ZERO, 4448(A0)
223:                    ppu.ctrl1 = PPU_CTRL1F_OBJON | PPU_CTRL1F_BGON;
9D016504  240A0018   ADDIU T2, ZERO, 24
9D016508  A12A1161   SB T2, 4449(T1)
9D016554  24050018   ADDIU A1, ZERO, 24
9D016558  A0851161   SB A1, 4449(A0)
224:                    ppu.stat = 0;
9D01650C  A1201162   SB ZERO, 4450(T1)
9D01655C  A0801162   SB ZERO, 4450(A0)
225:                    ppu.flipflop = 0;
9D016510  AD201170   SW ZERO, 4464(T1)
9D016560  AC801170   SW ZERO, 4464(A0)
226:                    ppu.vaddr = ppu.vaddr_latch = 0x2000;
9D016514  240B2000   ADDIU T3, ZERO, 8192
9D016518  AD2B1168   SW T3, 4456(T1)
9D01651C  AD2B1164   SW T3, 4452(T1)
9D016564  24062000   ADDIU A2, ZERO, 8192
9D016568  AC861168   SW A2, 4456(A0)
9D01656C  AC861164   SW A2, 4452(A0)
227:                    ppu.oam_addr = 0;
9D016520  A1201163   SB ZERO, 4451(T1)
9D016570  A0801163   SB ZERO, 4451(A0)
228:                    ppu.tile_xofs = 0;
9D016524  AD20116C   SW ZERO, 4460(T1)
9D016574  AC80116C   SW ZERO, 4460(A0)
229:                 
230:                    ppu.latch = 0;
9D016528  A1201198   SB ZERO, 4504(T1)
9D016578  A0801198   SB ZERO, 4504(A0)
231:                    ppu.vram_accessible = true;
9D01652C  240C0001   ADDIU T4, ZERO, 1
9D016530  AD2C1DAC   SW T4, 7596(T1)
9D01657C  24070001   ADDIU A3, ZERO, 1
9D016580  03E00008   JR RA
9D016584  AC871DAC   SW A3, 7596(A0)
232:                 }
9D016534  8FBF001C   LW RA, 28(SP)
9D016538  8FB20018   LW S2, 24(SP)
9D01653C  8FB10014   LW S1, 20(SP)
9D016540  8FB00010   LW S0, 16(SP)
9D016544  03E00008   JR RA
9D016548  27BD0020   ADDIU SP, SP, 32
9D01654C  24640258   ADDIU A0, V1, 600
9D016550  A0801160   SB ZERO, 4448(A0)
9D016554  24050018   ADDIU A1, ZERO, 24
9D016558  A0851161   SB A1, 4449(A0)
9D01655C  A0801162   SB ZERO, 4450(A0)
9D016560  AC801170   SW ZERO, 4464(A0)
9D016564  24062000   ADDIU A2, ZERO, 8192
9D016568  AC861168   SW A2, 4456(A0)
9D01656C  AC861164   SW A2, 4452(A0)
9D016570  A0801163   SB ZERO, 4451(A0)
9D016574  AC80116C   SW ZERO, 4460(A0)
9D016578  A0801198   SB ZERO, 4504(A0)
9D01657C  24070001   ADDIU A3, ZERO, 1
9D016580  03E00008   JR RA
9D016584  AC871DAC   SW A3, 7596(A0)
233:                 
234:                 /* we render a scanline of graphics first so we know exactly
235:                 ** where the sprite 0 strike is going to occur (in terms of
236:                 ** cpu cycles), using the relation that 3 pixels == 1 cpu cycle
237:                 */
238:                 static void ppu_setstrike(int x_loc)
239:                 {
9D015D98  27BDFFE0   ADDIU SP, SP, -32
9D015D9C  AFBF001C   SW RA, 28(SP)
9D015DA0  AFB10018   SW S1, 24(SP)
9D015DA4  AFB00014   SW S0, 20(SP)
9D015DA8  00808021   ADDU S0, A0, ZERO
240:                    if (false == ppu.strikeflag)
9D015D88  3C02A001   LUI V0, -24575
9D015D8C  8C4313F4   LW V1, 5108(V0)
9D015D90  14600018   BNE V1, ZERO, 0x9D015DF4
9D015D94  00000000   NOP
241:                    {
242:                       ppu.strikeflag = true;
9D015DAC  3C11A001   LUI S1, -24575
9D015DB0  26310258   ADDIU S1, S1, 600
9D015DB4  24040001   ADDIU A0, ZERO, 1
9D015DB8  AE24119C   SW A0, 4508(S1)
243:                 
244:                       /* 3 pixels per cpu cycle */
245:                       ppu.strike_cycle = nes6502_getcycles(false) + (x_loc / 3);
9D015DBC  0F4031E8   JAL nes6502_getcycles
9D015DC0  00002021   ADDU A0, ZERO, ZERO
9D015DC4  3C055555   LUI A1, 21845
9D015DC8  24A65556   ADDIU A2, A1, 21846
9D015DCC  02060018   MULT 0, S0, A2
9D015DD0  00003810   MFHI A3
9D015DD4  001047C3   SRA T0, S0, 31
9D015DD8  00E84823   SUBU T1, A3, T0
9D015DDC  00495021   ADDU T2, V0, T1
9D015DE0  AE2A11A0   SW T2, 4512(S1)
246:                    }
247:                 }
9D015DE4  8FBF001C   LW RA, 28(SP)
9D015DE8  8FB10018   LW S1, 24(SP)
9D015DEC  8FB00014   LW S0, 20(SP)
9D015DF0  27BD0020   ADDIU SP, SP, 32
9D015DF4  03E00008   JR RA
9D015DF8  00000000   NOP
248:                 
249:                 static void ppu_oamdma(uint8 value)
250:                 {
251:                    uint32 cpu_address;
252:                    uint8 oam_loc;
253:                 
254:                    cpu_address = (uint32) (value << 8);
9D0165C8  00108200   SLL S0, S0, 8
255:                 
256:                    /* Sprite DMA starts at the current SPRRAM address */
257:                    oam_loc = ppu.oam_addr;
9D0165CC  3C04A001   LUI A0, -24575
9D0165D0  909213BB   LBU S2, 5051(A0)
258:                    do
259:                    {
260:                       ppu.oam[oam_loc++] = nes6502_getbyte(cpu_address++);
9D0165D4  3C13A001   LUI S3, -24575
9D0165D8  26730258   ADDIU S3, S3, 600
9D0165DC  26510001   ADDIU S1, S2, 1
9D0165E0  323100FF   ANDI S1, S1, 255
9D0165E4  26140001   ADDIU S4, S0, 1
9D0165E8  0F4031DE   JAL nes6502_getbyte
9D0165EC  02002021   ADDU A0, S0, ZERO
9D0165F0  02539021   ADDU S2, S2, S3
9D0165F4  A2421000   SB V0, 4096(S2)
9D016604  0B405977   J 0x9D0165DC
9D016608  02808021   ADDU S0, S4, ZERO
261:                    }
262:                    while (oam_loc != ppu.oam_addr);
9D0165F8  92661163   LBU A2, 4451(S3)
9D0165FC  10D10003   BEQ A2, S1, 0x9D01660C
9D016600  02209021   ADDU S2, S1, ZERO
263:                 
264:                    /* TODO: enough with houdini */
265:                    cpu_address -= 256;
266:                    /* Odd address in $2003 */
267:                    if ((ppu.oam_addr >> 2) & 1)
9D01660C  7E270080   EXT A3, S1, 2, 1
9D016610  10E00022   BEQ A3, ZERO, 0x9D01669C
9D016614  2604FF01   ADDIU A0, S0, -255
9D016618  3C1FA001   LUI RA, -24575
9D01661C  27F10258   ADDIU S1, RA, 600
268:                    {
269:                       for (oam_loc = 4; oam_loc < 8; oam_loc++)
270:                          ppu.oam[oam_loc] = nes6502_getbyte(cpu_address++);
9D016620  0F4031DE   JAL nes6502_getbyte
9D016624  24920001   ADDIU S2, A0, 1
9D016628  A2221004   SB V0, 4100(S1)
9D01662C  26330001   ADDIU S3, S1, 1
9D016630  0F4031DE   JAL nes6502_getbyte
9D016634  02402021   ADDU A0, S2, ZERO
9D016638  A2621004   SB V0, 4100(S3)
9D01663C  26740001   ADDIU S4, S3, 1
9D016640  0F4031DE   JAL nes6502_getbyte
9D016644  26440001   ADDIU A0, S2, 1
9D016648  A2621005   SB V0, 4101(S3)
9D01664C  0F4031DE   JAL nes6502_getbyte
9D016650  26440002   ADDIU A0, S2, 2
9D016654  A2621006   SB V0, 4102(S3)
9D016658  26730002   ADDIU S3, S3, 2
271:                       cpu_address += 248;
9D01665C  2604FFFD   ADDIU A0, S0, -3
272:                       for (oam_loc = 0; oam_loc < 4; oam_loc++)
273:                          ppu.oam[oam_loc] = nes6502_getbyte(cpu_address++);
9D016660  0F4031DE   JAL nes6502_getbyte
9D016664  24900001   ADDIU S0, A0, 1
9D016668  A2221000   SB V0, 4096(S1)
9D01666C  26220001   ADDIU V0, S1, 1
9D016670  00408821   ADDU S1, V0, ZERO
9D016674  0F4031DE   JAL nes6502_getbyte
9D016678  02002021   ADDU A0, S0, ZERO
9D01667C  A2221000   SB V0, 4096(S1)
9D016680  0F4031DE   JAL nes6502_getbyte
9D016684  26040001   ADDIU A0, S0, 1
9D016688  A2821000   SB V0, 4096(S4)
9D01668C  0F4031DE   JAL nes6502_getbyte
9D016690  26040002   ADDIU A0, S0, 2
9D016694  0B4059D1   J 0x9D016744
9D016698  A2621000   SB V0, 4096(S3)
9D01669C  3C08A001   LUI T0, -24575
9D0166A0  25090258   ADDIU T1, T0, 600
9D0166A4  01308023   SUBU S0, T1, S0
274:                    }
275:                    /* Even address in $2003 */
276:                    else
277:                    {
278:                       for (oam_loc = 0; oam_loc < 8; oam_loc++)
279:                          ppu.oam[oam_loc] = nes6502_getbyte(cpu_address++);
9D0166A8  0F4031DE   JAL nes6502_getbyte
9D0166AC  24930001   ADDIU S3, A0, 1
9D0166B0  02135021   ADDU T2, S0, S3
9D0166B4  A14210FE   SB V0, 4350(T2)
9D0166B8  02602021   ADDU A0, S3, ZERO
9D0166BC  0F4031DE   JAL nes6502_getbyte
9D0166C0  26710001   ADDIU S1, S3, 1
9D0166C4  02115821   ADDU T3, S0, S1
9D0166C8  A16210FE   SB V0, 4350(T3)
9D0166CC  26640001   ADDIU A0, S3, 1
9D0166D0  0F4031DE   JAL nes6502_getbyte
9D0166D4  24940001   ADDIU S4, A0, 1
9D0166D8  02146021   ADDU T4, S0, S4
9D0166DC  A18210FE   SB V0, 4350(T4)
9D0166E0  26640002   ADDIU A0, S3, 2
9D0166E4  0F4031DE   JAL nes6502_getbyte
9D0166E8  24920001   ADDIU S2, A0, 1
9D0166EC  02126821   ADDU T5, S0, S2
9D0166F0  A1A210FE   SB V0, 4350(T5)
9D0166F4  26640003   ADDIU A0, S3, 3
9D0166F8  0F4031DE   JAL nes6502_getbyte
9D0166FC  24910001   ADDIU S1, A0, 1
9D016700  02117021   ADDU T6, S0, S1
9D016704  A1C210FE   SB V0, 4350(T6)
9D016708  26640004   ADDIU A0, S3, 4
9D01670C  0F4031DE   JAL nes6502_getbyte
9D016710  24940001   ADDIU S4, A0, 1
9D016714  02147821   ADDU T7, S0, S4
9D016718  A1E210FE   SB V0, 4350(T7)
9D01671C  26640005   ADDIU A0, S3, 5
9D016720  0F4031DE   JAL nes6502_getbyte
9D016724  24920001   ADDIU S2, A0, 1
9D016728  0212C021   ADDU T8, S0, S2
9D01672C  A30210FE   SB V0, 4350(T8)
9D016730  26640006   ADDIU A0, S3, 6
9D016734  0F4031DE   JAL nes6502_getbyte
9D016738  24930001   ADDIU S3, A0, 1
9D01673C  0213C821   ADDU T9, S0, S3
9D016740  A32210FE   SB V0, 4350(T9)
280:                    }
281:                 
282:                    /* make the CPU spin for DMA cycles */
283:                    nes6502_burn(513);
9D016744  0F40575A   JAL nes6502_burn
9D016748  24040201   ADDIU A0, ZERO, 513
284:                    nes6502_release();
9D01674C  0F405760   JAL nes6502_release
9D016750  00000000   NOP
285:                 }
286:                 
287:                 /* TODO: this isn't the PPU! */
288:                 void ppu_writehigh(uint32 address, uint8 value)
289:                 {
9D016588  27BDFFD8   ADDIU SP, SP, -40
9D01658C  AFBF0024   SW RA, 36(SP)
9D016590  AFB40020   SW S4, 32(SP)
9D016594  AFB3001C   SW S3, 28(SP)
9D016598  AFB20018   SW S2, 24(SP)
9D01659C  AFB10014   SW S1, 20(SP)
9D0165A0  AFB00010   SW S0, 16(SP)
290:                    switch (address)
9D0165A4  24024016   ADDIU V0, ZERO, 16406
9D0165A8  1082006C   BEQ A0, V0, 0x9D01675C
9D0165AC  00A08021   ADDU S0, A1, ZERO
9D0165B0  24034017   ADDIU V1, ZERO, 16407
9D0165B4  1083007B   BEQ A0, V1, 0x9D0167A4
9D0165B8  00000000   NOP
9D0165BC  24054014   ADDIU A1, ZERO, 16404
9D0165C0  1485007B   BNE A0, A1, 0x9D0167B0
9D0165C4  8FBF0024   LW RA, 36(SP)
291:                    {
292:                    case PPU_OAMDMA:
293:                       ppu_oamdma(value);
294:                       break;
295:                 
296:                    case PPU_JOY0:
297:                       /* VS system VROM switching - bleh!*/
298:                       if (ppu.vromswitch)
9D01675C  3C03A001   LUI V1, -24575
9D016760  8C651400   LW A1, 5120(V1)
9D016764  10A00004   BEQ A1, ZERO, 0x9D016778
9D016768  32130001   ANDI S3, S0, 1
299:                          ppu.vromswitch(value);
9D01676C  00A0F809   JALR A1
9D016770  02002021   ADDU A0, S0, ZERO
300:                 
301:                       /* see if we need to strobe them joypads */
302:                       value &= 1;
9D016774  32130001   ANDI S3, S0, 1
303:                       
304:                       if (0 == value && ppu.strobe)
9D016778  16600008   BNE S3, ZERO, 0x9D01679C
9D01677C  3C07A001   LUI A3, -24575
9D016780  3C04A001   LUI A0, -24575
9D016784  908613F2   LBU A2, 5106(A0)
9D016788  50C00008   BEQL A2, ZERO, .LVL135
9D01678C  A0F313F2   SB S3, 5106(A3)
305:                          input_strobe();
9D016790  0F40D524   JAL input_strobe
9D016794  00000000   NOP
306:                 
307:                       ppu.strobe = value;
9D016798  3C07A001   LUI A3, -24575
308:                       break;
9D01679C  0B4059EB   J .LVL135
9D0167A0  A0F313F2   SB S3, 5106(A3)
309:                 
310:                    case PPU_JOY1: /* frame IRQ control */
311:                       nes_setfiq(value);
9D0167A4  0F4098BA   JAL nes_setfiq
9D0167A8  00A02021   ADDU A0, A1, ZERO
312:                       break;
313:                 
314:                    default:
315:                       break;
316:                    }
317:                 }
9D016754  0B4059EC   J 0x9D0167B0
9D016758  8FBF0024   LW RA, 36(SP)
9D0167AC  8FBF0024   LW RA, 36(SP)
9D0167B0  8FB40020   LW S4, 32(SP)
9D0167B4  8FB3001C   LW S3, 28(SP)
9D0167B8  8FB20018   LW S2, 24(SP)
9D0167BC  8FB10014   LW S1, 20(SP)
9D0167C0  8FB00010   LW S0, 16(SP)
9D0167C4  03E00008   JR RA
9D0167C8  27BD0028   ADDIU SP, SP, 40
318:                 
319:                 /* TODO: this isn't the PPU! */
320:                 uint8 ppu_readhigh(uint32 address)
321:                 {
9D0167CC  27BDFFE8   ADDIU SP, SP, -24
322:                    uint8 value;
323:                 
324:                    switch (address)
9D0167D0  24024016   ADDIU V0, ZERO, 16406
9D0167D4  10820006   BEQ A0, V0, 0x9D0167F0
9D0167D8  AFBF0014   SW RA, 20(SP)
9D0167DC  24034017   ADDIU V1, ZERO, 16407
9D0167E0  10830007   BEQ A0, V1, 0x9D016800
9D0167E4  00000000   NOP
325:                    {
326:                    case PPU_JOY0:
327:                       value = input_get(INP_JOYPAD0);
9D0167F0  0F40D499   JAL input_get
9D0167F4  24040001   ADDIU A0, ZERO, 1
328:                       break;
9D0167F8  0B405A05   J 0x9D016814
9D0167FC  8FBF0014   LW RA, 20(SP)
329:                 
330:                    case PPU_JOY1:
331:                       /* TODO: better input handling */
332:                       value = input_get(INP_ZAPPER | INP_JOYPAD1 
9D016800  0F40D499   JAL input_get
9D016804  24040006   ADDIU A0, ZERO, 6
333:                                         /*| INP_ARKANOID*/ 
334:                                         /*| INP_POWERPAD*/);
335:                       break;
9D016808  0B405A05   J 0x9D016814
9D01680C  8FBF0014   LW RA, 20(SP)
336:                 
337:                    default:
338:                       value = 0xFF;
9D0167E8  0B405A04   J 0x9D016810
9D0167EC  240200FF   ADDIU V0, ZERO, 255
339:                       break;
340:                    }
341:                 
342:                    return value;
343:                 }
9D016810  8FBF0014   LW RA, 20(SP)
9D016814  03E00008   JR RA
9D016818  27BD0018   ADDIU SP, SP, 24
344:                 
345:                 /* Read from $2000-$2007 */
346:                 uint8 ppu_read(uint32 address)
347:                 {
9D01681C  27BDFFE0   ADDIU SP, SP, -32
9D016820  AFBF001C   SW RA, 28(SP)
9D016824  AFB10018   SW S1, 24(SP)
348:                    uint8 value;
349:                    
350:                    /* handle mirrored reads up to $3FFF */
351:                    switch (address & 0x2007)
9D016828  30842007   ANDI A0, A0, 8199
9D01682C  24022002   ADDIU V0, ZERO, 8194
9D016830  10820006   BEQ A0, V0, 0x9D01684C
9D016834  AFB00014   SW S0, 20(SP)
9D016838  24032007   ADDIU V1, ZERO, 8199
9D01683C  1083001A   BEQ A0, V1, 0x9D0168A8
9D016840  3C06A001   LUI A2, -24575
352:                    {
353:                    case PPU_STAT:
354:                       value = (ppu.stat & 0xE0) | (ppu.latch & 0x1F);
9D01684C  3C10A001   LUI S0, -24575
9D016850  261F0258   ADDIU RA, S0, 600
9D016854  93E41198   LBU A0, 4504(RA)
9D016858  3083001F   ANDI V1, A0, 31
9D01685C  93E21162   LBU V0, 4450(RA)
9D016860  304500E0   ANDI A1, V0, 224
355:                 
356:                       if (ppu.strikeflag)
9D016864  8FE6119C   LW A2, 4508(RA)
9D016868  10C00008   BEQ A2, ZERO, 0x9D01688C
9D01686C  00A38025   OR S0, A1, V1
357:                       {
358:                          if (nes6502_getcycles(false) >= ppu.strike_cycle)
9D016870  0F4031E8   JAL nes6502_getcycles
9D016874  00002021   ADDU A0, ZERO, ZERO
9D016878  3C07A001   LUI A3, -24575
9D01687C  8CE813F8   LW T0, 5112(A3)
9D016880  0048482B   SLTU T1, V0, T0
359:                             value |= PPU_STATF_STRIKE;
9D016884  360A0040   ORI T2, S0, 64
9D016888  0149800A   MOVZ S0, T2, T1
360:                       }
361:                 
362:                       /* clear both vblank flag and vram address flipflop */
363:                       ppu.stat &= ~PPU_STATF_VBLANK;
9D01688C  3C11A001   LUI S1, -24575
9D016890  262B0258   ADDIU T3, S1, 600
9D016894  916C1162   LBU T4, 4450(T3)
9D016898  318D007F   ANDI T5, T4, 127
9D01689C  A16D1162   SB T5, 4450(T3)
364:                       ppu.flipflop = 0;
365:                       break;
9D0168A0  0B405A5C   J 0x9D016970
9D0168A4  AD601170   SW ZERO, 4464(T3)
366:                 
367:                    case PPU_VDATA:
368:                       /* buffered VRAM reads */
369:                       value = ppu.latch = ppu.vdata_latch;
9D0168A8  24C70258   ADDIU A3, A2, 600
9D0168AC  90F01199   LBU S0, 4505(A3)
9D0168B0  A0F01198   SB S0, 4504(A3)
370:                 
371:                       /* VRAM only accessible during VBL */
372:                       if ((ppu.bg_on || ppu.obj_on) && !ppu.vram_accessible)
9D0168B4  8CE81188   LW T0, 4488(A3)
9D0168B8  15000006   BNE T0, ZERO, 0x9D0168D4
9D0168BC  3C0BA001   LUI T3, -24575
9D0168C0  3C09A001   LUI T1, -24575
9D0168C4  8D2A13E4   LW T2, 5092(T1)
9D0168C8  11400012   BEQ T2, ZERO, .LBB14
9D0168CC  3C0DA001   LUI T5, -24575
9D0168D0  3C0BA001   LUI T3, -24575
9D0168D4  8D6C2004   LW T4, 8196(T3)
9D0168D8  1580000E   BNE T4, ZERO, .LBB14
9D0168DC  3C0DA001   LUI T5, -24575
373:                       {
374:                          ppu.vdata_latch = 0xFF;
9D0168E0  3C08A001   LUI T0, -24575
9D0168E4  25090258   ADDIU T1, T0, 600
9D0168E8  240AFFFF   ADDIU T2, ZERO, -1
9D0168EC  A12A1199   SB T2, 4505(T1)
375:                          log_printf("VRAM read at $%04X, scanline %d\n", 
9D0168F8  3C0B9D04   LUI T3, -25340
9D0168FC  25641ABC   ADDIU A0, T3, 6844
9D016900  02202821   ADDU A1, S1, ZERO
9D016904  0F410817   JAL log_printf
9D016908  8C460320   LW A2, 800(V0)
9D01690C  0B405A54   J 0x9D016950
9D016910  3C0CA001   LUI T4, -24575
376:                                     ppu.vaddr, nes_getcontextptr()->scanline);
9D0168F0  0F4097E7   JAL nes_getcontextptr
9D0168F4  8D311164   LW S1, 4452(T1)
377:                       }
378:                       else
379:                       {
380:                          uint32 addr = ppu.vaddr;
9D016914  8DAE13BC   LW T6, 5052(T5)
381:                          if (addr >= 0x3000)
9D016918  2DCF3000   SLTIU T7, T6, 12288
382:                             addr -= 0x1000;
9D01691C  25D1F000   ADDIU S1, T6, -4096
9D016920  022F700A   MOVZ T6, S1, T7
383:                          ppu.vdata_latch = PPU_MEM(addr);
9D016924  000EC282   SRL T8, T6, 10
9D016928  27190448   ADDIU T9, T8, 1096
9D01692C  0019F880   SLL RA, T9, 2
9D016930  3C04A001   LUI A0, -24575
9D016934  24830258   ADDIU V1, A0, 600
9D016938  03E31021   ADDU V0, RA, V1
9D01693C  8C450000   LW A1, 0(V0)
9D016940  00AE3021   ADDU A2, A1, T6
9D016944  90C70000   LBU A3, 0(A2)
9D016948  A0671199   SB A3, 4505(V1)
384:                       }
385:                 
386:                       ppu.vaddr += ppu.vaddr_inc;
9D016954  8DAE1174   LW T6, 4468(T5)
9D016958  8DAF1164   LW T7, 4452(T5)
9D01695C  01CFC021   ADDU T8, T6, T7
387:                       ppu.vaddr &= 0x3FFF;
9D01694C  3C0CA001   LUI T4, -24575
9D016950  258D0258   ADDIU T5, T4, 600
9D016960  33193FFF   ANDI T9, T8, 16383
388:                       break;
9D016964  0B405A5C   J 0x9D016970
9D016968  ADB91164   SW T9, 4452(T5)
389:                 
390:                    case PPU_OAMDATA:
391:                    case PPU_CTRL0:
392:                    case PPU_CTRL1:
393:                    case PPU_OAMADDR:
394:                    case PPU_SCROLL:
395:                    case PPU_VADDR:
396:                    default:
397:                       value = ppu.latch;
9D016844  0B405A5B   J 0x9D01696C
9D016848  3C05A001   LUI A1, -24575
9D01696C  90B013F0   LBU S0, 5104(A1)
398:                       break;
399:                    }
400:                 
401:                    return value;
402:                 }
9D016970  02001021   ADDU V0, S0, ZERO
9D016974  8FBF001C   LW RA, 28(SP)
9D016978  8FB10018   LW S1, 24(SP)
9D01697C  8FB00014   LW S0, 20(SP)
9D016980  03E00008   JR RA
9D016984  27BD0020   ADDIU SP, SP, 32
403:                 
404:                 /* Write to $2000-$2007 */
405:                 void ppu_write(uint32 address, uint8 value)
406:                 {
9D016BB8  27BDFFE8   ADDIU SP, SP, -24
9D016BBC  AFBF0014   SW RA, 20(SP)
9D016BC0  AFB00010   SW S0, 16(SP)
407:                    /* write goes into ppu latch... */
408:                    ppu.latch = value;
9D016988  3C02A001   LUI V0, -24575
409:                    
410:                    switch (address & 0x2007)
9D01698C  30842007   ANDI A0, A0, 8199
9D016990  2483E000   ADDIU V1, A0, -8192
9D016994  2C660008   SLTIU A2, V1, 8
9D016998  10C000E2   BEQ A2, ZERO, 0x9D016D24
9D01699C  A04513F0   SB A1, 5104(V0)
9D0169A0  00033880   SLL A3, V1, 2
9D0169A4  3C089D01   LUI T0, -25343
9D0169A8  250969BC   ADDIU T1, T0, 27068
9D0169AC  01275021   ADDU T2, T1, A3
9D0169B0  8D4B0000   LW T3, 0(T2)
9D0169B4  01600008   JR T3
9D0169B8  00000000   NOP
411:                    {
412:                    case PPU_CTRL0:
413:                       ppu.ctrl0 = value;
9D0169DC  3C0FA001   LUI T7, -24575
9D0169E0  A1E513B8   SB A1, 5048(T7)
414:                 
415:                       ppu.obj_height = (value & PPU_CTRL0F_OBJ16) ? 16 : 8;
9D0169E4  30B80020   ANDI T8, A1, 32
9D0169E8  331900FF   ANDI T9, T8, 255
9D0169EC  24020010   ADDIU V0, ZERO, 16
9D0169F0  24040008   ADDIU A0, ZERO, 8
9D0169F4  0099100A   MOVZ V0, A0, T9
9D0169F8  3C07A001   LUI A3, -24575
9D0169FC  A0E213D4   SB V0, 5076(A3)
416:                       ppu.bg_base = (value & PPU_CTRL0F_BGADDR) ? 0x1000 : 0;
9D016A00  30A80010   ANDI T0, A1, 16
9D016A04  310900FF   ANDI T1, T0, 255
9D016A08  240A1000   ADDIU T2, ZERO, 4096
9D016A0C  0009500A   MOVZ T2, ZERO, T1
9D016A10  3C0BA001   LUI T3, -24575
9D016A14  AD6A13DC   SW T2, 5084(T3)
417:                       ppu.obj_base = (value & PPU_CTRL0F_OBJADDR) ? 0x1000 : 0;
9D016A18  30AC0008   ANDI T4, A1, 8
9D016A1C  318D00FF   ANDI T5, T4, 255
9D016A20  240E1000   ADDIU T6, ZERO, 4096
9D016A24  000D700A   MOVZ T6, ZERO, T5
9D016A28  3C18A001   LUI T8, -24575
9D016A2C  AF0E13D8   SW T6, 5080(T8)
418:                       ppu.vaddr_inc = (value & PPU_CTRL0F_ADDRINC) ? 32 : 1;
9D016A30  30B90004   ANDI T9, A1, 4
9D016A34  332600FF   ANDI A2, T9, 255
9D016A38  24020020   ADDIU V0, ZERO, 32
9D016A3C  24040001   ADDIU A0, ZERO, 1
9D016A40  0086100A   MOVZ V0, A0, A2
9D016A44  3C08A001   LUI T0, -24575
9D016A48  25090258   ADDIU T1, T0, 600
9D016A4C  AD221174   SW V0, 4468(T1)
419:                       ppu.tile_nametab = value & PPU_CTRL0F_NAMETAB;      
9D016A50  30A50003   ANDI A1, A1, 3
9D016A54  AD251178   SW A1, 4472(T1)
420:                 
421:                       /* Mask out bits 10 & 11 in the ppu latch */
422:                       ppu.vaddr_latch &= ~0x0C00;
9D016A5C  8D231168   LW V1, 4456(T1)
9D016A60  7C035A84   INS V1, ZERO, 10, 2
423:                       ppu.vaddr_latch |= ((value & 3) << 10);
9D016A58  00055280   SLL T2, A1, 10
9D016A64  01435825   OR T3, T2, V1
424:                       break;
9D016A68  03E00008   JR RA
9D016A6C  AD2B1168   SW T3, 4456(T1)
425:                 
426:                    case PPU_CTRL1:
427:                       ppu.ctrl1 = value;
9D016A70  3C08A001   LUI T0, -24575
9D016A74  25090258   ADDIU T1, T0, 600
9D016A78  A1251161   SB A1, 4449(T1)
428:                 
429:                       ppu.obj_on = (value & PPU_CTRL1F_OBJON) ? true : false;
9D016A7C  7CAA0100   EXT T2, A1, 4, 1
9D016A80  AD2A118C   SW T2, 4492(T1)
430:                       ppu.bg_on = (value & PPU_CTRL1F_BGON) ? true : false;
9D016A84  7CA300C0   EXT V1, A1, 3, 1
9D016A88  AD231188   SW V1, 4488(T1)
431:                       ppu.obj_mask = (value & PPU_CTRL1F_OBJMASK) ? false : true;
9D016A8C  38AB0004   XORI T3, A1, 4
9D016A90  7D6C0080   EXT T4, T3, 2, 1
9D016A94  AD2C1190   SW T4, 4496(T1)
432:                       ppu.bg_mask = (value & PPU_CTRL1F_BGMASK) ? false : true;
9D016A98  38AD0002   XORI T5, A1, 2
9D016A9C  7DAE0040   EXT T6, T5, 1, 1
433:                       break;
9D016AA0  03E00008   JR RA
9D016AA4  AD2E1194   SW T6, 4500(T1)
434:                 
435:                    case PPU_OAMADDR:
436:                       ppu.oam_addr = value;
9D016AA8  3C07A001   LUI A3, -24575
437:                       break;
9D016AAC  03E00008   JR RA
9D016AB0  A0E513BB   SB A1, 5051(A3)
438:                 
439:                    case PPU_OAMDATA:
440:                       ppu.oam[ppu.oam_addr++] = value;
9D016AB4  3C18A001   LUI T8, -24575
9D016AB8  27190258   ADDIU T9, T8, 600
9D016ABC  93221163   LBU V0, 4451(T9)
9D016AC0  24440001   ADDIU A0, V0, 1
9D016AC4  A3241163   SB A0, 4451(T9)
9D016AC8  00593021   ADDU A2, V0, T9
441:                       break;
9D016ACC  03E00008   JR RA
9D016AD0  A0C51000   SB A1, 4096(A2)
442:                 
443:                    case PPU_SCROLL:
444:                       if (0 == ppu.flipflop)
9D016AD4  3C0AA001   LUI T2, -24575
9D016AD8  8D4B13C8   LW T3, 5064(T2)
9D016ADC  1560000B   BNE T3, ZERO, 0x9D016B0C
9D016AE0  3C0CA001   LUI T4, -24575
445:                       {
446:                          /* Mask out bits 4 - 0 in the ppu latch */
447:                          ppu.vaddr_latch &= ~0x001F;
9D016AF0  8D231168   LW V1, 4456(T1)
9D016AF4  7C032004   INS V1, ZERO, 0, 5
448:                          ppu.vaddr_latch |= (value >> 3);    /* Tile number */
9D016AE4  3C08A001   LUI T0, -24575
9D016AE8  25090258   ADDIU T1, T0, 600
9D016AEC  000550C2   SRL T2, A1, 3
9D016AF8  01435825   OR T3, T2, V1
9D016AFC  AD2B1168   SW T3, 4456(T1)
449:                          ppu.tile_xofs = (value & 7);  /* Tile offset (0-7 pix) */
9D016B00  30AC0007   ANDI T4, A1, 7
9D016B04  0B405ACE   J 0x9D016B38
9D016B08  AD2C116C   SW T4, 4460(T1)
450:                       }
451:                       else
452:                       {
453:                          /* Mask out bits 14-12 and 9-5 in the ppu latch */
454:                          ppu.vaddr_latch &= ~0x73E0;
9D016B24  8DA21168   LW V0, 4456(T5)
9D016B28  24048C1F   ADDIU A0, ZERO, -29665
9D016B2C  00443024   AND A2, V0, A0
455:                          ppu.vaddr_latch |= ((value & 0xF8) << 2);   /* Tile number */
9D016B10  30AE00F8   ANDI T6, A1, 248
9D016B14  000E7880   SLL T7, T6, 2
9D016B20  01F8C825   OR T9, T7, T8
456:                          ppu.vaddr_latch |= ((value & 7) << 12);     /* Tile offset (0-7 pix) */
9D016B0C  258D0258   ADDIU T5, T4, 600
9D016B18  30A50007   ANDI A1, A1, 7
9D016B1C  0005C300   SLL T8, A1, 12
9D016B30  03263825   OR A3, T9, A2
9D016B34  ADA71168   SW A3, 4456(T5)
457:                       }
458:                 
459:                       ppu.flipflop ^= 1;
9D016B38  3C0DA001   LUI T5, -24575
9D016B3C  25AE0258   ADDIU T6, T5, 600
9D016B40  8DCF1170   LW T7, 4464(T6)
9D016B44  39E50001   XORI A1, T7, 1
9D016B48  ADC51170   SW A1, 4464(T6)
9D016B4C  03E00008   JR RA
9D016B50  00000000   NOP
460:                 
461:                       break;
462:                 
463:                    case PPU_VADDR:
464:                       if (0 == ppu.flipflop)
9D016B54  3C0AA001   LUI T2, -24575
9D016B58  8D4B13C8   LW T3, 5064(T2)
9D016B5C  1560000A   BNE T3, ZERO, 0x9D016B88
9D016B60  3C0CA001   LUI T4, -24575
465:                       {
466:                          /* Mask out bits 15-8 in ppu latch */
467:                          ppu.vaddr_latch &= ~0xFF00;
9D016B74  8F041168   LW A0, 4456(T8)
9D016B78  7C047A04   INS A0, ZERO, 8, 8
468:                          ppu.vaddr_latch |= ((value & 0x3F) << 8);
9D016B64  3C0FA001   LUI T7, -24575
9D016B68  25F80258   ADDIU T8, T7, 600
9D016B6C  30B9003F   ANDI T9, A1, 63
9D016B70  00191200   SLL V0, T9, 8
9D016B7C  00443025   OR A2, V0, A0
9D016B80  0B405AE8   J 0x9D016BA0
9D016B84  AF061168   SW A2, 4456(T8)
469:                       }
470:                       else
471:                       {
472:                          /* Mask out bits 7-0 in ppu latch */
473:                          ppu.vaddr_latch &= ~0x00FF;
9D016B88  258D0258   ADDIU T5, T4, 600
9D016B8C  8DAE1168   LW T6, 4456(T5)
9D016B90  7C0E3804   INS T6, ZERO, 0, 8
474:                          ppu.vaddr_latch |= value;
9D016B94  00AE2825   OR A1, A1, T6
9D016B98  ADA51168   SW A1, 4456(T5)
475:                          ppu.vaddr = ppu.vaddr_latch;
9D016B9C  ADA51164   SW A1, 4452(T5)
476:                       }
477:                       
478:                       ppu.flipflop ^= 1;
9D016BA0  3C07A001   LUI A3, -24575
9D016BA4  24E80258   ADDIU T0, A3, 600
9D016BA8  8D031170   LW V1, 4464(T0)
9D016BAC  38690001   XORI T1, V1, 1
479:                 
480:                       break;
9D016BB0  03E00008   JR RA
9D016BB4  AD091170   SW T1, 4464(T0)
481:                 
482:                    case PPU_VDATA:
483:                       if (ppu.vaddr < 0x3F00)
9D016BC4  3C0CA001   LUI T4, -24575
9D016BC8  8D9013BC   LW S0, 5052(T4)
9D016BCC  2E0D3F00   SLTIU T5, S0, 16128
9D016BD0  11A00033   BEQ T5, ZERO, 0x9D016CA0
9D016BD4  320E000F   ANDI T6, S0, 15
484:                       {
485:                          /* VRAM only accessible during scanlines 241-260 */
486:                          if ((ppu.bg_on || ppu.obj_on) && !ppu.vram_accessible)
9D016BD8  3C08A001   LUI T0, -24575
9D016BDC  8D0913E0   LW T1, 5088(T0)
9D016BE0  15200006   BNE T1, ZERO, 0x9D016BFC
9D016BE4  3C0CA001   LUI T4, -24575
9D016BE8  3C0AA001   LUI T2, -24575
9D016BEC  8D4B13E4   LW T3, 5092(T2)
9D016BF0  11600018   BEQ T3, ZERO, .LBB15
9D016BF4  3C0EA001   LUI T6, -24575
9D016BF8  3C0CA001   LUI T4, -24575
9D016BFC  8D8D2004   LW T5, 8196(T4)
9D016C00  15A00014   BNE T5, ZERO, .LBB15
9D016C04  3C0EA001   LUI T6, -24575
487:                          {
488:                             log_printf("VRAM write to $%04X, scanline %d\n", 
9D016C10  3C059D04   LUI A1, -25340
9D016C14  24A41AE0   ADDIU A0, A1, 6880
9D016C18  02002821   ADDU A1, S0, ZERO
9D016C1C  0F410817   JAL log_printf
9D016C20  8C460320   LW A2, 800(V0)
489:                                        ppu.vaddr, nes_getcontextptr()->scanline);
9D016C08  0F4097E7   JAL nes_getcontextptr
9D016C0C  00000000   NOP
490:                             PPU_MEM(ppu.vaddr) = 0xFF; /* corrupt */
9D016C24  3C0AA001   LUI T2, -24575
9D016C28  254B0258   ADDIU T3, T2, 600
9D016C2C  8D6C1164   LW T4, 4452(T3)
9D016C30  000C6A82   SRL T5, T4, 10
9D016C34  25AE0448   ADDIU T6, T5, 1096
9D016C38  000E7880   SLL T7, T6, 2
9D016C3C  01EBC021   ADDU T8, T7, T3
9D016C40  8F190000   LW T9, 0(T8)
9D016C44  032C1021   ADDU V0, T9, T4
9D016C48  2404FFFF   ADDIU A0, ZERO, -1
9D016C4C  0B405B3F   J 0x9D016CFC
9D016C50  A0440000   SB A0, 0(V0)
491:                          }
492:                          else 
493:                          {
494:                             uint32 addr = ppu.vaddr;
495:                 
496:                             if (false == ppu.vram_present && addr >= 0x3000)
9D016C54  8DCF2008   LW T7, 8200(T6)
9D016C58  15E00008   BNE T7, ZERO, 0x9D016C7C
9D016C5C  00101282   SRL V0, S0, 10
9D016C60  2E183000   SLTIU T8, S0, 12288
9D016C64  17000006   BNE T8, ZERO, 0x9D016C80
9D016C68  24440448   ADDIU A0, V0, 1096
497:                                ppu.vaddr -= 0x1000;
9D016C6C  2619F000   ADDIU T9, S0, -4096
9D016C70  3C1FA001   LUI RA, -24575
9D016C74  AFF913BC   SW T9, 5052(RA)
498:                 
499:                             PPU_MEM(addr) = value;
9D016C78  00101282   SRL V0, S0, 10
9D016C7C  24440448   ADDIU A0, V0, 1096
9D016C80  00041880   SLL V1, A0, 2
9D016C84  3C06A001   LUI A2, -24575
9D016C88  24C70258   ADDIU A3, A2, 600
9D016C8C  00674021   ADDU T0, V1, A3
9D016C90  8D090000   LW T1, 0(T0)
9D016C94  01308021   ADDU S0, T1, S0
9D016C98  0B405B3F   J 0x9D016CFC
9D016C9C  A2050000   SB A1, 0(S0)
500:                          }
501:                       }
502:                       else
503:                       {
504:                          if (0 == (ppu.vaddr & 0x0F))
9D016CA0  15C0000E   BNE T6, ZERO, 0x9D016CDC
9D016CA4  320F0003   ANDI T7, S0, 3
505:                          {
506:                             int i;
507:                 
508:                             for (i = 0; i < 8; i ++)
509:                                ppu.palette[i << 2] = (value & 0x3F) | BG_TRANS;
9D016CA8  30A4003F   ANDI A0, A1, 63
9D016CAC  34830080   ORI V1, A0, 128
9D016CB0  3C06A001   LUI A2, -24575
9D016CB4  24C70258   ADDIU A3, A2, 600
9D016CB8  A0E31100   SB V1, 4352(A3)
9D016CBC  A0E31104   SB V1, 4356(A3)
9D016CC0  A0E31108   SB V1, 4360(A3)
9D016CC4  A0E3110C   SB V1, 4364(A3)
9D016CC8  A0E31110   SB V1, 4368(A3)
9D016CCC  A0E31114   SB V1, 4372(A3)
9D016CD0  A0E31118   SB V1, 4376(A3)
9D016CD4  0B405B3F   J 0x9D016CFC
9D016CD8  A0E3111C   SB V1, 4380(A3)
510:                          }
511:                          else if (ppu.vaddr & 3)
9D016CDC  11E00008   BEQ T7, ZERO, 0x9D016D00
9D016CE0  3C1FA001   LUI RA, -24575
512:                          {
513:                             ppu.palette[ppu.vaddr & 0x1F] = value & 0x3F;
9D016CE4  3218001F   ANDI T8, S0, 31
9D016CE8  3C19A001   LUI T9, -24575
9D016CEC  273F0258   ADDIU RA, T9, 600
9D016CF0  031F1021   ADDU V0, T8, RA
9D016CF4  30A5003F   ANDI A1, A1, 63
9D016CF8  A0451100   SB A1, 4352(V0)
514:                          }
515:                       }
516:                 
517:                       ppu.vaddr += ppu.vaddr_inc;
9D016D04  8CC71174   LW A3, 4468(A2)
9D016D08  8CC31164   LW V1, 4452(A2)
9D016D0C  00E34021   ADDU T0, A3, V1
518:                       ppu.vaddr &= 0x3FFF;
9D016CFC  3C1FA001   LUI RA, -24575
9D016D00  27E60258   ADDIU A2, RA, 600
9D016D10  31093FFF   ANDI T1, T0, 16383
9D016D14  ACC91164   SW T1, 4452(A2)
519:                       break;
520:                 
521:                    default:
522:                       break;
523:                    }
524:                 }
9D016D18  8FBF0014   LW RA, 20(SP)
9D016D1C  8FB00010   LW S0, 16(SP)
9D016D20  27BD0018   ADDIU SP, SP, 24
9D016D24  03E00008   JR RA
9D016D28  00000000   NOP
525:                 
526:                 /* Builds a 256 color 8-bit palette based on a 64-color NES palette
527:                 ** Note that we set it up 3 times so that we flip bits on the primary
528:                 ** NES buffer for priorities
529:                 */
530:                 static void ppu_buildpalette(ppu_t *src_ppu, rgb_t *pal)
531:                 {
532:                    int i;
533:                 
534:                    /* Set it up 3 times, for sprite priority/BG transparency trickery */
535:                    for (i = 0; i < 64; i++)
9D016EC4  14E0FF9B   BNE A3, ZERO, .LBB21, .LBB22
536:                    {
537:                       src_ppu->curpal[i].r = src_ppu->curpal[i + 64].r 
9D016D40  ACC2FA00   SW V0, -1536(A2)
9D016D78  AD45FA00   SW A1, -1536(T2)
9D016DA8  AD4CFA0C   SW T4, -1524(T2)
9D016DD8  AD4FFA18   SW T7, -1512(T2)
9D016E08  AD42FA24   SW V0, -1500(T2)
9D016E38  AD45FA30   SW A1, -1488(T2)
9D016E68  AD4CFA3C   SW T4, -1476(T2)
9D016E98  AD4FFA48   SW T7, -1464(T2)
538:                                            = src_ppu->curpal[i + 128].r = pal[i].r;
9D016D34  8CA20000   LW V0, 0(A1)
9D016D6C  8CA5000C   LW A1, 12(A1)
9D016D9C  8D2C000C   LW T4, 12(T1)
9D016DCC  8D2F0018   LW T7, 24(T1)
9D016DFC  8D220024   LW V0, 36(T1)
9D016E2C  8D250030   LW A1, 48(T1)
9D016E5C  8D2C003C   LW T4, 60(T1)
9D016E8C  8D2F0048   LW T7, 72(T1)
539:                       src_ppu->curpal[i].g = src_ppu->curpal[i + 64].g
9D016D50  ACC3FA04   SW V1, -1532(A2)
9D016D88  AD46FA04   SW A2, -1532(T2)
9D016DB8  AD4DFA10   SW T5, -1520(T2)
9D016DE8  AD58FA1C   SW T8, -1508(T2)
9D016E18  AD43FA28   SW V1, -1496(T2)
9D016E48  AD46FA34   SW A2, -1484(T2)
9D016E78  AD4DFA40   SW T5, -1472(T2)
9D016EA8  AD58FA4C   SW T8, -1460(T2)
540:                                            = src_ppu->curpal[i + 128].g = pal[i].g;
9D016D44  8CA30004   LW V1, 4(A1)
9D016D7C  8D260004   LW A2, 4(T1)
9D016DAC  8D2D0010   LW T5, 16(T1)
9D016DDC  8D38001C   LW T8, 28(T1)
9D016E0C  8D230028   LW V1, 40(T1)
9D016E3C  8D260034   LW A2, 52(T1)
9D016E6C  8D2D0040   LW T5, 64(T1)
9D016E9C  8D38004C   LW T8, 76(T1)
541:                       src_ppu->curpal[i].b = src_ppu->curpal[i + 64].b
9D016D60  ACC8FA08   SW T0, -1528(A2)
9D016D98  AD4BFA08   SW T3, -1528(T2)
9D016DC8  AD4EFA14   SW T6, -1516(T2)
9D016DF8  AD59FA20   SW T9, -1504(T2)
9D016E28  AD48FA2C   SW T0, -1492(T2)
9D016E58  AD4BFA38   SW T3, -1480(T2)
9D016E88  AD4EFA44   SW T6, -1468(T2)
9D016EB8  AD59FA50   SW T9, -1456(T2)
542:                                            = src_ppu->curpal[i + 128].b = pal[i].b;
9D016D54  8CA80008   LW T0, 8(A1)
9D016D8C  8D2B0008   LW T3, 8(T1)
9D016DBC  8D2E0014   LW T6, 20(T1)
9D016DEC  8D390020   LW T9, 32(T1)
9D016E1C  8D28002C   LW T0, 44(T1)
9D016E4C  8D2B0038   LW T3, 56(T1)
9D016E7C  8D2E0044   LW T6, 68(T1)
9D016EAC  8D390050   LW T9, 80(T1)
543:                    }
544:                 
545:                    for (i = 0; i < GUI_TOTALCOLORS; i++)
546:                    {
547:                       src_ppu->curpal[i + 192].r = gui_pal[i].r;
9D016ECC  3C09A001   LUI T1, -24575
9D016EEC  8C45000C   LW A1, 12(V0)
9D016F04  8C4D0018   LW T5, 24(V0)
9D016F1C  8C580024   LW T8, 36(V0)
9D016F34  8C460030   LW A2, 48(V0)
9D016F4C  8C43003C   LW V1, 60(V0)
9D016F64  8C4B0048   LW T3, 72(V0)
9D016F7C  8C4E0054   LW T6, 84(V0)
9D016F94  8C590060   LW T9, 96(V0)
9D016FAC  8C49006C   LW T1, 108(V0)
9D016FC4  8C480078   LW T0, 120(V0)
9D016FDC  8C4C0084   LW T4, 132(V0)
9D016FF4  8C4F0090   LW T7, 144(V0)
9D01700C  8C47009C   LW A3, 156(V0)
548:                       src_ppu->curpal[i + 192].g = gui_pal[i].g;
9D016ED8  25224940   ADDIU V0, T1, 18752
9D016EF4  8C4B0010   LW T3, 16(V0)
9D016F0C  8C4E001C   LW T6, 28(V0)
9D016F24  8C590028   LW T9, 40(V0)
9D016F3C  8C490034   LW T1, 52(V0)
9D016F54  8C480040   LW T0, 64(V0)
9D016F6C  8C4C004C   LW T4, 76(V0)
9D016F84  8C4F0058   LW T7, 88(V0)
9D016F9C  8C470064   LW A3, 100(V0)
9D016FB4  8C4A0070   LW T2, 112(V0)
9D016FCC  8C45007C   LW A1, 124(V0)
9D016FE4  8C4D0088   LW T5, 136(V0)
9D016FFC  8C580094   LW T8, 148(V0)
9D017014  8C4600A0   LW A2, 160(V0)
549:                       src_ppu->curpal[i + 192].b = gui_pal[i].b;
9D016EE4  8C480008   LW T0, 8(V0)
9D016EFC  8C4C0014   LW T4, 20(V0)
9D016F14  8C4F0020   LW T7, 32(V0)
9D016F2C  8C47002C   LW A3, 44(V0)
9D016F44  8C4A0038   LW T2, 56(V0)
9D016F5C  8C450044   LW A1, 68(V0)
9D016F74  8C4D0050   LW T5, 80(V0)
9D016F8C  8C58005C   LW T8, 92(V0)
9D016FA4  8C460068   LW A2, 104(V0)
9D016FBC  8C430074   LW V1, 116(V0)
9D016FD4  8C4B0080   LW T3, 128(V0)
9D016FEC  8C4E008C   LW T6, 140(V0)
9D017004  8C590098   LW T9, 152(V0)
9D01701C  8C4200A4   LW V0, 164(V0)
9D017020  AC821B50   SW V0, 6992(A0)
550:                    }
551:                 }
552:                 
553:                 uint16 myPalette[256];
554:                 
555:                 /* copy nes palette over to hardware */
556:                 static void set_palette(rgb_t *pal)
557:                 {
558:                 	uint16 c;
559:                 
560:                    int i;
561:                 
562:                    for (i = 0; i < 256; i++)
9D017150  1488FFC5   BNE A0, T0, 0x9D017068
563:                    {
564:                       c=(pal[i].b>>3)+((pal[i].g>>2)<<5)+((pal[i].r>>3)<<11);
9D017034  8D230004   LW V1, 4(T1)
9D017068  8DC50004   LW A1, 4(T6)
9D01709C  8DC60010   LW A2, 16(T6)
9D0170C8  8D440010   LW A0, 16(T2)
9D0170F4  8D44001C   LW A0, 28(T2)
9D017120  8D440028   LW A0, 40(T2)
565:                       //myPalette[i]=(c>>8)|((c&0xff)<<8);
566:                       myPalette[i]=c;
9D01705C  A54E0000   SH T6, 0(T2)
9D017090  A4890000   SH T1, 0(A0)
9D0170C4  A48F0002   SH T7, 2(A0)
9D0170F0  A56C0002   SH T4, 2(T3)
9D01711C  A5780004   SH T8, 4(T3)
9D017148  A56D0006   SH T5, 6(T3)
9D01714C  25640008   ADDIU A0, T3, 8
9D017150  1488FFC5   BNE A0, T0, 0x9D017068
9D017154  254E0030   ADDIU T6, T2, 48
567:                    }
568:                 
569:                 }
570:                 
571:                 /* build the emulator specific palette based on a 64-entry palette
572:                 ** input palette can be either nes_palette or a 64-entry RGB palette
573:                 ** read in from disk (i.e. for VS games)
574:                 */
575:                 void ppu_setpal(ppu_t *src_ppu, rgb_t *pal)
576:                 {
9D016D2C  248617AC   ADDIU A2, A0, 6060
9D016D30  24070040   ADDIU A3, ZERO, 64
577:                    ppu_buildpalette(src_ppu, pal);
578:                    //vid_setpalette(src_ppu->curpal);
579:                    set_palette(src_ppu->curpal);
9D017024  248911AC   ADDIU T1, A0, 4524
9D017028  3C04A000   LUI A0, -24576
9D01702C  248A5D48   ADDIU T2, A0, 23880
9D017030  25480200   ADDIU T0, T2, 512
580:                 }
9D017158  03E00008   JR RA
9D01715C  00000000   NOP
581:                 
582:                 void ppu_setdefaultpal(ppu_t *src_ppu)
583:                 {
9D017160  27BDFFE8   ADDIU SP, SP, -24
9D017164  AFBF0014   SW RA, 20(SP)
584:                    ppu_setpal(src_ppu, nes_palette);
9D017168  3C05A000   LUI A1, -24576
9D01716C  0F405B4B   JAL ppu_setpal
9D017170  24A55F48   ADDIU A1, A1, 24392
585:                 }
9D017174  8FBF0014   LW RA, 20(SP)
9D017178  03E00008   JR RA
9D01717C  27BD0018   ADDIU SP, SP, 24
586:                 
587:                 void ppu_setlatchfunc(ppulatchfunc_t func)
588:                 {
589:                    ppu.latchfunc = func;
9D0171F4  3C02A001   LUI V0, -24575
9D0171F8  03E00008   JR RA
9D0171FC  AC4413FC   SW A0, 5116(V0)
590:                 }
591:                 
592:                 void ppu_setvromswitch(ppuvromswitch_t func)
593:                 {
594:                    ppu.vromswitch = func;
9D017200  3C02A001   LUI V0, -24575
9D017204  03E00008   JR RA
9D017208  AC441400   SW A0, 5120(V0)
595:                 }
596:                 
597:                 /* rendering routines */
598:                 INLINE void draw_bgtile(uint8 *surface, uint8 pat1, uint8 pat2, 
599:                                         const uint8 *colors)
600:                 {
601:                    uint32 pattern = ((pat2 & 0xAA) << 8) | ((pat2 & 0x55) << 1)
9D0174C8  2416FFAA   ADDIU S6, ZERO, -86
9D017518  03361824   AND V1, T9, S6
9D01751C  00032200   SLL A0, V1, 8
9D017520  33250055   ANDI A1, T9, 85
9D017524  00053040   SLL A2, A1, 1
9D017528  00864025   OR T0, A0, A2
9D017FD8  240CFFAA   ADDIU T4, ZERO, -86
9D0181D8  00ECA824   AND S5, A3, T4
9D0181DC  0015AA00   SLL S5, S5, 8
9D0181E0  30E70055   ANDI A3, A3, 85
9D0181E4  00073840   SLL A3, A3, 1
9D0181E8  02A7A825   OR S5, S5, A3
9D01852C  240BFFAA   ADDIU T3, ZERO, -86
9D018574  024B1824   AND V1, S2, T3
9D018578  00031A00   SLL V1, V1, 8
9D01857C  324A0055   ANDI T2, S2, 85
9D018580  000A9040   SLL S2, T2, 1
9D018584  00721825   OR V1, V1, S2
602:                                     | ((pat1 & 0xAA) << 7) | (pat1 & 0x55);
9D01752C  31E90055   ANDI T1, T7, 85
9D017530  01091025   OR V0, T0, T1
9D017534  01F65024   AND T2, T7, S6
9D017538  000A59C0   SLL T3, T2, 7
9D01753C  004B6025   OR T4, V0, T3
9D0181EC  32670055   ANDI A3, S3, 85
9D0181F0  02A7A825   OR S5, S5, A3
9D0181F4  026C9824   AND S3, S3, T4
9D0181F8  001339C0   SLL A3, S3, 7
9D0181FC  02A7A825   OR S5, S5, A3
9D018588  312A0055   ANDI T2, T1, 85
9D01858C  006A9025   OR S2, V1, T2
9D018590  012B4824   AND T1, T1, T3
9D018594  000919C0   SLL V1, T1, 7
9D018598  02435025   OR T2, S2, V1
603:                    
604:                    *surface++ = colors[(pattern >> 14) & 3];
9D017540  000C6B82   SRL T5, T4, 14
9D017544  00ED7021   ADDU T6, A3, T5
9D017548  91D30000   LBU S3, 0(T6)
9D01754C  A2130000   SB S3, 0(S0)
9D018200  00159B82   SRL S3, S5, 14
9D018204  01133821   ADDU A3, T0, S3
9D018208  90F30000   LBU S3, 0(A3)
9D01820C  A0530000   SB S3, 0(V0)
9D01859C  000A9382   SRL S2, T2, 14
9D0185A0  00F24821   ADDU T1, A3, S2
9D0185A4  91230000   LBU V1, 0(T1)
9D0185A8  A0430000   SB V1, 0(V0)
605:                    *surface++ = colors[(pattern >> 6) & 3];
9D017550  7D980980   EXT T8, T4, 6, 2
9D017554  00F87821   ADDU T7, A3, T8
9D017558  91F90000   LBU T9, 0(T7)
9D01755C  A2190001   SB T9, 1(S0)
9D018210  7EA70980   EXT A3, S5, 6, 2
9D018214  01079821   ADDU S3, T0, A3
9D018218  92670000   LBU A3, 0(S3)
9D01821C  A0470001   SB A3, 1(V0)
9D0185AC  7D520980   EXT S2, T2, 6, 2
9D0185B0  00F24821   ADDU T1, A3, S2
9D0185B4  91230000   LBU V1, 0(T1)
9D0185B8  A0430001   SB V1, 1(V0)
606:                    *surface++ = colors[(pattern >> 12) & 3];
9D017560  7D9F0B00   EXT RA, T4, 12, 2
9D017564  00FF1821   ADDU V1, A3, RA
9D017568  90640000   LBU A0, 0(V1)
9D01756C  A2040002   SB A0, 2(S0)
9D018220  7EB30B00   EXT S3, S5, 12, 2
9D018224  01133821   ADDU A3, T0, S3
9D018228  90F30000   LBU S3, 0(A3)
9D01822C  A0530002   SB S3, 2(V0)
9D0185BC  7D520B00   EXT S2, T2, 12, 2
9D0185C0  00F24821   ADDU T1, A3, S2
9D0185C4  91230000   LBU V1, 0(T1)
9D0185C8  A0430002   SB V1, 2(V0)
607:                    *surface++ = colors[(pattern >> 4) & 3];
9D017570  7D850900   EXT A1, T4, 4, 2
9D017574  00E53021   ADDU A2, A3, A1
9D017578  90C80000   LBU T0, 0(A2)
9D01757C  A2080003   SB T0, 3(S0)
9D018230  7EA70900   EXT A3, S5, 4, 2
9D018234  01079821   ADDU S3, T0, A3
9D018238  92670000   LBU A3, 0(S3)
9D01823C  A0470003   SB A3, 3(V0)
9D0185CC  7D520900   EXT S2, T2, 4, 2
9D0185D0  00F24821   ADDU T1, A3, S2
9D0185D4  91230000   LBU V1, 0(T1)
9D0185D8  A0430003   SB V1, 3(V0)
608:                    *surface++ = colors[(pattern >> 10) & 3];
9D017580  7D890A80   EXT T1, T4, 10, 2
9D017584  00E91021   ADDU V0, A3, T1
9D017588  904A0000   LBU T2, 0(V0)
9D01758C  A20A0004   SB T2, 4(S0)
9D018240  7EB30A80   EXT S3, S5, 10, 2
9D018244  01133821   ADDU A3, T0, S3
9D018248  90F30000   LBU S3, 0(A3)
9D01824C  A0530004   SB S3, 4(V0)
9D0185DC  7D520A80   EXT S2, T2, 10, 2
9D0185E0  00F24821   ADDU T1, A3, S2
9D0185E4  91230000   LBU V1, 0(T1)
9D0185E8  A0430004   SB V1, 4(V0)
609:                    *surface++ = colors[(pattern >> 2) & 3];
9D017590  7D8B0880   EXT T3, T4, 2, 2
9D017594  00EB6821   ADDU T5, A3, T3
9D017598  91AE0000   LBU T6, 0(T5)
9D01759C  A20E0005   SB T6, 5(S0)
9D018250  7EA70880   EXT A3, S5, 2, 2
9D018254  01079821   ADDU S3, T0, A3
9D018258  92670000   LBU A3, 0(S3)
9D01825C  A0470005   SB A3, 5(V0)
9D0185EC  7D520880   EXT S2, T2, 2, 2
9D0185F0  00F24821   ADDU T1, A3, S2
9D0185F4  91230000   LBU V1, 0(T1)
9D0185F8  A0430005   SB V1, 5(V0)
610:                    *surface++ = colors[(pattern >> 8) & 3];
9D0175A0  7D930A00   EXT S3, T4, 8, 2
9D0175A4  00F3C021   ADDU T8, A3, S3
9D0175A8  930F0000   LBU T7, 0(T8)
9D0175AC  A20F0006   SB T7, 6(S0)
9D018260  7EB30A00   EXT S3, S5, 8, 2
9D018264  01133821   ADDU A3, T0, S3
9D018268  90F30000   LBU S3, 0(A3)
9D01826C  A0530006   SB S3, 6(V0)
9D0185FC  7D520A00   EXT S2, T2, 8, 2
9D018600  00F24821   ADDU T1, A3, S2
9D018604  91230000   LBU V1, 0(T1)
9D018608  A0430006   SB V1, 6(V0)
611:                    *surface = colors[pattern & 3];
9D0175B0  318C0003   ANDI T4, T4, 3
9D0175B4  00EC3821   ADDU A3, A3, T4
9D0175B8  90F90000   LBU T9, 0(A3)
9D0175BC  A2190007   SB T9, 7(S0)
9D018270  32B50003   ANDI S5, S5, 3
9D018274  01153821   ADDU A3, T0, S5
9D018278  90F30000   LBU S3, 0(A3)
9D01827C  A0530007   SB S3, 7(V0)
9D01860C  314A0003   ANDI T2, T2, 3
9D018610  00EA9021   ADDU S2, A3, T2
9D018614  92490000   LBU T1, 0(S2)
9D018618  A0490007   SB T1, 7(V0)
612:                 }
613:                 
614:                 INLINE int draw_oamtile(uint8 *surface, uint8 attrib, uint8 pat1, 
615:                                         uint8 pat2, const uint8 *col_tbl, bool check_strike)
616:                 {
617:                    int strike_pixel = -1;
9D01797C  28990000   SLTI T9, A0, 0
9D017980  2402FFFF   ADDIU V0, ZERO, -1
9D017984  24040007   ADDIU A0, ZERO, 7
9D017988  0059200B   MOVN A0, V0, T9
618:                    uint32 color = ((pat2 & 0xAA) << 8) | ((pat2 & 0x55) << 1)
9D017858  240AFFAA   ADDIU T2, ZERO, -86
9D01785C  03EA3024   AND A2, RA, T2
9D017860  00068A00   SLL S1, A2, 8
9D017864  33EB0055   ANDI T3, RA, 85
9D017868  000B6040   SLL T4, T3, 1
9D01786C  022C6825   OR T5, S1, T4
619:                                   | ((pat1 & 0xAA) << 7) | (pat1 & 0x55);
9D017870  308E0055   ANDI T6, A0, 85
9D017874  01AE4825   OR T1, T5, T6
9D017878  008A4024   AND T0, A0, T2
9D01787C  0008C1C0   SLL T8, T0, 7
9D017880  01387825   OR T7, T1, T8
620:                 
621:                    /* sprite is not 100% transparent */
622:                    if (color)
9D017884  11E000F2   BEQ T7, ZERO, .LVL364
9D017888  00A32821   ADDU A1, A1, V1
623:                    {
624:                       uint8 colors[8];
625:                 
626:                       /* swap pixels around if our tile is flipped */
627:                       if (0 == (attrib & OAMF_HFLIP))
9D01788C  32E70040   ANDI A3, S7, 64
9D017890  30E200FF   ANDI V0, A3, 255
9D017894  5440000A   BNEL V0, ZERO, 0x9D0178C0
9D017898  000F6382   SRL T4, T7, 14
628:                       {
629:                          colors[0] = (color >> 14) & 3;
9D01789C  000F1B82   SRL V1, T7, 14
630:                          colors[1] = (color >> 6) & 3;
9D0178A0  7DE60980   EXT A2, T7, 6, 2
631:                          colors[2] = (color >> 12) & 3;
9D0178A4  7DE70B00   EXT A3, T7, 12, 2
632:                          colors[3] = (color >> 4) & 3;
9D0178A8  7DE80900   EXT T0, T7, 4, 2
633:                          colors[4] = (color >> 10) & 3;
9D0178AC  7DE90A80   EXT T1, T7, 10, 2
634:                          colors[5] = (color >> 2) & 3;
9D0178B0  7DEA0880   EXT T2, T7, 2, 2
635:                          colors[6] = (color >> 8) & 3;
9D0178B4  7DEB0A00   EXT T3, T7, 8, 2
636:                          colors[7] = color & 3;
9D0178B8  0B405E37   J 0x9D0178DC
9D0178BC  31EC0003   ANDI T4, T7, 3
637:                       }
638:                       else
639:                       {
640:                          colors[7] = (color >> 14) & 3;
641:                          colors[6] = (color >> 6) & 3;
9D0178C0  7DEB0980   EXT T3, T7, 6, 2
642:                          colors[5] = (color >> 12) & 3;
9D0178C4  7DEA0B00   EXT T2, T7, 12, 2
643:                          colors[4] = (color >> 4) & 3;
9D0178C8  7DE90900   EXT T1, T7, 4, 2
644:                          colors[3] = (color >> 10) & 3;
9D0178CC  7DE80A80   EXT T0, T7, 10, 2
645:                          colors[2] = (color >> 2) & 3;
9D0178D0  7DE70880   EXT A3, T7, 2, 2
646:                          colors[1] = (color >> 8) & 3;
9D0178D4  7DE60A00   EXT A2, T7, 8, 2
647:                          colors[0] = color & 3;
9D0178D8  31E30003   ANDI V1, T7, 3
648:                       }
649:                 
650:                       /* check for solid sprite pixel overlapping solid bg pixel */
651:                       if (check_strike)
9D0178DC  1320002B   BEQ T9, ZERO, 0x9D01798C
9D0178E0  2404FFFF   ADDIU A0, ZERO, -1
652:                       {
653:                          if (colors[0] && BG_SOLID(surface[0]))
9D0178E4  10600004   BEQ V1, ZERO, 0x9D0178F8
9D0178E8  00000000   NOP
9D0178EC  82D90000   LB T9, 0(S6)
9D0178F0  07210195   BGEZ T9, 0x9D017F48
9D0178F4  32F10020   ANDI S1, S7, 32
654:                             strike_pixel = 0;
655:                          else if (colors[1] && BG_SOLID(surface[1]))
9D0178F8  10C00004   BEQ A2, ZERO, 0x9D01790C
9D0178FC  00000000   NOP
9D017900  82DF0001   LB RA, 1(S6)
9D017904  07E10021   BGEZ RA, 0x9D01798C
9D017908  24040001   ADDIU A0, ZERO, 1
656:                             strike_pixel = 1;
657:                          else if (colors[2] && BG_SOLID(surface[2]))
9D01790C  10E00004   BEQ A3, ZERO, 0x9D017920
9D017910  00000000   NOP
9D017914  82D10002   LB S1, 2(S6)
9D017918  0621001C   BGEZ S1, 0x9D01798C
9D01791C  24040002   ADDIU A0, ZERO, 2
658:                             strike_pixel = 2;
659:                          else if (colors[3] && BG_SOLID(surface[3]))
9D017920  11000004   BEQ T0, ZERO, 0x9D017934
9D017924  00000000   NOP
9D017928  82CD0003   LB T5, 3(S6)
9D01792C  05A10017   BGEZ T5, 0x9D01798C
9D017930  24040003   ADDIU A0, ZERO, 3
660:                             strike_pixel = 3;
661:                          else if (colors[4] && BG_SOLID(surface[4]))
9D017934  11200004   BEQ T1, ZERO, 0x9D017948
9D017938  00000000   NOP
9D01793C  82CE0004   LB T6, 4(S6)
9D017940  05C10012   BGEZ T6, 0x9D01798C
9D017944  24040004   ADDIU A0, ZERO, 4
662:                             strike_pixel = 4;
663:                          else if (colors[5] && BG_SOLID(surface[5]))
9D017948  11400004   BEQ T2, ZERO, 0x9D01795C
9D01794C  00000000   NOP
9D017950  82D80005   LB T8, 5(S6)
9D017954  0701000D   BGEZ T8, 0x9D01798C
9D017958  24040005   ADDIU A0, ZERO, 5
664:                             strike_pixel = 5;
665:                          else if (colors[6] && BG_SOLID(surface[6]))
9D01795C  11600004   BEQ T3, ZERO, 0x9D017970
9D017960  00000000   NOP
9D017964  82CF0006   LB T7, 6(S6)
9D017968  05E10008   BGEZ T7, 0x9D01798C
9D01796C  24040006   ADDIU A0, ZERO, 6
666:                             strike_pixel = 6;
667:                          else if (colors[7] && BG_SOLID(surface[7]))
9D017970  11800006   BEQ T4, ZERO, 0x9D01798C
9D017974  2404FFFF   ADDIU A0, ZERO, -1
9D017978  82C40007   LB A0, 7(S6)
668:                             strike_pixel = 7;
669:                       }
670:                 
671:                       /* draw the character */
672:                       if (attrib & OAMF_BEHIND)
9D01798C  32F70020   ANDI S7, S7, 32
9D017990  32FF00FF   ANDI RA, S7, 255
9D017994  13E0005A   BEQ RA, ZERO, 0x9D017B00
9D017998  00000000   NOP
9D017F48  322D00FF   ANDI T5, S1, 255
9D017F4C  11A0FEEE   BEQ T5, ZERO, 0x9D017B08
9D017F50  00002021   ADDU A0, ZERO, ZERO
673:                       {
674:                          if (colors[0])
9D01799C  1060000A   BEQ V1, ZERO, 0x9D0179C8
9D0179A0  00000000   NOP
9D0179A4  92CE0000   LBU T6, 0(S6)
675:                             surface[0] = SP_PIXEL | (BG_CLEAR(surface[0]) ? col_tbl[colors[0]] : surface[0]);
9D0179A8  7C0EC420   SEB T8, T6
9D0179AC  07010005   BGEZ T8, 0x9D0179C4
9D0179B0  35D70040   ORI S7, T6, 64
9D0179B4  00A37821   ADDU T7, A1, V1
9D0179B8  91F90000   LBU T9, 0(T7)
9D0179BC  37220040   ORI V0, T9, 64
9D0179C0  305700FF   ANDI S7, V0, 255
9D0179C4  A2D70000   SB S7, 0(S6)
9D017F54  0B405E6A   J 0x9D0179A8
9D017F58  92CE0000   LBU T6, 0(S6)
676:                          if (colors[1])
9D0179C8  10C0000A   BEQ A2, ZERO, 0x9D0179F4
9D0179CC  00000000   NOP
677:                             surface[1] = SP_PIXEL | (BG_CLEAR(surface[1]) ? col_tbl[colors[1]] : surface[1]);
9D0179D0  92DF0001   LBU RA, 1(S6)
9D0179D4  7C1F8C20   SEB S1, RA
9D0179D8  06210005   BGEZ S1, 0x9D0179F0
9D0179DC  37EE0040   ORI T6, RA, 64
9D0179E0  00A66821   ADDU T5, A1, A2
9D0179E4  91A30000   LBU V1, 0(T5)
9D0179E8  34660040   ORI A2, V1, 64
9D0179EC  30CE00FF   ANDI T6, A2, 255
9D0179F0  A2CE0001   SB T6, 1(S6)
678:                          if (colors[2])
9D0179F4  10E0000A   BEQ A3, ZERO, 0x9D017A20
9D0179F8  00000000   NOP
679:                             surface[2] = SP_PIXEL | (BG_CLEAR(surface[2]) ? col_tbl[colors[2]] : surface[2]);
9D0179FC  92D80002   LBU T8, 2(S6)
9D017A00  7C187C20   SEB T7, T8
9D017A04  05E10005   BGEZ T7, 0x9D017A1C
9D017A08  37170040   ORI S7, T8, 64
9D017A0C  00A73821   ADDU A3, A1, A3
9D017A10  90F90000   LBU T9, 0(A3)
9D017A14  37220040   ORI V0, T9, 64
9D017A18  305700FF   ANDI S7, V0, 255
9D017A1C  A2D70002   SB S7, 2(S6)
680:                          if (colors[3])
9D017A20  1100000A   BEQ T0, ZERO, 0x9D017A4C
9D017A24  00000000   NOP
681:                             surface[3] = SP_PIXEL | (BG_CLEAR(surface[3]) ? col_tbl[colors[3]] : surface[3]);
9D017A28  92DF0003   LBU RA, 3(S6)
9D017A2C  7C1F8C20   SEB S1, RA
9D017A30  06210005   BGEZ S1, 0x9D017A48
9D017A34  37E60040   ORI A2, RA, 64
9D017A38  00A84021   ADDU T0, A1, T0
9D017A3C  910D0000   LBU T5, 0(T0)
9D017A40  35A30040   ORI V1, T5, 64
9D017A44  306600FF   ANDI A2, V1, 255
9D017A48  A2C60003   SB A2, 3(S6)
682:                          if (colors[4])
9D017A4C  1120000A   BEQ T1, ZERO, 0x9D017A78
9D017A50  00000000   NOP
683:                             surface[4] = SP_PIXEL | (BG_CLEAR(surface[4]) ? col_tbl[colors[4]] : surface[4]);
9D017A54  92CE0004   LBU T6, 4(S6)
9D017A58  7C0EC420   SEB T8, T6
9D017A5C  07010005   BGEZ T8, 0x9D017A74
9D017A60  35D90040   ORI T9, T6, 64
9D017A64  00A94821   ADDU T1, A1, T1
9D017A68  912F0000   LBU T7, 0(T1)
9D017A6C  35E70040   ORI A3, T7, 64
9D017A70  30F900FF   ANDI T9, A3, 255
9D017A74  A2D90004   SB T9, 4(S6)
684:                          if (colors[5])
9D017A78  1140000A   BEQ T2, ZERO, 0x9D017AA4
9D017A7C  00000000   NOP
685:                             surface[5] = SP_PIXEL | (BG_CLEAR(surface[5]) ? col_tbl[colors[5]] : surface[5]);
9D017A80  92C20005   LBU V0, 5(S6)
9D017A84  7C02BC20   SEB S7, V0
9D017A88  06E10005   BGEZ S7, 0x9D017AA0
9D017A8C  34480040   ORI T0, V0, 64
9D017A90  00AA5021   ADDU T2, A1, T2
9D017A94  915F0000   LBU RA, 0(T2)
9D017A98  37F10040   ORI S1, RA, 64
9D017A9C  322800FF   ANDI T0, S1, 255
9D017AA0  A2C80005   SB T0, 5(S6)
686:                          if (colors[6])
9D017AA4  1160000A   BEQ T3, ZERO, 0x9D017AD0
9D017AA8  00000000   NOP
687:                             surface[6] = SP_PIXEL | (BG_CLEAR(surface[6]) ? col_tbl[colors[6]] : surface[6]);
9D017AAC  92CD0006   LBU T5, 6(S6)
9D017AB0  7C0D1C20   SEB V1, T5
9D017AB4  04610005   BGEZ V1, 0x9D017ACC
9D017AB8  35B80040   ORI T8, T5, 64
9D017ABC  00AB5821   ADDU T3, A1, T3
9D017AC0  91660000   LBU A2, 0(T3)
9D017AC4  34CE0040   ORI T6, A2, 64
9D017AC8  31D800FF   ANDI T8, T6, 255
9D017ACC  A2D80006   SB T8, 6(S6)
688:                          if (colors[7])
9D017AD0  1180005B   BEQ T4, ZERO, 0x9D017C40
9D017AD4  00000000   NOP
689:                             surface[7] = SP_PIXEL | (BG_CLEAR(surface[7]) ? col_tbl[colors[7]] : surface[7]);
9D017AD8  92C90007   LBU T1, 7(S6)
9D017ADC  7C097C20   SEB T7, T1
9D017AE0  05E10005   BGEZ T7, 0x9D017AF8
9D017AE4  35390040   ORI T9, T1, 64
9D017AE8  00AC2821   ADDU A1, A1, T4
9D017AEC  90AC0000   LBU T4, 0(A1)
9D017AF0  35870040   ORI A3, T4, 64
9D017AF4  30F900FF   ANDI T9, A3, 255
9D017AF8  0B405F10   J 0x9D017C40
9D017AFC  A2D90007   SB T9, 7(S6)
690:                       }
691:                       else
692:                       {
693:                          if (colors[0] && SP_CLEAR(surface[0]))
9D017B00  10600009   BEQ V1, ZERO, 0x9D017B28
9D017B04  00000000   NOP
9D017B08  92C20000   LBU V0, 0(S6)
9D017B0C  30570040   ANDI S7, V0, 64
9D017B10  32FF00FF   ANDI RA, S7, 255
9D017B14  17E00004   BNE RA, ZERO, 0x9D017B28
9D017B18  00A38821   ADDU S1, A1, V1
694:                             surface[0] = SP_PIXEL | col_tbl[colors[0]];
9D017B1C  922D0000   LBU T5, 0(S1)
9D017B20  35A30040   ORI V1, T5, 64
9D017B24  A2C30000   SB V1, 0(S6)
695:                          if (colors[1] && SP_CLEAR(surface[1]))
9D017B28  10C00009   BEQ A2, ZERO, 0x9D017B50
9D017B2C  00000000   NOP
9D017B30  92CE0001   LBU T6, 1(S6)
9D017B34  31D80040   ANDI T8, T6, 64
9D017B38  330F00FF   ANDI T7, T8, 255
9D017B3C  15E00004   BNE T7, ZERO, 0x9D017B50
9D017B40  00A63021   ADDU A2, A1, A2
696:                             surface[1] = SP_PIXEL | col_tbl[colors[1]];
9D017B44  90D90000   LBU T9, 0(A2)
9D017B48  37220040   ORI V0, T9, 64
9D017B4C  A2C20001   SB V0, 1(S6)
697:                          if (colors[2] && SP_CLEAR(surface[2]))
9D017B50  10E00009   BEQ A3, ZERO, 0x9D017B78
9D017B54  00000000   NOP
9D017B58  92D70002   LBU S7, 2(S6)
9D017B5C  32FF0040   ANDI RA, S7, 64
9D017B60  33F100FF   ANDI S1, RA, 255
9D017B64  16200004   BNE S1, ZERO, 0x9D017B78
9D017B68  00A73821   ADDU A3, A1, A3
698:                             surface[2] = SP_PIXEL | col_tbl[colors[2]];
9D017B6C  90ED0000   LBU T5, 0(A3)
9D017B70  35A30040   ORI V1, T5, 64
9D017B74  A2C30002   SB V1, 2(S6)
699:                          if (colors[3] && SP_CLEAR(surface[3]))
9D017B78  11000009   BEQ T0, ZERO, 0x9D017BA0
9D017B7C  00000000   NOP
9D017B80  92CE0003   LBU T6, 3(S6)
9D017B84  31D80040   ANDI T8, T6, 64
9D017B88  330F00FF   ANDI T7, T8, 255
9D017B8C  15E00004   BNE T7, ZERO, 0x9D017BA0
9D017B90  00A84021   ADDU T0, A1, T0
700:                             surface[3] = SP_PIXEL | col_tbl[colors[3]];
9D017B94  91060000   LBU A2, 0(T0)
9D017B98  34D90040   ORI T9, A2, 64
9D017B9C  A2D90003   SB T9, 3(S6)
701:                          if (colors[4] && SP_CLEAR(surface[4]))
9D017BA0  11200009   BEQ T1, ZERO, 0x9D017BC8
9D017BA4  00000000   NOP
9D017BA8  92C20004   LBU V0, 4(S6)
9D017BAC  30570040   ANDI S7, V0, 64
9D017BB0  32FF00FF   ANDI RA, S7, 255
9D017BB4  17E00004   BNE RA, ZERO, 0x9D017BC8
9D017BB8  00A94821   ADDU T1, A1, T1
702:                             surface[4] = SP_PIXEL | col_tbl[colors[4]];
9D017BBC  91310000   LBU S1, 0(T1)
9D017BC0  36270040   ORI A3, S1, 64
9D017BC4  A2C70004   SB A3, 4(S6)
703:                          if (colors[5] && SP_CLEAR(surface[5]))
9D017BC8  11400009   BEQ T2, ZERO, 0x9D017BF0
9D017BCC  00000000   NOP
9D017BD0  92CD0005   LBU T5, 5(S6)
9D017BD4  31A30040   ANDI V1, T5, 64
9D017BD8  306E00FF   ANDI T6, V1, 255
9D017BDC  15C00004   BNE T6, ZERO, 0x9D017BF0
9D017BE0  00AA5021   ADDU T2, A1, T2
704:                             surface[5] = SP_PIXEL | col_tbl[colors[5]];
9D017BE4  91580000   LBU T8, 0(T2)
9D017BE8  370F0040   ORI T7, T8, 64
9D017BEC  A2CF0005   SB T7, 5(S6)
705:                          if (colors[6] && SP_CLEAR(surface[6]))
9D017BF0  11600009   BEQ T3, ZERO, 0x9D017C18
9D017BF4  00000000   NOP
9D017BF8  92C80006   LBU T0, 6(S6)
9D017BFC  31060040   ANDI A2, T0, 64
9D017C00  30D900FF   ANDI T9, A2, 255
9D017C04  17200004   BNE T9, ZERO, 0x9D017C18
9D017C08  00AB5821   ADDU T3, A1, T3
706:                             surface[6] = SP_PIXEL | col_tbl[colors[6]];
9D017C0C  91620000   LBU V0, 0(T3)
9D017C10  34570040   ORI S7, V0, 64
9D017C14  A2D70006   SB S7, 6(S6)
707:                          if (colors[7] && SP_CLEAR(surface[7]))
9D017C18  11800009   BEQ T4, ZERO, 0x9D017C40
9D017C1C  00000000   NOP
9D017C20  92DF0007   LBU RA, 7(S6)
9D017C24  33E90040   ANDI T1, RA, 64
9D017C28  313100FF   ANDI S1, T1, 255
9D017C2C  16200004   BNE S1, ZERO, 0x9D017C40
9D017C30  00AC2821   ADDU A1, A1, T4
708:                             surface[7] = SP_PIXEL | col_tbl[colors[7]];
9D017C34  90AC0000   LBU T4, 0(A1)
9D017C38  35870040   ORI A3, T4, 64
9D017C3C  A2C70007   SB A3, 7(S6)
709:                       }
710:                    }
711:                 
712:                    return strike_pixel;
713:                 }
714:                 
715:                 static void ppu_renderbg(uint8 *vidbuf)
716:                 {
717:                    uint8 *bmp_ptr, *data_ptr, *tile_ptr, *attrib_ptr;
718:                    uint32 refresh_vaddr, bg_offset, attrib_base;
719:                    int tile_count;
720:                    uint8 tile_index, x_tile, y_tile;
721:                    uint8 col_high, attrib, attrib_shift;
722:                 
723:                    /* draw a line of transparent background color if bg is disabled */
724:                    if (false == ppu.bg_on)
9D0173C8  1700000A   BNE T8, ZERO, 0x9D0173F4
9D0173CC  3C0EA001   LUI T6, -24575
725:                    {
726:                       memset(vidbuf, FULLBG, NES_SCREEN_WIDTH);
9D0173D0  3C0FA001   LUI T7, -24575
9D0173D4  91EC1358   LBU T4, 4952(T7)
9D0173D8  3191007F   ANDI S1, T4, 127
9D0173DC  8FA40028   LW A0, 40(SP)
9D0173E0  36250080   ORI A1, S1, 128
9D0173E4  0F4100B4   JAL .Letext0, .LFE0, memset
9D0173E8  24060100   ADDIU A2, ZERO, 256
9D017F40  0B405CF5   J 0x9D0173D4
9D017F44  3C0FA001   LUI T7, -24575
727:                       return;
728:                    }
729:                 
730:                    bmp_ptr = vidbuf - ppu.tile_xofs; /* scroll x */
9D0173F4  25CF0258   ADDIU T7, T6, 600
9D0173F8  8DF0116C   LW S0, 4460(T7)
9D0173FC  8FB10028   LW S1, 40(SP)
9D017400  02308023   SUBU S0, S1, S0
731:                    refresh_vaddr = 0x2000 + (ppu.vaddr & 0x0FE0); /* mask out x tile */
9D017404  8DF21164   LW S2, 4452(T7)
9D017408  32530FE0   ANDI S3, S2, 4064
9D01740C  26752000   ADDIU S5, S3, 8192
9D017410  AFB50020   SW S5, 32(SP)
732:                    x_tile = ppu.vaddr & 0x1F;
9D017414  325600FF   ANDI S6, S2, 255
9D017418  32D1001F   ANDI S1, S6, 31
733:                    y_tile = (ppu.vaddr >> 5) & 0x1F; /* to simplify calculations */
9D01741C  7E573940   EXT S7, S2, 5, 8
734:                    bg_offset = ((ppu.vaddr >> 12) & 7) + ppu.bg_base; /* offset in y tile */
9D017420  7E581300   EXT T8, S2, 12, 3
9D017424  8DF91184   LW T9, 4484(T7)
9D017428  0319F021   ADDU FP, T8, T9
9D01742C  AFBE0010   SW FP, 16(SP)
735:                 
736:                    /* calculate initial values */
737:                    tile_ptr = &PPU_MEM(refresh_vaddr + x_tile); /* pointer to tile index */
9D017430  8FBF0020   LW RA, 32(SP)
9D017434  023F1021   ADDU V0, S1, RA
9D017438  00021A82   SRL V1, V0, 10
9D01743C  24640448   ADDIU A0, V1, 1096
9D017440  00042880   SLL A1, A0, 2
9D017444  00AF3021   ADDU A2, A1, T7
9D017448  8CC70000   LW A3, 0(A2)
9D01744C  00E21021   ADDU V0, A3, V0
738:                    attrib_base = (refresh_vaddr & 0x2C00) + 0x3C0 + ((y_tile & 0x1C) << 1);
9D017450  33E82C00   ANDI T0, RA, 11264
9D017454  250903C0   ADDIU T1, T0, 960
9D017458  32EA001C   ANDI T2, S7, 28
9D01745C  000A5840   SLL T3, T2, 1
9D017460  012B6021   ADDU T4, T1, T3
9D017464  AFAC0024   SW T4, 36(SP)
739:                    attrib_ptr = &PPU_MEM(attrib_base + (x_tile >> 2));
9D017468  00116882   SRL T5, S1, 2
9D01746C  8FAE0024   LW T6, 36(SP)
9D017470  01CD9021   ADDU S2, T6, T5
9D017474  00129A82   SRL S3, S2, 10
9D017478  26750448   ADDIU S5, S3, 1096
9D01747C  0015C080   SLL T8, S5, 2
9D017480  030F7821   ADDU T7, T8, T7
9D017484  8DF90000   LW T9, 0(T7)
9D017488  0332F021   ADDU FP, T9, S2
740:                    attrib = *attrib_ptr++;
9D01748C  27DF0001   ADDIU RA, FP, 1
9D017490  AFBF0018   SW RA, 24(SP)
9D017494  93C30000   LBU V1, 0(FP)
9D017498  AFA3001C   SW V1, 28(SP)
741:                    attrib_shift = (x_tile & 2) + ((y_tile & 2) << 1);
9D01749C  32F70002   ANDI S7, S7, 2
9D0174A0  00172840   SLL A1, S7, 1
9D0174A4  32D60002   ANDI S6, S6, 2
9D0174A8  00B6B821   ADDU S7, A1, S6
742:                    col_high = ((attrib >> attrib_shift) & 3) << 2;
9D0174AC  02E32007   SRAV A0, V1, S7
9D0174B0  30860003   ANDI A2, A0, 3
9D0174B4  0006F080   SLL FP, A2, 2
9D0174B8  26070108   ADDIU A3, S0, 264
9D0174BC  AFA70014   SW A3, 20(SP)
743:                 
744:                    /* ppu fetches 33 tiles */
745:                    tile_count = 33;
746:                    while (tile_count--)
9D017668  8FA60014   LW A2, 20(SP)
9D01766C  1606FF97   BNE S0, A2, 0x9D0174CC
9D017670  02A01021   ADDU V0, S5, ZERO
747:                    {
748:                       /* Tile number from nametable */
749:                       tile_index = *tile_ptr++;
9D0174CC  24550001   ADDIU S5, V0, 1
9D0174D0  90450000   LBU A1, 0(V0)
750:                       data_ptr = &PPU_MEM(bg_offset + (tile_index << 4));
9D0174C0  3C08A001   LUI T0, -24575
9D0174C4  25120258   ADDIU S2, T0, 600
9D0174D4  00054900   SLL T1, A1, 4
9D0174D8  8FA20010   LW V0, 16(SP)
9D0174DC  01225021   ADDU T2, T1, V0
9D0174E0  000A5A82   SRL T3, T2, 10
9D0174E4  256C0448   ADDIU T4, T3, 1096
9D0174E8  000C6880   SLL T5, T4, 2
9D0174EC  01B27021   ADDU T6, T5, S2
9D0174F0  8DD30000   LW S3, 0(T6)
751:                 
752:                       /* Handle $FD/$FE tile VROM switching (PunchOut) */
753:                       if (ppu.latchfunc)
9D0174F4  8E5811A4   LW T8, 4516(S2)
9D0174F8  13000003   BEQ T8, ZERO, 0x9D017508
9D0174FC  026A9821   ADDU S3, S3, T2
754:                          ppu.latchfunc(ppu.bg_base, tile_index);
9D017500  0300F809   JALR T8
9D017504  8E441184   LW A0, 4484(S2)
755:                 
756:                       draw_bgtile(bmp_ptr, data_ptr[0], data_ptr[8], ppu.palette + col_high);
9D017508  926F0000   LBU T7, 0(S3)
9D01750C  92790008   LBU T9, 8(S3)
9D017510  27DF1100   ADDIU RA, FP, 4352
9D017514  025F3821   ADDU A3, S2, RA
757:                       bmp_ptr += 8;
758:                 
759:                       x_tile++;
9D0175C0  26310001   ADDIU S1, S1, 1
9D0175C4  323100FF   ANDI S1, S1, 255
760:                 
761:                       if (0 == (x_tile & 1))     /* check every 2 tiles */
9D0175C8  323F0001   ANDI RA, S1, 1
9D0175CC  17E00026   BNE RA, ZERO, 0x9D017668
9D0175D0  26100008   ADDIU S0, S0, 8
762:                       {
763:                          if (0 == (x_tile & 3))  /* check every 4 tiles */
9D0175D4  323E0003   ANDI FP, S1, 3
9D0175D8  57C0001F   BNEL FP, ZERO, 0x9D017658
9D0175DC  3AF70002   XORI S7, S7, 2
764:                          {
765:                             if (32 == x_tile)    /* check every 32 tiles */
9D0175E0  24030020   ADDIU V1, ZERO, 32
9D0175E4  16230016   BNE S1, V1, 0x9D017640
9D0175E8  8FA70018   LW A3, 24(SP)
766:                             {
767:                                x_tile = 0;
9D017638  00008821   ADDU S1, ZERO, ZERO
768:                                refresh_vaddr ^= (1 << 10); /* switch nametable */
9D0175EC  8FB50020   LW S5, 32(SP)
9D0175F0  3AA40400   XORI A0, S5, 1024
9D0175F4  AFA40020   SW A0, 32(SP)
769:                                attrib_base ^= (1 << 10);
9D0175F8  8FA50024   LW A1, 36(SP)
9D0175FC  38A60400   XORI A2, A1, 1024
9D017600  AFA60024   SW A2, 36(SP)
770:                 
771:                                /* recalculate pointers */
772:                                tile_ptr = &PPU_MEM(refresh_vaddr);
9D017604  00044282   SRL T0, A0, 10
9D017608  25090448   ADDIU T1, T0, 1096
9D01760C  00091080   SLL V0, T1, 2
9D017610  00525021   ADDU T2, V0, S2
9D017614  8D4B0000   LW T3, 0(T2)
9D017618  0164A821   ADDU S5, T3, A0
773:                                attrib_ptr = &PPU_MEM(attrib_base);
9D01761C  00066A82   SRL T5, A2, 10
9D017620  25AE0448   ADDIU T6, T5, 1096
9D017624  000E9880   SLL S3, T6, 2
9D017628  0272C021   ADDU T8, S3, S2
9D01762C  8F0F0000   LW T7, 0(T8)
9D017630  01E66021   ADDU T4, T7, A2
9D017634  AFAC0018   SW T4, 24(SP)
774:                             }
775:                 
776:                             /* Get the attribute byte */
777:                             attrib = *attrib_ptr++;
9D01763C  8FA70018   LW A3, 24(SP)
9D017640  90F90000   LBU T9, 0(A3)
9D017644  AFB9001C   SW T9, 28(SP)
9D017648  8FBF0018   LW RA, 24(SP)
9D01764C  27FE0001   ADDIU FP, RA, 1
9D017650  AFBE0018   SW FP, 24(SP)
778:                          }
779:                 
780:                          attrib_shift ^= 2;
9D017654  3AF70002   XORI S7, S7, 2
781:                          col_high = ((attrib >> attrib_shift) & 3) << 2;
9D017658  8FA3001C   LW V1, 28(SP)
9D01765C  02E32007   SRAV A0, V1, S7
9D017660  30850003   ANDI A1, A0, 3
9D017664  0005F080   SLL FP, A1, 2
782:                       }
783:                    }
784:                 
785:                    /* Blank left hand column if need be */
786:                    if (ppu.bg_mask)
9D017674  3C12A001   LUI S2, -24575
9D017678  8E5613EC   LW S6, 5100(S2)
9D01767C  12C0000D   BEQ S6, ZERO, .LBE51
9D017680  3C10A001   LUI S0, -24575
787:                    {
788:                       uint32 *buf_ptr = (uint32 *) vidbuf;
789:                       uint32 bg_clear = FULLBG | FULLBG << 8 | FULLBG << 16 | FULLBG << 24;
9D017684  92081358   LBU T0, 4952(S0)
9D017688  3109007F   ANDI T1, T0, 127
9D01768C  35220080   ORI V0, T1, 128
9D017690  00025200   SLL T2, V0, 8
9D017694  00025C00   SLL T3, V0, 16
9D017698  014BA825   OR S5, T2, T3
9D01769C  02A26825   OR T5, S5, V0
9D0176A0  00027600   SLL T6, V0, 24
9D0176A4  01AE9825   OR S3, T5, T6
790:                 
791:                       ((uint32 *) buf_ptr)[0] = bg_clear;
9D0176A8  8FB80028   LW T8, 40(SP)
9D0176AC  AF130000   SW S3, 0(T8)
792:                       ((uint32 *) buf_ptr)[1] = bg_clear;
9D0176B0  AF130004   SW S3, 4(T8)
793:                    }
794:                 }
795:                 
796:                 /* OAM entry */
797:                 typedef struct obj_s
798:                 {
799:                    uint8 y_loc;
800:                    uint8 tile;
801:                    uint8 atr;
802:                    uint8 x_loc;
803:                 } obj_t;
804:                 
805:                 /* TODO: fetch valid OAM a scanline before, like the Real Thing */
806:                 static void ppu_renderoam(uint8 *vidbuf, int scanline)
807:                 {
808:                    uint8 *buf_ptr;
809:                    uint32 vram_offset, savecol[2];
810:                    int sprite_num, spritecount;
811:                    obj_t *sprite_ptr;
812:                    uint8 sprite_height;
813:                 
814:                    if (false == ppu.obj_on)
9D0176D4  3C04A001   LUI A0, -24575
9D0176D8  8C9113E4   LW S1, 5092(A0)
9D0176DC  12200220   BEQ S1, ZERO, 0x9D017F60
9D0176E0  8FBF005C   LW RA, 92(SP)
815:                       return;
816:                 
817:                    /* Get our buffer pointer */
818:                    buf_ptr = vidbuf;
819:                 
820:                    /* Save left hand column? */
821:                    if (ppu.obj_mask)
9D0176E4  3C07A001   LUI A3, -24575
9D0176E8  8CF913E8   LW T9, 5096(A3)
9D0176EC  13200007   BEQ T9, ZERO, 0x9D01770C
9D0176F0  3C1EA001   LUI FP, -24575
822:                    {
823:                       savecol[0] = ((uint32 *) buf_ptr)[0];
9D0176F4  8FBF0028   LW RA, 40(SP)
9D0176F8  8FF70000   LW S7, 0(RA)
9D0176FC  AFB7002C   SW S7, 44(SP)
824:                       savecol[1] = ((uint32 *) buf_ptr)[1];
9D017700  8FA30028   LW V1, 40(SP)
9D017704  8C650004   LW A1, 4(V1)
9D017708  AFA50030   SW A1, 48(SP)
825:                    }
826:                 
827:                    sprite_height = ppu.obj_height;
9D01770C  27C60258   ADDIU A2, FP, 600
9D017710  90C8117C   LBU T0, 4476(A2)
828:                    vram_offset = ppu.obj_base;
9D017714  8CD21180   LW S2, 4480(A2)
9D017718  AFB20018   SW S2, 24(SP)
829:                    spritecount = 0;
9D01771C  AFA00010   SW ZERO, 16(SP)
830:                 
831:                    sprite_ptr = (obj_t *) ppu.oam;
9D017724  3C10A001   LUI S0, -24575
9D017728  26101258   ADDIU S0, S0, 4696
832:                 
833:                    for (sprite_num = 0; sprite_num < 64; sprite_num++, sprite_ptr++)
9D017720  00009021   ADDU S2, ZERO, ZERO
9D017734  3C0AA001   LUI T2, -24575
9D017738  25531358   ADDIU S3, T2, 4952
9D017C7C  26100004   ADDIU S0, S0, 4
9D017C80  1613FEAE   BNE S0, S3, 0x9D01773C
9D017C84  26520001   ADDIU S2, S2, 1
834:                    {
835:                       uint8 *data_ptr, *bmp_ptr;
836:                       uint32 vram_adr;
837:                       int y_offset;
838:                       uint8 tile_index, attrib, col_high;
839:                       uint8 sprite_y, sprite_x;
840:                       bool check_strike;
841:                       int strike_pixel;
842:                 
843:                       sprite_y = sprite_ptr->y_loc + 1;
9D01773C  920B0000   LBU T3, 0(S0)
9D017740  256C0001   ADDIU T4, T3, 1
844:                 
845:                       /* Check to see if sprite is out of range */
846:                       if ((sprite_y > scanline) || (sprite_y <= (scanline - sprite_height))
9D01772C  0288A823   SUBU S5, S4, T0
9D017744  319100FF   ANDI S1, T4, 255
9D017748  0291682A   SLT T5, S4, S1
9D01774C  55A0014C   BNEL T5, ZERO, 0x9D017C80
9D017750  26100004   ADDIU S0, S0, 4
9D017754  02B1702A   SLT T6, S5, S1
9D017758  51C00149   BEQL T6, ZERO, 0x9D017C80
9D01775C  26100004   ADDIU S0, S0, 4
847:                           || (0 == sprite_y) || (sprite_y >= 240))
9D017760  25690011   ADDIU T1, T3, 17
9D017764  313800FF   ANDI T8, T1, 255
9D017768  2F0F0011   SLTIU T7, T8, 17
9D01776C  55E00144   BNEL T7, ZERO, 0x9D017C80
9D017770  26100004   ADDIU S0, S0, 4
848:                          continue;
849:                 
850:                       sprite_x = sprite_ptr->x_loc;
851:                       tile_index = sprite_ptr->tile;
9D017774  92070001   LBU A3, 1(S0)
9D017778  AFA70014   SW A3, 20(SP)
852:                       attrib = sprite_ptr->atr;
9D01777C  92170002   LBU S7, 2(S0)
853:                 
854:                       bmp_ptr = buf_ptr + sprite_x;
9D017780  92020003   LBU V0, 3(S0)
9D017784  8FB60028   LW S6, 40(SP)
855:                 
856:                       /* Handle $FD/$FE tile VROM switching (PunchOut) */
857:                       if (ppu.latchfunc)
9D017730  3C1EA001   LUI FP, -24575
9D017788  27C40258   ADDIU A0, FP, 600
9D01778C  8C9911A4   LW T9, 4516(A0)
9D017790  13200004   BEQ T9, ZERO, .LVL308
9D017794  02C2B021   ADDU S6, S6, V0
858:                          ppu.latchfunc(vram_offset, tile_index);
9D017798  8FA40018   LW A0, 24(SP)
9D01779C  0320F809   JALR T9
9D0177A0  00E02821   ADDU A1, A3, ZERO
859:                 
860:                       /* Get upper two bits of color */
861:                       col_high = ((attrib & 3) << 2);
9D0177A4  32FF0003   ANDI RA, S7, 3
862:                 
863:                       /* 8x16 even sprites use $0000, odd use $1000 */
864:                       if (16 == ppu.obj_height)
9D0177A8  27C30258   ADDIU V1, FP, 600
9D0177AC  9068117C   LBU T0, 4476(V1)
9D0177B0  24060010   ADDIU A2, ZERO, 16
9D0177B4  15060008   BNE T0, A2, 0x9D0177D8
9D0177B8  001F2880   SLL A1, RA, 2
865:                          vram_adr = ((tile_index & 1) << 12) | ((tile_index & 0xFE) << 4);
9D0177BC  8FAE0014   LW T6, 20(SP)
9D0177C0  31C900FE   ANDI T1, T6, 254
9D0177C4  0009C100   SLL T8, T1, 4
9D0177C8  31CF0001   ANDI T7, T6, 1
9D0177CC  000F3B00   SLL A3, T7, 12
9D0177D0  0B405DFA   J 0x9D0177E8
9D0177D4  03076825   OR T5, T8, A3
866:                       else
867:                          vram_adr = vram_offset + (tile_index << 4);
9D0177D8  8FAA0014   LW T2, 20(SP)
9D0177DC  000A5900   SLL T3, T2, 4
9D0177E0  8FAC0018   LW T4, 24(SP)
9D0177E4  016C6821   ADDU T5, T3, T4
868:                 
869:                       /* Get the address of the tile */
870:                       data_ptr = &PPU_MEM(vram_adr);
9D0177E8  000D1282   SRL V0, T5, 10
9D0177EC  24440448   ADDIU A0, V0, 1096
9D0177F0  0004C880   SLL T9, A0, 2
9D0177F4  27DF0258   ADDIU RA, FP, 600
9D0177F8  033F1821   ADDU V1, T9, RA
9D0177FC  8C660000   LW A2, 0(V1)
9D017800  00CD5021   ADDU T2, A2, T5
871:                 
872:                       /* Calculate offset (line within the sprite) */
873:                       y_offset = scanline - sprite_y;
9D017804  02918823   SUBU S1, S4, S1
874:                       if (y_offset > 7)
9D017808  2A2B0008   SLTI T3, S1, 8
875:                          y_offset += 8;
9D01780C  262C0008   ADDIU T4, S1, 8
9D017810  018B880A   MOVZ S1, T4, T3
876:                 
877:                       /* Account for vertical flippage */
878:                       if (attrib & OAMF_VFLIP)
9D017814  7C176C20   SEB T5, S7
9D017818  05A10006   BGEZ T5, 0x9D017834
9D01781C  01517821   ADDU T7, T2, S1
879:                       {
880:                          if (16 == ppu.obj_height)
881:                             y_offset -= 23;
9D017820  262EFFE9   ADDIU T6, S1, -23
9D017824  2629FFF9   ADDIU T1, S1, -7
9D017828  39080010   XORI T0, T0, 16
9D01782C  0128700B   MOVN T6, T1, T0
882:                          else
883:                             y_offset -= 7;
884:                 
885:                          data_ptr -= y_offset;
9D017830  014E7823   SUBU T7, T2, T6
886:                       }
887:                       else
888:                       {
889:                          data_ptr += y_offset;
890:                       }
891:                 
892:                       /* if we're on sprite 0 and sprite 0 strike flag isn't set,
893:                       ** check for a strike 
894:                       */
895:                       check_strike = (0 == sprite_num) && (false == ppu.strikeflag);
9D017834  16400004   BNE S2, ZERO, 0x9D017848
9D017838  0000C821   ADDU T9, ZERO, ZERO
9D01783C  27C70258   ADDIU A3, FP, 600
9D017840  8CE2119C   LW V0, 4508(A3)
9D017844  2C590001   SLTIU T9, V0, 1
896:                       strike_pixel = draw_oamtile(bmp_ptr, attrib, data_ptr[0], data_ptr[8], ppu.palette + 16 + col_high, check_strike);
9D017848  91E40000   LBU A0, 0(T7)
9D01784C  91FF0008   LBU RA, 8(T7)
9D017850  24A31110   ADDIU V1, A1, 4368
9D017854  27C50258   ADDIU A1, FP, 600
897:                       if (strike_pixel >= 0)
9D017C40  04820004   BLTZL A0, 0x9D017C54
9D017C44  8FA40010   LW A0, 16(SP)
898:                          ppu_setstrike(strike_pixel);
9D017C48  0F405762   JAL .LFB19, ppu_setstrike, .Ltext0, .Letext0, .LFE15
9D017C4C  00000000   NOP
899:                 
900:                       /* maximum of 8 sprites per scanline */
901:                       if (++spritecount == PPU_MAXSPRITE)
9D017C50  8FA40010   LW A0, 16(SP)
9D017C54  24960001   ADDIU S6, A0, 1
9D017C58  240D0008   ADDIU T5, ZERO, 8
9D017C5C  16CD0007   BNE S6, T5, 0x9D017C7C
9D017C60  AFB60010   SW S6, 16(SP)
902:                       {
903:                          ppu.stat |= PPU_STATF_MAXSPRITE;
9D017C64  3C12A001   LUI S2, -24575
9D017C68  26500258   ADDIU S0, S2, 600
9D017C6C  92131162   LBU S3, 4450(S0)
9D017C70  36740020   ORI S4, S3, 32
9D017C74  0B405F22   J 0x9D017C88
9D017C78  A2141162   SB S4, 4450(S0)
904:                          break;
905:                       }
906:                    }
907:                 
908:                    /* Restore lefthand column */
909:                    if (ppu.obj_mask)
9D017C88  3C15A001   LUI S5, -24575
9D017C8C  8EBE13E8   LW FP, 5096(S5)
9D017C90  13C000B2   BEQ FP, ZERO, 0x9D017F5C
9D017C94  8FA3002C   LW V1, 44(SP)
910:                    {
911:                       ((uint32 *) buf_ptr)[0] = savecol[0];
9D017C98  8FAE0028   LW T6, 40(SP)
9D017C9C  ADC30000   SW V1, 0(T6)
912:                       ((uint32 *) buf_ptr)[1] = savecol[1];
9D017CA0  8FAA0030   LW T2, 48(SP)
9D017CA4  0B405FD7   J 0x9D017F5C
9D017CA8  ADCA0004   SW T2, 4(T6)
913:                    }
914:                 }
915:                 
916:                 /* Fake rendering a line */
917:                 /* This is needed for sprite 0 hits when we're skipping drawing a frame */
918:                 static void ppu_fakeoam(int scanline)
919:                 {
920:                    uint8 *data_ptr;
921:                    obj_t *sprite_ptr;
922:                    uint32 vram_adr, color;
923:                    int y_offset;
924:                    uint8 pat1, pat2;
925:                    uint8 tile_index, attrib;
926:                    uint8 sprite_height, sprite_y, sprite_x;
927:                 
928:                    /* we don't need to be here if strike flag is set */
929:                 
930:                    if (false == ppu.obj_on || ppu.strikeflag)
9D017CAC  8C6413E4   LW A0, 5092(V1)
9D017CB0  108000AA   BEQ A0, ZERO, 0x9D017F5C
9D017CB4  3C05A001   LUI A1, -24575
9D017CB8  8CBE13F4   LW FP, 5108(A1)
9D017CBC  17C000A7   BNE FP, ZERO, 0x9D017F5C
9D017CC0  3C06A001   LUI A2, -24575
931:                       return;
932:                 
933:                    sprite_height = ppu.obj_height;
9D017CC4  24D20258   ADDIU S2, A2, 600
934:                    sprite_ptr = (obj_t *) ppu.oam;
935:                    sprite_y = sprite_ptr->y_loc + 1;
9D017CC8  92501000   LBU S0, 4096(S2)
9D017CCC  26080001   ADDIU T0, S0, 1
936:                 
937:                    /* Check to see if sprite is out of range */
938:                    if ((sprite_y > scanline) || (sprite_y <= (scanline - sprite_height)) 
9D017CD0  310900FF   ANDI T1, T0, 255
9D017CD4  0289502A   SLT T2, S4, T1
9D017CD8  154000A0   BNE T2, ZERO, 0x9D017F5C
9D017CDC  9256117C   LBU S6, 4476(S2)
9D017CE0  02965823   SUBU T3, S4, S6
9D017CE4  0169A82A   SLT S5, T3, T1
9D017CE8  12A0009C   BEQ S5, ZERO, 0x9D017F5C
9D017CEC  260D0010   ADDIU T5, S0, 16
939:                        || (0 == sprite_y) || (sprite_y > 240))
9D017CF0  31AE00FF   ANDI T6, T5, 255
9D017CF4  2DD30010   SLTIU S3, T6, 16
9D017CF8  16600098   BNE S3, ZERO, 0x9D017F5C
9D017CFC  3C18A001   LUI T8, -24575
940:                       return;
941:                 
942:                    sprite_x = sprite_ptr->x_loc;
9D017D00  27020258   ADDIU V0, T8, 600
9D017D04  90441003   LBU A0, 4099(V0)
943:                    tile_index = sprite_ptr->tile;
9D017D08  904F1001   LBU T7, 4097(V0)
944:                    attrib = sprite_ptr->atr;
945:                 
946:                    /* 8x16 even sprites use $0000, odd use $1000 */
947:                    if (16 == ppu.obj_height)
9D017D0C  24110010   ADDIU S1, ZERO, 16
9D017D10  16D10007   BNE S6, S1, 0x9D017D30
9D017D14  904C1002   LBU T4, 4098(V0)
948:                       vram_adr = ((tile_index & 1) << 12) | ((tile_index & 0xFE) << 4);
9D017D18  31E300FE   ANDI V1, T7, 254
9D017D1C  00032900   SLL A1, V1, 4
9D017D20  31FE0001   ANDI FP, T7, 1
9D017D24  001E3300   SLL A2, FP, 12
9D017D28  0B405F50   J 0x9D017D40
9D017D2C  00A6B825   OR S7, A1, A2
949:                    else
950:                       vram_adr = ppu.obj_base + (tile_index << 4);
9D017D30  000F3900   SLL A3, T7, 4
9D017D34  3C19A001   LUI T9, -24575
9D017D38  8F3F13D8   LW RA, 5080(T9)
9D017D3C  00FFB821   ADDU S7, A3, RA
951:                 
952:                    data_ptr = &PPU_MEM(vram_adr);
9D017D40  00179282   SRL S2, S7, 10
9D017D44  26500448   ADDIU S0, S2, 1096
9D017D48  00104080   SLL T0, S0, 2
9D017D4C  3C0AA001   LUI T2, -24575
9D017D50  254B0258   ADDIU T3, T2, 600
9D017D54  010BA821   ADDU S5, T0, T3
9D017D58  8EAD0000   LW T5, 0(S5)
9D017D5C  01B77021   ADDU T6, T5, S7
953:                 
954:                    /* Calculate offset (line within the sprite) */
955:                    y_offset = scanline - sprite_y;
9D017D60  0289A023   SUBU S4, S4, T1
956:                    if (y_offset > 7)
9D017D64  2A890008   SLTI T1, S4, 8
957:                       y_offset += 8;
9D017D68  26930008   ADDIU S3, S4, 8
9D017D6C  0269A00A   MOVZ S4, S3, T1
958:                 
959:                    /* Account for vertical flippage */
960:                    if (attrib & OAMF_VFLIP)
9D017D70  7C0CC420   SEB T8, T4
9D017D74  07010006   BGEZ T8, 0x9D017D90
9D017D78  01D43821   ADDU A3, T6, S4
961:                    {
962:                       if (16 == ppu.obj_height)
963:                          y_offset -= 23;
9D017D7C  268FFFE9   ADDIU T7, S4, -23
9D017D80  2682FFF9   ADDIU V0, S4, -7
9D017D84  3AD60010   XORI S6, S6, 16
9D017D88  0056780B   MOVN T7, V0, S6
964:                       else
965:                          y_offset -= 7;
966:                       data_ptr -= y_offset;
9D017D8C  01CF3823   SUBU A3, T6, T7
967:                    }
968:                    else
969:                    {
970:                       data_ptr += y_offset;
971:                    }
972:                 
973:                    /* check for a solid sprite 0 pixel */
974:                    pat1 = data_ptr[0];
9D017D90  90F90000   LBU T9, 0(A3)
975:                    pat2 = data_ptr[8];
9D017D94  90FF0008   LBU RA, 8(A3)
976:                    color = ((pat2 & 0xAA) << 8) | ((pat2 & 0x55) << 1)
9D017D98  2417FFAA   ADDIU S7, ZERO, -86
9D017D9C  03F71824   AND V1, RA, S7
9D017DA0  00032A00   SLL A1, V1, 8
9D017DA4  33FE0055   ANDI FP, RA, 85
9D017DA8  001E3040   SLL A2, FP, 1
9D017DAC  00A69025   OR S2, A1, A2
977:                                   | ((pat1 & 0xAA) << 7) | (pat1 & 0x55);
9D017DB0  33300055   ANDI S0, T9, 85
9D017DB4  02504025   OR T0, S2, S0
9D017DB8  03375024   AND T2, T9, S7
9D017DBC  000A59C0   SLL T3, T2, 7
9D017DC0  010BA825   OR S5, T0, T3
978:                 
979:                    if (color)
9D017DC4  12A00065   BEQ S5, ZERO, 0x9D017F5C
9D017DC8  318C0040   ANDI T4, T4, 64
980:                    {
981:                       uint8 colors[8];
982:                 
983:                       /* buckle up, it's going to get ugly... */
984:                       if (0 == (attrib & OAMF_HFLIP))
9D017DCC  318D00FF   ANDI T5, T4, 255
9D017DD0  55A0000A   BNEL T5, ZERO, 0x9D017DFC
9D017DD4  00157382   SRL T6, S5, 14
985:                       {
986:                          colors[0] = (color >> 14) & 3;
9D017DD8  0015B382   SRL S6, S5, 14
987:                          colors[1] = (color >> 6) & 3;
9D017DDC  7EA20980   EXT V0, S5, 6, 2
988:                          colors[2] = (color >> 12) & 3;
9D017DE0  7EAF0B00   EXT T7, S5, 12, 2
989:                          colors[3] = (color >> 4) & 3;
9D017DE4  7EB80900   EXT T8, S5, 4, 2
990:                          colors[4] = (color >> 10) & 3;
9D017DE8  7EA90A80   EXT T1, S5, 10, 2
991:                          colors[5] = (color >> 2) & 3;
9D017DEC  7EB30880   EXT S3, S5, 2, 2
992:                          colors[6] = (color >> 8) & 3;
9D017DF0  7EB40A00   EXT S4, S5, 8, 2
993:                          colors[7] = color & 3;
9D017DF4  0B405F86   J 0x9D017E18
9D017DF8  32AE0003   ANDI T6, S5, 3
994:                       }
995:                       else
996:                       {
997:                          colors[7] = (color >> 14) & 3;
998:                          colors[6] = (color >> 6) & 3;
9D017DFC  7EB40980   EXT S4, S5, 6, 2
999:                          colors[5] = (color >> 12) & 3;
9D017E00  7EB30B00   EXT S3, S5, 12, 2
1000:                         colors[4] = (color >> 4) & 3;
9D017E04  7EA90900   EXT T1, S5, 4, 2
1001:                         colors[3] = (color >> 10) & 3;
9D017E08  7EB80A80   EXT T8, S5, 10, 2
1002:                         colors[2] = (color >> 2) & 3;
9D017E0C  7EAF0880   EXT T7, S5, 2, 2
1003:                         colors[1] = (color >> 8) & 3;
9D017E10  7EA20A00   EXT V0, S5, 8, 2
1004:                         colors[0] = color & 3;
9D017E14  32B60003   ANDI S6, S5, 3
1005:                      }
1006:                
1007:                      if (colors[0])
9D017E18  12C00005   BEQ S6, ZERO, 0x9D017E30
9D017E1C  00000000   NOP
1008:                         ppu_setstrike(sprite_x + 0);
9D017E20  0F405762   JAL .LFB19, ppu_setstrike, .Ltext0, .Letext0, .LFE15
9D017E24  00000000   NOP
1009:                      else if (colors[1])
9D017E30  10400005   BEQ V0, ZERO, 0x9D017E48
9D017E34  00000000   NOP
1010:                         ppu_setstrike(sprite_x + 1);
9D017E38  0F405762   JAL .LFB19, ppu_setstrike, .Ltext0, .Letext0, .LFE15
9D017E3C  24840001   ADDIU A0, A0, 1
1011:                      else if (colors[2])
9D017E48  11E00005   BEQ T7, ZERO, 0x9D017E60
9D017E4C  00000000   NOP
1012:                         ppu_setstrike(sprite_x + 2);
9D017E50  0F405762   JAL .LFB19, ppu_setstrike, .Ltext0, .Letext0, .LFE15
9D017E54  24840002   ADDIU A0, A0, 2
1013:                      else if (colors[3])
9D017E60  13000005   BEQ T8, ZERO, 0x9D017E78
9D017E64  00000000   NOP
1014:                         ppu_setstrike(sprite_x + 3);
9D017E68  0F405762   JAL .LFB19, ppu_setstrike, .Ltext0, .Letext0, .LFE15
9D017E6C  24840003   ADDIU A0, A0, 3
1015:                      else if (colors[4])
9D017E78  11200005   BEQ T1, ZERO, 0x9D017E90
9D017E7C  00000000   NOP
1016:                         ppu_setstrike(sprite_x + 4);
9D017E80  0F405762   JAL .LFB19, ppu_setstrike, .Ltext0, .Letext0, .LFE15
9D017E84  24840004   ADDIU A0, A0, 4
1017:                      else if (colors[5])
9D017E90  12600005   BEQ S3, ZERO, 0x9D017EA8
9D017E94  00000000   NOP
1018:                         ppu_setstrike(sprite_x + 5);
9D017E98  0F405762   JAL .LFB19, ppu_setstrike, .Ltext0, .Letext0, .LFE15
9D017E9C  24840005   ADDIU A0, A0, 5
1019:                      else if (colors[6])
9D017EA8  12800005   BEQ S4, ZERO, 0x9D017EC0
9D017EAC  00000000   NOP
1020:                         ppu_setstrike(sprite_x + 6);
9D017EB0  0F405762   JAL .LFB19, ppu_setstrike, .Ltext0, .Letext0, .LFE15
9D017EB4  24840006   ADDIU A0, A0, 6
1021:                      else if (colors[7])
9D017EC0  51C00027   BEQL T6, ZERO, 0x9D017F60
9D017EC4  8FBF005C   LW RA, 92(SP)
1022:                         ppu_setstrike(sprite_x + 7);
9D017EC8  0F405762   JAL .LFB19, ppu_setstrike, .Ltext0, .Letext0, .LFE15
9D017ECC  24840007   ADDIU A0, A0, 7
1023:                   }
1024:                }
1025:                
1026:                bool ppu_enabled(void)
1027:                {
1028:                   return (ppu.bg_on || ppu.obj_on);
9D01720C  3C02A001   LUI V0, -24575
9D017210  8C4313E0   LW V1, 5088(V0)
9D017214  14600004   BNE V1, ZERO, 0x9D017228
9D017218  24020001   ADDIU V0, ZERO, 1
9D01721C  3C04A001   LUI A0, -24575
9D017220  8C8513E4   LW A1, 5092(A0)
9D017224  0005102B   SLTU V0, ZERO, A1
1029:                }
9D017228  03E00008   JR RA
9D01722C  00000000   NOP
1030:                
1031:                static void ppu_renderscanline(bitmap_t *bmp, int scanline, bool draw_flag)
1032:                {
1033:                   uint8 *buf = bmp->line[scanline];
9D017354  24B30004   ADDIU S3, A1, 4
9D017358  0013A880   SLL S5, S3, 2
9D01735C  0095B021   ADDU S6, A0, S5
9D017360  8ED70004   LW S7, 4(S6)
9D017364  AFB70028   SW S7, 40(SP)
1034:                
1035:                   /* start scanline - transfer ppu latch into vaddr */
1036:                   if (ppu.bg_on || ppu.obj_on)
9D017368  8E381188   LW T8, 4488(S1)
9D01736C  17000004   BNE T8, ZERO, 0x9D017380
9D017370  3C19A001   LUI T9, -24575
9D017374  8F3E13E4   LW FP, 5092(T9)
9D017378  13C002EF   BEQ FP, ZERO, 0x9D017F38
9D01737C  8FBF0068   LW RA, 104(SP)
1037:                   {
1038:                      if (0 == scanline)
9D017380  16800006   BNE S4, ZERO, 0x9D01739C
9D017384  3C02A001   LUI V0, -24575
1039:                      {
1040:                         ppu.vaddr = ppu.vaddr_latch;
9D017388  3C0AA001   LUI T2, -24575
9D01738C  254B0258   ADDIU T3, T2, 600
9D017390  8D6C1168   LW T4, 4456(T3)
9D017394  0B405CEF   J 0x9D0173BC
9D017398  AD6C1164   SW T4, 4452(T3)
1041:                      }
1042:                      else
1043:                      {
1044:                         ppu.vaddr &= ~0x041F;
9D0173A8  8C661164   LW A2, 4452(V1)
9D0173AC  2407FBE0   ADDIU A3, ZERO, -1056
9D0173B0  00C74024   AND T0, A2, A3
1045:                         ppu.vaddr |= (ppu.vaddr_latch & 0x041F);
9D01739C  24430258   ADDIU V1, V0, 600
9D0173A0  8C641168   LW A0, 4456(V1)
9D0173A4  3085041F   ANDI A1, A0, 1055
9D0173B4  00A84825   OR T1, A1, T0
9D0173B8  AC691164   SW T1, 4452(V1)
1046:                      }
1047:                   }
1048:                
1049:                   if (draw_flag)
9D0173BC  8FAD0068   LW T5, 104(SP)
9D0173C0  11A0023A   BEQ T5, ZERO, .LBB84
9D0173C4  3C03A001   LUI V1, -24575
9D017F38  13E0FF5C   BEQ RA, ZERO, .LBB84
9D017F3C  3C03A001   LUI V1, -24575
1050:                      ppu_renderbg(buf);
1051:                
1052:                   /* TODO: fetch obj data 1 scanline before */
1053:                   if (true == ppu.drawsprites && true == draw_flag)
9D0173EC  0B405DAE   J 0x9D0176B8
9D0173F0  3C07A001   LUI A3, -24575
9D0176B4  3C07A001   LUI A3, -24575
9D0176B8  8CF9200C   LW T9, 8204(A3)
9D0176BC  241F0001   ADDIU RA, ZERO, 1
9D0176C0  173F017A   BNE T9, RA, .LBB84
9D0176C4  3C03A001   LUI V1, -24575
9D0176C8  8FB70068   LW S7, 104(SP)
9D0176CC  16FF0178   BNE S7, RA, 0x9D017CB0
9D0176D0  8C6413E4   LW A0, 5092(V1)
1054:                      ppu_renderoam(buf, scanline);
1055:                   else
1056:                      ppu_fakeoam(scanline);
1057:                }
1058:                
1059:                
1060:                void ppu_endscanline(int scanline)
1061:                {
1062:                   /* modify vram address at end of scanline */
1063:                   if (scanline < 240 && (ppu.bg_on || ppu.obj_on))
9D017230  288400F0   SLTI A0, A0, 240
9D017234  10800025   BEQ A0, ZERO, 0x9D0172CC
9D017238  3C02A001   LUI V0, -24575
9D01723C  8C4313E0   LW V1, 5088(V0)
9D017240  14600005   BNE V1, ZERO, 0x9D017258
9D017244  3C07A001   LUI A3, -24575
9D017248  3C05A001   LUI A1, -24575
9D01724C  8CA613E4   LW A2, 5092(A1)
9D017250  10C0001E   BEQ A2, ZERO, 0x9D0172CC
9D017254  00000000   NOP
1064:                   {
1065:                      int ytile;
1066:                
1067:                      /* check for max 3 bit y tile offset */
1068:                      if (7 == (ppu.vaddr >> 12))
9D017258  8CE813BC   LW T0, 5052(A3)
9D01725C  00084B02   SRL T1, T0, 12
9D017260  240A0007   ADDIU T2, ZERO, 7
9D017264  152A0017   BNE T1, T2, 0x9D0172C4
9D017268  250B1000   ADDIU T3, T0, 4096
1069:                      {
1070:                         ppu.vaddr &= ~0x7000;      /* clear y tile offset */
9D01726C  240D8FFF   ADDIU T5, ZERO, -28673
9D017270  010D7024   AND T6, T0, T5
1071:                         ytile = (ppu.vaddr >> 5) & 0x1F;
9D017274  7DCF2140   EXT T7, T6, 5, 5
1072:                
1073:                         if (29 == ytile)
9D017278  2418001D   ADDIU T8, ZERO, 29
9D01727C  15F80007   BNE T7, T8, 0x9D01729C
9D017280  2419001F   ADDIU T9, ZERO, 31
1074:                         {
1075:                            ppu.vaddr &= ~0x03E0;   /* clear y tile */
9D017284  24078C1F   ADDIU A3, ZERO, -29665
9D017288  01074024   AND T0, T0, A3
1076:                            ppu.vaddr ^= 0x0800;    /* toggle nametable */
9D01728C  39090800   XORI T1, T0, 2048
9D017290  3C0AA001   LUI T2, -24575
9D017294  03E00008   JR RA
9D017298  AD4913BC   SW T1, 5052(T2)
1077:                         }
1078:                         else if (31 == ytile)
9D01729C  15F90006   BNE T7, T9, 0x9D0172B8
9D0172A0  25C40020   ADDIU A0, T6, 32
1079:                         {
1080:                            ppu.vaddr &= ~0x03E0;   /* clear y tile */
9D0172A4  24038C1F   ADDIU V1, ZERO, -29665
9D0172A8  01032824   AND A1, T0, V1
9D0172AC  3C06A001   LUI A2, -24575
9D0172B0  03E00008   JR RA
9D0172B4  ACC513BC   SW A1, 5052(A2)
1081:                         }
1082:                         else
1083:                         {
1084:                            ppu.vaddr += 0x20;      /* increment y tile */
9D0172B8  3C02A001   LUI V0, -24575
9D0172BC  03E00008   JR RA
9D0172C0  AC4413BC   SW A0, 5052(V0)
1085:                         }
1086:                      }
1087:                      else
1088:                      {
1089:                         ppu.vaddr += 0x1000;       /* increment tile y offset */
9D0172C4  3C0CA001   LUI T4, -24575
9D0172C8  AD8B13BC   SW T3, 5052(T4)
9D0172CC  03E00008   JR RA
9D0172D0  00000000   NOP
1090:                      }
1091:                   }
1092:                }
1093:                
1094:                void ppu_checknmi(void)
1095:                {
9D0172E4  27BDFFE8   ADDIU SP, SP, -24
9D0172E8  AFBF0014   SW RA, 20(SP)
1096:                   if (ppu.ctrl0 & PPU_CTRL0F_NMI)
9D0172D4  3C02A001   LUI V0, -24575
9D0172D8  804313B8   LB V1, 5048(V0)
9D0172DC  04610007   BGEZ V1, 0x9D0172FC
9D0172E0  00000000   NOP
1097:                      nes_nmi();
9D0172EC  0F4098C0   JAL nes_nmi
9D0172F0  00000000   NOP
1098:                }
9D0172F4  8FBF0014   LW RA, 20(SP)
9D0172F8  27BD0018   ADDIU SP, SP, 24
9D0172FC  03E00008   JR RA
9D017300  00000000   NOP
1099:                
1100:                void ppu_scanline(bitmap_t *bmp, int scanline, bool draw_flag)
1101:                {
9D017304  27BDFFA0   ADDIU SP, SP, -96
9D017308  AFBF005C   SW RA, 92(SP)
9D01730C  AFBE0058   SW FP, 88(SP)
9D017310  AFB70054   SW S7, 84(SP)
9D017314  AFB60050   SW S6, 80(SP)
9D017318  AFB5004C   SW S5, 76(SP)
9D01731C  AFB40048   SW S4, 72(SP)
9D017320  AFB30044   SW S3, 68(SP)
9D017324  AFB20040   SW S2, 64(SP)
9D017328  AFB1003C   SW S1, 60(SP)
9D01732C  AFB00038   SW S0, 56(SP)
9D017330  00A0A021   ADDU S4, A1, ZERO
1102:                   if (scanline < 240)
9D017334  28A200F0   SLTI V0, A1, 240
9D017338  104002E7   BEQ V0, ZERO, 0x9D017ED8
9D01733C  AFA60068   SW A2, 104(SP)
1103:                   {
1104:                      /* Lower the Max Sprite per scanline flag */
1105:                      ppu.stat &= ~PPU_STATF_MAXSPRITE;
9D017340  3C10A001   LUI S0, -24575
9D017344  26110258   ADDIU S1, S0, 600
9D017348  92321162   LBU S2, 4450(S1)
9D01734C  7C122944   INS S2, ZERO, 5, 1
9D017350  A2321162   SB S2, 4450(S1)
1106:                      ppu_renderscanline(bmp, scanline, draw_flag);
1107:                   }
1108:                   else if (241 == scanline)
9D017ED8  240300F1   ADDIU V1, ZERO, 241
9D017EDC  14A3000A   BNE A1, V1, 0x9D017F08
9D017EE0  24040105   ADDIU A0, ZERO, 261
1109:                   {
1110:                      ppu.stat |= PPU_STATF_VBLANK;
9D017EE4  3C0AA001   LUI T2, -24575
9D017EE8  254B0258   ADDIU T3, T2, 600
9D017EEC  916C1162   LBU T4, 4450(T3)
9D017EF0  240DFF80   ADDIU T5, ZERO, -128
9D017EF4  018D7025   OR T6, T4, T5
9D017EF8  A16E1162   SB T6, 4450(T3)
1111:                      ppu.vram_accessible = true;
9D017EFC  240F0001   ADDIU T7, ZERO, 1
9D017F00  0B405FD7   J 0x9D017F5C
9D017F04  AD6F1DAC   SW T7, 7596(T3)
1112:                   }
1113:                   else if (261 == scanline)
9D017F08  14A40015   BNE A1, A0, 0x9D017F60
9D017F0C  8FBF005C   LW RA, 92(SP)
1114:                   {
1115:                      ppu.stat &= ~PPU_STATF_VBLANK;
9D017F10  3C05A001   LUI A1, -24575
9D017F14  24A60258   ADDIU A2, A1, 600
9D017F18  90C71162   LBU A3, 4450(A2)
9D017F1C  30E8007F   ANDI T0, A3, 127
9D017F20  A0C81162   SB T0, 4450(A2)
1116:                      ppu.strikeflag = false;
9D017F24  ACC0119C   SW ZERO, 4508(A2)
1117:                      ppu.strike_cycle = (uint32) -1;
9D017F28  2409FFFF   ADDIU T1, ZERO, -1
9D017F2C  ACC911A0   SW T1, 4512(A2)
1118:                
1119:                      ppu.vram_accessible = false;
9D017F30  0B405FD7   J 0x9D017F5C
9D017F34  ACC01DAC   SW ZERO, 7596(A2)
1120:                   }
1121:                }
9D017E28  0B405FD8   J 0x9D017F60
9D017E2C  8FBF005C   LW RA, 92(SP)
9D017E40  0B405FD8   J 0x9D017F60
9D017E44  8FBF005C   LW RA, 92(SP)
9D017E58  0B405FD8   J 0x9D017F60
9D017E5C  8FBF005C   LW RA, 92(SP)
9D017E70  0B405FD8   J 0x9D017F60
9D017E74  8FBF005C   LW RA, 92(SP)
9D017E88  0B405FD8   J 0x9D017F60
9D017E8C  8FBF005C   LW RA, 92(SP)
9D017EA0  0B405FD8   J 0x9D017F60
9D017EA4  8FBF005C   LW RA, 92(SP)
9D017EB8  0B405FD8   J 0x9D017F60
9D017EBC  8FBF005C   LW RA, 92(SP)
9D017ED0  0B405FD8   J 0x9D017F60
9D017ED4  8FBF005C   LW RA, 92(SP)
9D017F5C  8FBF005C   LW RA, 92(SP)
9D017F60  8FBE0058   LW FP, 88(SP)
9D017F64  8FB70054   LW S7, 84(SP)
9D017F68  8FB60050   LW S6, 80(SP)
9D017F6C  8FB5004C   LW S5, 76(SP)
9D017F70  8FB40048   LW S4, 72(SP)
9D017F74  8FB30044   LW S3, 68(SP)
9D017F78  8FB20040   LW S2, 64(SP)
9D017F7C  8FB1003C   LW S1, 60(SP)
9D017F80  8FB00038   LW S0, 56(SP)
9D017F84  03E00008   JR RA
9D017F88  27BD0060   ADDIU SP, SP, 96
1122:                
1123:                /*
1124:                bool ppu_checkzapperhit(bitmap_t *bmp, int x, int y)
1125:                {
1126:                   uint8 pixel = bmp->line[y][x] & 0x3F;
1127:                
1128:                   if (0x20 == pixel || 0x30 == pixel)
1129:                      return true;
1130:                
1131:                   return false;
1132:                }
1133:                */
1134:                
1135:                /*************************************************/
1136:                /* TODO: all this stuff should go somewhere else */
1137:                /*************************************************/
1138:                INLINE void draw_box(bitmap_t *bmp, int x, int y, int height)
1139:                {
1140:                   int i;
1141:                   uint8 *vid;
1142:                
1143:                   vid = bmp->line[y] + x;
9D018024  25530004   ADDIU S3, T2, 4
9D018028  0013A080   SLL S4, S3, 2
9D01802C  0094A821   ADDU S5, A0, S4
9D018030  8EA70004   LW A3, 4(S5)
9D018034  00E91021   ADDU V0, A3, T1
1144:                
1145:                   for (i = 0; i < 10; i++)
1146:                      *vid++ = GUI_GRAY;
9D017FC8  2403FFC2   ADDIU V1, ZERO, -62
9D018038  A0430000   SB V1, 0(V0)
9D01803C  A0430001   SB V1, 1(V0)
9D018040  A0430002   SB V1, 2(V0)
9D018044  A0430003   SB V1, 3(V0)
9D018048  A0430004   SB V1, 4(V0)
9D01804C  A0430005   SB V1, 5(V0)
9D018050  A0430006   SB V1, 6(V0)
9D018054  A0430007   SB V1, 7(V0)
9D018058  A0430008   SB V1, 8(V0)
9D01805C  A0430009   SB V1, 9(V0)
1147:                   vid += (bmp->pitch - 10);
9D018060  8C880008   LW T0, 8(A0)
1148:                   for (i = 0; i < height; i++)
9D018064  196000CE   BLEZ T3, 0x9D0183A0
9D018068  00481021   ADDU V0, V0, T0
9D01806C  2573FFFF   ADDIU S3, T3, -1
9D018070  32740007   ANDI S4, S3, 7
9D018080  24070001   ADDIU A3, ZERO, 1
9D018084  00EB402A   SLT T0, A3, T3
9D018088  150000E3   BNE T0, ZERO, 0x9D018418
9D01808C  00551021   ADDU V0, V0, S5
9D018114  24E70008   ADDIU A3, A3, 8
9D018118  00EB402A   SLT T0, A3, T3
9D01811C  1500FFDE   BNE T0, ZERO, 0x9D018098
9D018120  00541021   ADDU V0, V0, S4
9D0181CC  02A7480B   MOVN T1, S5, A3
9D0183E8  00005021   ADDU T2, ZERO, ZERO
9D01845C  24E70001   ADDIU A3, A3, 1
9D018470  24E70001   ADDIU A3, A3, 1
9D018484  24E70001   ADDIU A3, A3, 1
9D018498  24E70001   ADDIU A3, A3, 1
9D0184AC  24E70001   ADDIU A3, A3, 1
9D0184C0  24E70001   ADDIU A3, A3, 1
9D0184D0  24E70001   ADDIU A3, A3, 1
9D0184D4  00EB402A   SLT T0, A3, T3
9D0184D8  1500FEEF   BNE T0, ZERO, 0x9D018098
9D0184DC  00551021   ADDU V0, V0, S5
1149:                   {
1150:                      vid[0] = vid[9] = GUI_GRAY;
9D018074  A0430009   SB V1, 9(V0)
9D018078  A0430000   SB V1, 0(V0)
9D018098  A0430009   SB V1, 9(V0)
9D01809C  A0430000   SB V1, 0(V0)
9D0180A8  A2630009   SB V1, 9(S3)
9D0180AC  A2630000   SB V1, 0(S3)
9D0180B8  A0430009   SB V1, 9(V0)
9D0180BC  A0430000   SB V1, 0(V0)
9D0180C8  A2830009   SB V1, 9(S4)
9D0180CC  A2830000   SB V1, 0(S4)
9D0180D8  A2A30009   SB V1, 9(S5)
9D0180DC  A2A30000   SB V1, 0(S5)
9D0180E8  A2830009   SB V1, 9(S4)
9D0180EC  A2830000   SB V1, 0(S4)
9D0180F8  A2630009   SB V1, 9(S3)
9D0180FC  A2630000   SB V1, 0(S3)
9D018108  A0430009   SB V1, 9(V0)
9D01810C  A0430000   SB V1, 0(V0)
9D018448  12880006   BEQ S4, T0, 0x9D018464
9D01844C  A0430009   SB V1, 9(V0)
9D018450  A0430000   SB V1, 0(V0)
9D018460  A0430009   SB V1, 9(V0)
9D018464  A0430000   SB V1, 0(V0)
9D018474  A0430009   SB V1, 9(V0)
9D018478  A0430000   SB V1, 0(V0)
9D018488  A0430009   SB V1, 9(V0)
9D01848C  A0430000   SB V1, 0(V0)
9D01849C  A0430009   SB V1, 9(V0)
9D0184A0  A0430000   SB V1, 0(V0)
9D0184B0  A0430009   SB V1, 9(V0)
9D0184B4  A0430000   SB V1, 0(V0)
9D0184C4  A0430009   SB V1, 9(V0)
9D0184C8  A0430000   SB V1, 0(V0)
1151:                      vid += bmp->pitch;
9D01807C  8C950008   LW S5, 8(A0)
9D0180A0  8C940008   LW S4, 8(A0)
9D0180A4  00549821   ADDU S3, V0, S4
9D0180B0  8C950008   LW S5, 8(A0)
9D0180B4  02751021   ADDU V0, S3, S5
9D0180C0  8C880008   LW T0, 8(A0)
9D0180C4  0048A021   ADDU S4, V0, T0
9D0180D0  8C930008   LW S3, 8(A0)
9D0180D4  0293A821   ADDU S5, S4, S3
9D0180E0  8C820008   LW V0, 8(A0)
9D0180E4  02A2A021   ADDU S4, S5, V0
9D0180F0  8C880008   LW T0, 8(A0)
9D0180F4  02889821   ADDU S3, S4, T0
9D018100  8C950008   LW S5, 8(A0)
9D018104  02751021   ADDU V0, S3, S5
9D018110  8C940008   LW S4, 8(A0)
9D018454  8C940008   LW S4, 8(A0)
9D018458  00541021   ADDU V0, V0, S4
9D018468  8C930008   LW S3, 8(A0)
9D01846C  00531021   ADDU V0, V0, S3
9D01847C  8C950008   LW S5, 8(A0)
9D018480  00551021   ADDU V0, V0, S5
9D018490  8C880008   LW T0, 8(A0)
9D018494  00481021   ADDU V0, V0, T0
9D0184A4  8C940008   LW S4, 8(A0)
9D0184A8  00541021   ADDU V0, V0, S4
9D0184B8  8C930008   LW S3, 8(A0)
9D0184BC  00531021   ADDU V0, V0, S3
9D0184CC  8C950008   LW S5, 8(A0)
1152:                   }
1153:                   for (i = 0; i < 10; i++)
1154:                      *vid++ = GUI_GRAY;
9D018090  0B4060E9   J 0x9D0183A4
9D018094  A0430000   SB V1, 0(V0)
9D018124  0B4060E9   J 0x9D0183A4
9D018128  A0430000   SB V1, 0(V0)
9D0183A0  A0430000   SB V1, 0(V0)
9D0183A4  A0430001   SB V1, 1(V0)
9D0183A8  A0430002   SB V1, 2(V0)
9D0183AC  A0430003   SB V1, 3(V0)
9D0183B0  A0430004   SB V1, 4(V0)
9D0183B4  A0430005   SB V1, 5(V0)
9D0183B8  A0430006   SB V1, 6(V0)
9D0183BC  A0430007   SB V1, 7(V0)
9D0183C0  A0430008   SB V1, 8(V0)
9D0183C4  A0430009   SB V1, 9(V0)
9D0184E0  0B4060E9   J 0x9D0183A4
9D0184E4  A0430000   SB V1, 0(V0)
1155:                }
1156:                
1157:                INLINE void draw_deadsprite(bitmap_t *bmp, int x, int y, int height)
1158:                {
1159:                   int i, j, index;
1160:                   uint8 *vid;
1161:                   uint8 colbuf[8] = { GUI_BLACK, GUI_BLACK, GUI_BLACK, GUI_BLACK,
9D017FCC  3C199D04   LUI T9, -25340
9D0182A0  8A870003   LWL A3, 3(S4)
9D0182A4  9B271B04   LWR A3, 6916(T9)
9D0182A8  8A880007   LWL T0, 7(S4)
9D0182AC  9A880004   LWR T0, 4(S4)
9D0182B0  AFA70000   SW A3, 0(SP)
9D0182B4  AFA80004   SW T0, 4(SP)
1162:                                       GUI_BLACK, GUI_BLACK, GUI_BLACK, GUI_DKGRAY };
1163:                
1164:                   vid = bmp->line[y] + x;
9D0182B8  254A0005   ADDIU T2, T2, 5
9D0182BC  000AA880   SLL S5, T2, 2
9D0182C0  00951021   ADDU V0, A0, S5
9D0182C8  8C540004   LW S4, 4(V0)
1165:                
1166:                   for (i = 0; i < height; i++)
9D0182CC  1960002F   BLEZ T3, 0x9D01838C
9D0182D0  02891021   ADDU V0, S4, T1
9D0182D4  00003821   ADDU A3, ZERO, ZERO
9D01837C  24E70001   ADDIU A3, A3, 1
9D018380  00EB402A   SLT T0, A3, T3
9D018384  1500FFD4   BNE T0, ZERO, 0x9D0182D8
9D018388  004A1021   ADDU V0, V0, T2
1167:                   {
1168:                      index = i;
1169:                
1170:                      if (height == 16)
1171:                         index >>= 1;
9D017FD0  01656826   XOR T5, T3, A1
9D0182D8  00074043   SRA T0, A3, 1
9D0182DC  00ED400B   MOVN T0, A3, T5
1172:                
1173:                      for (j = 0; j < 8; j++)
1174:                      {
1175:                         *(vid + j) = colbuf[index++];
9D0182E0  25130001   ADDIU S3, T0, 1
9D0182E4  03A85021   ADDU T2, SP, T0
9D0182E8  91550000   LBU S5, 0(T2)
9D0182EC  A0550000   SB S5, 0(V0)
9D0182F4  25340001   ADDIU S4, T1, 1
9D0182F8  03A94021   ADDU T0, SP, T1
9D0182FC  91130000   LBU S3, 0(T0)
9D018300  A0530001   SB S3, 1(V0)
9D018308  25550001   ADDIU S5, T2, 1
9D01830C  03AA4821   ADDU T1, SP, T2
9D018310  91340000   LBU S4, 0(T1)
9D018314  A0540002   SB S4, 2(V0)
9D01831C  26680001   ADDIU T0, S3, 1
9D018320  03B35021   ADDU T2, SP, S3
9D018324  91550000   LBU S5, 0(T2)
9D018328  A0550003   SB S5, 3(V0)
9D018330  26890001   ADDIU T1, S4, 1
9D018334  03B49821   ADDU S3, SP, S4
9D018338  92680000   LBU T0, 0(S3)
9D01833C  A0480004   SB T0, 4(V0)
9D018344  25550001   ADDIU S5, T2, 1
9D018348  03AAA021   ADDU S4, SP, T2
9D01834C  92890000   LBU T1, 0(S4)
9D018350  A0490005   SB T1, 5(V0)
9D018358  266A0001   ADDIU T2, S3, 1
9D01835C  03B34021   ADDU T0, SP, S3
9D018360  91150000   LBU S5, 0(T0)
9D018364  A0550006   SB S5, 6(V0)
9D01836C  03B44821   ADDU T1, SP, S4
9D018370  91330000   LBU S3, 0(T1)
9D018374  A0530007   SB S3, 7(V0)
1176:                         index &= 7;
9D0182F0  32690007   ANDI T1, S3, 7
9D018304  328A0007   ANDI T2, S4, 7
9D018318  32B30007   ANDI S3, S5, 7
9D01832C  31140007   ANDI S4, T0, 7
9D018340  312A0007   ANDI T2, T1, 7
9D018354  32B30007   ANDI S3, S5, 7
9D018368  31540007   ANDI S4, T2, 7
1177:                      }
1178:                
1179:                      vid += bmp->pitch;
9D018378  8C8A0008   LW T2, 8(A0)
1180:                   }
1181:                }
1182:                
1183:                
1184:                /* Stuff for the OAM viewer */
1185:                static void draw_sprite(bitmap_t *bmp, int x, int y, uint8 tile_num, uint8 attrib)
1186:                {
1187:                   int line, height;
1188:                   int col_high, vram_adr;
1189:                   uint8 *vid, *data_ptr;
1190:                
1191:                   vid = bmp->line[y] + x;
9D01812C  25540005   ADDIU S4, T2, 5
9D018130  00149880   SLL S3, S4, 2
9D018134  00935021   ADDU T2, A0, S3
9D01813C  8D420004   LW V0, 4(T2)
9D018140  00491021   ADDU V0, V0, T1
1192:                
1193:                   /* Get upper two bits of color */
1194:                   col_high = ((attrib & 3) << 2);
9D018144  91C70002   LBU A3, 2(T6)
9D018148  30E80003   ANDI T0, A3, 3
1195:                
1196:                   /* 8x16 even sprites use $0000, odd use $1000 */
1197:                   height = ppu.obj_height;
9D017FD4  3C06A001   LUI A2, -24575
9D01814C  24D40258   ADDIU S4, A2, 600
9D018150  9294117C   LBU S4, 4476(S4)
1198:                   if (16 == height)
9D018154  1685000E   BNE S4, A1, 0x9D018190
9D018158  00089880   SLL S3, T0, 2
1199:                      vram_adr = ((tile_num & 1) << 12) | ((tile_num & 0xFE) << 4);
9D01815C  32A700FE   ANDI A3, S5, 254
9D018160  00075100   SLL T2, A3, 4
9D018164  32B50001   ANDI S5, S5, 1
9D018168  00154300   SLL T0, S5, 12
9D01816C  01483825   OR A3, T2, T0
1200:                   /* else just use the offset from $2000 */
1201:                   else
1202:                      vram_adr = ppu.obj_base + (tile_num << 4);
9D018190  0015A900   SLL S5, S5, 4
9D018194  24CA0258   ADDIU T2, A2, 600
9D018198  8D491180   LW T1, 4480(T2)
9D01819C  02A93821   ADDU A3, S5, T1
1203:                
1204:                   data_ptr = &PPU_MEM(vram_adr);
9D018170  00074A83   SRA T1, A3, 10
9D018174  252A0448   ADDIU T2, T1, 1096
9D018178  000AA880   SLL S5, T2, 2
9D01817C  24C80258   ADDIU T0, A2, 600
9D018180  02A84821   ADDU T1, S5, T0
9D018184  8D2A0000   LW T2, 0(T1)
9D018188  0B4060FA   J 0x9D0183E8
9D01818C  01474821   ADDU T1, T2, A3
9D0181A0  00074283   SRA T0, A3, 10
9D0181A4  25150448   ADDIU S5, T0, 1096
9D0181A8  00154880   SLL T1, S5, 2
9D0181AC  012A5021   ADDU T2, T1, T2
9D0181B0  8D480000   LW T0, 0(T2)
1205:                
1206:                   for (line = 0; line < height; line++)
9D0181B4  1E80008C   BGTZ S4, 0x9D0183E8
9D0181B8  01074821   ADDU T1, T0, A3
9D018288  254A0001   ADDIU T2, T2, 1
9D01828C  0154982A   SLT S3, T2, S4
9D018290  1660FFCC   BNE S3, ZERO, 0x9D0181C4
9D018294  00471021   ADDU V0, V0, A3
1207:                   {
1208:                      if (line == 8)
9D017FDC  24180008   ADDIU T8, ZERO, 8
1209:                         data_ptr += 8;
9D0181C4  25290009   ADDIU T1, T1, 9
9D0181C8  01583826   XOR A3, T2, T8
1210:                
1211:                      draw_bgtile(vid, data_ptr[0], data_ptr[8], ppu.palette + 16 + col_high);
9D0181D0  91330000   LBU S3, 0(T1)
9D0181D4  91270008   LBU A3, 8(T1)
9D0183EC  26731110   ADDIU S3, S3, 4368
9D0183F0  24C70258   ADDIU A3, A2, 600
9D0183F4  0B406074   J 0x9D0181D0
9D0183F8  00F34021   ADDU T0, A3, S3
1212:                      //draw_oamtile(vid, attrib, data_ptr[0], data_ptr[8], ppu.palette + 16 + col_high);
1213:                
1214:                      data_ptr++;
9D018280  25350001   ADDIU S5, T1, 1
1215:                      vid += bmp->pitch;
9D018284  8C870008   LW A3, 8(A0)
1216:                   }
1217:                }
1218:                
1219:                void ppu_dumpoam(bitmap_t *bmp, int x_loc, int y_loc)
1220:                {
9D017F8C  27BDFFE0   ADDIU SP, SP, -32
9D017F90  AFB5001C   SW S5, 28(SP)
9D017F94  AFB40018   SW S4, 24(SP)
9D017F98  AFB30014   SW S3, 20(SP)
9D017F9C  AFB20010   SW S2, 16(SP)
9D017FA0  AFB1000C   SW S1, 12(SP)
9D017FA4  AFB00008   SW S0, 8(SP)
9D017FA8  00A08021   ADDU S0, A1, ZERO
9D017FAC  00C09021   ADDU S2, A2, ZERO
1221:                   int sprite, x_pos, y_pos, height;
1222:                   obj_t *spr_ptr;
1223:                
1224:                   spr_ptr = (obj_t *) ppu.oam;
9D017FB8  3C0EA001   LUI T6, -24575
9D017FBC  25CE1258   ADDIU T6, T6, 4696
1225:                   height = ppu.obj_height;
9D017FB0  3C02A001   LUI V0, -24575
9D017FB4  904B13D4   LBU T3, 5076(V0)
1226:                
1227:                   for (sprite = 0; sprite < 64; sprite++)
9D017FC0  00007821   ADDU T7, ZERO, ZERO
9D017FE0  3C11A001   LUI S1, -24575
9D017FE4  26311358   ADDIU S1, S1, 4952
9D018390  15D1FF15   BNE T6, S1, 0x9D017FE8
9D018394  25EF0001   ADDIU T7, T7, 1
9D018398  0B4060FF   J 0x9D0183FC
9D01839C  8FB5001C   LW S5, 28(SP)
1228:                   {
1229:                      x_pos = ((sprite & 0x0F) << 3) + (sprite & 0x0F) + x_loc;
9D017FE8  31E7000F   ANDI A3, T7, 15
9D017FEC  000748C0   SLL T1, A3, 3
9D017FF0  00E94021   ADDU T0, A3, T1
1230:                      if (height == 16)
9D017FC4  24050010   ADDIU A1, ZERO, 16
9D017FF4  15650006   BNE T3, A1, 0x9D018010
9D017FF8  01104821   ADDU T1, T0, S0
1231:                         y_pos = (sprite & 0xF0) + (sprite >> 4) + y_loc;
9D017FFC  31E700F0   ANDI A3, T7, 240
9D018000  000F1103   SRA V0, T7, 4
9D018004  00E24021   ADDU T0, A3, V0
9D018008  0B406009   J 0x9D018024
9D01800C  01125021   ADDU T2, T0, S2
1232:                      else
1233:                         y_pos = ((sprite & 0xF0) >> 1) + (sprite >> 4) + y_loc;
9D018010  31EA00F0   ANDI T2, T7, 240
9D018014  000A9843   SRA S3, T2, 1
9D018018  000FA103   SRA S4, T7, 4
9D01801C  0274A821   ADDU S5, S3, S4
9D018020  02B25021   ADDU T2, S5, S2
1234:                
1235:                      draw_box(bmp, x_pos, y_pos, height);
1236:                
1237:                      if (spr_ptr->y_loc && spr_ptr->y_loc < 240)
9D0183C8  91C70000   LBU A3, 0(T6)
9D0183CC  24F3FFFF   ADDIU S3, A3, -1
9D0183D0  327500FF   ANDI S5, S3, 255
9D0183D4  2EA200EF   SLTIU V0, S5, 239
9D0183D8  5440FF54   BNEL V0, ZERO, 0x9D01812C
9D0183DC  91D50001   LBU S5, 1(T6)
9D0183E0  0B4060A8   J 0x9D0182A0
9D0183E4  27341B04   ADDIU S4, T9, 6916
1238:                         draw_sprite(bmp, x_pos + 1, y_pos + 1, spr_ptr->tile, spr_ptr->atr);
9D018138  25290001   ADDIU T1, T1, 1
1239:                      else
1240:                         draw_deadsprite(bmp, x_pos + 1, y_pos + 1, height);
9D0182C4  25290001   ADDIU T1, T1, 1
1241:                
1242:                      spr_ptr++;
9D0181BC  0B4060E4   J 0x9D018390
9D0181C0  25CE0004   ADDIU T6, T6, 4
9D018298  0B4060E4   J 0x9D018390
9D01829C  25CE0004   ADDIU T6, T6, 4
9D01838C  25CE0004   ADDIU T6, T6, 4
1243:                   }
1244:                }
9D0183FC  8FB40018   LW S4, 24(SP)
9D018400  8FB30014   LW S3, 20(SP)
9D018404  8FB20010   LW S2, 16(SP)
9D018408  8FB1000C   LW S1, 12(SP)
9D01840C  8FB00008   LW S0, 8(SP)
9D018410  03E00008   JR RA
9D018414  27BD0020   ADDIU SP, SP, 32
9D018418  1280FF1F   BEQ S4, ZERO, 0x9D018098
9D01841C  24130001   ADDIU S3, ZERO, 1
9D018420  12930028   BEQ S4, S3, 0x9D0184C4
9D018424  24150002   ADDIU S5, ZERO, 2
9D018428  12950021   BEQ S4, S5, 0x9D0184B0
9D01842C  24080003   ADDIU T0, ZERO, 3
9D018430  1288001A   BEQ S4, T0, 0x9D01849C
9D018434  24130004   ADDIU S3, ZERO, 4
9D018438  12930013   BEQ S4, S3, 0x9D018488
9D01843C  24150005   ADDIU S5, ZERO, 5
9D018440  1295000C   BEQ S4, S5, 0x9D018474
9D018444  24080006   ADDIU T0, ZERO, 6
9D018448  12880006   BEQ S4, T0, 0x9D018464
9D01844C  A0430009   SB V1, 9(V0)
9D018450  A0430000   SB V1, 0(V0)
9D018454  8C940008   LW S4, 8(A0)
9D018458  00541021   ADDU V0, V0, S4
9D01845C  24E70001   ADDIU A3, A3, 1
9D018460  A0430009   SB V1, 9(V0)
9D018464  A0430000   SB V1, 0(V0)
9D018468  8C930008   LW S3, 8(A0)
9D01846C  00531021   ADDU V0, V0, S3
9D018470  24E70001   ADDIU A3, A3, 1
9D018474  A0430009   SB V1, 9(V0)
9D018478  A0430000   SB V1, 0(V0)
9D01847C  8C950008   LW S5, 8(A0)
9D018480  00551021   ADDU V0, V0, S5
9D018484  24E70001   ADDIU A3, A3, 1
9D018488  A0430009   SB V1, 9(V0)
9D01848C  A0430000   SB V1, 0(V0)
9D018490  8C880008   LW T0, 8(A0)
9D018494  00481021   ADDU V0, V0, T0
9D018498  24E70001   ADDIU A3, A3, 1
9D01849C  A0430009   SB V1, 9(V0)
9D0184A0  A0430000   SB V1, 0(V0)
9D0184A4  8C940008   LW S4, 8(A0)
9D0184A8  00541021   ADDU V0, V0, S4
9D0184AC  24E70001   ADDIU A3, A3, 1
9D0184B0  A0430009   SB V1, 9(V0)
9D0184B4  A0430000   SB V1, 0(V0)
9D0184B8  8C930008   LW S3, 8(A0)
9D0184BC  00531021   ADDU V0, V0, S3
9D0184C0  24E70001   ADDIU A3, A3, 1
9D0184C4  A0430009   SB V1, 9(V0)
9D0184C8  A0430000   SB V1, 0(V0)
9D0184CC  8C950008   LW S5, 8(A0)
9D0184D0  24E70001   ADDIU A3, A3, 1
9D0184D4  00EB402A   SLT T0, A3, T3
9D0184D8  1500FEEF   BNE T0, ZERO, 0x9D018098
9D0184DC  00551021   ADDU V0, V0, S5
9D0184E0  0B4060E9   J 0x9D0183A4
9D0184E4  A0430000   SB V1, 0(V0)
1245:                
1246:                /* More of a debugging thing than anything else */
1247:                void ppu_dumppattern(bitmap_t *bmp, int table_num, int x_loc, int y_loc, int col)
1248:                {
9D0184E8  27BDFFF0   ADDIU SP, SP, -16
9D0184EC  AFB2000C   SW S2, 12(SP)
9D0184F0  AFB10008   SW S1, 8(SP)
9D0184F4  AFB00004   SW S0, 4(SP)
1249:                   int x_tile, y_tile;
1250:                   uint8 *bmp_ptr, *data_ptr, *ptr;
1251:                   int tile_num, line;
1252:                   uint8 col_high;
1253:                
1254:                   tile_num = 0;
9D018518  0000C821   ADDU T9, ZERO, ZERO
1255:                   col_high = col << 2;
9D0184F8  8FA20020   LW V0, 32(SP)
9D0184FC  00021880   SLL V1, V0, 2
9D018500  306800FF   ANDI T0, V1, 255
1256:                
1257:                   for (y_tile = 0; y_tile < 16; y_tile++)
9D018530  24110100   ADDIU S1, ZERO, 256
9D01863C  1731FFBD   BNE T9, S1, 0x9D018534
9D018640  26100020   ADDIU S0, S0, 32
1258:                   {
1259:                      /* Get our pointer to the bitmap */
1260:                      bmp_ptr = bmp->line[y_loc] + x_loc;
9D018534  8E0D0000   LW T5, 0(S0)
9D018538  01A66821   ADDU T5, T5, A2
9D01853C  25AF0080   ADDIU T7, T5, 128
9D018540  03207021   ADDU T6, T9, ZERO
1261:                
1262:                      for (x_tile = 0; x_tile < 16; x_tile++)
9D018630  15AFFFC4   BNE T5, T7, 0x9D018544
9D018634  25CE0001   ADDIU T6, T6, 1
9D018638  27390010   ADDIU T9, T9, 16
1263:                      {
1264:                         data_ptr = &PPU_MEM((table_num << 12) + (tile_num << 4));
9D018504  00052B00   SLL A1, A1, 12
9D018508  24E70004   ADDIU A3, A3, 4
9D01850C  00078080   SLL S0, A3, 2
9D018510  00904821   ADDU T1, A0, S0
9D018514  25300004   ADDIU S0, T1, 4
9D01851C  3C18A001   LUI T8, -24575
9D018520  27180258   ADDIU T8, T8, 600
9D018544  000E6100   SLL T4, T6, 4
9D018548  00AC9021   ADDU S2, A1, T4
9D01854C  00121283   SRA V0, S2, 10
9D018550  24430448   ADDIU V1, V0, 1096
9D018554  00034080   SLL T0, V1, 2
9D018558  01184821   ADDU T1, T0, T8
9D01855C  8D2A0000   LW T2, 0(T1)
9D018560  01524021   ADDU T0, T2, S2
9D018564  250C0008   ADDIU T4, T0, 8
9D018568  01A01021   ADDU V0, T5, ZERO
1265:                         ptr = bmp_ptr;
1266:                
1267:                         for (line = 0; line < 8; line ++)
9D018624  150CFFD1   BNE T0, T4, 0x9D01856C
9D018628  00431021   ADDU V0, V0, V1
1268:                         {
1269:                            draw_bgtile(ptr, data_ptr[0], data_ptr[8], ppu.palette + col_high);
9D018524  250A1100   ADDIU T2, T0, 4352
9D018528  030A3821   ADDU A3, T8, T2
9D01856C  91090000   LBU T1, 0(T0)
9D018570  91120008   LBU S2, 8(T0)
1270:                            data_ptr++;
9D01861C  25080001   ADDIU T0, T0, 1
1271:                            ptr += bmp->pitch;
9D018620  8C830008   LW V1, 8(A0)
1272:                         }
1273:                
1274:                         bmp_ptr += 8;
9D01862C  25AD0008   ADDIU T5, T5, 8
1275:                         tile_num++;
1276:                      }
1277:                      y_loc += 8;
1278:                   }
1279:                }
9D018644  8FB2000C   LW S2, 12(SP)
9D018648  8FB10008   LW S1, 8(SP)
9D01864C  8FB00004   LW S0, 4(SP)
9D018650  03E00008   JR RA
9D018654  27BD0010   ADDIU SP, SP, 16
1280:                
1281:                /*
1282:                ** $Log: nes_ppu.c,v $
1283:                ** Revision 1.2  2001/04/27 14:37:11  neil
1284:                ** wheeee
1285:                **
1286:                ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
1287:                ** initial
1288:                **
1289:                ** Revision 1.14  2000/11/29 12:58:23  matt
1290:                ** timing/fiq fixes
1291:                **
1292:                ** Revision 1.13  2000/11/27 19:36:15  matt
1293:                ** more timing fixes
1294:                **
1295:                ** Revision 1.12  2000/11/26 15:51:13  matt
1296:                ** frame IRQ emulation
1297:                **
1298:                ** Revision 1.11  2000/11/25 20:30:39  matt
1299:                ** scanline emulation simplifications/timing fixes
1300:                **
1301:                ** Revision 1.10  2000/11/24 14:56:02  matt
1302:                ** fixed a long-standing sprite 0 strike bug
1303:                **
1304:                ** Revision 1.9  2000/11/20 13:23:17  matt
1305:                ** PPU fixes
1306:                **
1307:                ** Revision 1.8  2000/11/19 13:47:30  matt
1308:                ** problem with frame irqs fixed
1309:                **
1310:                ** Revision 1.7  2000/11/19 13:40:19  matt
1311:                ** more accurate ppu behavior
1312:                **
1313:                ** Revision 1.6  2000/11/14 12:09:37  matt
1314:                ** only generate the palette once, please
1315:                **
1316:                ** Revision 1.5  2000/11/11 14:51:43  matt
1317:                ** context get/set fixed
1318:                **
1319:                ** Revision 1.4  2000/11/09 12:35:50  matt
1320:                ** fixed timing problem with VRAM reads/writes
1321:                **
1322:                ** Revision 1.3  2000/11/05 16:35:41  matt
1323:                ** rolled rgb.h into bitmap.h
1324:                **
1325:                ** Revision 1.2  2000/10/27 12:55:03  matt
1326:                ** palette generating functions now take *this pointers
1327:                **
1328:                ** Revision 1.1  2000/10/24 12:20:28  matt
1329:                ** changed directory structure
1330:                **
1331:                ** Revision 1.33  2000/10/23 15:53:08  matt
1332:                ** better system handling
1333:                **
1334:                ** Revision 1.32  2000/10/22 15:02:32  matt
1335:                ** simplified mirroring
1336:                **
1337:                ** Revision 1.31  2000/10/21 21:36:04  matt
1338:                ** ppu cleanups / fixes
1339:                **
1340:                ** Revision 1.30  2000/10/21 19:26:59  matt
1341:                ** many more cleanups
1342:                **
1343:                ** Revision 1.29  2000/10/10 13:58:15  matt
1344:                ** stroustrup squeezing his way in the door
1345:                **
1346:                ** Revision 1.28  2000/10/08 17:54:32  matt
1347:                ** reject VRAM access out of VINT period
1348:                **
1349:                ** Revision 1.27  2000/09/15 04:58:07  matt
1350:                ** simplifying and optimizing APU core
1351:                **
1352:                ** Revision 1.26  2000/09/08 11:57:29  matt
1353:                ** no more nes_fiq
1354:                **
1355:                ** Revision 1.25  2000/09/07 21:57:31  matt
1356:                ** api change
1357:                **
1358:                ** Revision 1.24  2000/07/31 04:27:59  matt
1359:                ** one million cleanups
1360:                **
1361:                ** Revision 1.23  2000/07/30 06:13:12  matt
1362:                ** default to no FIQs on startup
1363:                **
1364:                ** Revision 1.22  2000/07/30 04:32:32  matt
1365:                ** emulation of the NES frame IRQ
1366:                **
1367:                ** Revision 1.21  2000/07/25 02:25:53  matt
1368:                ** safer xxx_destroy calls
1369:                **
1370:                ** Revision 1.20  2000/07/23 15:12:43  matt
1371:                ** removed unused variables, changed INLINE
1372:                **
1373:                ** Revision 1.19  2000/07/21 04:50:39  matt
1374:                ** moved palette calls out of nofrendo.c and into ppu_create
1375:                **
1376:                ** Revision 1.18  2000/07/17 05:12:55  matt
1377:                ** nes_ppu.c is no longer a scary place to be-- cleaner & faster
1378:                **
1379:                ** Revision 1.17  2000/07/17 01:52:28  matt
1380:                ** made sure last line of all source files is a newline
1381:                **
1382:                ** Revision 1.16  2000/07/11 04:42:39  matt
1383:                ** updated for new screen dimension defines
1384:                **
1385:                ** Revision 1.15  2000/07/10 19:10:16  matt
1386:                ** should bomb out now if a game tries to write to VROM
1387:                **
1388:                ** Revision 1.14  2000/07/10 05:28:30  matt
1389:                ** moved joypad/oam dma from apu to ppu
1390:                **
1391:                ** Revision 1.13  2000/07/10 03:03:16  matt
1392:                ** added ppu_getcontext() routine
1393:                **
1394:                ** Revision 1.12  2000/07/09 03:46:05  matt
1395:                ** using pitch instead of width...
1396:                **
1397:                ** Revision 1.11  2000/07/06 16:42:40  matt
1398:                ** better palette setting interface
1399:                **
1400:                ** Revision 1.10  2000/07/05 22:49:25  matt
1401:                ** changed mmc2 (punchout) tile-access switching
1402:                **
1403:                ** Revision 1.9  2000/07/04 23:13:26  matt
1404:                ** added an irq line drawing debug feature hack
1405:                **
1406:                ** Revision 1.8  2000/06/26 04:58:08  matt
1407:                ** accuracy changes
1408:                **
1409:                ** Revision 1.7  2000/06/22 02:13:49  matt
1410:                ** more accurate emulation of $2002
1411:                **
1412:                ** Revision 1.6  2000/06/20 20:42:47  matt
1413:                ** accuracy changes
1414:                **
1415:                ** Revision 1.5  2000/06/20 00:05:12  matt
1416:                ** tested and verified STAT quirk, added code
1417:                **
1418:                ** Revision 1.4  2000/06/09 15:12:26  matt
1419:                ** initial revision
1420:                **
1421:                */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/nes/nes_pal.c  -----------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** nes_pal.c
21:                  **
22:                  ** NES RGB palette
23:                  ** $Id: nes_pal.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <math.h>
27:                  #include <noftypes.h>
28:                  #include <bitmap.h>
29:                  #include <nes_pal.h>
30:                  
31:                  #ifndef PI
32:                  #define PI 3.1415926535897932384626433832795
33:                  #endif
34:                  
35:                  /* my NES palette, converted to RGB */
36:                  rgb_t shady_palette[] =
37:                  {
38:                     {0x80,0x80,0x80}, {0x00,0x00,0xBB}, {0x37,0x00,0xBF}, {0x84,0x00,0xA6},
39:                     {0xBB,0x00,0x6A}, {0xB7,0x00,0x1E}, {0xB3,0x00,0x00}, {0x91,0x26,0x00},
40:                     {0x7B,0x2B,0x00}, {0x00,0x3E,0x00}, {0x00,0x48,0x0D}, {0x00,0x3C,0x22},
41:                     {0x00,0x2F,0x66}, {0x00,0x00,0x00}, {0x05,0x05,0x05}, {0x05,0x05,0x05},
42:                  
43:                     {0xC8,0xC8,0xC8}, {0x00,0x59,0xFF}, {0x44,0x3C,0xFF}, {0xB7,0x33,0xCC},
44:                     {0xFF,0x33,0xAA}, {0xFF,0x37,0x5E}, {0xFF,0x37,0x1A}, {0xD5,0x4B,0x00},
45:                     {0xC4,0x62,0x00}, {0x3C,0x7B,0x00}, {0x1E,0x84,0x15}, {0x00,0x95,0x66},
46:                     {0x00,0x84,0xC4}, {0x11,0x11,0x11}, {0x09,0x09,0x09}, {0x09,0x09,0x09},
47:                  
48:                     {0xFF,0xFF,0xFF}, {0x00,0x95,0xFF}, {0x6F,0x84,0xFF}, {0xD5,0x6F,0xFF},
49:                     {0xFF,0x77,0xCC}, {0xFF,0x6F,0x99}, {0xFF,0x7B,0x59}, {0xFF,0x91,0x5F},
50:                     {0xFF,0xA2,0x33}, {0xA6,0xBF,0x00}, {0x51,0xD9,0x6A}, {0x4D,0xD5,0xAE},
51:                     {0x00,0xD9,0xFF}, {0x66,0x66,0x66}, {0x0D,0x0D,0x0D}, {0x0D,0x0D,0x0D},
52:                  
53:                     {0xFF,0xFF,0xFF}, {0x84,0xBF,0xFF}, {0xBB,0xBB,0xFF}, {0xD0,0xBB,0xFF},
54:                     {0xFF,0xBF,0xEA}, {0xFF,0xBF,0xCC}, {0xFF,0xC4,0xB7}, {0xFF,0xCC,0xAE},
55:                     {0xFF,0xD9,0xA2}, {0xCC,0xE1,0x99}, {0xAE,0xEE,0xB7}, {0xAA,0xF7,0xEE},
56:                     {0xB3,0xEE,0xFF}, {0xDD,0xDD,0xDD}, {0x11,0x11,0x11}, {0x11,0x11,0x11}
57:                  };
58:                  
59:                  /* dynamic palette building routines,
60:                  ** care of Kevin Horton (khorton@iquest.net)
61:                  */
62:                  
63:                  /* our global palette */
64:                  rgb_t nes_palette[64];
65:                  
66:                  
67:                  static float hue = 334.0f;
68:                  static float tint = 0.4f;
69:                  
70:                  #include <gui.h>
71:                  
72:                  void pal_dechue(void)
73:                  {
9D036B7C  27BDFFE8   ADDIU SP, SP, -24
9D036B80  AFBF0014   SW RA, 20(SP)
74:                     hue -= 0.5f;
9D036B84  8F848028   LW A0, -32728(GP)
9D036B88  3C029D04   LUI V0, -25340
9D036B8C  0F40EA50   JAL __subsf3
9D036B90  8C45FD5C   LW A1, -676(V0)
9D036B94  AF828028   SW V0, -32728(GP)
75:                     gui_sendmsg(GUI_GREEN, "hue: %.02f", hue);
9D036B98  240400C6   ADDIU A0, ZERO, 198
9D036B9C  3C059D04   LUI A1, -25340
9D036BA0  24A5FCB0   ADDIU A1, A1, -848
9D036BA4  0F408633   JAL gui_sendmsg
9D036BA8  00403021   ADDU A2, V0, ZERO
76:                     pal_generate();
9D036BAC  0F40DA2E   JAL pal_generate
9D036BB0  00000000   NOP
77:                  }
9D036BB4  8FBF0014   LW RA, 20(SP)
9D036BB8  03E00008   JR RA
9D036BBC  27BD0018   ADDIU SP, SP, 24
78:                  void pal_inchue(void)
79:                  {
9D036BC0  27BDFFE8   ADDIU SP, SP, -24
9D036BC4  AFBF0014   SW RA, 20(SP)
80:                     hue += 0.5f;
9D036BC8  8F848028   LW A0, -32728(GP)
9D036BCC  3C029D04   LUI V0, -25340
9D036BD0  0F40EA52   JAL fpadd
9D036BD4  8C45FD5C   LW A1, -676(V0)
9D036BD8  AF828028   SW V0, -32728(GP)
81:                     gui_sendmsg(GUI_GREEN, "hue: %.02f", hue);
9D036BDC  240400C6   ADDIU A0, ZERO, 198
9D036BE0  3C059D04   LUI A1, -25340
9D036BE4  24A5FCB0   ADDIU A1, A1, -848
9D036BE8  0F408633   JAL gui_sendmsg
9D036BEC  00403021   ADDU A2, V0, ZERO
82:                     pal_generate();
9D036BF0  0F40DA2E   JAL pal_generate
9D036BF4  00000000   NOP
83:                  }
9D036BF8  8FBF0014   LW RA, 20(SP)
9D036BFC  03E00008   JR RA
9D036C00  27BD0018   ADDIU SP, SP, 24
84:                  void pal_dectint(void)
85:                  {
9D036C04  27BDFFE8   ADDIU SP, SP, -24
9D036C08  AFBF0014   SW RA, 20(SP)
86:                     tint -= 0.01f;
9D036C0C  8F848024   LW A0, -32732(GP)
9D036C10  3C029D04   LUI V0, -25340
9D036C14  0F40EA50   JAL __subsf3
9D036C18  8C45FD60   LW A1, -672(V0)
9D036C1C  AF828024   SW V0, -32732(GP)
87:                     gui_sendmsg(GUI_GREEN, "tint: %.02f", tint);
9D036C20  240400C6   ADDIU A0, ZERO, 198
9D036C24  3C059D04   LUI A1, -25340
9D036C28  24A5FCBC   ADDIU A1, A1, -836
9D036C2C  0F408633   JAL gui_sendmsg
9D036C30  00403021   ADDU A2, V0, ZERO
88:                     pal_generate();
9D036C34  0F40DA2E   JAL pal_generate
9D036C38  00000000   NOP
89:                  }
9D036C3C  8FBF0014   LW RA, 20(SP)
9D036C40  03E00008   JR RA
9D036C44  27BD0018   ADDIU SP, SP, 24
90:                  void pal_inctint(void)
91:                  {
9D036C48  27BDFFE8   ADDIU SP, SP, -24
9D036C4C  AFBF0014   SW RA, 20(SP)
92:                     tint += 0.01f;
9D036C50  8F848024   LW A0, -32732(GP)
9D036C54  3C029D04   LUI V0, -25340
9D036C58  0F40EA52   JAL fpadd
9D036C5C  8C45FD60   LW A1, -672(V0)
9D036C60  AF828024   SW V0, -32732(GP)
93:                     gui_sendmsg(GUI_GREEN, "tint: %.02f", tint);
9D036C64  240400C6   ADDIU A0, ZERO, 198
9D036C68  3C059D04   LUI A1, -25340
9D036C6C  24A5FCBC   ADDIU A1, A1, -836
9D036C70  0F408633   JAL gui_sendmsg
9D036C74  00403021   ADDU A2, V0, ZERO
94:                     pal_generate();
9D036C78  0F40DA2E   JAL pal_generate
9D036C7C  00000000   NOP
95:                  }
9D036C80  8FBF0014   LW RA, 20(SP)
9D036C84  03E00008   JR RA
9D036C88  27BD0018   ADDIU SP, SP, 24
96:                  
97:                  static const float brightness[4][4] = 
98:                  {
99:                     { 0.50f, 0.75f, 1.00f, 1.00f },
100:                    { 0.29f, 0.45f, 0.73f, 0.90f },
101:                    { 0.00f, 0.24f, 0.47f, 0.77f },
102:                    { 0.02f, 0.04f, 0.05f, 0.07f }
103:                 };
104:                 
105:                 static const int col_angles[16] =
106:                 {
107:                    0, 240, 210, 180, 150, 120, 90, 60, 30, 0, 330, 300, 270, 0, 0, 0
108:                 };
109:                 
110:                 void pal_generate(void)
111:                 {
9D0368B8  27BDFFB8   ADDIU SP, SP, -72
9D0368BC  AFBF0044   SW RA, 68(SP)
9D0368C0  AFBE0040   SW FP, 64(SP)
9D0368C4  AFB7003C   SW S7, 60(SP)
9D0368C8  AFB60038   SW S6, 56(SP)
9D0368CC  AFB50034   SW S5, 52(SP)
9D0368D0  AFB40030   SW S4, 48(SP)
9D0368D4  AFB3002C   SW S3, 44(SP)
9D0368D8  AFB20028   SW S2, 40(SP)
9D0368DC  AFB10024   SW S1, 36(SP)
9D0368E0  AFB00020   SW S0, 32(SP)
112:                    int x, z;
113:                    float s, y, theta;
114:                    int r, g, b;
115:                 
116:                    for (x = 0; x < 4; x++)
9D036900  AFA00018   SW ZERO, 24(SP)
9D036904  0B40DAC8   J 0x9D036B20
9D036908  241500FF   ADDIU S5, ZERO, 255
9D036B00  8FBF0018   LW RA, 24(SP)
9D036B04  27F40001   ADDIU S4, RA, 1
9D036B08  AFB40018   SW S4, 24(SP)
9D036B0C  8FB10010   LW S1, 16(SP)
9D036B10  26300004   ADDIU S0, S1, 4
9D036B14  24190004   ADDIU T9, ZERO, 4
9D036B18  1299000C   BEQ S4, T9, 0x9D036B4C
9D036B1C  AFB00010   SW S0, 16(SP)
9D036B20  3C069D04   LUI A2, -25340
9D036B24  24D4FCC8   ADDIU S4, A2, -824
9D036B28  8FA70018   LW A3, 24(SP)
9D036B2C  00078980   SLL S1, A3, 6
9D036B30  00074200   SLL T0, A3, 8
9D036B34  01114823   SUBU T1, T0, S1
9D036B38  3C0AA000   LUI T2, -24576
9D036B3C  254B5F48   ADDIU T3, T2, 24392
9D036B40  01698821   ADDU S1, T3, T1
117:                    {
118:                       for (z = 0; z < 16; z++)
9D036AEC  26100001   ADDIU S0, S0, 1
9D036AF0  26940004   ADDIU S4, S4, 4
9D036AF4  24180010   ADDIU T8, ZERO, 16
9D036AF8  1618FF84   BNE S0, T8, 0x9D03690C
9D036AFC  2631000C   ADDIU S1, S1, 12
119:                       {
120:                          switch (z)
9D03690C  240C000D   ADDIU T4, ZERO, 13
9D036910  120C000E   BEQ S0, T4, 0x9D03694C
9D036914  2A0D000E   SLTI T5, S0, 14
9D036918  11A00005   BEQ T5, ZERO, 0x9D036930
9D03691C  2A0F0010   SLTI T7, S0, 16
9D036920  12000007   BEQ S0, ZERO, 0x9D036940
9D036924  8FAE0010   LW T6, 16(SP)
9D036930  15E0000A   BNE T7, ZERO, 0x9D03695C
9D036934  8FB20010   LW S2, 16(SP)
121:                          {
122:                          case 0:
123:                             /* is color $x0?  If so, get luma */
124:                             s = 0;
125:                             y = brightness[0][x];
9D036940  8DD30000   LW S3, 0(T6)
126:                             break;
9D036944  0B40DA5C   J 0x9D036970
9D036948  00009021   ADDU S2, ZERO, ZERO
127:                 
128:                          case 13:
129:                             /* is color $xD?  If so, get luma */
130:                             s = 0;
131:                             y = brightness[2][x];
9D03694C  8FB60010   LW S6, 16(SP)
9D036950  8ED30020   LW S3, 32(S6)
132:                             break;
9D036954  0B40DA5C   J 0x9D036970
9D036958  00009021   ADDU S2, ZERO, ZERO
133:                 
134:                          case 14:
135:                          case 15:
136:                             /* is color $xE/F?  If so, set to black */
137:                             s = 0;
138:                             y = brightness[3][x];
9D03695C  8E530030   LW S3, 48(S2)
139:                             
140:                             break;
9D036960  0B40DA5C   J 0x9D036970
9D036964  00009021   ADDU S2, ZERO, ZERO
141:                 
142:                          default:
143:                             s = tint;                  /* grab tint */
9D0368E4  8F828024   LW V0, -32732(GP)
9D0368E8  AFA2001C   SW V0, 28(SP)
9D03696C  8FB2001C   LW S2, 28(SP)
144:                             y = brightness[1][x];      /* grab default luminance */
9D036928  0B40DA5A   J 0x9D036968
9D03692C  8FB30010   LW S3, 16(SP)
9D036938  0B40DA5A   J 0x9D036968
9D03693C  8FB30010   LW S3, 16(SP)
9D036968  8E730010   LW S3, 16(S3)
145:                             break;
146:                          }
147:                 
148:                          theta = (float) (PI * ((col_angles[z] + hue) / 180.0));
9D0368EC  8F838028   LW V1, -32728(GP)
9D0368F0  AFA30014   SW V1, 20(SP)
9D0368F4  3C049D04   LUI A0, -25340
9D0368F8  2485FD08   ADDIU A1, A0, -760
9D0368FC  AFA50010   SW A1, 16(SP)
9D036970  0F4105E3   JAL sitofp
9D036974  8E840000   LW A0, 0(S4)
9D036978  00402021   ADDU A0, V0, ZERO
9D03697C  0F40EA52   JAL fpadd
9D036980  8FA50014   LW A1, 20(SP)
9D036984  00402021   ADDU A0, V0, ZERO
9D036988  3C179D04   LUI S7, -25340
9D03698C  26F8FD48   ADDIU T8, S7, -696
9D036990  0F40ED27   JAL __divsf3
9D036994  8F050000   LW A1, 0(T8)
9D036998  00402021   ADDU A0, V0, ZERO
9D03699C  3C199D04   LUI T9, -25340
9D0369A0  273EFD4C   ADDIU FP, T9, -692
9D0369A4  0F40EEB0   JAL __mulsf3
9D0369A8  8FC50000   LW A1, 0(FP)
9D0369AC  0040F021   ADDU FP, V0, ZERO
149:                 
150:                          r = (int) (256.0 * (y + s * sin(theta)));
9D0369B0  0F40F76A   JAL fpsin, sinf
9D0369B4  00402021   ADDU A0, V0, ZERO
9D0369B8  0040B021   ADDU S6, V0, ZERO
9D0369BC  00402021   ADDU A0, V0, ZERO
9D0369C0  0F40EEB0   JAL __mulsf3
9D0369C4  02402821   ADDU A1, S2, ZERO
9D0369C8  00402021   ADDU A0, V0, ZERO
9D0369CC  0F40EA52   JAL fpadd
9D0369D0  02602821   ADDU A1, S3, ZERO
9D0369D4  00402021   ADDU A0, V0, ZERO
9D0369D8  3C029D04   LUI V0, -25340
9D0369DC  2443FD50   ADDIU V1, V0, -688
9D0369E0  0F40EEB0   JAL __mulsf3
9D0369E4  8C650000   LW A1, 0(V1)
9D0369E8  0F41039C   JAL __fixsfsi
9D0369EC  00402021   ADDU A0, V0, ZERO
9D0369F0  0040B821   ADDU S7, V0, ZERO
151:                          g = (int) (256.0 * (y - ((27 / 53.0) * s * sin(theta)) + ((10 / 53.0) * s * cos(theta))));
9D0369F4  0F40F7F7   JAL fpcos, cosf
9D0369F8  03C02021   ADDU A0, FP, ZERO
9D0369FC  0040F021   ADDU FP, V0, ZERO
9D036A00  02402021   ADDU A0, S2, ZERO
9D036A04  3C059D04   LUI A1, -25340
9D036A08  24A6FD54   ADDIU A2, A1, -684
9D036A0C  0F40EEB0   JAL __mulsf3
9D036A10  8CC50000   LW A1, 0(A2)
9D036A14  02C02021   ADDU A0, S6, ZERO
9D036A18  0F40EEB0   JAL __mulsf3
9D036A1C  00402821   ADDU A1, V0, ZERO
9D036A20  02602021   ADDU A0, S3, ZERO
9D036A24  0F40EA50   JAL __subsf3
9D036A28  00402821   ADDU A1, V0, ZERO
9D036A2C  0040B021   ADDU S6, V0, ZERO
9D036A30  02402021   ADDU A0, S2, ZERO
9D036A34  3C079D04   LUI A3, -25340
9D036A38  24E8FD58   ADDIU T0, A3, -680
9D036A3C  0F40EEB0   JAL __mulsf3
9D036A40  8D050000   LW A1, 0(T0)
9D036A44  00402021   ADDU A0, V0, ZERO
9D036A48  0F40EEB0   JAL __mulsf3
9D036A4C  03C02821   ADDU A1, FP, ZERO
9D036A50  02C02021   ADDU A0, S6, ZERO
9D036A54  0F40EA52   JAL fpadd
9D036A58  00402821   ADDU A1, V0, ZERO
9D036A5C  00402021   ADDU A0, V0, ZERO
9D036A60  3C099D04   LUI T1, -25340
9D036A64  252AFD50   ADDIU T2, T1, -688
9D036A68  0F40EEB0   JAL __mulsf3
9D036A6C  8D450000   LW A1, 0(T2)
9D036A70  0F41039C   JAL __fixsfsi
9D036A74  00402021   ADDU A0, V0, ZERO
9D036A78  0040B021   ADDU S6, V0, ZERO
152:                          b = (int) (256.0 * (y - (s * cos(theta))));
9D036A7C  02402021   ADDU A0, S2, ZERO
9D036A80  0F40EEB0   JAL __mulsf3
9D036A84  03C02821   ADDU A1, FP, ZERO
9D036A88  02602021   ADDU A0, S3, ZERO
9D036A8C  0F40EA50   JAL __subsf3
9D036A90  00402821   ADDU A1, V0, ZERO
9D036A94  00402021   ADDU A0, V0, ZERO
9D036A98  3C0B9D04   LUI T3, -25340
9D036A9C  256CFD50   ADDIU T4, T3, -688
9D036AA0  0F40EEB0   JAL __mulsf3
9D036AA4  8D850000   LW A1, 0(T4)
9D036AA8  0F41039C   JAL __fixsfsi
9D036AAC  00402021   ADDU A0, V0, ZERO
9D036AB0  2AE40000   SLTI A0, S7, 0
9D036AB4  0004B80B   MOVN S7, ZERO, A0
9D036AB8  2ACD0000   SLTI T5, S6, 0
9D036ABC  000DB00B   MOVN S6, ZERO, T5
9D036AC0  284E0000   SLTI T6, V0, 0
9D036AC4  000E100B   MOVN V0, ZERO, T6
9D036AC8  2AEF0100   SLTI T7, S7, 256
9D036ACC  02AFB80A   MOVZ S7, S5, T7
153:                 
154:                          if (r > 255)
155:                             r = 255;
156:                          else if (r < 0)
157:                             r = 0;
158:                 
159:                          if (g > 255)
160:                             g = 255;
161:                          else if (g < 0)
162:                             g = 0;
163:                 
164:                          if (b > 255)
165:                             b = 255;
166:                          else if (b < 0)
167:                             b = 0;
168:                 
169:                          nes_palette[(x << 4) + z].r = r;
9D036AD0  AE370000   SW S7, 0(S1)
9D036AD4  2AD30100   SLTI S3, S6, 256
9D036AD8  02B3B00A   MOVZ S6, S5, S3
9D036B44  0B40DA43   J 0x9D03690C
9D036B48  00008021   ADDU S0, ZERO, ZERO
170:                          nes_palette[(x << 4) + z].g = g;
9D036ADC  AE360004   SW S6, 4(S1)
9D036AE0  28520100   SLTI S2, V0, 256
9D036AE4  02B2100A   MOVZ V0, S5, S2
171:                          nes_palette[(x << 4) + z].b = b;
9D036AE8  AE220008   SW V0, 8(S1)
172:                       }
173:                    }   
174:                 }
9D036B4C  8FBF0044   LW RA, 68(SP)
9D036B50  8FBE0040   LW FP, 64(SP)
9D036B54  8FB7003C   LW S7, 60(SP)
9D036B58  8FB60038   LW S6, 56(SP)
9D036B5C  8FB50034   LW S5, 52(SP)
9D036B60  8FB40030   LW S4, 48(SP)
9D036B64  8FB3002C   LW S3, 44(SP)
9D036B68  8FB20028   LW S2, 40(SP)
9D036B6C  8FB10024   LW S1, 36(SP)
9D036B70  8FB00020   LW S0, 32(SP)
9D036B74  03E00008   JR RA
9D036B78  27BD0048   ADDIU SP, SP, 72
175:                 
176:                 /*
177:                 ** $Log: nes_pal.c,v $
178:                 ** Revision 1.2  2001/04/27 14:37:11  neil
179:                 ** wheeee
180:                 **
181:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
182:                 ** initial
183:                 **
184:                 ** Revision 1.3  2000/11/06 02:17:18  matt
185:                 ** no more double->float warnings
186:                 **
187:                 ** Revision 1.2  2000/11/05 16:35:41  matt
188:                 ** rolled rgb.h into bitmap.h
189:                 **
190:                 ** Revision 1.1  2000/10/24 12:20:28  matt
191:                 ** changed directory structure
192:                 **
193:                 ** Revision 1.9  2000/07/17 01:52:28  matt
194:                 ** made sure last line of all source files is a newline
195:                 **
196:                 ** Revision 1.8  2000/07/10 13:49:31  matt
197:                 ** renamed my palette and extern'ed it
198:                 **
199:                 ** Revision 1.7  2000/06/26 04:59:13  matt
200:                 ** selectable tint/hue hack (just for the time being)
201:                 **
202:                 ** Revision 1.6  2000/06/21 21:48:19  matt
203:                 ** changed range multiplier from 255.0 to 256.0
204:                 **
205:                 ** Revision 1.5  2000/06/20 20:42:47  matt
206:                 ** accuracy changes
207:                 **
208:                 ** Revision 1.4  2000/06/09 15:12:26  matt
209:                 ** initial revision
210:                 **
211:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/nes/nes_mmc.c  -----------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** nes_mmc.c
21:                  **
22:                  ** NES Memory Management Controller (mapper) emulation
23:                  ** $Id: nes_mmc.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <string.h>
27:                  #include <noftypes.h>
28:                  #include "nes6502.h"
29:                  #include <nes_mmc.h>
30:                  #include <nes_ppu.h>
31:                  #include <libsnss.h>
32:                  #include <log.h>
33:                  #include <mmclist.h>
34:                  #include <nes_rom.h>
35:                  
36:                  #define  MMC_8KROM         (mmc.cart->rom_banks * 2)
37:                  #define  MMC_16KROM        (mmc.cart->rom_banks)
38:                  #define  MMC_32KROM        (mmc.cart->rom_banks / 2)
39:                  #define  MMC_8KVROM        (mmc.cart->vrom_banks)
40:                  #define  MMC_4KVROM        (mmc.cart->vrom_banks * 2)
41:                  #define  MMC_2KVROM        (mmc.cart->vrom_banks * 4)
42:                  #define  MMC_1KVROM        (mmc.cart->vrom_banks * 8)
43:                  
44:                  #define  MMC_LAST8KROM     (MMC_8KROM - 1)
45:                  #define  MMC_LAST16KROM    (MMC_16KROM - 1)
46:                  #define  MMC_LAST32KROM    (MMC_32KROM - 1)
47:                  #define  MMC_LAST8KVROM    (MMC_8KVROM - 1)
48:                  #define  MMC_LAST4KVROM    (MMC_4KVROM - 1)
49:                  #define  MMC_LAST2KVROM    (MMC_2KVROM - 1)
50:                  #define  MMC_LAST1KVROM    (MMC_1KVROM - 1)
51:                  
52:                  static mmc_t mmc;
53:                  
54:                  rominfo_t *mmc_getinfo(void)
55:                  {
56:                     return mmc.cart;
57:                  }
9D032828  03E00008   JR RA
9D03282C  8F8280C0   LW V0, -32576(GP)
58:                  
59:                  void mmc_setcontext(mmc_t *src_mmc)
60:                  {
61:                     ASSERT(src_mmc);
62:                  
63:                     mmc = *src_mmc;
9D032830  8C830000   LW V1, 0(A0)
9D032834  8C820004   LW V0, 4(A0)
9D032838  AF8380BC   SW V1, -32580(GP)
9D03283C  03E00008   JR RA
9D032840  AF8280C0   SW V0, -32576(GP)
64:                  }
65:                  
66:                  void mmc_getcontext(mmc_t *dest_mmc)
67:                  {
68:                     *dest_mmc = mmc;
9D032844  8F8280BC   LW V0, -32580(GP)
9D032848  AC820000   SW V0, 0(A0)
9D03284C  8F8380C0   LW V1, -32576(GP)
9D032850  03E00008   JR RA
9D032854  AC830004   SW V1, 4(A0)
69:                  }
70:                  
71:                  /* VROM bankswitching */
72:                  void mmc_bankvrom(int size, uint32 address, int bank)
73:                  {
9D032858  27BDFFE8   ADDIU SP, SP, -24
9D03285C  AFBF0014   SW RA, 20(SP)
9D032860  00801021   ADDU V0, A0, ZERO
74:                     if (0 == mmc.cart->vrom_banks)
9D032864  8F8480C0   LW A0, -32576(GP)
9D032868  8C830014   LW V1, 20(A0)
9D03286C  10600052   BEQ V1, ZERO, .LVL25
9D032870  24070002   ADDIU A3, ZERO, 2
75:                        return;
76:                  
77:                     switch (size)
9D032874  1047001F   BEQ V0, A3, 0x9D0328F4
9D032878  28480003   SLTI T0, V0, 3
9D03287C  11000006   BEQ T0, ZERO, 0x9D032898
9D032880  24180004   ADDIU T8, ZERO, 4
9D032884  24090001   ADDIU T1, ZERO, 1
9D032888  1049000A   BEQ V0, T1, 0x9D0328B4
9D03288C  240AFFFF   ADDIU T2, ZERO, -1
9D032898  10580027   BEQ V0, T8, 0x9D032938
9D03289C  2409FFFF   ADDIU T1, ZERO, -1
9D0328A0  24050008   ADDIU A1, ZERO, 8
9D0328A4  10450034   BEQ V0, A1, 0x9D032978
9D0328A8  247FFFFF   ADDIU RA, V1, -1
78:                     {
79:                     case 1:
80:                        if (bank == MMC_LASTBANK)
9D0328B4  14CA0003   BNE A2, T2, 0x9D0328C4
9D0328B8  000358C0   SLL T3, V1, 3
81:                           bank = MMC_LAST1KVROM;
9D0328BC  000330C0   SLL A2, V1, 3
9D0328C0  24C6FFFF   ADDIU A2, A2, -1
82:                        ppu_setpage(1, address >> 10, &mmc.cart->vrom[(bank % MMC_1KVROM) << 10] - address);
9D0328C4  00CB001A   DIV A2, T3
9D0328C8  016001F4   TEQ T3, ZERO
9D0328CC  00006010   MFHI T4
9D0328D0  000C6A80   SLL T5, T4, 10
9D0328D4  01A57023   SUBU T6, T5, A1
9D0328D8  8C8F0004   LW T7, 4(A0)
9D0328DC  24040001   ADDIU A0, ZERO, 1
9D0328E0  00052A82   SRL A1, A1, 10
9D0328E4  0F4058B3   JAL ppu_setpage
9D0328E8  01EE3021   ADDU A2, T7, T6
83:                        break;
9D0328EC  0B40CA6F   J 0x9D0329BC
9D0328F0  8FBF0014   LW RA, 20(SP)
84:                  
85:                     case 2:
86:                        if (bank == MMC_LASTBANK)
9D0328F4  240FFFFF   ADDIU T7, ZERO, -1
9D0328F8  14CF0003   BNE A2, T7, 0x9D032908
9D0328FC  0003C880   SLL T9, V1, 2
87:                           bank = MMC_LAST2KVROM;
9D032900  0003C080   SLL T8, V1, 2
9D032904  2706FFFF   ADDIU A2, T8, -1
88:                        ppu_setpage(2, address >> 10, &mmc.cart->vrom[(bank % MMC_2KVROM) << 11] - address);
9D032908  00D9001A   DIV A2, T9
9D03290C  032001F4   TEQ T9, ZERO
9D032910  0000F810   MFHI RA
9D032914  001F12C0   SLL V0, RA, 11
9D032918  00451823   SUBU V1, V0, A1
9D03291C  8C870004   LW A3, 4(A0)
9D032920  24040002   ADDIU A0, ZERO, 2
9D032924  00052A82   SRL A1, A1, 10
9D032928  0F4058B3   JAL ppu_setpage
9D03292C  00E33021   ADDU A2, A3, V1
89:                        break;
9D032930  0B40CA6F   J 0x9D0329BC
9D032934  8FBF0014   LW RA, 20(SP)
90:                  
91:                     case 4:
92:                        if (bank == MMC_LASTBANK)
9D032938  14C90003   BNE A2, T1, 0x9D032948
9D03293C  00035840   SLL T3, V1, 1
93:                           bank = MMC_LAST4KVROM;
9D032940  00035040   SLL T2, V1, 1
9D032944  2546FFFF   ADDIU A2, T2, -1
94:                        ppu_setpage(4, address >> 10, &mmc.cart->vrom[(bank % MMC_4KVROM) << 12] - address);
9D032948  00CB001A   DIV A2, T3
9D03294C  016001F4   TEQ T3, ZERO
9D032950  00003010   MFHI A2
9D032954  00066300   SLL T4, A2, 12
9D032958  01856823   SUBU T5, T4, A1
9D03295C  8C8E0004   LW T6, 4(A0)
9D032960  24040004   ADDIU A0, ZERO, 4
9D032964  00052A82   SRL A1, A1, 10
9D032968  0F4058B3   JAL ppu_setpage
9D03296C  01CD3021   ADDU A2, T6, T5
95:                        break;
9D032970  0B40CA6F   J 0x9D0329BC
9D032974  8FBF0014   LW RA, 20(SP)
96:                  
97:                     case 8:
98:                        if (bank == MMC_LASTBANK)
99:                           bank = MMC_LAST8KVROM;
9D032978  00061027   NOR V0, ZERO, A2
9D03297C  03E2300A   MOVZ A2, RA, V0
100:                       ppu_setpage(8, 0, &mmc.cart->vrom[(bank % MMC_8KVROM) << 13]);
9D032980  00C3001A   DIV A2, V1
9D032984  006001F4   TEQ V1, ZERO
9D032988  00001810   MFHI V1
9D03298C  00033B40   SLL A3, V1, 13
9D032990  8C880004   LW T0, 4(A0)
9D032994  24040008   ADDIU A0, ZERO, 8
9D032998  00002821   ADDU A1, ZERO, ZERO
9D03299C  0F4058B3   JAL ppu_setpage
9D0329A0  01073021   ADDU A2, T0, A3
101:                       break;
9D0329A4  0B40CA6F   J 0x9D0329BC
9D0329A8  8FBF0014   LW RA, 20(SP)
102:                 
103:                    default:
104:                       log_printf("invalid VROM bank size %d\n", size);
9D032890  0B40CA6B   J 0x9D0329AC
9D032894  3C199D04   LUI T9, -25340
9D0328AC  0B40CA6B   J 0x9D0329AC
9D0328B0  3C199D04   LUI T9, -25340
9D0329AC  27240BE4   ADDIU A0, T9, 3044
9D0329B0  0F410817   JAL log_printf
9D0329B4  00402821   ADDU A1, V0, ZERO
105:                    }
106:                 }
9D0329B8  8FBF0014   LW RA, 20(SP)
9D0329BC  03E00008   JR RA
9D0329C0  27BD0018   ADDIU SP, SP, 24
107:                 
108:                 /* ROM bankswitching */
109:                 void mmc_bankrom(int size, uint32 address, int bank)
110:                 {
9D0329C4  27BDFF80   ADDIU SP, SP, -128
9D0329C8  AFBF007C   SW RA, 124(SP)
9D0329CC  AFB20078   SW S2, 120(SP)
9D0329D0  AFB10074   SW S1, 116(SP)
9D0329D4  AFB00070   SW S0, 112(SP)
9D0329D8  00808821   ADDU S1, A0, ZERO
9D0329DC  00A09021   ADDU S2, A1, ZERO
9D0329E0  00C08021   ADDU S0, A2, ZERO
111:                    nes6502_context mmc_cpu;
112:                 
113:                    nes6502_getcontext(&mmc_cpu); 
9D0329E4  0F403159   JAL nes6502_getcontext
9D0329E8  27A40010   ADDIU A0, SP, 16
114:                 
115:                    switch (size)
9D0329EC  24020010   ADDIU V0, ZERO, 16
9D0329F0  1222001F   BEQ S1, V0, 0x9D032A70
9D0329F4  24030020   ADDIU V1, ZERO, 32
9D0329F8  12230042   BEQ S1, V1, 0x9D032B04
9D0329FC  24040008   ADDIU A0, ZERO, 8
9D032A00  16240063   BNE S1, A0, 0x9D032B90
9D032A04  3C059D04   LUI A1, -25340
116:                    {
117:                    case 8:
118:                       if (bank == MMC_LASTBANK)
9D032A08  2406FFFF   ADDIU A2, ZERO, -1
9D032A0C  16060005   BNE S0, A2, .LBB2
9D032A10  00124B02   SRL T1, S2, 12
119:                          bank = MMC_LAST8KROM;
9D032A14  8F8780C0   LW A3, -32576(GP)
9D032A18  8CF00010   LW S0, 16(A3)
9D032A1C  00104040   SLL T0, S0, 1
9D032A20  2510FFFF   ADDIU S0, T0, -1
120:                       {
121:                          int page = address >> NES6502_BANKSHIFT;
122:                          mmc_cpu.mem_page[page] = &mmc.cart->rom[(bank % MMC_8KROM) << 13];
9D032A24  8F8A80C0   LW T2, -32576(GP)
9D032A28  8D4B0010   LW T3, 16(T2)
9D032A2C  000B6040   SLL T4, T3, 1
9D032A30  020C001A   DIV S0, T4
9D032A34  018001F4   TEQ T4, ZERO
9D032A38  00006810   MFHI T5
9D032A3C  000D7340   SLL T6, T5, 13
9D032A40  8D4F0000   LW T7, 0(T2)
9D032A44  01EEC021   ADDU T8, T7, T6
9D032A48  0009C880   SLL T9, T1, 2
9D032A4C  27BF0010   ADDIU RA, SP, 16
9D032A50  03F98821   ADDU S1, RA, T9
9D032A54  AE380000   SW T8, 0(S1)
123:                          mmc_cpu.mem_page[page + 1] = mmc_cpu.mem_page[page] + 0x1000;
9D032A58  25320001   ADDIU S2, T1, 1
9D032A5C  00121080   SLL V0, S2, 2
9D032A60  03E21821   ADDU V1, RA, V0
9D032A64  27041000   ADDIU A0, T8, 4096
124:                       }
125:                 
126:                       break;
9D032A68  0B40CAE7   J .LVL45
9D032A6C  AC640000   SW A0, 0(V1)
127:                 
128:                    case 16:
129:                       if (bank == MMC_LASTBANK)
9D032A70  2407FFFF   ADDIU A3, ZERO, -1
9D032A74  16070004   BNE S0, A3, .LBB3
9D032A78  00124302   SRL T0, S2, 12
130:                          bank = MMC_LAST16KROM;
9D032A7C  8F9180C0   LW S1, -32576(GP)
9D032A80  8E220010   LW V0, 16(S1)
9D032A84  2450FFFF   ADDIU S0, V0, -1
131:                       {
132:                          int page = address >> NES6502_BANKSHIFT;
133:                          mmc_cpu.mem_page[page] = &mmc.cart->rom[(bank % MMC_16KROM) << 14];
9D032A88  8F8980C0   LW T1, -32576(GP)
9D032A8C  8D2A0010   LW T2, 16(T1)
9D032A90  020A001A   DIV S0, T2
9D032A94  014001F4   TEQ T2, ZERO
9D032A98  00008010   MFHI S0
9D032A9C  00101B80   SLL V1, S0, 14
9D032AA0  8D240000   LW A0, 0(T1)
9D032AA4  00835821   ADDU T3, A0, V1
9D032AA8  00086080   SLL T4, T0, 2
9D032AAC  27AD0010   ADDIU T5, SP, 16
9D032AB0  01AC7021   ADDU T6, T5, T4
9D032AB4  ADCB0000   SW T3, 0(T6)
134:                          mmc_cpu.mem_page[page + 1] = mmc_cpu.mem_page[page] + 0x1000;
9D032AB8  250F0001   ADDIU T7, T0, 1
9D032ABC  000FC080   SLL T8, T7, 2
9D032AC0  01B8C821   ADDU T9, T5, T8
9D032AC4  257F1000   ADDIU RA, T3, 4096
9D032AC8  AF3F0000   SW RA, 0(T9)
135:                          mmc_cpu.mem_page[page + 2] = mmc_cpu.mem_page[page] + 0x2000;
9D032ACC  25120002   ADDIU S2, T0, 2
9D032AD0  00122880   SLL A1, S2, 2
9D032AD4  01A53021   ADDU A2, T5, A1
9D032AD8  8DC70000   LW A3, 0(T6)
9D032ADC  24F12000   ADDIU S1, A3, 8192
9D032AE0  ACD10000   SW S1, 0(A2)
136:                          mmc_cpu.mem_page[page + 3] = mmc_cpu.mem_page[page] + 0x3000;
9D032AE4  25020003   ADDIU V0, T0, 3
9D032AE8  00024080   SLL T0, V0, 2
9D032AEC  27A90010   ADDIU T1, SP, 16
9D032AF0  01285021   ADDU T2, T1, T0
9D032AF4  8DD00000   LW S0, 0(T6)
9D032AF8  26033000   ADDIU V1, S0, 12288
137:                       }
138:                       break;
9D032AFC  0B40CAE7   J .LVL45
9D032B00  AD430000   SW V1, 0(T2)
139:                 
140:                    case 32:
141:                       if (bank == MMC_LASTBANK)
9D032B04  2405FFFF   ADDIU A1, ZERO, -1
9D032B08  16050007   BNE S0, A1, 0x9D032B28
9D032B0C  8F8880C0   LW T0, -32576(GP)
142:                          bank = MMC_LAST32KROM;
9D032B10  8F8680C0   LW A2, -32576(GP)
9D032B14  8CC70010   LW A3, 16(A2)
9D032B18  000787C2   SRL S0, A3, 31
9D032B1C  02078821   ADDU S1, S0, A3
9D032B20  00111043   SRA V0, S1, 1
9D032B24  2450FFFF   ADDIU S0, V0, -1
143:                 
144:                       mmc_cpu.mem_page[8] = &mmc.cart->rom[(bank % MMC_32KROM) << 15];
9D032B28  8D090010   LW T1, 16(T0)
9D032B2C  000957C2   SRL T2, T1, 31
9D032B30  01491821   ADDU V1, T2, T1
9D032B34  00032043   SRA A0, V1, 1
9D032B38  0204001A   DIV S0, A0
9D032B3C  008001F4   TEQ A0, ZERO
9D032B40  00005810   MFHI T3
9D032B44  000B63C0   SLL T4, T3, 15
9D032B48  8D0D0000   LW T5, 0(T0)
9D032B4C  01AC7021   ADDU T6, T5, T4
9D032B50  AFAE0030   SW T6, 48(SP)
145:                       mmc_cpu.mem_page[9] = mmc_cpu.mem_page[8] + 0x1000;
9D032B54  25CF1000   ADDIU T7, T6, 4096
9D032B58  AFAF0034   SW T7, 52(SP)
146:                       mmc_cpu.mem_page[10] = mmc_cpu.mem_page[8] + 0x2000;
9D032B5C  25D82000   ADDIU T8, T6, 8192
9D032B60  AFB80038   SW T8, 56(SP)
147:                       mmc_cpu.mem_page[11] = mmc_cpu.mem_page[8] + 0x3000;
9D032B64  25D93000   ADDIU T9, T6, 12288
9D032B68  AFB9003C   SW T9, 60(SP)
148:                       mmc_cpu.mem_page[12] = mmc_cpu.mem_page[8] + 0x4000;
9D032B6C  25DF4000   ADDIU RA, T6, 16384
9D032B70  AFBF0040   SW RA, 64(SP)
149:                       mmc_cpu.mem_page[13] = mmc_cpu.mem_page[8] + 0x5000;
9D032B74  25D25000   ADDIU S2, T6, 20480
9D032B78  AFB20044   SW S2, 68(SP)
150:                       mmc_cpu.mem_page[14] = mmc_cpu.mem_page[8] + 0x6000;
9D032B7C  25C56000   ADDIU A1, T6, 24576
9D032B80  AFA50048   SW A1, 72(SP)
151:                       mmc_cpu.mem_page[15] = mmc_cpu.mem_page[8] + 0x7000;
9D032B84  25C67000   ADDIU A2, T6, 28672
152:                       break;
9D032B88  0B40CAE7   J .LVL45
9D032B8C  AFA6004C   SW A2, 76(SP)
153:                 
154:                    default:
155:                       log_printf("invalid ROM bank size %d\n", size);
9D032B90  24A40C00   ADDIU A0, A1, 3072
9D032B94  0F410817   JAL log_printf
9D032B98  02202821   ADDU A1, S1, ZERO
156:                       break;
157:                    }
158:                 
159:                    nes6502_setcontext(&mmc_cpu);
9D032B9C  0F4030B1   JAL nes6502_setcontext
9D032BA0  27A40010   ADDIU A0, SP, 16
160:                 }
9D032BA4  8FBF007C   LW RA, 124(SP)
9D032BA8  8FB20078   LW S2, 120(SP)
9D032BAC  8FB10074   LW S1, 116(SP)
9D032BB0  8FB00070   LW S0, 112(SP)
9D032BB4  03E00008   JR RA
9D032BB8  27BD0080   ADDIU SP, SP, 128
161:                 
162:                 /* Check to see if this mapper is supported */
163:                 bool mmc_peek(int map_num)
164:                 {
165:                    mapintf_t **map_ptr = mappers;
9D032BD8  0B40CAFA   J 0x9D032BE8
9D032BDC  24C749E8   ADDIU A3, A2, 18920
166:                 
167:                    while (NULL != *map_ptr)
9D032BBC  3C02A001   LUI V0, -24575
9D032BC0  8C4349E8   LW V1, 18920(V0)
9D032BC4  1060000E   BEQ V1, ZERO, 0x9D032C00
9D032BC8  00000000   NOP
9D032BEC  8CE80000   LW T0, 0(A3)
9D032BF0  5500FFFB   BNEL T0, ZERO, 0x9D032BE0
9D032BF4  8D090000   LW T1, 0(T0)
9D032BF8  03E00008   JR RA
9D032BFC  00001021   ADDU V0, ZERO, ZERO
168:                    {
169:                       if ((*map_ptr)->number == map_num)
9D032BCC  8C650000   LW A1, 0(V1)
9D032BD0  10A4000D   BEQ A1, A0, 0x9D032C08
9D032BD4  3C06A001   LUI A2, -24575
9D032BE0  1124000B   BEQ T1, A0, 0x9D032C10
9D032BE4  00000000   NOP
170:                          return true;
9D032C08  03E00008   JR RA
9D032C0C  24020001   ADDIU V0, ZERO, 1
171:                       map_ptr++;
9D032BE8  24E70004   ADDIU A3, A3, 4
172:                    }
173:                 
174:                    return false;
9D032C00  03E00008   JR RA
9D032C04  00001021   ADDU V0, ZERO, ZERO
175:                 }
9D032C10  03E00008   JR RA
9D032C14  24020001   ADDIU V0, ZERO, 1
176:                 
177:                 static void mmc_setpages(void)
178:                 {
179:                    log_printf("setting up mapper %d\n", mmc.intf->number);
9D032C20  3C049D04   LUI A0, -25340
9D032C24  24840C1C   ADDIU A0, A0, 3100
9D032C28  8F8280BC   LW V0, -32580(GP)
9D032C2C  0F410817   JAL log_printf
9D032C30  8C450000   LW A1, 0(V0)
180:                 
181:                    /* Switch ROM into CPU space, set VROM/VRAM (done for ALL ROMs) */
182:                    mmc_bankrom(16, 0x8000, 0);
9D032C34  24040010   ADDIU A0, ZERO, 16
9D032C38  34058000   ORI A1, ZERO, -32768
9D032C3C  0F40CA71   JAL mmc_bankrom
9D032C40  00003021   ADDU A2, ZERO, ZERO
183:                    mmc_bankrom(16, 0xC000, MMC_LASTBANK);
9D032C44  24040010   ADDIU A0, ZERO, 16
9D032C48  3405C000   ORI A1, ZERO, -16384
9D032C4C  0F40CA71   JAL mmc_bankrom
9D032C50  2406FFFF   ADDIU A2, ZERO, -1
184:                    mmc_bankvrom(8, 0x0000, 0);
9D032C54  24040008   ADDIU A0, ZERO, 8
9D032C58  00002821   ADDU A1, ZERO, ZERO
9D032C5C  0F40CA16   JAL mmc_bankvrom
9D032C60  00003021   ADDU A2, ZERO, ZERO
185:                 
186:                    if (mmc.cart->flags & ROM_FLAG_FOURSCREEN)
9D032C64  8F8580C0   LW A1, -32576(GP)
9D032C68  90A30028   LBU V1, 40(A1)
9D032C6C  30660004   ANDI A2, V1, 4
9D032C70  30C700FF   ANDI A3, A2, 255
9D032C74  50E00008   BEQL A3, ZERO, 0x9D032C98
9D032C78  8CA80024   LW T0, 36(A1)
187:                    {
188:                       ppu_mirror(0, 1, 2, 3);
9D032C7C  00002021   ADDU A0, ZERO, ZERO
9D032C80  24050001   ADDIU A1, ZERO, 1
9D032C84  24060002   ADDIU A2, ZERO, 2
9D032C88  0F4058FD   JAL ppu_mirror
9D032C8C  24070003   ADDIU A3, ZERO, 3
189:                    }
190:                    else
191:                    {
192:                       if (MIRROR_VERT == mmc.cart->mirror)
9D032C98  24090001   ADDIU T1, ZERO, 1
9D032C9C  15090007   BNE T0, T1, 0x9D032CBC
9D032CA0  00002021   ADDU A0, ZERO, ZERO
193:                          ppu_mirror(0, 1, 0, 1);
9D032CA4  24050001   ADDIU A1, ZERO, 1
9D032CA8  00003021   ADDU A2, ZERO, ZERO
9D032CAC  0F4058FD   JAL ppu_mirror
9D032CB0  24070001   ADDIU A3, ZERO, 1
194:                       else
195:                          ppu_mirror(0, 0, 1, 1);
9D032CBC  00002821   ADDU A1, ZERO, ZERO
9D032CC0  24060001   ADDIU A2, ZERO, 1
9D032CC4  0F4058FD   JAL ppu_mirror
9D032CC8  24070001   ADDIU A3, ZERO, 1
196:                    }
197:                 
198:                    /* if we have no VROM, switch in VRAM */
199:                    /* TODO: fix this hack implementation */
200:                    if (0 == mmc.cart->vrom_banks)
9D032C90  0B40CB34   J 0x9D032CD0
9D032C94  8F8A80C0   LW T2, -32576(GP)
9D032CB4  0B40CB34   J 0x9D032CD0
9D032CB8  8F8A80C0   LW T2, -32576(GP)
9D032CCC  8F8A80C0   LW T2, -32576(GP)
9D032CD0  8D4B0014   LW T3, 20(T2)
9D032CD4  15600006   BNE T3, ZERO, .LVL61
9D032CD8  24040008   ADDIU A0, ZERO, 8
201:                    {
202:                       ASSERT(mmc.cart->vram);
203:                 
204:                       ppu_setpage(8, 0, mmc.cart->vram);
9D032CDC  00002821   ADDU A1, ZERO, ZERO
9D032CE0  0F4058B3   JAL ppu_setpage
9D032CE4  8D46000C   LW A2, 12(T2)
205:                       ppu_mirrorhipages();
9D032CE8  0F4058EE   JAL ppu_mirrorhipages
9D032CEC  00000000   NOP
206:                    }
207:                 }
208:                 
209:                 /* Mapper initialization routine */
210:                 void mmc_reset(void)
211:                 {
9D032C18  27BDFFE8   ADDIU SP, SP, -24
9D032C1C  AFBF0014   SW RA, 20(SP)
212:                    mmc_setpages();
213:                 
214:                    ppu_setlatchfunc(NULL);
9D032CF0  0F405C7D   JAL ppu_setlatchfunc
9D032CF4  00002021   ADDU A0, ZERO, ZERO
215:                    ppu_setvromswitch(NULL);
9D032CF8  0F405C80   JAL ppu_setvromswitch
9D032CFC  00002021   ADDU A0, ZERO, ZERO
216:                 
217:                    if (mmc.intf->init)
9D032D00  8F8C80BC   LW T4, -32580(GP)
9D032D04  8D8D0008   LW T5, 8(T4)
9D032D08  11A00004   BEQ T5, ZERO, 0x9D032D1C
9D032D0C  3C0E9D04   LUI T6, -25340
218:                       mmc.intf->init();
9D032D10  01A0F809   JALR T5
9D032D14  00000000   NOP
219:                 
220:                    log_printf("reset memory mapper\n");
9D032D18  3C0E9D04   LUI T6, -25340
9D032D1C  0F410817   JAL log_printf
9D032D20  25C40C34   ADDIU A0, T6, 3124
221:                 }
9D032D24  8FBF0014   LW RA, 20(SP)
9D032D28  03E00008   JR RA
9D032D2C  27BD0018   ADDIU SP, SP, 24
222:                 
223:                 
224:                 void mmc_destroy(mmc_t **nes_mmc)
225:                 {
9D032D3C  27BDFFE8   ADDIU SP, SP, -24
9D032D40  AFBF0014   SW RA, 20(SP)
226:                    if (*nes_mmc)
9D032D30  8C820000   LW V0, 0(A0)
9D032D34  10400007   BEQ V0, ZERO, 0x9D032D54
9D032D38  00000000   NOP
227:                       free(*nes_mmc);
9D032D44  0F40F31D   JAL _my_free
9D032D48  00000000   NOP
228:                 }
9D032D4C  8FBF0014   LW RA, 20(SP)
9D032D50  27BD0018   ADDIU SP, SP, 24
9D032D54  03E00008   JR RA
9D032D58  00000000   NOP
229:                 
230:                 mmc_t *mmc_create(rominfo_t *rominfo)
231:                 {
9D032D5C  27BDFFE0   ADDIU SP, SP, -32
9D032D60  AFBF001C   SW RA, 28(SP)
9D032D64  AFB20018   SW S2, 24(SP)
9D032D68  AFB10014   SW S1, 20(SP)
9D032D6C  AFB00010   SW S0, 16(SP)
9D032D70  00809021   ADDU S2, A0, ZERO
232:                    mmc_t *temp;
233:                    mapintf_t **map_ptr;
234:                   
235:                    for (map_ptr = mappers; (*map_ptr)->number != rominfo->mapper_number; map_ptr++)
9D032D74  3C02A001   LUI V0, -24575
9D032D78  8C4449E8   LW A0, 18920(V0)
9D032D7C  8E4B0020   LW T3, 32(S2)
9D032D80  8C830000   LW V1, 0(A0)
9D032D84  506B000E   BEQL V1, T3, 0x9D032DC0
9D032D88  3C10A001   LUI S0, -24575
9D032D94  0B40CB69   J 0x9D032DA4
9D032D98  24D049E8   ADDIU S0, A2, 18920
9D032DA4  26100004   ADDIU S0, S0, 4
9D032DA8  8E070000   LW A3, 0(S0)
9D032DAC  8CE80000   LW T0, 0(A3)
9D032DB0  150BFFFA   BNE T0, T3, 0x9D032D9C
9D032DB4  00000000   NOP
9D032DB8  0B40CB71   J 0x9D032DC4
9D032DBC  00000000   NOP
9D032DC0  261049E8   ADDIU S0, S0, 18920
236:                    {
237:                       if (NULL == *map_ptr)
9D032D8C  10800025   BEQ A0, ZERO, 0x9D032E24
9D032D90  3C06A001   LUI A2, -24575
9D032D9C  10E00023   BEQ A3, ZERO, 0x9D032E2C
9D032DA0  00001021   ADDU V0, ZERO, ZERO
238:                          return NULL; /* Should *never* happen */
9D032E24  0B40CB8B   J 0x9D032E2C
9D032E28  00001021   ADDU V0, ZERO, ZERO
239:                    }
240:                 
241:                    temp = malloc(sizeof(mmc_t));
9D032DC4  0F40F30A   JAL _my_malloc
9D032DC8  24040008   ADDIU A0, ZERO, 8
242:                    if (NULL == temp)
9D032DCC  10400017   BEQ V0, ZERO, 0x9D032E2C
9D032DD0  00408821   ADDU S1, V0, ZERO
243:                       return NULL;
244:                 
245:                    memset(temp, 0, sizeof(mmc_t));
9D032DD4  A0400000   SB ZERO, 0(V0)
9D032DD8  A0400001   SB ZERO, 1(V0)
9D032DDC  A0400002   SB ZERO, 2(V0)
9D032DE0  A0400003   SB ZERO, 3(V0)
9D032DE4  A0400004   SB ZERO, 4(V0)
9D032DE8  A0400005   SB ZERO, 5(V0)
9D032DEC  A0400006   SB ZERO, 6(V0)
9D032DF0  A0400007   SB ZERO, 7(V0)
246:                 
247:                    temp->intf = *map_ptr;
9D032DF4  8E050000   LW A1, 0(S0)
9D032DF8  AC450000   SW A1, 0(V0)
248:                    temp->cart = rominfo;
9D032DFC  AC520004   SW S2, 4(V0)
249:                 
250:                    mmc_setcontext(temp);
9D032E00  0F40CA0C   JAL mmc_setcontext
9D032E04  00402021   ADDU A0, V0, ZERO
251:                 
252:                    log_printf("created memory mapper: %s\n", (*map_ptr)->name);
9D032E08  8E090000   LW T1, 0(S0)
9D032E0C  3C0A9D04   LUI T2, -25340
9D032E10  25440C4C   ADDIU A0, T2, 3148
9D032E14  0F410817   JAL log_printf
9D032E18  8D250004   LW A1, 4(T1)
253:                 
254:                    return temp;
9D032E1C  0B40CB8B   J 0x9D032E2C
9D032E20  02201021   ADDU V0, S1, ZERO
255:                 }
9D032E2C  8FBF001C   LW RA, 28(SP)
9D032E30  8FB20018   LW S2, 24(SP)
9D032E34  8FB10014   LW S1, 20(SP)
9D032E38  8FB00010   LW S0, 16(SP)
9D032E3C  03E00008   JR RA
9D032E40  27BD0020   ADDIU SP, SP, 32
256:                 
257:                 
258:                 /*
259:                 ** $Log: nes_mmc.c,v $
260:                 ** Revision 1.2  2001/04/27 14:37:11  neil
261:                 ** wheeee
262:                 **
263:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
264:                 ** initial
265:                 **
266:                 ** Revision 1.4  2000/11/21 13:28:40  matt
267:                 ** take care to zero allocated mem
268:                 **
269:                 ** Revision 1.3  2000/10/27 12:55:58  matt
270:                 ** nes6502 now uses 4kB banks across the boards
271:                 **
272:                 ** Revision 1.2  2000/10/25 00:23:16  matt
273:                 ** makefiles updated for new directory structure
274:                 **
275:                 ** Revision 1.1  2000/10/24 12:20:28  matt
276:                 ** changed directory structure
277:                 **
278:                 ** Revision 1.28  2000/10/22 19:17:24  matt
279:                 ** mapper cleanups galore
280:                 **
281:                 ** Revision 1.27  2000/10/22 15:02:32  matt
282:                 ** simplified mirroring
283:                 **
284:                 ** Revision 1.26  2000/10/21 19:38:56  matt
285:                 ** that two year old crap code *was* flushed
286:                 **
287:                 ** Revision 1.25  2000/10/21 19:26:59  matt
288:                 ** many more cleanups
289:                 **
290:                 ** Revision 1.24  2000/10/17 03:22:57  matt
291:                 ** cleaning up rom module
292:                 **
293:                 ** Revision 1.23  2000/10/10 13:58:15  matt
294:                 ** stroustrup squeezing his way in the door
295:                 **
296:                 ** Revision 1.22  2000/08/16 02:51:55  matt
297:                 ** random cleanups
298:                 **
299:                 ** Revision 1.21  2000/07/31 04:27:59  matt
300:                 ** one million cleanups
301:                 **
302:                 ** Revision 1.20  2000/07/25 02:25:53  matt
303:                 ** safer xxx_destroy calls
304:                 **
305:                 ** Revision 1.19  2000/07/23 15:11:45  matt
306:                 ** removed unused variables
307:                 **
308:                 ** Revision 1.18  2000/07/15 23:50:03  matt
309:                 ** migrated state get/set from nes_mmc.c to state.c
310:                 **
311:                 ** Revision 1.17  2000/07/11 03:15:09  melanson
312:                 ** Added support for mappers 16, 34, and 231
313:                 **
314:                 ** Revision 1.16  2000/07/10 05:27:41  matt
315:                 ** cleaned up mapper-specific callbacks
316:                 **
317:                 ** Revision 1.15  2000/07/10 03:02:49  matt
318:                 ** minor change on loading state
319:                 **
320:                 ** Revision 1.14  2000/07/06 17:38:49  matt
321:                 ** replaced missing string.h include
322:                 **
323:                 ** Revision 1.13  2000/07/06 02:47:11  matt
324:                 ** mapper addition madness
325:                 **
326:                 ** Revision 1.12  2000/07/05 05:04:15  matt
327:                 ** added more mappers
328:                 **
329:                 ** Revision 1.11  2000/07/04 23:12:58  matt
330:                 ** brand spankin' new mapper interface implemented
331:                 **
332:                 ** Revision 1.10  2000/07/04 04:56:36  matt
333:                 ** modifications for new SNSS
334:                 **
335:                 ** Revision 1.9  2000/06/29 14:17:18  matt
336:                 ** uses snsslib now
337:                 **
338:                 ** Revision 1.8  2000/06/29 03:09:24  matt
339:                 ** modified to support new snss code
340:                 **
341:                 ** Revision 1.7  2000/06/26 04:57:54  matt
342:                 ** bugfix - irqs/mmcstate not cleared on reset
343:                 **
344:                 ** Revision 1.6  2000/06/23 11:01:10  matt
345:                 ** updated for new external sound interface
346:                 **
347:                 ** Revision 1.5  2000/06/20 04:04:57  matt
348:                 ** hacked to use new external soundchip struct
349:                 **
350:                 ** Revision 1.4  2000/06/09 15:12:26  matt
351:                 ** initial revision
352:                 **
353:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/nes/nes.c  ---------------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** nes.c
21:                  **
22:                  ** NES hardware related routines
23:                  ** $Id: nes.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <stdio.h>
27:                  #include <string.h>
28:                  #include <stdlib.h>
29:                  #include <noftypes.h>
30:                  #include "nes6502.h"
31:                  #include <log.h>
32:                  #include <osd.h>
33:                  #include <gui.h>
34:                  #include <nes.h>
35:                  #include <nes_apu.h>
36:                  #include <nes_ppu.h>
37:                  #include <nes_rom.h>
38:                  #include <nes_mmc.h>
39:                  #include <vid_drv.h>
40:                  #include <nofrendo.h>
41:                  
42:                  
43:                  #define  NES_CLOCK_DIVIDER    12
44:                  //#define  NES_MASTER_CLOCK     21477272.727272727272
45:                  #define  NES_MASTER_CLOCK     (236250000 / 11)
46:                  #define  NES_SCANLINE_CYCLES  (1364.0 / NES_CLOCK_DIVIDER)
47:                  #define  NES_FIQ_PERIOD       (NES_MASTER_CLOCK / NES_CLOCK_DIVIDER / 60)
48:                  
49:                  #define  NES_RAMSIZE          0x800
50:                  
51:                  #define  NES_SKIP_LIMIT       (NES_REFRESH_RATE / 5)   /* 12 or 10, depending on PAL/NTSC */
52:                  
53:                  static nes_t nes;
54:                  
55:                  /* find out if a file is ours */
56:                  int nes_isourfile(const char *filename)
57:                  {
9D025F80  27BDFFE8   ADDIU SP, SP, -24
9D025F84  AFBF0014   SW RA, 20(SP)
58:                     return rom_checkmagic(filename);
9D025F88  0F40C255   JAL rom_checkmagic
9D025F8C  00000000   NOP
59:                  }
9D025F90  8FBF0014   LW RA, 20(SP)
9D025F94  03E00008   JR RA
9D025F98  27BD0018   ADDIU SP, SP, 24
60:                  
61:                  /* TODO: just asking for problems -- please remove */
62:                  nes_t *nes_getcontextptr(void)
63:                  {
64:                     return &nes;
65:                  }
9D025F9C  3C02A001   LUI V0, -24575
9D025FA0  03E00008   JR RA
9D025FA4  244238A8   ADDIU V0, V0, 14504
66:                  
67:                  void nes_getcontext(nes_t *machine)
68:                  {
9D025FA8  27BDFFE0   ADDIU SP, SP, -32
9D025FAC  AFBF001C   SW RA, 28(SP)
9D025FB0  AFB20018   SW S2, 24(SP)
9D025FB4  AFB10014   SW S1, 20(SP)
9D025FB8  AFB00010   SW S0, 16(SP)
9D025FBC  00809021   ADDU S2, A0, ZERO
69:                     apu_getcontext(nes.apu);
9D025FC0  3C11A001   LUI S1, -24575
9D025FC4  263038A8   ADDIU S0, S1, 14504
9D025FC8  0F407DCC   JAL apu_getcontext
9D025FCC  8E040308   LW A0, 776(S0)
70:                     ppu_getcontext(nes.ppu);
9D025FD0  0F405812   JAL ppu_getcontext
9D025FD4  8E040304   LW A0, 772(S0)
71:                     nes6502_getcontext(nes.cpu);
9D025FD8  0F403159   JAL nes6502_getcontext
9D025FDC  8E2438A8   LW A0, 14504(S1)
72:                     mmc_getcontext(nes.mmc);
9D025FE0  0F40CA11   JAL mmc_getcontext
9D025FE4  8E04030C   LW A0, 780(S0)
73:                  
74:                     *machine = nes;
9D025FE8  26090330   ADDIU T1, S0, 816
9D025FEC  8E070000   LW A3, 0(S0)
9D025FF0  8E060004   LW A2, 4(S0)
9D025FF4  8E050008   LW A1, 8(S0)
9D025FF8  8E03000C   LW V1, 12(S0)
9D025FFC  AE470000   SW A3, 0(S2)
9D026000  AE460004   SW A2, 4(S2)
9D026004  AE450008   SW A1, 8(S2)
9D026008  AE43000C   SW V1, 12(S2)
9D02600C  260A0010   ADDIU T2, S0, 16
9D026010  264C0010   ADDIU T4, S2, 16
9D026014  8D480000   LW T0, 0(T2)
9D026018  8D4E0004   LW T6, 4(T2)
9D02601C  8D4F0008   LW T7, 8(T2)
9D026020  8D58000C   LW T8, 12(T2)
9D026024  AD880000   SW T0, 0(T4)
9D026028  AD8E0004   SW T6, 4(T4)
9D02602C  AD8F0008   SW T7, 8(T4)
9D026030  AD98000C   SW T8, 12(T4)
9D026034  254D0010   ADDIU T5, T2, 16
9D026038  25840010   ADDIU A0, T4, 16
9D02603C  8DB90000   LW T9, 0(T5)
9D026040  8DBF0004   LW RA, 4(T5)
9D026044  8DB20008   LW S2, 8(T5)
9D026048  8DB1000C   LW S1, 12(T5)
9D02604C  AC990000   SW T9, 0(A0)
9D026050  AC9F0004   SW RA, 4(A0)
9D026054  AC920008   SW S2, 8(A0)
9D026058  AC91000C   SW S1, 12(A0)
9D02605C  25B00010   ADDIU S0, T5, 16
9D026060  24850010   ADDIU A1, A0, 16
9D026064  8DA30010   LW V1, 16(T5)
9D026068  8E070004   LW A3, 4(S0)
9D02606C  8E060008   LW A2, 8(S0)
9D026070  8E02000C   LW V0, 12(S0)
9D026074  AC830010   SW V1, 16(A0)
9D026078  ACA70004   SW A3, 4(A1)
9D02607C  ACA60008   SW A2, 8(A1)
9D026080  ACA2000C   SW V0, 12(A1)
9D026084  8E0A0010   LW T2, 16(S0)
9D026088  8E0B0014   LW T3, 20(S0)
9D02608C  8E0C0018   LW T4, 24(S0)
9D026090  8E04001C   LW A0, 28(S0)
9D026094  ACAA0010   SW T2, 16(A1)
9D026098  ACAB0014   SW T3, 20(A1)
9D02609C  ACAC0018   SW T4, 24(A1)
9D0260A0  ACA4001C   SW A0, 28(A1)
9D0260A4  8E0D0020   LW T5, 32(S0)
9D0260A8  8E080024   LW T0, 36(S0)
9D0260AC  8E0E0028   LW T6, 40(S0)
9D0260B0  8E0F002C   LW T7, 44(S0)
9D0260B4  ACAD0020   SW T5, 32(A1)
9D0260B8  ACA80024   SW T0, 36(A1)
9D0260BC  ACAE0028   SW T6, 40(A1)
9D0260C0  ACAF002C   SW T7, 44(A1)
9D0260C4  8E180030   LW T8, 48(S0)
9D0260C8  8E190034   LW T9, 52(S0)
9D0260CC  8E1F0038   LW RA, 56(S0)
9D0260D0  8E12003C   LW S2, 60(S0)
9D0260D4  ACB80030   SW T8, 48(A1)
9D0260D8  ACB90034   SW T9, 52(A1)
9D0260DC  ACBF0038   SW RA, 56(A1)
9D0260E0  ACB2003C   SW S2, 60(A1)
9D0260E4  8E110040   LW S1, 64(S0)
9D0260E8  8E030044   LW V1, 68(S0)
9D0260EC  8E070048   LW A3, 72(S0)
9D0260F0  8E06004C   LW A2, 76(S0)
9D0260F4  ACB10040   SW S1, 64(A1)
9D0260F8  ACA30044   SW V1, 68(A1)
9D0260FC  ACA70048   SW A3, 72(A1)
9D026100  ACA6004C   SW A2, 76(A1)
9D026104  8E020050   LW V0, 80(S0)
9D026108  8E0A0054   LW T2, 84(S0)
9D02610C  8E0B0058   LW T3, 88(S0)
9D026110  8E0C005C   LW T4, 92(S0)
9D026114  ACA20050   SW V0, 80(A1)
9D026118  ACAA0054   SW T2, 84(A1)
9D02611C  ACAB0058   SW T3, 88(A1)
9D026120  ACAC005C   SW T4, 92(A1)
9D026124  260D0060   ADDIU T5, S0, 96
9D026128  15A9FFC4   BNE T5, T1, 0x9D02603C
9D02612C  24A40060   ADDIU A0, A1, 96
9D026130  8DA90000   LW T1, 0(T5)
9D026134  AC890000   SW T1, 0(A0)
75:                  }
9D026138  8FBF001C   LW RA, 28(SP)
9D02613C  8FB20018   LW S2, 24(SP)
9D026140  8FB10014   LW S1, 20(SP)
9D026144  8FB00010   LW S0, 16(SP)
9D026148  03E00008   JR RA
9D02614C  27BD0020   ADDIU SP, SP, 32
76:                  
77:                  void nes_setcontext(nes_t *machine)
78:                  {
9D026150  27BDFFE8   ADDIU SP, SP, -24
9D026154  AFBF0014   SW RA, 20(SP)
9D026158  AFB00010   SW S0, 16(SP)
9D02615C  00808021   ADDU S0, A0, ZERO
79:                     ASSERT(machine);
80:                  
81:                     apu_setcontext(machine->apu);
9D026160  0F407D7A   JAL apu_setcontext
9D026164  8C840308   LW A0, 776(A0)
82:                     ppu_setcontext(machine->ppu);
9D026168  0F405782   JAL ppu_setcontext
9D02616C  8E040304   LW A0, 772(S0)
83:                     nes6502_setcontext(machine->cpu);
9D026170  0F4030B1   JAL nes6502_setcontext
9D026174  8E040000   LW A0, 0(S0)
84:                     mmc_setcontext(machine->mmc);
9D026178  0F40CA0C   JAL mmc_setcontext
9D02617C  8E04030C   LW A0, 780(S0)
85:                  
86:                     nes = *machine;
9D026180  3C02A001   LUI V0, -24575
9D026184  244838A8   ADDIU T0, V0, 14504
9D026188  26090330   ADDIU T1, S0, 816
9D02618C  8E070000   LW A3, 0(S0)
9D026190  8E060004   LW A2, 4(S0)
9D026194  8E050008   LW A1, 8(S0)
9D026198  8E04000C   LW A0, 12(S0)
9D02619C  AD070000   SW A3, 0(T0)
9D0261A0  AD060004   SW A2, 4(T0)
9D0261A4  AD050008   SW A1, 8(T0)
9D0261A8  AD04000C   SW A0, 12(T0)
9D0261AC  260A0010   ADDIU T2, S0, 16
9D0261B0  250C0010   ADDIU T4, T0, 16
9D0261B4  8D4E0000   LW T6, 0(T2)
9D0261B8  8D4F0004   LW T7, 4(T2)
9D0261BC  8D580008   LW T8, 8(T2)
9D0261C0  8D59000C   LW T9, 12(T2)
9D0261C4  AD8E0000   SW T6, 0(T4)
9D0261C8  AD8F0004   SW T7, 4(T4)
9D0261CC  AD980008   SW T8, 8(T4)
9D0261D0  AD99000C   SW T9, 12(T4)
9D0261D4  25580010   ADDIU T8, T2, 16
9D0261D8  25990010   ADDIU T9, T4, 16
9D0261DC  8F1F0000   LW RA, 0(T8)
9D0261E0  8F100004   LW S0, 4(T8)
9D0261E4  8F080008   LW T0, 8(T8)
9D0261E8  8F07000C   LW A3, 12(T8)
9D0261EC  AF3F0000   SW RA, 0(T9)
9D0261F0  AF300004   SW S0, 4(T9)
9D0261F4  AF280008   SW T0, 8(T9)
9D0261F8  AF27000C   SW A3, 12(T9)
9D0261FC  27050010   ADDIU A1, T8, 16
9D026200  27240010   ADDIU A0, T9, 16
9D026204  8F0A0010   LW T2, 16(T8)
9D026208  8CAB0004   LW T3, 4(A1)
9D02620C  8CA60008   LW A2, 8(A1)
9D026210  8CA3000C   LW V1, 12(A1)
9D026214  AF2A0010   SW T2, 16(T9)
9D026218  AC8B0004   SW T3, 4(A0)
9D02621C  AC860008   SW A2, 8(A0)
9D026220  AC83000C   SW V1, 12(A0)
9D026224  8CA20010   LW V0, 16(A1)
9D026228  8CAC0014   LW T4, 20(A1)
9D02622C  8CAD0018   LW T5, 24(A1)
9D026230  8CAE001C   LW T6, 28(A1)
9D026234  AC820010   SW V0, 16(A0)
9D026238  AC8C0014   SW T4, 20(A0)
9D02623C  AC8D0018   SW T5, 24(A0)
9D026240  AC8E001C   SW T6, 28(A0)
9D026244  8CAF0020   LW T7, 32(A1)
9D026248  8CB80024   LW T8, 36(A1)
9D02624C  8CB90028   LW T9, 40(A1)
9D026250  8CBF002C   LW RA, 44(A1)
9D026254  AC8F0020   SW T7, 32(A0)
9D026258  AC980024   SW T8, 36(A0)
9D02625C  AC990028   SW T9, 40(A0)
9D026260  AC9F002C   SW RA, 44(A0)
9D026264  8CB00030   LW S0, 48(A1)
9D026268  8CA80034   LW T0, 52(A1)
9D02626C  8CA70038   LW A3, 56(A1)
9D026270  8CAA003C   LW T2, 60(A1)
9D026274  AC900030   SW S0, 48(A0)
9D026278  AC880034   SW T0, 52(A0)
9D02627C  AC870038   SW A3, 56(A0)
9D026280  AC8A003C   SW T2, 60(A0)
9D026284  8CAB0040   LW T3, 64(A1)
9D026288  8CA20044   LW V0, 68(A1)
9D02628C  8CA60048   LW A2, 72(A1)
9D026290  8CA3004C   LW V1, 76(A1)
9D026294  AC8B0040   SW T3, 64(A0)
9D026298  AC820044   SW V0, 68(A0)
9D02629C  AC860048   SW A2, 72(A0)
9D0262A0  AC83004C   SW V1, 76(A0)
9D0262A4  8CAC0050   LW T4, 80(A1)
9D0262A8  8CAD0054   LW T5, 84(A1)
9D0262AC  8CAE0058   LW T6, 88(A1)
9D0262B0  8CAF005C   LW T7, 92(A1)
9D0262B4  AC8C0050   SW T4, 80(A0)
9D0262B8  AC8D0054   SW T5, 84(A0)
9D0262BC  AC8E0058   SW T6, 88(A0)
9D0262C0  AC8F005C   SW T7, 92(A0)
9D0262C4  24B80060   ADDIU T8, A1, 96
9D0262C8  1709FFC4   BNE T8, T1, 0x9D0261DC
9D0262CC  24990060   ADDIU T9, A0, 96
9D0262D0  8F090000   LW T1, 0(T8)
9D0262D4  AF290000   SW T1, 0(T9)
87:                  }
9D0262D8  8FBF0014   LW RA, 20(SP)
9D0262DC  8FB00010   LW S0, 16(SP)
9D0262E0  03E00008   JR RA
9D0262E4  27BD0018   ADDIU SP, SP, 24
88:                  
89:                  static uint8 ram_read(uint32 address)
90:                  {
91:                     return nes.cpu->mem_page[0][address & (NES_RAMSIZE - 1)];
9D025D10  3C02A001   LUI V0, -24575
9D025D14  8C4338A8   LW V1, 14504(V0)
9D025D18  308407FF   ANDI A0, A0, 2047
9D025D1C  8C650000   LW A1, 0(V1)
9D025D20  00A43021   ADDU A2, A1, A0
92:                  }
9D025D24  03E00008   JR RA
9D025D28  90C20000   LBU V0, 0(A2)
93:                  
94:                  static void ram_write(uint32 address, uint8 value)
95:                  {
96:                     nes.cpu->mem_page[0][address & (NES_RAMSIZE - 1)] = value;
9D025D2C  3C02A001   LUI V0, -24575
9D025D30  8C4338A8   LW V1, 14504(V0)
9D025D34  308407FF   ANDI A0, A0, 2047
9D025D38  8C660000   LW A2, 0(V1)
9D025D3C  00C43821   ADDU A3, A2, A0
9D025D40  03E00008   JR RA
9D025D44  A0E50000   SB A1, 0(A3)
97:                  }
98:                  
99:                  static void write_protect(uint32 address, uint8 value)
100:                 {
9D025D48  03E00008   JR RA
9D025D4C  00000000   NOP
101:                    /* don't allow write to go through */
102:                    UNUSED(address);
103:                    UNUSED(value);
104:                 }
105:                 
106:                 static uint8 read_protect(uint32 address)
107:                 {
108:                    /* don't allow read to go through */
109:                    UNUSED(address);
110:                 
111:                    return 0xFF;
112:                 }
9D025D50  03E00008   JR RA
9D025D54  240200FF   ADDIU V0, ZERO, 255
113:                 
114:                 #define  LAST_MEMORY_HANDLER  { -1, -1, NULL }
115:                 /* read/write handlers for standard NES */
116:                 static nes6502_memread default_readhandler[] =
117:                 {
118:                    { 0x0800, 0x1FFF, ram_read },
119:                    { 0x2000, 0x3FFF, ppu_read },
120:                    { 0x4000, 0x4015, apu_read },
121:                    { 0x4016, 0x4017, ppu_readhigh },
122:                    LAST_MEMORY_HANDLER
123:                 };
124:                 
125:                 static nes6502_memwrite default_writehandler[] =
126:                 {
127:                    { 0x0800, 0x1FFF, ram_write },
128:                    { 0x2000, 0x3FFF, ppu_write },
129:                    { 0x4000, 0x4013, apu_write },
130:                    { 0x4015, 0x4015, apu_write },
131:                    { 0x4014, 0x4017, ppu_writehigh },
132:                    LAST_MEMORY_HANDLER
133:                 };
134:                 
135:                 /* this big nasty boy sets up the address handlers that the CPU uses */
136:                 static void build_address_handlers(nes_t *machine)
137:                 {
138:                    int count, num_handlers = 0;
9D0267F8  0B409A13   J 0x9D02684C
9D0267FC  00002021   ADDU A0, ZERO, ZERO
139:                    mapintf_t *intf;
140:                    
141:                    ASSERT(machine);
142:                    intf = machine->mmc->intf;
9D0267C0  8E39030C   LW T9, 780(S1)
9D0267C4  8F300000   LW S0, 0(T9)
143:                 
144:                    memset(machine->readhandler, 0, sizeof(machine->readhandler));
9D0267C8  26240004   ADDIU A0, S1, 4
9D0267CC  00002821   ADDU A1, ZERO, ZERO
9D0267D0  0F4100B4   JAL .Letext0, .LFE0, memset
9D0267D4  24060180   ADDIU A2, ZERO, 384
145:                    memset(machine->writehandler, 0, sizeof(machine->writehandler));
9D0267D8  26240184   ADDIU A0, S1, 388
9D0267DC  00002821   ADDU A1, ZERO, ZERO
9D0267E0  0F4100B4   JAL .Letext0, .LFE0, memset
9D0267E4  24060180   ADDIU A2, ZERO, 384
146:                 
147:                    for (count = 0; num_handlers < MAX_MEM_HANDLERS; count++, num_handlers++)
9D02683C  24840001   ADDIU A0, A0, 1
9D026840  2529000C   ADDIU T1, T1, 12
9D026844  0B409A00   J 0x9D026800
9D026848  256B000C   ADDIU T3, T3, 12
9D026CE8  0B409A00   J 0x9D026800
9D026CEC  24040001   ADDIU A0, ZERO, 1
148:                    {
149:                       if (NULL == default_readhandler[count].read_func)
9D0267E8  3C02A001   LUI V0, -24575
9D0267EC  8C444B4C   LW A0, 19276(V0)
9D0267F0  1480012F   BNE A0, ZERO, 0x9D026CB0
9D0267F4  263F0004   ADDIU RA, S1, 4
9D026800  8D6D0008   LW T5, 8(T3)
9D026804  51A00012   BEQL T5, ZERO, 0x9D026850
9D026808  8E020024   LW V0, 36(S0)
150:                          break;
151:                 
152:                       memcpy(&machine->readhandler[num_handlers], &default_readhandler[count],
9D02680C  896E0003   LWL T6, 3(T3)
9D026810  996E0000   LWR T6, 0(T3)
9D026814  896F0007   LWL T7, 7(T3)
9D026818  996F0004   LWR T7, 4(T3)
9D02681C  8978000B   LWL T8, 11(T3)
9D026820  99780008   LWR T8, 8(T3)
9D026824  A92E0003   SWL T6, 3(T1)
9D026828  B92E0000   SWR T6, 0(T1)
9D02682C  A92F0007   SWL T7, 7(T1)
9D026830  B92F0004   SWR T7, 4(T1)
9D026834  A938000B   SWL T8, 11(T1)
9D026838  B9380008   SWR T8, 8(T1)
9D026CB0  3C03A001   LUI V1, -24575
9D026CB4  8C654B44   LW A1, 19268(V1)
9D026CB8  24664B44   ADDIU A2, V1, 19268
9D026CBC  8CC70004   LW A3, 4(A2)
9D026CC0  8CC80008   LW T0, 8(A2)
9D026CC4  AA250007   SWL A1, 7(S1)
9D026CC8  BBE50000   SWR A1, 0(RA)
9D026CCC  ABE70007   SWL A3, 7(RA)
9D026CD0  BBE70004   SWR A3, 4(RA)
9D026CD4  ABE8000B   SWL T0, 11(RA)
9D026CD8  BBE80008   SWR T0, 8(RA)
9D026CDC  26290010   ADDIU T1, S1, 16
9D026CE0  3C0AA001   LUI T2, -24575
9D026CE4  254B4B50   ADDIU T3, T2, 19280
153:                              sizeof(nes6502_memread));
154:                    }
155:                 
156:                    if (intf->sound_ext)
9D02684C  8E020024   LW V0, 36(S0)
9D026850  5040002F   BEQL V0, ZERO, 0x9D026910
9D026854  8E02001C   LW V0, 28(S0)
157:                    {
158:                       if (NULL != intf->sound_ext->mem_read)
9D026858  8C590010   LW T9, 16(V0)
9D02685C  1320002B   BEQ T9, ZERO, 0x9D02690C
9D026860  289F0020   SLTI RA, A0, 32
159:                       {
160:                          for (count = 0; num_handlers < MAX_MEM_HANDLERS; count++, num_handlers++)
9D026864  13E00054   BEQ RA, ZERO, 0x9D0269B8
9D026868  00047880   SLL T7, A0, 2
9D026890  1520000C   BNE T1, ZERO, 0x9D0268C4
9D026894  240B0020   ADDIU T3, ZERO, 32
9D026898  0B409BC5   J 0x9D026F14
9D02689C  01436021   ADDU T4, T2, V1
9D0268F8  248C0001   ADDIU T4, A0, 1
9D0268FC  158BFFE8   BNE T4, T3, 0x9D0268A0
9D026900  01802021   ADDU A0, T4, ZERO
9D026904  0B409A6E   J 0x9D0269B8
9D026908  00047880   SLL T7, A0, 2
9D026F44  24840001   ADDIU A0, A0, 1
9D026F98  25840001   ADDIU A0, T4, 1
161:                          {
162:                             if (NULL == intf->sound_ext->mem_read[count].read_func)
9D02686C  8F230008   LW V1, 8(T9)
9D026870  1060011F   BEQ V1, ZERO, 0x9D026CF0
9D026874  00042880   SLL A1, A0, 2
9D026878  00043100   SLL A2, A0, 4
9D02687C  00C53823   SUBU A3, A2, A1
9D026880  02274021   ADDU T0, S1, A3
9D026884  2403000C   ADDIU V1, ZERO, 12
9D026888  250AFFF8   ADDIU T2, T0, -8
9D02688C  7C890000   EXT T1, A0, 0, 1
9D0268A0  8E0D0024   LW T5, 36(S0)
9D0268A4  8DAE0010   LW T6, 16(T5)
9D0268A8  01C37821   ADDU T7, T6, V1
9D0268AC  2478000C   ADDIU T8, V1, 12
9D0268B0  8DE30008   LW V1, 8(T7)
9D0268B4  546001AC   BNEL V1, ZERO, 0x9D026F68
9D0268B8  01581021   ADDU V0, T2, T8
9D026F48  8E190024   LW T9, 36(S0)
9D026F4C  8F220010   LW V0, 16(T9)
9D026F50  0043C821   ADDU T9, V0, V1
9D026F54  8F3F0008   LW RA, 8(T9)
9D026F58  17E0FE5A   BNE RA, ZERO, 0x9D0268C4
9D026F5C  2463000C   ADDIU V1, V1, 12
9D026F9C  8E070024   LW A3, 36(S0)
9D026FA0  8CE60010   LW A2, 16(A3)
9D026FA4  00D8C821   ADDU T9, A2, T8
9D026FA8  8F250008   LW A1, 8(T9)
9D026FAC  14A0FE45   BNE A1, ZERO, 0x9D0268C4
9D026FB0  2703000C   ADDIU V1, T8, 12
163:                                break;
164:                 
165:                             memcpy(&machine->readhandler[num_handlers], &intf->sound_ext->mem_read[count],
9D0268C8  8B270003   LWL A3, 3(T9)
9D0268CC  9B270000   LWR A3, 0(T9)
9D0268D0  8B260007   LWL A2, 7(T9)
9D0268D4  9B260004   LWR A2, 4(T9)
9D0268D8  8B25000B   LWL A1, 11(T9)
9D0268DC  9B250008   LWR A1, 8(T9)
9D0268E0  A9070003   SWL A3, 3(T0)
9D0268E4  B9070000   SWR A3, 0(T0)
9D0268E8  A9060007   SWL A2, 7(T0)
9D0268EC  B9060004   SWR A2, 4(T0)
9D0268F0  A905000B   SWL A1, 11(T0)
9D0268F4  B9050008   SWR A1, 8(T0)
9D026F14  8B2D0003   LWL T5, 3(T9)
9D026F18  9B2D0000   LWR T5, 0(T9)
9D026F1C  8B2E0007   LWL T6, 7(T9)
9D026F20  9B2E0004   LWR T6, 4(T9)
9D026F24  8B2F000B   LWL T7, 11(T9)
9D026F28  9B2F0008   LWR T7, 8(T9)
9D026F2C  A98D0003   SWL T5, 3(T4)
9D026F30  B98D0000   SWR T5, 0(T4)
9D026F34  A98E0007   SWL T6, 7(T4)
9D026F38  B98E0004   SWR T6, 4(T4)
9D026F3C  A98F000B   SWL T7, 11(T4)
9D026F40  B98F0008   SWR T7, 8(T4)
9D026F68  89FF0003   LWL RA, 3(T7)
9D026F6C  99FF0000   LWR RA, 0(T7)
9D026F70  89E80007   LWL T0, 7(T7)
9D026F74  99E80004   LWR T0, 4(T7)
9D026F78  89E4000B   LWL A0, 11(T7)
9D026F7C  99E40008   LWR A0, 8(T7)
9D026F80  A85F0003   SWL RA, 3(V0)
9D026F84  B85F0000   SWR RA, 0(V0)
9D026F88  A8480007   SWL T0, 7(V0)
9D026F8C  B8480004   SWR T0, 4(V0)
9D026F90  A844000B   SWL A0, 11(V0)
9D026F94  B8440008   SWR A0, 8(V0)
166:                                    sizeof(nes6502_memread));
167:                          }
168:                       }
169:                    }
170:                 
171:                    if (NULL != intf->mem_read)
9D0268BC  0B409A44   J 0x9D026910
9D0268C0  8E02001C   LW V0, 28(S0)
9D0268C4  01434021   ADDU T0, T2, V1
9D02690C  8E02001C   LW V0, 28(S0)
9D026910  10400028   BEQ V0, ZERO, 0x9D0269B4
9D026914  288A0020   SLTI T2, A0, 32
9D026CF0  8E02001C   LW V0, 28(S0)
9D026CF4  5440FF0B   BNEL V0, ZERO, 0x9D026924
9D026CF8  8C4B0008   LW T3, 8(V0)
9D026CFC  0B409A6E   J 0x9D0269B8
9D026D00  00047880   SLL T7, A0, 2
9D026F60  0B409A44   J 0x9D026910
9D026F64  8E02001C   LW V0, 28(S0)
9D026FB4  0B409A44   J 0x9D026910
9D026FB8  8E02001C   LW V0, 28(S0)
172:                    {
173:                       for (count = 0; num_handlers < MAX_MEM_HANDLERS; count++, num_handlers++)
9D026918  11400027   BEQ T2, ZERO, 0x9D0269B8
9D02691C  00047880   SLL T7, A0, 2
9D026944  17E0000B   BNE RA, ZERO, 0x9D026974
9D026948  24180020   ADDIU T8, ZERO, 32
9D02694C  0B409B9D   J 0x9D026E74
9D026950  01E3C821   ADDU T9, T7, V1
9D0269A8  249F0001   ADDIU RA, A0, 1
9D0269AC  17F8FFE9   BNE RA, T8, 0x9D026954
9D0269B0  03E02021   ADDU A0, RA, ZERO
9D0269B4  00047880   SLL T7, A0, 2
9D0269B8  0004C100   SLL T8, A0, 4
9D0269BC  030F6023   SUBU T4, T8, T7
9D0269C0  022C6821   ADDU T5, S1, T4
9D026EA4  24840001   ADDIU A0, A0, 1
9D026EF4  27E40001   ADDIU A0, RA, 1
174:                       {
175:                          if (NULL == intf->mem_read[count].read_func)
9D026920  8C4B0008   LW T3, 8(V0)
9D026924  11600023   BEQ T3, ZERO, 0x9D0269B4
9D026928  00044880   SLL T1, A0, 2
9D02692C  00046100   SLL T4, A0, 4
9D026930  01896823   SUBU T5, T4, T1
9D026934  022D7021   ADDU T6, S1, T5
9D026938  2403000C   ADDIU V1, ZERO, 12
9D02693C  25CFFFF8   ADDIU T7, T6, -8
9D026940  7C9F0000   EXT RA, A0, 0, 1
9D026954  8E19001C   LW T9, 28(S0)
9D026958  03233021   ADDU A2, T9, V1
9D02695C  2467000C   ADDIU A3, V1, 12
9D026960  8CC30008   LW V1, 8(A2)
9D026964  14600157   BNE V1, ZERO, 0x9D026EC4
9D026968  01E72821   ADDU A1, T7, A3
9D02696C  0B409A6E   J 0x9D0269B8
9D026970  00047880   SLL T7, A0, 2
9D026974  01E35821   ADDU T3, T7, V1
9D026EA8  8E05001C   LW A1, 28(S0)
9D026EAC  00A31021   ADDU V0, A1, V1
9D026EB0  8C4A0008   LW T2, 8(V0)
9D026EB4  1540FEAF   BNE T2, ZERO, 0x9D026974
9D026EB8  2463000C   ADDIU V1, V1, 12
9D026EBC  0B409A6E   J 0x9D0269B8
9D026EC0  00047880   SLL T7, A0, 2
9D026EF8  8E0B001C   LW T3, 28(S0)
9D026EFC  01671021   ADDU V0, T3, A3
9D026F00  8C490008   LW T1, 8(V0)
9D026F04  1520FE9B   BNE T1, ZERO, 0x9D026974
9D026F08  24E3000C   ADDIU V1, A3, 12
9D026F0C  0B409A6E   J 0x9D0269B8
9D026F10  00047880   SLL T7, A0, 2
176:                             break;
177:                 
178:                          memcpy(&machine->readhandler[num_handlers], &intf->mem_read[count],
9D026978  88490003   LWL T1, 3(V0)
9D02697C  98490000   LWR T1, 0(V0)
9D026980  884C0007   LWL T4, 7(V0)
9D026984  984C0004   LWR T4, 4(V0)
9D026988  884D000B   LWL T5, 11(V0)
9D02698C  984D0008   LWR T5, 8(V0)
9D026990  A9690003   SWL T1, 3(T3)
9D026994  B9690000   SWR T1, 0(T3)
9D026998  A96C0007   SWL T4, 7(T3)
9D02699C  B96C0004   SWR T4, 4(T3)
9D0269A0  A96D000B   SWL T5, 11(T3)
9D0269A4  B96D0008   SWR T5, 8(T3)
9D026E74  88470003   LWL A3, 3(V0)
9D026E78  98470000   LWR A3, 0(V0)
9D026E7C  88460007   LWL A2, 7(V0)
9D026E80  98460004   LWR A2, 4(V0)
9D026E84  8848000B   LWL T0, 11(V0)
9D026E88  98480008   LWR T0, 8(V0)
9D026E8C  AB270003   SWL A3, 3(T9)
9D026E90  BB270000   SWR A3, 0(T9)
9D026E94  AB260007   SWL A2, 7(T9)
9D026E98  BB260004   SWR A2, 4(T9)
9D026E9C  AB28000B   SWL T0, 11(T9)
9D026EA0  BB280008   SWR T0, 8(T9)
9D026EC4  88CA0003   LWL T2, 3(A2)
9D026EC8  98CA0000   LWR T2, 0(A2)
9D026ECC  88C80007   LWL T0, 7(A2)
9D026ED0  98C80004   LWR T0, 4(A2)
9D026ED4  88C4000B   LWL A0, 11(A2)
9D026ED8  98C40008   LWR A0, 8(A2)
9D026EDC  A8AA0003   SWL T2, 3(A1)
9D026EE0  B8AA0000   SWR T2, 0(A1)
9D026EE4  A8A80007   SWL T0, 7(A1)
9D026EE8  B8A80004   SWR T0, 4(A1)
9D026EEC  A8A4000B   SWL A0, 11(A1)
9D026EF0  B8A40008   SWR A0, 8(A1)
179:                                 sizeof(nes6502_memread));
180:                       }
181:                    }
182:                 
183:                    /* TODO: poof! numbers */
184:                    machine->readhandler[num_handlers].min_range = 0x4018;
9D0269C4  240E4018   ADDIU T6, ZERO, 16408
9D0269C8  ADAE0004   SW T6, 4(T5)
185:                    machine->readhandler[num_handlers].max_range = 0x5FFF;
9D0269CC  241F5FFF   ADDIU RA, ZERO, 24575
9D0269D0  ADBF0008   SW RA, 8(T5)
186:                    machine->readhandler[num_handlers].read_func = read_protect;
9D0269D4  3C199D02   LUI T9, -25342
9D0269D8  27265D50   ADDIU A2, T9, 23888
9D0269DC  ADA6000C   SW A2, 12(T5)
187:                    num_handlers++;
9D0269E0  24870001   ADDIU A3, A0, 1
9D0269E4  00072880   SLL A1, A3, 2
9D0269E8  00075100   SLL T2, A3, 4
9D0269EC  01454023   SUBU T0, T2, A1
9D0269F0  02282021   ADDU A0, S1, T0
188:                    machine->readhandler[num_handlers].min_range = -1;
9D0269F4  240BFFFF   ADDIU T3, ZERO, -1
9D0269F8  AC8B0004   SW T3, 4(A0)
189:                    machine->readhandler[num_handlers].max_range = -1;
9D0269FC  AC8B0008   SW T3, 8(A0)
190:                    machine->readhandler[num_handlers].read_func = NULL;
9D026A00  AC80000C   SW ZERO, 12(A0)
191:                    num_handlers++;
192:                    ASSERT(num_handlers <= MAX_MEM_HANDLERS);
193:                 
194:                    num_handlers = 0;
9D026A14  0B409A9A   J 0x9D026A68
9D026A18  00002021   ADDU A0, ZERO, ZERO
195:                 
196:                    for (count = 0; num_handlers < MAX_MEM_HANDLERS; count++, num_handlers++)
9D026A58  24840001   ADDIU A0, A0, 1
9D026A5C  27FF000C   ADDIU RA, RA, 12
9D026A60  0B409A87   J 0x9D026A1C
9D026A64  24A5000C   ADDIU A1, A1, 12
9D026CA8  0B409A87   J 0x9D026A1C
9D026CAC  24040001   ADDIU A0, ZERO, 1
197:                    {
198:                       if (NULL == default_writehandler[count].write_func)
9D026A04  3C02A001   LUI V0, -24575
9D026A08  8C434B04   LW V1, 19204(V0)
9D026A0C  14600098   BNE V1, ZERO, 0x9D026C70
9D026A10  26290184   ADDIU T1, S1, 388
9D026A1C  8CA60008   LW A2, 8(A1)
9D026A20  50C00012   BEQL A2, ZERO, 0x9D026A6C
9D026A24  8E030024   LW V1, 36(S0)
199:                          break;
200:                 
201:                       memcpy(&machine->writehandler[num_handlers], &default_writehandler[count],
9D026A28  88A70003   LWL A3, 3(A1)
9D026A2C  98A70000   LWR A3, 0(A1)
9D026A30  88AB0007   LWL T3, 7(A1)
9D026A34  98AB0004   LWR T3, 4(A1)
9D026A38  88A8000B   LWL T0, 11(A1)
9D026A3C  98A80008   LWR T0, 8(A1)
9D026A40  ABE70003   SWL A3, 3(RA)
9D026A44  BBE70000   SWR A3, 0(RA)
9D026A48  ABEB0007   SWL T3, 7(RA)
9D026A4C  BBEB0004   SWR T3, 4(RA)
9D026A50  ABE8000B   SWL T0, 11(RA)
9D026A54  BBE80008   SWR T0, 8(RA)
9D026C70  3C0FA001   LUI T7, -24575
9D026C74  8DF84AFC   LW T8, 19196(T7)
9D026C78  25EC4AFC   ADDIU T4, T7, 19196
9D026C7C  8D8D0004   LW T5, 4(T4)
9D026C80  8D8E0008   LW T6, 8(T4)
9D026C84  AA380187   SWL T8, 391(S1)
9D026C88  B9380000   SWR T8, 0(T1)
9D026C8C  A92D0007   SWL T5, 7(T1)
9D026C90  B92D0004   SWR T5, 4(T1)
9D026C94  A92E000B   SWL T6, 11(T1)
9D026C98  B92E0008   SWR T6, 8(T1)
9D026C9C  263F0190   ADDIU RA, S1, 400
9D026CA0  3C19A001   LUI T9, -24575
9D026CA4  27254B08   ADDIU A1, T9, 19208
202:                              sizeof(nes6502_memwrite));
203:                    }
204:                 
205:                    if (intf->sound_ext)
9D026A68  8E030024   LW V1, 36(S0)
9D026A6C  5060002F   BEQL V1, ZERO, 0x9D026B2C
9D026A70  8E020020   LW V0, 32(S0)
206:                    {
207:                       if (NULL != intf->sound_ext->mem_write)
9D026A74  8C620014   LW V0, 20(V1)
9D026A78  1040002B   BEQ V0, ZERO, 0x9D026B28
9D026A7C  28890020   SLTI T1, A0, 32
208:                       {
209:                          for (count = 0; num_handlers < MAX_MEM_HANDLERS; count++, num_handlers++)
9D026A80  51200054   BEQL T1, ZERO, 0x9D026BD4
9D026A84  00048080   SLL S0, A0, 2
9D026AAC  14A0000C   BNE A1, ZERO, 0x9D026AE0
9D026AB0  24190020   ADDIU T9, ZERO, 32
9D026AB4  0B409B73   J 0x9D026DCC
9D026AB8  03E35021   ADDU T2, RA, V1
9D026B14  248A0001   ADDIU T2, A0, 1
9D026B18  1559FFE8   BNE T2, T9, 0x9D026ABC
9D026B1C  01402021   ADDU A0, T2, ZERO
9D026DFC  24840001   ADDIU A0, A0, 1
9D026E50  25440001   ADDIU A0, T2, 1
210:                          {
211:                             if (NULL == intf->sound_ext->mem_write[count].write_func)
9D026A88  8C4F0008   LW T7, 8(V0)
9D026A8C  11E0009D   BEQ T7, ZERO, 0x9D026D04
9D026A90  0004C080   SLL T8, A0, 2
9D026A94  00046100   SLL T4, A0, 4
9D026A98  01986823   SUBU T5, T4, T8
9D026A9C  022D7021   ADDU T6, S1, T5
9D026AA0  2403000C   ADDIU V1, ZERO, 12
9D026AA4  25DF0178   ADDIU RA, T6, 376
9D026AA8  7C850000   EXT A1, A0, 0, 1
9D026ABC  8E070024   LW A3, 36(S0)
9D026AC0  8CE60014   LW A2, 20(A3)
9D026AC4  00C35821   ADDU T3, A2, V1
9D026AC8  246F000C   ADDIU T7, V1, 12
9D026ACC  8D630008   LW V1, 8(T3)
9D026AD0  146000D3   BNE V1, ZERO, 0x9D026E20
9D026AD4  03EFC021   ADDU T8, RA, T7
9D026E00  8E020024   LW V0, 36(S0)
9D026E04  8C490014   LW T1, 20(V0)
9D026E08  01231021   ADDU V0, T1, V1
9D026E0C  8C4F0008   LW T7, 8(V0)
9D026E10  15E0FF33   BNE T7, ZERO, 0x9D026AE0
9D026E14  2463000C   ADDIU V1, V1, 12
9D026E54  8E0C0024   LW T4, 36(S0)
9D026E58  8D8D0014   LW T5, 20(T4)
9D026E5C  01AF1021   ADDU V0, T5, T7
9D026E60  8C4E0008   LW T6, 8(V0)
9D026E64  15C0FF1E   BNE T6, ZERO, 0x9D026AE0
9D026E68  25E3000C   ADDIU V1, T7, 12
212:                                break;
213:                 
214:                             memcpy(&machine->writehandler[num_handlers], &intf->sound_ext->mem_write[count],
9D026AE4  884C0003   LWL T4, 3(V0)
9D026AE8  984C0000   LWR T4, 0(V0)
9D026AEC  884D0007   LWL T5, 7(V0)
9D026AF0  984D0004   LWR T5, 4(V0)
9D026AF4  884E000B   LWL T6, 11(V0)
9D026AF8  984E0008   LWR T6, 8(V0)
9D026AFC  AB0C0003   SWL T4, 3(T8)
9D026B00  BB0C0000   SWR T4, 0(T8)
9D026B04  AB0D0007   SWL T5, 7(T8)
9D026B08  BB0D0004   SWR T5, 4(T8)
9D026B0C  AB0E000B   SWL T6, 11(T8)
9D026B10  BB0E0008   SWR T6, 8(T8)
9D026DCC  88470003   LWL A3, 3(V0)
9D026DD0  98470000   LWR A3, 0(V0)
9D026DD4  88460007   LWL A2, 7(V0)
9D026DD8  98460004   LWR A2, 4(V0)
9D026DDC  884B000B   LWL T3, 11(V0)
9D026DE0  984B0008   LWR T3, 8(V0)
9D026DE4  A9470003   SWL A3, 3(T2)
9D026DE8  B9470000   SWR A3, 0(T2)
9D026DEC  A9460007   SWL A2, 7(T2)
9D026DF0  B9460004   SWR A2, 4(T2)
9D026DF4  A94B000B   SWL T3, 11(T2)
9D026DF8  B94B0008   SWR T3, 8(T2)
9D026E20  89690003   LWL T1, 3(T3)
9D026E24  99690000   LWR T1, 0(T3)
9D026E28  89680007   LWL T0, 7(T3)
9D026E2C  99680004   LWR T0, 4(T3)
9D026E30  8964000B   LWL A0, 11(T3)
9D026E34  99640008   LWR A0, 8(T3)
9D026E38  AB090003   SWL T1, 3(T8)
9D026E3C  BB090000   SWR T1, 0(T8)
9D026E40  AB080007   SWL T0, 7(T8)
9D026E44  BB080004   SWR T0, 4(T8)
9D026E48  AB04000B   SWL A0, 11(T8)
9D026E4C  BB040008   SWR A0, 8(T8)
215:                                    sizeof(nes6502_memwrite));
216:                          }
217:                       }
218:                    }
219:                 
220:                    if (NULL != intf->mem_write)
9D026AD8  0B409ACB   J 0x9D026B2C
9D026ADC  8E020020   LW V0, 32(S0)
9D026AE0  03E3C021   ADDU T8, RA, V1
9D026B28  8E020020   LW V0, 32(S0)
9D026B2C  10400028   BEQ V0, ZERO, 0x9D026BD0
9D026B30  289F0020   SLTI RA, A0, 32
9D026D04  8E020020   LW V0, 32(S0)
9D026D08  5440FF8D   BNEL V0, ZERO, 0x9D026B40
9D026D0C  8C590008   LW T9, 8(V0)
9D026E18  0B409ACB   J 0x9D026B2C
9D026E1C  8E020020   LW V0, 32(S0)
9D026E6C  0B409ACB   J 0x9D026B2C
9D026E70  8E020020   LW V0, 32(S0)
221:                    {
222:                       for (count = 0; num_handlers < MAX_MEM_HANDLERS; count++, num_handlers++)
9D026B34  53E00027   BEQL RA, ZERO, 0x9D026BD4
9D026B38  00048080   SLL S0, A0, 2
9D026B60  1700000B   BNE T8, ZERO, 0x9D026B90
9D026B64  240B0020   ADDIU T3, ZERO, 32
9D026B68  0B409B4B   J 0x9D026D2C
9D026B6C  01E34821   ADDU T1, T7, V1
9D026BC4  24980001   ADDIU T8, A0, 1
9D026BC8  170BFFE9   BNE T8, T3, 0x9D026B70
9D026BCC  03002021   ADDU A0, T8, ZERO
9D026D5C  24840001   ADDIU A0, A0, 1
9D026DAC  27040001   ADDIU A0, T8, 1
223:                       {
224:                          if (NULL == intf->mem_write[count].write_func)
9D026B3C  8C590008   LW T9, 8(V0)
9D026B40  13200023   BEQ T9, ZERO, 0x9D026BD0
9D026B44  00042880   SLL A1, A0, 2
9D026B48  00045100   SLL T2, A0, 4
9D026B4C  01453823   SUBU A3, T2, A1
9D026B50  02273021   ADDU A2, S1, A3
9D026B54  2403000C   ADDIU V1, ZERO, 12
9D026B58  24CF0178   ADDIU T7, A2, 376
9D026B5C  7C980000   EXT T8, A0, 0, 1
9D026B70  8E090020   LW T1, 32(S0)
9D026B74  01236021   ADDU T4, T1, V1
9D026B78  246D000C   ADDIU T5, V1, 12
9D026B7C  8D830008   LW V1, 8(T4)
9D026B80  1460007E   BNE V1, ZERO, 0x9D026D7C
9D026B84  01ED7021   ADDU T6, T7, T5
9D026D60  8E0E0020   LW T6, 32(S0)
9D026D64  01C31021   ADDU V0, T6, V1
9D026D68  8C5F0008   LW RA, 8(V0)
9D026D6C  17E0FF88   BNE RA, ZERO, 0x9D026B90
9D026D70  2463000C   ADDIU V1, V1, 12
9D026DB0  8E190020   LW T9, 32(S0)
9D026DB4  032D1021   ADDU V0, T9, T5
9D026DB8  8C4A0008   LW T2, 8(V0)
9D026DBC  1540FF74   BNE T2, ZERO, 0x9D026B90
9D026DC0  25A3000C   ADDIU V1, T5, 12
225:                             break;
226:                 
227:                          memcpy(&machine->writehandler[num_handlers], &intf->mem_write[count],
9D026B94  884A0003   LWL T2, 3(V0)
9D026B98  984A0000   LWR T2, 0(V0)
9D026B9C  88470007   LWL A3, 7(V0)
9D026BA0  98470004   LWR A3, 4(V0)
9D026BA4  8845000B   LWL A1, 11(V0)
9D026BA8  98450008   LWR A1, 8(V0)
9D026BAC  AB2A0003   SWL T2, 3(T9)
9D026BB0  BB2A0000   SWR T2, 0(T9)
9D026BB4  AB270007   SWL A3, 7(T9)
9D026BB8  BB270004   SWR A3, 4(T9)
9D026BBC  AB25000B   SWL A1, 11(T9)
9D026BC0  BB250008   SWR A1, 8(T9)
9D026D2C  884C0003   LWL T4, 3(V0)
9D026D30  984C0000   LWR T4, 0(V0)
9D026D34  884D0007   LWL T5, 7(V0)
9D026D38  984D0004   LWR T5, 4(V0)
9D026D3C  8848000B   LWL T0, 11(V0)
9D026D40  98480008   LWR T0, 8(V0)
9D026D44  A92C0003   SWL T4, 3(T1)
9D026D48  B92C0000   SWR T4, 0(T1)
9D026D4C  A92D0007   SWL T5, 7(T1)
9D026D50  B92D0004   SWR T5, 4(T1)
9D026D54  A928000B   SWL T0, 11(T1)
9D026D58  B9280008   SWR T0, 8(T1)
9D026D7C  899F0003   LWL RA, 3(T4)
9D026D80  999F0000   LWR RA, 0(T4)
9D026D84  89880007   LWL T0, 7(T4)
9D026D88  99880004   LWR T0, 4(T4)
9D026D8C  8984000B   LWL A0, 11(T4)
9D026D90  99840008   LWR A0, 8(T4)
9D026D94  A9DF0003   SWL RA, 3(T6)
9D026D98  B9DF0000   SWR RA, 0(T6)
9D026D9C  A9C80007   SWL T0, 7(T6)
9D026DA0  B9C80004   SWR T0, 4(T6)
9D026DA4  A9C4000B   SWL A0, 11(T6)
9D026DA8  B9C40008   SWR A0, 8(T6)
228:                                 sizeof(nes6502_memwrite));
229:                       }
230:                    }
231:                 
232:                    /* catch-all for bad writes */
233:                    /* TODO: poof! numbers */
234:                    machine->writehandler[num_handlers].min_range = 0x4018;
9D026B20  0B409AF5   J 0x9D026BD4
9D026B24  00048080   SLL S0, A0, 2
9D026B88  0B409AF5   J 0x9D026BD4
9D026B8C  00048080   SLL S0, A0, 2
9D026B90  01E3C821   ADDU T9, T7, V1
9D026BD0  00048080   SLL S0, A0, 2
9D026BD4  00047900   SLL T7, A0, 4
9D026BD8  01F05823   SUBU T3, T7, S0
9D026BDC  022B3821   ADDU A3, S1, T3
9D026BE0  24054018   ADDIU A1, ZERO, 16408
9D026BE4  ACE50184   SW A1, 388(A3)
9D026D10  0B409AF5   J 0x9D026BD4
9D026D14  00048080   SLL S0, A0, 2
9D026D74  0B409AF5   J 0x9D026BD4
9D026D78  00048080   SLL S0, A0, 2
9D026DC4  0B409AF5   J 0x9D026BD4
9D026DC8  00048080   SLL S0, A0, 2
235:                    machine->writehandler[num_handlers].max_range = 0x5FFF;
9D026BE8  24065FFF   ADDIU A2, ZERO, 24575
9D026BEC  ACE60188   SW A2, 392(A3)
236:                    machine->writehandler[num_handlers].write_func = write_protect;
9D026BF0  3C189D02   LUI T8, -25342
9D026BF4  27095D48   ADDIU T1, T8, 23880
9D026BF8  ACE9018C   SW T1, 396(A3)
237:                    num_handlers++;
9D026BFC  248C0001   ADDIU T4, A0, 1
238:                    machine->writehandler[num_handlers].min_range = 0x8000;
9D026C00  000C6880   SLL T5, T4, 2
9D026C04  000C7100   SLL T6, T4, 4
9D026C08  01CDF823   SUBU RA, T6, T5
9D026C0C  023F4021   ADDU T0, S1, RA
9D026C10  34198000   ORI T9, ZERO, -32768
9D026C14  AD190184   SW T9, 388(T0)
239:                    machine->writehandler[num_handlers].max_range = 0xFFFF;
9D026C18  3402FFFF   ORI V0, ZERO, -1
9D026C1C  AD020188   SW V0, 392(T0)
240:                    machine->writehandler[num_handlers].write_func = write_protect;
9D026C20  AD09018C   SW T1, 396(T0)
241:                    num_handlers++;
9D026C24  24840002   ADDIU A0, A0, 2
242:                    machine->writehandler[num_handlers].min_range = -1;
9D026C28  00041880   SLL V1, A0, 2
9D026C2C  00045100   SLL T2, A0, 4
9D026C30  01438023   SUBU S0, T2, V1
9D026C34  02308821   ADDU S1, S1, S0
9D026C38  240FFFFF   ADDIU T7, ZERO, -1
9D026C3C  AE2F0184   SW T7, 388(S1)
243:                    machine->writehandler[num_handlers].max_range = -1;
9D026C40  AE2F0188   SW T7, 392(S1)
244:                    machine->writehandler[num_handlers].write_func = NULL;
9D026C44  AE20018C   SW ZERO, 396(S1)
245:                    num_handlers++;
246:                    ASSERT(num_handlers <= MAX_MEM_HANDLERS);
247:                 }
248:                 
249:                 /* raise an IRQ */
250:                 void nes_irq(void)
251:                 {
9D025D7C  27BDFFE8   ADDIU SP, SP, -24
9D025D80  AFBF0014   SW RA, 20(SP)
252:                 #ifdef NOFRENDO_DEBUG
253:                 //   if (nes.scanline <= NES_SCREEN_HEIGHT)
254:                 //      memset(nes.vidbuf->line[nes.scanline - 1], GUI_RED, NES_SCREEN_WIDTH);
255:                 #endif /* NOFRENDO_DEBUG */
256:                 
257:                    nes6502_irq();
9D025D84  0F4056F0   JAL nes6502_irq
9D025D88  00000000   NOP
258:                 }
9D025D8C  8FBF0014   LW RA, 20(SP)
9D025D90  03E00008   JR RA
9D025D94  27BD0018   ADDIU SP, SP, 24
259:                 
260:                 static uint8 nes_clearfiq(void)
261:                 {
262:                    if (nes.fiq_occurred)
9D025D58  3C02A001   LUI V0, -24575
9D025D5C  8C433BBC   LW V1, 15292(V0)
9D025D60  10600004   BEQ V1, ZERO, 0x9D025D74
9D025D64  3C04A001   LUI A0, -24575
263:                    {
264:                       nes.fiq_occurred = false;
9D025D68  AC803BBC   SW ZERO, 15292(A0)
265:                       return 0x40;
9D025D6C  03E00008   JR RA
9D025D70  24020040   ADDIU V0, ZERO, 64
266:                    }
267:                 
268:                    return 0;
269:                 }
9D025D74  03E00008   JR RA
9D025D78  00001021   ADDU V0, ZERO, ZERO
270:                 
271:                 void nes_setfiq(uint8 value)
272:                 {
273:                    nes.fiq_state = value;
9D0262E8  3C02A001   LUI V0, -24575
9D0262EC  244538A8   ADDIU A1, V0, 14504
9D0262F0  A0A40318   SB A0, 792(A1)
274:                    nes.fiq_cycles = (int) NES_FIQ_PERIOD;
9D0262F4  24037485   ADDIU V1, ZERO, 29829
9D0262F8  03E00008   JR RA
9D0262FC  ACA3031C   SW V1, 796(A1)
275:                 }
276:                 
277:                 static void nes_checkfiq(int cycles)
278:                 {
9D025DD4  27BDFFE8   ADDIU SP, SP, -24
9D025DD8  AFBF0014   SW RA, 20(SP)
279:                    nes.fiq_cycles -= cycles;
9D025D98  3C02A001   LUI V0, -24575
9D025D9C  8C433BC4   LW V1, 15300(V0)
9D025DA0  00642023   SUBU A0, V1, A0
9D025DAC  03E00008   JR RA
9D025DB0  ACA43BC4   SW A0, 15300(A1)
280:                    if (nes.fiq_cycles <= 0)
9D025DA4  18800003   BLEZ A0, 0x9D025DB4
9D025DA8  3C05A001   LUI A1, -24575
281:                    {
282:                       nes.fiq_cycles += (int) NES_FIQ_PERIOD;
9D025DB4  3C06A001   LUI A2, -24575
9D025DB8  24C738A8   ADDIU A3, A2, 14504
9D025DBC  24887485   ADDIU T0, A0, 29829
9D025DC0  ACE8031C   SW T0, 796(A3)
283:                       if (0 == (nes.fiq_state & 0xC0))
9D025DC4  90E90318   LBU T1, 792(A3)
9D025DC8  312A00C0   ANDI T2, T1, 192
9D025DCC  15400008   BNE T2, ZERO, 0x9D025DF0
9D025DD0  240B0001   ADDIU T3, ZERO, 1
284:                       {
285:                          nes.fiq_occurred = true;
9D025DDC  3C0CA001   LUI T4, -24575
286:                          nes6502_irq();
9D025DE0  0F4056F0   JAL nes6502_irq
9D025DE4  AD8B3BBC   SW T3, 15292(T4)
287:                       }
288:                    }
289:                 }
9D025DE8  8FBF0014   LW RA, 20(SP)
9D025DEC  27BD0018   ADDIU SP, SP, 24
9D025DF0  03E00008   JR RA
9D025DF4  00000000   NOP
290:                 
291:                 void nes_nmi(void)
292:                 {
9D026300  27BDFFE8   ADDIU SP, SP, -24
9D026304  AFBF0014   SW RA, 20(SP)
293:                    nes6502_nmi();
9D026308  0F4056A2   JAL nes6502_nmi
9D02630C  00000000   NOP
294:                 }
9D026310  8FBF0014   LW RA, 20(SP)
9D026314  03E00008   JR RA
9D026318  27BD0018   ADDIU SP, SP, 24
295:                 
296:                 static void nes_renderframe(bool draw_flag)
297:                 {
9D025DF8  27BDFFC8   ADDIU SP, SP, -56
9D025DFC  AFBF0034   SW RA, 52(SP)
9D025E00  AFBE0030   SW FP, 48(SP)
9D025E04  AFB7002C   SW S7, 44(SP)
9D025E08  AFB60028   SW S6, 40(SP)
9D025E0C  AFB50024   SW S5, 36(SP)
9D025E10  AFB40020   SW S4, 32(SP)
9D025E14  AFB3001C   SW S3, 28(SP)
9D025E18  AFB20018   SW S2, 24(SP)
9D025E1C  AFB10014   SW S1, 20(SP)
9D025E20  AFB00010   SW S0, 16(SP)
298:                    int elapsed_cycles;
299:                    mapintf_t *mapintf = nes.mmc->intf;
9D025E24  3C02A001   LUI V0, -24575
9D025E28  244538A8   ADDIU A1, V0, 14504
9D025E2C  8CA3030C   LW V1, 780(A1)
300:                    int in_vblank = 0;
9D025E44  0000F021   ADDU FP, ZERO, ZERO
301:                 
302:                    while (262 != nes.scanline)
9D025E30  8CA60320   LW A2, 800(A1)
9D025E34  24070106   ADDIU A3, ZERO, 262
9D025E38  10C70043   BEQ A2, A3, 0x9D025F48
9D025E3C  8C730000   LW S3, 0(V1)
9D025E40  0080A021   ADDU S4, A0, ZERO
9D025E58  24150106   ADDIU S5, ZERO, 262
9D025F40  1595FFC6   BNE T4, S5, 0x9D025E5C
9D025F44  AE0C0320   SW T4, 800(S0)
303:                    {
304:                 //      ppu_scanline(nes.vidbuf, nes.scanline, draw_flag);
305:                 		ppu_scanline(vid_getbuffer(), nes.scanline, draw_flag);
9D025E48  3C12A001   LUI S2, -24575
9D025E5C  0F40D0CF   JAL vid_getbuffer
9D025E60  265038A8   ADDIU S0, S2, 14504
9D025E64  00402021   ADDU A0, V0, ZERO
9D025E68  8E050320   LW A1, 800(S0)
9D025E6C  0F405CC1   JAL ppu_scanline
9D025E70  02803021   ADDU A2, S4, ZERO
306:                 
307:                       if (241 == nes.scanline)
9D025E4C  241700F1   ADDIU S7, ZERO, 241
9D025E74  8E080320   LW T0, 800(S0)
9D025E78  55170017   BNEL T0, S7, 0x9D025ED8
9D025E7C  8E6A0010   LW T2, 16(S3)
308:                       {
309:                          /* 7-9 cycle delay between when VINT flag goes up and NMI is taken */
310:                          elapsed_cycles = nes6502_execute(7);
9D025E80  0F4031EF   JAL nes6502_execute
9D025E84  24040007   ADDIU A0, ZERO, 7
9D025E88  0040F021   ADDU FP, V0, ZERO
311:                          nes.scanline_cycles -= elapsed_cycles;
9D025E8C  265138A8   ADDIU S1, S2, 14504
9D025E90  0F4105E3   JAL sitofp
9D025E94  00402021   ADDU A0, V0, ZERO
9D025E98  8E240324   LW A0, 804(S1)
9D025E9C  0F40EA50   JAL __subsf3
9D025EA0  00402821   ADDU A1, V0, ZERO
9D025EA4  AE220324   SW V0, 804(S1)
312:                          nes_checkfiq(elapsed_cycles);
9D025EA8  0F409766   JAL .LFB20, nes_checkfiq, .LFE17
9D025EAC  03C02021   ADDU A0, FP, ZERO
313:                 
314:                          ppu_checknmi();
9D025EB0  0F405CB5   JAL ppu_checknmi
9D025EB4  00000000   NOP
315:                 
316:                          if (mapintf->vblank)
9D025EB8  8E69000C   LW T1, 12(S3)
9D025EBC  11200005   BEQ T1, ZERO, 0x9D025ED4
9D025EC0  241E0001   ADDIU FP, ZERO, 1
317:                             mapintf->vblank();
9D025EC4  0120F809   JALR T1
9D025EC8  00000000   NOP
318:                          in_vblank = 1;
319:                       } 
320:                 
321:                       if (mapintf->hblank)
9D025ECC  0B4097B6   J 0x9D025ED8
9D025ED0  8E6A0010   LW T2, 16(S3)
9D025ED4  8E6A0010   LW T2, 16(S3)
9D025ED8  11400004   BEQ T2, ZERO, 0x9D025EEC
9D025EDC  265038A8   ADDIU S0, S2, 14504
322:                          mapintf->hblank(in_vblank);
9D025EE0  0140F809   JALR T2
9D025EE4  03C02021   ADDU A0, FP, ZERO
323:                 
324:                       nes.scanline_cycles += (float) NES_SCANLINE_CYCLES;
9D025E50  3C049D04   LUI A0, -25340
9D025E54  8C962414   LW S6, 9236(A0)
9D025EE8  265038A8   ADDIU S0, S2, 14504
9D025EEC  8E040324   LW A0, 804(S0)
9D025EF0  0F40EA52   JAL fpadd
9D025EF4  02C02821   ADDU A1, S6, ZERO
9D025EF8  AE020324   SW V0, 804(S0)
325:                       elapsed_cycles = nes6502_execute((int) nes.scanline_cycles);
9D025EFC  0F41039C   JAL __fixsfsi
9D025F00  00402021   ADDU A0, V0, ZERO
9D025F04  0F4031EF   JAL nes6502_execute
9D025F08  00402021   ADDU A0, V0, ZERO
9D025F0C  00408821   ADDU S1, V0, ZERO
326:                       nes.scanline_cycles -= (float) elapsed_cycles;
9D025F10  0F4105E3   JAL sitofp
9D025F14  00402021   ADDU A0, V0, ZERO
9D025F18  8E040324   LW A0, 804(S0)
9D025F1C  0F40EA50   JAL __subsf3
9D025F20  00402821   ADDU A1, V0, ZERO
9D025F24  AE020324   SW V0, 804(S0)
327:                       nes_checkfiq(elapsed_cycles);
9D025F28  0F409766   JAL .LFB20, nes_checkfiq, .LFE17
9D025F2C  02202021   ADDU A0, S1, ZERO
328:                 
329:                       ppu_endscanline(nes.scanline);
9D025F30  0F405C8C   JAL ppu_endscanline
9D025F34  8E040320   LW A0, 800(S0)
330:                       nes.scanline++;
9D025F38  8E0B0320   LW T3, 800(S0)
9D025F3C  256C0001   ADDIU T4, T3, 1
331:                    }
332:                 
333:                    nes.scanline = 0;
9D025F48  3C0DA001   LUI T5, -24575
9D025F4C  ADA03BC8   SW ZERO, 15304(T5)
334:                 }
9D025F50  8FBF0034   LW RA, 52(SP)
9D025F54  8FBE0030   LW FP, 48(SP)
9D025F58  8FB7002C   LW S7, 44(SP)
9D025F5C  8FB60028   LW S6, 40(SP)
9D025F60  8FB50024   LW S5, 36(SP)
9D025F64  8FB40020   LW S4, 32(SP)
9D025F68  8FB3001C   LW S3, 28(SP)
9D025F6C  8FB20018   LW S2, 24(SP)
9D025F70  8FB10014   LW S1, 20(SP)
9D025F74  8FB00010   LW S0, 16(SP)
9D025F78  03E00008   JR RA
9D025F7C  27BD0038   ADDIU SP, SP, 56
335:                 
336:                 static void system_video(bool draw)
337:                 {
338:                    /* TODO: hack */
339:                 //   if (false == draw)
340:                 //   {
341:                 //      //gui_frame(false);
342:                 //      return;
343:                 //   }
344:                 
345:                    /* blit the NES screen to our video surface */
346:                 //   vid_blit(nes.vidbuf, 0, (NES_SCREEN_HEIGHT - NES_VISIBLE_HEIGHT) / 2,
347:                 //            0, 0, NES_SCREEN_WIDTH, NES_VISIBLE_HEIGHT);
348:                 
349:                    /* overlay our GUI on top of it */
350:                    //gui_frame(true);
351:                 
352:                    /* blit to screen */
353:                    vid_flush();
9D026390  0F40D17A   JAL vid_flush
9D0263B4  0F40D17A   JAL vid_flush
9D0263F0  0F40D17A   JAL vid_flush
9D0263F4  00008021   ADDU S0, ZERO, ZERO
354:                    
355:                    //ili9341_write_frame(x, y, DEFAULT_WIDTH, DEFAULT_HEIGHT, (const uint8_t **)bmp->line);
356:                    
357:                 
358:                    /* grab input */
359:                    //osd_getinput();
360:                 }
361:                 
362:                 /* main emulation loop */
363:                 void nes_emulate(void)
364:                 {
9D02631C  27BDFFD8   ADDIU SP, SP, -40
9D026320  AFBF0024   SW RA, 36(SP)
9D026324  AFB30020   SW S3, 32(SP)
9D026328  AFB2001C   SW S2, 28(SP)
9D02632C  AFB10018   SW S1, 24(SP)
9D026330  AFB00014   SW S0, 20(SP)
365:                    int last_ticks, frames_to_render;
366:                 
367:                    //osd_setsound(nes.apu->process);
368:                 
369:                    last_ticks = nofrendo_ticks;
9D026334  8F928194   LW S2, -32364(GP)
370:                    frames_to_render = 0;
9D026350  00008021   ADDU S0, ZERO, ZERO
371:                    nes.scanline_cycles = 0;
9D026338  3C02A001   LUI V0, -24575
9D02633C  244438A8   ADDIU A0, V0, 14504
9D026340  00001821   ADDU V1, ZERO, ZERO
9D026344  AC830324   SW V1, 804(A0)
372:                    nes.fiq_cycles = (int) NES_FIQ_PERIOD;
9D026348  24057485   ADDIU A1, ZERO, 29829
9D02634C  AC85031C   SW A1, 796(A0)
373:                 
374:                    while (false == nes.poweroff)
9D026354  3C11A001   LUI S1, -24575
9D026358  0B4098FE   J .LVL68, .LBE14
9D02635C  24130001   ADDIU S3, ZERO, 1
9D026398  0B4098FF   J 0x9D0263FC
9D02639C  262638A8   ADDIU A2, S1, 14504
9D0263BC  0B4098FF   J 0x9D0263FC
9D0263C0  262638A8   ADDIU A2, S1, 14504
9D0263F8  262638A8   ADDIU A2, S1, 14504
9D0263FC  8CC7032C   LW A3, 812(A2)
9D026400  10E0FFD7   BEQ A3, ZERO, 0x9D026360
9D026404  8FBF0024   LW RA, 36(SP)
375:                    {
376:                       if (nofrendo_ticks != last_ticks)
9D026360  8F888194   LW T0, -32364(GP)
9D026364  11120007   BEQ T0, S2, 0x9D026384
9D026368  262A38A8   ADDIU T2, S1, 14504
377:                       {
378:                          int tick_diff = nofrendo_ticks - last_ticks;
9D02636C  8F898194   LW T1, -32364(GP)
9D026370  01322023   SUBU A0, T1, S2
379:                 
380:                          frames_to_render += tick_diff;
381:                          gui_tick(tick_diff);
9D026374  0F4084D0   JAL gui_tick
9D026378  02048021   ADDU S0, S0, A0
382:                          last_ticks = nofrendo_ticks;
9D02637C  8F928194   LW S2, -32364(GP)
383:                       }
384:                 
385:                       if (true == nes.pause)
9D026380  262A38A8   ADDIU T2, S1, 14504
9D026384  8D4B0330   LW T3, 816(T2)
9D026388  15730005   BNE T3, S3, 0x9D0263A0
9D02638C  2A0C0002   SLTI T4, S0, 2
386:                       {
387:                          /* TODO: dim the screen, and pause/silence the apu */
388:                          system_video(true);
389:                          frames_to_render = 0;
390:                       }
391:                       else if (frames_to_render > 1)
9D0263A0  15800008   BNE T4, ZERO, 0x9D0263C4
9D0263A4  00000000   NOP
392:                       {
393:                          frames_to_render--;
9D0263A8  2610FFFF   ADDIU S0, S0, -1
394:                          nes_renderframe(false);
9D0263AC  0F40977E   JAL .LFB22, nes_renderframe, .LFE20
9D0263B0  00002021   ADDU A0, ZERO, ZERO
395:                          system_video(false);
396:                       }
397:                       else if ((1 == frames_to_render && true == nes.autoframeskip)
9D0263C4  16130005   BNE S0, S3, 0x9D0263DC
9D0263C8  262F38A8   ADDIU T7, S1, 14504
9D0263CC  262D38A8   ADDIU T5, S1, 14504
9D0263D0  8DAE0328   LW T6, 808(T5)
9D0263D4  11D30004   BEQ T6, S3, 0x9D0263E8
9D0263D8  00000000   NOP
398:                                || false == nes.autoframeskip)
9D0263DC  8DF80328   LW T8, 808(T7)
9D0263E0  17000006   BNE T8, ZERO, 0x9D0263FC
9D0263E4  262638A8   ADDIU A2, S1, 14504
399:                       {
400:                          frames_to_render = 0;
401:                          nes_renderframe(true);
9D0263E8  0F40977E   JAL .LFB22, nes_renderframe, .LFE20
9D0263EC  02602021   ADDU A0, S3, ZERO
402:                          system_video(true);
403:                       }
404:                    }
405:                 }
9D026408  8FB30020   LW S3, 32(SP)
9D02640C  8FB2001C   LW S2, 28(SP)
9D026410  8FB10018   LW S1, 24(SP)
9D026414  8FB00014   LW S0, 20(SP)
9D026418  03E00008   JR RA
9D02641C  27BD0028   ADDIU SP, SP, 40
406:                 
407:                 static void mem_trash(uint8 *buffer, int length)
408:                 {
409:                    int i;
410:                 
411:                    for (i = 0; i < length; i++)
9D026474  19400036   BLEZ T2, 0x9D026550
9D026478  01208021   ADDU S0, T1, ZERO
9D02647C  012A9021   ADDU S2, T1, T2
9D026480  00095827   NOR T3, ZERO, T1
9D026484  01726021   ADDU T4, T3, S2
9D026498  16120040   BNE S0, S2, 0x9D02659C
9D02649C  00000000   NOP
9D0264A0  0B409954   J 0x9D026550
9D0264A4  00000000   NOP
9D0264F0  1612FFED   BNE S0, S2, 0x9D0264A8
9D0264F4  00000000   NOP
9D0264F8  0B409954   J 0x9D026550
9D0264FC  00000000   NOP
9D026644  1612FF98   BNE S0, S2, 0x9D0264A8
9D026648  00000000   NOP
9D02664C  0B409954   J 0x9D026550
9D026650  00000000   NOP
412:                       buffer[i] = (uint8) rand();
9D026488  0F410684   JAL .Letext0, .LFE0, rand
9D02648C  31910007   ANDI S1, T4, 7
9D026490  A2020000   SB V0, 0(S0)
9D026494  26100001   ADDIU S0, S0, 1
9D0264A8  0F410684   JAL .Letext0, .LFE0, rand
9D0264AC  00000000   NOP
9D0264B0  0F410684   JAL .Letext0, .LFE0, rand
9D0264B4  A2020000   SB V0, 0(S0)
9D0264B8  0F410684   JAL .Letext0, .LFE0, rand
9D0264BC  A2020001   SB V0, 1(S0)
9D0264C0  0F410684   JAL .Letext0, .LFE0, rand
9D0264C4  A2020002   SB V0, 2(S0)
9D0264C8  0F410684   JAL .Letext0, .LFE0, rand
9D0264CC  A2020003   SB V0, 3(S0)
9D0264D0  0F410684   JAL .Letext0, .LFE0, rand
9D0264D4  A2020004   SB V0, 4(S0)
9D0264D8  0F410684   JAL .Letext0, .LFE0, rand
9D0264DC  A2020005   SB V0, 5(S0)
9D0264E0  0F410684   JAL .Letext0, .LFE0, rand
9D0264E4  A2020006   SB V0, 6(S0)
9D0264E8  A2020007   SB V0, 7(S0)
9D0264EC  26100008   ADDIU S0, S0, 8
9D0265D4  0F410684   JAL .Letext0, .LFE0, rand
9D0265D8  00000000   NOP
9D0265DC  A2020000   SB V0, 0(S0)
9D0265E0  26100001   ADDIU S0, S0, 1
9D0265E4  0F410684   JAL .Letext0, .LFE0, rand
9D0265E8  00000000   NOP
9D0265EC  A2020000   SB V0, 0(S0)
9D0265F0  26100001   ADDIU S0, S0, 1
9D0265F4  0F410684   JAL .Letext0, .LFE0, rand
9D0265F8  00000000   NOP
9D0265FC  A2020000   SB V0, 0(S0)
9D026600  26100001   ADDIU S0, S0, 1
9D026604  0F410684   JAL .Letext0, .LFE0, rand
9D026608  00000000   NOP
9D02660C  A2020000   SB V0, 0(S0)
9D026610  26100001   ADDIU S0, S0, 1
9D026614  0F410684   JAL .Letext0, .LFE0, rand
9D026618  00000000   NOP
9D02661C  A2020000   SB V0, 0(S0)
9D026620  26100001   ADDIU S0, S0, 1
9D026624  0F410684   JAL .Letext0, .LFE0, rand
9D026628  00000000   NOP
9D02662C  A2020000   SB V0, 0(S0)
9D026630  26100001   ADDIU S0, S0, 1
9D026634  0F410684   JAL .Letext0, .LFE0, rand
9D026638  00000000   NOP
9D02663C  A2020000   SB V0, 0(S0)
9D026640  26100001   ADDIU S0, S0, 1
413:                 }
414:                 
415:                 /* Reset NES hardware */
416:                 void nes_reset(int reset_type)
417:                 {
9D026420  27BDFFE0   ADDIU SP, SP, -32
9D026424  AFBF001C   SW RA, 28(SP)
9D026428  AFB20018   SW S2, 24(SP)
9D02642C  AFB10014   SW S1, 20(SP)
9D026430  AFB00010   SW S0, 16(SP)
418:                    if (HARD_RESET == reset_type)
9D026434  24020001   ADDIU V0, ZERO, 1
9D026438  14820037   BNE A0, V0, 0x9D026518
9D02643C  00808021   ADDU S0, A0, ZERO
419:                    {
420:                       memset(nes.cpu->mem_page[0], 0, NES_RAMSIZE);
9D026440  3C11A001   LUI S1, -24575
9D026444  8E2538A8   LW A1, 14504(S1)
9D026448  8CA40000   LW A0, 0(A1)
9D02644C  00002821   ADDU A1, ZERO, ZERO
9D026450  0F4100B4   JAL .Letext0, .LFE0, memset
9D026454  24060800   ADDIU A2, ZERO, 2048
421:                       if (nes.rominfo->vram)
9D026458  262738A8   ADDIU A3, S1, 14504
9D02645C  8CE80310   LW T0, 784(A3)
9D026460  8D09000C   LW T1, 12(T0)
9D026464  1120003A   BEQ T1, ZERO, 0x9D026550
9D026468  00000000   NOP
422:                          mem_trash(nes.rominfo->vram, 0x2000 * nes.rominfo->vram_banks);
9D02646C  8D12001C   LW S2, 28(T0)
9D026470  00125340   SLL T2, S2, 13
423:                    }
424:                 
425:                    apu_reset();
9D026518  0F407FCF   JAL apu_reset
9D02651C  00000000   NOP
9D026550  0F407FCF   JAL apu_reset
9D026554  00000000   NOP
426:                    ppu_reset(reset_type);
9D026520  0F40591F   JAL ppu_reset
9D026524  02002021   ADDU A0, S0, ZERO
9D026558  0F40591F   JAL ppu_reset
9D02655C  24040001   ADDIU A0, ZERO, 1
427:                    mmc_reset();
9D026528  0F40CB06   JAL mmc_reset
9D02652C  00000000   NOP
9D026560  0F40CB06   JAL mmc_reset
9D026564  00000000   NOP
428:                    nes6502_reset();
9D026530  0F40568F   JAL nes6502_reset
9D026534  00000000   NOP
9D026568  0F40568F   JAL nes6502_reset
9D02656C  00000000   NOP
429:                 
430:                    nes.scanline = 241;
9D026538  240300F1   ADDIU V1, ZERO, 241
9D02653C  3C04A001   LUI A0, -24575
9D026540  AC833BC8   SW V1, 15304(A0)
9D026570  240300F1   ADDIU V1, ZERO, 241
9D026574  3C02A001   LUI V0, -24575
9D026578  AC433BC8   SW V1, 15304(V0)
431:                 
432:                    gui_sendmsg(GUI_GREEN, "NES %s", 
9D026500  240400C6   ADDIU A0, ZERO, 198
9D026504  3C059D04   LUI A1, -25340
9D026508  0F408633   JAL gui_sendmsg
9D02650C  24A5240C   ADDIU A1, A1, 9228
9D026544  3C069D04   LUI A2, -25340
9D026548  0B409940   J 0x9D026500
9D02654C  24C62404   ADDIU A2, A2, 9220
9D02657C  3C049D04   LUI A0, -25340
9D026580  0B409940   J 0x9D026500
9D026584  248623F8   ADDIU A2, A0, 9208
433:                                (HARD_RESET == reset_type) ? "powered on" : "reset");
434:                 }
9D026510  0B409962   J 0x9D026588
9D026514  8FBF001C   LW RA, 28(SP)
9D026588  8FB20018   LW S2, 24(SP)
9D02658C  8FB10014   LW S1, 20(SP)
9D026590  8FB00010   LW S0, 16(SP)
9D026594  03E00008   JR RA
9D026598  27BD0020   ADDIU SP, SP, 32
9D02659C  1220FFC2   BEQ S1, ZERO, 0x9D0264A8
9D0265A0  240D0001   ADDIU T5, ZERO, 1
9D0265A4  122D0023   BEQ S1, T5, 0x9D026634
9D0265A8  240E0002   ADDIU T6, ZERO, 2
9D0265AC  122E001D   BEQ S1, T6, 0x9D026624
9D0265B0  240F0003   ADDIU T7, ZERO, 3
9D0265B4  122F0017   BEQ S1, T7, 0x9D026614
9D0265B8  24180004   ADDIU T8, ZERO, 4
9D0265BC  12380011   BEQ S1, T8, 0x9D026604
9D0265C0  24190005   ADDIU T9, ZERO, 5
9D0265C4  1239000B   BEQ S1, T9, 0x9D0265F4
9D0265C8  241F0006   ADDIU RA, ZERO, 6
9D0265CC  123F0005   BEQ S1, RA, 0x9D0265E4
9D0265D0  00000000   NOP
9D0265D4  0F410684   JAL .Letext0, .LFE0, rand
9D0265D8  00000000   NOP
9D0265DC  A2020000   SB V0, 0(S0)
9D0265E0  26100001   ADDIU S0, S0, 1
9D0265E4  0F410684   JAL .Letext0, .LFE0, rand
9D0265E8  00000000   NOP
9D0265EC  A2020000   SB V0, 0(S0)
9D0265F0  26100001   ADDIU S0, S0, 1
9D0265F4  0F410684   JAL .Letext0, .LFE0, rand
9D0265F8  00000000   NOP
9D0265FC  A2020000   SB V0, 0(S0)
9D026600  26100001   ADDIU S0, S0, 1
9D026604  0F410684   JAL .Letext0, .LFE0, rand
9D026608  00000000   NOP
9D02660C  A2020000   SB V0, 0(S0)
9D026610  26100001   ADDIU S0, S0, 1
9D026614  0F410684   JAL .Letext0, .LFE0, rand
9D026618  00000000   NOP
9D02661C  A2020000   SB V0, 0(S0)
9D026620  26100001   ADDIU S0, S0, 1
9D026624  0F410684   JAL .Letext0, .LFE0, rand
9D026628  00000000   NOP
9D02662C  A2020000   SB V0, 0(S0)
9D026630  26100001   ADDIU S0, S0, 1
9D026634  0F410684   JAL .Letext0, .LFE0, rand
9D026638  00000000   NOP
9D02663C  A2020000   SB V0, 0(S0)
9D026640  26100001   ADDIU S0, S0, 1
9D026644  1612FF98   BNE S0, S2, 0x9D0264A8
9D026648  00000000   NOP
9D02664C  0B409954   J 0x9D026550
9D026650  00000000   NOP
435:                 
436:                 void nes_destroy(nes_t **machine)
437:                 {
9D026654  27BDFFE8   ADDIU SP, SP, -24
9D026658  AFBF0014   SW RA, 20(SP)
9D02665C  AFB00010   SW S0, 16(SP)
9D026660  00808021   ADDU S0, A0, ZERO
438:                    if (*machine)
9D026664  8C840000   LW A0, 0(A0)
9D026668  1080001B   BEQ A0, ZERO, 0x9D0266D8
9D02666C  8FBF0014   LW RA, 20(SP)
439:                    {
440:                       rom_free(&(*machine)->rominfo);
9D026670  0F40C2F7   JAL rom_free
9D026674  24840310   ADDIU A0, A0, 784
441:                       mmc_destroy(&(*machine)->mmc);
9D026678  8E020000   LW V0, 0(S0)
9D02667C  0F40CB4C   JAL mmc_destroy
9D026680  2444030C   ADDIU A0, V0, 780
442:                       ppu_destroy(&(*machine)->ppu);
9D026684  8E030000   LW V1, 0(S0)
9D026688  0F4058A6   JAL ppu_destroy
9D02668C  24640304   ADDIU A0, V1, 772
443:                       apu_destroy(&(*machine)->apu);
9D026690  8E050000   LW A1, 0(S0)
9D026694  0F40810E   JAL apu_destroy
9D026698  24A40308   ADDIU A0, A1, 776
444:                 //      bmp_destroy(&(*machine)->vidbuf);
445:                       if ((*machine)->cpu)
9D02669C  8E060000   LW A2, 0(S0)
9D0266A0  8CC40000   LW A0, 0(A2)
9D0266A4  10800008   BEQ A0, ZERO, .LVL116
9D0266A8  00000000   NOP
446:                       {
447:                          if ((*machine)->cpu->mem_page[0])
9D0266AC  8C870000   LW A3, 0(A0)
9D0266B0  10E00003   BEQ A3, ZERO, .LVL115
9D0266B4  00000000   NOP
448:                             free((*machine)->cpu->mem_page[0]);
9D0266B8  0F40F31D   JAL _my_free
9D0266BC  00000000   NOP
449:                          free((*machine)->cpu);
9D0266C0  0F40F31D   JAL _my_free
9D0266C4  8E040000   LW A0, 0(S0)
450:                       }
451:                 
452:                       free(*machine);
9D0266C8  0F40F31D   JAL _my_free
9D0266CC  02002021   ADDU A0, S0, ZERO
453:                       *machine = NULL;
9D0266D0  AE000000   SW ZERO, 0(S0)
454:                    }
455:                 }
9D0266D4  8FBF0014   LW RA, 20(SP)
9D0266D8  8FB00010   LW S0, 16(SP)
9D0266DC  03E00008   JR RA
9D0266E0  27BD0018   ADDIU SP, SP, 24
456:                 
457:                 void nes_poweroff(void)
458:                 {
459:                    nes.poweroff = true;
9D0266E4  24030001   ADDIU V1, ZERO, 1
9D0266E8  3C02A001   LUI V0, -24575
9D0266EC  03E00008   JR RA
9D0266F0  AC433BD4   SW V1, 15316(V0)
460:                 }
461:                 
462:                 void nes_togglepause(void)
463:                 {
464:                    nes.pause ^= true;
9D0266F4  3C02A001   LUI V0, -24575
9D0266F8  244438A8   ADDIU A0, V0, 14504
9D0266FC  8C830330   LW V1, 816(A0)
9D026700  38650001   XORI A1, V1, 1
9D026704  03E00008   JR RA
9D026708  AC850330   SW A1, 816(A0)
465:                 }
466:                 
467:                 /* insert a cart into the NES */
468:                 int nes_insertcart(const char *file_ptr, nes_t *machine)
469:                 {
9D02670C  27BDFFE0   ADDIU SP, SP, -32
9D026710  AFBF001C   SW RA, 28(SP)
9D026714  AFB10018   SW S1, 24(SP)
9D026718  AFB00014   SW S0, 20(SP)
9D02671C  00808821   ADDU S1, A0, ZERO
9D026720  AFA50024   SW A1, 36(SP)
470:                    nes6502_setcontext(machine->cpu);
9D026724  0F4030B1   JAL nes6502_setcontext
9D026728  8CA40000   LW A0, 0(A1)
471:                 
472:                    /* rom file */
473:                    machine->rominfo = rom_load(file_ptr);
9D02672C  8FB00024   LW S0, 36(SP)
9D026730  0F40C333   JAL rom_load
9D026734  02202021   ADDU A0, S1, ZERO
9D026738  AE020310   SW V0, 784(S0)
474:                    if (NULL == machine->rominfo)
9D02673C  8FB10024   LW S1, 36(SP)
9D026740  8E220310   LW V0, 784(S1)
9D026744  10400146   BEQ V0, ZERO, .L112
9D026748  00000000   NOP
475:                       goto _fail;
476:                 
477:                    /* map cart's SRAM to CPU $6000-$7FFF */
478:                    if (machine->rominfo->sram)
9D02674C  8C440008   LW A0, 8(V0)
9D026750  10800008   BEQ A0, ZERO, 0x9D026774
9D026754  00000000   NOP
479:                    {
480:                       machine->cpu->mem_page[6] = machine->rominfo->sram;
9D026758  8E230000   LW V1, 0(S1)
9D02675C  AC640018   SW A0, 24(V1)
481:                       machine->cpu->mem_page[7] = machine->rominfo->sram + 0x1000;
9D026760  8E250000   LW A1, 0(S1)
9D026764  8E260310   LW A2, 784(S1)
9D026768  8CC70008   LW A3, 8(A2)
9D02676C  24E81000   ADDIU T0, A3, 4096
9D026770  ACA8001C   SW T0, 28(A1)
482:                    }
483:                 
484:                    /* mapper */
485:                    machine->mmc = mmc_create(machine->rominfo);
9D026774  0F40CB57   JAL mmc_create
9D026778  8E240310   LW A0, 784(S1)
9D02677C  AE22030C   SW V0, 780(S1)
486:                    if (NULL == machine->mmc)
9D026780  8FA90024   LW T1, 36(SP)
9D026784  8D2A030C   LW T2, 780(T1)
9D026788  11400135   BEQ T2, ZERO, .L112
9D02678C  00000000   NOP
487:                       goto _fail;
488:                 
489:                    /* if there's VRAM, let the PPU know */
490:                    if (NULL != machine->rominfo->vram)
9D026790  8D2B0310   LW T3, 784(T1)
9D026794  8D6C000C   LW T4, 12(T3)
9D026798  11800003   BEQ T4, ZERO, 0x9D0267A8
9D02679C  240E0001   ADDIU T6, ZERO, 1
491:                       machine->ppu->vram_present = true;
9D0267A0  8D2D0304   LW T5, 772(T1)
9D0267A4  ADAE1DB0   SW T6, 7600(T5)
492:                    
493:                    apu_setext(machine->apu, machine->mmc->intf->sound_ext);
9D0267A8  8D2F030C   LW T7, 780(T1)
9D0267AC  8DF80000   LW T8, 0(T7)
9D0267B0  8D240308   LW A0, 776(T1)
9D0267B4  0F408123   JAL apu_setext
9D0267B8  8F050024   LW A1, 36(T8)
494:                    
495:                    build_address_handlers(machine);
9D0267BC  8FB10024   LW S1, 36(SP)
496:                 
497:                    nes_setcontext(machine);
9D026C48  0F409854   JAL nes_setcontext
9D026C4C  8FA40024   LW A0, 36(SP)
498:                 
499:                    nes_reset(HARD_RESET);
9D026C50  0F409908   JAL nes_reset
9D026C54  24040001   ADDIU A0, ZERO, 1
500:                    return 0;
9D026C58  0B409B46   J 0x9D026D18
9D026C5C  00001021   ADDU V0, ZERO, ZERO
501:                 
502:                 _fail:
503:                    nes_destroy(&machine);
9D026C60  0F409995   JAL nes_destroy
9D026C64  27A40024   ADDIU A0, SP, 36
504:                    return -1;
9D026C68  0B409B46   J 0x9D026D18
9D026C6C  2402FFFF   ADDIU V0, ZERO, -1
505:                 }
9D026D18  8FBF001C   LW RA, 28(SP)
9D026D1C  8FB10018   LW S1, 24(SP)
9D026D20  8FB00014   LW S0, 20(SP)
9D026D24  03E00008   JR RA
9D026D28  27BD0020   ADDIU SP, SP, 32
9D026D2C  884C0003   LWL T4, 3(V0)
9D026D30  984C0000   LWR T4, 0(V0)
9D026D34  884D0007   LWL T5, 7(V0)
9D026D38  984D0004   LWR T5, 4(V0)
9D026D3C  8848000B   LWL T0, 11(V0)
9D026D40  98480008   LWR T0, 8(V0)
9D026D44  A92C0003   SWL T4, 3(T1)
9D026D48  B92C0000   SWR T4, 0(T1)
9D026D4C  A92D0007   SWL T5, 7(T1)
9D026D50  B92D0004   SWR T5, 4(T1)
9D026D54  A928000B   SWL T0, 11(T1)
9D026D58  B9280008   SWR T0, 8(T1)
9D026D5C  24840001   ADDIU A0, A0, 1
9D026D60  8E0E0020   LW T6, 32(S0)
9D026D64  01C31021   ADDU V0, T6, V1
9D026D68  8C5F0008   LW RA, 8(V0)
9D026D6C  17E0FF88   BNE RA, ZERO, 0x9D026B90
9D026D70  2463000C   ADDIU V1, V1, 12
9D026D74  0B409AF5   J 0x9D026BD4
9D026D78  00048080   SLL S0, A0, 2
9D026D7C  899F0003   LWL RA, 3(T4)
9D026D80  999F0000   LWR RA, 0(T4)
9D026D84  89880007   LWL T0, 7(T4)
9D026D88  99880004   LWR T0, 4(T4)
9D026D8C  8984000B   LWL A0, 11(T4)
9D026D90  99840008   LWR A0, 8(T4)
9D026D94  A9DF0003   SWL RA, 3(T6)
9D026D98  B9DF0000   SWR RA, 0(T6)
9D026D9C  A9C80007   SWL T0, 7(T6)
9D026DA0  B9C80004   SWR T0, 4(T6)
9D026DA4  A9C4000B   SWL A0, 11(T6)
9D026DA8  B9C40008   SWR A0, 8(T6)
9D026DAC  27040001   ADDIU A0, T8, 1
9D026DB0  8E190020   LW T9, 32(S0)
9D026DB4  032D1021   ADDU V0, T9, T5
9D026DB8  8C4A0008   LW T2, 8(V0)
9D026DBC  1540FF74   BNE T2, ZERO, 0x9D026B90
9D026DC0  25A3000C   ADDIU V1, T5, 12
9D026DC4  0B409AF5   J 0x9D026BD4
9D026DC8  00048080   SLL S0, A0, 2
9D026DCC  88470003   LWL A3, 3(V0)
9D026DD0  98470000   LWR A3, 0(V0)
9D026DD4  88460007   LWL A2, 7(V0)
9D026DD8  98460004   LWR A2, 4(V0)
9D026DDC  884B000B   LWL T3, 11(V0)
9D026DE0  984B0008   LWR T3, 8(V0)
9D026DE4  A9470003   SWL A3, 3(T2)
9D026DE8  B9470000   SWR A3, 0(T2)
9D026DEC  A9460007   SWL A2, 7(T2)
9D026DF0  B9460004   SWR A2, 4(T2)
9D026DF4  A94B000B   SWL T3, 11(T2)
9D026DF8  B94B0008   SWR T3, 8(T2)
9D026DFC  24840001   ADDIU A0, A0, 1
9D026E00  8E020024   LW V0, 36(S0)
9D026E04  8C490014   LW T1, 20(V0)
9D026E08  01231021   ADDU V0, T1, V1
9D026E0C  8C4F0008   LW T7, 8(V0)
9D026E10  15E0FF33   BNE T7, ZERO, 0x9D026AE0
9D026E14  2463000C   ADDIU V1, V1, 12
9D026E18  0B409ACB   J 0x9D026B2C
9D026E1C  8E020020   LW V0, 32(S0)
9D026E20  89690003   LWL T1, 3(T3)
9D026E24  99690000   LWR T1, 0(T3)
9D026E28  89680007   LWL T0, 7(T3)
9D026E2C  99680004   LWR T0, 4(T3)
9D026E30  8964000B   LWL A0, 11(T3)
9D026E34  99640008   LWR A0, 8(T3)
9D026E38  AB090003   SWL T1, 3(T8)
9D026E3C  BB090000   SWR T1, 0(T8)
9D026E40  AB080007   SWL T0, 7(T8)
9D026E44  BB080004   SWR T0, 4(T8)
9D026E48  AB04000B   SWL A0, 11(T8)
9D026E4C  BB040008   SWR A0, 8(T8)
9D026E50  25440001   ADDIU A0, T2, 1
9D026E54  8E0C0024   LW T4, 36(S0)
9D026E58  8D8D0014   LW T5, 20(T4)
9D026E5C  01AF1021   ADDU V0, T5, T7
9D026E60  8C4E0008   LW T6, 8(V0)
9D026E64  15C0FF1E   BNE T6, ZERO, 0x9D026AE0
9D026E68  25E3000C   ADDIU V1, T7, 12
9D026E6C  0B409ACB   J 0x9D026B2C
9D026E70  8E020020   LW V0, 32(S0)
9D026E74  88470003   LWL A3, 3(V0)
9D026E78  98470000   LWR A3, 0(V0)
9D026E7C  88460007   LWL A2, 7(V0)
9D026E80  98460004   LWR A2, 4(V0)
9D026E84  8848000B   LWL T0, 11(V0)
9D026E88  98480008   LWR T0, 8(V0)
9D026E8C  AB270003   SWL A3, 3(T9)
9D026E90  BB270000   SWR A3, 0(T9)
9D026E94  AB260007   SWL A2, 7(T9)
9D026E98  BB260004   SWR A2, 4(T9)
9D026E9C  AB28000B   SWL T0, 11(T9)
9D026EA0  BB280008   SWR T0, 8(T9)
9D026EA4  24840001   ADDIU A0, A0, 1
9D026EA8  8E05001C   LW A1, 28(S0)
9D026EAC  00A31021   ADDU V0, A1, V1
9D026EB0  8C4A0008   LW T2, 8(V0)
9D026EB4  1540FEAF   BNE T2, ZERO, 0x9D026974
9D026EB8  2463000C   ADDIU V1, V1, 12
9D026EBC  0B409A6E   J 0x9D0269B8
9D026EC0  00047880   SLL T7, A0, 2
9D026EC4  88CA0003   LWL T2, 3(A2)
9D026EC8  98CA0000   LWR T2, 0(A2)
9D026ECC  88C80007   LWL T0, 7(A2)
9D026ED0  98C80004   LWR T0, 4(A2)
9D026ED4  88C4000B   LWL A0, 11(A2)
9D026ED8  98C40008   LWR A0, 8(A2)
9D026EDC  A8AA0003   SWL T2, 3(A1)
9D026EE0  B8AA0000   SWR T2, 0(A1)
9D026EE4  A8A80007   SWL T0, 7(A1)
9D026EE8  B8A80004   SWR T0, 4(A1)
9D026EEC  A8A4000B   SWL A0, 11(A1)
9D026EF0  B8A40008   SWR A0, 8(A1)
9D026EF4  27E40001   ADDIU A0, RA, 1
9D026EF8  8E0B001C   LW T3, 28(S0)
9D026EFC  01671021   ADDU V0, T3, A3
9D026F00  8C490008   LW T1, 8(V0)
9D026F04  1520FE9B   BNE T1, ZERO, 0x9D026974
9D026F08  24E3000C   ADDIU V1, A3, 12
9D026F0C  0B409A6E   J 0x9D0269B8
9D026F10  00047880   SLL T7, A0, 2
9D026F14  8B2D0003   LWL T5, 3(T9)
9D026F18  9B2D0000   LWR T5, 0(T9)
9D026F1C  8B2E0007   LWL T6, 7(T9)
9D026F20  9B2E0004   LWR T6, 4(T9)
9D026F24  8B2F000B   LWL T7, 11(T9)
9D026F28  9B2F0008   LWR T7, 8(T9)
9D026F2C  A98D0003   SWL T5, 3(T4)
9D026F30  B98D0000   SWR T5, 0(T4)
9D026F34  A98E0007   SWL T6, 7(T4)
9D026F38  B98E0004   SWR T6, 4(T4)
9D026F3C  A98F000B   SWL T7, 11(T4)
9D026F40  B98F0008   SWR T7, 8(T4)
9D026F44  24840001   ADDIU A0, A0, 1
9D026F48  8E190024   LW T9, 36(S0)
9D026F4C  8F220010   LW V0, 16(T9)
9D026F50  0043C821   ADDU T9, V0, V1
9D026F54  8F3F0008   LW RA, 8(T9)
9D026F58  17E0FE5A   BNE RA, ZERO, 0x9D0268C4
9D026F5C  2463000C   ADDIU V1, V1, 12
9D026F60  0B409A44   J 0x9D026910
9D026F64  8E02001C   LW V0, 28(S0)
9D026F68  89FF0003   LWL RA, 3(T7)
9D026F6C  99FF0000   LWR RA, 0(T7)
9D026F70  89E80007   LWL T0, 7(T7)
9D026F74  99E80004   LWR T0, 4(T7)
9D026F78  89E4000B   LWL A0, 11(T7)
9D026F7C  99E40008   LWR A0, 8(T7)
9D026F80  A85F0003   SWL RA, 3(V0)
9D026F84  B85F0000   SWR RA, 0(V0)
9D026F88  A8480007   SWL T0, 7(V0)
9D026F8C  B8480004   SWR T0, 4(V0)
9D026F90  A844000B   SWL A0, 11(V0)
9D026F94  B8440008   SWR A0, 8(V0)
9D026F98  25840001   ADDIU A0, T4, 1
9D026F9C  8E070024   LW A3, 36(S0)
9D026FA0  8CE60010   LW A2, 16(A3)
9D026FA4  00D8C821   ADDU T9, A2, T8
9D026FA8  8F250008   LW A1, 8(T9)
9D026FAC  14A0FE45   BNE A1, ZERO, 0x9D0268C4
9D026FB0  2703000C   ADDIU V1, T8, 12
9D026FB4  0B409A44   J 0x9D026910
9D026FB8  8E02001C   LW V0, 28(S0)
506:                 
507:                 
508:                 /* Initialize NES CPU, hardware, etc. */
509:                 nes_t *nes_create(void)
510:                 {
9D026FBC  27BDFFD8   ADDIU SP, SP, -40
9D026FC0  AFBF0024   SW RA, 36(SP)
9D026FC4  AFB00020   SW S0, 32(SP)
511:                    nes_t *machine;
512:                    sndinfo_t osd_sound;
513:                    int i;
514:                 
515:                    int sizee = sizeof(nes_t);
516:                    
517:                    machine = malloc(sizee);
9D026FC8  0F40F30A   JAL _my_malloc
9D026FCC  24040334   ADDIU A0, ZERO, 820
518:                    if (NULL == machine)
9D026FD0  1040005C   BEQ V0, ZERO, 0x9D027144
9D026FD4  AFA20010   SW V0, 16(SP)
519:                       return NULL;
9D027144  00001021   ADDU V0, ZERO, ZERO
520:                 
521:                    memset(machine, 0, sizeof(nes_t));
9D026FD8  00402021   ADDU A0, V0, ZERO
9D026FDC  00002821   ADDU A1, ZERO, ZERO
9D026FE0  0F4100B4   JAL .Letext0, .LFE0, memset
9D026FE4  24060334   ADDIU A2, ZERO, 820
522:                 
523:                    /* bitmap */
524:                    /* 8 pixel overdraw */
525:                 //   machine->vidbuf = bmp_create(NES_SCREEN_WIDTH, NES_SCREEN_HEIGHT, 8);
526:                 //   if (NULL == machine->vidbuf)
527:                 //      goto _fail;
528:                 
529:                    machine->autoframeskip = true;
9D026FE8  8FB00010   LW S0, 16(SP)
9D026FEC  24020001   ADDIU V0, ZERO, 1
9D026FF0  AE020328   SW V0, 808(S0)
530:                 
531:                    /* cpu */
532:                    machine->cpu = malloc(sizeof(nes6502_context));
9D026FF4  0F40F30A   JAL _my_malloc
9D026FF8  2404005C   ADDIU A0, ZERO, 92
9D026FFC  AE020000   SW V0, 0(S0)
533:                    if (NULL == machine->cpu)
9D027000  8FA30010   LW V1, 16(SP)
9D027004  8C640000   LW A0, 0(V1)
9D027008  1080004A   BEQ A0, ZERO, .L178
9D02700C  00002821   ADDU A1, ZERO, ZERO
534:                       goto _fail;
535:                 
536:                    memset(machine->cpu, 0, sizeof(nes6502_context));
9D027010  0F4100B4   JAL .Letext0, .LFE0, memset
9D027014  2406005C   ADDIU A2, ZERO, 92
537:                    
538:                    /* allocate 2kB RAM */
539:                    machine->cpu->mem_page[0] = malloc(NES_RAMSIZE);
9D027018  8FA40010   LW A0, 16(SP)
9D02701C  8C900000   LW S0, 0(A0)
9D027020  0F40F30A   JAL _my_malloc
9D027024  24040800   ADDIU A0, ZERO, 2048
9D027028  AE020000   SW V0, 0(S0)
540:                    if (NULL == machine->cpu->mem_page[0])
9D02702C  8FA50010   LW A1, 16(SP)
9D027030  8CA60000   LW A2, 0(A1)
9D027034  8CC70000   LW A3, 0(A2)
9D027038  10E0003E   BEQ A3, ZERO, .L178
9D02703C  8FB00010   LW S0, 16(SP)
541:                       goto _fail;
542:                 
543:                    /* point all pages at NULL for now */
544:                    for (i = 1; i < NES6502_NUMBANKS; i++)
545:                       machine->cpu->mem_page[i] = NULL;
9D027040  8E080000   LW T0, 0(S0)
9D027044  AD000004   SW ZERO, 4(T0)
9D027048  8E090000   LW T1, 0(S0)
9D02704C  AD200008   SW ZERO, 8(T1)
9D027050  8E0A0000   LW T2, 0(S0)
9D027054  AD40000C   SW ZERO, 12(T2)
9D027058  8E0B0000   LW T3, 0(S0)
9D02705C  AD600010   SW ZERO, 16(T3)
9D027060  8E0C0000   LW T4, 0(S0)
9D027064  AD800014   SW ZERO, 20(T4)
9D027068  8E0D0000   LW T5, 0(S0)
9D02706C  ADA00018   SW ZERO, 24(T5)
9D027070  8E0E0000   LW T6, 0(S0)
9D027074  ADC0001C   SW ZERO, 28(T6)
9D027078  8E0F0000   LW T7, 0(S0)
9D02707C  ADE00020   SW ZERO, 32(T7)
9D027080  8E180000   LW T8, 0(S0)
9D027084  AF000024   SW ZERO, 36(T8)
9D027088  8E190000   LW T9, 0(S0)
9D02708C  AF200028   SW ZERO, 40(T9)
9D027090  8E1F0000   LW RA, 0(S0)
9D027094  AFE0002C   SW ZERO, 44(RA)
9D027098  8E020000   LW V0, 0(S0)
9D02709C  AC400030   SW ZERO, 48(V0)
9D0270A0  8E030000   LW V1, 0(S0)
9D0270A4  AC600034   SW ZERO, 52(V1)
9D0270A8  8E040000   LW A0, 0(S0)
9D0270AC  AC800038   SW ZERO, 56(A0)
9D0270B0  8E050000   LW A1, 0(S0)
9D0270B4  ACA0003C   SW ZERO, 60(A1)
546:                 
547:                    machine->cpu->read_handler = machine->readhandler;
9D0270B8  8E060000   LW A2, 0(S0)
9D0270BC  26070004   ADDIU A3, S0, 4
9D0270C0  ACC70040   SW A3, 64(A2)
548:                    machine->cpu->write_handler = machine->writehandler;
9D0270C4  8E080000   LW T0, 0(S0)
9D0270C8  26090184   ADDIU T1, S0, 388
9D0270CC  AD090044   SW T1, 68(T0)
549:                 
550:                    /* apu */
551:                    //osd_getsoundinfo(&osd_sound);
552:                    machine->apu = apu_create(0, osd_sound.sample_rate, NES_REFRESH_RATE, osd_sound.bps);
9D0270D0  00002021   ADDU A0, ZERO, ZERO
9D0270D4  8FA50014   LW A1, 20(SP)
9D0270D8  2406003C   ADDIU A2, ZERO, 60
9D0270DC  0F4080CD   JAL apu_create
9D0270E0  8FA70018   LW A3, 24(SP)
9D0270E4  AE020308   SW V0, 776(S0)
553:                 
554:                    if (NULL == machine->apu)
9D0270E8  8FB00010   LW S0, 16(SP)
9D0270EC  8E0A0308   LW T2, 776(S0)
9D0270F0  11400010   BEQ T2, ZERO, .L178
9D0270F4  3C0B9D02   LUI T3, -25342
555:                       goto _fail;
556:                 
557:                    /* set the IRQ routines */
558:                    machine->apu->irq_callback = nes_irq;
9D0270F8  256C5D7C   ADDIU T4, T3, 23932
9D0270FC  AD4C0160   SW T4, 352(T2)
559:                    machine->apu->irqclear_callback = nes_clearfiq;
9D027100  8E0D0308   LW T5, 776(S0)
9D027104  3C0E9D02   LUI T6, -25342
9D027108  25CF5D58   ADDIU T7, T6, 23896
560:                 
561:                    /* ppu */
562:                    machine->ppu = ppu_create();
9D02710C  0F405C60   JAL ppu_create
9D027110  ADAF0164   SW T7, 356(T5)
9D027114  AE020304   SW V0, 772(S0)
563:                    if (NULL == machine->ppu)
9D027118  8FA20010   LW V0, 16(SP)
9D02711C  8C580304   LW T8, 772(V0)
9D027120  13000004   BEQ T8, ZERO, .L178
9D027124  00000000   NOP
564:                       goto _fail;
565:                 
566:                    machine->poweroff = false;
9D027128  AC40032C   SW ZERO, 812(V0)
567:                    machine->pause = false;
568:                 
569:                    return machine;
9D02712C  0B409C52   J 0x9D027148
9D027130  AC400330   SW ZERO, 816(V0)
570:                 
571:                 _fail:
572:                    nes_destroy(&machine);
9D027134  0F409995   JAL nes_destroy
9D027138  27A40010   ADDIU A0, SP, 16
573:                    return NULL;
9D02713C  0B409C52   J 0x9D027148
9D027140  00001021   ADDU V0, ZERO, ZERO
574:                 }
9D027148  8FBF0024   LW RA, 36(SP)
9D02714C  8FB00020   LW S0, 32(SP)
9D027150  03E00008   JR RA
9D027154  27BD0028   ADDIU SP, SP, 40
575:                 
576:                 /*
577:                 ** $Log: nes.c,v $
578:                 ** Revision 1.2  2001/04/27 14:37:11  neil
579:                 ** wheeee
580:                 **
581:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
582:                 ** initial
583:                 **
584:                 ** Revision 1.18  2000/11/29 12:58:23  matt
585:                 ** timing/fiq fixes
586:                 **
587:                 ** Revision 1.17  2000/11/27 19:36:15  matt
588:                 ** more timing fixes
589:                 **
590:                 ** Revision 1.16  2000/11/26 16:13:13  matt
591:                 ** slight fix (?) to nes_fiq
592:                 **
593:                 ** Revision 1.15  2000/11/26 15:51:13  matt
594:                 ** frame IRQ emulation
595:                 **
596:                 ** Revision 1.14  2000/11/25 20:30:39  matt
597:                 ** scanline emulation simplifications/timing fixes
598:                 **
599:                 ** Revision 1.13  2000/11/25 01:53:42  matt
600:                 ** bool stinks sometimes
601:                 **
602:                 ** Revision 1.12  2000/11/21 13:28:40  matt
603:                 ** take care to zero allocated mem
604:                 **
605:                 ** Revision 1.11  2000/11/20 13:23:32  matt
606:                 ** nofrendo.c now handles timer
607:                 **
608:                 ** Revision 1.10  2000/11/09 14:07:27  matt
609:                 ** state load fixed, state save mostly fixed
610:                 **
611:                 ** Revision 1.9  2000/11/05 22:19:37  matt
612:                 ** pause buglet fixed
613:                 **
614:                 ** Revision 1.8  2000/11/05 06:27:09  matt
615:                 ** thinlib spawns changes
616:                 **
617:                 ** Revision 1.7  2000/10/29 14:36:45  matt
618:                 ** nes_clearframeirq is static
619:                 **
620:                 ** Revision 1.6  2000/10/28 15:20:41  matt
621:                 ** irq callbacks in nes_apu
622:                 **
623:                 ** Revision 1.5  2000/10/27 12:55:58  matt
624:                 ** nes6502 now uses 4kB banks across the boards
625:                 **
626:                 ** Revision 1.4  2000/10/25 13:44:02  matt
627:                 ** no more silly define names
628:                 **
629:                 ** Revision 1.3  2000/10/25 01:23:08  matt
630:                 ** basic system autodetection
631:                 **
632:                 ** Revision 1.2  2000/10/25 00:23:16  matt
633:                 ** makefiles updated for new directory structure
634:                 **
635:                 ** Revision 1.1  2000/10/24 12:20:28  matt
636:                 ** changed directory structure
637:                 **
638:                 ** Revision 1.50  2000/10/23 17:51:09  matt
639:                 ** adding fds support
640:                 **
641:                 ** Revision 1.49  2000/10/23 15:53:08  matt
642:                 ** better system handling
643:                 **
644:                 ** Revision 1.48  2000/10/22 20:02:29  matt
645:                 ** autoframeskip bugfix
646:                 **
647:                 ** Revision 1.47  2000/10/22 19:16:15  matt
648:                 ** more sane timer ISR / autoframeskip
649:                 **
650:                 ** Revision 1.46  2000/10/21 19:26:59  matt
651:                 ** many more cleanups
652:                 **
653:                 ** Revision 1.45  2000/10/17 12:00:56  matt
654:                 ** selectable apu base frequency
655:                 **
656:                 ** Revision 1.44  2000/10/10 13:58:14  matt
657:                 ** stroustrup squeezing his way in the door
658:                 **
659:                 ** Revision 1.43  2000/10/10 13:05:30  matt
660:                 ** Mr. Clean makes a guest appearance
661:                 **
662:                 ** Revision 1.42  2000/10/08 17:53:37  matt
663:                 ** minor accuracy changes
664:                 **
665:                 ** Revision 1.41  2000/09/18 02:09:12  matt
666:                 ** -pedantic is your friend
667:                 **
668:                 ** Revision 1.40  2000/09/15 13:38:39  matt
669:                 ** changes for optimized apu core
670:                 **
671:                 ** Revision 1.39  2000/09/15 04:58:07  matt
672:                 ** simplifying and optimizing APU core
673:                 **
674:                 ** Revision 1.38  2000/09/08 11:57:29  matt
675:                 ** no more nes_fiq
676:                 **
677:                 ** Revision 1.37  2000/08/31 02:39:01  matt
678:                 ** moved dos stuff in here (temp)
679:                 **
680:                 ** Revision 1.36  2000/08/16 02:51:55  matt
681:                 ** random cleanups
682:                 **
683:                 ** Revision 1.35  2000/08/11 02:43:50  matt
684:                 ** moved frame irq stuff out of APU into here
685:                 **
686:                 ** Revision 1.34  2000/08/11 01:42:43  matt
687:                 ** change to OSD sound info interface
688:                 **
689:                 ** Revision 1.33  2000/07/31 04:27:59  matt
690:                 ** one million cleanups
691:                 **
692:                 ** Revision 1.32  2000/07/30 04:32:32  matt
693:                 ** emulation of the NES frame IRQ
694:                 **
695:                 ** Revision 1.31  2000/07/27 04:07:14  matt
696:                 ** cleaned up the neighborhood lawns
697:                 **
698:                 ** Revision 1.30  2000/07/27 03:59:52  neil
699:                 ** pausing tweaks, during fullscreen toggles
700:                 **
701:                 ** Revision 1.29  2000/07/27 03:19:22  matt
702:                 ** just a little cleaner, that's all
703:                 **
704:                 ** Revision 1.28  2000/07/27 02:55:23  matt
705:                 ** nes_emulate went through detox
706:                 **
707:                 ** Revision 1.27  2000/07/27 02:49:18  matt
708:                 ** cleaner flow in nes_emulate
709:                 **
710:                 ** Revision 1.26  2000/07/27 01:17:09  matt
711:                 ** nes_insertrom -> nes_insertcart
712:                 **
713:                 ** Revision 1.25  2000/07/26 21:36:14  neil
714:                 ** Big honkin' change -- see the mailing list
715:                 **
716:                 ** Revision 1.24  2000/07/25 02:25:53  matt
717:                 ** safer xxx_destroy calls
718:                 **
719:                 ** Revision 1.23  2000/07/24 04:32:40  matt
720:                 ** autoframeskip bugfix
721:                 **
722:                 ** Revision 1.22  2000/07/23 15:13:48  matt
723:                 ** apu API change, autoframeskip part of nes_t struct
724:                 **
725:                 ** Revision 1.21  2000/07/21 02:44:41  matt
726:                 ** merged osd_getinput and osd_gethostinput
727:                 **
728:                 ** Revision 1.20  2000/07/17 05:12:55  matt
729:                 ** nes_ppu.c is no longer a scary place to be-- cleaner & faster
730:                 **
731:                 ** Revision 1.19  2000/07/17 01:52:28  matt
732:                 ** made sure last line of all source files is a newline
733:                 **
734:                 ** Revision 1.18  2000/07/15 23:51:23  matt
735:                 ** hack for certain filthy NES titles
736:                 **
737:                 ** Revision 1.17  2000/07/11 04:31:54  matt
738:                 ** less magic number nastiness for screen dimensions
739:                 **
740:                 ** Revision 1.16  2000/07/11 02:38:25  matt
741:                 ** encapsulated memory address handlers into nes/nsf
742:                 **
743:                 ** Revision 1.15  2000/07/10 13:50:49  matt
744:                 ** added function nes_irq()
745:                 **
746:                 ** Revision 1.14  2000/07/10 05:27:55  matt
747:                 ** cleaned up mapper-specific callbacks
748:                 **
749:                 ** Revision 1.13  2000/07/09 03:43:26  matt
750:                 ** minor changes to gui handling
751:                 **
752:                 ** Revision 1.12  2000/07/06 16:42:23  matt
753:                 ** updated for new video driver
754:                 **
755:                 ** Revision 1.11  2000/07/05 19:57:36  neil
756:                 ** __GNUC -> __DJGPP in nes.c
757:                 **
758:                 ** Revision 1.10  2000/07/05 12:23:03  matt
759:                 ** removed unnecessary references
760:                 **
761:                 ** Revision 1.9  2000/07/04 23:12:34  matt
762:                 ** memory protection handlers
763:                 **
764:                 ** Revision 1.8  2000/07/04 04:58:29  matt
765:                 ** dynamic memory range handlers
766:                 **
767:                 ** Revision 1.7  2000/06/26 04:58:51  matt
768:                 ** minor bugfix
769:                 **
770:                 ** Revision 1.6  2000/06/20 20:42:12  matt
771:                 ** fixed some NULL pointer problems
772:                 **
773:                 ** Revision 1.5  2000/06/09 15:12:26  matt
774:                 ** initial revision
775:                 **
776:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/memguard.c  --------------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** memguard.c
21:                  **
22:                  ** memory allocation wrapper routines
23:                  **
24:                  ** NOTE: based on code (c) 1998 the Retrocade group
25:                  ** $Id: memguard.c,v 1.2 2001/04/27 14:37:11 neil Exp $
26:                  */
27:                  
28:                  #include <noftypes.h>
29:                  #include <memguard.h>
30:                  
31:                  /* undefine macro definitions, so we get real calls */
32:                  #undef malloc
33:                  #undef free
34:                  #undef strdup
35:                  
36:                  #include <string.h>
37:                  #include <stdlib.h>
38:                  #include <log.h>
39:                  
40:                  
41:                  /* Maximum number of allocated blocks at any one time */
42:                  #define  MAX_BLOCKS        4096
43:                  
44:                  /* Memory block structure */
45:                  typedef struct memblock_s
46:                  {
47:                     void  *block_addr;
48:                     int   block_size;
49:                     char  *file_name;
50:                     int   line_num;
51:                  } memblock_t;
52:                  
53:                  /* debugging flag */
54:                  bool mem_debug = true;
55:                  
56:                  
57:                  #ifdef NOFRENDO_DEBUG
58:                  
59:                  static int mem_blockcount = 0;   /* allocated block count */
60:                  static memblock_t *mem_record = NULL;
61:                  
62:                  #define  GUARD_STRING   "GgUuAaRrDdSsTtRrIiNnGgBbLlOoCcKk"
63:                  #define  GUARD_LENGTH   256         /* before and after allocated block */
64:                  
65:                  
66:                  /*
67:                  ** Check the memory guard to make sure out of bounds writes have not
68:                  ** occurred.
69:                  */
70:                  static int mem_checkguardblock(void *data, int guard_size)
71:                  {
72:                     char *check, *block;
73:                     int i, alloc_size;
74:                  
75:                     /* get the original pointer */
76:                     block = ((char *) data) - guard_size;
77:                  
78:                     /* get the size */
79:                     alloc_size = *((uint32 *) block);
80:                     block+=4;
81:                  
82:                     /* check leading guard string */
83:                     check = GUARD_STRING;
84:                     for (i = sizeof(uint32); i < guard_size; i++)
85:                     {
86:                        /* wrap */
87:                        if ('\0' == *check)
88:                           check = GUARD_STRING;
89:                        
90:                        if (*block++ != *check++)
91:                           return -1;
92:                     }
93:                  
94:                     /* check end of block */
95:                     check = GUARD_STRING;
96:                     block = ((char *) data) + alloc_size;
97:                     for (i = 0; i < guard_size; i++)
98:                     {
99:                        /* wrap */
100:                       if ('\0' == *check)
101:                          check = GUARD_STRING;
102:                       if (*block++ != *check++)
103:                          return -1;
104:                    }
105:                 
106:                    /* we're okay! */
107:                    return 0;
108:                 }
109:                 
110:                 /* free a guard block */
111:                 static void mem_freeguardblock(void *data, int guard_size)
112:                 {
113:                    char *orig = ((char *) data) - guard_size;
114:                 
115:                    free(orig);
116:                 }
117:                 
118:                 /* allocate memory, guarding with a guard block in front and behind */
119:                 static void *mem_guardalloc(int alloc_size, int guard_size)
120:                 {
121:                    void *orig;
122:                    char *block, *check;
123:                    uint32 *ptr;
124:                    int i;
125:                 
126:                    /* pad it up to a 32-bit multiple */
127:                    alloc_size = (alloc_size + 3) & ~3;
128:                 
129:                    /* allocate memory */
130:                    orig = malloc(alloc_size + (guard_size * 2));
131:                    if (NULL == orig)
132:                       return NULL;
133:                 
134:                    block = (char *) orig;
135:                    
136:                    /* get it to the pointer we will actually return */
137:                    orig = (void *) ((char *) orig + guard_size);
138:                 
139:                    /* trash it all */
140:                    ptr = (uint32 *) orig;
141:                    for (i = alloc_size / 4; i; i--)
142:                       *ptr++ = 0xDEADBEEF;
143:                    
144:                    /* store the size of the newly allocated block*/
145:                    *((uint32 *) block) = alloc_size;
146:                 	block+=4;
147:                 
148:                    /* put guard string at beginning of block */
149:                    check = GUARD_STRING;
150:                    for (i = sizeof(uint32); i < guard_size; i++)
151:                    {
152:                       /* wrap */
153:                       if ('\0' == *check)
154:                          check = GUARD_STRING;
155:                 
156:                       *block++ = *check++;
157:                    }
158:                 
159:                    /* put at end of block */
160:                    check = GUARD_STRING;
161:                    block = (char *) orig + alloc_size;
162:                    for (i = 0; i < guard_size; i++)
163:                    {
164:                       /* wrap */
165:                       if ('\0' == *check)
166:                          check = GUARD_STRING;
167:                       
168:                       *block++ = *check++;
169:                    }
170:                 
171:                    return orig;
172:                 }
173:                 
174:                 
175:                 /* Free up the space used by the memory block manager */
176:                 void mem_cleanup(void)
177:                 {
178:                    if (mem_record)
179:                    {
180:                       free(mem_record);
181:                       mem_record = NULL;
182:                    }
183:                 }
184:                 
185:                 
186:                 /* Allocate a bunch of memory to keep track of all memory blocks */
187:                 static void mem_init(void)
188:                 {
189:                    mem_cleanup();
190:                 
191:                    mem_blockcount = 0;
192:                 
193:                    mem_record = malloc(MAX_BLOCKS * sizeof(memblock_t));
194:                    ASSERT(mem_record);
195:                    memset(mem_record, 0, MAX_BLOCKS * sizeof(memblock_t));
196:                 }
197:                 
198:                 
199:                 /* add a block of memory to the master record */
200:                 static void mem_addblock(void *data, int block_size, char *file, int line)
201:                 {
202:                    int i;
203:                 
204:                    for (i = 0; i < MAX_BLOCKS; i++)
205:                    {
206:                       if (NULL == mem_record[i].block_addr)
207:                       {
208:                          mem_record[i].block_addr = data;
209:                          mem_record[i].block_size = block_size;
210:                          mem_record[i].file_name = file;
211:                          mem_record[i].line_num = line;
212:                          return;
213:                       }
214:                    }
215:                 
216:                    ASSERT_MSG("out of memory blocks.");
217:                 }
218:                 
219:                 /* find an entry in the block record and delete it */
220:                 static void mem_deleteblock(void *data, char *file, int line)
221:                 {
222:                    int i;
223:                    char fail[256];
224:                 
225:                    for (i = 0; i < MAX_BLOCKS; i++)
226:                    {
227:                       if (data == mem_record[i].block_addr)
228:                       {
229:                          if (mem_checkguardblock(mem_record[i].block_addr, GUARD_LENGTH))
230:                          {
231:                             sprintf(fail, "mem_deleteblock 0x%08X at line %d of %s -- block corrupt",
232:                                     (uint32) data, line, file);
233:                             ASSERT_MSG(fail);
234:                          }
235:                 
236:                          memset(&mem_record[i], 0, sizeof(memblock_t));
237:                          return;
238:                       }
239:                    }
240:                 
241:                    sprintf(fail, "mem_deleteblock 0x%08X at line %d of %s -- block not found",
242:                            (uint32) data, line, file);
243:                    ASSERT_MSG(fail);
244:                 }
245:                 #endif /* NOFRENDO_DEBUG */
246:                 
247:                 /* debugger-friendly versions of calls */
248:                 #ifdef NOFRENDO_DEBUG
249:                 
250:                 /* allocates memory and clears it */
251:                 void *_my_malloc(int size, char *file, int line)
252:                 {
253:                    void *temp;
254:                    char fail[256];
255:                 
256:                    if (NULL == mem_record && false != mem_debug)
257:                       mem_init();
258:                 
259:                    if (false != mem_debug)
260:                       temp = mem_guardalloc(size, GUARD_LENGTH);
261:                    else
262:                       temp = malloc(size);
263:                 
264:                    printf("Malloc: %d at %s:%d\n", size, file, line);
265:                    if (NULL == temp)
266:                    {
267:                       sprintf(fail, "malloc: out of memory at line %d of %s.  block size: %d\n",
268:                               line, file, size);
269:                       ASSERT_MSG(fail);
270:                    }
271:                 
272:                    if (false != mem_debug)
273:                       mem_addblock(temp, size, file, line);
274:                 
275:                    mem_blockcount++;
276:                 
277:                    return temp;
278:                 }
279:                 
280:                 /* free a pointer allocated with my_malloc */
281:                 void _my_free(void **data, char *file, int line)
282:                 {
283:                    char fail[256];
284:                 
285:                    if (NULL == data || NULL == *data)
286:                    {
287:                       sprintf(fail, "free: attempted to free NULL pointer at line %d of %s\n",
288:                               line, file);
289:                       ASSERT_MSG(fail);
290:                    }
291:                 
292:                    /* if this is true, we are in REAL trouble */
293:                    if (0 == mem_blockcount)
294:                    {
295:                       ASSERT_MSG("free: attempted to free memory when no blocks available");
296:                    }
297:                 
298:                    mem_blockcount--; /* dec our block count */
299:                 
300:                    if (false != mem_debug)
301:                    {
302:                       mem_deleteblock(*data, file, line);
303:                       mem_freeguardblock(*data, GUARD_LENGTH);
304:                    }
305:                    else
306:                    {
307:                       free(*data);
308:                    }
309:                 
310:                    *data = NULL; /* NULL our source */
311:                 }
312:                 
313:                 char *_my_strdup(const char *string, char *file, int line)
314:                 {
315:                    char *temp;
316:                 
317:                    if (NULL == string)
318:                       return NULL;
319:                 
320:                    temp = (char *) _my_malloc(strlen(string) + 1, file, line);
321:                    if (NULL == temp)
322:                       return NULL;
323:                 
324:                    strcpy(temp, string);
325:                 
326:                    return temp;
327:                 }
328:                 
329:                 #else /* !NOFRENDO_DEBUG */
330:                 
331:                 /* allocates memory and clears it */
332:                 void *_my_malloc(int size)
333:                 {
9D03CC28  27BDFEE0   ADDIU SP, SP, -288
9D03CC2C  AFBF011C   SW RA, 284(SP)
9D03CC30  AFB10118   SW S1, 280(SP)
9D03CC34  AFB00114   SW S0, 276(SP)
334:                    void *temp;
335:                    char fail[256];
336:                 
337:                    temp = malloc(size);
9D03CC38  0F40C453   JAL .Letext0, .LFE16, malloc
9D03CC3C  00808821   ADDU S1, A0, ZERO
338:                 
339:                    if (NULL == temp)
9D03CC40  14400006   BNE V0, ZERO, .LVL2
9D03CC44  00408021   ADDU S0, V0, ZERO
340:                    {
341:                       sprintf(fail, "malloc: out of memory.  block size: %d\n", size);
9D03CC48  27A40010   ADDIU A0, SP, 16
9D03CC4C  3C059D04   LUI A1, -25340
9D03CC50  24A51B5C   ADDIU A1, A1, 7004
9D03CC54  0F4104E0   JAL _sprintf_cdnopuxX, _sprintf_cdnopsuxX
9D03CC58  02203021   ADDU A2, S1, ZERO
342:                       ASSERT_MSG(fail);
343:                    }
344:                 
345:                    return temp;
346:                 }
9D03CC5C  02001021   ADDU V0, S0, ZERO
9D03CC60  8FBF011C   LW RA, 284(SP)
9D03CC64  8FB10118   LW S1, 280(SP)
9D03CC68  8FB00114   LW S0, 276(SP)
9D03CC6C  03E00008   JR RA
9D03CC70  27BD0120   ADDIU SP, SP, 288
347:                 
348:                 /* free a pointer allocated with my_malloc */
349:                 void _my_free(void **data)
350:                 {
9D03CC74  27BDFEE8   ADDIU SP, SP, -280
9D03CC78  AFBF0114   SW RA, 276(SP)
9D03CC7C  AFB00110   SW S0, 272(SP)
351:                    char fail[256];
352:                 
353:                    if (NULL == data || NULL == *data)
9D03CC80  10800004   BEQ A0, ZERO, 0x9D03CC94
9D03CC84  00808021   ADDU S0, A0, ZERO
9D03CC88  8C820000   LW V0, 0(A0)
9D03CC8C  1440001C   BNE V0, ZERO, 0x9D03CD00
9D03CC90  00000000   NOP
354:                    {
355:                       sprintf(fail, "free: attempted to free NULL pointer.\n");
9D03CC94  3C039D04   LUI V1, -25340
9D03CC98  24671B84   ADDIU A3, V1, 7044
9D03CC9C  8CE60000   LW A2, 0(A3)
9D03CCA0  8CE50004   LW A1, 4(A3)
9D03CCA4  8CE40008   LW A0, 8(A3)
9D03CCA8  8CE8000C   LW T0, 12(A3)
9D03CCAC  AFA60010   SW A2, 16(SP)
9D03CCB0  AFA50014   SW A1, 20(SP)
9D03CCB4  AFA40018   SW A0, 24(SP)
9D03CCB8  AFA8001C   SW T0, 28(SP)
9D03CCBC  24E90010   ADDIU T1, A3, 16
9D03CCC0  27AB0020   ADDIU T3, SP, 32
9D03CCC4  8D2D0000   LW T5, 0(T1)
9D03CCC8  8D2E0004   LW T6, 4(T1)
9D03CCCC  8D2F0008   LW T7, 8(T1)
9D03CCD0  8D38000C   LW T8, 12(T1)
9D03CCD4  AD6D0000   SW T5, 0(T3)
9D03CCD8  AD6E0004   SW T6, 4(T3)
9D03CCDC  AD6F0008   SW T7, 8(T3)
9D03CCE0  AD78000C   SW T8, 12(T3)
9D03CCE4  8D390010   LW T9, 16(T1)
9D03CCE8  AD790010   SW T9, 16(T3)
9D03CCEC  953F0014   LHU RA, 20(T1)
9D03CCF0  25220010   ADDIU V0, T1, 16
9D03CCF4  A57F0014   SH RA, 20(T3)
9D03CCF8  90430006   LBU V1, 6(V0)
9D03CCFC  A1630016   SB V1, 22(T3)
356:                       ASSERT_MSG(fail);
357:                    }
358:                 
359:                    free(*data);
9D03CD00  0F40E912   JAL free
9D03CD04  8E040000   LW A0, 0(S0)
360:                    *data = NULL; /* NULL our source */
9D03CD08  AE000000   SW ZERO, 0(S0)
361:                 }
9D03CD0C  8FBF0114   LW RA, 276(SP)
9D03CD10  8FB00110   LW S0, 272(SP)
9D03CD14  03E00008   JR RA
9D03CD18  27BD0118   ADDIU SP, SP, 280
362:                 
363:                 char *_my_strdup(const char *string)
364:                 {
9D03CD1C  27BDFFE0   ADDIU SP, SP, -32
9D03CD20  AFBF001C   SW RA, 28(SP)
9D03CD24  AFB10018   SW S1, 24(SP)
9D03CD28  AFB00014   SW S0, 20(SP)
365:                    char *temp;
366:                 
367:                    if (NULL == string)
9D03CD2C  1080000C   BEQ A0, ZERO, 0x9D03CD60
9D03CD30  00808021   ADDU S0, A0, ZERO
368:                       return NULL;
9D03CD60  0B40F35A   J 0x9D03CD68
9D03CD64  00001021   ADDU V0, ZERO, ZERO
369:                 
370:                    /* will ASSERT for us */
371:                    temp = (char *) _my_malloc(strlen(string) + 1);
9D03CD34  0F40F2B0   JAL strlen
9D03CD38  00000000   NOP
9D03CD3C  0F40F30A   JAL _my_malloc
9D03CD40  24440001   ADDIU A0, V0, 1
372:                    if (NULL == temp)
9D03CD44  10400008   BEQ V0, ZERO, 0x9D03CD68
9D03CD48  00408821   ADDU S1, V0, ZERO
373:                       return NULL;
374:                 
375:                    strcpy(temp, string);
9D03CD4C  00402021   ADDU A0, V0, ZERO
9D03CD50  0F40EFF7   JAL .LFE23, strcpy
9D03CD54  02002821   ADDU A1, S0, ZERO
376:                 
377:                    return temp;
9D03CD58  0B40F35A   J 0x9D03CD68
9D03CD5C  02201021   ADDU V0, S1, ZERO
378:                 }
9D03CD68  8FBF001C   LW RA, 28(SP)
9D03CD6C  8FB10018   LW S1, 24(SP)
9D03CD70  8FB00014   LW S0, 20(SP)
9D03CD74  03E00008   JR RA
9D03CD78  27BD0020   ADDIU SP, SP, 32
379:                 
380:                 #endif /* !NOFRENDO_DEBUG */
381:                 
382:                 /* check for orphaned memory handles */
383:                 void mem_checkleaks(void)
384:                 {
9D03CD7C  03E00008   JR RA
9D03CD80  00000000   NOP
385:                 #ifdef NOFRENDO_DEBUG
386:                    int i;
387:                 
388:                    if (false == mem_debug || NULL == mem_record)
389:                       return;
390:                 
391:                    if (mem_blockcount)
392:                    {
393:                       log_printf("memory leak - %d unfreed block%s\n\n", mem_blockcount, 
394:                          mem_blockcount == 1 ? "" : "s");
395:                 
396:                       for (i = 0; i < MAX_BLOCKS; i++)
397:                       {
398:                          if (mem_record[i].block_addr)
399:                          {
400:                             log_printf("addr: 0x%08X, size: %d, line %d of %s%s\n",
401:                                     (uint32) mem_record[i].block_addr,
402:                                     mem_record[i].block_size,
403:                                     mem_record[i].line_num,
404:                                     mem_record[i].file_name,
405:                                     (mem_checkguardblock(mem_record[i].block_addr, GUARD_LENGTH))
406:                                     ? " -- block corrupt" : "");
407:                          }
408:                       }
409:                    }
410:                    else
411:                       log_printf("no memory leaks\n");
412:                 #endif /* NOFRENDO_DEBUG */
413:                 }
414:                 
415:                 void mem_checkblocks(void)
416:                 {
9D03CD84  03E00008   JR RA
417:                 #ifdef NOFRENDO_DEBUG
418:                    int i;
419:                 
420:                    if (false == mem_debug || NULL == mem_record)
421:                       return;
422:                 
423:                    for (i = 0; i < MAX_BLOCKS; i++)
424:                    {
425:                       if (mem_record[i].block_addr)
426:                       {
427:                          if (mem_checkguardblock(mem_record[i].block_addr, GUARD_LENGTH))
428:                          {
429:                             log_printf("addr: 0x%08X, size: %d, line %d of %s -- block corrupt\n",
430:                                     (uint32) mem_record[i].block_addr,
431:                                     mem_record[i].block_size,
432:                                     mem_record[i].line_num,
433:                                     mem_record[i].file_name);
434:                          }
435:                       }
436:                    }
437:                 #endif /* NOFRENDO_DEBUG */
438:                 }
439:                 
440:                 /*
441:                 ** $Log: memguard.c,v $
442:                 ** Revision 1.2  2001/04/27 14:37:11  neil
443:                 ** wheeee
444:                 **
445:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
446:                 ** initial
447:                 **
448:                 ** Revision 1.23  2000/11/24 21:42:48  matt
449:                 ** vc complaints
450:                 **
451:                 ** Revision 1.22  2000/11/21 13:27:30  matt
452:                 ** trash all newly allocated memory
453:                 **
454:                 ** Revision 1.21  2000/11/21 13:22:30  matt
455:                 ** memory guard shouldn't zero memory for us
456:                 **
457:                 ** Revision 1.20  2000/10/28 14:01:53  matt
458:                 ** memguard.h was being included in the wrong place
459:                 **
460:                 ** Revision 1.19  2000/10/26 22:48:33  matt
461:                 ** strdup'ing a NULL ptr returns NULL
462:                 **
463:                 ** Revision 1.18  2000/10/25 13:41:29  matt
464:                 ** added strdup
465:                 **
466:                 ** Revision 1.17  2000/10/10 13:58:13  matt
467:                 ** stroustrup squeezing his way in the door
468:                 **
469:                 ** Revision 1.16  2000/10/10 13:03:54  matt
470:                 ** Mr. Clean makes a guest appearance
471:                 **
472:                 ** Revision 1.15  2000/09/18 02:06:48  matt
473:                 ** -pedantic is your friend
474:                 **
475:                 ** Revision 1.14  2000/08/11 01:45:48  matt
476:                 ** hearing about no corrupt blocks every 10 seconds really was annoying
477:                 **
478:                 ** Revision 1.13  2000/07/31 04:28:46  matt
479:                 ** one million cleanups
480:                 **
481:                 ** Revision 1.12  2000/07/24 04:31:07  matt
482:                 ** mem_checkblocks now gives feedback
483:                 **
484:                 ** Revision 1.11  2000/07/06 17:20:52  matt
485:                 ** block manager space itself wasn't being freed - d'oh!
486:                 **
487:                 ** Revision 1.10  2000/07/06 17:15:43  matt
488:                 ** false isn't NULL, Neil... =)
489:                 **
490:                 ** Revision 1.9  2000/07/05 23:10:01  neil
491:                 ** It's a shame if the memguard segfaults
492:                 **
493:                 ** Revision 1.8  2000/06/26 04:54:48  matt
494:                 ** simplified and made more robust
495:                 **
496:                 ** Revision 1.7  2000/06/12 01:11:41  matt
497:                 ** cleaned up some error output for win32
498:                 **
499:                 ** Revision 1.6  2000/06/09 15:12:25  matt
500:                 ** initial revision
501:                 **
502:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/mapvrc.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map_vrc.c
21:                  **
22:                  ** VRC mapper interface
23:                  ** $Id: mapvrc.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes.h>
29:                  #include <log.h>
30:                  
31:                  #define VRC_VBANK(bank, value, high) \
32:                  { \
33:                     if ((high)) \
34:                        highnybbles[(bank)] = (value) & 0x0F; \
35:                     else \
36:                        lownybbles[(bank)] = (value) & 0x0F; \
37:                     mmc_bankvrom(1, (bank) << 10, (highnybbles[(bank)] << 4)+lownybbles[(bank)]); \
38:                  }
39:                  
40:                  static struct
41:                  {
42:                     int counter, enabled;
43:                     int latch, wait_state;
44:                  } irq;
45:                  
46:                  static int select_c000 = 0;
47:                  static uint8 lownybbles[8];
48:                  static uint8 highnybbles[8];
49:                  
50:                  static void vrc_init(void)
51:                  {
52:                     irq.counter = irq.enabled = 0;
9D029600  3C03A001   LUI V1, -24575
9D029604  246258FC   ADDIU V0, V1, 22780
9D029608  AC400004   SW ZERO, 4(V0)
9D02960C  AC6058FC   SW ZERO, 22780(V1)
53:                     irq.latch = irq.wait_state = 0;
9D029610  AC40000C   SW ZERO, 12(V0)
9D029614  03E00008   JR RA
9D029618  AC400008   SW ZERO, 8(V0)
54:                  }
55:                  
56:                  static void map21_write(uint32 address, uint8 value)
57:                  {
9D029654  27BDFFE8   ADDIU SP, SP, -24
9D029658  AFBF0014   SW RA, 20(SP)
58:                     switch (address)
9D02965C  3402D002   ORI V0, ZERO, -12286
9D029660  10820153   BEQ A0, V0, 0x9D029BB0
9D029664  00A03021   ADDU A2, A1, ZERO
9D029668  3403D003   ORI V1, ZERO, -12285
9D02966C  0083282B   SLTU A1, A0, V1
9D029670  10A00062   BEQ A1, ZERO, 0x9D0297FC
9D029674  3407B080   ORI A3, ZERO, -20352
9D029678  1087010A   BEQ A0, A3, 0x9D029AA4
9D02967C  3408B081   ORI T0, ZERO, -20351
9D029680  0088482B   SLTU T1, A0, T0
9D029684  1120002D   BEQ T1, ZERO, 0x9D02973C
9D029688  340AB001   ORI T2, ZERO, -20479
9D02968C  108A0105   BEQ A0, T2, 0x9D029AA4
9D029690  340BB002   ORI T3, ZERO, -20478
9D029694  008B602B   SLTU T4, A0, T3
9D029698  11800013   BEQ T4, ZERO, 0x9D0296E8
9D02969C  340D9002   ORI T5, ZERO, -28670
9D0296A0  108D00E6   BEQ A0, T5, 0x9D029A3C
9D0296A4  340E9003   ORI T6, ZERO, -28669
9D0296A8  008E782B   SLTU T7, A0, T6
9D0296AC  51E00008   BEQL T7, ZERO, 0x9D0296D0
9D0296B0  3405A000   ORI A1, ZERO, -24576
9D0296B4  34188000   ORI T8, ZERO, -32768
9D0296B8  109800B1   BEQ A0, T8, 0x9D029980
9D0296BC  34199000   ORI T9, ZERO, -28672
9D0296C0  509900BA   BEQL A0, T9, 0x9D0299AC
9D0296C4  30C60003   ANDI A2, A2, 3
9D0296D0  108500DD   BEQ A0, A1, 0x9D029A48
9D0296D4  3407B000   ORI A3, ZERO, -20480
9D0296D8  108700E0   BEQ A0, A3, 0x9D029A5C
9D0296DC  30C8000F   ANDI T0, A2, 15
9D0296E8  340CB004   ORI T4, ZERO, -20476
9D0296EC  108C00ED   BEQ A0, T4, 0x9D029AA4
9D0296F0  340DB005   ORI T5, ZERO, -20475
9D0296F4  008D702B   SLTU T6, A0, T5
9D0296F8  11C00009   BEQ T6, ZERO, 0x9D029720
9D0296FC  3419B006   ORI T9, ZERO, -20474
9D029700  340FB002   ORI T7, ZERO, -20478
9D029704  508F00DE   BEQL A0, T7, 0x9D029A80
9D029708  30C6000F   ANDI A2, A2, 15
9D02970C  3418B003   ORI T8, ZERO, -20477
9D029710  109800EF   BEQ A0, T8, 0x9D029AD0
9D029714  30D8000F   ANDI T8, A2, 15
9D029720  109900EB   BEQ A0, T9, 0x9D029AD0
9D029724  30D8000F   ANDI T8, A2, 15
9D029728  341FB040   ORI RA, ZERO, -20416
9D02972C  509F00D4   BEQL A0, RA, 0x9D029A80
9D029730  30C6000F   ANDI A2, A2, 15
9D02973C  3405C004   ORI A1, ZERO, -16380
9D029740  108500FE   BEQ A0, A1, 0x9D029B3C
9D029744  3407C005   ORI A3, ZERO, -16379
9D029748  0087402B   SLTU T0, A0, A3
9D02974C  51000015   BEQL T0, ZERO, 0x9D0297A4
9D029750  3405C080   ORI A1, ZERO, -16256
9D029754  3409C001   ORI T1, ZERO, -16383
9D029758  108900F8   BEQ A0, T1, 0x9D029B3C
9D02975C  340AC002   ORI T2, ZERO, -16382
9D029760  008A582B   SLTU T3, A0, T2
9D029764  11600007   BEQ T3, ZERO, 0x9D029784
9D029768  340CB0C0   ORI T4, ZERO, -20288
9D02976C  108C00D7   BEQ A0, T4, 0x9D029ACC
9D029770  340DC000   ORI T5, ZERO, -16384
9D029774  108D00DF   BEQ A0, T5, 0x9D029AF4
9D029778  30CE000F   ANDI T6, A2, 15
9D029784  3403C002   ORI V1, ZERO, -16382
9D029788  508300E3   BEQL A0, V1, 0x9D029B18
9D02978C  30C6000F   ANDI A2, A2, 15
9D029790  3402C003   ORI V0, ZERO, -16381
9D029794  108200F4   BEQ A0, V0, 0x9D029B68
9D029798  30C4000F   ANDI A0, A2, 15
9D0297A4  108500E5   BEQ A0, A1, 0x9D029B3C
9D0297A8  3407C081   ORI A3, ZERO, -16255
9D0297AC  0087402B   SLTU T0, A0, A3
9D0297B0  11000008   BEQ T0, ZERO, 0x9D0297D4
9D0297B4  340DD000   ORI T5, ZERO, -12288
9D0297B8  3409C006   ORI T1, ZERO, -16378
9D0297BC  108900E9   BEQ A0, T1, 0x9D029B64
9D0297C0  340AC040   ORI T2, ZERO, -16320
9D0297C4  508A00D4   BEQL A0, T2, 0x9D029B18
9D0297C8  30C6000F   ANDI A2, A2, 15
9D0297D4  108D00ED   BEQ A0, T5, 0x9D029B8C
9D0297D8  30C3000F   ANDI V1, A2, 15
9D0297DC  340ED001   ORI T6, ZERO, -12287
9D0297E0  008E782B   SLTU T7, A0, T6
9D0297E4  11E000FC   BEQ T7, ZERO, 0x9D029BD8
9D0297E8  3418C0C0   ORI T8, ZERO, -16192
9D0297EC  109800DE   BEQ A0, T8, 0x9D029B68
9D0297F0  30C4000F   ANDI A0, A2, 15
9D0297FC  340CE006   ORI T4, ZERO, -8186
9D029800  108C0125   BEQ A0, T4, 0x9D029C98
9D029804  340DE007   ORI T5, ZERO, -8185
9D029808  008D702B   SLTU T6, A0, T5
9D02980C  11C0002E   BEQ T6, ZERO, 0x9D0298C8
9D029810  3405F002   ORI A1, ZERO, -4094
9D029814  340FD0C0   ORI T7, ZERO, -12096
9D029818  108F00F9   BEQ A0, T7, 0x9D029C00
9D02981C  3418D0C1   ORI T8, ZERO, -12095
9D029820  0098C82B   SLTU T9, A0, T8
9D029824  13200015   BEQ T9, ZERO, 0x9D02987C
9D029828  340BE002   ORI T3, ZERO, -8190
9D02982C  341FD006   ORI RA, ZERO, -12282
9D029830  109F00F3   BEQ A0, RA, 0x9D029C00
9D029834  3403D007   ORI V1, ZERO, -12281
9D029838  0083102B   SLTU V0, A0, V1
9D02983C  10400008   BEQ V0, ZERO, 0x9D029860
9D029840  3405D040   ORI A1, ZERO, -12224
9D029844  3407D003   ORI A3, ZERO, -12285
9D029848  108700ED   BEQ A0, A3, 0x9D029C00
9D02984C  3408D004   ORI T0, ZERO, -12284
9D029850  108800E2   BEQ A0, T0, 0x9D029BDC
9D029854  30CA000F   ANDI T2, A2, 15
9D029860  108500D4   BEQ A0, A1, 0x9D029BB4
9D029864  30C9000F   ANDI T1, A2, 15
9D029868  3409D080   ORI T1, ZERO, -12160
9D02986C  108900DB   BEQ A0, T1, 0x9D029BDC
9D029870  30CA000F   ANDI T2, A2, 15
9D02987C  108B00F3   BEQ A0, T3, 0x9D029C4C
9D029880  340CE003   ORI T4, ZERO, -8189
9D029884  008C682B   SLTU T5, A0, T4
9D029888  11A00008   BEQ T5, ZERO, 0x9D0298AC
9D02988C  340EE000   ORI T6, ZERO, -8192
9D029890  108E00E5   BEQ A0, T6, 0x9D029C28
9D029894  30D8000F   ANDI T8, A2, 15
9D029898  340FE001   ORI T7, ZERO, -8191
9D02989C  508F00F5   BEQL A0, T7, 0x9D029C74
9D0298A0  30C6000F   ANDI A2, A2, 15
9D0298AC  3403E003   ORI V1, ZERO, -8189
9D0298B0  108300F9   BEQ A0, V1, 0x9D029C98
9D0298B4  3402E004   ORI V0, ZERO, -8188
9D0298B8  508200EE   BEQL A0, V0, 0x9D029C74
9D0298BC  30C6000F   ANDI A2, A2, 15
9D0298C8  10850104   BEQ A0, A1, 0x9D029CDC
9D0298CC  340AF003   ORI T2, ZERO, -4093
9D0298D0  008A582B   SLTU T3, A0, T2
9D0298D4  11600015   BEQ T3, ZERO, 0x9D02992C
9D0298D8  340CE0C0   ORI T4, ZERO, -8000
9D0298DC  108C00EE   BEQ A0, T4, 0x9D029C98
9D0298E0  340DE0C1   ORI T5, ZERO, -7999
9D0298E4  008D702B   SLTU T6, A0, T5
9D0298E8  11C00009   BEQ T6, ZERO, 0x9D029910
9D0298EC  3407F000   ORI A3, ZERO, -4096
9D0298F0  340FE040   ORI T7, ZERO, -8128
9D0298F4  108F00D6   BEQ A0, T7, 0x9D029C50
9D0298F8  30DF000F   ANDI RA, A2, 15
9D0298FC  3418E080   ORI T8, ZERO, -8064
9D029900  509800DC   BEQL A0, T8, 0x9D029C74
9D029904  30C6000F   ANDI A2, A2, 15
9D029910  108700EB   BEQ A0, A3, 0x9D029CC0
9D029914  3C09A001   LUI T1, -24575
9D029918  3408F001   ORI T0, ZERO, -4095
9D02991C  108800F9   BEQ A0, T0, 0x9D029D04
9D029920  3C08A001   LUI T0, -24575
9D02992C  340EF006   ORI T6, ZERO, -4090
9D029930  108E00FC   BEQ A0, T6, 0x9D029D24
9D029934  340FF007   ORI T7, ZERO, -4089
9D029938  008FC02B   SLTU T8, A0, T7
9D02993C  13000008   BEQ T8, ZERO, 0x9D029960
9D029940  3403F080   ORI V1, ZERO, -3968
9D029944  3419F003   ORI T9, ZERO, -4093
9D029948  109900F6   BEQ A0, T9, 0x9D029D24
9D02994C  341FF004   ORI RA, ZERO, -4092
9D029950  109F00EC   BEQ A0, RA, 0x9D029D04
9D029954  3C08A001   LUI T0, -24575
9D029960  108300E7   BEQ A0, V1, 0x9D029D00
9D029964  3402F0C0   ORI V0, ZERO, -3904
9D029968  108200EE   BEQ A0, V0, 0x9D029D24
9D02996C  3407F040   ORI A3, ZERO, -4032
9D029970  108700DB   BEQ A0, A3, 0x9D029CE0
9D029974  3C0DA001   LUI T5, -24575
59:                     {
60:                     case 0x8000:
61:                        if (select_c000) 
9D029980  8F838174   LW V1, -32396(GP)
9D029984  10600005   BEQ V1, ZERO, 0x9D02999C
9D029988  24040008   ADDIU A0, ZERO, 8
62:                           mmc_bankrom(8, 0xC000,value);
9D02998C  0F40CA71   JAL mmc_bankrom
9D029990  3405C000   ORI A1, ZERO, -16384
9D029994  0B40A74E   J 0x9D029D38
9D029998  8FBF0014   LW RA, 20(SP)
63:                        else
64:                           mmc_bankrom(8, 0x8000,value);
9D02999C  0F40CA71   JAL mmc_bankrom
9D0299A0  34058000   ORI A1, ZERO, -32768
65:                        break;
66:                  
67:                     case 0x9000:
68:                        switch (value & 3)
9D0299AC  24040001   ADDIU A0, ZERO, 1
9D0299B0  50C40010   BEQL A2, A0, 0x9D0299F4
9D0299B4  00002021   ADDU A0, ZERO, ZERO
9D0299B8  50C00008   BEQL A2, ZERO, 0x9D0299DC
9D0299BC  00002021   ADDU A0, ZERO, ZERO
9D0299C0  241F0002   ADDIU RA, ZERO, 2
9D0299C4  10DF0011   BEQ A2, RA, 0x9D029A0C
9D0299C8  24020003   ADDIU V0, ZERO, 3
9D0299CC  10C20016   BEQ A2, V0, 0x9D029A28
9D0299D0  24050001   ADDIU A1, ZERO, 1
69:                        {
70:                        case 0:
71:                           ppu_mirror(0, 1, 0, 1); /* vertical */
9D0299DC  24050001   ADDIU A1, ZERO, 1
9D0299E0  00003021   ADDU A2, ZERO, ZERO
9D0299E4  0F4058FD   JAL ppu_mirror
9D0299E8  24070001   ADDIU A3, ZERO, 1
72:                           break;
9D0299EC  0B40A74E   J 0x9D029D38
9D0299F0  8FBF0014   LW RA, 20(SP)
73:                  
74:                        case 1: 
75:                           ppu_mirror(0, 0, 1, 1); /* horizontal */
9D0299F4  00002821   ADDU A1, ZERO, ZERO
9D0299F8  24060001   ADDIU A2, ZERO, 1
9D0299FC  0F4058FD   JAL ppu_mirror
9D029A00  24070001   ADDIU A3, ZERO, 1
76:                           break;
9D029A04  0B40A74E   J 0x9D029D38
9D029A08  8FBF0014   LW RA, 20(SP)
77:                  
78:                        case 2: 
79:                           ppu_mirror(0, 0, 0, 0); 
9D029A0C  00002021   ADDU A0, ZERO, ZERO
9D029A10  00002821   ADDU A1, ZERO, ZERO
9D029A14  00003021   ADDU A2, ZERO, ZERO
9D029A18  0F4058FD   JAL ppu_mirror
9D029A1C  00003821   ADDU A3, ZERO, ZERO
80:                           break;
9D029A20  0B40A74E   J 0x9D029D38
9D029A24  8FBF0014   LW RA, 20(SP)
81:                  
82:                        case 3: 
83:                           ppu_mirror(1, 1, 1, 1); 
9D029A28  24060001   ADDIU A2, ZERO, 1
9D029A2C  0F4058FD   JAL ppu_mirror
9D029A30  24070001   ADDIU A3, ZERO, 1
84:                           break;
9D029A34  0B40A74E   J 0x9D029D38
9D029A38  8FBF0014   LW RA, 20(SP)
85:                  
86:                        default: 
87:                           break;
88:                        }
89:                        break;
90:                     case 0x9002: select_c000=(value&0x02)>>1; break;
9D029A3C  7CCB0040   EXT T3, A2, 1, 1
9D029A40  0B40A74D   J 0x9D029D34
9D029A44  AF8B8174   SW T3, -32396(GP)
91:                     case 0xA000: mmc_bankrom(8, 0xA000,value); break;
9D029A48  24040008   ADDIU A0, ZERO, 8
9D029A4C  0F40CA71   JAL mmc_bankrom
9D029A50  3405A000   ORI A1, ZERO, -24576
9D029A54  0B40A74E   J 0x9D029D38
9D029A58  8FBF0014   LW RA, 20(SP)
92:                  
93:                     case 0xB000: VRC_VBANK(0,value,0); break;
9D029A5C  A388816C   SB T0, -32404(GP)
9D029A60  93898164   LBU T1, -32412(GP)
9D029A64  00095100   SLL T2, T1, 4
9D029A68  24040001   ADDIU A0, ZERO, 1
9D029A6C  00002821   ADDU A1, ZERO, ZERO
9D029A70  0F40CA16   JAL mmc_bankvrom
9D029A74  01483021   ADDU A2, T2, T0
9D029A78  0B40A74E   J 0x9D029D38
9D029A7C  8FBF0014   LW RA, 20(SP)
94:                     case 0xB002:
95:                     case 0xB040: VRC_VBANK(0,value,1); break;
9D029A80  A3868164   SB A2, -32412(GP)
9D029A84  00061900   SLL V1, A2, 4
9D029A88  9382816C   LBU V0, -32404(GP)
9D029A8C  24040001   ADDIU A0, ZERO, 1
9D029A90  00002821   ADDU A1, ZERO, ZERO
9D029A94  0F40CA16   JAL mmc_bankvrom
9D029A98  00623021   ADDU A2, V1, V0
9D029A9C  0B40A74E   J 0x9D029D38
9D029AA0  8FBF0014   LW RA, 20(SP)
96:                     case 0xB001:
97:                     case 0xB004:
98:                     case 0xB080: VRC_VBANK(1,value,0); break;
9D029AA4  30CA000F   ANDI T2, A2, 15
9D029AA8  A38A816D   SB T2, -32403(GP)
9D029AAC  93868165   LBU A2, -32411(GP)
9D029AB0  00065900   SLL T3, A2, 4
9D029AB4  24040001   ADDIU A0, ZERO, 1
9D029AB8  24050400   ADDIU A1, ZERO, 1024
9D029ABC  0F40CA16   JAL mmc_bankvrom
9D029AC0  016A3021   ADDU A2, T3, T2
9D029AC4  0B40A74E   J 0x9D029D38
9D029AC8  8FBF0014   LW RA, 20(SP)
99:                     case 0xB003:
100:                    case 0xB006:
101:                    case 0xB0C0: VRC_VBANK(1,value,1); break;
9D029ACC  30D8000F   ANDI T8, A2, 15
9D029AD0  A3988165   SB T8, -32411(GP)
9D029AD4  0018C900   SLL T9, T8, 4
9D029AD8  939F816D   LBU RA, -32403(GP)
9D029ADC  24040001   ADDIU A0, ZERO, 1
9D029AE0  033F3021   ADDU A2, T9, RA
9D029AE4  0F40CA16   JAL mmc_bankvrom
9D029AE8  24050400   ADDIU A1, ZERO, 1024
9D029AEC  0B40A74E   J 0x9D029D38
9D029AF0  8FBF0014   LW RA, 20(SP)
102:                    case 0xC000: VRC_VBANK(2,value,0); break;
9D029AF4  A38E816E   SB T6, -32402(GP)
9D029AF8  93848166   LBU A0, -32410(GP)
9D029AFC  00047900   SLL T7, A0, 4
9D029B00  24040001   ADDIU A0, ZERO, 1
9D029B04  24050800   ADDIU A1, ZERO, 2048
9D029B08  0F40CA16   JAL mmc_bankvrom
9D029B0C  01EE3021   ADDU A2, T7, T6
9D029B10  0B40A74E   J 0x9D029D38
9D029B14  8FBF0014   LW RA, 20(SP)
103:                    case 0xC002:
104:                    case 0xC040: VRC_VBANK(2,value,1); break;
9D029B18  A3868166   SB A2, -32410(GP)
9D029B1C  00065900   SLL T3, A2, 4
9D029B20  938C816E   LBU T4, -32402(GP)
9D029B24  24040001   ADDIU A0, ZERO, 1
9D029B28  24050800   ADDIU A1, ZERO, 2048
9D029B2C  0F40CA16   JAL mmc_bankvrom
9D029B30  016C3021   ADDU A2, T3, T4
9D029B34  0B40A74E   J 0x9D029D38
9D029B38  8FBF0014   LW RA, 20(SP)
105:                    case 0xC001:
106:                    case 0xC004:
107:                    case 0xC080: VRC_VBANK(3,value,0); break;
9D029B3C  30C8000F   ANDI T0, A2, 15
9D029B40  A388816F   SB T0, -32401(GP)
9D029B44  93858167   LBU A1, -32409(GP)
9D029B48  00054900   SLL T1, A1, 4
9D029B4C  24040001   ADDIU A0, ZERO, 1
9D029B50  24050C00   ADDIU A1, ZERO, 3072
9D029B54  0F40CA16   JAL mmc_bankvrom
9D029B58  01283021   ADDU A2, T1, T0
9D029B5C  0B40A74E   J 0x9D029D38
9D029B60  8FBF0014   LW RA, 20(SP)
108:                    case 0xC003:
109:                    case 0xC006:
110:                    case 0xC0C0: VRC_VBANK(3,value,1); break;
9D029B64  30C4000F   ANDI A0, A2, 15
9D029B68  A3848167   SB A0, -32409(GP)
9D029B6C  0004C900   SLL T9, A0, 4
9D029B70  939F816F   LBU RA, -32401(GP)
9D029B74  24040001   ADDIU A0, ZERO, 1
9D029B78  033F3021   ADDU A2, T9, RA
9D029B7C  0F40CA16   JAL mmc_bankvrom
9D029B80  24050C00   ADDIU A1, ZERO, 3072
9D029B84  0B40A74E   J 0x9D029D38
9D029B88  8FBF0014   LW RA, 20(SP)
111:                    case 0xD000: VRC_VBANK(4,value,0); break;
9D029B8C  A3838170   SB V1, -32400(GP)
9D029B90  93828168   LBU V0, -32408(GP)
9D029B94  00023900   SLL A3, V0, 4
9D029B98  24040001   ADDIU A0, ZERO, 1
9D029B9C  24051000   ADDIU A1, ZERO, 4096
9D029BA0  0F40CA16   JAL mmc_bankvrom
9D029BA4  00E33021   ADDU A2, A3, V1
9D029BA8  0B40A74E   J 0x9D029D38
9D029BAC  8FBF0014   LW RA, 20(SP)
112:                    case 0xD002:
113:                    case 0xD040: VRC_VBANK(4,value,1); break;
9D029BB0  30C9000F   ANDI T1, A2, 15
9D029BB4  A3898168   SB T1, -32408(GP)
9D029BB8  00093100   SLL A2, T1, 4
9D029BBC  938A8170   LBU T2, -32400(GP)
9D029BC0  24040001   ADDIU A0, ZERO, 1
9D029BC4  24051000   ADDIU A1, ZERO, 4096
9D029BC8  0F40CA16   JAL mmc_bankvrom
9D029BCC  00CA3021   ADDU A2, A2, T2
9D029BD0  0B40A74E   J 0x9D029D38
9D029BD4  8FBF0014   LW RA, 20(SP)
114:                    case 0xD001:
115:                    case 0xD004:
116:                    case 0xD080: VRC_VBANK(5,value,0); break;
9D029BD8  30CA000F   ANDI T2, A2, 15
9D029BDC  A38A8171   SB T2, -32399(GP)
9D029BE0  93848169   LBU A0, -32407(GP)
9D029BE4  00043100   SLL A2, A0, 4
9D029BE8  24040001   ADDIU A0, ZERO, 1
9D029BEC  24051400   ADDIU A1, ZERO, 5120
9D029BF0  0F40CA16   JAL mmc_bankvrom
9D029BF4  00CA3021   ADDU A2, A2, T2
9D029BF8  0B40A74E   J 0x9D029D38
9D029BFC  8FBF0014   LW RA, 20(SP)
117:                    case 0xD003:
118:                    case 0xD006:
119:                    case 0xD0C0: VRC_VBANK(5,value,1); break;
9D029C00  30C7000F   ANDI A3, A2, 15
9D029C04  A3878169   SB A3, -32407(GP)
9D029C08  00074100   SLL T0, A3, 4
9D029C0C  93898171   LBU T1, -32399(GP)
9D029C10  24040001   ADDIU A0, ZERO, 1
9D029C14  24051400   ADDIU A1, ZERO, 5120
9D029C18  0F40CA16   JAL mmc_bankvrom
9D029C1C  01093021   ADDU A2, T0, T1
9D029C20  0B40A74E   J 0x9D029D38
9D029C24  8FBF0014   LW RA, 20(SP)
120:                    case 0xE000: VRC_VBANK(6,value,0); break;
9D029C28  A3988172   SB T8, -32398(GP)
9D029C2C  9399816A   LBU T9, -32406(GP)
9D029C30  0019F900   SLL RA, T9, 4
9D029C34  24040001   ADDIU A0, ZERO, 1
9D029C38  03F83021   ADDU A2, RA, T8
9D029C3C  0F40CA16   JAL mmc_bankvrom
9D029C40  24051800   ADDIU A1, ZERO, 6144
9D029C44  0B40A74E   J 0x9D029D38
9D029C48  8FBF0014   LW RA, 20(SP)
121:                    case 0xE002:
122:                    case 0xE040: VRC_VBANK(6,value,1); break;
9D029C4C  30DF000F   ANDI RA, A2, 15
9D029C50  A39F816A   SB RA, -32406(GP)
9D029C54  001F1900   SLL V1, RA, 4
9D029C58  93828172   LBU V0, -32398(GP)
9D029C5C  24040001   ADDIU A0, ZERO, 1
9D029C60  24051800   ADDIU A1, ZERO, 6144
9D029C64  0F40CA16   JAL mmc_bankvrom
9D029C68  00623021   ADDU A2, V1, V0
9D029C6C  0B40A74E   J 0x9D029D38
9D029C70  8FBF0014   LW RA, 20(SP)
123:                    case 0xE001:
124:                    case 0xE004:
125:                    case 0xE080: VRC_VBANK(7,value,0); break;
9D029C74  A3868173   SB A2, -32397(GP)
9D029C78  9384816B   LBU A0, -32405(GP)
9D029C7C  0004C900   SLL T9, A0, 4
9D029C80  24040001   ADDIU A0, ZERO, 1
9D029C84  24051C00   ADDIU A1, ZERO, 7168
9D029C88  0F40CA16   JAL mmc_bankvrom
9D029C8C  03263021   ADDU A2, T9, A2
9D029C90  0B40A74E   J 0x9D029D38
9D029C94  8FBF0014   LW RA, 20(SP)
126:                    case 0xE003:
127:                    case 0xE006:
128:                    case 0xE0C0: VRC_VBANK(7,value,1); break;
9D029C98  30C2000F   ANDI V0, A2, 15
9D029C9C  A382816B   SB V0, -32405(GP)
9D029CA0  00023900   SLL A3, V0, 4
9D029CA4  93888173   LBU T0, -32397(GP)
9D029CA8  24040001   ADDIU A0, ZERO, 1
9D029CAC  24051C00   ADDIU A1, ZERO, 7168
9D029CB0  0F40CA16   JAL mmc_bankvrom
9D029CB4  00E83021   ADDU A2, A3, T0
9D029CB8  0B40A74E   J 0x9D029D38
9D029CBC  8FBF0014   LW RA, 20(SP)
129:                 
130:                    case 0xF000:
131:                       irq.latch &= 0xF0;
9D029CC8  8CAB0008   LW T3, 8(A1)
9D029CCC  316C00F0   ANDI T4, T3, 240
132:                       irq.latch |= (value & 0x0F);
9D029CC0  252558FC   ADDIU A1, T1, 22780
9D029CC4  30CA000F   ANDI T2, A2, 15
9D029CD0  014C6825   OR T5, T2, T4
133:                       break;
9D029CD4  0B40A74D   J 0x9D029D34
9D029CD8  ACAD0008   SW T5, 8(A1)
134:                    case 0xF002:
135:                    case 0xF040:
136:                       irq.latch &= 0x0F;
9D029CEC  8DD90008   LW T9, 8(T6)
9D029CF0  333F000F   ANDI RA, T9, 15
137:                       irq.latch |= ((value & 0x0F) << 4);
9D029CDC  3C0DA001   LUI T5, -24575
9D029CE0  25AE58FC   ADDIU T6, T5, 22780
9D029CE4  00067900   SLL T7, A2, 4
9D029CE8  31F800FF   ANDI T8, T7, 255
9D029CF4  031F1825   OR V1, T8, RA
138:                       break;
9D029CF8  0B40A74D   J 0x9D029D34
9D029CFC  ADC30008   SW V1, 8(T6)
139:                    case 0xF004:
140:                    case 0xF001:
141:                    case 0xF080:
142:                       irq.enabled = (value >> 1) & 0x01;
9D029D00  3C08A001   LUI T0, -24575
9D029D04  250958FC   ADDIU T1, T0, 22780
9D029D08  7CC40040   EXT A0, A2, 1, 1
9D029D0C  AD240004   SW A0, 4(T1)
143:                       irq.wait_state = value & 0x01;
9D029D10  30C60001   ANDI A2, A2, 1
9D029D14  AD26000C   SW A2, 12(T1)
144:                       irq.counter = irq.latch;
9D029D18  8D250008   LW A1, 8(T1)
145:                       break;
9D029D1C  0B40A74D   J 0x9D029D34
9D029D20  AD0558FC   SW A1, 22780(T0)
146:                    case 0xF006:
147:                    case 0xF003:
148:                    case 0xF0C0:
149:                       irq.enabled = irq.wait_state;
9D029D24  3C0AA001   LUI T2, -24575
9D029D28  254B58FC   ADDIU T3, T2, 22780
9D029D2C  8D6C000C   LW T4, 12(T3)
9D029D30  AD6C0004   SW T4, 4(T3)
150:                       break;
151:                 
152:                    default:
153:                 #ifdef NOFRENDO_DEBUG
154:                       log_printf("wrote $%02X to $%04X", value, address);
155:                 #endif
156:                       break;
157:                    }
158:                 }
9D0296C8  0B40A74E   J 0x9D029D38
9D0296CC  8FBF0014   LW RA, 20(SP)
9D0296E0  0B40A74E   J 0x9D029D38
9D0296E4  8FBF0014   LW RA, 20(SP)
9D029718  0B40A74E   J 0x9D029D38
9D02971C  8FBF0014   LW RA, 20(SP)
9D029734  0B40A74E   J 0x9D029D38
9D029738  8FBF0014   LW RA, 20(SP)
9D02977C  0B40A74E   J 0x9D029D38
9D029780  8FBF0014   LW RA, 20(SP)
9D02979C  0B40A74E   J 0x9D029D38
9D0297A0  8FBF0014   LW RA, 20(SP)
9D0297CC  0B40A74E   J 0x9D029D38
9D0297D0  8FBF0014   LW RA, 20(SP)
9D0297F4  0B40A74E   J 0x9D029D38
9D0297F8  8FBF0014   LW RA, 20(SP)
9D029858  0B40A74E   J 0x9D029D38
9D02985C  8FBF0014   LW RA, 20(SP)
9D029874  0B40A74E   J 0x9D029D38
9D029878  8FBF0014   LW RA, 20(SP)
9D0298A4  0B40A74E   J 0x9D029D38
9D0298A8  8FBF0014   LW RA, 20(SP)
9D0298C0  0B40A74E   J 0x9D029D38
9D0298C4  8FBF0014   LW RA, 20(SP)
9D029908  0B40A74E   J 0x9D029D38
9D02990C  8FBF0014   LW RA, 20(SP)
9D029924  0B40A74E   J 0x9D029D38
9D029928  8FBF0014   LW RA, 20(SP)
9D029958  0B40A74E   J 0x9D029D38
9D02995C  8FBF0014   LW RA, 20(SP)
9D029978  0B40A74E   J 0x9D029D38
9D02997C  8FBF0014   LW RA, 20(SP)
9D0299A4  0B40A74E   J 0x9D029D38
9D0299A8  8FBF0014   LW RA, 20(SP)
9D0299D4  0B40A74E   J 0x9D029D38
9D0299D8  8FBF0014   LW RA, 20(SP)
9D029D34  8FBF0014   LW RA, 20(SP)
9D029D38  03E00008   JR RA
9D029D3C  27BD0018   ADDIU SP, SP, 24
159:                 
160:                 static void map22_write(uint32 address, uint8 value)
161:                 {
9D029D40  27BDFFE8   ADDIU SP, SP, -24
162:                    int reg = address >> 12;
9D029D44  00041B02   SRL V1, A0, 12
163:                    
164:                    switch (reg)
9D029D48  2462FFF8   ADDIU V0, V1, -8
9D029D4C  2C470007   SLTIU A3, V0, 7
9D029D50  10E00047   BEQ A3, ZERO, .LVL90, .LBE2
9D029D54  AFBF0014   SW RA, 20(SP)
9D029D58  00A03021   ADDU A2, A1, ZERO
9D029D5C  00024080   SLL T0, V0, 2
9D029D60  3C059D03   LUI A1, -25341
9D029D64  24A99D78   ADDIU T1, A1, -25224
9D029D68  01285021   ADDU T2, T1, T0
9D029D6C  8D4B0000   LW T3, 0(T2)
9D029D70  01600008   JR T3
9D029D74  00000000   NOP
165:                    {
166:                    case 0x8:
167:                       mmc_bankrom(8, 0x8000, value);
9D029D94  24040008   ADDIU A0, ZERO, 8
9D029D98  0F40CA71   JAL mmc_bankrom
9D029D9C  34058000   ORI A1, ZERO, -32768
168:                       break;
9D029DA0  0B40A79D   J 0x9D029E74
9D029DA4  8FBF0014   LW RA, 20(SP)
169:                    
170:                    case 0xA:
171:                       mmc_bankrom(8, 0xA000, value);
9D029DA8  24040008   ADDIU A0, ZERO, 8
9D029DAC  0F40CA71   JAL mmc_bankrom
9D029DB0  3405A000   ORI A1, ZERO, -24576
172:                       break;
9D029DB4  0B40A79D   J 0x9D029E74
9D029DB8  8FBF0014   LW RA, 20(SP)
173:                 
174:                    case 0x9:
175:                       switch (value & 3)
9D029DBC  30C60003   ANDI A2, A2, 3
9D029DC0  24040001   ADDIU A0, ZERO, 1
9D029DC4  50C40010   BEQL A2, A0, 0x9D029E08
9D029DC8  00002021   ADDU A0, ZERO, ZERO
9D029DCC  10C00007   BEQ A2, ZERO, 0x9D029DEC
9D029DD0  240C0002   ADDIU T4, ZERO, 2
9D029DD4  10CC0012   BEQ A2, T4, 0x9D029E20
9D029DD8  240D0003   ADDIU T5, ZERO, 3
9D029DDC  10CD0016   BEQ A2, T5, 0x9D029E38
9D029DE0  00002021   ADDU A0, ZERO, ZERO
176:                       {
177:                       case 0:
178:                          ppu_mirror(0, 1, 0, 1); /* vertical */
9D029DEC  00002021   ADDU A0, ZERO, ZERO
9D029DF0  24050001   ADDIU A1, ZERO, 1
9D029DF4  00003021   ADDU A2, ZERO, ZERO
9D029DF8  0F4058FD   JAL ppu_mirror
9D029DFC  24070001   ADDIU A3, ZERO, 1
179:                          break;
9D029E00  0B40A79D   J 0x9D029E74
9D029E04  8FBF0014   LW RA, 20(SP)
180:                 
181:                       case 1: 
182:                          ppu_mirror(0, 0, 1, 1); /* horizontal */
9D029E08  00002821   ADDU A1, ZERO, ZERO
9D029E0C  24060001   ADDIU A2, ZERO, 1
9D029E10  0F4058FD   JAL ppu_mirror
9D029E14  24070001   ADDIU A3, ZERO, 1
183:                          break;
9D029E18  0B40A79D   J 0x9D029E74
9D029E1C  8FBF0014   LW RA, 20(SP)
184:                 
185:                       case 2:
186:                          ppu_mirror(1, 1, 1, 1);
9D029E20  24050001   ADDIU A1, ZERO, 1
9D029E24  24060001   ADDIU A2, ZERO, 1
9D029E28  0F4058FD   JAL ppu_mirror
9D029E2C  24070001   ADDIU A3, ZERO, 1
187:                          break;
9D029E30  0B40A79D   J 0x9D029E74
9D029E34  8FBF0014   LW RA, 20(SP)
188:                 
189:                       case 3:
190:                          ppu_mirror(0, 0, 0, 0);
9D029E38  00002821   ADDU A1, ZERO, ZERO
9D029E3C  00003021   ADDU A2, ZERO, ZERO
9D029E40  0F4058FD   JAL ppu_mirror
9D029E44  00003821   ADDU A3, ZERO, ZERO
191:                          break;
9D029E48  0B40A79D   J 0x9D029E74
9D029E4C  8FBF0014   LW RA, 20(SP)
192:                       }
193:                       break;
194:                 
195:                    case 0xB:
196:                    case 0xC:
197:                    case 0xD:
198:                    case 0xE:
199:                       {
200:                          int loc = (((reg - 0xB) << 1) + (address & 1)) << 10;
9D029E50  246EFFF5   ADDIU T6, V1, -11
9D029E54  000E7840   SLL T7, T6, 1
9D029E58  30980001   ANDI T8, A0, 1
9D029E5C  01F8C821   ADDU T9, T7, T8
201:                          mmc_bankvrom(1, loc, value >> 1);
9D029E60  24040001   ADDIU A0, ZERO, 1
9D029E64  00192A80   SLL A1, T9, 10
9D029E68  0F40CA16   JAL mmc_bankvrom
9D029E6C  00063042   SRL A2, A2, 1
202:                       }
203:                       break;
204:                 
205:                    default:
206:                       break;
207:                    }
208:                 }
9D029DE4  0B40A79D   J 0x9D029E74
9D029DE8  8FBF0014   LW RA, 20(SP)
9D029E70  8FBF0014   LW RA, 20(SP)
9D029E74  03E00008   JR RA
9D029E78  27BD0018   ADDIU SP, SP, 24
209:                 
210:                 static void map23_write(uint32 address, uint8 value)
211:                 {
9D029E7C  27BDFFE8   ADDIU SP, SP, -24
9D029E80  AFBF0014   SW RA, 20(SP)
212:                    switch (address)
9D029E84  3402C008   ORI V0, ZERO, -16376
9D029E88  10820103   BEQ A0, V0, 0x9D02A298
9D029E8C  00A03021   ADDU A2, A1, ZERO
9D029E90  3403C009   ORI V1, ZERO, -16375
9D029E94  0083282B   SLTU A1, A0, V1
9D029E98  10A00049   BEQ A1, ZERO, 0x9D029FC0
9D029E9C  3409E001   ORI T1, ZERO, -8191
9D029EA0  3407B002   ORI A3, ZERO, -20478
9D029EA4  108700D4   BEQ A0, A3, 0x9D02A1F8
9D029EA8  3408B003   ORI T0, ZERO, -20477
9D029EAC  0088482B   SLTU T1, A0, T0
9D029EB0  11200029   BEQ T1, ZERO, 0x9D029F58
9D029EB4  340FC000   ORI T7, ZERO, -16384
9D029EB8  340A9008   ORI T2, ZERO, -28664
9D029EBC  108A0097   BEQ A0, T2, 0x9D02A11C
9D029EC0  340B9009   ORI T3, ZERO, -28663
9D029EC4  008B602B   SLTU T4, A0, T3
9D029EC8  51800012   BEQL T4, ZERO, 0x9D029F14
9D029ECC  3402AFFF   ORI V0, ZERO, -20481
9D029ED0  340D8FFF   ORI T5, ZERO, -28673
9D029ED4  108D0087   BEQ A0, T5, 0x9D02A0F4
9D029ED8  340E9000   ORI T6, ZERO, -28672
9D029EDC  008E782B   SLTU T7, A0, T6
9D029EE0  11E00006   BEQ T7, ZERO, 0x9D029EFC
9D029EE4  34199000   ORI T9, ZERO, -28672
9D029EE8  34188000   ORI T8, ZERO, -32768
9D029EEC  10980082   BEQ A0, T8, 0x9D02A0F8
9D029EF0  24040008   ADDIU A0, ZERO, 8
9D029EFC  10990087   BEQ A0, T9, 0x9D02A11C
9D029F00  341F9004   ORI RA, ZERO, -28668
9D029F04  109F0086   BEQ A0, RA, 0x9D02A120
9D029F08  30CB0003   ANDI T3, A2, 3
9D029F14  1082007C   BEQ A0, V0, 0x9D02A108
9D029F18  3403B000   ORI V1, ZERO, -20480
9D029F1C  0083282B   SLTU A1, A0, V1
9D029F20  10A00006   BEQ A1, ZERO, 0x9D029F3C
9D029F24  3408B000   ORI T0, ZERO, -20480
9D029F28  3407A000   ORI A3, ZERO, -24576
9D029F2C  10870077   BEQ A0, A3, 0x9D02A10C
9D029F30  24040008   ADDIU A0, ZERO, 8
9D029F3C  5088009B   BEQL A0, T0, 0x9D02A1AC
9D029F40  30C6000F   ANDI A2, A2, 15
9D029F44  3409B001   ORI T1, ZERO, -20479
9D029F48  508900A2   BEQL A0, T1, 0x9D02A1D4
9D029F4C  30C6000F   ANDI A2, A2, 15
9D029F58  108F00BB   BEQ A0, T7, 0x9D02A248
9D029F5C  3418C001   ORI T8, ZERO, -16383
9D029F60  0098C82B   SLTU T9, A0, T8
9D029F64  1320000C   BEQ T9, ZERO, 0x9D029F98
9D029F68  340CC002   ORI T4, ZERO, -16382
9D029F6C  341FB004   ORI RA, ZERO, -20476
9D029F70  109F0097   BEQ A0, RA, 0x9D02A1D0
9D029F74  009F102B   SLTU V0, A0, RA
9D029F78  144000A9   BNE V0, ZERO, 0x9D02A220
9D029F7C  3403B008   ORI V1, ZERO, -20472
9D029F80  1083009D   BEQ A0, V1, 0x9D02A1F8
9D029F84  3405B00C   ORI A1, ZERO, -20468
9D029F88  108500A6   BEQ A0, A1, 0x9D02A224
9D029F8C  30C7000F   ANDI A3, A2, 15
9D029F98  108C00BF   BEQ A0, T4, 0x9D02A298
9D029F9C  008C682B   SLTU T5, A0, T4
9D029FA0  15A000B3   BNE T5, ZERO, 0x9D02A270
9D029FA4  340EC003   ORI T6, ZERO, -16381
9D029FA8  108E00C5   BEQ A0, T6, 0x9D02A2C0
9D029FAC  340FC004   ORI T7, ZERO, -16380
9D029FB0  108F00B0   BEQ A0, T7, 0x9D02A274
9D029FB4  30C4000F   ANDI A0, A2, 15
9D029FC0  108900FA   BEQ A0, T1, 0x9D02A3AC
9D029FC4  340AE002   ORI T2, ZERO, -8190
9D029FC8  008A582B   SLTU T3, A0, T2
9D029FCC  51600029   BEQL T3, ZERO, 0x9D02A074
9D029FD0  340BE00C   ORI T3, ZERO, -8180
9D029FD4  340CD003   ORI T4, ZERO, -12285
9D029FD8  108C00E1   BEQ A0, T4, 0x9D02A360
9D029FDC  340DD004   ORI T5, ZERO, -12284
9D029FE0  008D702B   SLTU T6, A0, T5
9D029FE4  51C00012   BEQL T6, ZERO, 0x9D02A030
9D029FE8  340AD008   ORI T2, ZERO, -12280
9D029FEC  340FD000   ORI T7, ZERO, -12288
9D029FF0  108F00BD   BEQ A0, T7, 0x9D02A2E8
9D029FF4  3418D001   ORI T8, ZERO, -12287
9D029FF8  0098C82B   SLTU T9, A0, T8
9D029FFC  13200006   BEQ T9, ZERO, 0x9D02A018
9D02A000  3407D001   ORI A3, ZERO, -12287
9D02A004  341FC00C   ORI RA, ZERO, -16372
9D02A008  509F00AE   BEQL A0, RA, 0x9D02A2C4
9D02A00C  30C6000F   ANDI A2, A2, 15
9D02A018  108700BD   BEQ A0, A3, 0x9D02A310
9D02A01C  3405D002   ORI A1, ZERO, -12286
9D02A020  108500C6   BEQ A0, A1, 0x9D02A33C
9D02A024  30C7000F   ANDI A3, A2, 15
9D02A030  108A00C1   BEQ A0, T2, 0x9D02A338
9D02A034  340BD009   ORI T3, ZERO, -12279
9D02A038  008B602B   SLTU T4, A0, T3
9D02A03C  11800006   BEQ T4, ZERO, 0x9D02A058
9D02A040  3419D00C   ORI T9, ZERO, -12276
9D02A044  340DD004   ORI T5, ZERO, -12284
9D02A048  108D00B2   BEQ A0, T5, 0x9D02A314
9D02A04C  30CE000F   ANDI T6, A2, 15
9D02A058  509900C2   BEQL A0, T9, 0x9D02A364
9D02A05C  30C4000F   ANDI A0, A2, 15
9D02A060  341FE000   ORI RA, ZERO, -8192
9D02A064  509F00C8   BEQL A0, RA, 0x9D02A388
9D02A068  30C6000F   ANDI A2, A2, 15
9D02A074  108B00E1   BEQ A0, T3, 0x9D02A3FC
9D02A078  340CE00D   ORI T4, ZERO, -8179
9D02A07C  008C682B   SLTU T5, A0, T4
9D02A080  11A0000C   BEQ T5, ZERO, 0x9D02A0B4
9D02A084  3402F004   ORI V0, ZERO, -4092
9D02A088  340EE003   ORI T6, ZERO, -8189
9D02A08C  108E00DB   BEQ A0, T6, 0x9D02A3FC
9D02A090  008E782B   SLTU T7, A0, T6
9D02A094  15E000CF   BNE T7, ZERO, 0x9D02A3D4
9D02A098  3418E004   ORI T8, ZERO, -8188
9D02A09C  109800C3   BEQ A0, T8, 0x9D02A3AC
9D02A0A0  3419E008   ORI T9, ZERO, -8184
9D02A0A4  509900CC   BEQL A0, T9, 0x9D02A3D8
9D02A0A8  30DF000F   ANDI RA, A2, 15
9D02A0B4  108200E2   BEQ A0, V0, 0x9D02A440
9D02A0B8  3407F005   ORI A3, ZERO, -4091
9D02A0BC  0087282B   SLTU A1, A0, A3
9D02A0C0  10A00006   BEQ A1, ZERO, 0x9D02A0DC
9D02A0C4  340EF008   ORI T6, ZERO, -4088
9D02A0C8  3408F000   ORI T0, ZERO, -4096
9D02A0CC  108800D5   BEQ A0, T0, 0x9D02A424
9D02A0D0  3C04A001   LUI A0, -24575
9D02A0DC  108E00E1   BEQ A0, T6, 0x9D02A464
9D02A0E0  340FF00C   ORI T7, ZERO, -4084
9D02A0E4  108F00E8   BEQ A0, T7, 0x9D02A488
9D02A0E8  3C18A001   LUI T8, -24575
213:                    {
214:                    case 0x8000:
215:                    case 0x8FFF:
216:                       mmc_bankrom(8, 0x8000, value);
9D02A0F4  24040008   ADDIU A0, ZERO, 8
9D02A0F8  0F40CA71   JAL mmc_bankrom
9D02A0FC  34058000   ORI A1, ZERO, -32768
217:                       break;
9D02A100  0B40A926   J 0x9D02A498
9D02A104  8FBF0014   LW RA, 20(SP)
218:                 
219:                    case 0xA000:
220:                    case 0xAFFF:
221:                       mmc_bankrom(8, 0xA000, value);
9D02A108  24040008   ADDIU A0, ZERO, 8
9D02A10C  0F40CA71   JAL mmc_bankrom
9D02A110  3405A000   ORI A1, ZERO, -24576
222:                       break;
9D02A114  0B40A926   J 0x9D02A498
9D02A118  8FBF0014   LW RA, 20(SP)
223:                    
224:                    case 0x9000:
225:                    case 0x9004:
226:                    case 0x9008:
227:                       switch(value & 3)
9D02A11C  30CB0003   ANDI T3, A2, 3
9D02A120  240C0001   ADDIU T4, ZERO, 1
9D02A124  116C000F   BEQ T3, T4, 0x9D02A164
9D02A128  00002021   ADDU A0, ZERO, ZERO
9D02A12C  11600007   BEQ T3, ZERO, 0x9D02A14C
9D02A130  240D0002   ADDIU T5, ZERO, 2
9D02A134  116D0011   BEQ T3, T5, 0x9D02A17C
9D02A138  240E0003   ADDIU T6, ZERO, 3
9D02A13C  116E0015   BEQ T3, T6, 0x9D02A194
9D02A140  24040001   ADDIU A0, ZERO, 1
228:                       {
229:                       case 0:
230:                          ppu_mirror(0, 1, 0, 1); /* vertical */
9D02A14C  24050001   ADDIU A1, ZERO, 1
9D02A150  00003021   ADDU A2, ZERO, ZERO
9D02A154  0F4058FD   JAL ppu_mirror
9D02A158  24070001   ADDIU A3, ZERO, 1
231:                          break;
9D02A15C  0B40A926   J 0x9D02A498
9D02A160  8FBF0014   LW RA, 20(SP)
232:                 
233:                       case 1: 
234:                          ppu_mirror(0, 0, 1, 1); /* horizontal */
9D02A164  00002821   ADDU A1, ZERO, ZERO
9D02A168  24060001   ADDIU A2, ZERO, 1
9D02A16C  0F4058FD   JAL ppu_mirror
9D02A170  24070001   ADDIU A3, ZERO, 1
235:                          break;
9D02A174  0B40A926   J 0x9D02A498
9D02A178  8FBF0014   LW RA, 20(SP)
236:                 
237:                       case 2:
238:                          ppu_mirror(0, 0, 0, 0);
9D02A17C  00002821   ADDU A1, ZERO, ZERO
9D02A180  00003021   ADDU A2, ZERO, ZERO
9D02A184  0F4058FD   JAL ppu_mirror
9D02A188  00003821   ADDU A3, ZERO, ZERO
239:                          break;
9D02A18C  0B40A926   J 0x9D02A498
9D02A190  8FBF0014   LW RA, 20(SP)
240:                 
241:                       case 3:
242:                          ppu_mirror(1, 1, 1, 1);
9D02A194  24050001   ADDIU A1, ZERO, 1
9D02A198  24060001   ADDIU A2, ZERO, 1
9D02A19C  0F4058FD   JAL ppu_mirror
9D02A1A0  24070001   ADDIU A3, ZERO, 1
243:                          break;
9D02A1A4  0B40A926   J 0x9D02A498
9D02A1A8  8FBF0014   LW RA, 20(SP)
244:                       }
245:                       break;
246:                 
247:                    case 0xB000: VRC_VBANK(0,value,0); break;
9D02A1AC  A386816C   SB A2, -32404(GP)
9D02A1B0  93848164   LBU A0, -32412(GP)
9D02A1B4  00045100   SLL T2, A0, 4
9D02A1B8  24040001   ADDIU A0, ZERO, 1
9D02A1BC  00002821   ADDU A1, ZERO, ZERO
9D02A1C0  0F40CA16   JAL mmc_bankvrom
9D02A1C4  01463021   ADDU A2, T2, A2
9D02A1C8  0B40A926   J 0x9D02A498
9D02A1CC  8FBF0014   LW RA, 20(SP)
248:                    case 0xB001:
249:                    case 0xB004: VRC_VBANK(0,value,1); break;
9D02A1D0  30C6000F   ANDI A2, A2, 15
9D02A1D4  A3868164   SB A2, -32412(GP)
9D02A1D8  00065100   SLL T2, A2, 4
9D02A1DC  938B816C   LBU T3, -32404(GP)
9D02A1E0  24040001   ADDIU A0, ZERO, 1
9D02A1E4  00002821   ADDU A1, ZERO, ZERO
9D02A1E8  0F40CA16   JAL mmc_bankvrom
9D02A1EC  014B3021   ADDU A2, T2, T3
9D02A1F0  0B40A926   J 0x9D02A498
9D02A1F4  8FBF0014   LW RA, 20(SP)
250:                    case 0xB002:
251:                    case 0xB008: VRC_VBANK(1,value,0); break;
9D02A1F8  30C7000F   ANDI A3, A2, 15
9D02A1FC  A387816D   SB A3, -32403(GP)
9D02A200  93858165   LBU A1, -32411(GP)
9D02A204  00054100   SLL T0, A1, 4
9D02A208  24040001   ADDIU A0, ZERO, 1
9D02A20C  24050400   ADDIU A1, ZERO, 1024
9D02A210  0F40CA16   JAL mmc_bankvrom
9D02A214  01073021   ADDU A2, T0, A3
9D02A218  0B40A926   J 0x9D02A498
9D02A21C  8FBF0014   LW RA, 20(SP)
252:                    case 0xB003:
253:                    case 0xB00C: VRC_VBANK(1,value,1); break;
9D02A220  30C7000F   ANDI A3, A2, 15
9D02A224  A3878165   SB A3, -32411(GP)
9D02A228  00074100   SLL T0, A3, 4
9D02A22C  9389816D   LBU T1, -32403(GP)
9D02A230  24040001   ADDIU A0, ZERO, 1
9D02A234  24050400   ADDIU A1, ZERO, 1024
9D02A238  0F40CA16   JAL mmc_bankvrom
9D02A23C  01093021   ADDU A2, T0, T1
9D02A240  0B40A926   J 0x9D02A498
9D02A244  8FBF0014   LW RA, 20(SP)
254:                    case 0xC000: VRC_VBANK(2,value,0); break;
9D02A248  30DF000F   ANDI RA, A2, 15
9D02A24C  A39F816E   SB RA, -32402(GP)
9D02A250  93828166   LBU V0, -32410(GP)
9D02A254  00021900   SLL V1, V0, 4
9D02A258  24040001   ADDIU A0, ZERO, 1
9D02A25C  007F3021   ADDU A2, V1, RA
9D02A260  0F40CA16   JAL mmc_bankvrom
9D02A264  24050800   ADDIU A1, ZERO, 2048
9D02A268  0B40A926   J 0x9D02A498
9D02A26C  8FBF0014   LW RA, 20(SP)
255:                    case 0xC001:
256:                    case 0xC004: VRC_VBANK(2,value,1); break;
9D02A270  30C4000F   ANDI A0, A2, 15
9D02A274  A3848166   SB A0, -32410(GP)
9D02A278  0004C100   SLL T8, A0, 4
9D02A27C  9399816E   LBU T9, -32402(GP)
9D02A280  24040001   ADDIU A0, ZERO, 1
9D02A284  24050800   ADDIU A1, ZERO, 2048
9D02A288  0F40CA16   JAL mmc_bankvrom
9D02A28C  03193021   ADDU A2, T8, T9
9D02A290  0B40A926   J 0x9D02A498
9D02A294  8FBF0014   LW RA, 20(SP)
257:                    case 0xC002:
258:                    case 0xC008: VRC_VBANK(3,value,0); break;
9D02A298  30C7000F   ANDI A3, A2, 15
9D02A29C  A387816F   SB A3, -32401(GP)
9D02A2A0  93828167   LBU V0, -32409(GP)
9D02A2A4  00023100   SLL A2, V0, 4
9D02A2A8  24040001   ADDIU A0, ZERO, 1
9D02A2AC  24050C00   ADDIU A1, ZERO, 3072
9D02A2B0  0F40CA16   JAL mmc_bankvrom
9D02A2B4  00C73021   ADDU A2, A2, A3
9D02A2B8  0B40A926   J 0x9D02A498
9D02A2BC  8FBF0014   LW RA, 20(SP)
259:                    case 0xC003:
260:                    case 0xC00C: VRC_VBANK(3,value,1); break;
9D02A2C0  30C6000F   ANDI A2, A2, 15
9D02A2C4  A3868167   SB A2, -32409(GP)
9D02A2C8  00061900   SLL V1, A2, 4
9D02A2CC  9382816F   LBU V0, -32401(GP)
9D02A2D0  24040001   ADDIU A0, ZERO, 1
9D02A2D4  24050C00   ADDIU A1, ZERO, 3072
9D02A2D8  0F40CA16   JAL mmc_bankvrom
9D02A2DC  00623021   ADDU A2, V1, V0
9D02A2E0  0B40A926   J 0x9D02A498
9D02A2E4  8FBF0014   LW RA, 20(SP)
261:                    case 0xD000: VRC_VBANK(4,value,0); break;
9D02A2E8  30C8000F   ANDI T0, A2, 15
9D02A2EC  A3888170   SB T0, -32400(GP)
9D02A2F0  93848168   LBU A0, -32408(GP)
9D02A2F4  00044900   SLL T1, A0, 4
9D02A2F8  24040001   ADDIU A0, ZERO, 1
9D02A2FC  24051000   ADDIU A1, ZERO, 4096
9D02A300  0F40CA16   JAL mmc_bankvrom
9D02A304  01283021   ADDU A2, T1, T0
9D02A308  0B40A926   J 0x9D02A498
9D02A30C  8FBF0014   LW RA, 20(SP)
262:                    case 0xD001:
263:                    case 0xD004: VRC_VBANK(4,value,1); break;
9D02A310  30CE000F   ANDI T6, A2, 15
9D02A314  A38E8168   SB T6, -32408(GP)
9D02A318  000E7900   SLL T7, T6, 4
9D02A31C  93988170   LBU T8, -32400(GP)
9D02A320  24040001   ADDIU A0, ZERO, 1
9D02A324  24051000   ADDIU A1, ZERO, 4096
9D02A328  0F40CA16   JAL mmc_bankvrom
9D02A32C  01F83021   ADDU A2, T7, T8
9D02A330  0B40A926   J 0x9D02A498
9D02A334  8FBF0014   LW RA, 20(SP)
264:                    case 0xD002:
265:                    case 0xD008: VRC_VBANK(5,value,0); break;
9D02A338  30C7000F   ANDI A3, A2, 15
9D02A33C  A3878171   SB A3, -32399(GP)
9D02A340  93858169   LBU A1, -32407(GP)
9D02A344  00054100   SLL T0, A1, 4
9D02A348  24040001   ADDIU A0, ZERO, 1
9D02A34C  24051400   ADDIU A1, ZERO, 5120
9D02A350  0F40CA16   JAL mmc_bankvrom
9D02A354  01073021   ADDU A2, T0, A3
9D02A358  0B40A926   J 0x9D02A498
9D02A35C  8FBF0014   LW RA, 20(SP)
266:                    case 0xD003:
267:                    case 0xD00C: VRC_VBANK(5,value,1); break;
9D02A360  30C4000F   ANDI A0, A2, 15
9D02A364  A3848169   SB A0, -32407(GP)
9D02A368  00044900   SLL T1, A0, 4
9D02A36C  938A8171   LBU T2, -32399(GP)
9D02A370  24040001   ADDIU A0, ZERO, 1
9D02A374  24051400   ADDIU A1, ZERO, 5120
9D02A378  0F40CA16   JAL mmc_bankvrom
9D02A37C  012A3021   ADDU A2, T1, T2
9D02A380  0B40A926   J 0x9D02A498
9D02A384  8FBF0014   LW RA, 20(SP)
268:                    case 0xE000: VRC_VBANK(6,value,0); break;
9D02A388  A3868172   SB A2, -32398(GP)
9D02A38C  9383816A   LBU V1, -32406(GP)
9D02A390  00031100   SLL V0, V1, 4
9D02A394  24040001   ADDIU A0, ZERO, 1
9D02A398  24051800   ADDIU A1, ZERO, 6144
9D02A39C  0F40CA16   JAL mmc_bankvrom
9D02A3A0  00463021   ADDU A2, V0, A2
9D02A3A4  0B40A926   J 0x9D02A498
9D02A3A8  8FBF0014   LW RA, 20(SP)
269:                    case 0xE001:
270:                    case 0xE004: VRC_VBANK(6,value,1); break;
9D02A3AC  30D9000F   ANDI T9, A2, 15
9D02A3B0  A399816A   SB T9, -32406(GP)
9D02A3B4  0019F900   SLL RA, T9, 4
9D02A3B8  93838172   LBU V1, -32398(GP)
9D02A3BC  24040001   ADDIU A0, ZERO, 1
9D02A3C0  03E33021   ADDU A2, RA, V1
9D02A3C4  0F40CA16   JAL mmc_bankvrom
9D02A3C8  24051800   ADDIU A1, ZERO, 6144
9D02A3CC  0B40A926   J 0x9D02A498
9D02A3D0  8FBF0014   LW RA, 20(SP)
271:                    case 0xE002:
272:                    case 0xE008: VRC_VBANK(7,value,0); break;
9D02A3D4  30DF000F   ANDI RA, A2, 15
9D02A3D8  A39F8173   SB RA, -32397(GP)
9D02A3DC  9386816B   LBU A2, -32405(GP)
9D02A3E0  00061900   SLL V1, A2, 4
9D02A3E4  24040001   ADDIU A0, ZERO, 1
9D02A3E8  007F3021   ADDU A2, V1, RA
9D02A3EC  0F40CA16   JAL mmc_bankvrom
9D02A3F0  24051C00   ADDIU A1, ZERO, 7168
9D02A3F4  0B40A926   J 0x9D02A498
9D02A3F8  8FBF0014   LW RA, 20(SP)
273:                    case 0xE003:
274:                    case 0xE00C: VRC_VBANK(7,value,1); break;
9D02A3FC  30CE000F   ANDI T6, A2, 15
9D02A400  A38E816B   SB T6, -32405(GP)
9D02A404  000E7900   SLL T7, T6, 4
9D02A408  93988173   LBU T8, -32397(GP)
9D02A40C  24040001   ADDIU A0, ZERO, 1
9D02A410  24051C00   ADDIU A1, ZERO, 7168
9D02A414  0F40CA16   JAL mmc_bankvrom
9D02A418  01F83021   ADDU A2, T7, T8
9D02A41C  0B40A926   J 0x9D02A498
9D02A420  8FBF0014   LW RA, 20(SP)
275:                 
276:                    case 0xF000: 
277:                       irq.latch &= 0xF0;
9D02A42C  8D2B0008   LW T3, 8(T1)
9D02A430  316C00F0   ANDI T4, T3, 240
278:                       irq.latch |= (value & 0x0F);
9D02A424  248958FC   ADDIU T1, A0, 22780
9D02A428  30CA000F   ANDI T2, A2, 15
9D02A434  014C6825   OR T5, T2, T4
279:                       break;
9D02A438  0B40A925   J 0x9D02A494
9D02A43C  AD2D0008   SW T5, 8(T1)
280:                 
281:                    case 0xF004: 
282:                       irq.latch &= 0x0F;
9D02A450  8C8B0008   LW T3, 8(A0)
9D02A454  316C000F   ANDI T4, T3, 15
283:                       irq.latch |= ((value & 0x0F) << 4);
9D02A440  3C08A001   LUI T0, -24575
9D02A444  250458FC   ADDIU A0, T0, 22780
9D02A448  00064900   SLL T1, A2, 4
9D02A44C  312A00FF   ANDI T2, T1, 255
9D02A458  014C6825   OR T5, T2, T4
284:                       break;
9D02A45C  0B40A925   J 0x9D02A494
9D02A460  AC8D0008   SW T5, 8(A0)
285:                 
286:                    case 0xF008:
287:                       irq.enabled = (value >> 1) & 0x01;
9D02A464  3C03A001   LUI V1, -24575
9D02A468  246258FC   ADDIU V0, V1, 22780
9D02A46C  7CC70040   EXT A3, A2, 1, 1
9D02A470  AC470004   SW A3, 4(V0)
288:                       irq.wait_state = value & 0x01;
9D02A474  30C60001   ANDI A2, A2, 1
9D02A478  AC46000C   SW A2, 12(V0)
289:                       irq.counter = irq.latch;
9D02A47C  8C450008   LW A1, 8(V0)
290:                       break;
9D02A480  0B40A925   J 0x9D02A494
9D02A484  AC6558FC   SW A1, 22780(V1)
291:                 
292:                    case 0xF00C:
293:                       irq.enabled = irq.wait_state;
9D02A488  271958FC   ADDIU T9, T8, 22780
9D02A48C  8F3F000C   LW RA, 12(T9)
9D02A490  AF3F0004   SW RA, 4(T9)
294:                       break;
295:                 
296:                    default:
297:                 #ifdef NOFRENDO_DEBUG
298:                       log_printf("wrote $%02X to $%04X",value,address);
299:                 #endif
300:                       break;
301:                    }
302:                 }
9D029EF4  0B40A926   J 0x9D02A498
9D029EF8  8FBF0014   LW RA, 20(SP)
9D029F0C  0B40A926   J 0x9D02A498
9D029F10  8FBF0014   LW RA, 20(SP)
9D029F34  0B40A926   J 0x9D02A498
9D029F38  8FBF0014   LW RA, 20(SP)
9D029F50  0B40A926   J 0x9D02A498
9D029F54  8FBF0014   LW RA, 20(SP)
9D029F90  0B40A926   J 0x9D02A498
9D029F94  8FBF0014   LW RA, 20(SP)
9D029FB8  0B40A926   J 0x9D02A498
9D029FBC  8FBF0014   LW RA, 20(SP)
9D02A010  0B40A926   J 0x9D02A498
9D02A014  8FBF0014   LW RA, 20(SP)
9D02A028  0B40A926   J 0x9D02A498
9D02A02C  8FBF0014   LW RA, 20(SP)
9D02A050  0B40A926   J 0x9D02A498
9D02A054  8FBF0014   LW RA, 20(SP)
9D02A06C  0B40A926   J 0x9D02A498
9D02A070  8FBF0014   LW RA, 20(SP)
9D02A0AC  0B40A926   J 0x9D02A498
9D02A0B0  8FBF0014   LW RA, 20(SP)
9D02A0D4  0B40A926   J 0x9D02A498
9D02A0D8  8FBF0014   LW RA, 20(SP)
9D02A0EC  0B40A926   J 0x9D02A498
9D02A0F0  8FBF0014   LW RA, 20(SP)
9D02A144  0B40A926   J 0x9D02A498
9D02A148  8FBF0014   LW RA, 20(SP)
9D02A494  8FBF0014   LW RA, 20(SP)
9D02A498  03E00008   JR RA
9D02A49C  27BD0018   ADDIU SP, SP, 24
303:                 
304:                 static void vrc_hblank(int vblank) 
305:                 {
9D02A4C4  27BDFFE8   ADDIU SP, SP, -24
9D02A4C8  AFBF0014   SW RA, 20(SP)
9D02A4CC  AFB00010   SW S0, 16(SP)
306:                    UNUSED(vblank);
307:                 
308:                    if (irq.enabled)
9D02A4A0  3C02A001   LUI V0, -24575
9D02A4A4  8C435900   LW V1, 22784(V0)
9D02A4A8  10600013   BEQ V1, ZERO, 0x9D02A4F8
9D02A4AC  3C04A001   LUI A0, -24575
309:                    {
310:                       if (256 == ++irq.counter)
9D02A4B0  8C8558FC   LW A1, 22780(A0)
9D02A4B4  24A60001   ADDIU A2, A1, 1
9D02A4B8  24070100   ADDIU A3, ZERO, 256
9D02A4BC  14C7000E   BNE A2, A3, 0x9D02A4F8
9D02A4C0  AC8658FC   SW A2, 22780(A0)
311:                       {
312:                          irq.counter = irq.latch;
9D02A4D0  3C08A001   LUI T0, -24575
9D02A4D4  251058FC   ADDIU S0, T0, 22780
9D02A4D8  8E090008   LW T1, 8(S0)
313:                          nes_irq();
9D02A4DC  0F40975F   JAL nes_irq
9D02A4E0  AD0958FC   SW T1, 22780(T0)
314:                          //irq.enabled = false;
315:                          irq.enabled = irq.wait_state;
9D02A4E4  8E0A000C   LW T2, 12(S0)
9D02A4E8  AE0A0004   SW T2, 4(S0)
316:                       }
317:                    }
318:                 }
9D02A4EC  8FBF0014   LW RA, 20(SP)
9D02A4F0  8FB00010   LW S0, 16(SP)
9D02A4F4  27BD0018   ADDIU SP, SP, 24
9D02A4F8  03E00008   JR RA
9D02A4FC  00000000   NOP
319:                 
320:                 
321:                 
322:                 static map_memwrite map21_memwrite[] =
323:                 {
324:                    { 0x8000, 0xFFFF, map21_write },
325:                    {     -1,     -1, NULL }
326:                 };
327:                 
328:                 static map_memwrite map22_memwrite[] =
329:                 {
330:                    { 0x8000, 0xFFFF, map22_write },
331:                    {     -1,     -1, NULL }
332:                 };
333:                 
334:                 static map_memwrite map23_memwrite[] =
335:                 {
336:                    { 0x8000, 0xFFFF, map23_write },
337:                    {     -1,     -1, NULL }
338:                 };
339:                 
340:                 static void map21_getstate(SnssMapperBlock *state)
341:                 {
342:                    state->extraData.mapper21.irqCounter = irq.counter;
9D02961C  3C02A001   LUI V0, -24575
9D029620  8C4358FC   LW V1, 22780(V0)
9D029624  A0830018   SB V1, 24(A0)
343:                    state->extraData.mapper21.irqCounterEnabled = irq.enabled;
9D029628  244558FC   ADDIU A1, V0, 22780
9D02962C  8CA60004   LW A2, 4(A1)
9D029630  03E00008   JR RA
9D029634  A0860019   SB A2, 25(A0)
344:                 }
345:                 
346:                 static void map21_setstate(SnssMapperBlock *state)
347:                 {
348:                    irq.counter = state->extraData.mapper21.irqCounter;
9D029638  3C02A001   LUI V0, -24575
9D02963C  90830018   LBU V1, 24(A0)
9D029640  AC4358FC   SW V1, 22780(V0)
349:                    irq.enabled = state->extraData.mapper21.irqCounterEnabled;
9D029644  244558FC   ADDIU A1, V0, 22780
9D029648  90840019   LBU A0, 25(A0)
9D02964C  03E00008   JR RA
9D029650  ACA40004   SW A0, 4(A1)
350:                 }
351:                 
352:                 mapintf_t map21_intf =
353:                 {
354:                    21, /* mapper number */
355:                    "Konami VRC4 A", /* mapper name */
356:                    vrc_init, /* init routine */
357:                    NULL, /* vblank callback */
358:                    vrc_hblank, /* hblank callback */
359:                    map21_getstate, /* get state (snss) */
360:                    map21_setstate, /* set state (snss) */
361:                    NULL, /* memory read structure */
362:                    map21_memwrite, /* memory write structure */
363:                    NULL /* external sound device */
364:                 };
365:                 
366:                 mapintf_t map22_intf =
367:                 {
368:                    22, /* mapper number */
369:                    "Konami VRC2 A", /* mapper name */
370:                    vrc_init, /* init routine */
371:                    NULL, /* vblank callback */
372:                    NULL, /* hblank callback */
373:                    NULL, /* get state (snss) */
374:                    NULL, /* set state (snss) */
375:                    NULL, /* memory read structure */
376:                    map22_memwrite, /* memory write structure */
377:                    NULL /* external sound device */
378:                 };
379:                 
380:                 mapintf_t map23_intf =
381:                 {
382:                    23, /* mapper number */
383:                    "Konami VRC2 B", /* mapper name */
384:                    vrc_init, /* init routine */
385:                    NULL, /* vblank callback */
386:                    vrc_hblank, /* hblank callback */
387:                    NULL, /* get state (snss) */
388:                    NULL, /* set state (snss) */
389:                    NULL, /* memory read structure */
390:                    map23_memwrite, /* memory write structure */
391:                    NULL /* external sound device */
392:                 };
393:                 
394:                 mapintf_t map25_intf =
395:                 {
396:                    25, /* mapper number */
397:                    "Konami VRC4 B", /* mapper name */
398:                    NULL, /* init routine */
399:                    NULL, /* vblank callback */
400:                    vrc_hblank, /* hblank callback */
401:                    NULL, /* get state (snss) */
402:                    NULL, /* set state (snss) */
403:                    NULL, /* memory read structure */
404:                    map21_memwrite, /* memory write structure */
405:                    NULL /* external sound device */
406:                 };
407:                 
408:                 /*
409:                 ** $Log: mapvrc.c,v $
410:                 ** Revision 1.2  2001/04/27 14:37:11  neil
411:                 ** wheeee
412:                 **
413:                 ** Revision 1.1  2001/04/27 12:54:40  neil
414:                 ** blah
415:                 **
416:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
417:                 ** initial
418:                 **
419:                 ** Revision 1.1  2000/10/24 12:19:33  matt
420:                 ** changed directory structure
421:                 **
422:                 ** Revision 1.10  2000/10/22 19:17:46  matt
423:                 ** mapper cleanups galore
424:                 **
425:                 ** Revision 1.9  2000/10/22 15:03:14  matt
426:                 ** simplified mirroring
427:                 **
428:                 ** Revision 1.8  2000/10/21 19:33:38  matt
429:                 ** many more cleanups
430:                 **
431:                 ** Revision 1.7  2000/10/10 13:58:17  matt
432:                 ** stroustrup squeezing his way in the door
433:                 **
434:                 ** Revision 1.6  2000/08/16 02:50:11  matt
435:                 ** random mapper cleanups
436:                 **
437:                 ** Revision 1.5  2000/07/15 23:52:20  matt
438:                 ** rounded out a bunch more mapper interfaces
439:                 **
440:                 ** Revision 1.4  2000/07/10 13:51:25  matt
441:                 ** using generic nes_irq() routine now
442:                 **
443:                 ** Revision 1.3  2000/07/10 05:29:03  matt
444:                 ** cleaned up some mirroring issues
445:                 **
446:                 ** Revision 1.2  2000/07/06 02:48:43  matt
447:                 ** clearly labelled structure members
448:                 **
449:                 ** Revision 1.1  2000/07/06 01:01:56  matt
450:                 ** initial revision
451:                 **
452:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map231.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map231.c
21:                  **
22:                  ** mapper 231 interface
23:                  ** $Id: map231.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  
29:                  /* mapper 231: NINA-07, used in Wally Bear and the NO! Gang */
30:                  
31:                  static void map231_init(void)
32:                  {
9D0412A0  27BDFFE8   ADDIU SP, SP, -24
9D0412A4  AFBF0014   SW RA, 20(SP)
33:                     mmc_bankrom(32, 0x8000, MMC_LASTBANK);
9D0412A8  24040020   ADDIU A0, ZERO, 32
9D0412AC  34058000   ORI A1, ZERO, -32768
9D0412B0  0F40CA71   JAL mmc_bankrom
9D0412B4  2406FFFF   ADDIU A2, ZERO, -1
34:                  }
9D0412B8  8FBF0014   LW RA, 20(SP)
9D0412BC  03E00008   JR RA
9D0412C0  27BD0018   ADDIU SP, SP, 24
35:                  
36:                  static void map231_write(uint32 address, uint8 value)
37:                  {
9D0412C4  27BDFFE8   ADDIU SP, SP, -24
9D0412C8  AFBF0014   SW RA, 20(SP)
9D0412CC  AFB00010   SW S0, 16(SP)
9D0412D0  00A08021   ADDU S0, A1, ZERO
38:                     int bank, vbank;
39:                     UNUSED(address);
40:                  
41:                     bank = ((value & 0x80) >> 5) | (value & 0x03);
9D0412D4  30A60080   ANDI A2, A1, 128
9D0412D8  00061943   SRA V1, A2, 5
9D0412DC  30A20003   ANDI V0, A1, 3
42:                     vbank = (value >> 4) & 0x07;
43:                  
44:                     mmc_bankrom(32, 0x8000, bank);
9D0412E0  24040020   ADDIU A0, ZERO, 32
9D0412E4  34058000   ORI A1, ZERO, -32768
9D0412E8  0F40CA71   JAL mmc_bankrom
9D0412EC  00623025   OR A2, V1, V0
45:                     mmc_bankvrom(8, 0x0000, vbank);
9D0412F0  24040008   ADDIU A0, ZERO, 8
9D0412F4  00002821   ADDU A1, ZERO, ZERO
9D0412F8  0F40CA16   JAL mmc_bankvrom
9D0412FC  7E061100   EXT A2, S0, 4, 3
46:                  }
9D041300  8FBF0014   LW RA, 20(SP)
9D041304  8FB00010   LW S0, 16(SP)
9D041308  03E00008   JR RA
9D04130C  27BD0018   ADDIU SP, SP, 24
47:                  
48:                  static map_memwrite map231_memwrite[] =
49:                  {
50:                     { 0x8000, 0xFFFF, map231_write },
51:                     {     -1,     -1, NULL }
52:                  };
53:                  
54:                  mapintf_t map231_intf = 
55:                  {
56:                     231, /* mapper number */
57:                     "NINA-07", /* mapper name */
58:                     map231_init, /* init routine */
59:                     NULL, /* vblank callback */
60:                     NULL, /* hblank callback */
61:                     NULL, /* get state (snss) */
62:                     NULL, /* set state (snss) */
63:                     NULL, /* memory read structure */
64:                     map231_memwrite, /* memory write structure */
65:                     NULL /* external sound device */
66:                  };
67:                  
68:                  /*
69:                  ** $Log: map231.c,v $
70:                  ** Revision 1.2  2001/04/27 14:37:11  neil
71:                  ** wheeee
72:                  **
73:                  ** Revision 1.1  2001/04/27 12:54:40  neil
74:                  ** blah
75:                  **
76:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
77:                  ** initial
78:                  **
79:                  ** Revision 1.1  2000/10/24 12:19:33  matt
80:                  ** changed directory structure
81:                  **
82:                  ** Revision 1.4  2000/10/22 19:17:46  matt
83:                  ** mapper cleanups galore
84:                  **
85:                  ** Revision 1.3  2000/10/21 19:33:38  matt
86:                  ** many more cleanups
87:                  **
88:                  ** Revision 1.2  2000/08/16 02:50:11  matt
89:                  ** random mapper cleanups
90:                  **
91:                  ** Revision 1.1  2000/07/11 03:14:18  melanson
92:                  ** Initial commit for mappers 16, 34, and 231
93:                  **
94:                  **
95:                  */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map229.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map229.c
21:                  **
22:                  ** Mapper #229 (31 in 1)
23:                  ** Implementation by Firebug
24:                  ** Mapper information courtesy of Mark Knibbs
25:                  ** $Id: map229.c,v 1.2 2001/04/27 14:37:11 neil Exp $
26:                  **
27:                  */
28:                  
29:                  #include <noftypes.h>
30:                  #include <nes_mmc.h>
31:                  #include <nes.h>
32:                  #include <libsnss.h>
33:                  #include <log.h>
34:                  
35:                  /************************/
36:                  /* Mapper #229: 31 in 1 */
37:                  /************************/
38:                  static void map229_init (void)
39:                  {
9D03F10C  27BDFFE8   ADDIU SP, SP, -24
9D03F110  AFBF0014   SW RA, 20(SP)
40:                    /* On reset, PRG is set to first 32K and CHR to first 8K */
41:                    mmc_bankrom (32, 0x8000, 0x00);
9D03F114  24040020   ADDIU A0, ZERO, 32
9D03F118  34058000   ORI A1, ZERO, -32768
9D03F11C  0F40CA71   JAL mmc_bankrom
9D03F120  00003021   ADDU A2, ZERO, ZERO
42:                    mmc_bankvrom (8, 0x0000, 0x00);
9D03F124  24040008   ADDIU A0, ZERO, 8
9D03F128  00002821   ADDU A1, ZERO, ZERO
9D03F12C  0F40CA16   JAL mmc_bankvrom
9D03F130  00003021   ADDU A2, ZERO, ZERO
43:                  
44:                    /* Done */
45:                    return;
46:                  }
9D03F134  8FBF0014   LW RA, 20(SP)
9D03F138  03E00008   JR RA
9D03F13C  27BD0018   ADDIU SP, SP, 24
47:                  
48:                  /*******************************************/
49:                  /* Mapper #229 write handler ($8000-$FFFF) */
50:                  /*******************************************/
51:                  static void map229_write (uint32 address, uint8 value)
52:                  {
9D03F140  27BDFFE0   ADDIU SP, SP, -32
9D03F144  AFBF001C   SW RA, 28(SP)
9D03F148  AFB10018   SW S1, 24(SP)
9D03F14C  AFB00014   SW S0, 20(SP)
9D03F150  00808021   ADDU S0, A0, ZERO
53:                    /* Value written is irrelevant */
54:                    UNUSED (value);
55:                  
56:                    /* A4-A0 sets 8K CHR page */
57:                    mmc_bankvrom (8, 0x0000, (uint8) (address & 0x1F));
9D03F154  3091001F   ANDI S1, A0, 31
9D03F158  24040008   ADDIU A0, ZERO, 8
9D03F15C  00002821   ADDU A1, ZERO, ZERO
9D03F160  0F40CA16   JAL mmc_bankvrom
9D03F164  02203021   ADDU A2, S1, ZERO
58:                  
59:                    /* If A4-A1 are all low then select the first 32K,     */
60:                    /* otherwise select a 16K bank at both $8000 and $C000 */
61:                    if ((address & 0x1E) == 0x00)
9D03F168  3202001E   ANDI V0, S0, 30
9D03F16C  14400007   BNE V0, ZERO, 0x9D03F18C
9D03F170  24040010   ADDIU A0, ZERO, 16
62:                    {
63:                      mmc_bankrom (32, 0x8000, 0x00);
9D03F174  24040020   ADDIU A0, ZERO, 32
9D03F178  34058000   ORI A1, ZERO, -32768
9D03F17C  0F40CA71   JAL mmc_bankrom
9D03F180  00003021   ADDU A2, ZERO, ZERO
9D03F184  0B40FC6B   J 0x9D03F1AC
9D03F188  32030020   ANDI V1, S0, 32
64:                    }
65:                    else
66:                    {
67:                      mmc_bankrom (16, 0x8000, (uint8) (address & 0x1F));
9D03F18C  34058000   ORI A1, ZERO, -32768
9D03F190  0F40CA71   JAL mmc_bankrom
9D03F194  02203021   ADDU A2, S1, ZERO
68:                      mmc_bankrom (16, 0xC000, (uint8) (address & 0x1F));
9D03F198  24040010   ADDIU A0, ZERO, 16
9D03F19C  3405C000   ORI A1, ZERO, -16384
9D03F1A0  0F40CA71   JAL mmc_bankrom
9D03F1A4  02203021   ADDU A2, S1, ZERO
69:                    }
70:                  
71:                    /* A5: mirroring (low = vertical, high = horizontal) */
72:                    if (address & 0x20) ppu_mirror(0, 0, 1, 1);
9D03F1A8  32030020   ANDI V1, S0, 32
9D03F1AC  10600007   BEQ V1, ZERO, 0x9D03F1CC
9D03F1B0  00002021   ADDU A0, ZERO, ZERO
9D03F1B4  00002821   ADDU A1, ZERO, ZERO
9D03F1B8  24060001   ADDIU A2, ZERO, 1
9D03F1BC  0F4058FD   JAL ppu_mirror
9D03F1C0  24070001   ADDIU A3, ZERO, 1
9D03F1C4  0B40FC78   J 0x9D03F1E0
9D03F1C8  8FBF001C   LW RA, 28(SP)
73:                    else                ppu_mirror(0, 1, 0, 1);
9D03F1CC  24050001   ADDIU A1, ZERO, 1
9D03F1D0  00003021   ADDU A2, ZERO, ZERO
9D03F1D4  0F4058FD   JAL ppu_mirror
9D03F1D8  24070001   ADDIU A3, ZERO, 1
74:                  
75:                    /* Done */
76:                    return;
77:                  }
9D03F1DC  8FBF001C   LW RA, 28(SP)
9D03F1E0  8FB10018   LW S1, 24(SP)
9D03F1E4  8FB00014   LW S0, 20(SP)
9D03F1E8  03E00008   JR RA
9D03F1EC  27BD0020   ADDIU SP, SP, 32
78:                  
79:                  static map_memwrite map229_memwrite [] =
80:                  {
81:                     { 0x8000, 0xFFFF, map229_write },
82:                     {     -1,     -1, NULL }
83:                  };
84:                  
85:                  mapintf_t map229_intf =
86:                  {
87:                     229,                              /* Mapper number */
88:                     "31 in 1 (bootleg)",              /* Mapper name */
89:                     map229_init,                      /* Initialization routine */
90:                     NULL,                             /* VBlank callback */
91:                     NULL,                             /* HBlank callback */
92:                     NULL,                             /* Get state (SNSS) */
93:                     NULL,                             /* Set state (SNSS) */
94:                     NULL,                             /* Memory read structure */
95:                     map229_memwrite,                  /* Memory write structure */
96:                     NULL                              /* External sound device */
97:                  };
98:                  
99:                  /*
100:                 ** $Log: map229.c,v $
101:                 ** Revision 1.2  2001/04/27 14:37:11  neil
102:                 ** wheeee
103:                 **
104:                 ** Revision 1.1  2001/04/27 12:54:40  neil
105:                 ** blah
106:                 **
107:                 ** Revision 1.1  2001/04/27 10:57:41  neil
108:                 ** wheee
109:                 **
110:                 ** Revision 1.1  2000/12/30 06:34:31  firebug
111:                 ** Initial revision
112:                 **
113:                 **
114:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map160.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map160.c
21:                  **
22:                  ** mapper 160 interface
23:                  ** $Id: map160.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes_ppu.h>
29:                  #include <nes.h>
30:                  
31:                  static struct
32:                  {
33:                     bool enabled, expired;
34:                     int counter;
35:                     int latch_c005, latch_c003;
36:                  } irq;
37:                  
38:                  static void map160_write(uint32 address, uint8 value)
39:                  {
9D03C7F8  27BDFFE8   ADDIU SP, SP, -24
9D03C7FC  AFBF0014   SW RA, 20(SP)
40:                     if (address >= 0x8000 && address <= 0x8003)
9D03C800  24828000   ADDIU V0, A0, -32768
9D03C804  2C430004   SLTIU V1, V0, 4
9D03C808  10600008   BEQ V1, ZERO, 0x9D03C82C
9D03C80C  00A03021   ADDU A2, A1, ZERO
41:                     {
42:                        mmc_bankrom(8, 0x8000 + 0x2000 * (address & 3), value);
9D03C810  30890003   ANDI T1, A0, 3
9D03C814  252A0004   ADDIU T2, T1, 4
9D03C818  24040008   ADDIU A0, ZERO, 8
9D03C81C  0F40CA71   JAL mmc_bankrom
9D03C820  000A2B40   SLL A1, T2, 13
9D03C824  0B40F236   J 0x9D03C8D8
9D03C828  8FBF0014   LW RA, 20(SP)
43:                     }
44:                     else if (address >= 0x9000 && address <= 0x9007)
9D03C82C  3C05FFFF   LUI A1, -1
9D03C830  24A77000   ADDIU A3, A1, 28672
9D03C834  00874021   ADDU T0, A0, A3
9D03C838  2D090008   SLTIU T1, T0, 8
9D03C83C  11200007   BEQ T1, ZERO, 0x9D03C85C
9D03C840  340AC002   ORI T2, ZERO, -16382
45:                     {
46:                        mmc_bankvrom(1, 0x400 * (address & 7), value);
9D03C844  30880007   ANDI T0, A0, 7
9D03C848  24040001   ADDIU A0, ZERO, 1
9D03C84C  0F40CA16   JAL mmc_bankvrom
9D03C850  00082A80   SLL A1, T0, 10
9D03C854  0B40F236   J 0x9D03C8D8
9D03C858  8FBF0014   LW RA, 20(SP)
47:                     }
48:                     else if (0xC002 == address)
9D03C85C  148A0007   BNE A0, T2, 0x9D03C87C
9D03C860  340BC003   ORI T3, ZERO, -16381
49:                     {
50:                        irq.enabled = false;
9D03C864  3C03A001   LUI V1, -24575
9D03C868  AC6058A8   SW ZERO, 22696(V1)
51:                        irq.latch_c005 = irq.latch_c003;
9D03C86C  246558A8   ADDIU A1, V1, 22696
9D03C870  8CA70010   LW A3, 16(A1)
9D03C874  0B40F235   J 0x9D03C8D4
9D03C878  ACA7000C   SW A3, 12(A1)
52:                     }
53:                     else if (0xC003 == address)
9D03C87C  148B000F   BNE A0, T3, 0x9D03C8BC
9D03C880  340CC005   ORI T4, ZERO, -16379
54:                     {
55:                        if (false == irq.expired)
9D03C884  3C0EA001   LUI T6, -24575
9D03C888  8DCF58AC   LW T7, 22700(T6)
9D03C88C  55E00004   BNEL T7, ZERO, 0x9D03C8A0
9D03C890  3C06A001   LUI A2, -24575
56:                        {
57:                           irq.counter = value;
9D03C894  3C02A001   LUI V0, -24575
9D03C898  0B40F235   J 0x9D03C8D4
9D03C89C  AC4658B0   SW A2, 22704(V0)
58:                        }
59:                        else
60:                        {
61:                           irq.expired = false;
9D03C8A0  24D858A8   ADDIU T8, A2, 22696
9D03C8A4  AF000004   SW ZERO, 4(T8)
62:                           irq.enabled = true;
9D03C8A8  24190001   ADDIU T9, ZERO, 1
9D03C8AC  ACD958A8   SW T9, 22696(A2)
63:                           irq.counter = irq.latch_c005;
9D03C8B0  8F1F000C   LW RA, 12(T8)
9D03C8B4  0B40F235   J 0x9D03C8D4
9D03C8B8  AF1F0008   SW RA, 8(T8)
64:                        }
65:                     }
66:                     else if (0xC005 == address)
9D03C8BC  148C0006   BNE A0, T4, 0x9D03C8D8
9D03C8C0  8FBF0014   LW RA, 20(SP)
67:                     {
68:                        irq.latch_c005 = value;
9D03C8C4  3C04A001   LUI A0, -24575
9D03C8C8  248D58A8   ADDIU T5, A0, 22696
9D03C8CC  ADA6000C   SW A2, 12(T5)
69:                        irq.counter = value;
9D03C8D0  ADA60008   SW A2, 8(T5)
70:                     }
71:                  #ifdef NOFRENDO_DEBUG
72:                     else
73:                     {
74:                        log_printf("mapper 160: untrapped write $%02X to $%04X\n", value, address);
75:                     }
76:                  #endif /* NOFRENDO_DEBUG */
77:                  }
9D03C8D4  8FBF0014   LW RA, 20(SP)
9D03C8D8  03E00008   JR RA
9D03C8DC  27BD0018   ADDIU SP, SP, 24
78:                  
79:                  static void map160_hblank(int vblank)
80:                  {
9D03C8E8  27BDFFE8   ADDIU SP, SP, -24
9D03C8EC  AFBF0014   SW RA, 20(SP)
81:                     if (!vblank)
9D03C8E0  1480001B   BNE A0, ZERO, 0x9D03C950
9D03C8E4  00000000   NOP
82:                     {
83:                        if (ppu_enabled() && irq.enabled)
9D03C8F0  0F405C83   JAL ppu_enabled
9D03C8F4  00000000   NOP
9D03C8F8  10400013   BEQ V0, ZERO, 0x9D03C948
9D03C8FC  3C02A001   LUI V0, -24575
9D03C900  8C4358A8   LW V1, 22696(V0)
9D03C904  10600010   BEQ V1, ZERO, 0x9D03C948
9D03C908  3C04A001   LUI A0, -24575
84:                        {
85:                           if (0 == irq.counter && false == irq.expired)
9D03C90C  8C8558B0   LW A1, 22704(A0)
9D03C910  14A0000B   BNE A1, ZERO, 0x9D03C940
9D03C914  24A8FFFF   ADDIU T0, A1, -1
9D03C918  3C06A001   LUI A2, -24575
9D03C91C  8CC758AC   LW A3, 22700(A2)
9D03C920  14E00008   BNE A3, ZERO, 0x9D03C944
9D03C924  3C09A001   LUI T1, -24575
86:                           {
87:                              irq.expired = true;
9D03C928  240A0001   ADDIU T2, ZERO, 1
9D03C92C  3C0BA001   LUI T3, -24575
88:                              nes_irq();
9D03C930  0F40975F   JAL nes_irq
9D03C934  AD6A58AC   SW T2, 22700(T3)
9D03C938  0B40F253   J 0x9D03C94C
9D03C93C  8FBF0014   LW RA, 20(SP)
89:                           }
90:                           else
91:                           {
92:                              irq.counter--;
9D03C940  3C09A001   LUI T1, -24575
9D03C944  AD2858B0   SW T0, 22704(T1)
93:                           }
94:                        }
95:                     }
96:                  }
9D03C948  8FBF0014   LW RA, 20(SP)
9D03C94C  27BD0018   ADDIU SP, SP, 24
9D03C950  03E00008   JR RA
9D03C954  00000000   NOP
97:                  
98:                  static void map160_init(void)
99:                  {
100:                    irq.enabled = false;
9D03C7D8  3C02A001   LUI V0, -24575
9D03C7DC  AC4058A8   SW ZERO, 22696(V0)
101:                    irq.expired = false;
9D03C7E0  244358A8   ADDIU V1, V0, 22696
9D03C7E4  AC600004   SW ZERO, 4(V1)
102:                    irq.counter = 0;
9D03C7E8  AC600008   SW ZERO, 8(V1)
103:                    irq.latch_c003 = irq.latch_c005 = 0;
9D03C7EC  AC60000C   SW ZERO, 12(V1)
9D03C7F0  03E00008   JR RA
9D03C7F4  AC600010   SW ZERO, 16(V1)
104:                 }
105:                 
106:                 static map_memwrite map160_memwrite[] =
107:                 {
108:                    { 0x8000, 0xFFFF, map160_write },
109:                    {     -1,     -1, NULL }
110:                 };
111:                 
112:                 mapintf_t map160_intf =
113:                 {
114:                    160, /* mapper number */
115:                    "Aladdin (pirate)", /* mapper name */
116:                    map160_init, /* init routine */
117:                    NULL, /* vblank callback */
118:                    map160_hblank, /* hblank callback */
119:                    NULL, /* get state (snss) */
120:                    NULL, /* set state (snss) */
121:                    NULL, /* memory read structure */
122:                    map160_memwrite, /* memory write structure */
123:                    NULL /* external sound device */
124:                 };
125:                 
126:                 /*
127:                 ** $Log: map160.c,v $
128:                 ** Revision 1.2  2001/04/27 14:37:11  neil
129:                 ** wheeee
130:                 **
131:                 ** Revision 1.1  2001/04/27 12:54:40  neil
132:                 ** blah
133:                 **
134:                 ** Revision 1.1  2001/04/27 10:57:41  neil
135:                 ** wheee
136:                 **
137:                 ** Revision 1.1  2000/12/27 04:24:46  matt
138:                 ** initial revision
139:                 **
140:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map099.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map99.c
21:                  **
22:                  ** mapper 99 interface
23:                  ** $Id: map099.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes_ppu.h>
29:                  
30:                  /* Switch VROM for VS games */
31:                  static void map99_vromswitch(uint8 value)
32:                  {
9D0419EC  27BDFFE8   ADDIU SP, SP, -24
9D0419F0  AFBF0014   SW RA, 20(SP)
33:                     int bank = (value & 0x04) >> 2;
9D0419F4  7C860080   EXT A2, A0, 2, 1
34:                     mmc_bankvrom(8, 0x0000, bank);
9D0419F8  24040008   ADDIU A0, ZERO, 8
9D0419FC  0F40CA16   JAL mmc_bankvrom
9D041A00  00002821   ADDU A1, ZERO, ZERO
35:                  }
9D041A04  8FBF0014   LW RA, 20(SP)
9D041A08  03E00008   JR RA
9D041A0C  27BD0018   ADDIU SP, SP, 24
36:                  
37:                  /* mapper 99: VS. System */
38:                  static void map99_init(void)
39:                  {
9D0419B8  27BDFFE8   ADDIU SP, SP, -24
9D0419BC  AFBF0014   SW RA, 20(SP)
40:                     ppu_mirror(0, 1, 2, 3);
9D0419C0  00002021   ADDU A0, ZERO, ZERO
9D0419C4  24050001   ADDIU A1, ZERO, 1
9D0419C8  24060002   ADDIU A2, ZERO, 2
9D0419CC  0F4058FD   JAL ppu_mirror
9D0419D0  24070003   ADDIU A3, ZERO, 3
41:                     ppu_setvromswitch(map99_vromswitch);
9D0419D4  3C049D04   LUI A0, -25340
9D0419D8  0F405C80   JAL ppu_setvromswitch
9D0419DC  248419EC   ADDIU A0, A0, 6636
42:                  }
9D0419E0  8FBF0014   LW RA, 20(SP)
9D0419E4  03E00008   JR RA
9D0419E8  27BD0018   ADDIU SP, SP, 24
43:                  
44:                  mapintf_t map99_intf =
45:                  {
46:                     99, /* mapper number */
47:                     "VS. System", /* mapper name */
48:                     map99_init, /* init routine */
49:                     NULL, /* vblank callback */
50:                     NULL, /* hblank callback */
51:                     NULL, /* get state (snss) */
52:                     NULL, /* set state (snss) */
53:                     NULL, /* memory read structure */
54:                     NULL, /* memory write structure */
55:                     NULL /* external sound device */
56:                  };
57:                  
58:                  /*
59:                  ** $Log: map099.c,v $
60:                  ** Revision 1.2  2001/04/27 14:37:11  neil
61:                  ** wheeee
62:                  **
63:                  ** Revision 1.1  2001/04/27 12:54:40  neil
64:                  ** blah
65:                  **
66:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
67:                  ** initial
68:                  **
69:                  ** Revision 1.1  2000/10/24 12:19:33  matt
70:                  ** changed directory structure
71:                  **
72:                  ** Revision 1.6  2000/10/22 19:17:47  matt
73:                  ** mapper cleanups galore
74:                  **
75:                  ** Revision 1.5  2000/10/21 19:33:38  matt
76:                  ** many more cleanups
77:                  **
78:                  ** Revision 1.4  2000/10/10 13:58:17  matt
79:                  ** stroustrup squeezing his way in the door
80:                  **
81:                  ** Revision 1.3  2000/07/10 05:29:03  matt
82:                  ** cleaned up some mirroring issues
83:                  **
84:                  ** Revision 1.2  2000/07/06 02:48:43  matt
85:                  ** clearly labelled structure members
86:                  **
87:                  ** Revision 1.1  2000/07/05 05:05:18  matt
88:                  ** initial revision
89:                  **
90:                  */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map094.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map94.c
21:                  **
22:                  ** mapper 94 interface
23:                  ** $Id: map094.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  
29:                  /* mapper 94: Senjou no Ookami */
30:                  static void map94_write(uint32 address, uint8 value)
31:                  {
9D042320  27BDFFE8   ADDIU SP, SP, -24
9D042324  AFBF0014   SW RA, 20(SP)
32:                     UNUSED(address);
33:                  
34:                     /* ($8000-$FFFF) D7-D2 = switch $8000-$BFFF */
35:                     mmc_bankrom(16, 0x8000, value >> 2);
9D042328  00053082   SRL A2, A1, 2
9D04232C  24040010   ADDIU A0, ZERO, 16
9D042330  0F40CA71   JAL mmc_bankrom
9D042334  34058000   ORI A1, ZERO, -32768
36:                  }
9D042338  8FBF0014   LW RA, 20(SP)
9D04233C  03E00008   JR RA
9D042340  27BD0018   ADDIU SP, SP, 24
37:                  
38:                  static map_memwrite map94_memwrite[] =
39:                  {
40:                     { 0x8000, 0xFFFF, map94_write },
41:                     {     -1,     -1, NULL }
42:                  };
43:                  
44:                  mapintf_t map94_intf =
45:                  {
46:                     94, /* mapper number */
47:                     "Mapper 94", /* mapper name */
48:                     NULL, /* init routine */
49:                     NULL, /* vblank callback */
50:                     NULL, /* hblank callback */
51:                     NULL, /* get state (snss) */
52:                     NULL, /* set state (snss) */
53:                     NULL, /* memory read structure */
54:                     map94_memwrite, /* memory write structure */
55:                     NULL /* external sound device */
56:                  };
57:                  
58:                  /*
59:                  ** $Log: map094.c,v $
60:                  ** Revision 1.2  2001/04/27 14:37:11  neil
61:                  ** wheeee
62:                  **
63:                  ** Revision 1.1  2001/04/27 12:54:40  neil
64:                  ** blah
65:                  **
66:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
67:                  ** initial
68:                  **
69:                  ** Revision 1.1  2000/10/24 12:19:33  matt
70:                  ** changed directory structure
71:                  **
72:                  ** Revision 1.5  2000/10/22 19:17:47  matt
73:                  ** mapper cleanups galore
74:                  **
75:                  ** Revision 1.4  2000/10/21 19:33:38  matt
76:                  ** many more cleanups
77:                  **
78:                  ** Revision 1.3  2000/08/16 02:50:11  matt
79:                  ** random mapper cleanups
80:                  **
81:                  ** Revision 1.2  2000/07/06 02:48:43  matt
82:                  ** clearly labelled structure members
83:                  **
84:                  ** Revision 1.1  2000/07/06 01:01:56  matt
85:                  ** initial revision
86:                  **
87:                  */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map093.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map93.c
21:                  **
22:                  ** mapper 93 interface
23:                  ** $Id: map093.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes_ppu.h>
29:                  
30:                  static void map93_write(uint32 address, uint8 value)
31:                  {
9D041660  27BDFFE8   ADDIU SP, SP, -24
9D041664  AFBF0014   SW RA, 20(SP)
9D041668  AFB00010   SW S0, 16(SP)
9D04166C  00A08021   ADDU S0, A1, ZERO
32:                     UNUSED(address);
33:                  
34:                     /* ($8000-$FFFF) D7-D4 = switch $8000-$BFFF D0: mirror */
35:                     mmc_bankrom(16, 0x8000, value >> 4);
9D041670  24040010   ADDIU A0, ZERO, 16
9D041674  34058000   ORI A1, ZERO, -32768
9D041678  0F40CA71   JAL mmc_bankrom
9D04167C  00103102   SRL A2, S0, 4
36:                  
37:                     if (value & 1)
9D041680  32020001   ANDI V0, S0, 1
9D041684  10400007   BEQ V0, ZERO, 0x9D0416A4
9D041688  00002021   ADDU A0, ZERO, ZERO
38:                        ppu_mirror(0, 1, 0, 1); /* vert */
9D04168C  24050001   ADDIU A1, ZERO, 1
9D041690  00003021   ADDU A2, ZERO, ZERO
9D041694  0F4058FD   JAL ppu_mirror
9D041698  24070001   ADDIU A3, ZERO, 1
9D04169C  0B4105AE   J 0x9D0416B8
9D0416A0  8FBF0014   LW RA, 20(SP)
39:                     else
40:                        ppu_mirror(0, 0, 1, 1); /* horiz */
9D0416A4  00002821   ADDU A1, ZERO, ZERO
9D0416A8  24060001   ADDIU A2, ZERO, 1
9D0416AC  0F4058FD   JAL ppu_mirror
9D0416B0  24070001   ADDIU A3, ZERO, 1
41:                  }
9D0416B4  8FBF0014   LW RA, 20(SP)
9D0416B8  8FB00010   LW S0, 16(SP)
9D0416BC  03E00008   JR RA
9D0416C0  27BD0018   ADDIU SP, SP, 24
42:                  
43:                  static map_memwrite map93_memwrite[] =
44:                  {
45:                     { 0x8000, 0xFFFF, map93_write },
46:                     {     -1,     -1, NULL }
47:                  };
48:                  
49:                  mapintf_t map93_intf =
50:                  {
51:                     93, /* mapper number */
52:                     "Mapper 93", /* mapper name */
53:                     NULL, /* init routine */
54:                     NULL, /* vblank callback */
55:                     NULL, /* hblank callback */
56:                     NULL, /* get state (snss) */
57:                     NULL, /* set state (snss) */
58:                     NULL, /* memory read structure */
59:                     map93_memwrite, /* memory write structure */
60:                     NULL /* external sound device */
61:                  };
62:                  
63:                  /*
64:                  ** $Log: map093.c,v $
65:                  ** Revision 1.2  2001/04/27 14:37:11  neil
66:                  ** wheeee
67:                  **
68:                  ** Revision 1.1  2001/04/27 12:54:40  neil
69:                  ** blah
70:                  **
71:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
72:                  ** initial
73:                  **
74:                  ** Revision 1.1  2000/12/11 12:33:48  matt
75:                  ** initial revision
76:                  **
77:                  */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map087.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map087.c
21:                  **
22:                  ** Mapper #87 (16K VROM switch)
23:                  ** Implementation by Firebug
24:                  ** $Id: map087.c,v 1.2 2001/04/27 14:37:11 neil Exp $
25:                  **
26:                  */
27:                  
28:                  #include <noftypes.h>
29:                  #include <nes_mmc.h>
30:                  #include <nes.h>
31:                  #include <libsnss.h>
32:                  #include <log.h>
33:                  
34:                  /******************************************/
35:                  /* Mapper #87 write handler ($6000-$7FFF) */
36:                  /******************************************/
37:                  static void map87_write (uint32 address, uint8 value)
38:                  {
9D041C48  27BDFFE8   ADDIU SP, SP, -24
39:                    /* Within range, address written to is irrelevant */
40:                    UNUSED (address);
41:                  
42:                    /* Very simple: 8K CHR page is selected by D1 */
43:                    if (value & 0x02) mmc_bankvrom (8, 0x0000, 0x01);
9D041C4C  30A50002   ANDI A1, A1, 2
9D041C50  30A200FF   ANDI V0, A1, 255
9D041C54  10400007   BEQ V0, ZERO, 0x9D041C74
9D041C58  AFBF0014   SW RA, 20(SP)
9D041C5C  24040008   ADDIU A0, ZERO, 8
9D041C60  00002821   ADDU A1, ZERO, ZERO
9D041C64  0F40CA16   JAL mmc_bankvrom
9D041C68  24060001   ADDIU A2, ZERO, 1
9D041C6C  0B410722   J 0x9D041C88
9D041C70  8FBF0014   LW RA, 20(SP)
44:                    else              mmc_bankvrom (8, 0x0000, 0x00);
9D041C74  24040008   ADDIU A0, ZERO, 8
9D041C78  00002821   ADDU A1, ZERO, ZERO
9D041C7C  0F40CA16   JAL mmc_bankvrom
9D041C80  00003021   ADDU A2, ZERO, ZERO
45:                  
46:                    /* Done */
47:                    return;
48:                  }
9D041C84  8FBF0014   LW RA, 20(SP)
9D041C88  03E00008   JR RA
9D041C8C  27BD0018   ADDIU SP, SP, 24
49:                  
50:                  static map_memwrite map87_memwrite [] =
51:                  {
52:                     { 0x6000, 0x7FFF, map87_write },
53:                     {     -1,     -1, NULL }
54:                  };
55:                  
56:                  mapintf_t map87_intf =
57:                  {
58:                     87,                               /* Mapper number */
59:                     "16K VROM switch",                /* Mapper name */
60:                     NULL,                             /* Initialization routine */
61:                     NULL,                             /* VBlank callback */
62:                     NULL,                             /* HBlank callback */
63:                     NULL,                             /* Get state (SNSS) */
64:                     NULL,                             /* Set state (SNSS) */
65:                     NULL,                             /* Memory read structure */
66:                     map87_memwrite,                   /* Memory write structure */
67:                     NULL                              /* External sound device */
68:                  };
69:                  
70:                  /*
71:                  ** $Log: map087.c,v $
72:                  ** Revision 1.2  2001/04/27 14:37:11  neil
73:                  ** wheeee
74:                  **
75:                  ** Revision 1.1  2001/04/27 12:54:40  neil
76:                  ** blah
77:                  **
78:                  ** Revision 1.1  2001/04/27 10:57:41  neil
79:                  ** wheee
80:                  **
81:                  ** Revision 1.1  2000/12/30 06:34:44  firebug
82:                  ** Initial revision
83:                  **
84:                  **
85:                  */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map085.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map85.c
21:                  **
22:                  ** mapper 85 interface
23:                  ** $Id: map085.c,v 1.3 2001/05/06 01:42:03 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes.h>
29:                  #include <log.h>
30:                  
31:                  static struct
32:                  {
33:                     int counter, latch;
34:                     int wait_state;
35:                     bool enabled;
36:                  } irq;
37:                  
38:                  /* mapper 85: Konami VRC7 */
39:                  static void map85_write(uint32 address, uint8 value)
40:                  {
9D03922C  27BDFFE8   ADDIU SP, SP, -24
9D039230  AFBF0014   SW RA, 20(SP)
41:                     uint8 bank = address >> 12;
42:                     uint8 reg = (address & 0x10) | ((address & 0x08) << 1);
9D039234  308200FF   ANDI V0, A0, 255
9D039238  30430008   ANDI V1, V0, 8
9D03923C  00033040   SLL A2, V1, 1
9D039240  30470010   ANDI A3, V0, 16
9D039244  7C843B00   EXT A0, A0, 12, 8
43:                  
44:                     switch (bank)
9D039248  2489FFF8   ADDIU T1, A0, -8
9D03924C  2D2A0008   SLTIU T2, T1, 8
9D039250  11400081   BEQ T2, ZERO, 0x9D039458
9D039254  00C74025   OR T0, A2, A3
9D039258  00A03021   ADDU A2, A1, ZERO
9D03925C  00092880   SLL A1, T1, 2
9D039260  3C0B9D04   LUI T3, -25340
9D039264  256C9278   ADDIU T4, T3, -28040
9D039268  01856821   ADDU T5, T4, A1
9D03926C  8DAE0000   LW T6, 0(T5)
9D039270  01C00008   JR T6
9D039274  00000000   NOP
45:                     {
46:                     case 0x08:
47:                        if (0x10 == reg)
9D039298  11000005   BEQ T0, ZERO, 0x9D0392B0
9D03929C  24040008   ADDIU A0, ZERO, 8
48:                           mmc_bankrom(8, 0xA000, value);
9D0392A0  0F40CA71   JAL mmc_bankrom
9D0392A4  3405A000   ORI A1, ZERO, -24576
9D0392A8  0B40E517   J 0x9D03945C
9D0392AC  8FBF0014   LW RA, 20(SP)
49:                        else
50:                           mmc_bankrom(8, 0x8000, value);
9D0392B0  0F40CA71   JAL mmc_bankrom
9D0392B4  34058000   ORI A1, ZERO, -32768
51:                        break;
52:                  
53:                     case 0x09:
54:                        /* 0x10 & 0x30 should be trapped by sound emulation */
55:                        mmc_bankrom(8, 0xC000, value);
9D0392C0  24040008   ADDIU A0, ZERO, 8
9D0392C4  0F40CA71   JAL mmc_bankrom
9D0392C8  3405C000   ORI A1, ZERO, -16384
56:                        break;
9D0392CC  0B40E517   J 0x9D03945C
9D0392D0  8FBF0014   LW RA, 20(SP)
57:                  
58:                     case 0x0A:
59:                        if (0x10 == reg)
9D0392D4  11000005   BEQ T0, ZERO, 0x9D0392EC
9D0392D8  24040001   ADDIU A0, ZERO, 1
60:                           mmc_bankvrom(1, 0x0400, value);
9D0392DC  0F40CA16   JAL mmc_bankvrom
9D0392E0  24050400   ADDIU A1, ZERO, 1024
9D0392E4  0B40E517   J 0x9D03945C
9D0392E8  8FBF0014   LW RA, 20(SP)
61:                        else
62:                           mmc_bankvrom(1, 0x0000, value);
9D0392EC  0F40CA16   JAL mmc_bankvrom
9D0392F0  00002821   ADDU A1, ZERO, ZERO
63:                        break;
64:                  
65:                     case 0x0B:
66:                        if (0x10 == reg)
9D0392FC  11000005   BEQ T0, ZERO, 0x9D039314
9D039300  24040001   ADDIU A0, ZERO, 1
67:                           mmc_bankvrom(1, 0x0C00, value);
9D039304  0F40CA16   JAL mmc_bankvrom
9D039308  24050C00   ADDIU A1, ZERO, 3072
9D03930C  0B40E517   J 0x9D03945C
9D039310  8FBF0014   LW RA, 20(SP)
68:                        else
69:                           mmc_bankvrom(1, 0x0800, value);
9D039314  0F40CA16   JAL mmc_bankvrom
9D039318  24050800   ADDIU A1, ZERO, 2048
70:                        break;
71:                  
72:                     case 0x0C:
73:                        if (0x10 == reg)
9D039324  11000005   BEQ T0, ZERO, 0x9D03933C
9D039328  24040001   ADDIU A0, ZERO, 1
74:                           mmc_bankvrom(1, 0x1400, value);
9D03932C  0F40CA16   JAL mmc_bankvrom
9D039330  24051400   ADDIU A1, ZERO, 5120
9D039334  0B40E517   J 0x9D03945C
9D039338  8FBF0014   LW RA, 20(SP)
75:                        else
76:                           mmc_bankvrom(1, 0x1000, value);
9D03933C  0F40CA16   JAL mmc_bankvrom
9D039340  24051000   ADDIU A1, ZERO, 4096
77:                        break;
78:                  
79:                     case 0x0D:
80:                        if (0x10 == reg)
9D03934C  11000005   BEQ T0, ZERO, 0x9D039364
9D039350  24040001   ADDIU A0, ZERO, 1
81:                           mmc_bankvrom(1, 0x1C00, value);
9D039354  0F40CA16   JAL mmc_bankvrom
9D039358  24051C00   ADDIU A1, ZERO, 7168
9D03935C  0B40E517   J 0x9D03945C
9D039360  8FBF0014   LW RA, 20(SP)
82:                        else
83:                           mmc_bankvrom(1, 0x1800, value);
9D039364  0F40CA16   JAL mmc_bankvrom
9D039368  24051800   ADDIU A1, ZERO, 6144
84:                        break;
85:                  
86:                     case 0x0E:
87:                        if (0x10 == reg)
9D039374  11000004   BEQ T0, ZERO, 0x9D039388
9D039378  30CF0003   ANDI T7, A2, 3
88:                        {
89:                           irq.latch = value;
9D03937C  3C02A001   LUI V0, -24575
9D039380  0B40E516   J 0x9D039458
9D039384  AC4658E0   SW A2, 22752(V0)
90:                        }
91:                        else
92:                        {
93:                           switch (value & 3)
9D039388  24180001   ADDIU T8, ZERO, 1
9D03938C  11F80010   BEQ T7, T8, 0x9D0393D0
9D039390  00002021   ADDU A0, ZERO, ZERO
9D039394  11E00008   BEQ T7, ZERO, 0x9D0393B8
9D039398  24190002   ADDIU T9, ZERO, 2
9D03939C  11F90012   BEQ T7, T9, 0x9D0393E8
9D0393A0  00002821   ADDU A1, ZERO, ZERO
9D0393A4  241F0003   ADDIU RA, ZERO, 3
9D0393A8  51FF0014   BEQL T7, RA, 0x9D0393FC
9D0393AC  24040001   ADDIU A0, ZERO, 1
94:                           {
95:                           case 0:
96:                              ppu_mirror(0, 1, 0, 1); /* vertical */
9D0393B8  24050001   ADDIU A1, ZERO, 1
9D0393BC  00003021   ADDU A2, ZERO, ZERO
9D0393C0  0F4058FD   JAL ppu_mirror
9D0393C4  24070001   ADDIU A3, ZERO, 1
97:                              break;
9D0393C8  0B40E517   J 0x9D03945C
9D0393CC  8FBF0014   LW RA, 20(SP)
98:                  
99:                           case 1:
100:                             ppu_mirror(0, 0, 1, 1); /* horizontal */
9D0393D0  00002821   ADDU A1, ZERO, ZERO
9D0393D4  24060001   ADDIU A2, ZERO, 1
9D0393D8  0F4058FD   JAL ppu_mirror
9D0393DC  24070001   ADDIU A3, ZERO, 1
101:                             break;
9D0393E0  0B40E517   J 0x9D03945C
9D0393E4  8FBF0014   LW RA, 20(SP)
102:                 
103:                          case 2:
104:                             ppu_mirror(0, 0, 0, 0);
9D0393E8  00003021   ADDU A2, ZERO, ZERO
9D0393EC  0F4058FD   JAL ppu_mirror
9D0393F0  00003821   ADDU A3, ZERO, ZERO
105:                             break;
9D0393F4  0B40E517   J 0x9D03945C
9D0393F8  8FBF0014   LW RA, 20(SP)
106:                 
107:                          case 3:
108:                             ppu_mirror(1, 1, 1, 1);
9D0393FC  24050001   ADDIU A1, ZERO, 1
9D039400  24060001   ADDIU A2, ZERO, 1
9D039404  0F4058FD   JAL ppu_mirror
9D039408  24070001   ADDIU A3, ZERO, 1
109:                             break;
9D03940C  0B40E517   J 0x9D03945C
9D039410  8FBF0014   LW RA, 20(SP)
110:                          }
111:                       }
112:                       break;
113:                 
114:                    case 0x0F:
115:                       if (0x10 == reg)
9D039414  11000006   BEQ T0, ZERO, 0x9D039430
9D039418  3C03A001   LUI V1, -24575
116:                       {
117:                          irq.enabled = irq.wait_state;
9D03941C  3C05A001   LUI A1, -24575
9D039420  24AB58DC   ADDIU T3, A1, 22748
9D039424  8D6C0008   LW T4, 8(T3)
9D039428  0B40E516   J 0x9D039458
9D03942C  AD6C000C   SW T4, 12(T3)
118:                       }
119:                       else
120:                       {
121:                          irq.wait_state = value & 0x01;
9D039430  246758DC   ADDIU A3, V1, 22748
9D039434  30C80001   ANDI T0, A2, 1
9D039438  ACE80008   SW T0, 8(A3)
122:                          irq.enabled = (value & 0x02) ? true : false;
9D03943C  7CC60040   EXT A2, A2, 1, 1
123:                          if (true == irq.enabled)
9D039440  10C00005   BEQ A2, ZERO, 0x9D039458
9D039444  ACE6000C   SW A2, 12(A3)
124:                             irq.counter = irq.latch;
9D039448  3C04A001   LUI A0, -24575
9D03944C  248958DC   ADDIU T1, A0, 22748
9D039450  8D2A0004   LW T2, 4(T1)
9D039454  AC8A58DC   SW T2, 22748(A0)
125:                       }
126:                       break;
127:                 
128:                    default:
129:                 #ifdef NOFRENDO_DEBUG
130:                       log_printf("unhandled vrc7 write: $%02X to $%04X\n", value, address);
131:                 #endif /* NOFRENDO_DEBUG */
132:                       break;
133:                    }
134:                 }
9D0392B8  0B40E517   J 0x9D03945C
9D0392BC  8FBF0014   LW RA, 20(SP)
9D0392F4  0B40E517   J 0x9D03945C
9D0392F8  8FBF0014   LW RA, 20(SP)
9D03931C  0B40E517   J 0x9D03945C
9D039320  8FBF0014   LW RA, 20(SP)
9D039344  0B40E517   J 0x9D03945C
9D039348  8FBF0014   LW RA, 20(SP)
9D03936C  0B40E517   J 0x9D03945C
9D039370  8FBF0014   LW RA, 20(SP)
9D0393B0  0B40E517   J 0x9D03945C
9D0393B4  8FBF0014   LW RA, 20(SP)
9D039458  8FBF0014   LW RA, 20(SP)
9D03945C  03E00008   JR RA
9D039460  27BD0018   ADDIU SP, SP, 24
135:                 
136:                 static void map85_hblank(int vblank)
137:                 {
9D039488  27BDFFE8   ADDIU SP, SP, -24
9D03948C  AFBF0014   SW RA, 20(SP)
138:                    UNUSED(vblank);
139:                 
140:                    if (irq.enabled)
9D039464  3C02A001   LUI V0, -24575
9D039468  8C4358E8   LW V1, 22760(V0)
9D03946C  1060000E   BEQ V1, ZERO, 0x9D0394A8
9D039470  3C04A001   LUI A0, -24575
141:                    {
142:                       if (++irq.counter > 0xFF)
9D039474  8C8558DC   LW A1, 22748(A0)
9D039478  24A60001   ADDIU A2, A1, 1
9D03947C  28C70100   SLTI A3, A2, 256
9D039480  14E00009   BNE A3, ZERO, 0x9D0394A8
9D039484  AC8658DC   SW A2, 22748(A0)
143:                       {
144:                          irq.counter = irq.latch;
9D039490  248958DC   ADDIU T1, A0, 22748
9D039494  8D2A0004   LW T2, 4(T1)
145:                          nes_irq();
9D039498  0F40975F   JAL nes_irq
9D03949C  AC8A58DC   SW T2, 22748(A0)
146:                 
147:                          //return;
148:                       }
149:                       //irq.counter++;
150:                    }
151:                 }
9D0394A0  8FBF0014   LW RA, 20(SP)
9D0394A4  27BD0018   ADDIU SP, SP, 24
9D0394A8  03E00008   JR RA
9D0394AC  00000000   NOP
152:                 
153:                 static map_memwrite map85_memwrite[] =
154:                 {
155:                    { 0x8000, 0xFFFF, map85_write },
156:                    {     -1,     -1, NULL }
157:                 };
158:                 
159:                 static void map85_init(void)
160:                 {
9D0391D0  27BDFFE8   ADDIU SP, SP, -24
9D0391D4  AFBF0014   SW RA, 20(SP)
161:                    mmc_bankrom(16, 0x8000, 0);
9D0391D8  24040010   ADDIU A0, ZERO, 16
9D0391DC  34058000   ORI A1, ZERO, -32768
9D0391E0  0F40CA71   JAL mmc_bankrom
9D0391E4  00003021   ADDU A2, ZERO, ZERO
162:                    mmc_bankrom(16, 0xC000, MMC_LASTBANK);
9D0391E8  24040010   ADDIU A0, ZERO, 16
9D0391EC  3405C000   ORI A1, ZERO, -16384
9D0391F0  0F40CA71   JAL mmc_bankrom
9D0391F4  2406FFFF   ADDIU A2, ZERO, -1
163:                    
164:                    mmc_bankvrom(8, 0x0000, 0);
9D0391F8  24040008   ADDIU A0, ZERO, 8
9D0391FC  00002821   ADDU A1, ZERO, ZERO
9D039200  0F40CA16   JAL mmc_bankvrom
9D039204  00003021   ADDU A2, ZERO, ZERO
165:                 
166:                    irq.counter = irq.latch = 0;
9D039208  3C03A001   LUI V1, -24575
9D03920C  246258DC   ADDIU V0, V1, 22748
9D039210  AC400004   SW ZERO, 4(V0)
9D039214  AC6058DC   SW ZERO, 22748(V1)
167:                    irq.wait_state = 0;
9D039218  AC400008   SW ZERO, 8(V0)
168:                    irq.enabled = false;
9D03921C  AC40000C   SW ZERO, 12(V0)
169:                 }
9D039220  8FBF0014   LW RA, 20(SP)
9D039224  03E00008   JR RA
9D039228  27BD0018   ADDIU SP, SP, 24
170:                 
171:                 mapintf_t map85_intf = 
172:                 {
173:                    85, /* mapper number */
174:                    "Konami VRC7", /* mapper name */
175:                    map85_init, /* init routine */
176:                    NULL, /* vblank callback */
177:                    map85_hblank, /* hblank callback */
178:                    NULL, /* get state (snss) */
179:                    NULL, /* set state (snss) */
180:                    NULL, /* memory read structure */
181:                    map85_memwrite, /* memory write structure */
182:                    NULL
183:                 };
184:                 
185:                 /*
186:                 ** $Log: map085.c,v $
187:                 ** Revision 1.3  2001/05/06 01:42:03  neil
188:                 ** boooo
189:                 **
190:                 ** Revision 1.2  2001/04/27 14:37:11  neil
191:                 ** wheeee
192:                 **
193:                 ** Revision 1.1  2001/04/27 12:54:40  neil
194:                 ** blah
195:                 **
196:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
197:                 ** initial
198:                 **
199:                 ** Revision 1.1  2000/10/24 12:19:33  matt
200:                 ** changed directory structure
201:                 **
202:                 ** Revision 1.10  2000/10/22 19:17:46  matt
203:                 ** mapper cleanups galore
204:                 **
205:                 ** Revision 1.9  2000/10/22 15:03:14  matt
206:                 ** simplified mirroring
207:                 **
208:                 ** Revision 1.8  2000/10/21 19:33:38  matt
209:                 ** many more cleanups
210:                 **
211:                 ** Revision 1.7  2000/10/10 13:58:17  matt
212:                 ** stroustrup squeezing his way in the door
213:                 **
214:                 ** Revision 1.6  2000/08/16 02:50:11  matt
215:                 ** random mapper cleanups
216:                 **
217:                 ** Revision 1.5  2000/07/23 14:37:21  matt
218:                 ** added a break statement
219:                 **
220:                 ** Revision 1.4  2000/07/15 23:52:19  matt
221:                 ** rounded out a bunch more mapper interfaces
222:                 **
223:                 ** Revision 1.3  2000/07/10 13:51:25  matt
224:                 ** using generic nes_irq() routine now
225:                 **
226:                 ** Revision 1.2  2000/07/10 05:29:03  matt
227:                 ** cleaned up some mirroring issues
228:                 **
229:                 ** Revision 1.1  2000/07/06 02:47:47  matt
230:                 ** initial revision
231:                 **
232:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map079.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map78.c
21:                  **
22:                  ** mapper 78 interface
23:                  ** $Id: map079.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  
29:                  /* mapper 79: NINA-03/06 */
30:                  static void map79_write(uint32 address, uint8 value)
31:                  {
9D040C78  27BDFFE8   ADDIU SP, SP, -24
9D040C7C  AFBF0014   SW RA, 20(SP)
9D040C80  AFB00010   SW S0, 16(SP)
9D040C84  00A08021   ADDU S0, A1, ZERO
32:                     if ((address & 0x5100) == 0x4100)
9D040C68  30845100   ANDI A0, A0, 20736
9D040C6C  24024100   ADDIU V0, ZERO, 16640
9D040C70  1482000F   BNE A0, V0, 0x9D040CB0
9D040C74  24040020   ADDIU A0, ZERO, 32
33:                     {
34:                        mmc_bankrom(32, 0x8000, (value >> 3) & 1);
9D040C88  34058000   ORI A1, ZERO, -32768
9D040C8C  0F40CA71   JAL mmc_bankrom
9D040C90  7E0600C0   EXT A2, S0, 3, 1
35:                        mmc_bankvrom(8, 0x0000, value & 7);
9D040C94  24040008   ADDIU A0, ZERO, 8
9D040C98  00002821   ADDU A1, ZERO, ZERO
9D040C9C  0F40CA16   JAL mmc_bankvrom
9D040CA0  32060007   ANDI A2, S0, 7
36:                     }
37:                  }
9D040CA4  8FBF0014   LW RA, 20(SP)
9D040CA8  8FB00010   LW S0, 16(SP)
9D040CAC  27BD0018   ADDIU SP, SP, 24
9D040CB0  03E00008   JR RA
9D040CB4  00000000   NOP
38:                  
39:                  static void map79_init(void)
40:                  {
9D040CB8  27BDFFE8   ADDIU SP, SP, -24
9D040CBC  AFBF0014   SW RA, 20(SP)
41:                     mmc_bankrom(32, 0x8000, 0);
9D040CC0  24040020   ADDIU A0, ZERO, 32
9D040CC4  34058000   ORI A1, ZERO, -32768
9D040CC8  0F40CA71   JAL mmc_bankrom
9D040CCC  00003021   ADDU A2, ZERO, ZERO
42:                     mmc_bankvrom(8, 0x0000, 0);
9D040CD0  24040008   ADDIU A0, ZERO, 8
9D040CD4  00002821   ADDU A1, ZERO, ZERO
9D040CD8  0F40CA16   JAL mmc_bankvrom
9D040CDC  00003021   ADDU A2, ZERO, ZERO
43:                  }
9D040CE0  8FBF0014   LW RA, 20(SP)
9D040CE4  03E00008   JR RA
9D040CE8  27BD0018   ADDIU SP, SP, 24
44:                  
45:                  static map_memwrite map79_memwrite[] =
46:                  {
47:                     { 0x4100, 0x5FFF, map79_write }, /* ????? incorrect range ??? */
48:                     {     -1,     -1, NULL }
49:                  };
50:                  
51:                  mapintf_t map79_intf =
52:                  {
53:                     79, /* mapper number */
54:                     "NINA-03/06", /* mapper name */
55:                     map79_init, /* init routine */
56:                     NULL, /* vblank callback */
57:                     NULL, /* hblank callback */
58:                     NULL, /* get state (snss) */
59:                     NULL, /* set state (snss) */
60:                     NULL, /* memory read structure */
61:                     map79_memwrite, /* memory write structure */
62:                     NULL /* external sound device */
63:                  };
64:                  
65:                  /*
66:                  ** $Log: map079.c,v $
67:                  ** Revision 1.2  2001/04/27 14:37:11  neil
68:                  ** wheeee
69:                  **
70:                  ** Revision 1.1  2001/04/27 12:54:40  neil
71:                  ** blah
72:                  **
73:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
74:                  ** initial
75:                  **
76:                  ** Revision 1.1  2000/10/24 12:19:33  matt
77:                  ** changed directory structure
78:                  **
79:                  ** Revision 1.4  2000/10/22 19:17:47  matt
80:                  ** mapper cleanups galore
81:                  **
82:                  ** Revision 1.3  2000/10/21 19:33:38  matt
83:                  ** many more cleanups
84:                  **
85:                  ** Revision 1.2  2000/07/06 02:48:43  matt
86:                  ** clearly labelled structure members
87:                  **
88:                  ** Revision 1.1  2000/07/06 01:01:56  matt
89:                  ** initial revision
90:                  **
91:                  */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map078.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map78.c
21:                  **
22:                  ** mapper 78 interface
23:                  ** $Id: map078.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes_ppu.h>
29:                  
30:                  /* mapper 78: Holy Diver, Cosmo Carrier */
31:                  /* ($8000-$FFFF) D2-D0 = switch $8000-$BFFF */
32:                  /* ($8000-$FFFF) D7-D4 = switch PPU $0000-$1FFF */
33:                  /* ($8000-$FFFF) D3 = switch mirroring */
34:                  static void map78_write(uint32 address, uint8 value)
35:                  {
9D03FF78  27BDFFE8   ADDIU SP, SP, -24
9D03FF7C  AFBF0014   SW RA, 20(SP)
9D03FF80  AFB00010   SW S0, 16(SP)
9D03FF84  00A08021   ADDU S0, A1, ZERO
36:                     UNUSED(address);
37:                  
38:                     mmc_bankrom(16, 0x8000, value & 7);
9D03FF88  24040010   ADDIU A0, ZERO, 16
9D03FF8C  34058000   ORI A1, ZERO, -32768
9D03FF90  0F40CA71   JAL mmc_bankrom
9D03FF94  32060007   ANDI A2, S0, 7
39:                     mmc_bankvrom(8, 0x0000, (value >> 4) & 0x0F);
9D03FF98  24040008   ADDIU A0, ZERO, 8
9D03FF9C  00002821   ADDU A1, ZERO, ZERO
9D03FFA0  0F40CA16   JAL mmc_bankvrom
9D03FFA4  00103102   SRL A2, S0, 4
40:                  
41:                     /* Ugh! Same abuse of the 4-screen bit as with Mapper #70 */
42:                     if (mmc_getinfo()->flags & ROM_FLAG_FOURSCREEN)
9D03FFA8  0F40CA0A   JAL mmc_getinfo
9D03FFAC  00000000   NOP
9D03FFB0  90420028   LBU V0, 40(V0)
9D03FFB4  30430004   ANDI V1, V0, 4
9D03FFB8  306400FF   ANDI A0, V1, 255
9D03FFBC  10800010   BEQ A0, ZERO, .LBB2
9D03FFC0  32050008   ANDI A1, S0, 8
43:                     {
44:                        if (value & 0x08)
9D03FFC4  30A600FF   ANDI A2, A1, 255
9D03FFC8  10C00007   BEQ A2, ZERO, 0x9D03FFE8
9D03FFCC  00002021   ADDU A0, ZERO, ZERO
45:                           ppu_mirror(0, 1, 0, 1); /* vert */
9D03FFD0  24050001   ADDIU A1, ZERO, 1
9D03FFD4  00003021   ADDU A2, ZERO, ZERO
9D03FFD8  0F4058FD   JAL ppu_mirror
9D03FFDC  24070001   ADDIU A3, ZERO, 1
9D03FFE0  0B410006   J 0x9D040018
9D03FFE4  8FBF0014   LW RA, 20(SP)
46:                        else
47:                           ppu_mirror(0, 0, 1, 1); /* horiz */
9D03FFE8  00002821   ADDU A1, ZERO, ZERO
9D03FFEC  24060001   ADDIU A2, ZERO, 1
9D03FFF0  0F4058FD   JAL ppu_mirror
9D03FFF4  24070001   ADDIU A3, ZERO, 1
48:                     }
49:                     else
50:                     {
51:                        int mirror = (value >> 3) & 1;
9D040000  7E0700C0   EXT A3, S0, 3, 1
52:                        ppu_mirror(mirror, mirror, mirror, mirror);
9D040004  00E02021   ADDU A0, A3, ZERO
9D040008  00E02821   ADDU A1, A3, ZERO
9D04000C  0F4058FD   JAL ppu_mirror
9D040010  00E03021   ADDU A2, A3, ZERO
53:                     }
54:                  }
9D03FFF8  0B410006   J 0x9D040018
9D03FFFC  8FBF0014   LW RA, 20(SP)
9D040014  8FBF0014   LW RA, 20(SP)
9D040018  8FB00010   LW S0, 16(SP)
9D04001C  03E00008   JR RA
9D040020  27BD0018   ADDIU SP, SP, 24
55:                  
56:                  static map_memwrite map78_memwrite[] =
57:                  {
58:                     { 0x8000, 0xFFFF, map78_write },
59:                     {     -1,     -1, NULL }
60:                  };
61:                  
62:                  mapintf_t map78_intf =
63:                  {
64:                     78, /* mapper number */
65:                     "Mapper 78", /* mapper name */
66:                     NULL, /* init routine */
67:                     NULL, /* vblank callback */
68:                     NULL, /* hblank callback */
69:                     NULL, /* get state (snss) */
70:                     NULL, /* set state (snss) */
71:                     NULL, /* memory read structure */
72:                     map78_memwrite, /* memory write structure */
73:                     NULL /* external sound device */
74:                  };
75:                  
76:                  /*
77:                  ** $Log: map078.c,v $
78:                  ** Revision 1.2  2001/04/27 14:37:11  neil
79:                  ** wheeee
80:                  **
81:                  ** Revision 1.1  2001/04/27 12:54:40  neil
82:                  ** blah
83:                  **
84:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
85:                  ** initial
86:                  **
87:                  ** Revision 1.1  2000/10/24 12:19:33  matt
88:                  ** changed directory structure
89:                  **
90:                  ** Revision 1.7  2000/10/22 19:17:46  matt
91:                  ** mapper cleanups galore
92:                  **
93:                  ** Revision 1.6  2000/10/22 15:03:14  matt
94:                  ** simplified mirroring
95:                  **
96:                  ** Revision 1.5  2000/10/21 19:33:38  matt
97:                  ** many more cleanups
98:                  **
99:                  ** Revision 1.4  2000/08/16 02:50:11  matt
100:                 ** random mapper cleanups
101:                 **
102:                 ** Revision 1.3  2000/07/10 05:29:03  matt
103:                 ** cleaned up some mirroring issues
104:                 **
105:                 ** Revision 1.2  2000/07/06 02:48:43  matt
106:                 ** clearly labelled structure members
107:                 **
108:                 ** Revision 1.1  2000/07/06 01:01:56  matt
109:                 ** initial revision
110:                 **
111:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map075.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map75.c
21:                  **
22:                  ** mapper 75 interface
23:                  ** $Id: map075.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes_ppu.h>
29:                  
30:                  
31:                  static uint8 latch[2];
32:                  static uint8 hibits;
33:                  
34:                  /* mapper 75: Konami VRC1 */
35:                  static void map75_write(uint32 address, uint8 value)
36:                  {
9D03C32C  27BDFFE8   ADDIU SP, SP, -24
9D03C330  AFBF0014   SW RA, 20(SP)
9D03C334  AFB00010   SW S0, 16(SP)
9D03C338  00A08021   ADDU S0, A1, ZERO
37:                     switch ((address & 0xF000) >> 12)
9D03C318  7C841B00   EXT A0, A0, 12, 4
9D03C31C  2483FFF8   ADDIU V1, A0, -8
9D03C320  2C620008   SLTIU V0, V1, 8
9D03C324  10400061   BEQ V0, ZERO, 0x9D03C4AC
9D03C328  00000000   NOP
9D03C33C  00032880   SLL A1, V1, 2
9D03C340  3C069D04   LUI A2, -25340
9D03C344  24C7C358   ADDIU A3, A2, -15528
9D03C348  00E54021   ADDU T0, A3, A1
9D03C34C  8D090000   LW T1, 0(T0)
9D03C350  01200008   JR T1
9D03C354  00000000   NOP
38:                     {
39:                     case 0x8:
40:                        mmc_bankrom(8, 0x8000, value);
9D03C378  24040008   ADDIU A0, ZERO, 8
9D03C37C  34058000   ORI A1, ZERO, -32768
9D03C380  0F40CA71   JAL mmc_bankrom
9D03C384  02003021   ADDU A2, S0, ZERO
41:                        break;
9D03C388  0B40F129   J 0x9D03C4A4
9D03C38C  8FBF0014   LW RA, 20(SP)
42:                  
43:                     case 0x9:
44:                        hibits = (value & 0x06);
9D03C390  32040006   ANDI A0, S0, 6
9D03C394  A3848100   SB A0, -32512(GP)
45:                        
46:                        mmc_bankvrom(4, 0x0000, ((hibits & 0x02) << 3) | latch[0]);
9D03C398  32020002   ANDI V0, S0, 2
9D03C39C  304500FF   ANDI A1, V0, 255
9D03C3A0  000530C0   SLL A2, A1, 3
9D03C3A4  93878104   LBU A3, -32508(GP)
9D03C3A8  24040004   ADDIU A0, ZERO, 4
9D03C3AC  00002821   ADDU A1, ZERO, ZERO
9D03C3B0  0F40CA16   JAL mmc_bankvrom
9D03C3B4  00C73025   OR A2, A2, A3
47:                        mmc_bankvrom(4, 0x1000, ((hibits & 0x04) << 2) | latch[1]);
9D03C3B8  93888100   LBU T0, -32512(GP)
9D03C3BC  31090004   ANDI T1, T0, 4
9D03C3C0  312A00FF   ANDI T2, T1, 255
9D03C3C4  000A5880   SLL T3, T2, 2
9D03C3C8  938C8105   LBU T4, -32507(GP)
9D03C3CC  24040004   ADDIU A0, ZERO, 4
9D03C3D0  24051000   ADDIU A1, ZERO, 4096
9D03C3D4  0F40CA16   JAL mmc_bankvrom
9D03C3D8  016C3025   OR A2, T3, T4
48:                  
49:                        if (value & 1)
9D03C3DC  32100001   ANDI S0, S0, 1
9D03C3E0  12000007   BEQ S0, ZERO, 0x9D03C400
9D03C3E4  00002021   ADDU A0, ZERO, ZERO
50:                           ppu_mirror(0, 1, 0, 1); /* vert */
9D03C3E8  24050001   ADDIU A1, ZERO, 1
9D03C3EC  00003021   ADDU A2, ZERO, ZERO
9D03C3F0  0F4058FD   JAL ppu_mirror
9D03C3F4  24070001   ADDIU A3, ZERO, 1
9D03C3F8  0B40F129   J 0x9D03C4A4
9D03C3FC  8FBF0014   LW RA, 20(SP)
51:                        else
52:                           ppu_mirror(0, 0, 1, 1); /* horiz */
9D03C400  00002821   ADDU A1, ZERO, ZERO
9D03C404  24060001   ADDIU A2, ZERO, 1
9D03C408  0F4058FD   JAL ppu_mirror
9D03C40C  24070001   ADDIU A3, ZERO, 1
53:                  
54:                        break;
55:                  
56:                     case 0xA:
57:                        mmc_bankrom(8, 0xA000, value);
9D03C418  24040008   ADDIU A0, ZERO, 8
9D03C41C  3405A000   ORI A1, ZERO, -24576
9D03C420  0F40CA71   JAL mmc_bankrom
9D03C424  02003021   ADDU A2, S0, ZERO
58:                        break;
9D03C428  0B40F129   J 0x9D03C4A4
9D03C42C  8FBF0014   LW RA, 20(SP)
59:                  
60:                     case 0xC:
61:                        mmc_bankrom(8, 0xC000, value);
9D03C430  24040008   ADDIU A0, ZERO, 8
9D03C434  3405C000   ORI A1, ZERO, -16384
9D03C438  0F40CA71   JAL mmc_bankrom
9D03C43C  02003021   ADDU A2, S0, ZERO
62:                        break;
9D03C440  0B40F129   J 0x9D03C4A4
9D03C444  8FBF0014   LW RA, 20(SP)
63:                  
64:                     case 0xE:
65:                        latch[0] = (value & 0x0F);
9D03C448  320F000F   ANDI T7, S0, 15
9D03C44C  A38F8104   SB T7, -32508(GP)
66:                        mmc_bankvrom(4, 0x0000, ((hibits & 0x02) << 3) | latch[0]);
9D03C450  93988100   LBU T8, -32512(GP)
9D03C454  33190002   ANDI T9, T8, 2
9D03C458  333F00FF   ANDI RA, T9, 255
9D03C45C  001F18C0   SLL V1, RA, 3
9D03C460  24040004   ADDIU A0, ZERO, 4
9D03C464  00002821   ADDU A1, ZERO, ZERO
9D03C468  0F40CA16   JAL mmc_bankvrom
9D03C46C  01E33025   OR A2, T7, V1
67:                        break;
9D03C470  0B40F129   J 0x9D03C4A4
9D03C474  8FBF0014   LW RA, 20(SP)
68:                  
69:                     case 0xF:
70:                        latch[1] = (value & 0x0F);
9D03C478  320A000F   ANDI T2, S0, 15
9D03C47C  A38A8105   SB T2, -32507(GP)
71:                        mmc_bankvrom(4, 0x1000, ((hibits & 0x04) << 2) | latch[1]);
9D03C480  938B8100   LBU T3, -32512(GP)
9D03C484  316C0004   ANDI T4, T3, 4
9D03C488  318D00FF   ANDI T5, T4, 255
9D03C48C  000D7080   SLL T6, T5, 2
9D03C490  24040004   ADDIU A0, ZERO, 4
9D03C494  24051000   ADDIU A1, ZERO, 4096
9D03C498  0F40CA16   JAL mmc_bankvrom
9D03C49C  014E3025   OR A2, T2, T6
72:                        break;
73:                  
74:                     default:
75:                        break;
76:                     }
77:                  }
9D03C410  0B40F129   J 0x9D03C4A4
9D03C414  8FBF0014   LW RA, 20(SP)
9D03C4A0  8FBF0014   LW RA, 20(SP)
9D03C4A4  8FB00010   LW S0, 16(SP)
9D03C4A8  27BD0018   ADDIU SP, SP, 24
9D03C4AC  03E00008   JR RA
9D03C4B0  00000000   NOP
78:                  
79:                  static map_memwrite map75_memwrite[] =
80:                  {
81:                     { 0x8000, 0xFFFF, map75_write },
82:                     {     -1,     -1, NULL }
83:                  };
84:                  
85:                  mapintf_t map75_intf =
86:                  {
87:                     75, /* mapper number */
88:                     "Konami VRC1", /* mapper name */
89:                     NULL, /* init routine */
90:                     NULL, /* vblank callback */
91:                     NULL, /* hblank callback */
92:                     NULL, /* get state (snss) */
93:                     NULL, /* set state (snss) */
94:                     NULL, /* memory read structure */
95:                     map75_memwrite, /* memory write structure */
96:                     NULL /* external sound device */
97:                  };
98:                  
99:                  /*
100:                 ** $Log: map075.c,v $
101:                 ** Revision 1.2  2001/04/27 14:37:11  neil
102:                 ** wheeee
103:                 **
104:                 ** Revision 1.1  2001/04/27 12:54:40  neil
105:                 ** blah
106:                 **
107:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
108:                 ** initial
109:                 **
110:                 ** Revision 1.1  2000/10/24 12:19:33  matt
111:                 ** changed directory structure
112:                 **
113:                 ** Revision 1.6  2000/10/22 19:17:46  matt
114:                 ** mapper cleanups galore
115:                 **
116:                 ** Revision 1.5  2000/10/22 15:03:14  matt
117:                 ** simplified mirroring
118:                 **
119:                 ** Revision 1.4  2000/10/21 19:33:38  matt
120:                 ** many more cleanups
121:                 **
122:                 ** Revision 1.3  2000/07/10 05:29:03  matt
123:                 ** cleaned up some mirroring issues
124:                 **
125:                 ** Revision 1.2  2000/07/06 02:48:43  matt
126:                 ** clearly labelled structure members
127:                 **
128:                 ** Revision 1.1  2000/07/06 01:01:56  matt
129:                 ** initial revision
130:                 **
131:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map073.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map073.c
21:                  **
22:                  ** Mapper #73 (Konami VRC3)
23:                  ** Implementation by Firebug
24:                  ** $Id: map073.c,v 1.2 2001/04/27 14:37:11 neil Exp $
25:                  **
26:                  */
27:                  
28:                  #include <noftypes.h>
29:                  #include <nes_mmc.h>
30:                  #include <nes.h>
31:                  #include <libsnss.h>
32:                  #include <log.h>
33:                  
34:                  static struct
35:                  {
36:                    bool enabled;
37:                    uint32 counter;
38:                  } irq;
39:                  
40:                  /**************************/
41:                  /* Mapper #73: Salamander */
42:                  /**************************/
43:                  static void map73_init (void)
44:                  {
45:                    /* Turn off IRQs */
46:                    irq.enabled = false;
9D03D050  AF808130   SW ZERO, -32464(GP)
47:                    irq.counter = 0x0000;
9D03D054  03E00008   JR RA
9D03D058  AF808134   SW ZERO, -32460(GP)
48:                  
49:                    /* Done */
50:                    return;
51:                  }
52:                  
53:                  /****************************************/
54:                  /* Mapper #73 callback for IRQ handling */
55:                  /****************************************/
56:                  static void map73_hblank (int vblank)
57:                  {
9D03D168  27BDFFE8   ADDIU SP, SP, -24
9D03D16C  AFBF0014   SW RA, 20(SP)
58:                     /* Counter is M2 based so it doesn't matter whether */
59:                     /* the PPU is in its VBlank period or not           */
60:                     UNUSED (vblank);
61:                  
62:                     /* Increment the counter if it is enabled and check for strike */
63:                     if (irq.enabled)
9D03D170  8F828130   LW V0, -32464(GP)
9D03D174  1040000A   BEQ V0, ZERO, 0x9D03D1A0
9D03D178  8F838134   LW V1, -32460(GP)
64:                     {
65:                       /* Is there a constant for cycles per scanline? */
66:                       /* If so, someone ought to substitute it here   */
67:                       irq.counter = irq.counter + 114;
9D03D17C  24640072   ADDIU A0, V1, 114
9D03D18C  0B40F468   J 0x9D03D1A0
9D03D190  AF848134   SW A0, -32460(GP)
68:                  
69:                       /* Counter triggered on overflow into Q16 */
70:                       if (irq.counter & 0x10000)
9D03D180  7C850400   EXT A1, A0, 16, 1
9D03D184  14A00003   BNE A1, ZERO, 0x9D03D194
9D03D188  3086FFFF   ANDI A2, A0, -1
71:                       {
72:                         /* Clip to sixteen-bit word */
73:                         irq.counter &= 0xFFFF;
74:                  
75:                         /* Trigger the IRQ */
76:                         nes_irq ();
9D03D194  0F40975F   JAL nes_irq
9D03D198  AF868134   SW A2, -32460(GP)
77:                  
78:                         /* Shut off IRQ counter */
79:                         irq.enabled = false;
9D03D19C  AF808130   SW ZERO, -32464(GP)
80:                       }
81:                     }
82:                  }
9D03D1A0  8FBF0014   LW RA, 20(SP)
9D03D1A4  03E00008   JR RA
9D03D1A8  27BD0018   ADDIU SP, SP, 24
83:                  
84:                  /******************************************/
85:                  /* Mapper #73 write handler ($8000-$FFFF) */
86:                  /******************************************/
87:                  static void map73_write (uint32 address, uint8 value)
88:                  {
9D03D06C  27BDFFE8   ADDIU SP, SP, -24
9D03D070  AFBF0014   SW RA, 20(SP)
89:                    switch (address & 0xF000)
9D03D074  3084F000   ANDI A0, A0, -4096
9D03D078  3402A000   ORI V0, ZERO, -24576
9D03D07C  10820020   BEQ A0, V0, 0x9D03D100
9D03D080  00A03021   ADDU A2, A1, ZERO
9D03D084  3403A001   ORI V1, ZERO, -24575
9D03D088  0083282B   SLTU A1, A0, V1
9D03D08C  10A00008   BEQ A1, ZERO, 0x9D03D0B0
9D03D090  3419C000   ORI T9, ZERO, -16384
9D03D094  34078000   ORI A3, ZERO, -32768
9D03D098  1087000D   BEQ A0, A3, 0x9D03D0D0
9D03D09C  34089000   ORI T0, ZERO, -28672
9D03D0A0  10880011   BEQ A0, T0, 0x9D03D0E8
9D03D0A4  27898134   ADDIU T1, GP, -32460
9D03D0B0  10990020   BEQ A0, T9, 0x9D03D134
9D03D0B4  341FF000   ORI RA, ZERO, -4096
9D03D0B8  109F0025   BEQ A0, RA, 0x9D03D150
9D03D0BC  3402B000   ORI V0, ZERO, -20480
9D03D0C0  14820027   BNE A0, V0, 0x9D03D160
9D03D0C4  8FBF0014   LW RA, 20(SP)
90:                    {
91:                      case 0x8000: irq.counter &= 0xFFF0;
9D03D0D4  8DAE0000   LW T6, 0(T5)
9D03D0D8  31CFFFF0   ANDI T7, T6, -16
92:                                   irq.counter |= (uint32) (value);
9D03D0D0  278D8134   ADDIU T5, GP, -32460
9D03D0DC  00CFC025   OR T8, A2, T7
93:                                   break;
9D03D0E0  0B40F457   J .LVL7
9D03D0E4  ADB80000   SW T8, 0(T5)
94:                      case 0x9000: irq.counter &= 0xFF0F;
9D03D0EC  8D2A0000   LW T2, 0(T1)
9D03D0F0  314BFF0F   ANDI T3, T2, -241
95:                                   irq.counter |= (uint32) (value << 4);
9D03D0E8  00063100   SLL A2, A2, 4
9D03D0F4  00CB6025   OR T4, A2, T3
96:                                   break;
9D03D0F8  0B40F457   J .LVL7
9D03D0FC  AD2C0000   SW T4, 0(T1)
97:                      case 0xA000: irq.counter &= 0xF0FF;
9D03D108  8D6D0000   LW T5, 0(T3)
9D03D10C  31AEF0FF   ANDI T6, T5, -3841
98:                                   irq.counter |= (uint32) (value << 8);
9D03D100  278B8134   ADDIU T3, GP, -32460
9D03D104  00056200   SLL T4, A1, 8
9D03D110  018E7825   OR T7, T4, T6
99:                                   break;
9D03D114  0B40F457   J .LVL7
9D03D118  AD6F0000   SW T7, 0(T3)
100:                     case 0xB000: irq.counter &= 0x0FFF;
9D03D120  8C830000   LW V1, 0(A0)
9D03D124  30670FFF   ANDI A3, V1, 4095
101:                                  irq.counter |= (uint32) (value << 12);
9D03D0C8  0B40F447   J 0x9D03D11C
9D03D0CC  27848134   ADDIU A0, GP, -32460
9D03D11C  00062B00   SLL A1, A2, 12
9D03D128  00A74025   OR T0, A1, A3
102:                                  break;
9D03D12C  0B40F457   J .LVL7
9D03D130  AC880000   SW T0, 0(A0)
103:                     case 0xC000: if (value & 0x02) irq.enabled = true;
9D03D134  30C90002   ANDI T1, A2, 2
9D03D138  312600FF   ANDI A2, T1, 255
9D03D13C  50C00007   BEQL A2, ZERO, .LVL7
9D03D140  AF808130   SW ZERO, -32464(GP)
9D03D144  240A0001   ADDIU T2, ZERO, 1
9D03D148  0B40F457   J .LVL7
9D03D14C  AF8A8130   SW T2, -32464(GP)
104:                                  else              irq.enabled = false;
105:                                  break;
106:                     case 0xF000: mmc_bankrom (16, 0x8000, value);
9D03D150  24040010   ADDIU A0, ZERO, 16
9D03D154  0F40CA71   JAL mmc_bankrom
9D03D158  34058000   ORI A1, ZERO, -32768
107:                     default:     break;
108:                   }
109:                 
110:                   /* Done */
111:                   return;
112:                 }
9D03D0A8  0B40F458   J 0x9D03D160
9D03D0AC  8FBF0014   LW RA, 20(SP)
9D03D15C  8FBF0014   LW RA, 20(SP)
9D03D160  03E00008   JR RA
9D03D164  27BD0018   ADDIU SP, SP, 24
113:                 
114:                 /****************************************************/
115:                 /* Shove extra mapper information into a SNSS block */
116:                 /****************************************************/
117:                 static void map73_setstate (SnssMapperBlock *state)
118:                 {
9D03D05C  03E00008   JR RA
9D03D060  00000000   NOP
119:                   /* TODO: Store SNSS information */
120:                   UNUSED (state);
121:                 
122:                   /* Done */
123:                   return;
124:                 }
125:                 
126:                 /*****************************************************/
127:                 /* Pull extra mapper information out of a SNSS block */
128:                 /*****************************************************/
129:                 static void map73_getstate (SnssMapperBlock *state)
130:                 {
9D03D064  03E00008   JR RA
9D03D068  00000000   NOP
131:                   /* TODO: Retrieve SNSS information */
132:                   UNUSED (state);
133:                 
134:                   /* Done */
135:                   return;
136:                 }
137:                 
138:                 static map_memwrite map73_memwrite [] =
139:                 {
140:                    { 0x8000, 0xFFFF, map73_write },
141:                    {     -1,     -1, NULL }
142:                 };
143:                 
144:                 mapintf_t map73_intf =
145:                 {
146:                    73,                               /* Mapper number */
147:                    "Konami VRC3",                    /* Mapper name */
148:                    map73_init,                       /* Initialization routine */
149:                    NULL,                             /* VBlank callback */
150:                    map73_hblank,                     /* HBlank callback */
151:                    map73_getstate,                   /* Get state (SNSS) */
152:                    map73_setstate,                   /* Set state (SNSS) */
153:                    NULL,                             /* Memory read structure */
154:                    map73_memwrite,                   /* Memory write structure */
155:                    NULL                              /* External sound device */
156:                 };
157:                 
158:                 /*
159:                 ** $Log: map073.c,v $
160:                 ** Revision 1.2  2001/04/27 14:37:11  neil
161:                 ** wheeee
162:                 **
163:                 ** Revision 1.1  2001/04/27 12:54:40  neil
164:                 ** blah
165:                 **
166:                 ** Revision 1.1  2001/04/27 10:57:41  neil
167:                 ** wheee
168:                 **
169:                 ** Revision 1.1  2000/12/30 06:35:05  firebug
170:                 ** Initial revision
171:                 **
172:                 **
173:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map070.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map70.c
21:                  **
22:                  ** mapper 70 interface
23:                  ** $Id: map070.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes_ppu.h>
29:                  
30:                  /* mapper 70: Arkanoid II, Kamen Rider Club, etc. */
31:                  /* ($8000-$FFFF) D6-D4 = switch $8000-$BFFF */
32:                  /* ($8000-$FFFF) D3-D0 = switch PPU $0000-$1FFF */
33:                  /* ($8000-$FFFF) D7 = switch mirroring */
34:                  static void map70_write(uint32 address, uint8 value)
35:                  {
9D040228  27BDFFE8   ADDIU SP, SP, -24
9D04022C  AFBF0014   SW RA, 20(SP)
9D040230  AFB00010   SW S0, 16(SP)
9D040234  00A08021   ADDU S0, A1, ZERO
36:                     UNUSED(address);
37:                  
38:                     mmc_bankrom(16, 0x8000, (value >> 4) & 0x07);
9D040238  24040010   ADDIU A0, ZERO, 16
9D04023C  34058000   ORI A1, ZERO, -32768
9D040240  0F40CA71   JAL mmc_bankrom
9D040244  7E061100   EXT A2, S0, 4, 3
39:                     mmc_bankvrom(8, 0x0000, value & 0x0F);
9D040248  24040008   ADDIU A0, ZERO, 8
9D04024C  00002821   ADDU A1, ZERO, ZERO
9D040250  0F40CA16   JAL mmc_bankvrom
9D040254  3206000F   ANDI A2, S0, 15
40:                  
41:                     /* Argh! FanWen used the 4-screen bit to determine
42:                     ** whether the game uses D7 to switch between
43:                     ** horizontal and vertical mirroring, or between
44:                     ** one-screen mirroring from $2000 or $2400.
45:                     */
46:                     if (mmc_getinfo()->flags & ROM_FLAG_FOURSCREEN)
9D040258  0F40CA0A   JAL mmc_getinfo
9D04025C  00000000   NOP
9D040260  90420028   LBU V0, 40(V0)
9D040264  30430004   ANDI V1, V0, 4
9D040268  306400FF   ANDI A0, V1, 255
9D04026C  1080000F   BEQ A0, ZERO, .LBB2
9D040270  7C102C20   SEB A1, S0
47:                     {
48:                        if (value & 0x80)
9D040274  04A10007   BGEZ A1, 0x9D040294
9D040278  00002021   ADDU A0, ZERO, ZERO
49:                           ppu_mirror(0, 0, 1, 1); /* horiz */
9D04027C  00002821   ADDU A1, ZERO, ZERO
9D040280  24060001   ADDIU A2, ZERO, 1
9D040284  0F4058FD   JAL ppu_mirror
9D040288  24070001   ADDIU A3, ZERO, 1
9D04028C  0B4100B1   J 0x9D0402C4
9D040290  8FBF0014   LW RA, 20(SP)
50:                        else
51:                           ppu_mirror(0, 1, 0, 1); /* vert */
9D040294  24050001   ADDIU A1, ZERO, 1
9D040298  00003021   ADDU A2, ZERO, ZERO
9D04029C  0F4058FD   JAL ppu_mirror
9D0402A0  24070001   ADDIU A3, ZERO, 1
52:                     }
53:                     else
54:                     {
55:                        int mirror = (value & 0x80) >> 7;
9D0402AC  001039C2   SRL A3, S0, 7
56:                        ppu_mirror(mirror, mirror, mirror, mirror);
9D0402B0  00E02021   ADDU A0, A3, ZERO
9D0402B4  00E02821   ADDU A1, A3, ZERO
9D0402B8  0F4058FD   JAL ppu_mirror
9D0402BC  00E03021   ADDU A2, A3, ZERO
57:                     }
58:                  }
9D0402A4  0B4100B1   J 0x9D0402C4
9D0402A8  8FBF0014   LW RA, 20(SP)
9D0402C0  8FBF0014   LW RA, 20(SP)
9D0402C4  8FB00010   LW S0, 16(SP)
9D0402C8  03E00008   JR RA
9D0402CC  27BD0018   ADDIU SP, SP, 24
59:                  
60:                  static map_memwrite map70_memwrite[] =
61:                  {
62:                     { 0x8000, 0xFFFF, map70_write },
63:                     {     -1,     -1, NULL }
64:                  };
65:                  
66:                  mapintf_t map70_intf =
67:                  {
68:                     70, /* mapper number */
69:                     "Mapper 70", /* mapper name */
70:                     NULL, /* init routine */
71:                     NULL, /* vblank callback */
72:                     NULL, /* hblank callback */
73:                     NULL, /* get state (snss) */
74:                     NULL, /* set state (snss) */
75:                     NULL, /* memory read structure */
76:                     map70_memwrite, /* memory write structure */
77:                     NULL /* external sound device */
78:                  };
79:                  
80:                  /*
81:                  ** $Log: map070.c,v $
82:                  ** Revision 1.2  2001/04/27 14:37:11  neil
83:                  ** wheeee
84:                  **
85:                  ** Revision 1.1  2001/04/27 12:54:40  neil
86:                  ** blah
87:                  **
88:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
89:                  ** initial
90:                  **
91:                  ** Revision 1.1  2000/10/24 12:19:33  matt
92:                  ** changed directory structure
93:                  **
94:                  ** Revision 1.7  2000/10/22 19:17:46  matt
95:                  ** mapper cleanups galore
96:                  **
97:                  ** Revision 1.6  2000/10/22 15:03:13  matt
98:                  ** simplified mirroring
99:                  **
100:                 ** Revision 1.5  2000/10/21 19:33:38  matt
101:                 ** many more cleanups
102:                 **
103:                 ** Revision 1.4  2000/08/16 02:50:11  matt
104:                 ** random mapper cleanups
105:                 **
106:                 ** Revision 1.3  2000/07/10 05:29:03  matt
107:                 ** cleaned up some mirroring issues
108:                 **
109:                 ** Revision 1.2  2000/07/06 02:48:43  matt
110:                 ** clearly labelled structure members
111:                 **
112:                 ** Revision 1.1  2000/07/06 01:01:56  matt
113:                 ** initial revision
114:                 **
115:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map066.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map66.c
21:                  **
22:                  ** mapper 66 interface
23:                  ** $Id: map066.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  
29:                  /* mapper 66: GNROM */
30:                  static void map66_write(uint32 address, uint8 value)
31:                  {
9D0410D4  27BDFFE8   ADDIU SP, SP, -24
9D0410D8  AFBF0014   SW RA, 20(SP)
9D0410DC  AFB00010   SW S0, 16(SP)
9D0410E0  00A08021   ADDU S0, A1, ZERO
32:                     UNUSED(address);
33:                  
34:                     mmc_bankrom(32, 0x8000, (value >> 4) & 3);
9D0410E4  24040020   ADDIU A0, ZERO, 32
9D0410E8  34058000   ORI A1, ZERO, -32768
9D0410EC  0F40CA71   JAL mmc_bankrom
9D0410F0  7E060900   EXT A2, S0, 4, 2
35:                     mmc_bankvrom(8, 0x0000, value & 3);
9D0410F4  24040008   ADDIU A0, ZERO, 8
9D0410F8  00002821   ADDU A1, ZERO, ZERO
9D0410FC  0F40CA16   JAL mmc_bankvrom
9D041100  32060003   ANDI A2, S0, 3
36:                  }
9D041104  8FBF0014   LW RA, 20(SP)
9D041108  8FB00010   LW S0, 16(SP)
9D04110C  03E00008   JR RA
9D041110  27BD0018   ADDIU SP, SP, 24
37:                  
38:                  static void map66_init(void)
39:                  {
9D041114  27BDFFE8   ADDIU SP, SP, -24
9D041118  AFBF0014   SW RA, 20(SP)
40:                     mmc_bankrom(32, 0x8000, 0);
9D04111C  24040020   ADDIU A0, ZERO, 32
9D041120  34058000   ORI A1, ZERO, -32768
9D041124  0F40CA71   JAL mmc_bankrom
9D041128  00003021   ADDU A2, ZERO, ZERO
41:                     mmc_bankvrom(8, 0x0000, 0);
9D04112C  24040008   ADDIU A0, ZERO, 8
9D041130  00002821   ADDU A1, ZERO, ZERO
9D041134  0F40CA16   JAL mmc_bankvrom
9D041138  00003021   ADDU A2, ZERO, ZERO
42:                  }
9D04113C  8FBF0014   LW RA, 20(SP)
9D041140  03E00008   JR RA
9D041144  27BD0018   ADDIU SP, SP, 24
43:                  
44:                  
45:                  static map_memwrite map66_memwrite[] =
46:                  {
47:                     { 0x8000, 0xFFFF, map66_write },
48:                     {     -1,     -1, NULL }
49:                  };
50:                  
51:                  mapintf_t map66_intf =
52:                  {
53:                     66, /* mapper number */
54:                     "GNROM", /* mapper name */
55:                     map66_init, /* init routine */
56:                     NULL, /* vblank callback */
57:                     NULL, /* hblank callback */
58:                     NULL, /* get state (snss) */
59:                     NULL, /* set state (snss) */
60:                     NULL, /* memory read structure */
61:                     map66_memwrite, /* memory write structure */
62:                     NULL /* external sound device */
63:                  };
64:                  
65:                  /*
66:                  ** $Log: map066.c,v $
67:                  ** Revision 1.2  2001/04/27 14:37:11  neil
68:                  ** wheeee
69:                  **
70:                  ** Revision 1.1  2001/04/27 12:54:40  neil
71:                  ** blah
72:                  **
73:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
74:                  ** initial
75:                  **
76:                  ** Revision 1.1  2000/10/24 12:19:33  matt
77:                  ** changed directory structure
78:                  **
79:                  ** Revision 1.5  2000/10/22 19:17:46  matt
80:                  ** mapper cleanups galore
81:                  **
82:                  ** Revision 1.4  2000/10/21 19:33:38  matt
83:                  ** many more cleanups
84:                  **
85:                  ** Revision 1.3  2000/08/16 02:50:11  matt
86:                  ** random mapper cleanups
87:                  **
88:                  ** Revision 1.2  2000/07/06 02:48:43  matt
89:                  ** clearly labelled structure members
90:                  **
91:                  ** Revision 1.1  2000/07/05 05:05:18  matt
92:                  ** initial revision
93:                  **
94:                  */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map065.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map65.c
21:                  **
22:                  ** mapper 65 interface
23:                  ** $Id: map065.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes_ppu.h>
29:                  
30:                  static struct
31:                  {
32:                     int counter;
33:                     bool enabled;
34:                     int cycles;
35:                     uint8 low, high;
36:                  } irq;
37:                  
38:                  static void map65_init(void)
39:                  {
40:                     irq.counter = 0;
9D03DA44  3C02A001   LUI V0, -24575
9D03DA48  AC4058CC   SW ZERO, 22732(V0)
41:                     irq.enabled = false;
9D03DA4C  244358CC   ADDIU V1, V0, 22732
9D03DA50  AC600004   SW ZERO, 4(V1)
42:                     irq.low = irq.high = 0;
9D03DA54  A060000D   SB ZERO, 13(V1)
9D03DA58  A060000C   SB ZERO, 12(V1)
43:                     irq.cycles = 0;
9D03DA5C  03E00008   JR RA
9D03DA60  AC600008   SW ZERO, 8(V1)
44:                  }
45:                  
46:                  /* TODO: shouldn't there be some kind of HBlank callback??? */
47:                  
48:                  /* mapper 65: Irem H-3001*/
49:                  static void map65_write(uint32 address, uint8 value)
50:                  {
9D03DA64  27BDFFE8   ADDIU SP, SP, -24
9D03DA68  AFBF0014   SW RA, 20(SP)
9D03DA6C  00A03021   ADDU A2, A1, ZERO
51:                     int range = address & 0xF000;
9D03DA70  3082F000   ANDI V0, A0, -4096
52:                     int reg = address & 7;
53:                  
54:                     switch (range)
9D03DA74  3403A000   ORI V1, ZERO, -24576
9D03DA78  10430011   BEQ V0, V1, 0x9D03DAC0
9D03DA7C  30850007   ANDI A1, A0, 7
9D03DA80  3404A001   ORI A0, ZERO, -24575
9D03DA84  0044382A   SLT A3, V0, A0
9D03DA88  10E00008   BEQ A3, ZERO, 0x9D03DAAC
9D03DA8C  340BB000   ORI T3, ZERO, -20480
9D03DA90  34088000   ORI T0, ZERO, -32768
9D03DA94  1048000A   BEQ V0, T0, 0x9D03DAC0
9D03DA98  34099000   ORI T1, ZERO, -28672
9D03DA9C  10490011   BEQ V0, T1, 0x9D03DAE4
9D03DAA0  240A0005   ADDIU T2, ZERO, 5
9D03DAAC  104B0009   BEQ V0, T3, 0x9D03DAD4
9D03DAB0  24040001   ADDIU A0, ZERO, 1
9D03DAB4  340CC000   ORI T4, ZERO, -16384
9D03DAB8  544C0029   BNEL V0, T4, 0x9D03DB60
9D03DABC  8FBF0014   LW RA, 20(SP)
55:                     {
56:                     case 0x8000:
57:                     case 0xA000:
58:                     case 0xC000:
59:                        mmc_bankrom(8, range, value);
9D03DAC0  24040008   ADDIU A0, ZERO, 8
9D03DAC4  0F40CA71   JAL mmc_bankrom
9D03DAC8  00402821   ADDU A1, V0, ZERO
60:                        break;
9D03DACC  0B40F6D8   J 0x9D03DB60
9D03DAD0  8FBF0014   LW RA, 20(SP)
61:                  
62:                     case 0xB000:
63:                        mmc_bankvrom(1, reg << 10, value);
9D03DAD4  0F40CA16   JAL mmc_bankvrom
9D03DAD8  00052A80   SLL A1, A1, 10
64:                        break;
9D03DADC  0B40F6D8   J 0x9D03DB60
9D03DAE0  8FBF0014   LW RA, 20(SP)
65:                  
66:                     case 0x9000:
67:                        switch (reg)
9D03DAE4  10AA000A   BEQ A1, T2, 0x9D03DB10
9D03DAE8  240B0006   ADDIU T3, ZERO, 6
9D03DAEC  10AB0012   BEQ A1, T3, 0x9D03DB38
9D03DAF0  240C0004   ADDIU T4, ZERO, 4
9D03DAF4  14AC001A   BNE A1, T4, 0x9D03DB60
9D03DAF8  8FBF0014   LW RA, 20(SP)
68:                        {
69:                        case 4:
70:                           irq.enabled = (value & 0x01) ? false : true;
9D03DAFC  38C60001   XORI A2, A2, 1
9D03DB00  30CD0001   ANDI T5, A2, 1
9D03DB04  3C0EA001   LUI T6, -24575
71:                           break;
9D03DB08  0B40F6D7   J 0x9D03DB5C
9D03DB0C  ADCD58D0   SW T5, 22736(T6)
72:                  
73:                        case 5:
74:                           irq.high = value;
9D03DB10  3C03A001   LUI V1, -24575
9D03DB14  246758CC   ADDIU A3, V1, 22732
9D03DB18  A0E6000D   SB A2, 13(A3)
75:                           irq.cycles = (irq.high << 8) | irq.low;
9D03DB1C  00064200   SLL T0, A2, 8
9D03DB20  90E4000C   LBU A0, 12(A3)
9D03DB24  01044825   OR T1, T0, A0
9D03DB28  ACE90008   SW T1, 8(A3)
76:                           irq.counter = (uint8)(irq.cycles / 128);
9D03DB2C  7D2A39C0   EXT T2, T1, 7, 8
77:                           break;
9D03DB30  0B40F6D7   J 0x9D03DB5C
9D03DB34  AC6A58CC   SW T2, 22732(V1)
78:                  
79:                        case 6:
80:                           irq.low = value;
9D03DB38  3C0FA001   LUI T7, -24575
9D03DB3C  25F858CC   ADDIU T8, T7, 22732
9D03DB40  A306000C   SB A2, 12(T8)
81:                           irq.cycles = (irq.high << 8) | irq.low;
9D03DB44  9319000D   LBU T9, 13(T8)
9D03DB48  0019FA00   SLL RA, T9, 8
9D03DB4C  00DF1025   OR V0, A2, RA
9D03DB50  AF020008   SW V0, 8(T8)
82:                           irq.counter = (uint8)(irq.cycles / 128);
9D03DB54  7C4539C0   EXT A1, V0, 7, 8
9D03DB58  ADE558CC   SW A1, 22732(T7)
83:                           break;
84:                  
85:                        default:
86:                           break;
87:                        }
88:                        break;
89:                  
90:                     default:
91:                        break;
92:                     }
93:                  }
9D03DAA4  0B40F6D8   J 0x9D03DB60
9D03DAA8  8FBF0014   LW RA, 20(SP)
9D03DB5C  8FBF0014   LW RA, 20(SP)
9D03DB60  03E00008   JR RA
9D03DB64  27BD0018   ADDIU SP, SP, 24
94:                  
95:                  static map_memwrite map65_memwrite[] =
96:                  {
97:                     { 0x8000, 0xFFFF, map65_write },
98:                     {     -1,     -1, NULL }
99:                  };
100:                 
101:                 mapintf_t map65_intf =
102:                 {
103:                    65, /* mapper number */
104:                    "Irem H-3001", /* mapper name */
105:                    map65_init, /* init routine */
106:                    NULL, /* vblank callback */
107:                    NULL, /* hblank callback */
108:                    NULL, /* get state (snss) */
109:                    NULL, /* set state (snss) */
110:                    NULL, /* memory read structure */
111:                    map65_memwrite, /* memory write structure */
112:                    NULL /* external sound device */
113:                 };
114:                 
115:                 /*
116:                 ** $Log: map065.c,v $
117:                 ** Revision 1.2  2001/04/27 14:37:11  neil
118:                 ** wheeee
119:                 **
120:                 ** Revision 1.1  2001/04/27 12:54:40  neil
121:                 ** blah
122:                 **
123:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
124:                 ** initial
125:                 **
126:                 ** Revision 1.1  2000/10/24 12:19:33  matt
127:                 ** changed directory structure
128:                 **
129:                 ** Revision 1.5  2000/10/22 19:17:46  matt
130:                 ** mapper cleanups galore
131:                 **
132:                 ** Revision 1.4  2000/10/21 19:33:38  matt
133:                 ** many more cleanups
134:                 **
135:                 ** Revision 1.3  2000/10/10 13:58:17  matt
136:                 ** stroustrup squeezing his way in the door
137:                 **
138:                 ** Revision 1.2  2000/07/06 02:48:43  matt
139:                 ** clearly labelled structure members
140:                 **
141:                 ** Revision 1.1  2000/07/06 01:01:56  matt
142:                 ** initial revision
143:                 **
144:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map064.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map64.c
21:                  **
22:                  ** mapper 64 interface
23:                  ** $Id: map064.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes.h>
29:                  #include <log.h>
30:                  
31:                  static struct
32:                  {
33:                     int counter, latch;
34:                     bool enabled, reset;
35:                  } irq;
36:                  
37:                  static uint8 command = 0;
38:                  static uint16 vrombase = 0x0000;
39:                  
40:                  static void map64_hblank(int vblank)
41:                  {
9D036850  27BDFFE8   ADDIU SP, SP, -24
9D036854  AFBF0014   SW RA, 20(SP)
42:                     if (vblank)
9D036848  14800019   BNE A0, ZERO, 0x9D0368B0
9D03684C  3C02A001   LUI V0, -24575
43:                        return;
44:                  
45:                     irq.reset = false;
46:                  
47:                     if (ppu_enabled())
9D036858  0F405C83   JAL ppu_enabled
9D03685C  AC405918   SW ZERO, 22808(V0)
9D036860  10400011   BEQ V0, ZERO, 0x9D0368A8
9D036864  3C03A001   LUI V1, -24575
48:                     {
49:                        if (0 == irq.counter--)
9D036868  8C65590C   LW A1, 22796(V1)
9D03686C  24A4FFFF   ADDIU A0, A1, -1
9D036870  14A0000D   BNE A1, ZERO, 0x9D0368A8
9D036874  AC64590C   SW A0, 22796(V1)
50:                        {
51:                           irq.counter = irq.latch;
9D036878  2466590C   ADDIU A2, V1, 22796
9D03687C  8CC70004   LW A3, 4(A2)
9D036880  AC67590C   SW A3, 22796(V1)
52:                         
53:                           if (true == irq.enabled)
9D036884  8CC80008   LW T0, 8(A2)
9D036888  24090001   ADDIU T1, ZERO, 1
9D03688C  15090004   BNE T0, T1, 0x9D0368A0
9D036890  240A0001   ADDIU T2, ZERO, 1
54:                              nes_irq();
9D036894  0F40975F   JAL nes_irq
9D036898  00000000   NOP
55:                  
56:                           irq.reset = true;
9D03689C  240A0001   ADDIU T2, ZERO, 1
9D0368A0  3C0BA001   LUI T3, -24575
9D0368A4  AD6A5918   SW T2, 22808(T3)
57:                        }
58:                     }
59:                  }
9D0368A8  8FBF0014   LW RA, 20(SP)
9D0368AC  27BD0018   ADDIU SP, SP, 24
9D0368B0  03E00008   JR RA
9D0368B4  00000000   NOP
60:                  
61:                  /* mapper 64: Tengen RAMBO-1 */
62:                  static void map64_write(uint32 address, uint8 value)
63:                  {
9D036540  27BDFFE8   ADDIU SP, SP, -24
9D036544  AFBF0014   SW RA, 20(SP)
9D036548  AFB00010   SW S0, 16(SP)
64:                     switch (address & 0xE001)
9D03654C  3084E001   ANDI A0, A0, -8191
9D036550  3402C000   ORI V0, ZERO, -16384
9D036554  108200A3   BEQ A0, V0, 0x9D0367E4
9D036558  00A08021   ADDU S0, A1, ZERO
9D03655C  3403C001   ORI V1, ZERO, -16383
9D036560  0083282B   SLTU A1, A0, V1
9D036564  50A0000A   BEQL A1, ZERO, 0x9D036590
9D036568  3410E000   ORI S0, ZERO, -8192
9D03656C  34068001   ORI A2, ZERO, -32767
9D036570  10860014   BEQ A0, A2, 0x9D0365C4
9D036574  3407A000   ORI A3, ZERO, -24576
9D036578  1087008B   BEQ A0, A3, 0x9D0367A8
9D03657C  34088000   ORI T0, ZERO, -32768
9D036580  148800A5   BNE A0, T0, 0x9D036818
9D036584  3C0DA001   LUI T5, -24575
9D036590  1090009A   BEQ A0, S0, 0x9D0367FC
9D036594  3403E001   ORI V1, ZERO, -8191
9D036598  1083009B   BEQ A0, V1, 0x9D036808
9D03659C  3407C001   ORI A3, ZERO, -16383
9D0365A0  1487009D   BNE A0, A3, 0x9D036818
9D0365A4  3C0DA001   LUI T5, -24575
65:                     {
66:                     case 0x8000:
67:                        command = value;
9D036588  0B40D96C   J 0x9D0365B0
9D03658C  A390817A   SB S0, -32390(GP)
68:                        vrombase = (value & 0x80) ? 0x1000 : 0x0000;
9D0365B0  001049C2   SRL T1, S0, 7
9D0365B4  240A1000   ADDIU T2, ZERO, 4096
9D0365B8  0009500A   MOVZ T2, ZERO, T1
69:                        break;
9D0365BC  0B40DA05   J 0x9D036814
9D0365C0  A78A8178   SH T2, -32392(GP)
70:                  
71:                     case 0x8001:
72:                        switch (command & 0xF)
9D0365C4  938D817A   LBU T5, -32390(GP)
9D0365C8  31AE000F   ANDI T6, T5, 15
9D0365CC  000E7880   SLL T7, T6, 2
9D0365D0  3C189D03   LUI T8, -25341
9D0365D4  271965E8   ADDIU T9, T8, 26088
9D0365D8  032FF821   ADDU RA, T9, T7
9D0365DC  8FE40000   LW A0, 0(RA)
9D0365E0  00800008   JR A0
9D0365E4  00000000   NOP
73:                        {
74:                        case 0:
75:                           mmc_bankvrom(1, 0x0000 ^ vrombase, value);
9D036628  24040001   ADDIU A0, ZERO, 1
9D03662C  97858178   LHU A1, -32392(GP)
9D036630  0F40CA16   JAL mmc_bankvrom
9D036634  02003021   ADDU A2, S0, ZERO
76:                           mmc_bankvrom(1, 0x0400 ^ vrombase, value);
9D036638  97868178   LHU A2, -32392(GP)
9D03663C  24040001   ADDIU A0, ZERO, 1
9D036640  38C50400   XORI A1, A2, 1024
9D036644  0F40CA16   JAL mmc_bankvrom
9D036648  02003021   ADDU A2, S0, ZERO
77:                           break;
9D03664C  0B40DA06   J 0x9D036818
9D036650  3C0DA001   LUI T5, -24575
78:                  
79:                        case 1:
80:                           mmc_bankvrom(1, 0x0800 ^ vrombase, value);
9D036654  97828178   LHU V0, -32392(GP)
9D036658  24040001   ADDIU A0, ZERO, 1
9D03665C  38450800   XORI A1, V0, 2048
9D036660  0F40CA16   JAL mmc_bankvrom
9D036664  02003021   ADDU A2, S0, ZERO
81:                           mmc_bankvrom(1, 0x0C00 ^ vrombase, value);
9D036668  97858178   LHU A1, -32392(GP)
9D03666C  24040001   ADDIU A0, ZERO, 1
9D036670  38A50C00   XORI A1, A1, 3072
9D036674  0F40CA16   JAL mmc_bankvrom
9D036678  02003021   ADDU A2, S0, ZERO
82:                           break;
9D03667C  0B40DA06   J 0x9D036818
9D036680  3C0DA001   LUI T5, -24575
83:                  
84:                        case 2:
85:                           mmc_bankvrom(1, 0x1000 ^ vrombase, value);
9D036684  979F8178   LHU RA, -32392(GP)
9D036688  24040001   ADDIU A0, ZERO, 1
9D03668C  3BE51000   XORI A1, RA, 4096
9D036690  0F40CA16   JAL mmc_bankvrom
9D036694  02003021   ADDU A2, S0, ZERO
86:                           break;
9D036698  0B40DA06   J 0x9D036818
9D03669C  3C0DA001   LUI T5, -24575
87:                  
88:                        case 3:
89:                           mmc_bankvrom(1, 0x1400 ^ vrombase, value);
9D0366A0  97998178   LHU T9, -32392(GP)
9D0366A4  24040001   ADDIU A0, ZERO, 1
9D0366A8  3B251400   XORI A1, T9, 5120
9D0366AC  0F40CA16   JAL mmc_bankvrom
9D0366B0  02003021   ADDU A2, S0, ZERO
90:                           break;
9D0366B4  0B40DA06   J 0x9D036818
9D0366B8  3C0DA001   LUI T5, -24575
91:                  
92:                        case 4:
93:                           mmc_bankvrom(1, 0x1800 ^ vrombase, value);
9D0366BC  97988178   LHU T8, -32392(GP)
9D0366C0  24040001   ADDIU A0, ZERO, 1
9D0366C4  3B051800   XORI A1, T8, 6144
9D0366C8  0F40CA16   JAL mmc_bankvrom
9D0366CC  02003021   ADDU A2, S0, ZERO
94:                           break;
9D0366D0  0B40DA06   J 0x9D036818
9D0366D4  3C0DA001   LUI T5, -24575
95:                  
96:                        case 5:
97:                           mmc_bankvrom(1, 0x1C00 ^ vrombase, value);
9D0366D8  978F8178   LHU T7, -32392(GP)
9D0366DC  24040001   ADDIU A0, ZERO, 1
9D0366E0  39E51C00   XORI A1, T7, 7168
9D0366E4  0F40CA16   JAL mmc_bankvrom
9D0366E8  02003021   ADDU A2, S0, ZERO
98:                           break;
9D0366EC  0B40DA06   J 0x9D036818
9D0366F0  3C0DA001   LUI T5, -24575
99:                  
100:                       case 6:
101:                          mmc_bankrom(8, (command & 0x40) ? 0xA000 : 0x8000, value);
9D0366F4  31AB0040   ANDI T3, T5, 64
9D0366F8  316C00FF   ANDI T4, T3, 255
9D0366FC  24040008   ADDIU A0, ZERO, 8
9D036700  340DA000   ORI T5, ZERO, -24576
9D036704  340E8000   ORI T6, ZERO, -32768
9D036708  01CC680A   MOVZ T5, T6, T4
9D03670C  01A02821   ADDU A1, T5, ZERO
9D036710  0F40CA71   JAL mmc_bankrom
9D036714  02003021   ADDU A2, S0, ZERO
102:                          break;
9D036718  0B40DA06   J 0x9D036818
9D03671C  3C0DA001   LUI T5, -24575
103:                 
104:                       case 7:
105:                          mmc_bankrom(8, (command & 0x40) ? 0xC000 : 0xA000, value);
9D036720  31A70040   ANDI A3, T5, 64
9D036724  30E800FF   ANDI T0, A3, 255
9D036728  24040008   ADDIU A0, ZERO, 8
9D03672C  3409C000   ORI T1, ZERO, -16384
9D036730  340AA000   ORI T2, ZERO, -24576
9D036734  0148480A   MOVZ T1, T2, T0
9D036738  01202821   ADDU A1, T1, ZERO
9D03673C  0F40CA71   JAL mmc_bankrom
9D036740  02003021   ADDU A2, S0, ZERO
106:                          break;
9D036744  0B40DA06   J 0x9D036818
9D036748  3C0DA001   LUI T5, -24575
107:                 
108:                       case 8:
109:                          mmc_bankvrom(1, 0x0400, value);
9D03674C  24040001   ADDIU A0, ZERO, 1
9D036750  24050400   ADDIU A1, ZERO, 1024
9D036754  0F40CA16   JAL mmc_bankvrom
9D036758  02003021   ADDU A2, S0, ZERO
110:                          break;
9D03675C  0B40DA06   J 0x9D036818
9D036760  3C0DA001   LUI T5, -24575
111:                 
112:                       case 9:
113:                          mmc_bankvrom(1, 0x0C00, value);
9D036764  24040001   ADDIU A0, ZERO, 1
9D036768  24050C00   ADDIU A1, ZERO, 3072
9D03676C  0F40CA16   JAL mmc_bankvrom
9D036770  02003021   ADDU A2, S0, ZERO
114:                          break;
9D036774  0B40DA06   J 0x9D036818
9D036778  3C0DA001   LUI T5, -24575
115:                 
116:                       case 15:
117:                          mmc_bankrom(8, (command & 0x40) ? 0x8000 : 0xC000, value);
9D03677C  31A20040   ANDI V0, T5, 64
9D036780  304500FF   ANDI A1, V0, 255
9D036784  24040008   ADDIU A0, ZERO, 8
9D036788  34068000   ORI A2, ZERO, -32768
9D03678C  3403C000   ORI V1, ZERO, -16384
9D036790  0065300A   MOVZ A2, V1, A1
9D036794  00C02821   ADDU A1, A2, ZERO
9D036798  0F40CA71   JAL mmc_bankrom
9D03679C  02003021   ADDU A2, S0, ZERO
118:                          break;
9D0367A0  0B40DA06   J 0x9D036818
9D0367A4  3C0DA001   LUI T5, -24575
119:                 
120:                       default:
121:                 #ifdef NOFRENDO_DEBUG
122:                          log_printf("mapper 64: unknown command #%d", command & 0xF);
123:                 #endif
124:                          break;
125:                       }
126:                       break;
127:                    
128:                    case 0xA000:
129:                       if (value & 1)
9D0367A8  320C0001   ANDI T4, S0, 1
9D0367AC  11800007   BEQ T4, ZERO, 0x9D0367CC
9D0367B0  00002021   ADDU A0, ZERO, ZERO
130:                          ppu_mirror(0, 0, 1, 1);
9D0367B4  00002821   ADDU A1, ZERO, ZERO
9D0367B8  24060001   ADDIU A2, ZERO, 1
9D0367BC  0F4058FD   JAL ppu_mirror
9D0367C0  24070001   ADDIU A3, ZERO, 1
9D0367C4  0B40DA06   J 0x9D036818
9D0367C8  3C0DA001   LUI T5, -24575
131:                       else
132:                          ppu_mirror(0, 1, 0, 1);
9D0367CC  24050001   ADDIU A1, ZERO, 1
9D0367D0  00003021   ADDU A2, ZERO, ZERO
9D0367D4  0F4058FD   JAL ppu_mirror
9D0367D8  24070001   ADDIU A3, ZERO, 1
133:                       break;
134:                    
135:                    case 0xC000:
136:                       //irq.counter = value;
137:                       irq.latch = value;
9D0367E4  3C0CA001   LUI T4, -24575
138:                       break;
9D0367E8  0B40DA05   J 0x9D036814
9D0367EC  AD855910   SW A1, 22800(T4)
139:                    
140:                    case 0xC001:
141:                       //irq.latch = value;
142:                       irq.reset = true;
9D0365A8  0B40D9FC   J 0x9D0367F0
9D0365AC  24040001   ADDIU A0, ZERO, 1
9D0367F0  3C08A001   LUI T0, -24575
9D0367F4  0B40DA0A   J 0x9D036828
9D0367F8  AD045918   SW A0, 22808(T0)
143:                       break;
144:                    
145:                    case 0xE000:
146:                       //irq.counter = irq.latch;
147:                       irq.enabled = false;
9D0367FC  3C0BA001   LUI T3, -24575
148:                       break;
9D036800  0B40DA05   J 0x9D036814
9D036804  AD605914   SW ZERO, 22804(T3)
149:                    
150:                    case 0xE001:
151:                       irq.enabled = true;
9D036808  24090001   ADDIU T1, ZERO, 1
9D03680C  3C0AA001   LUI T2, -24575
9D036810  AD495914   SW T1, 22804(T2)
152:                       break;
153:                    
154:                    default:
155:                 #ifdef NOFRENDO_DEBUG
156:                       log_printf("mapper 64: Wrote $%02X to $%04X", value, address);
157:                 #endif
158:                       break;
159:                    }
160:                 
161:                    if (true == irq.reset)
9D0367DC  0B40DA06   J 0x9D036818
9D0367E0  3C0DA001   LUI T5, -24575
9D036814  3C0DA001   LUI T5, -24575
9D036818  8DAE5918   LW T6, 22808(T5)
9D03681C  240F0001   ADDIU T7, ZERO, 1
9D036820  15CF0006   BNE T6, T7, 0x9D03683C
9D036824  8FBF0014   LW RA, 20(SP)
162:                       irq.counter = irq.latch;
9D036828  3C18A001   LUI T8, -24575
9D03682C  2719590C   ADDIU T9, T8, 22796
9D036830  8F3F0004   LW RA, 4(T9)
9D036834  AF1F590C   SW RA, 22796(T8)
163:                 }
9D036838  8FBF0014   LW RA, 20(SP)
9D03683C  8FB00010   LW S0, 16(SP)
9D036840  03E00008   JR RA
9D036844  27BD0018   ADDIU SP, SP, 24
164:                 
165:                 static void map64_init(void)
166:                 {
9D0364D4  27BDFFE8   ADDIU SP, SP, -24
9D0364D8  AFBF0014   SW RA, 20(SP)
167:                    mmc_bankrom(8, 0x8000, MMC_LASTBANK);
9D0364DC  24040008   ADDIU A0, ZERO, 8
9D0364E0  34058000   ORI A1, ZERO, -32768
9D0364E4  0F40CA71   JAL mmc_bankrom
9D0364E8  2406FFFF   ADDIU A2, ZERO, -1
168:                    mmc_bankrom(8, 0xA000, MMC_LASTBANK);
9D0364EC  24040008   ADDIU A0, ZERO, 8
9D0364F0  3405A000   ORI A1, ZERO, -24576
9D0364F4  0F40CA71   JAL mmc_bankrom
9D0364F8  2406FFFF   ADDIU A2, ZERO, -1
169:                    mmc_bankrom(8, 0xC000, MMC_LASTBANK);
9D0364FC  24040008   ADDIU A0, ZERO, 8
9D036500  3405C000   ORI A1, ZERO, -16384
9D036504  0F40CA71   JAL mmc_bankrom
9D036508  2406FFFF   ADDIU A2, ZERO, -1
170:                    mmc_bankrom(8, 0xE000, MMC_LASTBANK);
9D03650C  24040008   ADDIU A0, ZERO, 8
9D036510  3405E000   ORI A1, ZERO, -8192
9D036514  0F40CA71   JAL mmc_bankrom
9D036518  2406FFFF   ADDIU A2, ZERO, -1
171:                 
172:                    irq.counter = irq.latch = 0;
9D03651C  3C03A001   LUI V1, -24575
9D036520  2462590C   ADDIU V0, V1, 22796
9D036524  AC400004   SW ZERO, 4(V0)
9D036528  AC60590C   SW ZERO, 22796(V1)
173:                    irq.reset = irq.enabled = false;
9D03652C  AC400008   SW ZERO, 8(V0)
9D036530  AC40000C   SW ZERO, 12(V0)
174:                 }
9D036534  8FBF0014   LW RA, 20(SP)
9D036538  03E00008   JR RA
9D03653C  27BD0018   ADDIU SP, SP, 24
175:                 
176:                 static map_memwrite map64_memwrite[] =
177:                 {
178:                    { 0x8000, 0xFFFF, map64_write },
179:                    {     -1,     -1, NULL }
180:                 };
181:                 
182:                 mapintf_t map64_intf =
183:                 {
184:                    64, /* mapper number */
185:                    "Tengen RAMBO-1", /* mapper name */
186:                    map64_init, /* init routine */
187:                    NULL, /* vblank callback */
188:                    map64_hblank, /* hblank callback */
189:                    NULL, /* get state (snss) */
190:                    NULL, /* set state (snss) */
191:                    NULL, /* memory read structure */
192:                    map64_memwrite, /* memory write structure */
193:                    NULL /* external sound device */
194:                 };
195:                 
196:                 /*
197:                 ** $Log: map064.c,v $
198:                 ** Revision 1.2  2001/04/27 14:37:11  neil
199:                 ** wheeee
200:                 **
201:                 ** Revision 1.1  2001/04/27 12:54:40  neil
202:                 ** blah
203:                 **
204:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
205:                 ** initial
206:                 **
207:                 ** Revision 1.1  2000/10/24 12:19:33  matt
208:                 ** changed directory structure
209:                 **
210:                 ** Revision 1.8  2000/10/22 19:17:46  matt
211:                 ** mapper cleanups galore
212:                 **
213:                 ** Revision 1.7  2000/10/22 15:03:13  matt
214:                 ** simplified mirroring
215:                 **
216:                 ** Revision 1.6  2000/10/21 19:33:38  matt
217:                 ** many more cleanups
218:                 **
219:                 ** Revision 1.5  2000/10/10 13:58:17  matt
220:                 ** stroustrup squeezing his way in the door
221:                 **
222:                 ** Revision 1.4  2000/07/10 13:51:25  matt
223:                 ** using generic nes_irq() routine now
224:                 **
225:                 ** Revision 1.3  2000/07/10 05:29:03  matt
226:                 ** cleaned up some mirroring issues
227:                 **
228:                 ** Revision 1.2  2000/07/06 02:48:43  matt
229:                 ** clearly labelled structure members
230:                 **
231:                 ** Revision 1.1  2000/07/05 05:05:18  matt
232:                 ** initial revision
233:                 **
234:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map050.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map050.c
21:                  **
22:                  ** Mapper #50 (SMB2j - 3rd discovered variation)
23:                  ** Implementation by Firebug
24:                  ** Mapper information courtesy of Kevin Horton
25:                  ** $Id: map050.c,v 1.2 2001/04/27 14:37:11 neil Exp $
26:                  **
27:                  */
28:                  
29:                  #include <noftypes.h>
30:                  #include <nes_mmc.h>
31:                  #include <nes.h>
32:                  #include <libsnss.h>
33:                  #include <log.h>
34:                  
35:                  static struct
36:                  {
37:                    bool enabled;
38:                    uint32 counter;
39:                  } irq;
40:                  
41:                  /********************************/
42:                  /* Mapper #50 IRQ reset routine */
43:                  /********************************/
44:                  static void map50_irq_reset (void)
45:                  {
46:                    /* Turn off IRQs */
47:                    irq.enabled = false;
9D03D344  AF808108   SW ZERO, -32504(GP)
9D03D3D0  AF808108   SW ZERO, -32504(GP)
9D03D42C  AF808108   SW ZERO, -32504(GP)
48:                    irq.counter = 0x0000;
9D03D348  0B40F4E4   J .LVL10
9D03D34C  AF80810C   SW ZERO, -32500(GP)
9D03D3D4  AF80810C   SW ZERO, -32500(GP)
9D03D430  AF80810C   SW ZERO, -32500(GP)
49:                  
50:                    /* Done */
51:                    return;
52:                  }
53:                  
54:                  /**************************************************************/
55:                  /* Mapper #50: 3rd discovered variation of SMB2j cart bootleg */
56:                  /**************************************************************/
57:                  static void map50_init (void)
58:                  {
9D03D3E4  27BDFFE8   ADDIU SP, SP, -24
9D03D3E8  AFBF0014   SW RA, 20(SP)
59:                    /* Set the hardwired pages */
60:                    mmc_bankrom (8, 0x6000, 0x0F);
9D03D3EC  24040008   ADDIU A0, ZERO, 8
9D03D3F0  24056000   ADDIU A1, ZERO, 24576
9D03D3F4  0F40CA71   JAL mmc_bankrom
9D03D3F8  2406000F   ADDIU A2, ZERO, 15
61:                    mmc_bankrom (8, 0x8000, 0x08);
9D03D3FC  24040008   ADDIU A0, ZERO, 8
9D03D400  34058000   ORI A1, ZERO, -32768
9D03D404  0F40CA71   JAL mmc_bankrom
9D03D408  24060008   ADDIU A2, ZERO, 8
62:                    mmc_bankrom (8, 0xA000, 0x09);
9D03D40C  24040008   ADDIU A0, ZERO, 8
9D03D410  3405A000   ORI A1, ZERO, -24576
9D03D414  0F40CA71   JAL mmc_bankrom
9D03D418  24060009   ADDIU A2, ZERO, 9
63:                    mmc_bankrom (8, 0xE000, 0x0B);
9D03D41C  24040008   ADDIU A0, ZERO, 8
9D03D420  3405E000   ORI A1, ZERO, -8192
9D03D424  0F40CA71   JAL mmc_bankrom
9D03D428  2406000B   ADDIU A2, ZERO, 11
64:                  
65:                    /* Reset the IRQ counter */
66:                    map50_irq_reset ();
67:                  
68:                    /* Done */
69:                    return;
70:                  }
9D03D434  8FBF0014   LW RA, 20(SP)
9D03D438  03E00008   JR RA
9D03D43C  27BD0018   ADDIU SP, SP, 24
71:                  
72:                  /****************************************/
73:                  /* Mapper #50 callback for IRQ handling */
74:                  /****************************************/
75:                  static void map50_hblank (int vblank)
76:                  {
9D03D3A0  27BDFFE8   ADDIU SP, SP, -24
9D03D3A4  AFBF0014   SW RA, 20(SP)
77:                     /* Counter is M2 based so it doesn't matter whether */
78:                     /* the PPU is in its VBlank period or not           */
79:                     UNUSED(vblank);
80:                  
81:                     /* Increment the counter if it is enabled and check for strike */
82:                     if (irq.enabled)
9D03D3A8  8F828108   LW V0, -32504(GP)
9D03D3AC  1040000A   BEQ V0, ZERO, .LBE8
9D03D3B0  2783810C   ADDIU V1, GP, -32500
83:                     {
84:                       /* Is there a constant for cycles per scanline? */
85:                       /* If so, someone ought to substitute it here   */
86:                       irq.counter = irq.counter + 114;
9D03D3B4  8C640000   LW A0, 0(V1)
9D03D3B8  24850072   ADDIU A1, A0, 114
87:                  
88:                       /* IRQ line is hooked to Q12 of the counter */
89:                       if (irq.counter & 0x1000)
9D03D3BC  30A61000   ANDI A2, A1, 4096
9D03D3C0  10C00005   BEQ A2, ZERO, .LBE8
9D03D3C4  AC650000   SW A1, 0(V1)
90:                       {
91:                         /* Trigger the IRQ */
92:                         nes_irq ();
9D03D3C8  0F40975F   JAL nes_irq
9D03D3CC  00000000   NOP
93:                  
94:                         /* Reset the counter */
95:                         map50_irq_reset ();
96:                       }
97:                     }
98:                  }
9D03D3D8  8FBF0014   LW RA, 20(SP)
9D03D3DC  03E00008   JR RA
9D03D3E0  27BD0018   ADDIU SP, SP, 24
99:                  
100:                 /******************************************/
101:                 /* Mapper #50 write handler ($4000-$5FFF) */
102:                 /******************************************/
103:                 static void map50_write (uint32 address, uint8 value)
104:                 {
9D03D324  27BDFFE8   ADDIU SP, SP, -24
105:                   uint8 selectable_bank;
106:                 
107:                   /* For address to be decoded, A5 must be high and A6 low */
108:                   if ((address & 0x60) != 0x20) return;
9D03D314  30830060   ANDI V1, A0, 96
9D03D318  24020020   ADDIU V0, ZERO, 32
9D03D31C  1462001E   BNE V1, V0, 0x9D03D398
9D03D320  30840100   ANDI A0, A0, 256
109:                 
110:                   /* A8 low  = $C000-$DFFF page selection */
111:                   /* A8 high = IRQ timer toggle */
112:                   if (address & 0x100)
9D03D328  10800009   BEQ A0, ZERO, 0x9D03D350
9D03D32C  AFBF0014   SW RA, 20(SP)
113:                   {
114:                     /* IRQ settings */
115:                     if (value & 0x01) irq.enabled = true;
9D03D330  30AD0001   ANDI T5, A1, 1
9D03D334  11A00003   BEQ T5, ZERO, .LBB4
9D03D338  240E0001   ADDIU T6, ZERO, 1
9D03D33C  0B40F4E4   J .LVL10
9D03D340  AF8E8108   SW T6, -32504(GP)
116:                     else              map50_irq_reset ();
117:                   }
118:                   else
119:                   {
120:                     /* Stupid data line swapping */
121:                     selectable_bank = 0x00;
122:                     if (value & 0x08) selectable_bank |= 0x08;
123:                     if (value & 0x04) selectable_bank |= 0x02;
9D03D350  30A70004   ANDI A3, A1, 4
9D03D354  30E800FF   ANDI T0, A3, 255
9D03D358  11000003   BEQ T0, ZERO, 0x9D03D368
9D03D35C  30A60008   ANDI A2, A1, 8
9D03D360  34C60002   ORI A2, A2, 2
9D03D364  30C600FF   ANDI A2, A2, 255
124:                     if (value & 0x02) selectable_bank |= 0x01;
9D03D368  30A90002   ANDI T1, A1, 2
9D03D36C  312A00FF   ANDI T2, T1, 255
9D03D370  34CB0001   ORI T3, A2, 1
9D03D374  016A300B   MOVN A2, T3, T2
125:                     if (value & 0x01) selectable_bank |= 0x04;
9D03D378  30A50001   ANDI A1, A1, 1
9D03D37C  34CC0004   ORI T4, A2, 4
9D03D380  0185300B   MOVN A2, T4, A1
126:                     mmc_bankrom (8, 0xC000, selectable_bank);
9D03D384  24040008   ADDIU A0, ZERO, 8
9D03D388  0F40CA71   JAL mmc_bankrom
9D03D38C  3405C000   ORI A1, ZERO, -16384
127:                   }
128:                 
129:                   /* Done */
130:                   return;
131:                 }
9D03D390  8FBF0014   LW RA, 20(SP)
9D03D394  27BD0018   ADDIU SP, SP, 24
9D03D398  03E00008   JR RA
9D03D39C  00000000   NOP
132:                 
133:                 /****************************************************/
134:                 /* Shove extra mapper information into a SNSS block */
135:                 /****************************************************/
136:                 static void map50_setstate (SnssMapperBlock *state)
137:                 {
9D03D304  03E00008   JR RA
9D03D308  00000000   NOP
138:                   /* TODO: Store SNSS information */
139:                   UNUSED (state);
140:                 
141:                   /* Done */
142:                   return;
143:                 }
144:                 
145:                 /*****************************************************/
146:                 /* Pull extra mapper information out of a SNSS block */
147:                 /*****************************************************/
148:                 static void map50_getstate (SnssMapperBlock *state)
149:                 {
9D03D30C  03E00008   JR RA
9D03D310  00000000   NOP
150:                   /* TODO: Retrieve SNSS information */
151:                   UNUSED (state);
152:                 
153:                   /* Done */
154:                   return;
155:                 }
156:                 
157:                 static map_memwrite map50_memwrite [] =
158:                 {
159:                    { 0x4000, 0x5FFF, map50_write },
160:                    {     -1,     -1, NULL }
161:                 };
162:                 
163:                 mapintf_t map50_intf =
164:                 {
165:                    50,                               /* Mapper number */
166:                    "SMB2j (3rd discovered variant)", /* Mapper name */
167:                    map50_init,                       /* Initialization routine */
168:                    NULL,                             /* VBlank callback */
169:                    map50_hblank,                     /* HBlank callback */
170:                    map50_getstate,                   /* Get state (SNSS) */
171:                    map50_setstate,                   /* Set state (SNSS) */
172:                    NULL,                             /* Memory read structure */
173:                    map50_memwrite,                   /* Memory write structure */
174:                    NULL                              /* External sound device */
175:                 };
176:                 
177:                 /*
178:                 ** $Log: map050.c,v $
179:                 ** Revision 1.2  2001/04/27 14:37:11  neil
180:                 ** wheeee
181:                 **
182:                 ** Revision 1.1  2001/04/27 12:54:40  neil
183:                 ** blah
184:                 **
185:                 ** Revision 1.1  2001/04/27 10:57:41  neil
186:                 ** wheee
187:                 **
188:                 ** Revision 1.1  2000/12/27 19:22:13  firebug
189:                 ** initial revision
190:                 **
191:                 **
192:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map046.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map046.c
21:                  **
22:                  ** Mapper #46 (Pelican Game Station)
23:                  ** Implementation by Firebug
24:                  ** Mapper information courtesy of Kevin Horton
25:                  ** $Id: map046.c,v 1.2 2001/04/27 14:37:11 neil Exp $
26:                  **
27:                  */
28:                  
29:                  #include <noftypes.h>
30:                  #include <nes_mmc.h>
31:                  #include <nes.h>
32:                  #include <libsnss.h>
33:                  #include <log.h>
34:                  
35:                  static uint8 prg_low_bank;
36:                  static uint8 chr_low_bank;
37:                  static uint8 prg_high_bank;
38:                  static uint8 chr_high_bank;
39:                  
40:                  /*************************************************/
41:                  /* Set banks from the combined register values   */
42:                  /*************************************************/
43:                  static void map46_set_banks (void)
44:                  {
9D03FA68  27BDFFE8   ADDIU SP, SP, -24
9D03FA6C  AFBF0014   SW RA, 20(SP)
45:                    /* Set the PRG and CHR pages */
46:                    mmc_bankrom (32, 0x8000, (prg_high_bank << 1) | (prg_low_bank));
9D03FA70  93868161   LBU A2, -32415(GP)
9D03FA74  00061840   SLL V1, A2, 1
9D03FA78  93828163   LBU V0, -32413(GP)
9D03FA7C  24040020   ADDIU A0, ZERO, 32
9D03FA80  34058000   ORI A1, ZERO, -32768
9D03FA84  0F40CA71   JAL mmc_bankrom
9D03FA88  00623025   OR A2, V1, V0
47:                    mmc_bankvrom (8, 0x0000, (chr_high_bank << 3) | (chr_low_bank));
9D03FA8C  93848160   LBU A0, -32416(GP)
9D03FA90  000438C0   SLL A3, A0, 3
9D03FA94  93888162   LBU T0, -32414(GP)
9D03FA98  24040008   ADDIU A0, ZERO, 8
9D03FA9C  00002821   ADDU A1, ZERO, ZERO
9D03FAA0  0F40CA16   JAL mmc_bankvrom
9D03FAA4  00E83025   OR A2, A3, T0
48:                  
49:                    /* Done */
50:                    return;
51:                  }
9D03FAA8  8FBF0014   LW RA, 20(SP)
9D03FAAC  03E00008   JR RA
9D03FAB0  27BD0018   ADDIU SP, SP, 24
52:                  
53:                  /*********************************************************/
54:                  /* Mapper #46: Pelican Game Station (aka Rumble Station) */
55:                  /*********************************************************/
56:                  static void map46_init (void)
57:                  {
9D03FB00  27BDFFE8   ADDIU SP, SP, -24
9D03FB04  AFBF0014   SW RA, 20(SP)
58:                    /* High bank switch register is set to zero on reset */
59:                    prg_high_bank = 0x00;
9D03FB08  A3808161   SB ZERO, -32415(GP)
60:                    chr_high_bank = 0x00;
61:                    map46_set_banks ();
9D03FB0C  0F40FE9A   JAL .LFB0, map46_set_banks, .LFE4
9D03FB10  A3808160   SB ZERO, -32416(GP)
62:                  
63:                    /* Done */
64:                    return;
65:                  }
9D03FB14  8FBF0014   LW RA, 20(SP)
9D03FB18  03E00008   JR RA
9D03FB1C  27BD0018   ADDIU SP, SP, 24
66:                  
67:                  /******************************************/
68:                  /* Mapper #46 write handler ($6000-$FFFF) */
69:                  /******************************************/
70:                  static void map46_write (uint32 address, uint8 value)
71:                  {
9D03FAB4  27BDFFE8   ADDIU SP, SP, -24
72:                    /* $8000-$FFFF: D6-D4 = lower three bits of CHR bank */
73:                    /*              D0    = low bit of PRG bank          */
74:                    /* $6000-$7FFF: D7-D4 = high four bits of CHR bank   */
75:                    /*              D3-D0 = high four bits of PRG bank   */
76:                    if (address & 0x8000)
9D03FAB8  30848000   ANDI A0, A0, -32768
9D03FABC  10800008   BEQ A0, ZERO, 0x9D03FAE0
9D03FAC0  AFBF0014   SW RA, 20(SP)
77:                    {
78:                      prg_low_bank = value & 0x01;
9D03FAC4  30A30001   ANDI V1, A1, 1
9D03FAC8  A3838163   SB V1, -32413(GP)
79:                      chr_low_bank = (value >> 4) & 0x07;
9D03FACC  7CA61100   EXT A2, A1, 4, 3
80:                      map46_set_banks ();
9D03FAD0  0F40FE9A   JAL .LFB0, map46_set_banks, .LFE4
9D03FAD4  A3868162   SB A2, -32414(GP)
9D03FAD8  0B40FEBE   J 0x9D03FAF8
9D03FADC  8FBF0014   LW RA, 20(SP)
81:                    }
82:                    else
83:                    {
84:                      prg_high_bank = value & 0x0F;
9D03FAE0  30A2000F   ANDI V0, A1, 15
9D03FAE4  A3828161   SB V0, -32415(GP)
85:                      chr_high_bank = (value >> 4) & 0x0F;
9D03FAE8  00052902   SRL A1, A1, 4
86:                      map46_set_banks ();
9D03FAEC  0F40FE9A   JAL .LFB0, map46_set_banks, .LFE4
9D03FAF0  A3858160   SB A1, -32416(GP)
87:                    }
88:                  
89:                    /* Done */
90:                    return;
91:                  }
9D03FAF4  8FBF0014   LW RA, 20(SP)
9D03FAF8  03E00008   JR RA
9D03FAFC  27BD0018   ADDIU SP, SP, 24
92:                  
93:                  /****************************************************/
94:                  /* Shove extra mapper information into a SNSS block */
95:                  /****************************************************/
96:                  static void map46_setstate (SnssMapperBlock *state)
97:                  {
9D03FA58  03E00008   JR RA
9D03FA5C  00000000   NOP
98:                    /* TODO: Store SNSS information */
99:                    UNUSED (state);
100:                 
101:                   /* Done */
102:                   return;
103:                 }
104:                 
105:                 /*****************************************************/
106:                 /* Pull extra mapper information out of a SNSS block */
107:                 /*****************************************************/
108:                 static void map46_getstate (SnssMapperBlock *state)
109:                 {
9D03FA60  03E00008   JR RA
9D03FA64  00000000   NOP
110:                   /* TODO: Retrieve SNSS information */
111:                   UNUSED (state);
112:                 
113:                   /* Done */
114:                   return;
115:                 }
116:                 
117:                 static map_memwrite map46_memwrite [] =
118:                 {
119:                    { 0x6000, 0xFFFF, map46_write },
120:                    {     -1,     -1, NULL }
121:                 };
122:                 
123:                 mapintf_t map46_intf =
124:                 {
125:                    46,                               /* Mapper number */
126:                    "Pelican Game Station",           /* Mapper name */
127:                    map46_init,                       /* Initialization routine */
128:                    NULL,                             /* VBlank callback */
129:                    NULL,                             /* HBlank callback */
130:                    map46_getstate,                   /* Get state (SNSS) */
131:                    map46_setstate,                   /* Set state (SNSS) */
132:                    NULL,                             /* Memory read structure */
133:                    map46_memwrite,                   /* Memory write structure */
134:                    NULL                              /* External sound device */
135:                 };
136:                 
137:                 /*
138:                 ** $Log: map046.c,v $
139:                 ** Revision 1.2  2001/04/27 14:37:11  neil
140:                 ** wheeee
141:                 **
142:                 ** Revision 1.1  2001/04/27 12:54:40  neil
143:                 ** blah
144:                 **
145:                 ** Revision 1.1  2001/04/27 10:57:41  neil
146:                 ** wheee
147:                 **
148:                 ** Revision 1.1  2000/12/27 19:23:05  firebug
149:                 ** initial revision
150:                 **
151:                 **
152:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map042.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map042.c
21:                  **
22:                  ** Mapper #42 (Baby Mario bootleg)
23:                  ** Implementation by Firebug
24:                  ** Mapper information courtesy of Kevin Horton
25:                  ** $Id: map042.c,v 1.2 2001/04/27 14:37:11 neil Exp $
26:                  **
27:                  */
28:                  
29:                  #include <noftypes.h>
30:                  #include <nes_mmc.h>
31:                  #include <nes.h>
32:                  #include <libsnss.h>
33:                  #include <log.h>
34:                  
35:                  static struct
36:                  {
37:                    bool enabled;
38:                    uint32 counter;
39:                  } irq;
40:                  
41:                  /********************************/
42:                  /* Mapper #42 IRQ reset routine */
43:                  /********************************/
44:                  static void map42_irq_reset (void)
45:                  {
46:                    /* Turn off IRQs */
47:                    irq.enabled = false;
9D03CF48  AF808158   SW ZERO, -32424(GP)
9D03CF8C  AF808158   SW ZERO, -32424(GP)
9D03D03C  AF808158   SW ZERO, -32424(GP)
48:                    irq.counter = 0x0000;
9D03CF4C  AF80815C   SW ZERO, -32420(GP)
9D03CF90  AF80815C   SW ZERO, -32420(GP)
9D03D040  AF80815C   SW ZERO, -32420(GP)
49:                  
50:                    /* Done */
51:                    return;
52:                  }
53:                  
54:                  /********************************************/
55:                  /* Mapper #42: Baby Mario bootleg cartridge */
56:                  /********************************************/
57:                  static void map42_init (void)
58:                  {
9D03CF00  27BDFFE8   ADDIU SP, SP, -24
9D03CF04  AFBF0014   SW RA, 20(SP)
59:                    /* Set the hardwired pages */
60:                    mmc_bankrom (8, 0x8000, 0x0C);
9D03CF08  24040008   ADDIU A0, ZERO, 8
9D03CF0C  34058000   ORI A1, ZERO, -32768
9D03CF10  0F40CA71   JAL mmc_bankrom
9D03CF14  2406000C   ADDIU A2, ZERO, 12
61:                    mmc_bankrom (8, 0xA000, 0x0D);
9D03CF18  24040008   ADDIU A0, ZERO, 8
9D03CF1C  3405A000   ORI A1, ZERO, -24576
9D03CF20  0F40CA71   JAL mmc_bankrom
9D03CF24  2406000D   ADDIU A2, ZERO, 13
62:                    mmc_bankrom (8, 0xC000, 0x0E);
9D03CF28  24040008   ADDIU A0, ZERO, 8
9D03CF2C  3405C000   ORI A1, ZERO, -16384
9D03CF30  0F40CA71   JAL mmc_bankrom
9D03CF34  2406000E   ADDIU A2, ZERO, 14
63:                    mmc_bankrom (8, 0xE000, 0x0F);
9D03CF38  24040008   ADDIU A0, ZERO, 8
9D03CF3C  3405E000   ORI A1, ZERO, -8192
9D03CF40  0F40CA71   JAL mmc_bankrom
9D03CF44  2406000F   ADDIU A2, ZERO, 15
64:                  
65:                    /* Reset the IRQ counter */
66:                    map42_irq_reset ();
67:                  
68:                    /* Done */
69:                    return;
70:                  }
9D03CF50  8FBF0014   LW RA, 20(SP)
9D03CF54  03E00008   JR RA
9D03CF58  27BD0018   ADDIU SP, SP, 24
71:                  
72:                  /****************************************/
73:                  /* Mapper #42 callback for IRQ handling */
74:                  /****************************************/
75:                  static void map42_hblank (int vblank)
76:                  {
9D03CF5C  27BDFFE8   ADDIU SP, SP, -24
9D03CF60  AFBF0014   SW RA, 20(SP)
77:                     /* Counter is M2 based so it doesn't matter whether */
78:                     /* the PPU is in its VBlank period or not           */
79:                     UNUSED(vblank);
80:                  
81:                     /* Increment the counter if it is enabled and check for strike */
82:                     if (irq.enabled)
9D03CF64  8F828158   LW V0, -32424(GP)
9D03CF68  1040000A   BEQ V0, ZERO, .LBE8
9D03CF6C  2783815C   ADDIU V1, GP, -32420
83:                     {
84:                       /* Is there a constant for cycles per scanline? */
85:                       /* If so, someone ought to substitute it here   */
86:                       irq.counter = irq.counter + 114;
9D03CF70  8C640000   LW A0, 0(V1)
9D03CF74  24850072   ADDIU A1, A0, 114
87:                  
88:                       /* IRQ is triggered after 24576 M2 cycles */
89:                       if (irq.counter >= 0x6000)
9D03CF78  2CA66000   SLTIU A2, A1, 24576
9D03CF7C  14C00005   BNE A2, ZERO, .LBE8
9D03CF80  AC650000   SW A1, 0(V1)
90:                       {
91:                         /* Trigger the IRQ */
92:                         nes_irq ();
9D03CF84  0F40975F   JAL nes_irq
9D03CF88  00000000   NOP
93:                  
94:                         /* Reset the counter */
95:                         map42_irq_reset ();
96:                       }
97:                     }
98:                  }
9D03CF94  8FBF0014   LW RA, 20(SP)
9D03CF98  03E00008   JR RA
9D03CF9C  27BD0018   ADDIU SP, SP, 24
99:                  
100:                 /******************************************/
101:                 /* Mapper #42 write handler ($E000-$FFFF) */
102:                 /******************************************/
103:                 static void map42_write (uint32 address, uint8 value)
104:                 {
9D03CFA0  27BDFFE8   ADDIU SP, SP, -24
9D03CFA4  AFBF0014   SW RA, 20(SP)
105:                   switch (address & 0x03)
9D03CFA8  30840003   ANDI A0, A0, 3
9D03CFAC  24020001   ADDIU V0, ZERO, 1
9D03CFB0  1082000D   BEQ A0, V0, 0x9D03CFE8
9D03CFB4  00A03021   ADDU A2, A1, ZERO
9D03CFB8  10800005   BEQ A0, ZERO, 0x9D03CFD0
9D03CFBC  24030002   ADDIU V1, ZERO, 2
9D03CFC0  50830019   BEQL A0, V1, 0x9D03D028
9D03CFC4  30A50002   ANDI A1, A1, 2
106:                   {
107:                     /* Register 0: Select ROM page at $6000-$7FFF */
108:                     case 0x00: mmc_bankrom (8, 0x6000, value & 0x0F);
9D03CFD0  24040008   ADDIU A0, ZERO, 8
9D03CFD4  24056000   ADDIU A1, ZERO, 24576
9D03CFD8  0F40CA71   JAL mmc_bankrom
9D03CFDC  30C6000F   ANDI A2, A2, 15
109:                                break;
9D03CFE0  0B40F412   J 0x9D03D048
9D03CFE4  8FBF0014   LW RA, 20(SP)
110:                 
111:                     /* Register 1: mirroring */
112:                     case 0x01: if (value & 0x08) ppu_mirror(0, 0, 1, 1); /* horizontal */
9D03CFE8  30A90008   ANDI T1, A1, 8
9D03CFEC  312A00FF   ANDI T2, T1, 255
9D03CFF0  11400007   BEQ T2, ZERO, 0x9D03D010
9D03CFF4  00002021   ADDU A0, ZERO, ZERO
9D03CFF8  00002821   ADDU A1, ZERO, ZERO
9D03CFFC  24060001   ADDIU A2, ZERO, 1
9D03D000  0F4058FD   JAL ppu_mirror
9D03D004  24070001   ADDIU A3, ZERO, 1
9D03D008  0B40F412   J 0x9D03D048
9D03D00C  8FBF0014   LW RA, 20(SP)
113:                                else              ppu_mirror(0, 1, 0, 1); /* vertical   */
9D03D010  24050001   ADDIU A1, ZERO, 1
9D03D014  00003021   ADDU A2, ZERO, ZERO
9D03D018  0F4058FD   JAL ppu_mirror
9D03D01C  24070001   ADDIU A3, ZERO, 1
114:                                break;
115:                 
116:                     /* Register 2: IRQ */
117:                     case 0x02: if (value & 0x02) irq.enabled = true;
9D03D028  30A700FF   ANDI A3, A1, 255
9D03D02C  10E00003   BEQ A3, ZERO, .LBB12
9D03D030  24080001   ADDIU T0, ZERO, 1
9D03D034  0B40F411   J .LBE12
9D03D038  AF888158   SW T0, -32424(GP)
118:                                else              map42_irq_reset ();
119:                                break;
120:                 
121:                     /* Register 3: unused */
122:                     default:   break;
123:                   }
124:                 
125:                   /* Done */
126:                   return;
127:                 }
9D03CFC8  0B40F412   J 0x9D03D048
9D03CFCC  8FBF0014   LW RA, 20(SP)
9D03D020  0B40F412   J 0x9D03D048
9D03D024  8FBF0014   LW RA, 20(SP)
9D03D044  8FBF0014   LW RA, 20(SP)
9D03D048  03E00008   JR RA
9D03D04C  27BD0018   ADDIU SP, SP, 24
128:                 
129:                 /****************************************************/
130:                 /* Shove extra mapper information into a SNSS block */
131:                 /****************************************************/
132:                 static void map42_setstate (SnssMapperBlock *state)
133:                 {
9D03CEF0  03E00008   JR RA
9D03CEF4  00000000   NOP
134:                   /* TODO: Store SNSS information */
135:                   UNUSED (state);
136:                 
137:                   /* Done */
138:                   return;
139:                 }
140:                 
141:                 /*****************************************************/
142:                 /* Pull extra mapper information out of a SNSS block */
143:                 /*****************************************************/
144:                 static void map42_getstate (SnssMapperBlock *state)
145:                 {
9D03CEF8  03E00008   JR RA
9D03CEFC  00000000   NOP
146:                   /* TODO: Retrieve SNSS information */
147:                   UNUSED (state);
148:                 
149:                   /* Done */
150:                   return;
151:                 }
152:                 
153:                 static map_memwrite map42_memwrite [] =
154:                 {
155:                    { 0xE000, 0xFFFF, map42_write },
156:                    {     -1,     -1, NULL }
157:                 };
158:                 
159:                 mapintf_t map42_intf =
160:                 {
161:                    42,                               /* Mapper number */
162:                    "Baby Mario (bootleg)",           /* Mapper name */
163:                    map42_init,                       /* Initialization routine */
164:                    NULL,                             /* VBlank callback */
165:                    map42_hblank,                     /* HBlank callback */
166:                    map42_getstate,                   /* Get state (SNSS) */
167:                    map42_setstate,                   /* Set state (SNSS) */
168:                    NULL,                             /* Memory read structure */
169:                    map42_memwrite,                   /* Memory write structure */
170:                    NULL                              /* External sound device */
171:                 };
172:                 
173:                 /*
174:                 ** $Log: map042.c,v $
175:                 ** Revision 1.2  2001/04/27 14:37:11  neil
176:                 ** wheeee
177:                 **
178:                 ** Revision 1.1  2001/04/27 12:54:40  neil
179:                 ** blah
180:                 **
181:                 ** Revision 1.1  2001/04/27 10:57:41  neil
182:                 ** wheee
183:                 **
184:                 ** Revision 1.1  2000/12/27 19:23:30  firebug
185:                 ** initial revision
186:                 **
187:                 **
188:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map041.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map041.c
21:                  **
22:                  ** Mapper #41 (Caltron 6 in 1)
23:                  ** Implementation by Firebug
24:                  ** Mapper information courtesy of Kevin Horton
25:                  ** $Id: map041.c,v 1.2 2001/04/27 14:37:11 neil Exp $
26:                  **
27:                  */
28:                  
29:                  #include <noftypes.h>
30:                  #include <nes_mmc.h>
31:                  #include <nes.h>
32:                  #include <libsnss.h>
33:                  #include <log.h>
34:                  
35:                  static uint8 register_low;
36:                  static uint8 register_high;
37:                  
38:                  /*****************************************************/
39:                  /* Set 8K CHR bank from the combined register values */
40:                  /*****************************************************/
41:                  static void map41_set_chr (void)
42:                  {
9D03DB78  27BDFFE8   ADDIU SP, SP, -24
9D03DB7C  AFBF0014   SW RA, 20(SP)
43:                    /* Set the CHR bank from the appropriate register bits */
44:                    mmc_bankvrom (8, 0x0000, ((register_low >> 1) & 0x0C) | (register_high));
9D03DB80  9386817D   LBU A2, -32387(GP)
9D03DB84  00061042   SRL V0, A2, 1
9D03DB88  3043000C   ANDI V1, V0, 12
9D03DB8C  9387817C   LBU A3, -32388(GP)
9D03DB90  24040008   ADDIU A0, ZERO, 8
9D03DB94  00002821   ADDU A1, ZERO, ZERO
9D03DB98  0F40CA16   JAL mmc_bankvrom
9D03DB9C  00673025   OR A2, V1, A3
45:                  
46:                    /* Done */
47:                    return;
48:                  }
9D03DBA0  8FBF0014   LW RA, 20(SP)
9D03DBA4  03E00008   JR RA
9D03DBA8  27BD0018   ADDIU SP, SP, 24
49:                  
50:                  /******************************/
51:                  /* Mapper #41: Caltron 6 in 1 */
52:                  /******************************/
53:                  static void map41_init (void)
54:                  {
9D03DBE0  27BDFFE8   ADDIU SP, SP, -24
9D03DBE4  AFBF0014   SW RA, 20(SP)
55:                    /* Both registers set to zero at power on */
56:                    /* TODO: Registers should also be cleared on a soft reset */
57:                    register_low = 0x00;
9D03DBE8  A380817D   SB ZERO, -32387(GP)
58:                    register_high = 0x00;
9D03DBEC  A380817C   SB ZERO, -32388(GP)
59:                    mmc_bankrom (32, 0x8000, 0x00);
9D03DBF0  24040020   ADDIU A0, ZERO, 32
9D03DBF4  34058000   ORI A1, ZERO, -32768
9D03DBF8  0F40CA71   JAL mmc_bankrom
9D03DBFC  00003021   ADDU A2, ZERO, ZERO
60:                    map41_set_chr ();
9D03DC00  0F40F6DE   JAL .LFB0, map41_set_chr, .LFE5
9D03DC04  00000000   NOP
61:                  
62:                    /* Done */
63:                    return;
64:                  }
9D03DC08  8FBF0014   LW RA, 20(SP)
9D03DC0C  03E00008   JR RA
9D03DC10  27BD0018   ADDIU SP, SP, 24
65:                  
66:                  /******************************************/
67:                  /* Mapper #41 write handler ($6000-$67FF) */
68:                  /******************************************/
69:                  static void map41_low_write (uint32 address, uint8 value)
70:                  {
9D03DC14  27BDFFE8   ADDIU SP, SP, -24
9D03DC18  AFBF0014   SW RA, 20(SP)
71:                    /* Within this range the value written is irrelevant */
72:                    UNUSED (value);
73:                  
74:                    /* $6000-$67FF: A5    = mirroring (1=horizontal, 0=vertical)      */
75:                    /*              A4-A3 = high two bits of 8K CHR bank              */
76:                    /*              A2    = register 1 enable (0=disabled, 1=enabled) */
77:                    /*              A2-A0 = 32K PRG bank                              */
78:                    register_low = (uint8) (address & 0x3F);
9D03DC1C  308600FF   ANDI A2, A0, 255
9D03DC20  30C2003F   ANDI V0, A2, 63
9D03DC24  A382817D   SB V0, -32387(GP)
79:                    mmc_bankrom (32, 0x8000, register_low & 0x07);
9D03DC28  24040020   ADDIU A0, ZERO, 32
9D03DC2C  34058000   ORI A1, ZERO, -32768
9D03DC30  0F40CA71   JAL mmc_bankrom
9D03DC34  30C60007   ANDI A2, A2, 7
80:                    map41_set_chr ();
9D03DC38  0F40F6DE   JAL .LFB0, map41_set_chr, .LFE5
9D03DC3C  00000000   NOP
81:                    if (register_low & 0x20) ppu_mirror(0, 0, 1, 1); /* horizontal */
9D03DC40  9383817D   LBU V1, -32387(GP)
9D03DC44  30640020   ANDI A0, V1, 32
9D03DC48  308500FF   ANDI A1, A0, 255
9D03DC4C  10A00007   BEQ A1, ZERO, 0x9D03DC6C
9D03DC50  00002021   ADDU A0, ZERO, ZERO
9D03DC54  00002821   ADDU A1, ZERO, ZERO
9D03DC58  24060001   ADDIU A2, ZERO, 1
9D03DC5C  0F4058FD   JAL ppu_mirror
9D03DC60  24070001   ADDIU A3, ZERO, 1
9D03DC64  0B40F720   J 0x9D03DC80
9D03DC68  8FBF0014   LW RA, 20(SP)
82:                    else                     ppu_mirror(0, 1, 0, 1); /* vertical */
9D03DC6C  24050001   ADDIU A1, ZERO, 1
9D03DC70  00003021   ADDU A2, ZERO, ZERO
9D03DC74  0F4058FD   JAL ppu_mirror
9D03DC78  24070001   ADDIU A3, ZERO, 1
83:                  
84:                    /* Done */
85:                    return;
86:                  }
9D03DC7C  8FBF0014   LW RA, 20(SP)
9D03DC80  03E00008   JR RA
9D03DC84  27BD0018   ADDIU SP, SP, 24
87:                  
88:                  /******************************************/
89:                  /* Mapper #41 write handler ($8000-$FFFF) */
90:                  /******************************************/
91:                  static void map41_high_write (uint32 address, uint8 value)
92:                  {
9D03DBAC  27BDFFE8   ADDIU SP, SP, -24
9D03DBB0  AFBF0014   SW RA, 20(SP)
93:                    /* Address doesn't matter within this range */
94:                    UNUSED (address);
95:                  
96:                    /* $8000-$FFFF: D1-D0 = low two bits of 8K CHR bank */
97:                    if (register_low & 0x04)
9D03DBB4  9382817D   LBU V0, -32387(GP)
9D03DBB8  30430004   ANDI V1, V0, 4
9D03DBBC  306400FF   ANDI A0, V1, 255
9D03DBC0  10800005   BEQ A0, ZERO, 0x9D03DBD8
9D03DBC4  8FBF0014   LW RA, 20(SP)
98:                    {
99:                      register_high = value & 0x03;
9D03DBC8  30A50003   ANDI A1, A1, 3
100:                     map41_set_chr ();
9D03DBCC  0F40F6DE   JAL .LFB0, map41_set_chr, .LFE5
9D03DBD0  A385817C   SB A1, -32388(GP)
101:                   }
102:                 
103:                   /* Done */
104:                   return;
105:                 }
9D03DBD4  8FBF0014   LW RA, 20(SP)
9D03DBD8  03E00008   JR RA
9D03DBDC  27BD0018   ADDIU SP, SP, 24
106:                 
107:                 /****************************************************/
108:                 /* Shove extra mapper information into a SNSS block */
109:                 /****************************************************/
110:                 static void map41_setstate (SnssMapperBlock *state)
111:                 {
9D03DB68  03E00008   JR RA
9D03DB6C  00000000   NOP
112:                   /* TODO: Store SNSS information */
113:                   UNUSED (state);
114:                 
115:                   /* Done */
116:                   return;
117:                 }
118:                 
119:                 /*****************************************************/
120:                 /* Pull extra mapper information out of a SNSS block */
121:                 /*****************************************************/
122:                 static void map41_getstate (SnssMapperBlock *state)
123:                 {
9D03DB70  03E00008   JR RA
9D03DB74  00000000   NOP
124:                   /* TODO: Retrieve SNSS information */
125:                   UNUSED (state);
126:                 
127:                   /* Done */
128:                   return;
129:                 }
130:                 
131:                 static map_memwrite map41_memwrite [] =
132:                 {
133:                    { 0x6000, 0x67FF, map41_low_write },
134:                    { 0x8000, 0xFFFF, map41_high_write },
135:                    {     -1,     -1, NULL }
136:                 };
137:                 
138:                 mapintf_t map41_intf =
139:                 {
140:                    41,                               /* Mapper number */
141:                    "Caltron 6 in 1",                 /* Mapper name */
142:                    map41_init,                       /* Initialization routine */
143:                    NULL,                             /* VBlank callback */
144:                    NULL,                             /* HBlank callback */
145:                    map41_getstate,                   /* Get state (SNSS) */
146:                    map41_setstate,                   /* Set state (SNSS) */
147:                    NULL,                             /* Memory read structure */
148:                    map41_memwrite,                   /* Memory write structure */
149:                    NULL                              /* External sound device */
150:                 };
151:                 
152:                 /*
153:                 ** $Log: map041.c,v $
154:                 ** Revision 1.2  2001/04/27 14:37:11  neil
155:                 ** wheeee
156:                 **
157:                 ** Revision 1.1  2001/04/27 12:54:40  neil
158:                 ** blah
159:                 **
160:                 ** Revision 1.1  2001/04/27 10:57:41  neil
161:                 ** wheee
162:                 **
163:                 ** Revision 1.1  2000/12/30 00:33:15  firebug
164:                 ** initial revision
165:                 **
166:                 **
167:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map040.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map40.c
21:                  **
22:                  ** mapper 40 interface
23:                  ** $Id: map040.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes.h>
29:                  #include <libsnss.h>
30:                  #include <log.h>
31:                  
32:                  #define  MAP40_IRQ_PERIOD  (4096 / 113.666666)
33:                  
34:                  static struct
35:                  {
36:                     int enabled, counter;
37:                  } irq;
38:                  
39:                  /* mapper 40: SMB 2j (hack) */
40:                  static void map40_init(void)
41:                  {
9D03D9A8  27BDFFE8   ADDIU SP, SP, -24
9D03D9AC  AFBF0014   SW RA, 20(SP)
42:                     mmc_bankrom(8, 0x6000, 6);
9D03D9B0  24040008   ADDIU A0, ZERO, 8
9D03D9B4  24056000   ADDIU A1, ZERO, 24576
9D03D9B8  0F40CA71   JAL mmc_bankrom
9D03D9BC  24060006   ADDIU A2, ZERO, 6
43:                     mmc_bankrom(8, 0x8000, 4);
9D03D9C0  24040008   ADDIU A0, ZERO, 8
9D03D9C4  34058000   ORI A1, ZERO, -32768
9D03D9C8  0F40CA71   JAL mmc_bankrom
9D03D9CC  24060004   ADDIU A2, ZERO, 4
44:                     mmc_bankrom(8, 0xA000, 5);
9D03D9D0  24040008   ADDIU A0, ZERO, 8
9D03D9D4  3405A000   ORI A1, ZERO, -24576
9D03D9D8  0F40CA71   JAL mmc_bankrom
9D03D9DC  24060005   ADDIU A2, ZERO, 5
45:                     mmc_bankrom(8, 0xE000, 7);
9D03D9E0  24040008   ADDIU A0, ZERO, 8
9D03D9E4  3405E000   ORI A1, ZERO, -8192
9D03D9E8  0F40CA71   JAL mmc_bankrom
9D03D9EC  24060007   ADDIU A2, ZERO, 7
46:                  
47:                     irq.enabled = false;
9D03D9F0  AF808114   SW ZERO, -32492(GP)
48:                     irq.counter = (int) MAP40_IRQ_PERIOD;
9D03D9F4  24020024   ADDIU V0, ZERO, 36
9D03D9F8  AF828118   SW V0, -32488(GP)
49:                  }
9D03D9FC  8FBF0014   LW RA, 20(SP)
9D03DA00  03E00008   JR RA
9D03DA04  27BD0018   ADDIU SP, SP, 24
50:                  
51:                  static void map40_hblank(int vblank)
52:                  {
9D03DA08  27BDFFE8   ADDIU SP, SP, -24
9D03DA0C  AFBF0014   SW RA, 20(SP)
53:                     UNUSED(vblank);
54:                  
55:                     if (irq.enabled && irq.counter)
9D03DA10  8F828114   LW V0, -32492(GP)
9D03DA14  10400008   BEQ V0, ZERO, 0x9D03DA38
9D03DA18  8F838118   LW V1, -32488(GP)
9D03DA1C  10600006   BEQ V1, ZERO, 0x9D03DA38
9D03DA20  2464FFFF   ADDIU A0, V1, -1
56:                     {
57:                        irq.counter--;
58:                        if (0 == irq.counter)
9D03DA24  14800004   BNE A0, ZERO, 0x9D03DA38
9D03DA28  AF848118   SW A0, -32488(GP)
59:                        {
60:                           nes_irq();
9D03DA2C  0F40975F   JAL nes_irq
9D03DA30  00000000   NOP
61:                           irq.enabled = false;
9D03DA34  AF808114   SW ZERO, -32492(GP)
62:                        }
63:                     }
64:                  }
9D03DA38  8FBF0014   LW RA, 20(SP)
9D03DA3C  03E00008   JR RA
9D03DA40  27BD0018   ADDIU SP, SP, 24
65:                  
66:                  static void map40_write(uint32 address, uint8 value)
67:                  {
9D03D944  27BDFFE8   ADDIU SP, SP, -24
68:                     int range = (address >> 13) - 4;
9D03D948  00042342   SRL A0, A0, 13
9D03D94C  2483FFFC   ADDIU V1, A0, -4
69:                  
70:                     switch (range)
9D03D950  24020001   ADDIU V0, ZERO, 1
9D03D954  1062000A   BEQ V1, V0, 0x9D03D980
9D03D958  AFBF0014   SW RA, 20(SP)
9D03D95C  24060003   ADDIU A2, ZERO, 3
9D03D960  1066000A   BEQ V1, A2, 0x9D03D98C
9D03D964  00A03821   ADDU A3, A1, ZERO
9D03D968  1460000D   BNE V1, ZERO, 0x9D03D9A0
9D03D96C  8FBF0014   LW RA, 20(SP)
71:                     {
72:                     case 0: /* 0x8000-0x9FFF */
73:                        irq.enabled = false;
9D03D970  AF808114   SW ZERO, -32492(GP)
74:                        irq.counter = (int) MAP40_IRQ_PERIOD;
9D03D974  24050024   ADDIU A1, ZERO, 36
75:                        break;
9D03D978  0B40F667   J .LVL9
9D03D97C  AF858118   SW A1, -32488(GP)
76:                  
77:                     case 1: /* 0xA000-0xBFFF */
78:                        irq.enabled = true;
9D03D980  24080001   ADDIU T0, ZERO, 1
79:                        break;
9D03D984  0B40F667   J .LVL9
9D03D988  AF888114   SW T0, -32492(GP)
80:                  
81:                     case 3: /* 0xE000-0xFFFF */
82:                        mmc_bankrom(8, 0xC000, value & 7);
9D03D98C  24040008   ADDIU A0, ZERO, 8
9D03D990  3405C000   ORI A1, ZERO, -16384
9D03D994  0F40CA71   JAL mmc_bankrom
9D03D998  30E60007   ANDI A2, A3, 7
83:                        break;
84:                  
85:                     default:
86:                        break;
87:                     }
88:                  }
9D03D99C  8FBF0014   LW RA, 20(SP)
9D03D9A0  03E00008   JR RA
9D03D9A4  27BD0018   ADDIU SP, SP, 24
89:                  
90:                  static void map40_getstate(SnssMapperBlock *state)
91:                  {
92:                     state->extraData.mapper40.irqCounter = irq.counter;
9D03D91C  8F828118   LW V0, -32488(GP)
9D03D920  A0820018   SB V0, 24(A0)
93:                     state->extraData.mapper40.irqCounterEnabled = irq.enabled;
9D03D924  8F838114   LW V1, -32492(GP)
9D03D928  03E00008   JR RA
9D03D92C  A0830019   SB V1, 25(A0)
94:                  }
95:                  
96:                  static void map40_setstate(SnssMapperBlock *state)
97:                  {
98:                     irq.counter = state->extraData.mapper40.irqCounter;
9D03D930  90820018   LBU V0, 24(A0)
9D03D934  AF828118   SW V0, -32488(GP)
99:                     irq.enabled = state->extraData.mapper40.irqCounterEnabled;
9D03D938  90830019   LBU V1, 25(A0)
9D03D93C  03E00008   JR RA
9D03D940  AF838114   SW V1, -32492(GP)
100:                 }
101:                 
102:                 static map_memwrite map40_memwrite[] =
103:                 {
104:                    { 0x8000, 0xFFFF, map40_write },
105:                    {     -1,     -1, NULL }
106:                 };
107:                 
108:                 mapintf_t map40_intf =
109:                 {
110:                    40, /* mapper number */
111:                    "SMB 2j (pirate)", /* mapper name */
112:                    map40_init, /* init routine */
113:                    NULL, /* vblank callback */
114:                    map40_hblank, /* hblank callback */
115:                    map40_getstate, /* get state (snss) */
116:                    map40_setstate, /* set state (snss) */
117:                    NULL, /* memory read structure */
118:                    map40_memwrite, /* memory write structure */
119:                    NULL /* external sound device */
120:                 };
121:                 
122:                 /*
123:                 ** $Log: map040.c,v $
124:                 ** Revision 1.2  2001/04/27 14:37:11  neil
125:                 ** wheeee
126:                 **
127:                 ** Revision 1.1  2001/04/27 12:54:40  neil
128:                 ** blah
129:                 **
130:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
131:                 ** initial
132:                 **
133:                 ** Revision 1.1  2000/10/24 12:19:33  matt
134:                 ** changed directory structure
135:                 **
136:                 ** Revision 1.9  2000/10/23 15:53:27  matt
137:                 ** suppressed warnings
138:                 **
139:                 ** Revision 1.8  2000/10/22 19:17:46  matt
140:                 ** mapper cleanups galore
141:                 **
142:                 ** Revision 1.7  2000/10/21 19:33:38  matt
143:                 ** many more cleanups
144:                 **
145:                 ** Revision 1.6  2000/10/10 13:58:17  matt
146:                 ** stroustrup squeezing his way in the door
147:                 **
148:                 ** Revision 1.5  2000/08/16 02:50:11  matt
149:                 ** random mapper cleanups
150:                 **
151:                 ** Revision 1.4  2000/07/15 23:52:19  matt
152:                 ** rounded out a bunch more mapper interfaces
153:                 **
154:                 ** Revision 1.3  2000/07/10 13:51:25  matt
155:                 ** using generic nes_irq() routine now
156:                 **
157:                 ** Revision 1.2  2000/07/06 02:48:43  matt
158:                 ** clearly labelled structure members
159:                 **
160:                 ** Revision 1.1  2000/07/05 05:05:18  matt
161:                 ** initial revision
162:                 **
163:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map034.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map34.c
21:                  **
22:                  ** mapper 34 interface
23:                  ** $Id: map034.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  
29:                  static void map34_init(void)
30:                  {
9D040A40  27BDFFE8   ADDIU SP, SP, -24
9D040A44  AFBF0014   SW RA, 20(SP)
31:                     mmc_bankrom(32, 0x8000, MMC_LASTBANK);
9D040A48  24040020   ADDIU A0, ZERO, 32
9D040A4C  34058000   ORI A1, ZERO, -32768
9D040A50  0F40CA71   JAL mmc_bankrom
9D040A54  2406FFFF   ADDIU A2, ZERO, -1
32:                  }
9D040A58  8FBF0014   LW RA, 20(SP)
9D040A5C  03E00008   JR RA
9D040A60  27BD0018   ADDIU SP, SP, 24
33:                  
34:                  static void map34_write(uint32 address, uint8 value)
35:                  {
9D040A64  27BDFFE8   ADDIU SP, SP, -24
9D040A68  AFBF0014   SW RA, 20(SP)
36:                     if ((address & 0x8000) || (0x7FFD == address))
9D040A6C  30828000   ANDI V0, A0, -32768
9D040A70  14400004   BNE V0, ZERO, 0x9D040A84
9D040A74  00A03021   ADDU A2, A1, ZERO
9D040A78  24037FFD   ADDIU V1, ZERO, 32765
9D040A7C  54830006   BNEL A0, V1, 0x9D040A98
9D040A80  24057FFE   ADDIU A1, ZERO, 32766
37:                     {
38:                        mmc_bankrom(32, 0x8000, value);
9D040A84  24040020   ADDIU A0, ZERO, 32
9D040A88  0F40CA71   JAL mmc_bankrom
9D040A8C  34058000   ORI A1, ZERO, -32768
9D040A90  0B4102B3   J 0x9D040ACC
9D040A94  8FBF0014   LW RA, 20(SP)
39:                     }
40:                     else if (0x7FFE == address)
9D040A98  14850006   BNE A0, A1, 0x9D040AB4
9D040A9C  24077FFF   ADDIU A3, ZERO, 32767
41:                     {
42:                        mmc_bankvrom(4, 0x0000, value);
9D040AA0  24040004   ADDIU A0, ZERO, 4
9D040AA4  0F40CA16   JAL mmc_bankvrom
9D040AA8  00002821   ADDU A1, ZERO, ZERO
9D040AAC  0B4102B3   J 0x9D040ACC
9D040AB0  8FBF0014   LW RA, 20(SP)
43:                     }
44:                     else if (0x7FFF == address)
9D040AB4  14870005   BNE A0, A3, 0x9D040ACC
9D040AB8  8FBF0014   LW RA, 20(SP)
45:                     {
46:                        mmc_bankvrom(4, 0x1000, value);
9D040ABC  24040004   ADDIU A0, ZERO, 4
9D040AC0  0F40CA16   JAL mmc_bankvrom
9D040AC4  24051000   ADDIU A1, ZERO, 4096
47:                     }
48:                  }
9D040AC8  8FBF0014   LW RA, 20(SP)
9D040ACC  03E00008   JR RA
9D040AD0  27BD0018   ADDIU SP, SP, 24
49:                  
50:                  static map_memwrite map34_memwrite[] = 
51:                  {
52:                     { 0x7FFD, 0xFFFF, map34_write },
53:                     { -1, -1, NULL }
54:                  };
55:                  
56:                  mapintf_t map34_intf = 
57:                  {
58:                     34, /* mapper number */
59:                     "Nina-1", /* mapper name */
60:                     map34_init, /* init routine */
61:                     NULL, /* vblank callback */
62:                     NULL, /* hblank callback */
63:                     NULL, /* get state (snss) */
64:                     NULL, /* set state (snss) */
65:                     NULL, /* memory read structure */
66:                     map34_memwrite, /* memory write structure */
67:                     NULL /* external sound device */
68:                  };
69:                  
70:                  /*
71:                  ** $Log: map034.c,v $
72:                  ** Revision 1.2  2001/04/27 14:37:11  neil
73:                  ** wheeee
74:                  **
75:                  ** Revision 1.1  2001/04/27 12:54:40  neil
76:                  ** blah
77:                  **
78:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
79:                  ** initial
80:                  **
81:                  ** Revision 1.1  2000/10/24 12:19:33  matt
82:                  ** changed directory structure
83:                  **
84:                  ** Revision 1.5  2000/10/22 19:17:46  matt
85:                  ** mapper cleanups galore
86:                  **
87:                  ** Revision 1.4  2000/10/21 19:33:38  matt
88:                  ** many more cleanups
89:                  **
90:                  ** Revision 1.3  2000/07/11 05:03:49  matt
91:                  ** value masking isn't necessary for the banking routines
92:                  **
93:                  ** Revision 1.2  2000/07/11 03:35:08  bsittler
94:                  ** Fixes to make mikes new mappers compile.
95:                  **
96:                  ** Revision 1.1  2000/07/11 03:14:18  melanson
97:                  ** Initial commit for mappers 16, 34, and 231
98:                  **
99:                  **
100:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map033.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map33.c
21:                  **
22:                  ** mapper 33 interface
23:                  ** $Id: map033.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes_ppu.h>
29:                  
30:                  /* mapper 33: Taito TC0190*/
31:                  static void map33_write(uint32 address, uint8 value)
32:                  {
9D03E0F4  27BDFFE8   ADDIU SP, SP, -24
9D03E0F8  AFBF0014   SW RA, 20(SP)
33:                     int page = (address >> 13) & 3;
9D03E100  7C840B40   EXT A0, A0, 13, 2
34:                     int reg = address & 3;
9D03E0FC  30820003   ANDI V0, A0, 3
35:                  
36:                     switch (page)
9D03E104  24030001   ADDIU V1, ZERO, 1
9D03E108  10830027   BEQ A0, V1, .LBB2
9D03E10C  00A03021   ADDU A2, A1, ZERO
9D03E110  28850002   SLTI A1, A0, 2
9D03E114  10A0002A   BEQ A1, ZERO, 0x9D03E1C0
9D03E118  2C4B0002   SLTIU T3, V0, 2
9D03E11C  54800037   BNEL A0, ZERO, 0x9D03E1FC
9D03E120  8FBF0014   LW RA, 20(SP)
37:                     {
38:                     case 0: /* $800X */
39:                        switch (reg)
9D03E124  24070001   ADDIU A3, ZERO, 1
9D03E128  10470011   BEQ V0, A3, 0x9D03E170
9D03E12C  28480002   SLTI T0, V0, 2
9D03E130  11000005   BEQ T0, ZERO, 0x9D03E148
9D03E134  24090002   ADDIU T1, ZERO, 2
9D03E138  10400009   BEQ V0, ZERO, 0x9D03E160
9D03E13C  24040008   ADDIU A0, ZERO, 8
9D03E148  1049000E   BEQ V0, T1, 0x9D03E184
9D03E14C  240A0003   ADDIU T2, ZERO, 3
9D03E150  104A0011   BEQ V0, T2, 0x9D03E198
9D03E154  24040002   ADDIU A0, ZERO, 2
40:                        {
41:                        case 0:
42:                           mmc_bankrom(8, 0x8000, value);
9D03E160  0F40CA71   JAL mmc_bankrom
9D03E164  34058000   ORI A1, ZERO, -32768
43:                           break;
9D03E168  0B40F87F   J 0x9D03E1FC
9D03E16C  8FBF0014   LW RA, 20(SP)
44:                  
45:                        case 1:
46:                           mmc_bankrom(8, 0xA000, value);
9D03E170  24040008   ADDIU A0, ZERO, 8
9D03E174  0F40CA71   JAL mmc_bankrom
9D03E178  3405A000   ORI A1, ZERO, -24576
47:                           break;
9D03E17C  0B40F87F   J 0x9D03E1FC
9D03E180  8FBF0014   LW RA, 20(SP)
48:                  
49:                        case 2:
50:                           mmc_bankvrom(2, 0x0000, value);
9D03E184  24040002   ADDIU A0, ZERO, 2
9D03E188  0F40CA16   JAL mmc_bankvrom
9D03E18C  00002821   ADDU A1, ZERO, ZERO
51:                           break;
9D03E190  0B40F87F   J 0x9D03E1FC
9D03E194  8FBF0014   LW RA, 20(SP)
52:                  
53:                        case 3:
54:                           mmc_bankvrom(2, 0x0800, value);
9D03E198  0F40CA16   JAL mmc_bankvrom
9D03E19C  24050800   ADDIU A1, ZERO, 2048
55:                           break;
9D03E1A0  0B40F87F   J 0x9D03E1FC
9D03E1A4  8FBF0014   LW RA, 20(SP)
56:                        }
57:                        break;
58:                  
59:                     case 1: /* $A00X */
60:                        {
61:                           int loc = 0x1000 + (reg << 10);
9D03E1A8  00026280   SLL T4, V0, 10
62:                           mmc_bankvrom(1, loc, value);
9D03E1AC  24040001   ADDIU A0, ZERO, 1
9D03E1B0  0F40CA16   JAL mmc_bankvrom
9D03E1B4  25851000   ADDIU A1, T4, 4096
63:                        }
64:                        break;
9D03E1B8  0B40F87F   J 0x9D03E1FC
9D03E1BC  8FBF0014   LW RA, 20(SP)
65:                  
66:                     case 2: /* $C00X */
67:                     case 3: /* $E00X */
68:                        switch (reg)
9D03E1C0  1160000D   BEQ T3, ZERO, .LVL18
9D03E1C4  30C60001   ANDI A2, A2, 1
69:                        {
70:                        case 0:
71:                           /* irqs maybe ? */
72:                           //break;
73:                        
74:                        case 1:
75:                           /* this doesn't seem to work just right */
76:                           if (value & 1)
9D03E1C8  10C00007   BEQ A2, ZERO, 0x9D03E1E8
9D03E1CC  00002021   ADDU A0, ZERO, ZERO
77:                              ppu_mirror(0, 0, 1, 1); /* horizontal */
9D03E1D0  00002821   ADDU A1, ZERO, ZERO
9D03E1D4  24060001   ADDIU A2, ZERO, 1
9D03E1D8  0F4058FD   JAL ppu_mirror
9D03E1DC  24070001   ADDIU A3, ZERO, 1
9D03E1E0  0B40F87F   J 0x9D03E1FC
9D03E1E4  8FBF0014   LW RA, 20(SP)
78:                           else
79:                              ppu_mirror(0, 1, 0, 1);
9D03E1E8  24050001   ADDIU A1, ZERO, 1
9D03E1EC  00003021   ADDU A2, ZERO, ZERO
9D03E1F0  0F4058FD   JAL ppu_mirror
9D03E1F4  24070001   ADDIU A3, ZERO, 1
80:                           break;
81:                  
82:                        default:
83:                           break;
84:                        }
85:                        break;
86:                     }
87:                  }
9D03E140  0B40F87F   J 0x9D03E1FC
9D03E144  8FBF0014   LW RA, 20(SP)
9D03E158  0B40F87F   J 0x9D03E1FC
9D03E15C  8FBF0014   LW RA, 20(SP)
9D03E1F8  8FBF0014   LW RA, 20(SP)
9D03E1FC  03E00008   JR RA
9D03E200  27BD0018   ADDIU SP, SP, 24
88:                  
89:                  
90:                  static map_memwrite map33_memwrite[] =
91:                  {
92:                     { 0x8000, 0xFFFF, map33_write },
93:                     {     -1,     -1, NULL }
94:                  };
95:                  
96:                  mapintf_t map33_intf =
97:                  {
98:                     33, /* mapper number */
99:                     "Taito TC0190", /* mapper name */
100:                    NULL, /* init routine */
101:                    NULL, /* vblank callback */
102:                    NULL, /* hblank callback */
103:                    NULL, /* get state (snss) */
104:                    NULL, /* set state (snss) */
105:                    NULL, /* memory read structure */
106:                    map33_memwrite, /* memory write structure */
107:                    NULL /* external sound device */
108:                 };
109:                 
110:                 /*
111:                 ** $Log: map033.c,v $
112:                 ** Revision 1.2  2001/04/27 14:37:11  neil
113:                 ** wheeee
114:                 **
115:                 ** Revision 1.1  2001/04/27 12:54:40  neil
116:                 ** blah
117:                 **
118:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
119:                 ** initial
120:                 **
121:                 ** Revision 1.1  2000/10/24 12:19:33  matt
122:                 ** changed directory structure
123:                 **
124:                 ** Revision 1.7  2000/10/22 19:17:46  matt
125:                 ** mapper cleanups galore
126:                 **
127:                 ** Revision 1.6  2000/10/22 15:03:13  matt
128:                 ** simplified mirroring
129:                 **
130:                 ** Revision 1.5  2000/10/21 19:33:38  matt
131:                 ** many more cleanups
132:                 **
133:                 ** Revision 1.4  2000/07/15 23:52:19  matt
134:                 ** rounded out a bunch more mapper interfaces
135:                 **
136:                 ** Revision 1.3  2000/07/10 05:29:03  matt
137:                 ** cleaned up some mirroring issues
138:                 **
139:                 ** Revision 1.2  2000/07/06 02:48:43  matt
140:                 ** clearly labelled structure members
141:                 **
142:                 ** Revision 1.1  2000/07/06 01:01:56  matt
143:                 ** initial revision
144:                 **
145:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map032.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map32.c
21:                  **
22:                  ** mapper 32 interface
23:                  ** $Id: map032.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes_ppu.h>
29:                  
30:                  static int select_c000 = 0;
31:                  
32:                  /* mapper 32: Irem G-101 */
33:                  static void map32_write(uint32 address, uint8 value)
34:                  {
9D03EC3C  27BDFFE8   ADDIU SP, SP, -24
9D03EC40  AFBF0014   SW RA, 20(SP)
9D03EC44  AFB00010   SW S0, 16(SP)
35:                     switch (address >> 12)
9D03EC48  00041302   SRL V0, A0, 12
9D03EC4C  24030009   ADDIU V1, ZERO, 9
9D03EC50  1043001B   BEQ V0, V1, 0x9D03ECC0
9D03EC54  00A08021   ADDU S0, A1, ZERO
9D03EC58  2C45000A   SLTIU A1, V0, 10
9D03EC5C  10A00006   BEQ A1, ZERO, 0x9D03EC78
9D03EC60  2407000A   ADDIU A3, ZERO, 10
9D03EC64  24040008   ADDIU A0, ZERO, 8
9D03EC68  50440009   BEQL V0, A0, 0x9D03EC90
9D03EC6C  8F868124   LW A2, -32476(GP)
9D03EC78  10470021   BEQ V0, A3, 0x9D03ED00
9D03EC7C  2408000B   ADDIU T0, ZERO, 11
9D03EC80  10480025   BEQ V0, T0, .LBB2
9D03EC84  30890007   ANDI T1, A0, 7
36:                     {
37:                     case 0x08: 
38:                        if (select_c000)
9D03EC90  10C00006   BEQ A2, ZERO, 0x9D03ECAC
9D03EC94  24040008   ADDIU A0, ZERO, 8
39:                           mmc_bankrom(8, 0xC000, value);
9D03EC98  3405C000   ORI A1, ZERO, -16384
9D03EC9C  0F40CA71   JAL mmc_bankrom
9D03ECA0  02003021   ADDU A2, S0, ZERO
9D03ECA4  0B40FB4B   J 0x9D03ED2C
9D03ECA8  8FBF0014   LW RA, 20(SP)
40:                        else
41:                           mmc_bankrom(8, 0x8000, value);
9D03ECAC  34058000   ORI A1, ZERO, -32768
9D03ECB0  0F40CA71   JAL mmc_bankrom
9D03ECB4  02003021   ADDU A2, S0, ZERO
42:                        break;
43:                  
44:                     case 0x09: 
45:                        if (value & 1)
9D03ECC0  30AA0001   ANDI T2, A1, 1
9D03ECC4  11400007   BEQ T2, ZERO, 0x9D03ECE4
9D03ECC8  00002021   ADDU A0, ZERO, ZERO
46:                           ppu_mirror(0, 0, 1, 1); /* horizontal */
9D03ECCC  00002821   ADDU A1, ZERO, ZERO
9D03ECD0  24060001   ADDIU A2, ZERO, 1
9D03ECD4  0F4058FD   JAL ppu_mirror
9D03ECD8  24070001   ADDIU A3, ZERO, 1
9D03ECDC  0B40FB3E   J 0x9D03ECF8
9D03ECE0  320B0002   ANDI T3, S0, 2
47:                        else
48:                           ppu_mirror(0, 1, 0, 1); /* vertical */
9D03ECE4  24050001   ADDIU A1, ZERO, 1
9D03ECE8  00003021   ADDU A2, ZERO, ZERO
9D03ECEC  0F4058FD   JAL ppu_mirror
9D03ECF0  24070001   ADDIU A3, ZERO, 1
49:                     
50:                        select_c000 = (value & 0x02);
9D03ECF4  320B0002   ANDI T3, S0, 2
51:                        break;
9D03ECF8  0B40FB4A   J .LVL20, .LBE2
9D03ECFC  AF8B8124   SW T3, -32476(GP)
52:                  
53:                     case 0x0A: 
54:                        mmc_bankrom(8, 0xA000, value); 
9D03ED00  24040008   ADDIU A0, ZERO, 8
9D03ED04  3405A000   ORI A1, ZERO, -24576
9D03ED08  0F40CA71   JAL mmc_bankrom
9D03ED0C  02003021   ADDU A2, S0, ZERO
55:                        break;
9D03ED10  0B40FB4B   J 0x9D03ED2C
9D03ED14  8FBF0014   LW RA, 20(SP)
56:                  
57:                     case 0x0B: 
58:                        {
59:                           int loc = (address & 0x07) << 10;
60:                           mmc_bankvrom(1, loc, value);
9D03ED18  24040001   ADDIU A0, ZERO, 1
9D03ED1C  00092A80   SLL A1, T1, 10
9D03ED20  0F40CA16   JAL mmc_bankvrom
9D03ED24  02003021   ADDU A2, S0, ZERO
61:                        }
62:                        break;
63:                  
64:                     default:
65:                        break;
66:                     }
67:                  }
9D03EC70  0B40FB4B   J 0x9D03ED2C
9D03EC74  8FBF0014   LW RA, 20(SP)
9D03EC88  0B40FB4B   J 0x9D03ED2C
9D03EC8C  8FBF0014   LW RA, 20(SP)
9D03ECB8  0B40FB4B   J 0x9D03ED2C
9D03ECBC  8FBF0014   LW RA, 20(SP)
9D03ED28  8FBF0014   LW RA, 20(SP)
9D03ED2C  8FB00010   LW S0, 16(SP)
9D03ED30  03E00008   JR RA
9D03ED34  27BD0018   ADDIU SP, SP, 24
68:                  
69:                  static map_memwrite map32_memwrite[] =
70:                  {
71:                     { 0x8000, 0xFFFF, map32_write },
72:                     {     -1,     -1, NULL }
73:                  };
74:                  
75:                  mapintf_t map32_intf =
76:                  {
77:                     32, /* mapper number */
78:                     "Irem G-101", /* mapper name */
79:                     NULL, /* init routine */
80:                     NULL, /* vblank callback */
81:                     NULL, /* hblank callback */
82:                     NULL, /* get state (snss) */
83:                     NULL, /* set state (snss) */
84:                     NULL, /* memory read structure */
85:                     map32_memwrite, /* memory write structure */
86:                     NULL /* external sound device */
87:                  };
88:                  
89:                  /*
90:                  ** $Log: map032.c,v $
91:                  ** Revision 1.2  2001/04/27 14:37:11  neil
92:                  ** wheeee
93:                  **
94:                  ** Revision 1.1  2001/04/27 12:54:40  neil
95:                  ** blah
96:                  **
97:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
98:                  ** initial
99:                  **
100:                 ** Revision 1.1  2000/10/24 12:19:33  matt
101:                 ** changed directory structure
102:                 **
103:                 ** Revision 1.6  2000/10/22 19:17:46  matt
104:                 ** mapper cleanups galore
105:                 **
106:                 ** Revision 1.5  2000/10/22 15:03:13  matt
107:                 ** simplified mirroring
108:                 **
109:                 ** Revision 1.4  2000/10/21 19:33:38  matt
110:                 ** many more cleanups
111:                 **
112:                 ** Revision 1.3  2000/07/10 05:29:03  matt
113:                 ** cleaned up some mirroring issues
114:                 **
115:                 ** Revision 1.2  2000/07/06 02:48:43  matt
116:                 ** clearly labelled structure members
117:                 **
118:                 ** Revision 1.1  2000/07/06 01:01:56  matt
119:                 ** initial revision
120:                 **
121:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map024.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map24.c
21:                  **
22:                  ** mapper 24 interface
23:                  ** $Id: map024.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes.h>
29:                  #include <log.h>
30:                  #include <vrcvisnd.h>
31:                  
32:                  static struct
33:                  {
34:                     int counter, enabled;
35:                     int latch, wait_state;
36:                  } irq;
37:                  
38:                  static void map24_init(void)
39:                  {
40:                     irq.counter = irq.enabled = 0;
9D038518  3C03A001   LUI V1, -24575
9D03851C  2462592C   ADDIU V0, V1, 22828
9D038520  AC400004   SW ZERO, 4(V0)
9D038524  AC60592C   SW ZERO, 22828(V1)
41:                     irq.latch = irq.wait_state = 0;
9D038528  AC40000C   SW ZERO, 12(V0)
9D03852C  03E00008   JR RA
9D038530  AC400008   SW ZERO, 8(V0)
42:                  }
43:                  
44:                  static void map24_hblank(int vblank) 
45:                  {
9D038820  27BDFFE8   ADDIU SP, SP, -24
9D038824  AFBF0014   SW RA, 20(SP)
9D038828  AFB00010   SW S0, 16(SP)
46:                     UNUSED(vblank);
47:                  
48:                     if (irq.enabled)
9D0387FC  3C02A001   LUI V0, -24575
9D038800  8C435930   LW V1, 22832(V0)
9D038804  10600013   BEQ V1, ZERO, 0x9D038854
9D038808  3C04A001   LUI A0, -24575
49:                     {
50:                        if (256 == ++irq.counter)
9D03880C  8C85592C   LW A1, 22828(A0)
9D038810  24A60001   ADDIU A2, A1, 1
9D038814  24070100   ADDIU A3, ZERO, 256
9D038818  14C7000E   BNE A2, A3, 0x9D038854
9D03881C  AC86592C   SW A2, 22828(A0)
51:                        {
52:                           irq.counter = irq.latch;
9D03882C  3C08A001   LUI T0, -24575
9D038830  2510592C   ADDIU S0, T0, 22828
9D038834  8E090008   LW T1, 8(S0)
53:                           nes_irq();
9D038838  0F40975F   JAL nes_irq
9D03883C  AD09592C   SW T1, 22828(T0)
54:                           //irq.enabled = false;
55:                           irq.enabled = irq.wait_state;
9D038840  8E0A000C   LW T2, 12(S0)
9D038844  AE0A0004   SW T2, 4(S0)
56:                        }
57:                     }
58:                  }
9D038848  8FBF0014   LW RA, 20(SP)
9D03884C  8FB00010   LW S0, 16(SP)
9D038850  27BD0018   ADDIU SP, SP, 24
9D038854  03E00008   JR RA
9D038858  00000000   NOP
59:                  
60:                  static void map24_write(uint32 address, uint8 value)
61:                  {
9D03856C  27BDFFE8   ADDIU SP, SP, -24
9D038570  AFBF0014   SW RA, 20(SP)
62:                     switch (address & 0xF003)
9D038574  3084F003   ANDI A0, A0, -4093
9D038578  3402D003   ORI V0, ZERO, -12285
9D03857C  10820073   BEQ A0, V0, 0x9D03874C
9D038580  00A03021   ADDU A2, A1, ZERO
9D038584  3403D004   ORI V1, ZERO, -12284
9D038588  0083282B   SLTU A1, A0, V1
9D03858C  50A00017   BEQL A1, ZERO, 0x9D0385EC
9D038590  3403E003   ORI V1, ZERO, -8189
9D038594  3407C000   ORI A3, ZERO, -16384
9D038598  10870059   BEQ A0, A3, 0x9D038700
9D03859C  3408C001   ORI T0, ZERO, -16383
9D0385A0  0088482B   SLTU T1, A0, T0
9D0385A4  11200008   BEQ T1, ZERO, 0x9D0385C8
9D0385A8  3418D001   ORI T8, ZERO, -12287
9D0385AC  340A8000   ORI T2, ZERO, -32768
9D0385B0  108A0025   BEQ A0, T2, 0x9D038648
9D0385B4  340BB003   ORI T3, ZERO, -20477
9D0385B8  508B0028   BEQL A0, T3, 0x9D03865C
9D0385BC  30C6000C   ANDI A2, A2, 12
9D0385C8  10980056   BEQ A0, T8, 0x9D038724
9D0385CC  3419D002   ORI T9, ZERO, -12286
9D0385D0  0099F82B   SLTU RA, A0, T9
9D0385D4  13E00058   BEQ RA, ZERO, 0x9D038738
9D0385D8  3402D000   ORI V0, ZERO, -12288
9D0385DC  1082004D   BEQ A0, V0, 0x9D038714
9D0385E0  24040001   ADDIU A0, ZERO, 1
9D0385EC  1083006A   BEQ A0, V1, 0x9D038798
9D0385F0  3405E004   ORI A1, ZERO, -8188
9D0385F4  0085382B   SLTU A3, A0, A1
9D0385F8  10E0000A   BEQ A3, ZERO, 0x9D038624
9D0385FC  3408E001   ORI T0, ZERO, -8191
9D038600  1088005B   BEQ A0, T0, 0x9D038770
9D038604  3409E002   ORI T1, ZERO, -8190
9D038608  0089502B   SLTU T2, A0, T1
9D03860C  1140005D   BEQ T2, ZERO, 0x9D038784
9D038610  340BE000   ORI T3, ZERO, -8192
9D038614  108B0052   BEQ A0, T3, 0x9D038760
9D038618  24040001   ADDIU A0, ZERO, 1
9D038624  340CF001   ORI T4, ZERO, -4095
9D038628  108C0062   BEQ A0, T4, 0x9D0387B4
9D03862C  340DF002   ORI T5, ZERO, -4094
9D038630  108D006B   BEQ A0, T5, 0x9D0387E0
9D038634  340EF000   ORI T6, ZERO, -4096
9D038638  148E006E   BNE A0, T6, 0x9D0387F4
9D03863C  8FBF0014   LW RA, 20(SP)
63:                     {
64:                     case 0x8000:
65:                        mmc_bankrom(16, 0x8000, value);
9D038648  24040010   ADDIU A0, ZERO, 16
9D03864C  0F40CA71   JAL mmc_bankrom
9D038650  34058000   ORI A1, ZERO, -32768
66:                        break;
9D038654  0B40E1FD   J 0x9D0387F4
9D038658  8FBF0014   LW RA, 20(SP)
67:                  
68:                     case 0x9003:
69:                        /* ??? */
70:                        break;
71:                     
72:                     case 0xB003:
73:                        switch (value & 0x0C)
9D03865C  240C0004   ADDIU T4, ZERO, 4
9D038660  10CC0013   BEQ A2, T4, 0x9D0386B0
9D038664  2CCD0005   SLTIU T5, A2, 5
9D038668  11A00005   BEQ T5, ZERO, 0x9D038680
9D03866C  240E0008   ADDIU T6, ZERO, 8
9D038670  10C00009   BEQ A2, ZERO, 0x9D038698
9D038674  00002021   ADDU A0, ZERO, ZERO
9D038680  10CE0012   BEQ A2, T6, 0x9D0386CC
9D038684  240F000C   ADDIU T7, ZERO, 12
9D038688  10CF0017   BEQ A2, T7, 0x9D0386E8
9D03868C  24040001   ADDIU A0, ZERO, 1
74:                        {
75:                        case 0x00:
76:                           ppu_mirror(0, 1, 0, 1); /* vertical */
9D038698  24050001   ADDIU A1, ZERO, 1
9D03869C  00003021   ADDU A2, ZERO, ZERO
9D0386A0  0F4058FD   JAL ppu_mirror
9D0386A4  24070001   ADDIU A3, ZERO, 1
77:                           break;
9D0386A8  0B40E1FD   J 0x9D0387F4
9D0386AC  8FBF0014   LW RA, 20(SP)
78:                        
79:                        case 0x04:
80:                           ppu_mirror(0, 0, 1, 1); /* horizontal */
9D0386B0  00002021   ADDU A0, ZERO, ZERO
9D0386B4  00002821   ADDU A1, ZERO, ZERO
9D0386B8  24060001   ADDIU A2, ZERO, 1
9D0386BC  0F4058FD   JAL ppu_mirror
9D0386C0  24070001   ADDIU A3, ZERO, 1
81:                           break;
9D0386C4  0B40E1FD   J 0x9D0387F4
9D0386C8  8FBF0014   LW RA, 20(SP)
82:                        
83:                        case 0x08:
84:                           ppu_mirror(0, 0, 0, 0);
9D0386CC  00002021   ADDU A0, ZERO, ZERO
9D0386D0  00002821   ADDU A1, ZERO, ZERO
9D0386D4  00003021   ADDU A2, ZERO, ZERO
9D0386D8  0F4058FD   JAL ppu_mirror
9D0386DC  00003821   ADDU A3, ZERO, ZERO
85:                           break;
9D0386E0  0B40E1FD   J 0x9D0387F4
9D0386E4  8FBF0014   LW RA, 20(SP)
86:                        
87:                        case 0x0C:
88:                           ppu_mirror(1, 1, 1, 1);
9D0386E8  24050001   ADDIU A1, ZERO, 1
9D0386EC  24060001   ADDIU A2, ZERO, 1
9D0386F0  0F4058FD   JAL ppu_mirror
9D0386F4  24070001   ADDIU A3, ZERO, 1
89:                           break;
9D0386F8  0B40E1FD   J 0x9D0387F4
9D0386FC  8FBF0014   LW RA, 20(SP)
90:                        
91:                        default:
92:                           break;
93:                        }
94:                        break;
95:                     
96:                  
97:                     case 0xC000:
98:                        mmc_bankrom(8, 0xC000, value);
9D038700  24040008   ADDIU A0, ZERO, 8
9D038704  0F40CA71   JAL mmc_bankrom
9D038708  3405C000   ORI A1, ZERO, -16384
99:                        break;
9D03870C  0B40E1FD   J 0x9D0387F4
9D038710  8FBF0014   LW RA, 20(SP)
100:                    
101:                    case 0xD000:
102:                       mmc_bankvrom(1, 0x0000, value);
9D038714  0F40CA16   JAL mmc_bankvrom
9D038718  00002821   ADDU A1, ZERO, ZERO
103:                       break;
9D03871C  0B40E1FD   J 0x9D0387F4
9D038720  8FBF0014   LW RA, 20(SP)
104:                    
105:                    case 0xD001:
106:                       mmc_bankvrom(1, 0x0400, value);
9D038724  24040001   ADDIU A0, ZERO, 1
9D038728  0F40CA16   JAL mmc_bankvrom
9D03872C  24050400   ADDIU A1, ZERO, 1024
107:                       break;
9D038730  0B40E1FD   J 0x9D0387F4
9D038734  8FBF0014   LW RA, 20(SP)
108:                    
109:                    case 0xD002:
110:                       mmc_bankvrom(1, 0x0800, value);
9D038738  24040001   ADDIU A0, ZERO, 1
9D03873C  0F40CA16   JAL mmc_bankvrom
9D038740  24050800   ADDIU A1, ZERO, 2048
111:                       break;
9D038744  0B40E1FD   J 0x9D0387F4
9D038748  8FBF0014   LW RA, 20(SP)
112:                    
113:                    case 0xD003:
114:                       mmc_bankvrom(1, 0x0C00, value);
9D03874C  24040001   ADDIU A0, ZERO, 1
9D038750  0F40CA16   JAL mmc_bankvrom
9D038754  24050C00   ADDIU A1, ZERO, 3072
115:                       break;
9D038758  0B40E1FD   J 0x9D0387F4
9D03875C  8FBF0014   LW RA, 20(SP)
116:                    
117:                    case 0xE000:
118:                       mmc_bankvrom(1, 0x1000, value);
9D038760  0F40CA16   JAL mmc_bankvrom
9D038764  24051000   ADDIU A1, ZERO, 4096
119:                       break;
9D038768  0B40E1FD   J 0x9D0387F4
9D03876C  8FBF0014   LW RA, 20(SP)
120:                    
121:                    case 0xE001:
122:                       mmc_bankvrom(1, 0x1400, value);
9D038770  24040001   ADDIU A0, ZERO, 1
9D038774  0F40CA16   JAL mmc_bankvrom
9D038778  24051400   ADDIU A1, ZERO, 5120
123:                       break;
9D03877C  0B40E1FD   J 0x9D0387F4
9D038780  8FBF0014   LW RA, 20(SP)
124:                    
125:                    case 0xE002:
126:                       mmc_bankvrom(1, 0x1800, value);
9D038784  24040001   ADDIU A0, ZERO, 1
9D038788  0F40CA16   JAL mmc_bankvrom
9D03878C  24051800   ADDIU A1, ZERO, 6144
127:                       break;
9D038790  0B40E1FD   J 0x9D0387F4
9D038794  8FBF0014   LW RA, 20(SP)
128:                    
129:                    case 0xE003:
130:                       mmc_bankvrom(1, 0x1C00, value);
9D038798  24040001   ADDIU A0, ZERO, 1
9D03879C  0F40CA16   JAL mmc_bankvrom
9D0387A0  24051C00   ADDIU A1, ZERO, 7168
131:                       break;
9D0387A4  0B40E1FD   J 0x9D0387F4
9D0387A8  8FBF0014   LW RA, 20(SP)
132:                    
133:                    case 0xF000:
134:                       irq.latch = value;
9D038640  0B40E1EB   J 0x9D0387AC
9D038644  3C04A001   LUI A0, -24575
135:                       break;
9D0387AC  0B40E1FC   J 0x9D0387F0
9D0387B0  AC865934   SW A2, 22836(A0)
136:                    
137:                    case 0xF001:
138:                       irq.enabled = (value >> 1) & 0x01;
9D0387B4  7CD90040   EXT T9, A2, 1, 1
9D0387B8  3C1FA001   LUI RA, -24575
9D0387BC  27E3592C   ADDIU V1, RA, 22828
9D0387C0  AC790004   SW T9, 4(V1)
139:                       irq.wait_state = value & 0x01;
9D0387C4  30C20001   ANDI V0, A2, 1
140:                       if (irq.enabled)
9D0387C8  13200009   BEQ T9, ZERO, 0x9D0387F0
9D0387CC  AC62000C   SW V0, 12(V1)
141:                          irq.counter = irq.latch;
9D0387D0  3C05A001   LUI A1, -24575
9D0387D4  8C670008   LW A3, 8(V1)
9D0387D8  0B40E1FC   J 0x9D0387F0
9D0387DC  ACA7592C   SW A3, 22828(A1)
142:                       break;
143:                    
144:                    case 0xF002:
145:                       irq.enabled = irq.wait_state;
9D0387E0  3C06A001   LUI A2, -24575
9D0387E4  24CF592C   ADDIU T7, A2, 22828
9D0387E8  8DF8000C   LW T8, 12(T7)
9D0387EC  ADF80004   SW T8, 4(T7)
146:                       break;
147:                    
148:                    default:
149:                 #ifdef NOFRENDO_DEBUG
150:                       log_printf("invalid VRC6 write: $%02X to $%04X", value, address);
151:                 #endif
152:                       break;      
153:                    }
154:                 }
9D0385C0  0B40E1FD   J 0x9D0387F4
9D0385C4  8FBF0014   LW RA, 20(SP)
9D0385E4  0B40E1FD   J 0x9D0387F4
9D0385E8  8FBF0014   LW RA, 20(SP)
9D03861C  0B40E1FD   J 0x9D0387F4
9D038620  8FBF0014   LW RA, 20(SP)
9D038678  0B40E1FD   J 0x9D0387F4
9D03867C  8FBF0014   LW RA, 20(SP)
9D038690  0B40E1FD   J 0x9D0387F4
9D038694  8FBF0014   LW RA, 20(SP)
9D0387F0  8FBF0014   LW RA, 20(SP)
9D0387F4  03E00008   JR RA
9D0387F8  27BD0018   ADDIU SP, SP, 24
155:                 
156:                 static void map24_getstate(SnssMapperBlock *state)
157:                 {
158:                    state->extraData.mapper24.irqCounter = irq.counter;
9D038534  3C02A001   LUI V0, -24575
9D038538  8C43592C   LW V1, 22828(V0)
9D03853C  A0830018   SB V1, 24(A0)
159:                    state->extraData.mapper24.irqCounterEnabled = irq.enabled;
9D038540  2445592C   ADDIU A1, V0, 22828
9D038544  8CA60004   LW A2, 4(A1)
9D038548  03E00008   JR RA
9D03854C  A0860019   SB A2, 25(A0)
160:                 }
161:                 
162:                 static void map24_setstate(SnssMapperBlock *state)
163:                 {
164:                    irq.counter = state->extraData.mapper24.irqCounter;
9D038550  3C02A001   LUI V0, -24575
9D038554  90830018   LBU V1, 24(A0)
9D038558  AC43592C   SW V1, 22828(V0)
165:                    irq.enabled = state->extraData.mapper24.irqCounterEnabled;
9D03855C  2445592C   ADDIU A1, V0, 22828
9D038560  90840019   LBU A0, 25(A0)
9D038564  03E00008   JR RA
9D038568  ACA40004   SW A0, 4(A1)
166:                 }
167:                 
168:                 static map_memwrite map24_memwrite[] =
169:                 {
170:                    { 0x8000, 0xF002, map24_write },
171:                    {     -1,     -1, NULL }
172:                 };
173:                 
174:                 mapintf_t map24_intf =
175:                 {
176:                    24, /* mapper number */
177:                    "Konami VRC6", /* mapper name */
178:                    map24_init, /* init routine */
179:                    NULL, /* vblank callback */
180:                    map24_hblank, /* hblank callback */
181:                    map24_getstate, /* get state (snss) */
182:                    map24_setstate, /* set state (snss) */
183:                    NULL, /* memory read structure */
184:                    map24_memwrite, /* memory write structure */
185:                    &vrcvi_ext /* external sound device */
186:                 };
187:                 
188:                 /*
189:                 ** $Log: map024.c,v $
190:                 ** Revision 1.2  2001/04/27 14:37:11  neil
191:                 ** wheeee
192:                 **
193:                 ** Revision 1.1  2001/04/27 12:54:40  neil
194:                 ** blah
195:                 **
196:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
197:                 ** initial
198:                 **
199:                 ** Revision 1.1  2000/10/24 12:19:33  matt
200:                 ** changed directory structure
201:                 **
202:                 ** Revision 1.11  2000/10/22 19:17:46  matt
203:                 ** mapper cleanups galore
204:                 **
205:                 ** Revision 1.10  2000/10/22 15:03:13  matt
206:                 ** simplified mirroring
207:                 **
208:                 ** Revision 1.9  2000/10/21 19:33:38  matt
209:                 ** many more cleanups
210:                 **
211:                 ** Revision 1.8  2000/10/10 13:58:17  matt
212:                 ** stroustrup squeezing his way in the door
213:                 **
214:                 ** Revision 1.7  2000/10/09 12:00:53  matt
215:                 ** removed old code
216:                 **
217:                 ** Revision 1.6  2000/08/16 02:50:11  matt
218:                 ** random mapper cleanups
219:                 **
220:                 ** Revision 1.5  2000/07/15 23:52:19  matt
221:                 ** rounded out a bunch more mapper interfaces
222:                 **
223:                 ** Revision 1.4  2000/07/10 13:51:25  matt
224:                 ** using generic nes_irq() routine now
225:                 **
226:                 ** Revision 1.3  2000/07/10 05:29:03  matt
227:                 ** cleaned up some mirroring issues
228:                 **
229:                 ** Revision 1.2  2000/07/06 02:48:43  matt
230:                 ** clearly labelled structure members
231:                 **
232:                 ** Revision 1.1  2000/07/04 23:11:45  matt
233:                 ** initial revision
234:                 **
235:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map019.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map19.c
21:                  **
22:                  ** mapper 19 interface
23:                  ** $Id: map019.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes_ppu.h>
29:                  
30:                  /* TODO: shouldn't there be an h-blank IRQ handler??? */
31:                  
32:                  /* Special mirroring macro for mapper 19 */
33:                  #define N_BANK1(table, value) \
34:                  { \
35:                     if ((value) < 0xE0) \
36:                        ppu_setpage(1, (table) + 8, &mmc_getinfo()->vrom[((value) % (mmc_getinfo()->vrom_banks * 8)) << 10] - (0x2000 + ((table) << 10))); \
37:                     else \
38:                        ppu_setpage(1, (table) + 8, &mmc_getinfo()->vram[((value) & 7) << 10] - (0x2000 + ((table) << 10))); \
39:                     ppu_mirrorhipages(); \
40:                  }
41:                  
42:                  static struct
43:                  {
44:                     int counter, enabled;
45:                  } irq;
46:                  
47:                  static void map19_init(void)
48:                  {
49:                     irq.counter = irq.enabled = 0;
9D03B26C  AF808120   SW ZERO, -32480(GP)
9D03B270  03E00008   JR RA
9D03B274  AF80811C   SW ZERO, -32484(GP)
50:                  }
51:                  
52:                  /* mapper 19: Namcot 106 */
53:                  static void map19_write(uint32 address, uint8 value)
54:                  {
9D03B2C8  27BDFFE0   ADDIU SP, SP, -32
9D03B2CC  AFBF001C   SW RA, 28(SP)
9D03B2D0  AFB20018   SW S2, 24(SP)
9D03B2D4  AFB10014   SW S1, 20(SP)
9D03B2D8  AFB00010   SW S0, 16(SP)
9D03B2DC  00A08021   ADDU S0, A1, ZERO
55:                     int reg = address >> 11;
9D03B2B4  000422C2   SRL A0, A0, 11
56:                     switch (reg)
9D03B2B8  2482FFF6   ADDIU V0, A0, -10
9D03B2BC  2C430015   SLTIU V1, V0, 21
9D03B2C0  10600074   BEQ V1, ZERO, 0x9D03B494
9D03B2C4  00000000   NOP
9D03B2E0  00022880   SLL A1, V0, 2
9D03B2E4  3C069D04   LUI A2, -25340
9D03B2E8  24C7B2FC   ADDIU A3, A2, -19716
9D03B2EC  00E54021   ADDU T0, A3, A1
9D03B2F0  8D090000   LW T1, 0(T0)
9D03B2F4  01200008   JR T1
9D03B2F8  00000000   NOP
57:                     {
58:                     case 0xA:
59:                        irq.counter &= ~0xFF;
9D03B354  8D8D0000   LW T5, 0(T4)
9D03B358  7C0D3804   INS T5, ZERO, 0, 8
60:                        irq.counter |= value;
9D03B350  278C811C   ADDIU T4, GP, -32484
9D03B35C  020D7025   OR T6, S0, T5
61:                        break;
9D03B360  0B40ED20   J .LVL24
9D03B364  AD8E0000   SW T6, 0(T4)
62:                     
63:                     case 0xB:
64:                        irq.counter = ((value & 0x7F) << 8) | (irq.counter & 0xFF);
9D03B368  2785811C   ADDIU A1, GP, -32484
9D03B36C  3207007F   ANDI A3, S0, 127
9D03B370  00074200   SLL T0, A3, 8
9D03B374  90A90000   LBU T1, 0(A1)
9D03B378  01095025   OR T2, T0, T1
9D03B37C  ACAA0000   SW T2, 0(A1)
65:                        irq.enabled = (value & 0x80) ? true : false;
9D03B380  001059C2   SRL T3, S0, 7
66:                        break;
9D03B384  0B40ED20   J .LVL24
9D03B388  AF8B8120   SW T3, -32480(GP)
67:                  
68:                     case 0x10:
69:                     case 0x11:
70:                     case 0x12:
71:                     case 0x13:
72:                     case 0x14:
73:                     case 0x15:
74:                     case 0x16:
75:                     case 0x17:
76:                        mmc_bankvrom(1, (reg & 7) << 10, value);
9D03B38C  309F0007   ANDI RA, A0, 7
9D03B390  24040001   ADDIU A0, ZERO, 1
9D03B394  001F2A80   SLL A1, RA, 10
9D03B398  0F40CA16   JAL mmc_bankvrom
9D03B39C  02003021   ADDU A2, S0, ZERO
77:                        break;
9D03B3A0  0B40ED21   J 0x9D03B484
9D03B3A4  8FBF001C   LW RA, 28(SP)
78:                  
79:                     case 0x18:
80:                     case 0x19:
81:                     case 0x1A:
82:                     case 0x1B:
83:                        N_BANK1(reg & 3, value);
9D03B3A8  2E0A00E0   SLTIU T2, S0, 224
9D03B3AC  11400014   BEQ T2, ZERO, 0x9D03B400
9D03B3B0  00000000   NOP
9D03B3B4  0F40CA0A   JAL mmc_getinfo
9D03B3B8  30910003   ANDI S1, A0, 3
9D03B3BC  0F40CA0A   JAL mmc_getinfo
9D03B3C0  8C520004   LW S2, 4(V0)
9D03B3C4  8C580014   LW T8, 20(V0)
9D03B3C8  0018C8C0   SLL T9, T8, 3
9D03B3CC  0219001A   DIV S0, T9
9D03B3D0  032001F4   TEQ T9, ZERO
9D03B3D4  00002010   MFHI A0
9D03B3D8  00041280   SLL V0, A0, 10
9D03B3DC  2443E000   ADDIU V1, V0, -8192
9D03B3E0  00118280   SLL S0, S1, 10
9D03B3E4  00703023   SUBU A2, V1, S0
9D03B3E8  24040001   ADDIU A0, ZERO, 1
9D03B3EC  26250008   ADDIU A1, S1, 8
9D03B3F0  0F4058B3   JAL ppu_setpage
9D03B3F4  02463021   ADDU A2, S2, A2
9D03B3F8  0B40ED0C   J .LVL14
9D03B3FC  00000000   NOP
9D03B400  0F40CA0A   JAL mmc_getinfo
9D03B404  30910003   ANDI S1, A0, 3
9D03B408  320B0007   ANDI T3, S0, 7
9D03B40C  000B6280   SLL T4, T3, 10
9D03B410  258DE000   ADDIU T5, T4, -8192
9D03B414  00117280   SLL T6, S1, 10
9D03B418  01AE7823   SUBU T7, T5, T6
9D03B41C  8C52000C   LW S2, 12(V0)
9D03B420  24040001   ADDIU A0, ZERO, 1
9D03B424  26250008   ADDIU A1, S1, 8
9D03B428  0F4058B3   JAL ppu_setpage
9D03B42C  024F3021   ADDU A2, S2, T7
9D03B430  0F4058EE   JAL ppu_mirrorhipages
9D03B434  00000000   NOP
84:                        break;
9D03B438  0B40ED21   J 0x9D03B484
9D03B43C  8FBF001C   LW RA, 28(SP)
85:                  
86:                     case 0x1C:
87:                        mmc_bankrom(8, 0x8000, value);
9D03B440  24040008   ADDIU A0, ZERO, 8
9D03B444  34058000   ORI A1, ZERO, -32768
9D03B448  0F40CA71   JAL mmc_bankrom
9D03B44C  02003021   ADDU A2, S0, ZERO
88:                        break;
9D03B450  0B40ED21   J 0x9D03B484
9D03B454  8FBF001C   LW RA, 28(SP)
89:                  
90:                     case 0x1D:
91:                        mmc_bankrom(8, 0xA000, value);
9D03B458  24040008   ADDIU A0, ZERO, 8
9D03B45C  3405A000   ORI A1, ZERO, -24576
9D03B460  0F40CA71   JAL mmc_bankrom
9D03B464  02003021   ADDU A2, S0, ZERO
92:                        break;
9D03B468  0B40ED21   J 0x9D03B484
9D03B46C  8FBF001C   LW RA, 28(SP)
93:                     
94:                     case 0x1E:
95:                        mmc_bankrom(8, 0xC000, value);
9D03B470  24040008   ADDIU A0, ZERO, 8
9D03B474  3405C000   ORI A1, ZERO, -16384
9D03B478  0F40CA71   JAL mmc_bankrom
9D03B47C  02003021   ADDU A2, S0, ZERO
96:                        break;
97:                     
98:                     default:
99:                        break;
100:                    }
101:                 }
9D03B480  8FBF001C   LW RA, 28(SP)
9D03B484  8FB20018   LW S2, 24(SP)
9D03B488  8FB10014   LW S1, 20(SP)
9D03B48C  8FB00010   LW S0, 16(SP)
9D03B490  27BD0020   ADDIU SP, SP, 32
9D03B494  03E00008   JR RA
9D03B498  00000000   NOP
102:                 
103:                 static void map19_getstate(SnssMapperBlock *state)
104:                 {
105:                    state->extraData.mapper19.irqCounterLowByte = irq.counter & 0xFF;
9D03B278  8F82811C   LW V0, -32484(GP)
9D03B27C  A0820018   SB V0, 24(A0)
106:                    state->extraData.mapper19.irqCounterHighByte = irq.counter >> 8;
9D03B280  00021A03   SRA V1, V0, 8
9D03B284  A0830019   SB V1, 25(A0)
107:                    state->extraData.mapper19.irqCounterEnabled = irq.enabled;
9D03B288  8F858120   LW A1, -32480(GP)
9D03B28C  03E00008   JR RA
9D03B290  A085001A   SB A1, 26(A0)
108:                 }
109:                 
110:                 static void map19_setstate(SnssMapperBlock *state)
111:                 {
112:                    irq.counter = (state->extraData.mapper19.irqCounterHighByte << 8)
9D03B294  90820019   LBU V0, 25(A0)
9D03B298  00022A00   SLL A1, V0, 8
9D03B2A4  AF86811C   SW A2, -32484(GP)
113:                                        | state->extraData.mapper19.irqCounterLowByte;
9D03B29C  90830018   LBU V1, 24(A0)
9D03B2A0  00A33025   OR A2, A1, V1
114:                    irq.enabled = state->extraData.mapper19.irqCounterEnabled;
9D03B2A8  9084001A   LBU A0, 26(A0)
9D03B2AC  03E00008   JR RA
9D03B2B0  AF848120   SW A0, -32480(GP)
115:                 }
116:                 
117:                 static map_memwrite map19_memwrite[] =
118:                 {
119:                    { 0x5000, 0x5FFF, map19_write },
120:                    { 0x8000, 0xFFFF, map19_write },
121:                    {     -1,     -1, NULL }
122:                 };
123:                 
124:                 mapintf_t map19_intf =
125:                 {
126:                    19, /* mapper number */
127:                    "Namcot 106", /* mapper name */
128:                    map19_init, /* init routine */
129:                    NULL, /* vblank callback */
130:                    NULL, /* hblank callback */
131:                    map19_getstate, /* get state (snss) */
132:                    map19_setstate, /* set state (snss) */
133:                    NULL, /* memory read structure */
134:                    map19_memwrite, /* memory write structure */
135:                    NULL /* external sound device */
136:                 };
137:                 
138:                 /*
139:                 ** $Log: map019.c,v $
140:                 ** Revision 1.2  2001/04/27 14:37:11  neil
141:                 ** wheeee
142:                 **
143:                 ** Revision 1.1  2001/04/27 12:54:40  neil
144:                 ** blah
145:                 **
146:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
147:                 ** initial
148:                 **
149:                 ** Revision 1.1  2000/10/24 12:19:33  matt
150:                 ** changed directory structure
151:                 **
152:                 ** Revision 1.6  2000/10/22 19:17:46  matt
153:                 ** mapper cleanups galore
154:                 **
155:                 ** Revision 1.5  2000/10/21 19:33:38  matt
156:                 ** many more cleanups
157:                 **
158:                 ** Revision 1.4  2000/10/10 13:58:17  matt
159:                 ** stroustrup squeezing his way in the door
160:                 **
161:                 ** Revision 1.3  2000/07/15 23:52:20  matt
162:                 ** rounded out a bunch more mapper interfaces
163:                 **
164:                 ** Revision 1.2  2000/07/06 02:48:43  matt
165:                 ** clearly labelled structure members
166:                 **
167:                 ** Revision 1.1  2000/07/06 01:01:56  matt
168:                 ** initial revision
169:                 **
170:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map018.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map18.c
21:                  **
22:                  ** mapper 18 interface
23:                  ** $Id: map018.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes_ppu.h>
29:                  
30:                  /* mapper 18: Jaleco SS8806 */
31:                  #define  VRC_PBANK(bank, value, high) \
32:                  do { \
33:                     if ((high)) \
34:                        highprgnybbles[(bank)] = (value) & 0x0F; \
35:                     else \
36:                        lowprgnybbles[(bank)] = (value) & 0x0F; \
37:                     mmc_bankrom(8, 0x8000 + ((bank) << 13), (highprgnybbles[(bank)] << 4)+lowprgnybbles[(bank)]); \
38:                  } while (0)
39:                  
40:                  #define VRC_VBANK(bank, value, high) \
41:                  { \
42:                     if ((high)) \
43:                        highnybbles[(bank)] = (value) & 0x0F; \
44:                     else \
45:                        lownybbles[(bank)] = (value) & 0x0F; \
46:                     mmc_bankvrom(1, (bank) << 10, (highnybbles[(bank)] << 4)+lownybbles[(bank)]); \
47:                  }
48:                  
49:                  static struct
50:                  {
51:                     int counter, enabled;
52:                     uint8 nybbles[4];
53:                     int clockticks;
54:                  } irq;
55:                  
56:                  static void map18_init(void)
57:                  {
58:                     irq.counter = irq.enabled = 0;
9D03194C  3C02A001   LUI V0, -24575
9D031950  244358EC   ADDIU V1, V0, 22764
9D031954  AC600004   SW ZERO, 4(V1)
9D031958  03E00008   JR RA
9D03195C  AC4058EC   SW ZERO, 22764(V0)
59:                  }
60:                  
61:                  static uint8 lownybbles[8];
62:                  static uint8 highnybbles[8];
63:                  static uint8 lowprgnybbles[3];
64:                  static uint8 highprgnybbles[3];
65:                  
66:                  
67:                  static void map18_write(uint32 address, uint8 value)
68:                  {
9D0319AC  27BDFFE8   ADDIU SP, SP, -24
69:                     switch (address)
9D0319B0  3402C000   ORI V0, ZERO, -16384
9D0319B4  108200F2   BEQ A0, V0, 0x9D031D80
9D0319B8  AFBF0014   SW RA, 20(SP)
9D0319BC  3403C001   ORI V1, ZERO, -16383
9D0319C0  0083302B   SLTU A2, A0, V1
9D0319C4  10C00033   BEQ A2, ZERO, 0x9D031A94
9D0319C8  3407A000   ORI A3, ZERO, -24576
9D0319CC  108700A0   BEQ A0, A3, 0x9D031C50
9D0319D0  3408A001   ORI T0, ZERO, -24575
9D0319D4  0088482B   SLTU T1, A0, T0
9D0319D8  51200016   BEQL T1, ZERO, 0x9D031A34
9D0319DC  341FB000   ORI RA, ZERO, -20480
9D0319E0  340A8002   ORI T2, ZERO, -32766
9D0319E4  108A0073   BEQ A0, T2, 0x9D031BB4
9D0319E8  340B8003   ORI T3, ZERO, -32765
9D0319EC  008B602B   SLTU T4, A0, T3
9D0319F0  51800008   BEQL T4, ZERO, 0x9D031A14
9D0319F4  34029000   ORI V0, ZERO, -28672
9D0319F8  340D8000   ORI T5, ZERO, -32768
9D0319FC  108D005A   BEQ A0, T5, 0x9D031B68
9D031A00  340E8001   ORI T6, ZERO, -32767
9D031A04  508E0062   BEQL A0, T6, 0x9D031B90
9D031A08  30A5000F   ANDI A1, A1, 15
9D031A14  1082007A   BEQ A0, V0, 0x9D031C00
9D031A18  34039001   ORI V1, ZERO, -28671
9D031A1C  10830082   BEQ A0, V1, 0x9D031C28
9D031A20  34068003   ORI A2, ZERO, -32765
9D031A24  548601C4   BNEL A0, A2, 0x9D032138
9D031A28  8FBF0014   LW RA, 20(SP)
9D031A34  109F00AC   BEQ A0, RA, 0x9D031CE8
9D031A38  3402B001   ORI V0, ZERO, -20479
9D031A3C  0082182B   SLTU V1, A0, V0
9D031A40  1060000A   BEQ V1, ZERO, 0x9D031A6C
9D031A44  3406A002   ORI A2, ZERO, -24574
9D031A48  10860095   BEQ A0, A2, 0x9D031CA0
9D031A4C  30AE000F   ANDI T6, A1, 15
9D031A50  0086382B   SLTU A3, A0, A2
9D031A54  14E00088   BNE A3, ZERO, 0x9D031C78
9D031A58  3408A003   ORI T0, ZERO, -24573
9D031A5C  10880099   BEQ A0, T0, 0x9D031CC4
9D031A60  30A4000F   ANDI A0, A1, 15
9D031A6C  3419B002   ORI T9, ZERO, -20478
9D031A70  109900B1   BEQ A0, T9, 0x9D031D38
9D031A74  30AA000F   ANDI T2, A1, 15
9D031A78  0099F82B   SLTU RA, A0, T9
9D031A7C  17E000A4   BNE RA, ZERO, 0x9D031D10
9D031A80  3402B003   ORI V0, ZERO, -20477
9D031A84  508200B5   BEQL A0, V0, 0x9D031D5C
9D031A88  30A5000F   ANDI A1, A1, 15
9D031A94  341FD003   ORI RA, ZERO, -12285
9D031A98  109F00FB   BEQ A0, RA, 0x9D031E88
9D031A9C  3402D004   ORI V0, ZERO, -12284
9D031AA0  0082182B   SLTU V1, A0, V0
9D031AA4  10600019   BEQ V1, ZERO, 0x9D031B0C
9D031AA8  340FE003   ORI T7, ZERO, -8189
9D031AAC  3406C003   ORI A2, ZERO, -16381
9D031AB0  508600D0   BEQL A0, A2, 0x9D031DF4
9D031AB4  30A5000F   ANDI A1, A1, 15
9D031AB8  3407C004   ORI A3, ZERO, -16380
9D031ABC  0087402B   SLTU T0, A0, A3
9D031AC0  11000008   BEQ T0, ZERO, 0x9D031AE4
9D031AC4  340FD001   ORI T7, ZERO, -12287
9D031AC8  3409C001   ORI T1, ZERO, -16383
9D031ACC  108900B6   BEQ A0, T1, 0x9D031DA8
9D031AD0  340AC002   ORI T2, ZERO, -16382
9D031AD4  108A00BE   BEQ A0, T2, 0x9D031DD0
9D031AD8  30AB000F   ANDI T3, A1, 15
9D031AE4  108F00D5   BEQ A0, T7, 0x9D031E3C
9D031AE8  3418D002   ORI T8, ZERO, -12286
9D031AEC  0098C82B   SLTU T9, A0, T8
9D031AF0  132000DC   BEQ T9, ZERO, 0x9D031E64
9D031AF4  30A7000F   ANDI A3, A1, 15
9D031AF8  341FD000   ORI RA, ZERO, -12288
9D031AFC  109F00C6   BEQ A0, RA, 0x9D031E18
9D031B00  30A2000F   ANDI V0, A1, 15
9D031B0C  108F013E   BEQ A0, T7, 0x9D032008
9D031B10  3418E004   ORI T8, ZERO, -8188
9D031B14  0098C82B   SLTU T9, A0, T8
9D031B18  1320000A   BEQ T9, ZERO, 0x9D031B44
9D031B1C  341FE001   ORI RA, ZERO, -8191
9D031B20  109F00FF   BEQ A0, RA, 0x9D031F20
9D031B24  3402E002   ORI V0, ZERO, -8190
9D031B28  0082182B   SLTU V1, A0, V0
9D031B2C  10600119   BEQ V1, ZERO, 0x9D031F94
9D031B30  3406E000   ORI A2, ZERO, -8192
9D031B34  508600DE   BEQL A0, A2, 0x9D031EB0
9D031B38  30A7000F   ANDI A3, A1, 15
9D031B44  3419F001   ORI T9, ZERO, -4095
9D031B48  10990152   BEQ A0, T9, 0x9D032094
9D031B4C  341FF002   ORI RA, ZERO, -4094
9D031B50  109F0154   BEQ A0, RA, 0x9D0320A4
9D031B54  3402F000   ORI V0, ZERO, -4096
9D031B58  14820177   BNE A0, V0, 0x9D032138
9D031B5C  8FBF0014   LW RA, 20(SP)
70:                     {
71:                     case 0x8000: VRC_PBANK(0, value, 0); break;
9D031B68  30B9000F   ANDI T9, A1, 15
9D031B6C  A399813C   SB T9, -32452(GP)
9D031B70  93848138   LBU A0, -32456(GP)
9D031B74  0004F900   SLL RA, A0, 4
9D031B78  24040008   ADDIU A0, ZERO, 8
9D031B7C  03F93021   ADDU A2, RA, T9
9D031B80  0F40CA71   JAL mmc_bankrom
9D031B84  34058000   ORI A1, ZERO, -32768
9D031B88  0B40C84E   J 0x9D032138
9D031B8C  8FBF0014   LW RA, 20(SP)
72:                     case 0x8001: VRC_PBANK(0, value, 1); break;
9D031B90  A3858138   SB A1, -32456(GP)
9D031B94  00057900   SLL T7, A1, 4
9D031B98  9398813C   LBU T8, -32452(GP)
9D031B9C  24040008   ADDIU A0, ZERO, 8
9D031BA0  34058000   ORI A1, ZERO, -32768
9D031BA4  0F40CA71   JAL mmc_bankrom
9D031BA8  01F83021   ADDU A2, T7, T8
9D031BAC  0B40C84E   J 0x9D032138
9D031BB0  8FBF0014   LW RA, 20(SP)
73:                     case 0x8002: VRC_PBANK(1, value, 0); break;
9D031BB4  30B8000F   ANDI T8, A1, 15
9D031BB8  A398813D   SB T8, -32451(GP)
9D031BBC  93858139   LBU A1, -32455(GP)
9D031BC0  0005C900   SLL T9, A1, 4
9D031BC4  24040008   ADDIU A0, ZERO, 8
9D031BC8  3405A000   ORI A1, ZERO, -24576
9D031BCC  0F40CA71   JAL mmc_bankrom
9D031BD0  03383021   ADDU A2, T9, T8
9D031BD4  0B40C84E   J 0x9D032138
9D031BD8  8FBF0014   LW RA, 20(SP)
74:                     case 0x8003: VRC_PBANK(1, value, 1); break;
9D031A2C  0B40C6F7   J 0x9D031BDC
9D031A30  30A7000F   ANDI A3, A1, 15
9D031BDC  A3878139   SB A3, -32455(GP)
9D031BE0  00074100   SLL T0, A3, 4
9D031BE4  9389813D   LBU T1, -32451(GP)
9D031BE8  24040008   ADDIU A0, ZERO, 8
9D031BEC  3405A000   ORI A1, ZERO, -24576
9D031BF0  0F40CA71   JAL mmc_bankrom
9D031BF4  01093021   ADDU A2, T0, T1
9D031BF8  0B40C84E   J 0x9D032138
9D031BFC  8FBF0014   LW RA, 20(SP)
75:                     case 0x9000: VRC_PBANK(2, value, 0); break;
9D031C00  30AD000F   ANDI T5, A1, 15
9D031C04  A38D813E   SB T5, -32450(GP)
9D031C08  938E813A   LBU T6, -32454(GP)
9D031C0C  000E7900   SLL T7, T6, 4
9D031C10  24040008   ADDIU A0, ZERO, 8
9D031C14  3405C000   ORI A1, ZERO, -16384
9D031C18  0F40CA71   JAL mmc_bankrom
9D031C1C  01ED3021   ADDU A2, T7, T5
9D031C20  0B40C84E   J 0x9D032138
9D031C24  8FBF0014   LW RA, 20(SP)
76:                     case 0x9001: VRC_PBANK(2, value, 1); break;
9D031C28  30AA000F   ANDI T2, A1, 15
9D031C2C  A38A813A   SB T2, -32454(GP)
9D031C30  000A5900   SLL T3, T2, 4
9D031C34  938C813E   LBU T4, -32450(GP)
9D031C38  24040008   ADDIU A0, ZERO, 8
9D031C3C  3405C000   ORI A1, ZERO, -16384
9D031C40  0F40CA71   JAL mmc_bankrom
9D031C44  016C3021   ADDU A2, T3, T4
9D031C48  0B40C84E   J 0x9D032138
9D031C4C  8FBF0014   LW RA, 20(SP)
77:                     case 0xA000: VRC_VBANK(0, value, 0); break;
9D031C50  30AF000F   ANDI T7, A1, 15
9D031C54  A38F8148   SB T7, -32440(GP)
9D031C58  93988140   LBU T8, -32448(GP)
9D031C5C  0018C900   SLL T9, T8, 4
9D031C60  24040001   ADDIU A0, ZERO, 1
9D031C64  00002821   ADDU A1, ZERO, ZERO
9D031C68  0F40CA16   JAL mmc_bankvrom
9D031C6C  032F3021   ADDU A2, T9, T7
9D031C70  0B40C84E   J 0x9D032138
9D031C74  8FBF0014   LW RA, 20(SP)
78:                     case 0xA001: VRC_VBANK(0, value, 1); break;
9D031C78  30AB000F   ANDI T3, A1, 15
9D031C7C  A38B8140   SB T3, -32448(GP)
9D031C80  000B6100   SLL T4, T3, 4
9D031C84  938D8148   LBU T5, -32440(GP)
9D031C88  24040001   ADDIU A0, ZERO, 1
9D031C8C  00002821   ADDU A1, ZERO, ZERO
9D031C90  0F40CA16   JAL mmc_bankvrom
9D031C94  018D3021   ADDU A2, T4, T5
9D031C98  0B40C84E   J 0x9D032138
9D031C9C  8FBF0014   LW RA, 20(SP)
79:                     case 0xA002: VRC_VBANK(1, value, 0); break;
9D031CA0  A38E8149   SB T6, -32439(GP)
9D031CA4  938F8141   LBU T7, -32447(GP)
9D031CA8  000FC100   SLL T8, T7, 4
9D031CAC  24040001   ADDIU A0, ZERO, 1
9D031CB0  24050400   ADDIU A1, ZERO, 1024
9D031CB4  0F40CA16   JAL mmc_bankvrom
9D031CB8  030E3021   ADDU A2, T8, T6
9D031CBC  0B40C84E   J 0x9D032138
9D031CC0  8FBF0014   LW RA, 20(SP)
80:                     case 0xA003: VRC_VBANK(1, value, 1); break;
9D031CC4  A3848141   SB A0, -32447(GP)
9D031CC8  00044900   SLL T1, A0, 4
9D031CCC  938A8149   LBU T2, -32439(GP)
9D031CD0  24040001   ADDIU A0, ZERO, 1
9D031CD4  24050400   ADDIU A1, ZERO, 1024
9D031CD8  0F40CA16   JAL mmc_bankvrom
9D031CDC  012A3021   ADDU A2, T1, T2
9D031CE0  0B40C84E   J 0x9D032138
9D031CE4  8FBF0014   LW RA, 20(SP)
81:                     case 0xB000: VRC_VBANK(2, value, 0); break;
9D031CE8  30AC000F   ANDI T4, A1, 15
9D031CEC  A38C814A   SB T4, -32438(GP)
9D031CF0  938D8142   LBU T5, -32446(GP)
9D031CF4  000D7100   SLL T6, T5, 4
9D031CF8  24040001   ADDIU A0, ZERO, 1
9D031CFC  24050800   ADDIU A1, ZERO, 2048
9D031D00  0F40CA16   JAL mmc_bankvrom
9D031D04  01CC3021   ADDU A2, T6, T4
9D031D08  0B40C84E   J 0x9D032138
9D031D0C  8FBF0014   LW RA, 20(SP)
82:                     case 0xB001: VRC_VBANK(2, value, 1); break;
9D031D10  30A7000F   ANDI A3, A1, 15
9D031D14  A3878142   SB A3, -32446(GP)
9D031D18  00074100   SLL T0, A3, 4
9D031D1C  9389814A   LBU T1, -32438(GP)
9D031D20  24040001   ADDIU A0, ZERO, 1
9D031D24  24050800   ADDIU A1, ZERO, 2048
9D031D28  0F40CA16   JAL mmc_bankvrom
9D031D2C  01093021   ADDU A2, T0, T1
9D031D30  0B40C84E   J 0x9D032138
9D031D34  8FBF0014   LW RA, 20(SP)
83:                     case 0xB002: VRC_VBANK(3, value, 0); break;
9D031D38  A38A814B   SB T2, -32437(GP)
9D031D3C  93848143   LBU A0, -32445(GP)
9D031D40  00045900   SLL T3, A0, 4
9D031D44  24040001   ADDIU A0, ZERO, 1
9D031D48  24050C00   ADDIU A1, ZERO, 3072
9D031D4C  0F40CA16   JAL mmc_bankvrom
9D031D50  016A3021   ADDU A2, T3, T2
9D031D54  0B40C84E   J 0x9D032138
9D031D58  8FBF0014   LW RA, 20(SP)
84:                     case 0xB003: VRC_VBANK(3, value, 1); break;
9D031D5C  A3858143   SB A1, -32445(GP)
9D031D60  00051900   SLL V1, A1, 4
9D031D64  9386814B   LBU A2, -32437(GP)
9D031D68  24040001   ADDIU A0, ZERO, 1
9D031D6C  24050C00   ADDIU A1, ZERO, 3072
9D031D70  0F40CA16   JAL mmc_bankvrom
9D031D74  00663021   ADDU A2, V1, A2
9D031D78  0B40C84E   J 0x9D032138
9D031D7C  8FBF0014   LW RA, 20(SP)
85:                     case 0xC000: VRC_VBANK(4, value, 0); break;
9D031D80  30A2000F   ANDI V0, A1, 15
9D031D84  A382814C   SB V0, -32436(GP)
9D031D88  93868144   LBU A2, -32444(GP)
9D031D8C  00061900   SLL V1, A2, 4
9D031D90  24040001   ADDIU A0, ZERO, 1
9D031D94  24051000   ADDIU A1, ZERO, 4096
9D031D98  0F40CA16   JAL mmc_bankvrom
9D031D9C  00623021   ADDU A2, V1, V0
9D031DA0  0B40C84E   J 0x9D032138
9D031DA4  8FBF0014   LW RA, 20(SP)
86:                     case 0xC001: VRC_VBANK(4, value, 1); break;
9D031DA8  30A4000F   ANDI A0, A1, 15
9D031DAC  A3848144   SB A0, -32444(GP)
9D031DB0  00046900   SLL T5, A0, 4
9D031DB4  938E814C   LBU T6, -32436(GP)
9D031DB8  24040001   ADDIU A0, ZERO, 1
9D031DBC  24051000   ADDIU A1, ZERO, 4096
9D031DC0  0F40CA16   JAL mmc_bankvrom
9D031DC4  01AE3021   ADDU A2, T5, T6
9D031DC8  0B40C84E   J 0x9D032138
9D031DCC  8FBF0014   LW RA, 20(SP)
87:                     case 0xC002: VRC_VBANK(5, value, 0); break;
9D031DD0  A38B814D   SB T3, -32435(GP)
9D031DD4  93858145   LBU A1, -32443(GP)
9D031DD8  00056100   SLL T4, A1, 4
9D031DDC  24040001   ADDIU A0, ZERO, 1
9D031DE0  24051400   ADDIU A1, ZERO, 5120
9D031DE4  0F40CA16   JAL mmc_bankvrom
9D031DE8  018B3021   ADDU A2, T4, T3
9D031DEC  0B40C84E   J 0x9D032138
9D031DF0  8FBF0014   LW RA, 20(SP)
88:                     case 0xC003: VRC_VBANK(5, value, 1); break;
9D031DF4  A3858145   SB A1, -32443(GP)
9D031DF8  00056900   SLL T5, A1, 4
9D031DFC  938E814D   LBU T6, -32435(GP)
9D031E00  24040001   ADDIU A0, ZERO, 1
9D031E04  24051400   ADDIU A1, ZERO, 5120
9D031E08  0F40CA16   JAL mmc_bankvrom
9D031E0C  01AE3021   ADDU A2, T5, T6
9D031E10  0B40C84E   J 0x9D032138
9D031E14  8FBF0014   LW RA, 20(SP)
89:                     case 0xD000: VRC_VBANK(6, value, 0); break;
9D031E18  A382814E   SB V0, -32434(GP)
9D031E1C  93838146   LBU V1, -32442(GP)
9D031E20  00033100   SLL A2, V1, 4
9D031E24  24040001   ADDIU A0, ZERO, 1
9D031E28  24051800   ADDIU A1, ZERO, 6144
9D031E2C  0F40CA16   JAL mmc_bankvrom
9D031E30  00C23021   ADDU A2, A2, V0
9D031E34  0B40C84E   J 0x9D032138
9D031E38  8FBF0014   LW RA, 20(SP)
90:                     case 0xD001: VRC_VBANK(6, value, 1); break;
9D031E3C  30AA000F   ANDI T2, A1, 15
9D031E40  A38A8146   SB T2, -32442(GP)
9D031E44  000A5900   SLL T3, T2, 4
9D031E48  938C814E   LBU T4, -32434(GP)
9D031E4C  24040001   ADDIU A0, ZERO, 1
9D031E50  24051800   ADDIU A1, ZERO, 6144
9D031E54  0F40CA16   JAL mmc_bankvrom
9D031E58  016C3021   ADDU A2, T3, T4
9D031E5C  0B40C84E   J 0x9D032138
9D031E60  8FBF0014   LW RA, 20(SP)
91:                     case 0xD002: VRC_VBANK(7, value, 0); break;
9D031E64  A387814F   SB A3, -32433(GP)
9D031E68  93888147   LBU T0, -32441(GP)
9D031E6C  00084900   SLL T1, T0, 4
9D031E70  24040001   ADDIU A0, ZERO, 1
9D031E74  24051C00   ADDIU A1, ZERO, 7168
9D031E78  0F40CA16   JAL mmc_bankvrom
9D031E7C  01273021   ADDU A2, T1, A3
9D031E80  0B40C84E   J 0x9D032138
9D031E84  8FBF0014   LW RA, 20(SP)
92:                     case 0xD003: VRC_VBANK(7, value, 1); break;
9D031E88  30B8000F   ANDI T8, A1, 15
9D031E8C  A3988147   SB T8, -32441(GP)
9D031E90  0018C900   SLL T9, T8, 4
9D031E94  939F814F   LBU RA, -32433(GP)
9D031E98  24040001   ADDIU A0, ZERO, 1
9D031E9C  033F3021   ADDU A2, T9, RA
9D031EA0  0F40CA16   JAL mmc_bankvrom
9D031EA4  24051C00   ADDIU A1, ZERO, 7168
9D031EA8  0B40C84E   J 0x9D032138
9D031EAC  8FBF0014   LW RA, 20(SP)
93:                     case 0xE000:
94:                        irq.nybbles[0]=value&0x0F;
9D031EB0  3C04A001   LUI A0, -24575
9D031EB4  248858EC   ADDIU T0, A0, 22764
9D031EB8  A1070008   SB A3, 8(T0)
95:                        irq.clockticks= (irq.nybbles[0]) | (irq.nybbles[1]<<4) |
9D031EC4  910B0009   LBU T3, 9(T0)
9D031EC8  000B6100   SLL T4, T3, 4
9D031ECC  014C2825   OR A1, T2, T4
9D031ED8  00AE7825   OR T7, A1, T6
96:                                       (irq.nybbles[2]<<8) | (irq.nybbles[3]<<12);
9D031EBC  9109000A   LBU T1, 10(T0)
9D031EC0  00095200   SLL T2, T1, 8
9D031ED0  910D000B   LBU T5, 11(T0)
9D031ED4  000D7300   SLL T6, T5, 12
9D031EDC  01E7C025   OR T8, T7, A3
97:                        irq.counter=(uint8)(irq.clockticks/114);
9D031EE0  3C198FB8   LUI T9, -28744
9D031EE4  273F23EF   ADDIU RA, T9, 9199
9D031EE8  031F0018   MULT 0, T8, RA
9D031EEC  00001010   MFHI V0
9D031EF0  00581821   ADDU V1, V0, T8
9D031EF4  7C663980   EXT A2, V1, 6, 8
9D031F04  3C04A001   LUI A0, -24575
9D031F08  0B40C84D   J .LVL110
9D031F0C  AC8658EC   SW A2, 22764(A0)
98:                        if(irq.counter>15) irq.counter-=16;
9D031EF8  28C70010   SLTI A3, A2, 16
9D031EFC  10E00004   BEQ A3, ZERO, 0x9D031F10
9D031F00  AD18000C   SW T8, 12(T0)
9D031F10  24C8FFF0   ADDIU T0, A2, -16
9D031F14  3C09A001   LUI T1, -24575
9D031F18  0B40C84D   J .LVL110
9D031F1C  AD2858EC   SW T0, 22764(T1)
99:                        break;
100:                    case 0xE001:
101:                       irq.nybbles[1]=value&0x0F;
9D031F20  30AD000F   ANDI T5, A1, 15
9D031F24  3C0EA001   LUI T6, -24575
9D031F28  25CF58EC   ADDIU T7, T6, 22764
9D031F2C  A1ED0009   SB T5, 9(T7)
102:                       irq.clockticks= (irq.nybbles[0]) | (irq.nybbles[1]<<4) |
9D031F40  03223025   OR A2, T9, V0
9D031F44  91E30008   LBU V1, 8(T7)
9D031F48  00C33825   OR A3, A2, V1
9D031F4C  000D2100   SLL A0, T5, 4
103:                                      (irq.nybbles[2]<<8) | (irq.nybbles[3]<<12);
9D031F30  91F8000A   LBU T8, 10(T7)
9D031F34  0018CA00   SLL T9, T8, 8
9D031F38  91FF000B   LBU RA, 11(T7)
9D031F3C  001F1300   SLL V0, RA, 12
9D031F50  00E44025   OR T0, A3, A0
104:                       irq.counter=(uint8)(irq.clockticks/114);
9D031F54  3C098FB8   LUI T1, -28744
9D031F58  252A23EF   ADDIU T2, T1, 9199
9D031F5C  010A0018   MULT 0, T0, T2
9D031F60  00005810   MFHI T3
9D031F64  01686021   ADDU T4, T3, T0
9D031F68  7D853980   EXT A1, T4, 6, 8
9D031F78  3C0EA001   LUI T6, -24575
9D031F7C  0B40C84D   J .LVL110
9D031F80  ADC558EC   SW A1, 22764(T6)
105:                       if(irq.counter>15) irq.counter-=16;
9D031F6C  28AD0010   SLTI T5, A1, 16
9D031F70  11A00004   BEQ T5, ZERO, 0x9D031F84
9D031F74  ADE8000C   SW T0, 12(T7)
9D031F84  24AFFFF0   ADDIU T7, A1, -16
9D031F88  3C18A001   LUI T8, -24575
9D031F8C  0B40C84D   J .LVL110
9D031F90  AF0F58EC   SW T7, 22764(T8)
106:                       break;
107:                    case 0xE002:
108:                       irq.nybbles[2]=value&0x0F;
9D031F94  30AA000F   ANDI T2, A1, 15
9D031F98  3C0BA001   LUI T3, -24575
9D031F9C  256C58EC   ADDIU T4, T3, 22764
9D031FA0  A18A000A   SB T2, 10(T4)
109:                       irq.clockticks= (irq.nybbles[0]) | (irq.nybbles[1]<<4) |
9D031FA4  91850009   LBU A1, 9(T4)
9D031FA8  00056900   SLL T5, A1, 4
9D031FB4  01AFC025   OR T8, T5, T7
9D031FB8  91990008   LBU T9, 8(T4)
9D031FBC  0319F825   OR RA, T8, T9
110:                                      (irq.nybbles[2]<<8) | (irq.nybbles[3]<<12);
9D031FAC  918E000B   LBU T6, 11(T4)
9D031FB0  000E7B00   SLL T7, T6, 12
9D031FC0  000A1200   SLL V0, T2, 8
9D031FC4  03E21825   OR V1, RA, V0
111:                       irq.counter=(uint8)(irq.clockticks/114);
9D031FC8  3C068FB8   LUI A2, -28744
9D031FCC  24C723EF   ADDIU A3, A2, 9199
9D031FD0  00670018   MULT 0, V1, A3
9D031FD4  00002010   MFHI A0
9D031FD8  00834021   ADDU T0, A0, V1
9D031FDC  7D093980   EXT T1, T0, 6, 8
9D031FEC  3C0BA001   LUI T3, -24575
9D031FF0  0B40C84D   J .LVL110
9D031FF4  AD6958EC   SW T1, 22764(T3)
112:                       if(irq.counter>15) irq.counter-=16;
9D031FE0  292A0010   SLTI T2, T1, 16
9D031FE4  11400004   BEQ T2, ZERO, 0x9D031FF8
9D031FE8  AD83000C   SW V1, 12(T4)
9D031FF8  252CFFF0   ADDIU T4, T1, -16
9D031FFC  3C05A001   LUI A1, -24575
9D032000  0B40C84D   J .LVL110
9D032004  ACAC58EC   SW T4, 22764(A1)
113:                       break;
114:                    case 0xE003:
115:                       irq.nybbles[3]=value&0x0F;
9D032008  30A5000F   ANDI A1, A1, 15
9D03200C  3C0DA001   LUI T5, -24575
9D032010  25AE58EC   ADDIU T6, T5, 22764
9D032014  A1C5000B   SB A1, 11(T6)
116:                       irq.clockticks= (irq.nybbles[0]) | (irq.nybbles[1]<<4) |
9D032018  91CF0009   LBU T7, 9(T6)
9D03201C  000FC100   SLL T8, T7, 4
9D032028  031F1025   OR V0, T8, RA
9D03202C  91C60008   LBU A2, 8(T6)
9D032030  00461825   OR V1, V0, A2
117:                                      (irq.nybbles[2]<<8) | (irq.nybbles[3]<<12);
9D032020  91D9000A   LBU T9, 10(T6)
9D032024  0019FA00   SLL RA, T9, 8
9D032034  00053B00   SLL A3, A1, 12
9D032038  00672025   OR A0, V1, A3
118:                       irq.counter=(uint8)(irq.clockticks/114);
9D03203C  3C088FB8   LUI T0, -28744
9D032040  250923EF   ADDIU T1, T0, 9199
9D032044  00890018   MULT 0, A0, T1
9D032048  00005010   MFHI T2
9D03204C  01445821   ADDU T3, T2, A0
9D032050  7D6C3980   EXT T4, T3, 6, 8
9D032060  3C0DA001   LUI T5, -24575
9D032064  0B40C84D   J .LVL110
9D032068  ADAC58EC   SW T4, 22764(T5)
119:                       if(irq.counter>15) irq.counter-=16;
9D032054  29850010   SLTI A1, T4, 16
9D032058  10A00004   BEQ A1, ZERO, 0x9D03206C
9D03205C  ADC4000C   SW A0, 12(T6)
9D03206C  258EFFF0   ADDIU T6, T4, -16
9D032070  3C0FA001   LUI T7, -24575
9D032074  0B40C84D   J .LVL110
9D032078  ADEE58EC   SW T6, 22764(T7)
120:                       break;
121:                    case 0xF000:
122:                       if(value&0x01) irq.enabled=true;
9D031B60  0B40C81F   J 0x9D03207C
9D031B64  30A60001   ANDI A2, A1, 1
9D03207C  10C0002E   BEQ A2, ZERO, 0x9D032138
9D032080  8FBF0014   LW RA, 20(SP)
9D032084  24030001   ADDIU V1, ZERO, 1
9D032088  3C07A001   LUI A3, -24575
9D03208C  0B40C84D   J .LVL110
9D032090  ACE358F0   SW V1, 22768(A3)
123:                       break;
124:                    case 0xF001: 
125:                       irq.enabled=value&0x01;
9D032094  30AB0001   ANDI T3, A1, 1
9D032098  3C0CA001   LUI T4, -24575
126:                       break;
9D03209C  0B40C84D   J .LVL110
9D0320A0  AD8B58F0   SW T3, 22768(T4)
127:                    case 0xF002: 
128:                       switch(value&0x03)
9D0320A4  30A40003   ANDI A0, A1, 3
9D0320A8  24080001   ADDIU T0, ZERO, 1
9D0320AC  50880010   BEQL A0, T0, 0x9D0320F0
9D0320B0  00002021   ADDU A0, ZERO, ZERO
9D0320B4  10800007   BEQ A0, ZERO, 0x9D0320D4
9D0320B8  24090002   ADDIU T1, ZERO, 2
9D0320BC  10890012   BEQ A0, T1, 0x9D032108
9D0320C0  240A0003   ADDIU T2, ZERO, 3
9D0320C4  108A0017   BEQ A0, T2, 0x9D032124
9D0320C8  24040001   ADDIU A0, ZERO, 1
129:                       {
130:                       case 0:  ppu_mirror(0, 0, 1, 1); break;
9D0320D4  00002021   ADDU A0, ZERO, ZERO
9D0320D8  00002821   ADDU A1, ZERO, ZERO
9D0320DC  24060001   ADDIU A2, ZERO, 1
9D0320E0  0F4058FD   JAL ppu_mirror
9D0320E4  24070001   ADDIU A3, ZERO, 1
9D0320E8  0B40C84E   J 0x9D032138
9D0320EC  8FBF0014   LW RA, 20(SP)
131:                       case 1:  ppu_mirror(0, 1, 0, 1); break;
9D0320F0  24050001   ADDIU A1, ZERO, 1
9D0320F4  00003021   ADDU A2, ZERO, ZERO
9D0320F8  0F4058FD   JAL ppu_mirror
9D0320FC  24070001   ADDIU A3, ZERO, 1
9D032100  0B40C84E   J 0x9D032138
9D032104  8FBF0014   LW RA, 20(SP)
132:                       case 2:  ppu_mirror(1,1,1,1);break;
9D032108  24040001   ADDIU A0, ZERO, 1
9D03210C  24050001   ADDIU A1, ZERO, 1
9D032110  24060001   ADDIU A2, ZERO, 1
9D032114  0F4058FD   JAL ppu_mirror
9D032118  24070001   ADDIU A3, ZERO, 1
9D03211C  0B40C84E   J 0x9D032138
9D032120  8FBF0014   LW RA, 20(SP)
133:                       case 3:  ppu_mirror(1,1,1,1);break; // should this be zero?
9D032124  24050001   ADDIU A1, ZERO, 1
9D032128  24060001   ADDIU A2, ZERO, 1
9D03212C  0F4058FD   JAL ppu_mirror
9D032130  24070001   ADDIU A3, ZERO, 1
134:                       default: break;
135:                       }
136:                       break;
137:                    default:
138:                       break;
139:                    }
140:                 }
9D031A0C  0B40C84E   J 0x9D032138
9D031A10  8FBF0014   LW RA, 20(SP)
9D031A64  0B40C84E   J 0x9D032138
9D031A68  8FBF0014   LW RA, 20(SP)
9D031A8C  0B40C84E   J 0x9D032138
9D031A90  8FBF0014   LW RA, 20(SP)
9D031ADC  0B40C84E   J 0x9D032138
9D031AE0  8FBF0014   LW RA, 20(SP)
9D031B04  0B40C84E   J 0x9D032138
9D031B08  8FBF0014   LW RA, 20(SP)
9D031B3C  0B40C84E   J 0x9D032138
9D031B40  8FBF0014   LW RA, 20(SP)
9D0320CC  0B40C84E   J 0x9D032138
9D0320D0  8FBF0014   LW RA, 20(SP)
9D032134  8FBF0014   LW RA, 20(SP)
9D032138  03E00008   JR RA
9D03213C  27BD0018   ADDIU SP, SP, 24
141:                 
142:                 
143:                 static map_memwrite map18_memwrite[] =
144:                 {
145:                    { 0x8000, 0xFFFF, map18_write },
146:                    {     -1,     -1, NULL }
147:                 };
148:                 
149:                 static void map18_getstate(SnssMapperBlock *state)
150:                 {
151:                    state->extraData.mapper18.irqCounterLowByte = irq.counter & 0xFF;
9D031960  3C02A001   LUI V0, -24575
9D031964  8C4358EC   LW V1, 22764(V0)
9D031968  A0830018   SB V1, 24(A0)
152:                    state->extraData.mapper18.irqCounterHighByte = irq.counter >> 8;
9D03196C  00032A03   SRA A1, V1, 8
9D031970  A0850019   SB A1, 25(A0)
153:                    state->extraData.mapper18.irqCounterEnabled = irq.enabled;
9D031974  244658EC   ADDIU A2, V0, 22764
9D031978  8CC70004   LW A3, 4(A2)
9D03197C  03E00008   JR RA
9D031980  A087001A   SB A3, 26(A0)
154:                 }
155:                 
156:                 static void map18_setstate(SnssMapperBlock *state)
157:                 {
158:                    irq.counter = (state->extraData.mapper18.irqCounterHighByte << 8)
9D031984  3C02A001   LUI V0, -24575
9D031988  90830019   LBU V1, 25(A0)
9D03198C  00033200   SLL A2, V1, 8
9D031998  AC4758EC   SW A3, 22764(V0)
159:                                        | state->extraData.mapper18.irqCounterLowByte;
9D031990  90850018   LBU A1, 24(A0)
9D031994  00C53825   OR A3, A2, A1
160:                    irq.enabled = state->extraData.mapper18.irqCounterEnabled;
9D03199C  244858EC   ADDIU T0, V0, 22764
9D0319A0  9084001A   LBU A0, 26(A0)
9D0319A4  03E00008   JR RA
9D0319A8  AD040004   SW A0, 4(T0)
161:                 }
162:                 
163:                 mapintf_t map18_intf =
164:                 {
165:                    18, /* mapper number */
166:                    "Jaleco SS8806", /* mapper name */
167:                    map18_init, /* init routine */
168:                    NULL, /* vblank callback */
169:                    NULL, /* hblank callback */
170:                    map18_getstate, /* get state (snss) */
171:                    map18_setstate, /* set state (snss) */
172:                    NULL, /* memory read structure */
173:                    map18_memwrite, /* memory write structure */
174:                    NULL /* external sound device */
175:                 };
176:                 
177:                 /*
178:                 ** $Log: map018.c,v $
179:                 ** Revision 1.2  2001/04/27 14:37:11  neil
180:                 ** wheeee
181:                 **
182:                 ** Revision 1.1  2001/04/27 12:54:40  neil
183:                 ** blah
184:                 **
185:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
186:                 ** initial
187:                 **
188:                 ** Revision 1.1  2000/10/24 12:19:33  matt
189:                 ** changed directory structure
190:                 **
191:                 ** Revision 1.8  2000/10/22 19:17:46  matt
192:                 ** mapper cleanups galore
193:                 **
194:                 ** Revision 1.7  2000/10/22 15:03:13  matt
195:                 ** simplified mirroring
196:                 **
197:                 ** Revision 1.6  2000/10/21 19:33:38  matt
198:                 ** many more cleanups
199:                 **
200:                 ** Revision 1.5  2000/10/10 13:58:17  matt
201:                 ** stroustrup squeezing his way in the door
202:                 **
203:                 ** Revision 1.4  2000/07/15 23:52:19  matt
204:                 ** rounded out a bunch more mapper interfaces
205:                 **
206:                 ** Revision 1.3  2000/07/10 05:29:03  matt
207:                 ** cleaned up some mirroring issues
208:                 **
209:                 ** Revision 1.2  2000/07/06 02:48:42  matt
210:                 ** clearly labelled structure members
211:                 **
212:                 ** Revision 1.1  2000/07/06 01:01:56  matt
213:                 ** initial revision
214:                 **
215:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map016.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map16.c
21:                  **
22:                  ** mapper 16 interface
23:                  ** $Id: map016.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes_ppu.h>
29:                  #include <nes.h>
30:                  
31:                  static struct
32:                  {
33:                     int counter;
34:                     bool enabled;
35:                  } irq;
36:                  
37:                  /* mapper 16: Bandai */
38:                  
39:                  static void map16_init(void)
40:                  {
9D03B708  27BDFFE8   ADDIU SP, SP, -24
9D03B70C  AFBF0014   SW RA, 20(SP)
41:                     mmc_bankrom(16, 0x8000, 0);
9D03B710  24040010   ADDIU A0, ZERO, 16
9D03B714  34058000   ORI A1, ZERO, -32768
9D03B718  0F40CA71   JAL mmc_bankrom
9D03B71C  00003021   ADDU A2, ZERO, ZERO
42:                     mmc_bankrom(16, 0xC000, MMC_LASTBANK);
9D03B720  24040010   ADDIU A0, ZERO, 16
9D03B724  3405C000   ORI A1, ZERO, -16384
9D03B728  0F40CA71   JAL mmc_bankrom
9D03B72C  2406FFFF   ADDIU A2, ZERO, -1
43:                     irq.counter = 0;
9D03B730  AF808150   SW ZERO, -32432(GP)
44:                     irq.enabled = false;
9D03B734  AF808154   SW ZERO, -32428(GP)
45:                  }
9D03B738  8FBF0014   LW RA, 20(SP)
9D03B73C  03E00008   JR RA
9D03B740  27BD0018   ADDIU SP, SP, 24
46:                  
47:                  static void map16_write(uint32 address, uint8 value)
48:                  {
9D03B744  27BDFFE8   ADDIU SP, SP, -24
9D03B748  00A03021   ADDU A2, A1, ZERO
49:                     int reg = address & 0xF;
9D03B74C  3085000F   ANDI A1, A0, 15
50:                  
51:                     if (reg < 8)
9D03B750  28A30008   SLTI V1, A1, 8
9D03B754  10600006   BEQ V1, ZERO, 0x9D03B770
9D03B758  AFBF0014   SW RA, 20(SP)
52:                     {
53:                        mmc_bankvrom(1, reg << 10, value);
9D03B75C  24040001   ADDIU A0, ZERO, 1
9D03B760  0F40CA16   JAL mmc_bankvrom
9D03B764  00052A80   SLL A1, A1, 10
9D03B768  0B40EE24   J 0x9D03B890
9D03B76C  8FBF0014   LW RA, 20(SP)
54:                     }
55:                     else
56:                     {
57:                        switch (address & 0x000F)
9D03B770  3084000F   ANDI A0, A0, 15
9D03B774  2487FFF8   ADDIU A3, A0, -8
9D03B778  2CE20005   SLTIU V0, A3, 5
9D03B77C  10400043   BEQ V0, ZERO, 0x9D03B88C
9D03B780  00074080   SLL T0, A3, 2
9D03B784  3C099D04   LUI T1, -25340
9D03B788  252AB79C   ADDIU T2, T1, -18532
9D03B78C  01485821   ADDU T3, T2, T0
9D03B790  8D6C0000   LW T4, 0(T3)
9D03B794  01800008   JR T4
9D03B798  00000000   NOP
58:                        {
59:                        case 0x8:
60:                           mmc_bankrom(16, 0x8000, value);
9D03B7B0  24040010   ADDIU A0, ZERO, 16
9D03B7B4  0F40CA71   JAL mmc_bankrom
9D03B7B8  34058000   ORI A1, ZERO, -32768
61:                           break;
9D03B7BC  0B40EE24   J 0x9D03B890
9D03B7C0  8FBF0014   LW RA, 20(SP)
62:                  
63:                        case 0x9:
64:                           switch (value & 3)
9D03B7C4  30D90003   ANDI T9, A2, 3
9D03B7C8  241F0001   ADDIU RA, ZERO, 1
9D03B7CC  133F000F   BEQ T9, RA, 0x9D03B80C
9D03B7D0  00002021   ADDU A0, ZERO, ZERO
9D03B7D4  13200007   BEQ T9, ZERO, 0x9D03B7F4
9D03B7D8  24050002   ADDIU A1, ZERO, 2
9D03B7DC  13250011   BEQ T9, A1, 0x9D03B824
9D03B7E0  24030003   ADDIU V1, ZERO, 3
9D03B7E4  13230015   BEQ T9, V1, 0x9D03B83C
9D03B7E8  24040001   ADDIU A0, ZERO, 1
65:                           {
66:                           case 0:
67:                              ppu_mirror(0, 0, 1, 1); /* horizontal */
9D03B7F4  00002821   ADDU A1, ZERO, ZERO
9D03B7F8  24060001   ADDIU A2, ZERO, 1
9D03B7FC  0F4058FD   JAL ppu_mirror
9D03B800  24070001   ADDIU A3, ZERO, 1
68:                              break;
9D03B804  0B40EE24   J 0x9D03B890
9D03B808  8FBF0014   LW RA, 20(SP)
69:                        
70:                           case 1:
71:                              ppu_mirror(0, 1, 0, 1); /* vertical */
9D03B80C  24050001   ADDIU A1, ZERO, 1
9D03B810  00003021   ADDU A2, ZERO, ZERO
9D03B814  0F4058FD   JAL ppu_mirror
9D03B818  24070001   ADDIU A3, ZERO, 1
72:                              break;
9D03B81C  0B40EE24   J 0x9D03B890
9D03B820  8FBF0014   LW RA, 20(SP)
73:                        
74:                           case 2:
75:                              ppu_mirror(0, 0, 0, 0);
9D03B824  00002821   ADDU A1, ZERO, ZERO
9D03B828  00003021   ADDU A2, ZERO, ZERO
9D03B82C  0F4058FD   JAL ppu_mirror
9D03B830  00003821   ADDU A3, ZERO, ZERO
76:                              break;
9D03B834  0B40EE24   J 0x9D03B890
9D03B838  8FBF0014   LW RA, 20(SP)
77:                        
78:                           case 3:
79:                              ppu_mirror(1, 1, 1, 1);
9D03B83C  24050001   ADDIU A1, ZERO, 1
9D03B840  24060001   ADDIU A2, ZERO, 1
9D03B844  0F4058FD   JAL ppu_mirror
9D03B848  24070001   ADDIU A3, ZERO, 1
80:                              break;
9D03B84C  0B40EE24   J 0x9D03B890
9D03B850  8FBF0014   LW RA, 20(SP)
81:                           }
82:                           break;
83:                     
84:                        case 0xA:
85:                           irq.enabled = (value & 1) ? true : false;
9D03B854  30D80001   ANDI T8, A2, 1
86:                           break;
9D03B858  0B40EE23   J 0x9D03B88C
9D03B85C  AF988154   SW T8, -32428(GP)
87:                   
88:                        case 0xB:
89:                           irq.counter = (irq.counter & 0xFF00) | value;
9D03B860  278D8150   ADDIU T5, GP, -32432
9D03B864  8DAE0000   LW T6, 0(T5)
9D03B868  31CFFF00   ANDI T7, T6, -256
9D03B86C  00CF3025   OR A2, A2, T7
90:                           break;
9D03B870  0B40EE23   J 0x9D03B88C
9D03B874  ADA60000   SW A2, 0(T5)
91:                     
92:                        case 0xC:
93:                           irq.counter = (value << 8) | (irq.counter & 0xFF);
9D03B878  27848150   ADDIU A0, GP, -32432
9D03B87C  00063A00   SLL A3, A2, 8
9D03B880  90820000   LBU V0, 0(A0)
9D03B884  00E24025   OR T0, A3, V0
9D03B888  AC880000   SW T0, 0(A0)
94:                           break;
95:                     
96:                        case 0xD:
97:                           /* eeprom I/O port? */
98:                           break;
99:                        }
100:                    }
101:                 }
9D03B7EC  0B40EE24   J 0x9D03B890
9D03B7F0  8FBF0014   LW RA, 20(SP)
9D03B88C  8FBF0014   LW RA, 20(SP)
9D03B890  03E00008   JR RA
9D03B894  27BD0018   ADDIU SP, SP, 24
102:                 
103:                 static void map16_hblank(int vblank)
104:                 {
9D03B898  27BDFFE8   ADDIU SP, SP, -24
9D03B89C  AFBF0014   SW RA, 20(SP)
105:                    UNUSED(vblank);
106:                 
107:                    if (irq.enabled)
9D03B8A0  8F828154   LW V0, -32428(GP)
9D03B8A4  10400007   BEQ V0, ZERO, .LVL27
9D03B8A8  8F838150   LW V1, -32432(GP)
108:                    {
109:                       if (irq.counter)
9D03B8AC  10600005   BEQ V1, ZERO, .LVL27
9D03B8B0  2464FFFF   ADDIU A0, V1, -1
110:                       {
111:                          if (0 == --irq.counter)
9D03B8B4  14800003   BNE A0, ZERO, .LVL27
9D03B8B8  AF848150   SW A0, -32432(GP)
112:                             nes_irq();
9D03B8BC  0F40975F   JAL nes_irq
9D03B8C0  00000000   NOP
113:                       }
114:                    }
115:                 }
9D03B8C4  8FBF0014   LW RA, 20(SP)
9D03B8C8  03E00008   JR RA
9D03B8CC  27BD0018   ADDIU SP, SP, 24
116:                 
117:                 static void map16_getstate(SnssMapperBlock *state)
118:                 {
119:                    state->extraData.mapper16.irqCounterLowByte = irq.counter & 0xFF;
9D03B6CC  8F828150   LW V0, -32432(GP)
9D03B6D0  A0820018   SB V0, 24(A0)
120:                    state->extraData.mapper16.irqCounterHighByte = irq.counter >> 8;
9D03B6D4  00021A03   SRA V1, V0, 8
9D03B6D8  A0830019   SB V1, 25(A0)
121:                    state->extraData.mapper16.irqCounterEnabled = irq.enabled;
9D03B6DC  8F858154   LW A1, -32428(GP)
9D03B6E0  03E00008   JR RA
9D03B6E4  A085001A   SB A1, 26(A0)
122:                 }
123:                 
124:                 static void map16_setstate(SnssMapperBlock *state)
125:                 {
126:                    irq.counter = (state->extraData.mapper16.irqCounterHighByte << 8)
9D03B6E8  90820019   LBU V0, 25(A0)
9D03B6EC  00022A00   SLL A1, V0, 8
9D03B6F8  AF868150   SW A2, -32432(GP)
127:                                        | state->extraData.mapper16.irqCounterLowByte;
9D03B6F0  90830018   LBU V1, 24(A0)
9D03B6F4  00A33025   OR A2, A1, V1
128:                    irq.enabled = state->extraData.mapper16.irqCounterEnabled;
9D03B6FC  9084001A   LBU A0, 26(A0)
9D03B700  03E00008   JR RA
9D03B704  AF848154   SW A0, -32428(GP)
129:                 }
130:                 
131:                 static map_memwrite map16_memwrite[] =
132:                 {
133:                    { 0x6000, 0x600D, map16_write },
134:                    { 0x7FF0, 0x7FFD, map16_write },
135:                    { 0x8000, 0x800D, map16_write },
136:                    {     -1,     -1, NULL }
137:                 };
138:                 
139:                 mapintf_t map16_intf = 
140:                 {
141:                    16, /* mapper number */
142:                    "Bandai", /* mapper name */
143:                    map16_init, /* init routine */
144:                    NULL, /* vblank callback */
145:                    map16_hblank, /* hblank callback */
146:                    map16_getstate, /* get state (snss) */
147:                    map16_setstate, /* set state (snss) */
148:                    NULL, /* memory read structure */
149:                    map16_memwrite, /* memory write structure */
150:                    NULL /* external sound device */
151:                 };
152:                 
153:                 /*
154:                 ** $Log: map016.c,v $
155:                 ** Revision 1.2  2001/04/27 14:37:11  neil
156:                 ** wheeee
157:                 **
158:                 ** Revision 1.1  2001/04/27 12:54:40  neil
159:                 ** blah
160:                 **
161:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
162:                 ** initial
163:                 **
164:                 ** Revision 1.1  2000/10/24 12:19:33  matt
165:                 ** changed directory structure
166:                 **
167:                 ** Revision 1.8  2000/10/22 19:17:46  matt
168:                 ** mapper cleanups galore
169:                 **
170:                 ** Revision 1.7  2000/10/22 15:03:13  matt
171:                 ** simplified mirroring
172:                 **
173:                 ** Revision 1.6  2000/10/21 19:33:38  matt
174:                 ** many more cleanups
175:                 **
176:                 ** Revision 1.5  2000/10/10 13:58:16  matt
177:                 ** stroustrup squeezing his way in the door
178:                 **
179:                 ** Revision 1.4  2000/08/16 02:50:11  matt
180:                 ** random mapper cleanups
181:                 **
182:                 ** Revision 1.3  2000/07/15 23:52:20  matt
183:                 ** rounded out a bunch more mapper interfaces
184:                 **
185:                 ** Revision 1.2  2000/07/11 05:03:49  matt
186:                 ** value masking isn't necessary for the banking routines
187:                 **
188:                 ** Revision 1.1  2000/07/11 03:14:18  melanson
189:                 ** Initial commit for mappers 16, 34, and 231
190:                 **
191:                 **
192:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map015.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map15.c
21:                  **
22:                  ** mapper 15 interface
23:                  ** $Id: map015.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes_ppu.h>
29:                  
30:                  /* mapper 15: Contra 100-in-1 */
31:                  static void map15_write(uint32 address, uint8 value)
32:                  {
9D03ABDC  27BDFFD8   ADDIU SP, SP, -40
9D03ABE0  AFBF0024   SW RA, 36(SP)
9D03ABE4  AFB40020   SW S4, 32(SP)
9D03ABE8  AFB3001C   SW S3, 28(SP)
9D03ABEC  AFB20018   SW S2, 24(SP)
9D03ABF0  AFB10014   SW S1, 20(SP)
9D03ABF4  AFB00010   SW S0, 16(SP)
9D03ABF8  00A08021   ADDU S0, A1, ZERO
33:                     int bank = value & 0x3F;
9D03ABFC  30B2003F   ANDI S2, A1, 63
34:                     uint8 swap = (value & 0x80) >> 7;
35:                  
36:                     switch (address & 0x3)
9D03AC00  30840003   ANDI A0, A0, 3
9D03AC04  24020001   ADDIU V0, ZERO, 1
9D03AC08  1082002D   BEQ A0, V0, 0x9D03ACC0
9D03AC0C  000589C2   SRL S1, A1, 7
9D03AC10  10800007   BEQ A0, ZERO, 0x9D03AC30
9D03AC14  24030002   ADDIU V1, ZERO, 2
9D03AC18  10830035   BEQ A0, V1, 0x9D03ACF0
9D03AC1C  24050003   ADDIU A1, ZERO, 3
9D03AC20  1085005B   BEQ A0, A1, 0x9D03AD90
9D03AC24  00129840   SLL S3, S2, 1
37:                     {
38:                     case 0:
39:                        mmc_bankrom(8, 0x8000, (bank << 1) + swap);
9D03AC30  0012A040   SLL S4, S2, 1
9D03AC34  24040008   ADDIU A0, ZERO, 8
9D03AC38  34058000   ORI A1, ZERO, -32768
9D03AC3C  0F40CA71   JAL mmc_bankrom
9D03AC40  02913021   ADDU A2, S4, S1
40:                        mmc_bankrom(8, 0xA000, (bank << 1) + (swap ^ 1));
9D03AC44  3A330001   XORI S3, S1, 1
9D03AC48  24040008   ADDIU A0, ZERO, 8
9D03AC4C  3405A000   ORI A1, ZERO, -24576
9D03AC50  0F40CA71   JAL mmc_bankrom
9D03AC54  02933021   ADDU A2, S4, S3
41:                        mmc_bankrom(8, 0xC000, ((bank + 1) << 1) + swap);
9D03AC58  264A0001   ADDIU T2, S2, 1
9D03AC5C  000A9040   SLL S2, T2, 1
9D03AC60  24040008   ADDIU A0, ZERO, 8
9D03AC64  3405C000   ORI A1, ZERO, -16384
9D03AC68  0F40CA71   JAL mmc_bankrom
9D03AC6C  02323021   ADDU A2, S1, S2
42:                        mmc_bankrom(8, 0xE000, ((bank + 1) << 1) + (swap ^ 1));
9D03AC70  24040008   ADDIU A0, ZERO, 8
9D03AC74  3405E000   ORI A1, ZERO, -8192
9D03AC78  0F40CA71   JAL mmc_bankrom
9D03AC7C  02723021   ADDU A2, S3, S2
43:                  
44:                        if (value & 0x40)
9D03AC80  320B0040   ANDI T3, S0, 64
9D03AC84  316C00FF   ANDI T4, T3, 255
9D03AC88  11800007   BEQ T4, ZERO, 0x9D03ACA8
9D03AC8C  00002021   ADDU A0, ZERO, ZERO
45:                           ppu_mirror(0, 0, 1, 1); /* horizontal */
9D03AC90  00002821   ADDU A1, ZERO, ZERO
9D03AC94  24060001   ADDIU A2, ZERO, 1
9D03AC98  0F4058FD   JAL ppu_mirror
9D03AC9C  24070001   ADDIU A3, ZERO, 1
9D03ACA0  0B40EB7C   J 0x9D03ADF0
9D03ACA4  8FBF0024   LW RA, 36(SP)
46:                        else
47:                           ppu_mirror(0, 1, 0, 1); /* vertical */
9D03ACA8  24050001   ADDIU A1, ZERO, 1
9D03ACAC  00003021   ADDU A2, ZERO, ZERO
9D03ACB0  0F4058FD   JAL ppu_mirror
9D03ACB4  24070001   ADDIU A3, ZERO, 1
48:                        break;
49:                  
50:                     case 1:
51:                        mmc_bankrom(8, 0xC000, (bank << 1) + swap);
9D03ACC0  00128040   SLL S0, S2, 1
9D03ACC4  24040008   ADDIU A0, ZERO, 8
9D03ACC8  3405C000   ORI A1, ZERO, -16384
9D03ACCC  0F40CA71   JAL mmc_bankrom
9D03ACD0  02113021   ADDU A2, S0, S1
52:                        mmc_bankrom(8, 0xE000, (bank << 1) + (swap ^ 1));
9D03ACD4  3A2D0001   XORI T5, S1, 1
9D03ACD8  24040008   ADDIU A0, ZERO, 8
9D03ACDC  3405E000   ORI A1, ZERO, -8192
9D03ACE0  0F40CA71   JAL mmc_bankrom
9D03ACE4  020D3021   ADDU A2, S0, T5
53:                        break;
9D03ACE8  0B40EB7C   J 0x9D03ADF0
9D03ACEC  8FBF0024   LW RA, 36(SP)
54:                  
55:                     case 2:
56:                        if (swap)
9D03ACF0  12200015   BEQ S1, ZERO, 0x9D03AD48
9D03ACF4  0012A040   SLL S4, S2, 1
57:                        {
58:                           mmc_bankrom(8, 0x8000, (bank << 1) + 1);
9D03ACF8  00124840   SLL T1, S2, 1
9D03ACFC  25300001   ADDIU S0, T1, 1
9D03AD00  24040008   ADDIU A0, ZERO, 8
9D03AD04  34058000   ORI A1, ZERO, -32768
9D03AD08  0F40CA71   JAL mmc_bankrom
9D03AD0C  02003021   ADDU A2, S0, ZERO
59:                           mmc_bankrom(8, 0xA000, (bank << 1) + 1);
9D03AD10  24040008   ADDIU A0, ZERO, 8
9D03AD14  3405A000   ORI A1, ZERO, -24576
9D03AD18  0F40CA71   JAL mmc_bankrom
9D03AD1C  02003021   ADDU A2, S0, ZERO
60:                           mmc_bankrom(8, 0xC000, (bank << 1) + 1);
9D03AD20  24040008   ADDIU A0, ZERO, 8
9D03AD24  3405C000   ORI A1, ZERO, -16384
9D03AD28  0F40CA71   JAL mmc_bankrom
9D03AD2C  02003021   ADDU A2, S0, ZERO
61:                           mmc_bankrom(8, 0xE000, (bank << 1) + 1);
9D03AD30  24040008   ADDIU A0, ZERO, 8
9D03AD34  3405E000   ORI A1, ZERO, -8192
9D03AD38  0F40CA71   JAL mmc_bankrom
9D03AD3C  02003021   ADDU A2, S0, ZERO
9D03AD40  0B40EB7C   J 0x9D03ADF0
9D03AD44  8FBF0024   LW RA, 36(SP)
62:                        }
63:                        else
64:                        {
65:                           mmc_bankrom(8, 0x8000, (bank << 1));
9D03AD48  24040008   ADDIU A0, ZERO, 8
9D03AD4C  34058000   ORI A1, ZERO, -32768
9D03AD50  0F40CA71   JAL mmc_bankrom
9D03AD54  02803021   ADDU A2, S4, ZERO
66:                           mmc_bankrom(8, 0xA000, (bank << 1));
9D03AD58  24040008   ADDIU A0, ZERO, 8
9D03AD5C  3405A000   ORI A1, ZERO, -24576
9D03AD60  0F40CA71   JAL mmc_bankrom
9D03AD64  02803021   ADDU A2, S4, ZERO
67:                           mmc_bankrom(8, 0xC000, (bank << 1));
9D03AD68  24040008   ADDIU A0, ZERO, 8
9D03AD6C  3405C000   ORI A1, ZERO, -16384
9D03AD70  0F40CA71   JAL mmc_bankrom
9D03AD74  02803021   ADDU A2, S4, ZERO
68:                           mmc_bankrom(8, 0xE000, (bank << 1));
9D03AD78  24040008   ADDIU A0, ZERO, 8
9D03AD7C  3405E000   ORI A1, ZERO, -8192
9D03AD80  0F40CA71   JAL mmc_bankrom
9D03AD84  02803021   ADDU A2, S4, ZERO
69:                        }
70:                        break;
71:                  
72:                     case 3:
73:                        mmc_bankrom(8, 0xC000, (bank << 1) + swap);
9D03AD90  24040008   ADDIU A0, ZERO, 8
9D03AD94  3405C000   ORI A1, ZERO, -16384
9D03AD98  0F40CA71   JAL mmc_bankrom
9D03AD9C  02713021   ADDU A2, S3, S1
74:                        mmc_bankrom(8, 0xE000, (bank << 1) + (swap ^ 1));
9D03ADA0  3A260001   XORI A2, S1, 1
9D03ADA4  24040008   ADDIU A0, ZERO, 8
9D03ADA8  3405E000   ORI A1, ZERO, -8192
9D03ADAC  0F40CA71   JAL mmc_bankrom
9D03ADB0  02663021   ADDU A2, S3, A2
75:                  
76:                        if (value & 0x40)
9D03ADB4  32070040   ANDI A3, S0, 64
9D03ADB8  30E800FF   ANDI T0, A3, 255
9D03ADBC  11000007   BEQ T0, ZERO, 0x9D03ADDC
9D03ADC0  00002021   ADDU A0, ZERO, ZERO
77:                           ppu_mirror(0, 0, 1, 1); /* horizontal */
9D03ADC4  00002821   ADDU A1, ZERO, ZERO
9D03ADC8  24060001   ADDIU A2, ZERO, 1
9D03ADCC  0F4058FD   JAL ppu_mirror
9D03ADD0  24070001   ADDIU A3, ZERO, 1
9D03ADD4  0B40EB7C   J 0x9D03ADF0
9D03ADD8  8FBF0024   LW RA, 36(SP)
78:                        else
79:                           ppu_mirror(0, 1, 0, 1); /* vertical */
9D03ADDC  24050001   ADDIU A1, ZERO, 1
9D03ADE0  00003021   ADDU A2, ZERO, ZERO
9D03ADE4  0F4058FD   JAL ppu_mirror
9D03ADE8  24070001   ADDIU A3, ZERO, 1
80:                        break;
81:                  
82:                     default:
83:                        break;
84:                     }
85:                  }
9D03AC28  0B40EB7C   J 0x9D03ADF0
9D03AC2C  8FBF0024   LW RA, 36(SP)
9D03ACB8  0B40EB7C   J 0x9D03ADF0
9D03ACBC  8FBF0024   LW RA, 36(SP)
9D03AD88  0B40EB7C   J 0x9D03ADF0
9D03AD8C  8FBF0024   LW RA, 36(SP)
9D03ADEC  8FBF0024   LW RA, 36(SP)
9D03ADF0  8FB40020   LW S4, 32(SP)
9D03ADF4  8FB3001C   LW S3, 28(SP)
9D03ADF8  8FB20018   LW S2, 24(SP)
9D03ADFC  8FB10014   LW S1, 20(SP)
9D03AE00  8FB00010   LW S0, 16(SP)
9D03AE04  03E00008   JR RA
9D03AE08  27BD0028   ADDIU SP, SP, 40
86:                  
87:                  static void map15_init(void)
88:                  {
9D03ABB8  27BDFFE8   ADDIU SP, SP, -24
9D03ABBC  AFBF0014   SW RA, 20(SP)
89:                     mmc_bankrom(32, 0x8000, 0);
9D03ABC0  24040020   ADDIU A0, ZERO, 32
9D03ABC4  34058000   ORI A1, ZERO, -32768
9D03ABC8  0F40CA71   JAL mmc_bankrom
9D03ABCC  00003021   ADDU A2, ZERO, ZERO
90:                  }
9D03ABD0  8FBF0014   LW RA, 20(SP)
9D03ABD4  03E00008   JR RA
9D03ABD8  27BD0018   ADDIU SP, SP, 24
91:                  
92:                  static map_memwrite map15_memwrite[] =
93:                  {
94:                     { 0x8000, 0xFFFF, map15_write },
95:                     {     -1,     -1, NULL }
96:                  };
97:                  
98:                  mapintf_t map15_intf =
99:                  {
100:                    15, /* mapper number */
101:                    "Contra 100-in-1", /* mapper name */
102:                    map15_init, /* init routine */
103:                    NULL, /* vblank callback */
104:                    NULL, /* hblank callback */
105:                    NULL, /* get state (snss) */
106:                    NULL, /* set state (snss) */
107:                    NULL, /* memory read structure */
108:                    map15_memwrite, /* memory write structure */
109:                    NULL /* external sound device */
110:                 };
111:                 
112:                 /*
113:                 ** $Log: map015.c,v $
114:                 ** Revision 1.2  2001/04/27 14:37:11  neil
115:                 ** wheeee
116:                 **
117:                 ** Revision 1.1  2001/04/27 12:54:40  neil
118:                 ** blah
119:                 **
120:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
121:                 ** initial
122:                 **
123:                 ** Revision 1.1  2000/10/24 12:19:33  matt
124:                 ** changed directory structure
125:                 **
126:                 ** Revision 1.6  2000/10/22 19:17:46  matt
127:                 ** mapper cleanups galore
128:                 **
129:                 ** Revision 1.5  2000/10/22 15:03:13  matt
130:                 ** simplified mirroring
131:                 **
132:                 ** Revision 1.4  2000/10/21 19:33:38  matt
133:                 ** many more cleanups
134:                 **
135:                 ** Revision 1.3  2000/07/10 05:29:03  matt
136:                 ** cleaned up some mirroring issues
137:                 **
138:                 ** Revision 1.2  2000/07/06 02:48:43  matt
139:                 ** clearly labelled structure members
140:                 **
141:                 ** Revision 1.1  2000/07/05 05:05:18  matt
142:                 ** initial revision
143:                 **
144:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map011.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map11.c
21:                  **
22:                  ** mapper 11 interface
23:                  ** $Id: map011.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  
29:                  /* mapper 11: Color Dreams, Wisdom Tree */
30:                  static void map11_write(uint32 address, uint8 value)
31:                  {
9D041148  27BDFFE8   ADDIU SP, SP, -24
9D04114C  AFBF0014   SW RA, 20(SP)
9D041150  AFB00010   SW S0, 16(SP)
9D041154  00A08021   ADDU S0, A1, ZERO
32:                     UNUSED(address);
33:                  
34:                     mmc_bankrom(32, 0x8000, value & 0x0F);
9D041158  24040020   ADDIU A0, ZERO, 32
9D04115C  34058000   ORI A1, ZERO, -32768
9D041160  0F40CA71   JAL mmc_bankrom
9D041164  3206000F   ANDI A2, S0, 15
35:                     mmc_bankvrom(8, 0x0000, value >> 4);
9D041168  24040008   ADDIU A0, ZERO, 8
9D04116C  00002821   ADDU A1, ZERO, ZERO
9D041170  0F40CA16   JAL mmc_bankvrom
9D041174  00103102   SRL A2, S0, 4
36:                  }
9D041178  8FBF0014   LW RA, 20(SP)
9D04117C  8FB00010   LW S0, 16(SP)
9D041180  03E00008   JR RA
9D041184  27BD0018   ADDIU SP, SP, 24
37:                  
38:                  static void map11_init(void)
39:                  {
9D041188  27BDFFE8   ADDIU SP, SP, -24
9D04118C  AFBF0014   SW RA, 20(SP)
40:                     mmc_bankrom(32, 0x8000, 0);
9D041190  24040020   ADDIU A0, ZERO, 32
9D041194  34058000   ORI A1, ZERO, -32768
9D041198  0F40CA71   JAL mmc_bankrom
9D04119C  00003021   ADDU A2, ZERO, ZERO
41:                     mmc_bankvrom(8, 0x0000, 0);
9D0411A0  24040008   ADDIU A0, ZERO, 8
9D0411A4  00002821   ADDU A1, ZERO, ZERO
9D0411A8  0F40CA16   JAL mmc_bankvrom
9D0411AC  00003021   ADDU A2, ZERO, ZERO
42:                  }
9D0411B0  8FBF0014   LW RA, 20(SP)
9D0411B4  03E00008   JR RA
9D0411B8  27BD0018   ADDIU SP, SP, 24
43:                  
44:                  static map_memwrite map11_memwrite[] =
45:                  {
46:                     { 0x8000, 0xFFFF, map11_write },
47:                     {     -1,     -1, NULL }
48:                  };
49:                  
50:                  mapintf_t map11_intf =
51:                  {
52:                     11, /* mapper number */
53:                     "Color Dreams", /* mapper name */
54:                     map11_init, /* init routine */
55:                     NULL, /* vblank callback */
56:                     NULL, /* hblank callback */
57:                     NULL, /* get state (snss) */
58:                     NULL, /* set state (snss) */
59:                     NULL, /* memory read structure */
60:                     map11_memwrite, /* memory write structure */
61:                     NULL /* external sound device */
62:                  };
63:                  
64:                  /*
65:                  ** $Log: map011.c,v $
66:                  ** Revision 1.2  2001/04/27 14:37:11  neil
67:                  ** wheeee
68:                  **
69:                  ** Revision 1.1  2001/04/27 12:54:40  neil
70:                  ** blah
71:                  **
72:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
73:                  ** initial
74:                  **
75:                  ** Revision 1.1  2000/10/24 12:19:33  matt
76:                  ** changed directory structure
77:                  **
78:                  ** Revision 1.5  2000/10/22 19:17:46  matt
79:                  ** mapper cleanups galore
80:                  **
81:                  ** Revision 1.4  2000/10/21 19:33:38  matt
82:                  ** many more cleanups
83:                  **
84:                  ** Revision 1.3  2000/08/16 02:50:11  matt
85:                  ** random mapper cleanups
86:                  **
87:                  ** Revision 1.2  2000/07/06 02:48:43  matt
88:                  ** clearly labelled structure members
89:                  **
90:                  ** Revision 1.1  2000/07/04 23:11:45  matt
91:                  ** initial revision
92:                  **
93:                  */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map009.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map9.c
21:                  **
22:                  ** mapper 9 interface
23:                  ** $Id: map009.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <string.h>
27:                  #include <noftypes.h>
28:                  #include <nes_mmc.h>
29:                  #include <nes_ppu.h>
30:                  #include <libsnss.h>
31:                  
32:                  static uint8 latch[2];
33:                  static uint8 regs[4];
34:                  
35:                  /* Used when tile $FD/$FE is accessed */
36:                  static void mmc9_latchfunc(uint32 address, uint8 value)
37:                  {
9D0397EC  27BDFFE8   ADDIU SP, SP, -24
9D0397F0  AFBF0014   SW RA, 20(SP)
38:                     if (0xFD == value || 0xFE == value)
9D0397D8  24A20003   ADDIU V0, A1, 3
9D0397DC  304300FF   ANDI V1, V0, 255
9D0397E0  2C660002   SLTIU A2, V1, 2
9D0397E4  10C00012   BEQ A2, ZERO, 0x9D039830
9D0397E8  00000000   NOP
39:                     {
40:                        int reg;
41:                  
42:                        if (address)
9D0397F4  10800004   BEQ A0, ZERO, 0x9D039808
9D0397F8  00803821   ADDU A3, A0, ZERO
43:                        {
44:                           latch[1] = value;
9D0397FC  A385812D   SB A1, -32467(GP)
9D039800  0B40E604   J 0x9D039810
9D039804  24A5FF05   ADDIU A1, A1, -251
45:                           reg = 2 + (value - 0xFD);
46:                        }
47:                        else
48:                        {
49:                           latch[0] = value;
9D039808  A385812C   SB A1, -32468(GP)
50:                           reg = value - 0xFD;
9D03980C  24A5FF03   ADDIU A1, A1, -253
51:                        }
52:                  
53:                        mmc_bankvrom(4, address, regs[reg]);
9D039810  27848128   ADDIU A0, GP, -32472
9D039814  00854021   ADDU T0, A0, A1
9D039818  24040004   ADDIU A0, ZERO, 4
9D03981C  00E02821   ADDU A1, A3, ZERO
9D039820  0F40CA16   JAL mmc_bankvrom
9D039824  91060000   LBU A2, 0(T0)
54:                     }
55:                  }
9D039828  8FBF0014   LW RA, 20(SP)
9D03982C  27BD0018   ADDIU SP, SP, 24
9D039830  03E00008   JR RA
9D039834  00000000   NOP
56:                  
57:                  /* mapper 9: MMC2 */
58:                  /* MMC2: Punch-Out! */
59:                  static void map9_write(uint32 address, uint8 value)
60:                  {
9D03984C  27BDFFE8   ADDIU SP, SP, -24
61:                     switch ((address & 0xF000) >> 12)
9D039838  7C841B00   EXT A0, A0, 12, 4
9D03983C  2483FFF6   ADDIU V1, A0, -10
9D039840  2C620006   SLTIU V0, V1, 6
9D039844  1040004B   BEQ V0, ZERO, 0x9D039974
9D039848  00A03021   ADDU A2, A1, ZERO
9D039850  00032880   SLL A1, V1, 2
9D039854  3C079D04   LUI A3, -25340
9D039858  24E8986C   ADDIU T0, A3, -26516
9D03985C  01054821   ADDU T1, T0, A1
9D039860  8D2A0000   LW T2, 0(T1)
9D039864  01400008   JR T2
9D039868  AFBF0014   SW RA, 20(SP)
62:                     {
63:                     case 0xA:
64:                        mmc_bankrom(8, 0x8000, value);
9D039884  24040008   ADDIU A0, ZERO, 8
9D039888  0F40CA71   JAL mmc_bankrom
9D03988C  34058000   ORI A1, ZERO, -32768
65:                        break;
9D039890  0B40E65C   J 0x9D039970
9D039894  8FBF0014   LW RA, 20(SP)
66:                  
67:                     case 0xB:
68:                        regs[0] = value;
9D039898  A3868128   SB A2, -32472(GP)
69:                        if (0xFD == latch[0])
9D03989C  9399812C   LBU T9, -32468(GP)
9D0398A0  241F00FD   ADDIU RA, ZERO, 253
9D0398A4  573F0032   BNEL T9, RA, 0x9D039970
9D0398A8  8FBF0014   LW RA, 20(SP)
70:                           mmc_bankvrom(4, 0x0000, value);
9D0398AC  24040004   ADDIU A0, ZERO, 4
9D0398B0  0F40CA16   JAL mmc_bankvrom
9D0398B4  00002821   ADDU A1, ZERO, ZERO
71:                        break;
72:                  
73:                     case 0xC:
74:                        regs[1] = value;
9D0398C0  A3868129   SB A2, -32471(GP)
75:                        if (0xFE == latch[0])
9D0398C4  938F812C   LBU T7, -32468(GP)
9D0398C8  241800FE   ADDIU T8, ZERO, 254
9D0398CC  55F80028   BNEL T7, T8, 0x9D039970
9D0398D0  8FBF0014   LW RA, 20(SP)
76:                           mmc_bankvrom(4, 0x0000, value);
9D0398D4  24040004   ADDIU A0, ZERO, 4
9D0398D8  0F40CA16   JAL mmc_bankvrom
9D0398DC  00002821   ADDU A1, ZERO, ZERO
77:                        break;
78:                  
79:                     case 0xD:
80:                        regs[2] = value;
9D0398E8  A386812A   SB A2, -32470(GP)
81:                        if (0xFD == latch[1])
9D0398EC  938D812D   LBU T5, -32467(GP)
9D0398F0  240E00FD   ADDIU T6, ZERO, 253
9D0398F4  55AE001E   BNEL T5, T6, 0x9D039970
9D0398F8  8FBF0014   LW RA, 20(SP)
82:                           mmc_bankvrom(4, 0x1000, value);
9D0398FC  24040004   ADDIU A0, ZERO, 4
9D039900  0F40CA16   JAL mmc_bankvrom
9D039904  24051000   ADDIU A1, ZERO, 4096
83:                        break;
84:                  
85:                     case 0xE:
86:                        regs[3] = value;
9D039910  A386812B   SB A2, -32469(GP)
87:                        if (0xFE == latch[1])
9D039914  938B812D   LBU T3, -32467(GP)
9D039918  240C00FE   ADDIU T4, ZERO, 254
9D03991C  556C0014   BNEL T3, T4, 0x9D039970
9D039920  8FBF0014   LW RA, 20(SP)
88:                           mmc_bankvrom(4, 0x1000, value);
9D039924  24040004   ADDIU A0, ZERO, 4
9D039928  0F40CA16   JAL mmc_bankvrom
9D03992C  24051000   ADDIU A1, ZERO, 4096
89:                        break;
90:                  
91:                     case 0xF:
92:                        if (value & 1)
9D039938  30C60001   ANDI A2, A2, 1
9D03993C  10C00007   BEQ A2, ZERO, 0x9D03995C
9D039940  00002021   ADDU A0, ZERO, ZERO
93:                           ppu_mirror(0, 0, 1, 1); /* horizontal */
9D039944  00002821   ADDU A1, ZERO, ZERO
9D039948  24060001   ADDIU A2, ZERO, 1
9D03994C  0F4058FD   JAL ppu_mirror
9D039950  24070001   ADDIU A3, ZERO, 1
9D039954  0B40E65C   J 0x9D039970
9D039958  8FBF0014   LW RA, 20(SP)
94:                        else
95:                           ppu_mirror(0, 1, 0, 1); /* vertical */
9D03995C  24050001   ADDIU A1, ZERO, 1
9D039960  00003021   ADDU A2, ZERO, ZERO
9D039964  0F4058FD   JAL ppu_mirror
9D039968  24070001   ADDIU A3, ZERO, 1
96:                        break;
97:                  
98:                     default:
99:                        break;
100:                    }
101:                 }
9D0398B8  0B40E65C   J 0x9D039970
9D0398BC  8FBF0014   LW RA, 20(SP)
9D0398E0  0B40E65C   J 0x9D039970
9D0398E4  8FBF0014   LW RA, 20(SP)
9D039908  0B40E65C   J 0x9D039970
9D03990C  8FBF0014   LW RA, 20(SP)
9D039930  0B40E65C   J 0x9D039970
9D039934  8FBF0014   LW RA, 20(SP)
9D03996C  8FBF0014   LW RA, 20(SP)
9D039970  27BD0018   ADDIU SP, SP, 24
9D039974  03E00008   JR RA
9D039978  00000000   NOP
102:                 
103:                 static void map9_init(void)
104:                 {
9D03997C  27BDFFE8   ADDIU SP, SP, -24
9D039980  AFBF0014   SW RA, 20(SP)
105:                    memset(regs, 0, sizeof(regs));
9D039984  AF808128   SW ZERO, -32472(GP)
106:                 
107:                    mmc_bankrom(8, 0x8000, 0);
9D039988  24040008   ADDIU A0, ZERO, 8
9D03998C  34058000   ORI A1, ZERO, -32768
9D039990  0F40CA71   JAL mmc_bankrom
9D039994  00003021   ADDU A2, ZERO, ZERO
108:                    mmc_bankrom(8, 0xA000, (mmc_getinfo()->rom_banks * 2) - 3);
9D039998  0F40CA0A   JAL mmc_getinfo
9D03999C  00000000   NOP
9D0399A0  8C460010   LW A2, 16(V0)
9D0399A4  00061040   SLL V0, A2, 1
9D0399A8  24040008   ADDIU A0, ZERO, 8
9D0399AC  3405A000   ORI A1, ZERO, -24576
9D0399B0  0F40CA71   JAL mmc_bankrom
9D0399B4  2446FFFD   ADDIU A2, V0, -3
109:                    mmc_bankrom(8, 0xC000, (mmc_getinfo()->rom_banks * 2) - 2);
9D0399B8  0F40CA0A   JAL mmc_getinfo
9D0399BC  00000000   NOP
9D0399C0  8C430010   LW V1, 16(V0)
9D0399C4  2467FFFF   ADDIU A3, V1, -1
9D0399C8  24040008   ADDIU A0, ZERO, 8
9D0399CC  3405C000   ORI A1, ZERO, -16384
9D0399D0  0F40CA71   JAL mmc_bankrom
9D0399D4  00073040   SLL A2, A3, 1
110:                    mmc_bankrom(8, 0xE000, (mmc_getinfo()->rom_banks * 2) - 1);
9D0399D8  0F40CA0A   JAL mmc_getinfo
9D0399DC  00000000   NOP
9D0399E0  8C440010   LW A0, 16(V0)
9D0399E4  00044040   SLL T0, A0, 1
9D0399E8  24040008   ADDIU A0, ZERO, 8
9D0399EC  3405E000   ORI A1, ZERO, -8192
9D0399F0  0F40CA71   JAL mmc_bankrom
9D0399F4  2506FFFF   ADDIU A2, T0, -1
111:                 
112:                    latch[0] = 0xFE;
9D0399F8  2405FFFE   ADDIU A1, ZERO, -2
9D0399FC  A385812C   SB A1, -32468(GP)
113:                    latch[1] = 0xFE;
9D039A00  A385812D   SB A1, -32467(GP)
114:                 
115:                    ppu_setlatchfunc(mmc9_latchfunc);
9D039A04  3C099D04   LUI T1, -25340
9D039A08  0F405C7D   JAL ppu_setlatchfunc
9D039A0C  252497D8   ADDIU A0, T1, -26664
116:                 }
9D039A10  8FBF0014   LW RA, 20(SP)
9D039A14  03E00008   JR RA
9D039A18  27BD0018   ADDIU SP, SP, 24
117:                 
118:                 static void map9_getstate(SnssMapperBlock *state)
119:                 {
120:                    state->extraData.mapper9.latch[0] = latch[0];
9D039770  9382812C   LBU V0, -32468(GP)
9D039774  A0820018   SB V0, 24(A0)
121:                    state->extraData.mapper9.latch[1] = latch[1];
9D039778  9383812D   LBU V1, -32467(GP)
9D03977C  A0830019   SB V1, 25(A0)
122:                    state->extraData.mapper9.lastB000Write = regs[0];
9D039780  93858128   LBU A1, -32472(GP)
9D039784  A085001A   SB A1, 26(A0)
123:                    state->extraData.mapper9.lastC000Write = regs[1];
9D039788  93868129   LBU A2, -32471(GP)
9D03978C  A086001B   SB A2, 27(A0)
124:                    state->extraData.mapper9.lastD000Write = regs[2];
9D039790  9387812A   LBU A3, -32470(GP)
9D039794  A087001C   SB A3, 28(A0)
125:                    state->extraData.mapper9.lastE000Write = regs[3];
9D039798  9388812B   LBU T0, -32469(GP)
9D03979C  03E00008   JR RA
9D0397A0  A088001D   SB T0, 29(A0)
126:                 }
127:                 
128:                 static void map9_setstate(SnssMapperBlock *state)
129:                 {
130:                    latch[0] = state->extraData.mapper9.latch[0];
9D0397A4  90820018   LBU V0, 24(A0)
9D0397A8  A382812C   SB V0, -32468(GP)
131:                    latch[1] = state->extraData.mapper9.latch[1];
9D0397AC  90830019   LBU V1, 25(A0)
9D0397B0  A383812D   SB V1, -32467(GP)
132:                    regs[0] = state->extraData.mapper9.lastB000Write;
9D0397B4  9085001A   LBU A1, 26(A0)
9D0397B8  A3858128   SB A1, -32472(GP)
133:                    regs[1] = state->extraData.mapper9.lastC000Write;
9D0397BC  9086001B   LBU A2, 27(A0)
9D0397C0  A3868129   SB A2, -32471(GP)
134:                    regs[2] = state->extraData.mapper9.lastD000Write;
9D0397C4  9087001C   LBU A3, 28(A0)
9D0397C8  A387812A   SB A3, -32470(GP)
135:                    regs[3] = state->extraData.mapper9.lastE000Write;
9D0397CC  9084001D   LBU A0, 29(A0)
9D0397D0  03E00008   JR RA
9D0397D4  A384812B   SB A0, -32469(GP)
136:                 }
137:                 
138:                 static map_memwrite map9_memwrite[] =
139:                 {
140:                    { 0x8000, 0xFFFF, map9_write },
141:                    {     -1,     -1, NULL }
142:                 };
143:                 
144:                 mapintf_t map9_intf =
145:                 {
146:                    9, /* mapper number */
147:                    "MMC2", /* mapper name */
148:                    map9_init, /* init routine */
149:                    NULL, /* vblank callback */
150:                    NULL, /* hblank callback */
151:                    map9_getstate, /* get state (snss) */
152:                    map9_setstate, /* set state (snss) */
153:                    NULL, /* memory read structure */
154:                    map9_memwrite, /* memory write structure */
155:                    NULL /* external sound device */
156:                 };
157:                 
158:                 /*
159:                 ** $Log: map009.c,v $
160:                 ** Revision 1.2  2001/04/27 14:37:11  neil
161:                 ** wheeee
162:                 **
163:                 ** Revision 1.1  2001/04/27 12:54:40  neil
164:                 ** blah
165:                 **
166:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
167:                 ** initial
168:                 **
169:                 ** Revision 1.1  2000/10/24 12:19:33  matt
170:                 ** changed directory structure
171:                 **
172:                 ** Revision 1.9  2000/10/22 19:17:46  matt
173:                 ** mapper cleanups galore
174:                 **
175:                 ** Revision 1.8  2000/10/22 15:03:14  matt
176:                 ** simplified mirroring
177:                 **
178:                 ** Revision 1.7  2000/10/21 19:33:38  matt
179:                 ** many more cleanups
180:                 **
181:                 ** Revision 1.6  2000/07/17 05:11:35  matt
182:                 ** minor update from making PPU code less filthy
183:                 **
184:                 ** Revision 1.5  2000/07/15 23:52:19  matt
185:                 ** rounded out a bunch more mapper interfaces
186:                 **
187:                 ** Revision 1.4  2000/07/10 05:29:03  matt
188:                 ** cleaned up some mirroring issues
189:                 **
190:                 ** Revision 1.3  2000/07/06 02:48:43  matt
191:                 ** clearly labelled structure members
192:                 **
193:                 ** Revision 1.2  2000/07/05 22:50:33  matt
194:                 ** fixed punchout -- works 100% now
195:                 **
196:                 ** Revision 1.1  2000/07/05 05:05:18  matt
197:                 ** initial revision
198:                 **
199:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map008.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map8.c
21:                  **
22:                  ** mapper 8 interface
23:                  ** $Id: map008.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  
29:                  /* mapper 8: FFE F3xxx -- what the hell uses this? */
30:                  static void map8_write(uint32 address, uint8 value)
31:                  {
9D040CEC  27BDFFE8   ADDIU SP, SP, -24
9D040CF0  AFBF0014   SW RA, 20(SP)
9D040CF4  AFB00010   SW S0, 16(SP)
9D040CF8  00A08021   ADDU S0, A1, ZERO
32:                     UNUSED(address);
33:                  
34:                     mmc_bankrom(16, 0x8000, value >> 3);
9D040CFC  24040010   ADDIU A0, ZERO, 16
9D040D00  34058000   ORI A1, ZERO, -32768
9D040D04  0F40CA71   JAL mmc_bankrom
9D040D08  001030C2   SRL A2, S0, 3
35:                     mmc_bankvrom(8, 0x0000, value & 7);
9D040D0C  24040008   ADDIU A0, ZERO, 8
9D040D10  00002821   ADDU A1, ZERO, ZERO
9D040D14  0F40CA16   JAL mmc_bankvrom
9D040D18  32060007   ANDI A2, S0, 7
36:                  }
9D040D1C  8FBF0014   LW RA, 20(SP)
9D040D20  8FB00010   LW S0, 16(SP)
9D040D24  03E00008   JR RA
9D040D28  27BD0018   ADDIU SP, SP, 24
37:                  
38:                  static void map8_init(void)
39:                  {
9D040D2C  27BDFFE8   ADDIU SP, SP, -24
9D040D30  AFBF0014   SW RA, 20(SP)
40:                     mmc_bankrom(16, 0x8000, 0);
9D040D34  24040010   ADDIU A0, ZERO, 16
9D040D38  34058000   ORI A1, ZERO, -32768
9D040D3C  0F40CA71   JAL mmc_bankrom
9D040D40  00003021   ADDU A2, ZERO, ZERO
41:                     mmc_bankrom(16, 0xC000, 1);
9D040D44  24040010   ADDIU A0, ZERO, 16
9D040D48  3405C000   ORI A1, ZERO, -16384
9D040D4C  0F40CA71   JAL mmc_bankrom
9D040D50  24060001   ADDIU A2, ZERO, 1
42:                     mmc_bankvrom(8, 0x0000, 0);
9D040D54  24040008   ADDIU A0, ZERO, 8
9D040D58  00002821   ADDU A1, ZERO, ZERO
9D040D5C  0F40CA16   JAL mmc_bankvrom
9D040D60  00003021   ADDU A2, ZERO, ZERO
43:                  }
9D040D64  8FBF0014   LW RA, 20(SP)
9D040D68  03E00008   JR RA
9D040D6C  27BD0018   ADDIU SP, SP, 24
44:                  
45:                  static map_memwrite map8_memwrite[] =
46:                  {
47:                     { 0x8000, 0xFFFF, map8_write },
48:                     {     -1,     -1, NULL }
49:                  };
50:                  
51:                  mapintf_t map8_intf =
52:                  {
53:                     8, /* mapper number */
54:                     "FFE F3xxx", /* mapper name */
55:                     map8_init, /* init routine */
56:                     NULL, /* vblank callback */
57:                     NULL, /* hblank callback */
58:                     NULL, /* get state (snss) */
59:                     NULL, /* set state (snss) */
60:                     NULL, /* memory read structure */
61:                     map8_memwrite, /* memory write structure */
62:                     NULL /* external sound device */
63:                  };
64:                  
65:                  /*
66:                  ** $Log: map008.c,v $
67:                  ** Revision 1.2  2001/04/27 14:37:11  neil
68:                  ** wheeee
69:                  **
70:                  ** Revision 1.1  2001/04/27 12:54:40  neil
71:                  ** blah
72:                  **
73:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
74:                  ** initial
75:                  **
76:                  ** Revision 1.1  2000/10/24 12:19:32  matt
77:                  ** changed directory structure
78:                  **
79:                  ** Revision 1.5  2000/10/22 19:17:47  matt
80:                  ** mapper cleanups galore
81:                  **
82:                  ** Revision 1.4  2000/10/21 19:33:38  matt
83:                  ** many more cleanups
84:                  **
85:                  ** Revision 1.3  2000/08/16 02:50:11  matt
86:                  ** random mapper cleanups
87:                  **
88:                  ** Revision 1.2  2000/07/06 02:48:43  matt
89:                  ** clearly labelled structure members
90:                  **
91:                  ** Revision 1.1  2000/07/04 23:11:45  matt
92:                  ** initial revision
93:                  **
94:                  */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map007.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map7.c
21:                  **
22:                  ** mapper 7 interface
23:                  ** $Id: map007.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes_ppu.h>
29:                  #include <log.h>
30:                  
31:                  /* mapper 7: AOROM */
32:                  static void map7_write(uint32 address, uint8 value)
33:                  {
9D04147C  27BDFFE8   ADDIU SP, SP, -24
9D041480  AFBF0014   SW RA, 20(SP)
9D041484  AFB00010   SW S0, 16(SP)
9D041488  00A08021   ADDU S0, A1, ZERO
34:                     int mirror;
35:                     UNUSED(address);
36:                  
37:                     mmc_bankrom(32, 0x8000, value);
9D04148C  24040020   ADDIU A0, ZERO, 32
9D041490  34058000   ORI A1, ZERO, -32768
9D041494  0F40CA71   JAL mmc_bankrom
9D041498  02003021   ADDU A2, S0, ZERO
38:                     mirror = (value & 0x10) >> 4;
9D04149C  7E070100   EXT A3, S0, 4, 1
39:                     ppu_mirror(mirror, mirror, mirror, mirror);
9D0414A0  00E02021   ADDU A0, A3, ZERO
9D0414A4  00E02821   ADDU A1, A3, ZERO
9D0414A8  0F4058FD   JAL ppu_mirror
9D0414AC  00E03021   ADDU A2, A3, ZERO
40:                  }
9D0414B0  8FBF0014   LW RA, 20(SP)
9D0414B4  8FB00010   LW S0, 16(SP)
9D0414B8  03E00008   JR RA
9D0414BC  27BD0018   ADDIU SP, SP, 24
41:                  
42:                  static void map7_init(void)
43:                  {
9D041458  27BDFFE8   ADDIU SP, SP, -24
9D04145C  AFBF0014   SW RA, 20(SP)
44:                     mmc_bankrom(32, 0x8000, 0);
9D041460  24040020   ADDIU A0, ZERO, 32
9D041464  34058000   ORI A1, ZERO, -32768
9D041468  0F40CA71   JAL mmc_bankrom
9D04146C  00003021   ADDU A2, ZERO, ZERO
45:                  }
9D041470  8FBF0014   LW RA, 20(SP)
9D041474  03E00008   JR RA
9D041478  27BD0018   ADDIU SP, SP, 24
46:                  
47:                  static map_memwrite map7_memwrite[] =
48:                  {
49:                     { 0x8000, 0xFFFF, map7_write },
50:                     {     -1,     -1, NULL }
51:                  };
52:                  
53:                  mapintf_t map7_intf =
54:                  {
55:                     7, /* mapper number */
56:                     "AOROM", /* mapper name */
57:                     map7_init, /* init routine */
58:                     NULL, /* vblank callback */
59:                     NULL, /* hblank callback */
60:                     NULL, /* get state (snss) */
61:                     NULL, /* set state (snss) */
62:                     NULL, /* memory read structure */
63:                     map7_memwrite, /* memory write structure */
64:                     NULL /* external sound device */
65:                  };
66:                  
67:                  /*
68:                  ** $Log: map007.c,v $
69:                  ** Revision 1.2  2001/04/27 14:37:11  neil
70:                  ** wheeee
71:                  **
72:                  ** Revision 1.1  2001/04/27 12:54:40  neil
73:                  ** blah
74:                  **
75:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
76:                  ** initial
77:                  **
78:                  ** Revision 1.1  2000/10/24 12:19:32  matt
79:                  ** changed directory structure
80:                  **
81:                  ** Revision 1.6  2000/10/22 19:17:46  matt
82:                  ** mapper cleanups galore
83:                  **
84:                  ** Revision 1.5  2000/10/22 15:03:13  matt
85:                  ** simplified mirroring
86:                  **
87:                  ** Revision 1.4  2000/10/21 19:33:38  matt
88:                  ** many more cleanups
89:                  **
90:                  ** Revision 1.3  2000/08/16 02:50:11  matt
91:                  ** random mapper cleanups
92:                  **
93:                  ** Revision 1.2  2000/07/06 02:48:43  matt
94:                  ** clearly labelled structure members
95:                  **
96:                  ** Revision 1.1  2000/07/04 23:11:45  matt
97:                  ** initial revision
98:                  **
99:                  */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map005.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map5.c
21:                  **
22:                  ** mapper 5 interface
23:                  ** $Id: map005.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes.h>
29:                  #include <log.h>
30:                  #include "mmc5_snd.h"
31:                  
32:                  /* TODO: there's lots of info about this mapper now;
33:                  ** let's implement it correctly/completely
34:                  */
35:                  
36:                  static struct
37:                  {
38:                     int counter, enabled;
39:                     int reset, latch;
40:                  } irq;
41:                  
42:                  /* MMC5 - Castlevania III, etc */
43:                  static void map5_hblank(int vblank)
44:                  {
9D038B2C  27BDFFE8   ADDIU SP, SP, -24
9D038B30  AFBF0014   SW RA, 20(SP)
9D038B34  AFB00010   SW S0, 16(SP)
45:                     UNUSED(vblank);
46:                  
47:                     if (irq.counter == nes_getcontextptr()->scanline)
9D038B38  3C02A001   LUI V0, -24575
9D038B3C  0F4097E7   JAL nes_getcontextptr
9D038B40  8C50591C   LW S0, 22812(V0)
9D038B44  8C430320   LW V1, 800(V0)
9D038B48  16030010   BNE S0, V1, 0x9D038B8C
9D038B4C  8FBF0014   LW RA, 20(SP)
48:                     {
49:                        if (true == irq.enabled)
9D038B50  3C04A001   LUI A0, -24575
9D038B54  8C855920   LW A1, 22816(A0)
9D038B58  24060001   ADDIU A2, ZERO, 1
9D038B5C  14A60007   BNE A1, A2, 0x9D038B7C
9D038B60  3C09A001   LUI T1, -24575
50:                        {
51:                           nes_irq();
9D038B64  0F40975F   JAL nes_irq
9D038B68  00000000   NOP
52:                           irq.reset = true;
9D038B6C  24070001   ADDIU A3, ZERO, 1
9D038B70  3C08A001   LUI T0, -24575
9D038B74  AD075924   SW A3, 22820(T0)
53:                        }
54:                        //else 
55:                        //   irq.reset = false;
56:                        irq.counter = irq.latch;
9D038B78  3C09A001   LUI T1, -24575
9D038B7C  252A591C   ADDIU T2, T1, 22812
9D038B80  8D4B000C   LW T3, 12(T2)
9D038B84  AD2B591C   SW T3, 22812(T1)
57:                     }
58:                  }
9D038B88  8FBF0014   LW RA, 20(SP)
9D038B8C  8FB00010   LW S0, 16(SP)
9D038B90  03E00008   JR RA
9D038B94  27BD0018   ADDIU SP, SP, 24
59:                  
60:                  static void map5_write(uint32 address, uint8 value)
61:                  {
9D03890C  27BDFFE8   ADDIU SP, SP, -24
9D038910  AFBF0014   SW RA, 20(SP)
9D038914  AFB00010   SW S0, 16(SP)
9D038918  00A08021   ADDU S0, A1, ZERO
62:                     static int page_size = 8;
63:                  
64:                     /* ex-ram memory-- bleh! */
65:                     if (address >= 0x5C00 && address <= 0x5FFF)
9D0388FC  2482A400   ADDIU V0, A0, -23552
9D038900  2C430400   SLTIU V1, V0, 1024
9D038904  14600087   BNE V1, ZERO, 0x9D038B24
9D038908  00000000   NOP
66:                        return;
67:                  
68:                     switch (address)
9D03891C  24055122   ADDIU A1, ZERO, 20770
9D038920  10850054   BEQ A0, A1, 0x9D038A74
9D038924  2C865123   SLTIU A2, A0, 20771
9D038928  10C00015   BEQ A2, ZERO, 0x9D038980
9D03892C  240E512A   ADDIU T6, ZERO, 20778
9D038930  24075115   ADDIU A3, ZERO, 20757
9D038934  10870034   BEQ A0, A3, 0x9D038A08
9D038938  2C885116   SLTIU T0, A0, 20758
9D03893C  11000008   BEQ T0, ZERO, 0x9D038960
9D038940  240B5120   ADDIU T3, ZERO, 20768
9D038944  24095105   ADDIU T1, ZERO, 20741
9D038948  10890023   BEQ A0, T1, 0x9D0389D8
9D03894C  240A5114   ADDIU T2, ZERO, 20756
9D038950  108A0028   BEQ A0, T2, 0x9D0389F4
9D038954  24040008   ADDIU A0, ZERO, 8
9D038960  108B0038   BEQ A0, T3, 0x9D038A44
9D038964  2C8C5121   SLTIU T4, A0, 20769
9D038968  1180003C   BEQ T4, ZERO, 0x9D038A5C
9D03896C  240D5116   ADDIU T5, ZERO, 20758
9D038970  108D002F   BEQ A0, T5, 0x9D038A30
9D038974  24040008   ADDIU A0, ZERO, 8
9D038980  108E0052   BEQ A0, T6, 0x9D038ACC
9D038984  2C8F512B   SLTIU T7, A0, 20779
9D038988  11E0000B   BEQ T7, ZERO, 0x9D0389B8
9D03898C  24025203   ADDIU V0, ZERO, 20995
9D038990  24185128   ADDIU T8, ZERO, 20776
9D038994  10980042   BEQ A0, T8, 0x9D038AA0
9D038998  2C995129   SLTIU T9, A0, 20777
9D03899C  53200046   BEQL T9, ZERO, 0x9D038AB8
9D0389A0  24040001   ADDIU A0, ZERO, 1
9D0389A4  241F5123   ADDIU RA, ZERO, 20771
9D0389A8  109F0038   BEQ A0, RA, 0x9D038A8C
9D0389AC  24040001   ADDIU A0, ZERO, 1
9D0389B8  1082004F   BEQ A0, V0, 0x9D038AF8
9D0389BC  24035204   ADDIU V1, ZERO, 20996
9D0389C0  10830052   BEQ A0, V1, 0x9D038B0C
9D0389C4  2405512B   ADDIU A1, ZERO, 20779
9D0389C8  54850054   BNEL A0, A1, 0x9D038B1C
9D0389CC  8FBF0014   LW RA, 20(SP)
69:                     {
70:                     case 0x5100:
71:                        /* PRG page size setting */
72:                        /* 0:32k 1:16k 2,3:8k */
73:                        switch (value & 3)
74:                        {
75:                        case 0:
76:                           page_size = 32;
77:                           break;
78:                  
79:                        case 1:
80:                           page_size = 16;
81:                           break;
82:                        
83:                        case 2:
84:                        case 3:
85:                           page_size = 8;
86:                           break;
87:                        }
88:                        break;
89:                  
90:                     case 0x5101:
91:                        /* CHR page size setting */
92:                        /* 0:8k 1:4k 2:2k 3:1k */
93:                        break;
94:                  
95:                     case 0x5104:
96:                        /* GFX mode setting */
97:                        /*
98:                        00:split mode
99:                        01:split & exgraffix
100:                       10:ex-ram
101:                       11:exram + write protect
102:                       */
103:                       break;
104:                    
105:                    case 0x5105:
106:                       /* TODO: exram needs to fill in nametables 2-3 */
107:                       ppu_mirror(value & 3, (value >> 2) & 3, (value >> 4) & 3, value >> 6);
9D0389D8  32040003   ANDI A0, S0, 3
9D0389DC  7E050880   EXT A1, S0, 2, 2
9D0389E0  7E060900   EXT A2, S0, 4, 2
9D0389E4  0F4058FD   JAL ppu_mirror
9D0389E8  00103982   SRL A3, S0, 6
108:                       break;
9D0389EC  0B40E2C7   J 0x9D038B1C
9D0389F0  8FBF0014   LW RA, 20(SP)
109:                 
110:                    case 0x5106:
111:                    case 0x5107:
112:                       /* ex-ram fill mode stuff */
113:                       break;
114:                    
115:                    case 0x5113:
116:                       /* ram page for $6000-7FFF? bit 2*/
117:                       break;
118:                    
119:                    case 0x5114:
120:                       mmc_bankrom(8, 0x8000, value);
9D0389F4  34058000   ORI A1, ZERO, -32768
9D0389F8  0F40CA71   JAL mmc_bankrom
9D0389FC  02003021   ADDU A2, S0, ZERO
121:                       //if (page_size == 8)
122:                       //   mmc_bankrom(8, 0x8000, value);
123:                       break;
9D038A00  0B40E2C7   J 0x9D038B1C
9D038A04  8FBF0014   LW RA, 20(SP)
124:                 
125:                    case 0x5115:
126:                       mmc_bankrom(8, 0x8000, value);
9D038A08  24040008   ADDIU A0, ZERO, 8
9D038A0C  34058000   ORI A1, ZERO, -32768
9D038A10  0F40CA71   JAL mmc_bankrom
9D038A14  02003021   ADDU A2, S0, ZERO
127:                       mmc_bankrom(8, 0xA000, value + 1);
9D038A18  24040008   ADDIU A0, ZERO, 8
9D038A1C  3405A000   ORI A1, ZERO, -24576
9D038A20  0F40CA71   JAL mmc_bankrom
9D038A24  26060001   ADDIU A2, S0, 1
128:                       //if (page_size == 8)
129:                       //   mmc_bankrom(8, 0xA000, value);
130:                       //else if (page_size == 16)
131:                       //   mmc_bankrom(16, 0x8000, value >> 1);
132:                          //mmc_bankrom(16, 0x8000, value & 0xFE);
133:                       break;
9D038A28  0B40E2C7   J 0x9D038B1C
9D038A2C  8FBF0014   LW RA, 20(SP)
134:                 
135:                    case 0x5116:
136:                       mmc_bankrom(8, 0xC000, value);
9D038A30  3405C000   ORI A1, ZERO, -16384
9D038A34  0F40CA71   JAL mmc_bankrom
9D038A38  02003021   ADDU A2, S0, ZERO
137:                       //if (page_size == 8)
138:                       //   mmc_bankrom(8, 0xC000, value);
139:                       break;
9D038A3C  0B40E2C7   J 0x9D038B1C
9D038A40  8FBF0014   LW RA, 20(SP)
140:                 
141:                    case 0x5117:
142:                       //if (page_size == 8)
143:                       //   mmc_bankrom(8, 0xE000, value);
144:                       //else if (page_size == 16)
145:                       //   mmc_bankrom(16, 0xC000, value >> 1);
146:                          //mmc_bankrom(16, 0xC000, value & 0xFE);
147:                       //else if (page_size == 32)
148:                       //   mmc_bankrom(32, 0x8000, value >> 2);
149:                          //mmc_bankrom(32, 0x8000, value & 0xFC);
150:                       break;
151:                 
152:                    case 0x5120:
153:                       mmc_bankvrom(1, 0x0000, value);
9D038A44  24040001   ADDIU A0, ZERO, 1
9D038A48  00002821   ADDU A1, ZERO, ZERO
9D038A4C  0F40CA16   JAL mmc_bankvrom
9D038A50  02003021   ADDU A2, S0, ZERO
154:                       break;
9D038A54  0B40E2C7   J 0x9D038B1C
9D038A58  8FBF0014   LW RA, 20(SP)
155:                 
156:                    case 0x5121:
157:                       mmc_bankvrom(1, 0x0400, value);
9D038A5C  24040001   ADDIU A0, ZERO, 1
9D038A60  24050400   ADDIU A1, ZERO, 1024
9D038A64  0F40CA16   JAL mmc_bankvrom
9D038A68  02003021   ADDU A2, S0, ZERO
158:                       break;
9D038A6C  0B40E2C7   J 0x9D038B1C
9D038A70  8FBF0014   LW RA, 20(SP)
159:                 
160:                    case 0x5122:
161:                       mmc_bankvrom(1, 0x0800, value);
9D038A74  24040001   ADDIU A0, ZERO, 1
9D038A78  24050800   ADDIU A1, ZERO, 2048
9D038A7C  0F40CA16   JAL mmc_bankvrom
9D038A80  02003021   ADDU A2, S0, ZERO
162:                       break;
9D038A84  0B40E2C7   J 0x9D038B1C
9D038A88  8FBF0014   LW RA, 20(SP)
163:                 
164:                    case 0x5123:
165:                       mmc_bankvrom(1, 0x0C00, value);
9D038A8C  24050C00   ADDIU A1, ZERO, 3072
9D038A90  0F40CA16   JAL mmc_bankvrom
9D038A94  02003021   ADDU A2, S0, ZERO
166:                       break;
9D038A98  0B40E2C7   J 0x9D038B1C
9D038A9C  8FBF0014   LW RA, 20(SP)
167:                 
168:                    case 0x5124:
169:                    case 0x5125:
170:                    case 0x5126:
171:                    case 0x5127:
172:                       /* more VROM shit? */
173:                       break;
174:                 
175:                    case 0x5128:
176:                       mmc_bankvrom(1, 0x1000, value);
9D038AA0  24040001   ADDIU A0, ZERO, 1
9D038AA4  24051000   ADDIU A1, ZERO, 4096
9D038AA8  0F40CA16   JAL mmc_bankvrom
9D038AAC  02003021   ADDU A2, S0, ZERO
177:                       break;
9D038AB0  0B40E2C7   J 0x9D038B1C
9D038AB4  8FBF0014   LW RA, 20(SP)
178:                 
179:                    case 0x5129:
180:                       mmc_bankvrom(1, 0x1400, value);
9D038AB8  24051400   ADDIU A1, ZERO, 5120
9D038ABC  0F40CA16   JAL mmc_bankvrom
9D038AC0  02003021   ADDU A2, S0, ZERO
181:                       break;
9D038AC4  0B40E2C7   J 0x9D038B1C
9D038AC8  8FBF0014   LW RA, 20(SP)
182:                 
183:                    case 0x512A:
184:                       mmc_bankvrom(1, 0x1800, value);
9D038ACC  24040001   ADDIU A0, ZERO, 1
9D038AD0  24051800   ADDIU A1, ZERO, 6144
9D038AD4  0F40CA16   JAL mmc_bankvrom
9D038AD8  02003021   ADDU A2, S0, ZERO
185:                       break;
9D038ADC  0B40E2C7   J 0x9D038B1C
9D038AE0  8FBF0014   LW RA, 20(SP)
186:                 
187:                    case 0x512B:
188:                       mmc_bankvrom(1, 0x1C00, value);
9D0389D0  0B40E2B9   J 0x9D038AE4
9D0389D4  24040001   ADDIU A0, ZERO, 1
9D038AE4  24051C00   ADDIU A1, ZERO, 7168
9D038AE8  0F40CA16   JAL mmc_bankvrom
9D038AEC  02003021   ADDU A2, S0, ZERO
189:                       break;
9D038AF0  0B40E2C7   J 0x9D038B1C
9D038AF4  8FBF0014   LW RA, 20(SP)
190:                 
191:                    case 0x5203:
192:                       irq.counter = value;
9D038AF8  3C06A001   LUI A2, -24575
9D038AFC  ACD0591C   SW S0, 22812(A2)
193:                       irq.latch = value;
9D038B00  24C7591C   ADDIU A3, A2, 22812
194:                 //      irq.reset = false;
195:                       break;
9D038B04  0B40E2C6   J 0x9D038B18
9D038B08  ACF0000C   SW S0, 12(A3)
196:                 
197:                    case 0x5204:
198:                       irq.enabled = (value & 0x80) ? true : false;
9D038B0C  001021C2   SRL A0, S0, 7
9D038B10  3C10A001   LUI S0, -24575
9D038B14  AE045920   SW A0, 22816(S0)
199:                 //      irq.reset = false;
200:                       break;
201:                 
202:                    default:
203:                 #ifdef NOFRENDO_DEBUG
204:                       log_printf("unknown mmc5 write: $%02X to $%04X\n", value, address);
205:                 #endif /* NOFRENDO_DEBUG */
206:                       break;
207:                    }
208:                 }
9D038958  0B40E2C7   J 0x9D038B1C
9D03895C  8FBF0014   LW RA, 20(SP)
9D038978  0B40E2C7   J 0x9D038B1C
9D03897C  8FBF0014   LW RA, 20(SP)
9D0389B0  0B40E2C7   J 0x9D038B1C
9D0389B4  8FBF0014   LW RA, 20(SP)
9D038B18  8FBF0014   LW RA, 20(SP)
9D038B1C  8FB00010   LW S0, 16(SP)
9D038B20  27BD0018   ADDIU SP, SP, 24
9D038B24  03E00008   JR RA
9D038B28  00000000   NOP
209:                 
210:                 static uint8 map5_read(uint32 address)
211:                 {
212:                    /* Castlevania 3 IRQ counter */
213:                    if (address == 0x5204)
9D03885C  24035204   ADDIU V1, ZERO, 20996
9D038860  14830005   BNE A0, V1, 0x9D038878
9D038864  240200FF   ADDIU V0, ZERO, 255
214:                    {
215:                       /* if reset == 1, we've hit scanline */
216:                       return (irq.reset ? 0x40 : 0x00);
9D038868  3C02A001   LUI V0, -24575
9D03886C  8C445924   LW A0, 22820(V0)
9D038870  24020040   ADDIU V0, ZERO, 64
9D038874  0004100A   MOVZ V0, ZERO, A0
217:                    }
218:                    else
219:                    {
220:                 #ifdef NOFRENDO_DEBUG
221:                       log_printf("invalid MMC5 read: $%04X", address);
222:                 #endif
223:                       return 0xFF;
224:                    }
225:                 }
9D038878  03E00008   JR RA
9D03887C  00000000   NOP
226:                 
227:                 static void map5_init(void)
228:                 {
9D038890  27BDFFE8   ADDIU SP, SP, -24
9D038894  AFBF0014   SW RA, 20(SP)
229:                    mmc_bankrom(8, 0x8000, MMC_LASTBANK);
9D038898  24040008   ADDIU A0, ZERO, 8
9D03889C  34058000   ORI A1, ZERO, -32768
9D0388A0  0F40CA71   JAL mmc_bankrom
9D0388A4  2406FFFF   ADDIU A2, ZERO, -1
230:                    mmc_bankrom(8, 0xA000, MMC_LASTBANK);
9D0388A8  24040008   ADDIU A0, ZERO, 8
9D0388AC  3405A000   ORI A1, ZERO, -24576
9D0388B0  0F40CA71   JAL mmc_bankrom
9D0388B4  2406FFFF   ADDIU A2, ZERO, -1
231:                    mmc_bankrom(8, 0xC000, MMC_LASTBANK);
9D0388B8  24040008   ADDIU A0, ZERO, 8
9D0388BC  3405C000   ORI A1, ZERO, -16384
9D0388C0  0F40CA71   JAL mmc_bankrom
9D0388C4  2406FFFF   ADDIU A2, ZERO, -1
232:                    mmc_bankrom(8, 0xE000, MMC_LASTBANK);
9D0388C8  24040008   ADDIU A0, ZERO, 8
9D0388CC  3405E000   ORI A1, ZERO, -8192
9D0388D0  0F40CA71   JAL mmc_bankrom
9D0388D4  2406FFFF   ADDIU A2, ZERO, -1
233:                 
234:                    irq.counter = irq.enabled = 0;
9D0388D8  3C03A001   LUI V1, -24575
9D0388DC  2462591C   ADDIU V0, V1, 22812
9D0388E0  AC400004   SW ZERO, 4(V0)
9D0388E4  AC60591C   SW ZERO, 22812(V1)
235:                    irq.reset = irq.latch = 0;
9D0388E8  AC40000C   SW ZERO, 12(V0)
9D0388EC  AC400008   SW ZERO, 8(V0)
236:                 }
9D0388F0  8FBF0014   LW RA, 20(SP)
9D0388F4  03E00008   JR RA
9D0388F8  27BD0018   ADDIU SP, SP, 24
237:                 
238:                 /* incomplete SNSS definition */
239:                 static void map5_getstate(SnssMapperBlock *state)
240:                 {
241:                    state->extraData.mapper5.dummy = 0;
9D038880  03E00008   JR RA
9D038884  A0800018   SB ZERO, 24(A0)
242:                 }
243:                 
244:                 static void map5_setstate(SnssMapperBlock *state)
245:                 {
9D038888  03E00008   JR RA
9D03888C  00000000   NOP
246:                    UNUSED(state);
247:                 }
248:                 
249:                 static map_memwrite map5_memwrite[] =
250:                 {
251:                    /* $5000 - $5015 handled by sound */
252:                    { 0x5016, 0x5FFF, map5_write },
253:                    { 0x8000, 0xFFFF, map5_write },
254:                    {     -1,     -1, NULL }
255:                 };
256:                 
257:                 static map_memread map5_memread[] = 
258:                 {
259:                    { 0x5204, 0x5204, map5_read },
260:                    {     -1,     -1, NULL }
261:                 };
262:                 
263:                 mapintf_t map5_intf =
264:                 {
265:                    5, /* mapper number */
266:                    "MMC5", /* mapper name */
267:                    map5_init, /* init routine */
268:                    NULL, /* vblank callback */
269:                    map5_hblank, /* hblank callback */
270:                    map5_getstate, /* get state (snss) */
271:                    map5_setstate, /* set state (snss) */
272:                    map5_memread, /* memory read structure */
273:                    map5_memwrite, /* memory write structure */
274:                    &mmc5_ext /* external sound device */
275:                 };
276:                 /*
277:                 ** $Log: map005.c,v $
278:                 ** Revision 1.2  2001/04/27 14:37:11  neil
279:                 ** wheeee
280:                 **
281:                 ** Revision 1.1  2001/04/27 12:54:40  neil
282:                 ** blah
283:                 **
284:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
285:                 ** initial
286:                 **
287:                 ** Revision 1.2  2000/11/25 20:32:33  matt
288:                 ** scanline interface change
289:                 **
290:                 ** Revision 1.1  2000/10/24 12:19:32  matt
291:                 ** changed directory structure
292:                 **
293:                 ** Revision 1.11  2000/10/22 19:17:46  matt
294:                 ** mapper cleanups galore
295:                 **
296:                 ** Revision 1.10  2000/10/21 19:33:37  matt
297:                 ** many more cleanups
298:                 **
299:                 ** Revision 1.9  2000/10/17 03:23:16  matt
300:                 ** added mmc5 sound interface
301:                 **
302:                 ** Revision 1.8  2000/10/10 13:58:17  matt
303:                 ** stroustrup squeezing his way in the door
304:                 **
305:                 ** Revision 1.7  2000/08/16 02:50:11  matt
306:                 ** random mapper cleanups
307:                 **
308:                 ** Revision 1.6  2000/07/15 23:52:19  matt
309:                 ** rounded out a bunch more mapper interfaces
310:                 **
311:                 ** Revision 1.5  2000/07/10 13:51:25  matt
312:                 ** using generic nes_irq() routine now
313:                 **
314:                 ** Revision 1.4  2000/07/10 05:29:03  matt
315:                 ** cleaned up some mirroring issues
316:                 **
317:                 ** Revision 1.3  2000/07/06 02:48:43  matt
318:                 ** clearly labelled structure members
319:                 **
320:                 ** Revision 1.2  2000/07/05 05:04:51  matt
321:                 ** fixed h-blank callback
322:                 **
323:                 ** Revision 1.1  2000/07/04 23:11:45  matt
324:                 ** initial revision
325:                 **
326:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map004.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map4.c
21:                  **
22:                  ** mapper 4 interface
23:                  ** $Id: map004.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  #include <nes.h>
29:                  #include <libsnss.h>
30:                  
31:                  static struct
32:                  {
33:                     int counter, latch;
34:                     bool enabled, reset;
35:                  } irq;
36:                  
37:                  static uint8 reg;
38:                  static uint8 command;
39:                  static uint16 vrombase;
40:                  
41:                  /* mapper 4: MMC3 */
42:                  static void map4_write(uint32 address, uint8 value)
43:                  {
9D036154  27BDFFE8   ADDIU SP, SP, -24
9D036158  AFBF0014   SW RA, 20(SP)
9D03615C  AFB00010   SW S0, 16(SP)
44:                     switch (address & 0xE001)
9D036160  3084E001   ANDI A0, A0, -8191
9D036164  3402C000   ORI V0, ZERO, -16384
9D036168  108200A2   BEQ A0, V0, 0x9D0363F4
9D03616C  00A08021   ADDU S0, A1, ZERO
9D036170  3403C001   ORI V1, ZERO, -16383
9D036174  0083282B   SLTU A1, A0, V1
9D036178  10A0000A   BEQ A1, ZERO, 0x9D0361A4
9D03617C  3406E000   ORI A2, ZERO, -8192
9D036180  34068001   ORI A2, ZERO, -32767
9D036184  1086002E   BEQ A0, A2, 0x9D036240
9D036188  3407A000   ORI A3, ZERO, -24576
9D03618C  10870083   BEQ A0, A3, 0x9D03639C
9D036190  34088000   ORI T0, ZERO, -32768
9D036194  148800A7   BNE A0, T0, 0x9D036434
9D036198  3C18A001   LUI T8, -24575
9D0361A4  1086009C   BEQ A0, A2, 0x9D036418
9D0361A8  3407E001   ORI A3, ZERO, -8191
9D0361AC  1087009D   BEQ A0, A3, 0x9D036424
9D0361B0  3408C001   ORI T0, ZERO, -16383
9D0361B4  1488009F   BNE A0, T0, 0x9D036434
9D0361B8  3C18A001   LUI T8, -24575
45:                     {
46:                     case 0x8000:
47:                        command = value;
9D03619C  0B40D871   J 0x9D0361C4
9D0361A0  A3908112   SB S0, -32494(GP)
48:                        vrombase = (command & 0x80) ? 0x1000 : 0x0000;
9D0361C4  001049C2   SRL T1, S0, 7
9D0361C8  240A1000   ADDIU T2, ZERO, 4096
9D0361CC  0009500A   MOVZ T2, ZERO, T1
9D0361D0  A78A8110   SH T2, -32496(GP)
49:                        
50:                        if (reg != (value & 0x40))
9D0361D4  320B0040   ANDI T3, S0, 64
9D0361D8  317000FF   ANDI S0, T3, 255
9D0361DC  938C8113   LBU T4, -32493(GP)
9D0361E0  51900093   BEQL T4, S0, 0x9D036430
9D0361E4  A3908113   SB S0, -32493(GP)
51:                        {
52:                           if (value & 0x40)
9D0361E8  1200000B   BEQ S0, ZERO, 0x9D036218
9D0361EC  00000000   NOP
53:                              mmc_bankrom(8, 0x8000, (mmc_getinfo()->rom_banks * 2) - 2);
9D0361F0  0F40CA0A   JAL mmc_getinfo
9D0361F4  00000000   NOP
9D0361F8  8C4F0010   LW T7, 16(V0)
9D0361FC  25F8FFFF   ADDIU T8, T7, -1
9D036200  24040008   ADDIU A0, ZERO, 8
9D036204  34058000   ORI A1, ZERO, -32768
9D036208  0F40CA71   JAL mmc_bankrom
9D03620C  00183040   SLL A2, T8, 1
9D036210  0B40D90C   J 0x9D036430
9D036214  A3908113   SB S0, -32493(GP)
54:                           else
55:                              mmc_bankrom(8, 0xC000, (mmc_getinfo()->rom_banks * 2) - 2);
9D036218  0F40CA0A   JAL mmc_getinfo
9D03621C  00000000   NOP
9D036220  8C4D0010   LW T5, 16(V0)
9D036224  25AEFFFF   ADDIU T6, T5, -1
9D036228  24040008   ADDIU A0, ZERO, 8
9D03622C  3405C000   ORI A1, ZERO, -16384
9D036230  0F40CA71   JAL mmc_bankrom
9D036234  000E3040   SLL A2, T6, 1
56:                        }
57:                        reg = value & 0x40;
58:                        break;
9D036238  0B40D90C   J 0x9D036430
9D03623C  A3908113   SB S0, -32493(GP)
59:                  
60:                     case 0x8001:
61:                        switch (command & 0x07)
9D036240  93858112   LBU A1, -32494(GP)
9D036244  30A30007   ANDI V1, A1, 7
9D036248  00033080   SLL A2, V1, 2
9D03624C  3C079D03   LUI A3, -25341
9D036250  24E86264   ADDIU T0, A3, 25188
9D036254  01064821   ADDU T1, T0, A2
9D036258  8D2A0000   LW T2, 0(T1)
9D03625C  01400008   JR T2
9D036260  00000000   NOP
62:                        {
63:                        case 0:
64:                           value &= 0xFE;
65:                           mmc_bankvrom(1, vrombase ^ 0x0000, value);
9D036284  321000FE   ANDI S0, S0, 254
9D036288  24040001   ADDIU A0, ZERO, 1
9D03628C  97858110   LHU A1, -32496(GP)
9D036290  0F40CA16   JAL mmc_bankvrom
9D036294  02003021   ADDU A2, S0, ZERO
66:                           mmc_bankvrom(1, vrombase ^ 0x0400, value + 1);
9D036298  97838110   LHU V1, -32496(GP)
9D03629C  24040001   ADDIU A0, ZERO, 1
9D0362A0  38650400   XORI A1, V1, 1024
9D0362A4  0F40CA16   JAL mmc_bankvrom
9D0362A8  26060001   ADDIU A2, S0, 1
67:                           break;
9D0362AC  0B40D90D   J 0x9D036434
9D0362B0  3C18A001   LUI T8, -24575
68:                  
69:                        case 1:
70:                           value &= 0xFE;
71:                           mmc_bankvrom(1, vrombase ^ 0x0800, value);
9D0362B4  321000FE   ANDI S0, S0, 254
9D0362B8  979F8110   LHU RA, -32496(GP)
9D0362BC  24040001   ADDIU A0, ZERO, 1
9D0362C0  3BE50800   XORI A1, RA, 2048
9D0362C4  0F40CA16   JAL mmc_bankvrom
9D0362C8  02003021   ADDU A2, S0, ZERO
72:                           mmc_bankvrom(1, vrombase ^ 0x0C00, value + 1);
9D0362CC  97858110   LHU A1, -32496(GP)
9D0362D0  24040001   ADDIU A0, ZERO, 1
9D0362D4  38A50C00   XORI A1, A1, 3072
9D0362D8  0F40CA16   JAL mmc_bankvrom
9D0362DC  26060001   ADDIU A2, S0, 1
73:                           break;
9D0362E0  0B40D90D   J 0x9D036434
9D0362E4  3C18A001   LUI T8, -24575
74:                  
75:                        case 2:
76:                           mmc_bankvrom(1, vrombase ^ 0x1000, value);
9D0362E8  97828110   LHU V0, -32496(GP)
9D0362EC  24040001   ADDIU A0, ZERO, 1
9D0362F0  38451000   XORI A1, V0, 4096
9D0362F4  0F40CA16   JAL mmc_bankvrom
9D0362F8  02003021   ADDU A2, S0, ZERO
77:                           break;
9D0362FC  0B40D90D   J 0x9D036434
9D036300  3C18A001   LUI T8, -24575
78:                  
79:                        case 3:
80:                           mmc_bankvrom(1, vrombase ^ 0x1400, value);
9D036304  97998110   LHU T9, -32496(GP)
9D036308  24040001   ADDIU A0, ZERO, 1
9D03630C  3B251400   XORI A1, T9, 5120
9D036310  0F40CA16   JAL mmc_bankvrom
9D036314  02003021   ADDU A2, S0, ZERO
81:                           break;
9D036318  0B40D90D   J 0x9D036434
9D03631C  3C18A001   LUI T8, -24575
82:                  
83:                        case 4:
84:                           mmc_bankvrom(1, vrombase ^ 0x1800, value);
9D036320  97988110   LHU T8, -32496(GP)
9D036324  24040001   ADDIU A0, ZERO, 1
9D036328  3B051800   XORI A1, T8, 6144
9D03632C  0F40CA16   JAL mmc_bankvrom
9D036330  02003021   ADDU A2, S0, ZERO
85:                           break;
9D036334  0B40D90D   J 0x9D036434
9D036338  3C18A001   LUI T8, -24575
86:                  
87:                        case 5:
88:                           mmc_bankvrom(1, vrombase ^ 0x1C00, value);
9D03633C  978F8110   LHU T7, -32496(GP)
9D036340  24040001   ADDIU A0, ZERO, 1
9D036344  39E51C00   XORI A1, T7, 7168
9D036348  0F40CA16   JAL mmc_bankvrom
9D03634C  02003021   ADDU A2, S0, ZERO
89:                           break;
9D036350  0B40D90D   J 0x9D036434
9D036354  3C18A001   LUI T8, -24575
90:                  
91:                        case 6:
92:                           mmc_bankrom(8, (command & 0x40) ? 0xC000 : 0x8000, value);
9D036358  30AB0040   ANDI T3, A1, 64
9D03635C  316C00FF   ANDI T4, T3, 255
9D036360  24040008   ADDIU A0, ZERO, 8
9D036364  340DC000   ORI T5, ZERO, -16384
9D036368  340E8000   ORI T6, ZERO, -32768
9D03636C  01CC680A   MOVZ T5, T6, T4
9D036370  01A02821   ADDU A1, T5, ZERO
9D036374  0F40CA71   JAL mmc_bankrom
9D036378  02003021   ADDU A2, S0, ZERO
93:                           break;
9D03637C  0B40D90D   J 0x9D036434
9D036380  3C18A001   LUI T8, -24575
94:                  
95:                        case 7:
96:                           mmc_bankrom(8, 0xA000, value);
9D036384  24040008   ADDIU A0, ZERO, 8
9D036388  3405A000   ORI A1, ZERO, -24576
9D03638C  0F40CA71   JAL mmc_bankrom
9D036390  02003021   ADDU A2, S0, ZERO
97:                           break;
9D036394  0B40D90D   J 0x9D036434
9D036398  3C18A001   LUI T8, -24575
98:                        }
99:                        break;
100:                 
101:                    case 0xA000:
102:                       /* four screen mirroring crap */
103:                       if (0 == (mmc_getinfo()->flags & ROM_FLAG_FOURSCREEN))
9D03639C  0F40CA0A   JAL mmc_getinfo
9D0363A0  00000000   NOP
9D0363A4  90590028   LBU T9, 40(V0)
9D0363A8  33240004   ANDI A0, T9, 4
9D0363AC  308200FF   ANDI V0, A0, 255
9D0363B0  14400020   BNE V0, ZERO, 0x9D036434
9D0363B4  3C18A001   LUI T8, -24575
104:                       {
105:                          if (value & 1)
9D0363B8  321F0001   ANDI RA, S0, 1
9D0363BC  13E00007   BEQ RA, ZERO, 0x9D0363DC
9D0363C0  00002021   ADDU A0, ZERO, ZERO
106:                             ppu_mirror(0, 0, 1, 1); /* horizontal */
9D0363C4  00002821   ADDU A1, ZERO, ZERO
9D0363C8  24060001   ADDIU A2, ZERO, 1
9D0363CC  0F4058FD   JAL ppu_mirror
9D0363D0  24070001   ADDIU A3, ZERO, 1
9D0363D4  0B40D90D   J 0x9D036434
9D0363D8  3C18A001   LUI T8, -24575
107:                          else
108:                             ppu_mirror(0, 1, 0, 1); /* vertical */
9D0363DC  24050001   ADDIU A1, ZERO, 1
9D0363E0  00003021   ADDU A2, ZERO, ZERO
9D0363E4  0F4058FD   JAL ppu_mirror
9D0363E8  24070001   ADDIU A3, ZERO, 1
109:                       }
110:                       break;
111:                 
112:                    case 0xA001:
113:                       /* Save RAM enable / disable */
114:                       /* Messes up Startropics I/II if implemented -- bah */
115:                       break;
116:                 
117:                    case 0xC000:
118:                       irq.latch = value;
9D0363F4  3C0FA001   LUI T7, -24575
119:                 //      if (irq.reset)
120:                 //         irq.counter = irq.latch;
121:                       break;
9D0363F8  0B40D90C   J 0x9D036430
9D0363FC  ADE558C0   SW A1, 22720(T7)
122:                 
123:                    case 0xC001:
124:                       irq.reset = true;
9D0361BC  0B40D900   J 0x9D036400
9D0361C0  3C09A001   LUI T1, -24575
9D036400  252A58BC   ADDIU T2, T1, 22716
9D036404  24040001   ADDIU A0, ZERO, 1
9D036408  AD44000C   SW A0, 12(T2)
125:                       irq.counter = irq.latch;
9D03640C  8D4B0004   LW T3, 4(T2)
126:                       break;
9D036410  0B40D90C   J 0x9D036430
9D036414  AD2B58BC   SW T3, 22716(T1)
127:                 
128:                    case 0xE000:
129:                       irq.enabled = false;
9D036418  3C0EA001   LUI T6, -24575
130:                 //      if (irq.reset)
131:                 //         irq.counter = irq.latch;
132:                       break;
9D03641C  0B40D90C   J 0x9D036430
9D036420  ADC058C4   SW ZERO, 22724(T6)
133:                 
134:                    case 0xE001:
135:                       irq.enabled = true;
9D036424  240C0001   ADDIU T4, ZERO, 1
9D036428  3C0DA001   LUI T5, -24575
9D03642C  ADAC58C4   SW T4, 22724(T5)
136:                 //      if (irq.reset)
137:                 //         irq.counter = irq.latch;
138:                       break;
139:                 
140:                    default:
141:                       break;
142:                    }
143:                 
144:                    if (true == irq.reset)
9D0363EC  0B40D90D   J 0x9D036434
9D0363F0  3C18A001   LUI T8, -24575
9D036430  3C18A001   LUI T8, -24575
9D036434  8F1958C8   LW T9, 22728(T8)
9D036438  24020001   ADDIU V0, ZERO, 1
9D03643C  17220006   BNE T9, V0, 0x9D036458
9D036440  8FBF0014   LW RA, 20(SP)
145:                       irq.counter = irq.latch;
9D036444  3C1FA001   LUI RA, -24575
9D036448  27E558BC   ADDIU A1, RA, 22716
9D03644C  8CB00004   LW S0, 4(A1)
9D036450  AFF058BC   SW S0, 22716(RA)
146:                 }
9D036454  8FBF0014   LW RA, 20(SP)
9D036458  8FB00010   LW S0, 16(SP)
9D03645C  03E00008   JR RA
9D036460  27BD0018   ADDIU SP, SP, 24
147:                 
148:                 static void map4_hblank(int vblank)
149:                 {
9D03646C  27BDFFE8   ADDIU SP, SP, -24
9D036470  AFBF0014   SW RA, 20(SP)
150:                    if (vblank)
9D036464  14800019   BNE A0, ZERO, 0x9D0364CC
9D036468  00000000   NOP
151:                       return;
152:                 
153:                    if (ppu_enabled())
9D036474  0F405C83   JAL ppu_enabled
9D036478  00000000   NOP
9D03647C  10400011   BEQ V0, ZERO, .LVL33
9D036480  3C02A001   LUI V0, -24575
154:                    {
155:                       if (irq.counter >= 0)
9D036484  8C4558BC   LW A1, 22716(V0)
9D036488  04A0000E   BLTZ A1, .LVL33
9D03648C  3C03A001   LUI V1, -24575
156:                       {
157:                          irq.reset = false;
9D036490  246458BC   ADDIU A0, V1, 22716
9D036494  AC80000C   SW ZERO, 12(A0)
158:                          irq.counter--;
9D036498  24A6FFFF   ADDIU A2, A1, -1
159:                 
160:                          if (irq.counter < 0)
9D03649C  04C10009   BGEZ A2, .LVL33
9D0364A0  AC6658BC   SW A2, 22716(V1)
161:                          {
162:                             if (irq.enabled)
9D0364A4  3C07A001   LUI A3, -24575
9D0364A8  8CE858C4   LW T0, 22724(A3)
9D0364AC  11000006   BEQ T0, ZERO, 0x9D0364C8
9D0364B0  8FBF0014   LW RA, 20(SP)
163:                             {
164:                                irq.reset = true;
9D0364B4  24090001   ADDIU T1, ZERO, 1
9D0364B8  3C0AA001   LUI T2, -24575
165:                                nes_irq();
9D0364BC  0F40975F   JAL nes_irq
9D0364C0  AD4958C8   SW T1, 22728(T2)
166:                             }
167:                          }
168:                       }
169:                    }
170:                 }
9D0364C4  8FBF0014   LW RA, 20(SP)
9D0364C8  27BD0018   ADDIU SP, SP, 24
9D0364CC  03E00008   JR RA
9D0364D0  00000000   NOP
171:                 
172:                 static void map4_getstate(SnssMapperBlock *state)
173:                 {
174:                    state->extraData.mapper4.irqCounter = irq.counter;
9D0360D4  3C02A001   LUI V0, -24575
9D0360D8  8C4358BC   LW V1, 22716(V0)
9D0360DC  A0830018   SB V1, 24(A0)
175:                    state->extraData.mapper4.irqLatchCounter = irq.latch;
9D0360E0  244558BC   ADDIU A1, V0, 22716
9D0360E4  8CA60004   LW A2, 4(A1)
9D0360E8  A0860019   SB A2, 25(A0)
176:                    state->extraData.mapper4.irqCounterEnabled = irq.enabled;
9D0360EC  8CA70008   LW A3, 8(A1)
9D0360F0  A087001A   SB A3, 26(A0)
177:                    state->extraData.mapper4.last8000Write = command;
9D0360F4  93888112   LBU T0, -32494(GP)
9D0360F8  03E00008   JR RA
9D0360FC  A088001B   SB T0, 27(A0)
178:                 }
179:                 
180:                 static void map4_setstate(SnssMapperBlock *state)
181:                 {
182:                    irq.counter = state->extraData.mapper4.irqCounter;
9D036100  3C02A001   LUI V0, -24575
9D036104  90830018   LBU V1, 24(A0)
9D036108  AC4358BC   SW V1, 22716(V0)
183:                    irq.latch = state->extraData.mapper4.irqLatchCounter;
9D03610C  244558BC   ADDIU A1, V0, 22716
9D036110  90860019   LBU A2, 25(A0)
9D036114  ACA60004   SW A2, 4(A1)
184:                    irq.enabled = state->extraData.mapper4.irqCounterEnabled;
9D036118  9087001A   LBU A3, 26(A0)
9D03611C  ACA70008   SW A3, 8(A1)
185:                    command = state->extraData.mapper4.last8000Write;
9D036120  9084001B   LBU A0, 27(A0)
9D036124  03E00008   JR RA
9D036128  A3848112   SB A0, -32494(GP)
186:                 }
187:                 
188:                 static void map4_init(void)
189:                 {
190:                    irq.counter = irq.latch = 0;
9D03612C  3C03A001   LUI V1, -24575
9D036130  246258BC   ADDIU V0, V1, 22716
9D036134  AC400004   SW ZERO, 4(V0)
9D036138  AC6058BC   SW ZERO, 22716(V1)
191:                    irq.enabled = irq.reset = false;
9D03613C  AC40000C   SW ZERO, 12(V0)
9D036140  AC400008   SW ZERO, 8(V0)
192:                    reg = command = 0;
9D036144  A3808112   SB ZERO, -32494(GP)
9D036148  A3808113   SB ZERO, -32493(GP)
193:                    vrombase = 0x0000;
9D03614C  03E00008   JR RA
9D036150  A7808110   SH ZERO, -32496(GP)
194:                 }
195:                 
196:                 static map_memwrite map4_memwrite[] =
197:                 {
198:                    { 0x8000, 0xFFFF, map4_write },
199:                    {     -1,     -1, NULL }
200:                 };
201:                 
202:                 mapintf_t map4_intf =
203:                 {
204:                    4, /* mapper number */
205:                    "MMC3", /* mapper name */
206:                    map4_init, /* init routine */
207:                    NULL, /* vblank callback */
208:                    map4_hblank, /* hblank callback */
209:                    map4_getstate, /* get state (snss) */
210:                    map4_setstate, /* set state (snss) */
211:                    NULL, /* memory read structure */
212:                    map4_memwrite, /* memory write structure */
213:                    NULL /* external sound device */
214:                 };
215:                 
216:                 /*
217:                 ** $Log: map004.c,v $
218:                 ** Revision 1.2  2001/04/27 14:37:11  neil
219:                 ** wheeee
220:                 **
221:                 ** Revision 1.1  2001/04/27 12:54:40  neil
222:                 ** blah
223:                 **
224:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
225:                 ** initial
226:                 **
227:                 ** Revision 1.2  2000/11/26 15:40:49  matt
228:                 ** hey, it actually works now
229:                 **
230:                 ** Revision 1.1  2000/10/24 12:19:32  matt
231:                 ** changed directory structure
232:                 **
233:                 ** Revision 1.12  2000/10/23 15:53:27  matt
234:                 ** suppressed warnings
235:                 **
236:                 ** Revision 1.11  2000/10/22 19:17:46  matt
237:                 ** mapper cleanups galore
238:                 **
239:                 ** Revision 1.10  2000/10/22 15:03:13  matt
240:                 ** simplified mirroring
241:                 **
242:                 ** Revision 1.9  2000/10/21 19:33:38  matt
243:                 ** many more cleanups
244:                 **
245:                 ** Revision 1.8  2000/10/10 13:58:17  matt
246:                 ** stroustrup squeezing his way in the door
247:                 **
248:                 ** Revision 1.7  2000/10/08 18:05:44  matt
249:                 ** kept old version around, just in case....
250:                 **
251:                 ** Revision 1.6  2000/07/15 23:52:19  matt
252:                 ** rounded out a bunch more mapper interfaces
253:                 **
254:                 ** Revision 1.5  2000/07/10 13:51:25  matt
255:                 ** using generic nes_irq() routine now
256:                 **
257:                 ** Revision 1.4  2000/07/10 05:29:03  matt
258:                 ** cleaned up some mirroring issues
259:                 **
260:                 ** Revision 1.3  2000/07/06 02:48:43  matt
261:                 ** clearly labelled structure members
262:                 **
263:                 ** Revision 1.2  2000/07/05 05:04:39  matt
264:                 ** minor modifications
265:                 **
266:                 ** Revision 1.1  2000/07/04 23:11:45  matt
267:                 ** initial revision
268:                 **
269:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map003.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map3.c
21:                  **
22:                  ** mapper 3 interface
23:                  ** $Id: map003.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  
29:                  /* mapper 3: CNROM */
30:                  static void map3_write(uint32 address, uint8 value)
31:                  {
9D0422FC  27BDFFE8   ADDIU SP, SP, -24
9D042300  AFBF0014   SW RA, 20(SP)
9D042304  00A03021   ADDU A2, A1, ZERO
32:                     UNUSED(address);
33:                  
34:                     mmc_bankvrom(8, 0x0000, value);
9D042308  24040008   ADDIU A0, ZERO, 8
9D04230C  0F40CA16   JAL mmc_bankvrom
9D042310  00002821   ADDU A1, ZERO, ZERO
35:                  }
9D042314  8FBF0014   LW RA, 20(SP)
9D042318  03E00008   JR RA
9D04231C  27BD0018   ADDIU SP, SP, 24
36:                  
37:                  static map_memwrite map3_memwrite[] =
38:                  {
39:                     { 0x8000, 0xFFFF, map3_write },
40:                     {     -1,     -1, NULL }
41:                  };
42:                  
43:                  mapintf_t map3_intf =
44:                  {
45:                     3, /* mapper number */
46:                     "CNROM", /* mapper name */
47:                     NULL, /* init routine */
48:                     NULL, /* vblank callback */
49:                     NULL, /* hblank callback */
50:                     NULL, /* get state (snss) */
51:                     NULL, /* set state (snss) */
52:                     NULL, /* memory read structure */
53:                     map3_memwrite, /* memory write structure */
54:                     NULL /* external sound device */
55:                  };
56:                  
57:                  /*
58:                  ** $Log: map003.c,v $
59:                  ** Revision 1.2  2001/04/27 14:37:11  neil
60:                  ** wheeee
61:                  **
62:                  ** Revision 1.1  2001/04/27 12:54:40  neil
63:                  ** blah
64:                  **
65:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
66:                  ** initial
67:                  **
68:                  ** Revision 1.1  2000/10/24 12:19:32  matt
69:                  ** changed directory structure
70:                  **
71:                  ** Revision 1.5  2000/10/22 19:17:46  matt
72:                  ** mapper cleanups galore
73:                  **
74:                  ** Revision 1.4  2000/10/21 19:33:38  matt
75:                  ** many more cleanups
76:                  **
77:                  ** Revision 1.3  2000/08/16 02:50:11  matt
78:                  ** random mapper cleanups
79:                  **
80:                  ** Revision 1.2  2000/07/06 02:48:43  matt
81:                  ** clearly labelled structure members
82:                  **
83:                  ** Revision 1.1  2000/07/04 23:11:45  matt
84:                  ** initial revision
85:                  **
86:                  */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map002.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map2.c
21:                  **
22:                  ** mapper 2 interface
23:                  ** $Id: map002.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <noftypes.h>
27:                  #include <nes_mmc.h>
28:                  
29:                  /* mapper 2: UNROM */
30:                  static void map2_write(uint32 address, uint8 value)
31:                  {
9D042344  27BDFFE8   ADDIU SP, SP, -24
9D042348  AFBF0014   SW RA, 20(SP)
9D04234C  00A03021   ADDU A2, A1, ZERO
32:                     UNUSED(address);
33:                  
34:                     mmc_bankrom(16, 0x8000, value);
9D042350  24040010   ADDIU A0, ZERO, 16
9D042354  0F40CA71   JAL mmc_bankrom
9D042358  34058000   ORI A1, ZERO, -32768
35:                  }
9D04235C  8FBF0014   LW RA, 20(SP)
9D042360  03E00008   JR RA
9D042364  27BD0018   ADDIU SP, SP, 24
36:                  
37:                  static map_memwrite map2_memwrite[] =
38:                  {
39:                     { 0x8000, 0xFFFF, map2_write },
40:                     {     -1,     -1, NULL }
41:                  };
42:                  
43:                  mapintf_t map2_intf =
44:                  {
45:                     2, /* mapper number */
46:                     "UNROM", /* mapper name */
47:                     NULL, /* init routine */
48:                     NULL, /* vblank callback */
49:                     NULL, /* hblank callback */
50:                     NULL, /* get state (snss) */
51:                     NULL, /* set state (snss) */
52:                     NULL, /* memory read structure */
53:                     map2_memwrite, /* memory write structure */
54:                     NULL /* external sound device */
55:                  };
56:                  
57:                  /*
58:                  ** $Log: map002.c,v $
59:                  ** Revision 1.2  2001/04/27 14:37:11  neil
60:                  ** wheeee
61:                  **
62:                  ** Revision 1.1  2001/04/27 12:54:40  neil
63:                  ** blah
64:                  **
65:                  ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
66:                  ** initial
67:                  **
68:                  ** Revision 1.1  2000/10/24 12:19:32  matt
69:                  ** changed directory structure
70:                  **
71:                  ** Revision 1.5  2000/10/22 19:17:46  matt
72:                  ** mapper cleanups galore
73:                  **
74:                  ** Revision 1.4  2000/10/21 19:33:38  matt
75:                  ** many more cleanups
76:                  **
77:                  ** Revision 1.3  2000/08/16 02:50:11  matt
78:                  ** random mapper cleanups
79:                  **
80:                  ** Revision 1.2  2000/07/06 02:48:43  matt
81:                  ** clearly labelled structure members
82:                  **
83:                  ** Revision 1.1  2000/07/04 23:11:45  matt
84:                  ** initial revision
85:                  **
86:                  */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/mappers/map001.c  --------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** map1.c
21:                  **
22:                  ** mapper 1 interface
23:                  ** $Id: map001.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <string.h>
27:                  #include <noftypes.h>
28:                  #include <nes_mmc.h>
29:                  #include <nes_ppu.h>
30:                  
31:                  /* TODO: WRAM enable ala Mark Knibbs:
32:                     ==================================
33:                  The SNROM board uses 8K CHR-RAM. The CHR-RAM is paged (i.e. it can be split
34:                  into two 4Kbyte pages).
35:                  
36:                  The CRA16 line of the MMC1 is connected to the /CS1 pin of the WRAM. THIS MEANS
37:                  THAT THE WRAM CAN BE ENABLED OR DISABLED ACCORDING TO THE STATE OF THE CRA16
38:                  LINE. The CRA16 line corresponds to bit 4 of MMC1 registers 1 & 2.
39:                  
40:                  The WRAM is enabled when the CRA16 line is low, and disabled when CRA16 is
41:                  high. This has implications when CHR page size is 4K, if the two page numbers
42:                  set have different CRA16 states (e.g. reg 1 bit 4 = 0, reg 2 bit 4 = 1). Then
43:                  the WRAM will be enabled and disabled depending on what CHR address is being
44:                  accessed.
45:                  
46:                  When CHR page size is 8K, bit 4 of MMC1 register 1 (and not register 2, because
47:                  page size is 8K) controls whether the WRAM is enabled or not. It must be low
48:                  to be enabled. When the WRAM is disabled, reading from and writing to it will
49:                  not be possible.
50:                  */
51:                  
52:                  /* TODO: roll this into something... */
53:                  static int bitcount = 0;
54:                  static uint8 latch = 0;
55:                  static uint8 regs[4];
56:                  static int bank_select;
57:                  static uint8 lastreg;
58:                  
59:                  static void map1_write(uint32 address, uint8 value)
60:                  {
9D037B7C  27BDFFE8   ADDIU SP, SP, -24
9D037B80  AFBF0014   SW RA, 20(SP)
61:                     int regnum = (address >> 13) - 4;
9D037B84  00042342   SRL A0, A0, 13
62:                  
63:                     if (value & 0x80)
9D037B88  7C051C20   SEB V1, A1
9D037B8C  04610008   BGEZ V1, 0x9D037BB0
9D037B90  2488FFFC   ADDIU T0, A0, -4
64:                     {
65:                        regs[0] |= 0x0C;
9D037B94  278E8188   ADDIU T6, GP, -32376
9D037B98  91CF0000   LBU T7, 0(T6)
9D037B9C  35F8000C   ORI T8, T7, 12
9D037BA0  A1D80000   SB T8, 0(T6)
66:                        bitcount = 0;
9D037BA4  AF808190   SW ZERO, -32368(GP)
67:                        latch = 0;
68:                        return;
9D037BA8  0B40DF87   J .LVL27
9D037BAC  A380818C   SB ZERO, -32372(GP)
69:                     }
70:                  
71:                     if (lastreg != regnum)
9D037BB0  93868180   LBU A2, -32384(GP)
9D037BB4  10C80004   BEQ A2, T0, 0x9D037BC8
9D037BB8  01001021   ADDU V0, T0, ZERO
72:                     {
73:                        bitcount = 0;
9D037BBC  AF808190   SW ZERO, -32368(GP)
74:                        latch = 0;
9D037BC0  A380818C   SB ZERO, -32372(GP)
75:                        lastreg = regnum;
9D037BC4  A3888180   SB T0, -32384(GP)
76:                     }
77:                     //lastreg = regnum;
78:                  
79:                     latch |= ((value & 1) << bitcount++);
9D037BC8  8F878190   LW A3, -32368(GP)
9D037BCC  24E90001   ADDIU T1, A3, 1
9D037BD0  AF898190   SW T1, -32368(GP)
9D037BD4  30A50001   ANDI A1, A1, 1
9D037BD8  00E55004   SLLV T2, A1, A3
9D037BDC  938B818C   LBU T3, -32372(GP)
9D037BE0  014B6025   OR T4, T2, T3
9D037BE4  318600FF   ANDI A2, T4, 255
80:                  
81:                     /* 5 bit registers */
82:                     if (5 != bitcount)
9D037BE8  240D0005   ADDIU T5, ZERO, 5
9D037BEC  152D008B   BNE T1, T5, .LVL27
9D037BF0  A386818C   SB A2, -32372(GP)
83:                        return;
84:                  
85:                     regs[regnum] = latch;
9D037BF4  278E8188   ADDIU T6, GP, -32376
9D037BF8  01C87821   ADDU T7, T6, T0
9D037BFC  A1E60000   SB A2, 0(T7)
86:                     value = latch;
87:                     bitcount = 0;
9D037C00  AF808190   SW ZERO, -32368(GP)
88:                     latch = 0;
89:                  
90:                     switch (regnum)
9D037C04  24180001   ADDIU T8, ZERO, 1
9D037C08  10580027   BEQ V0, T8, 0x9D037CA8
9D037C0C  A380818C   SB ZERO, -32372(GP)
9D037C10  29190002   SLTI T9, T0, 2
9D037C14  13200005   BEQ T9, ZERO, 0x9D037C2C
9D037C18  24030002   ADDIU V1, ZERO, 2
9D037C1C  5040000A   BEQL V0, ZERO, 0x9D037C48
9D037C20  30DF0002   ANDI RA, A2, 2
9D037C2C  1043002D   BEQ V0, V1, 0x9D037CE4
9D037C30  93898188   LBU T1, -32376(GP)
9D037C34  24060003   ADDIU A2, ZERO, 3
9D037C38  10460033   BEQ V0, A2, 0x9D037D08
9D037C3C  8FBF0014   LW RA, 20(SP)
9D037C40  0B40DF88   J 0x9D037E20
9D037C44  00000000   NOP
91:                     {
92:                     case 0:
93:                        {
94:                           if (0 == (value & 2))
9D037C48  33E400FF   ANDI A0, RA, 255
9D037C4C  14800008   BNE A0, ZERO, 0x9D037C70
9D037C50  30C80001   ANDI T0, A2, 1
95:                           {
96:                              int mirror = value & 1;
9D037C54  30C70001   ANDI A3, A2, 1
97:                              ppu_mirror(mirror, mirror, mirror, mirror);
9D037C58  00E02021   ADDU A0, A3, ZERO
9D037C5C  00E02821   ADDU A1, A3, ZERO
9D037C60  0F4058FD   JAL ppu_mirror
9D037C64  00E03021   ADDU A2, A3, ZERO
9D037C68  0B40DF88   J 0x9D037E20
9D037C6C  8FBF0014   LW RA, 20(SP)
98:                           }
99:                           else
100:                          {
101:                             if (value & 1)
9D037C70  11000007   BEQ T0, ZERO, 0x9D037C90
9D037C74  00002021   ADDU A0, ZERO, ZERO
102:                                ppu_mirror(0, 0, 1, 1);
9D037C78  00002821   ADDU A1, ZERO, ZERO
9D037C7C  24060001   ADDIU A2, ZERO, 1
9D037C80  0F4058FD   JAL ppu_mirror
9D037C84  24070001   ADDIU A3, ZERO, 1
9D037C88  0B40DF88   J 0x9D037E20
9D037C8C  8FBF0014   LW RA, 20(SP)
103:                             else
104:                                ppu_mirror(0, 1, 0, 1);
9D037C90  24050001   ADDIU A1, ZERO, 1
9D037C94  00003021   ADDU A2, ZERO, ZERO
9D037C98  0F4058FD   JAL ppu_mirror
9D037C9C  24070001   ADDIU A3, ZERO, 1
105:                          }
106:                       }
107:                       break;
108:                 
109:                    case 1:
110:                       if (regs[0] & 0x10)
9D037CA8  938B8188   LBU T3, -32376(GP)
9D037CAC  316C0010   ANDI T4, T3, 16
9D037CB0  318D00FF   ANDI T5, T4, 255
9D037CB4  11A00006   BEQ T5, ZERO, 0x9D037CD0
9D037CB8  24040008   ADDIU A0, ZERO, 8
111:                          mmc_bankvrom(4, 0x0000, value);
9D037CBC  24040004   ADDIU A0, ZERO, 4
9D037CC0  0F40CA16   JAL mmc_bankvrom
9D037CC4  00002821   ADDU A1, ZERO, ZERO
9D037CC8  0B40DF88   J 0x9D037E20
9D037CCC  8FBF0014   LW RA, 20(SP)
112:                       else
113:                          mmc_bankvrom(8, 0x0000, value >> 1);
9D037CD0  00002821   ADDU A1, ZERO, ZERO
9D037CD4  0F40CA16   JAL mmc_bankvrom
9D037CD8  00063042   SRL A2, A2, 1
114:                       break;
115:                 
116:                    case 2:
117:                       if (regs[0] & 0x10)
9D037CE4  31250010   ANDI A1, T1, 16
9D037CE8  30AA00FF   ANDI T2, A1, 255
9D037CEC  5140004C   BEQL T2, ZERO, 0x9D037E20
9D037CF0  8FBF0014   LW RA, 20(SP)
118:                          mmc_bankvrom(4, 0x1000, value);
9D037CF4  24040004   ADDIU A0, ZERO, 4
9D037CF8  0F40CA16   JAL mmc_bankvrom
9D037CFC  24051000   ADDIU A1, ZERO, 4096
119:                       break;
120:                 
121:                    case 3:
122:                       if (mmc_getinfo()->rom_banks == 0x20)
9D037D08  0F40CA0A   JAL mmc_getinfo
9D037D0C  00000000   NOP
9D037D10  8C470010   LW A3, 16(V0)
9D037D14  24020020   ADDIU V0, ZERO, 32
9D037D18  14E20007   BNE A3, V0, 0x9D037D38
9D037D1C  93828189   LBU V0, -32375(GP)
123:                       {
124:                          bank_select = (regs[1] & 0x10) ? 0 : 0x10;
9D037D20  30490010   ANDI T1, V0, 16
9D037D24  312500FF   ANDI A1, T1, 255
9D037D28  240A0010   ADDIU T2, ZERO, 16
9D037D2C  0005500B   MOVN T2, ZERO, A1
9D037D30  0B40DF66   J 0x9D037D98
9D037D34  AF8A8184   SW T2, -32380(GP)
125:                       }
126:                       else if (mmc_getinfo()->rom_banks == 0x40)
9D037D38  0F40CA0A   JAL mmc_getinfo
9D037D3C  00000000   NOP
9D037D40  8C490010   LW T1, 16(V0)
9D037D44  24050040   ADDIU A1, ZERO, 64
9D037D48  55250013   BNEL T1, A1, 0x9D037D98
9D037D4C  AF808184   SW ZERO, -32380(GP)
127:                       {
128:                          if (regs[0] & 0x10)
9D037D50  938A8188   LBU T2, -32376(GP)
9D037D54  314B0010   ANDI T3, T2, 16
9D037D58  316C00FF   ANDI T4, T3, 255
9D037D5C  1180000A   BEQ T4, ZERO, 0x9D037D88
9D037D60  938D8189   LBU T5, -32375(GP)
129:                             bank_select = (regs[1] & 0x10) | ((regs[2] & 0x10) << 1);
9D037D64  9399818A   LBU T9, -32374(GP)
9D037D68  333F0010   ANDI RA, T9, 16
9D037D6C  33E400FF   ANDI A0, RA, 255
9D037D70  00044040   SLL T0, A0, 1
9D037D74  93838189   LBU V1, -32375(GP)
9D037D78  30660010   ANDI A2, V1, 16
9D037D7C  00C83825   OR A3, A2, T0
9D037D80  0B40DF66   J 0x9D037D98
9D037D84  AF878184   SW A3, -32380(GP)
130:                          else
131:                             bank_select = (regs[1] & 0x10) << 1;
9D037D88  31AE0010   ANDI T6, T5, 16
9D037D8C  31CF00FF   ANDI T7, T6, 255
9D037D90  000FC040   SLL T8, T7, 1
9D037D94  AF988184   SW T8, -32380(GP)
132:                       }
133:                       else
134:                       {
135:                          bank_select = 0;
136:                       }
137:                    
138:                       if (0 == (regs[0] & 0x08))
9D037D98  938B8188   LBU T3, -32376(GP)
9D037D9C  316C0008   ANDI T4, T3, 8
9D037DA0  318D00FF   ANDI T5, T4, 255
9D037DA4  15A0000B   BNE T5, ZERO, 0x9D037DD4
9D037DA8  316E0004   ANDI T6, T3, 4
139:                          mmc_bankrom(32, 0x8000, ((regs[3] >> 1) + (bank_select >> 1)));
9D037DAC  9386818B   LBU A2, -32373(GP)
9D037DB0  00063842   SRL A3, A2, 1
9D037DB4  8F828184   LW V0, -32380(GP)
9D037DB8  00021843   SRA V1, V0, 1
9D037DBC  24040020   ADDIU A0, ZERO, 32
9D037DC0  34058000   ORI A1, ZERO, -32768
9D037DC4  0F40CA71   JAL mmc_bankrom
9D037DC8  00E33021   ADDU A2, A3, V1
9D037DCC  0B40DF88   J 0x9D037E20
9D037DD0  8FBF0014   LW RA, 20(SP)
140:                       else if (regs[0] & 0x04)
9D037DD4  31CF00FF   ANDI T7, T6, 255
9D037DD8  11E0000A   BEQ T7, ZERO, 0x9D037E04
9D037DDC  9398818B   LBU T8, -32373(GP)
141:                          mmc_bankrom(16, 0x8000, ((regs[3] & 0xF) + bank_select));
9D037DE0  9384818B   LBU A0, -32373(GP)
9D037DE4  3088000F   ANDI T0, A0, 15
9D037DE8  24040010   ADDIU A0, ZERO, 16
9D037DEC  34058000   ORI A1, ZERO, -32768
9D037DF0  8F838184   LW V1, -32380(GP)
9D037DF4  0F40CA71   JAL mmc_bankrom
9D037DF8  01033021   ADDU A2, T0, V1
9D037DFC  0B40DF88   J 0x9D037E20
9D037E00  8FBF0014   LW RA, 20(SP)
142:                       else
143:                          mmc_bankrom(16, 0xC000, ((regs[3] & 0xF) + bank_select));
9D037E04  3319000F   ANDI T9, T8, 15
9D037E08  24040010   ADDIU A0, ZERO, 16
9D037E0C  8F9F8184   LW RA, -32380(GP)
9D037E10  033F3021   ADDU A2, T9, RA
9D037E14  0F40CA71   JAL mmc_bankrom
9D037E18  3405C000   ORI A1, ZERO, -16384
144:                 
145:                    default:
146:                       break;
147:                    }
148:                 }
9D037C24  0B40DF88   J 0x9D037E20
9D037C28  8FBF0014   LW RA, 20(SP)
9D037CA0  0B40DF88   J 0x9D037E20
9D037CA4  8FBF0014   LW RA, 20(SP)
9D037CDC  0B40DF88   J 0x9D037E20
9D037CE0  8FBF0014   LW RA, 20(SP)
9D037D00  0B40DF88   J 0x9D037E20
9D037D04  8FBF0014   LW RA, 20(SP)
9D037E1C  8FBF0014   LW RA, 20(SP)
9D037E20  03E00008   JR RA
9D037E24  27BD0018   ADDIU SP, SP, 24
149:                 
150:                 static void map1_init(void)
151:                 {
9D037E28  27BDFFE8   ADDIU SP, SP, -24
9D037E2C  AFBF0014   SW RA, 20(SP)
152:                    bitcount = 0;
9D037E30  AF808190   SW ZERO, -32368(GP)
153:                    latch = 0;
9D037E34  A380818C   SB ZERO, -32372(GP)
154:                 
155:                    memset(regs, 0, sizeof(regs));
156:                 
157:                    if (mmc_getinfo()->rom_banks == 0x20)
9D037E38  0F40CA0A   JAL mmc_getinfo
9D037E3C  AF808188   SW ZERO, -32376(GP)
9D037E40  8C430010   LW V1, 16(V0)
9D037E44  24020020   ADDIU V0, ZERO, 32
9D037E48  14620006   BNE V1, V0, 0x9D037E64
9D037E4C  34048000   ORI A0, ZERO, -32768
158:                       mmc_bankrom(16, 0xC000, 0x0F);
9D037E50  24040010   ADDIU A0, ZERO, 16
9D037E54  3405C000   ORI A1, ZERO, -16384
9D037E58  0F40CA71   JAL mmc_bankrom
9D037E5C  2406000F   ADDIU A2, ZERO, 15
159:                 
160:                    map1_write(0x8000, 0x80);
9D037E60  34048000   ORI A0, ZERO, -32768
9D037E64  0F40DEDF   JAL .LFB5, map1_write, .LFE8
9D037E68  24050080   ADDIU A1, ZERO, 128
161:                 }
9D037E6C  8FBF0014   LW RA, 20(SP)
9D037E70  03E00008   JR RA
9D037E74  27BD0018   ADDIU SP, SP, 24
162:                 
163:                 static void map1_getstate(SnssMapperBlock *state)
164:                 {
165:                    state->extraData.mapper1.registers[0] = regs[0];
9D037B1C  93828188   LBU V0, -32376(GP)
9D037B20  A0820018   SB V0, 24(A0)
166:                    state->extraData.mapper1.registers[1] = regs[1];
9D037B24  93838189   LBU V1, -32375(GP)
9D037B28  A0830019   SB V1, 25(A0)
167:                    state->extraData.mapper1.registers[2] = regs[2];
9D037B2C  9385818A   LBU A1, -32374(GP)
9D037B30  A085001A   SB A1, 26(A0)
168:                    state->extraData.mapper1.registers[3] = regs[3];
9D037B34  9386818B   LBU A2, -32373(GP)
9D037B38  A086001B   SB A2, 27(A0)
169:                    state->extraData.mapper1.latch = latch;
9D037B3C  9387818C   LBU A3, -32372(GP)
9D037B40  A087001C   SB A3, 28(A0)
170:                    state->extraData.mapper1.numberOfBits = bitcount;
9D037B44  8F888190   LW T0, -32368(GP)
9D037B48  03E00008   JR RA
9D037B4C  A088001D   SB T0, 29(A0)
171:                 }
172:                 
173:                 
174:                 static void map1_setstate(SnssMapperBlock *state)
175:                 {
176:                    regs[1] = state->extraData.mapper1.registers[0];
177:                    regs[1] = state->extraData.mapper1.registers[1];
9D037B50  90820019   LBU V0, 25(A0)
9D037B54  A3828189   SB V0, -32375(GP)
178:                    regs[2] = state->extraData.mapper1.registers[2];
9D037B58  9083001A   LBU V1, 26(A0)
9D037B5C  A383818A   SB V1, -32374(GP)
179:                    regs[3] = state->extraData.mapper1.registers[3];
9D037B60  9085001B   LBU A1, 27(A0)
9D037B64  A385818B   SB A1, -32373(GP)
180:                    latch = state->extraData.mapper1.latch;
9D037B68  9086001C   LBU A2, 28(A0)
9D037B6C  A386818C   SB A2, -32372(GP)
181:                    bitcount = state->extraData.mapper1.numberOfBits;
9D037B70  9084001D   LBU A0, 29(A0)
9D037B74  03E00008   JR RA
9D037B78  AF848190   SW A0, -32368(GP)
182:                 }
183:                 
184:                 static map_memwrite map1_memwrite[] =
185:                 {
186:                    { 0x8000, 0xFFFF, map1_write },
187:                    {     -1,     -1, NULL }
188:                 };
189:                 
190:                 mapintf_t map1_intf =
191:                 {
192:                    1, /* mapper number */
193:                    "MMC1", /* mapper name */
194:                    map1_init, /* init routine */
195:                    NULL, /* vblank callback */
196:                    NULL, /* hblank callback */
197:                    map1_getstate, /* get state (snss) */
198:                    map1_setstate, /* set state (snss) */
199:                    NULL, /* memory read structure */
200:                    map1_memwrite, /* memory write structure */
201:                    NULL /* external sound device */
202:                 };
203:                 
204:                 /*
205:                 ** $Log: map001.c,v $
206:                 ** Revision 1.2  2001/04/27 14:37:11  neil
207:                 ** wheeee
208:                 **
209:                 ** Revision 1.1  2001/04/27 12:54:40  neil
210:                 ** blah
211:                 **
212:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
213:                 ** initial
214:                 **
215:                 ** Revision 1.1  2000/10/24 12:19:32  matt
216:                 ** changed directory structure
217:                 **
218:                 ** Revision 1.8  2000/10/22 19:46:50  matt
219:                 ** mirroring bugfix
220:                 **
221:                 ** Revision 1.7  2000/10/22 19:17:46  matt
222:                 ** mapper cleanups galore
223:                 **
224:                 ** Revision 1.6  2000/10/22 15:03:13  matt
225:                 ** simplified mirroring
226:                 **
227:                 ** Revision 1.5  2000/10/21 19:33:38  matt
228:                 ** many more cleanups
229:                 **
230:                 ** Revision 1.4  2000/07/15 23:52:19  matt
231:                 ** rounded out a bunch more mapper interfaces
232:                 **
233:                 ** Revision 1.3  2000/07/10 05:29:03  matt
234:                 ** cleaned up some mirroring issues
235:                 **
236:                 ** Revision 1.2  2000/07/06 02:48:43  matt
237:                 ** clearly labelled structure members
238:                 **
239:                 ** Revision 1.1  2000/07/04 23:11:45  matt
240:                 ** initial revision
241:                 **
242:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/log.c  -------------------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** log.c
21:                  **
22:                  ** Error logging functions
23:                  ** $Id: log.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <stdlib.h>
27:                  #include <stdio.h>
28:                  #include <stdarg.h>
29:                  #include <noftypes.h>
30:                  #include <log.h>
31:                  
32:                  
33:                  //static FILE *errorlog = NULL;
34:                  static int (*log_func)(const char *string) = NULL;
35:                  
36:                  /* first up: debug versions of calls */
37:                  #ifdef NOFRENDO_DEBUG
38:                  int log_init(void)
39:                  {
40:                  //   errorlog = fopen("errorlog.txt", "wt");
41:                  //   if (NULL == errorlog)
42:                  //      return (-1);
43:                  
44:                     return 0;
45:                  }
46:                  
47:                  void log_shutdown(void)
48:                  {
49:                     /* Snoop around for unallocated blocks */
50:                     mem_checkblocks();
51:                     mem_checkleaks();
52:                     mem_cleanup();
53:                  
54:                  //   if (NULL != errorlog)
55:                  //      fclose(errorlog);
56:                  }
57:                  
58:                  int log_print(const char *string)
59:                  {
60:                     /* if we have a custom logging function, use that */
61:                     if (NULL != log_func)
62:                        log_func(string);
63:                     
64:                     /* Log it to disk, as well */
65:                  //   fputs(string, errorlog);
66:                  //	printf("%s\n", string);
67:                  
68:                     return 0;
69:                  }
70:                  
71:                  int log_printf(const char *format, ... )
72:                  {
73:                     /* don't allocate on stack every call */
74:                     static char buffer[1024 + 1];
75:                     va_list arg;
76:                  
77:                     va_start(arg, format);
78:                  
79:                     if (NULL != log_func)
80:                     {
81:                        vsprintf(buffer, format, arg);
82:                        log_func(buffer);
83:                     }
84:                  
85:                  //   vfprintf(errorlog, format, arg);
86:                     va_end(arg);
87:                  
88:                     return 0; /* should be number of chars written */
89:                  }
90:                  
91:                  #else /* !NOFRENDO_DEBUG */
92:                  
93:                  int log_init(void)
94:                  {
95:                     return 0;
96:                  }
9D042044  03E00008   JR RA
9D042048  00001021   ADDU V0, ZERO, ZERO
97:                  
98:                  void log_shutdown(void)
99:                  {
9D04204C  03E00008   JR RA
9D042050  00000000   NOP
100:                 }
101:                 
102:                 int log_print(const char *string)
103:                 {
104:                    UNUSED(string);
105:                 
106:                    return 0;
107:                 }
9D042054  03E00008   JR RA
9D042058  00001021   ADDU V0, ZERO, ZERO
108:                 
109:                 int log_printf(const char *format, ... )
110:                 {
9D04205C  AFA50004   SW A1, 4(SP)
9D042060  AFA60008   SW A2, 8(SP)
9D042064  AFA7000C   SW A3, 12(SP)
111:                    UNUSED(format);
112:                 
113:                    return 0; /* should be number of chars written */
114:                 }
9D042068  03E00008   JR RA
9D04206C  00001021   ADDU V0, ZERO, ZERO
115:                 #endif /* !NOFRENDO_DEBUG */
116:                 
117:                 void log_chain_logfunc(int (*func)(const char *string))
118:                 {
119:                    log_func = func;
9D042070  03E00008   JR RA
9D042074  AF848080   SW A0, -32640(GP)
120:                 }
121:                 
122:                 void log_assert(int expr, int line, const char *file, char *msg)
123:                 {
9D042078  03E00008   JR RA
124:                    if (expr)
125:                       return;
126:                 
127:                    if (NULL != msg)
128:                       log_printf("ASSERT: line %d of %s, %s\n", line, file, msg);
129:                    else
130:                       log_printf("ASSERT: line %d of %s\n", line, file);
131:                 
132:                    //asm("break.n 1");
133:                 //   exit(-1);
134:                 }
135:                 
136:                 
137:                 /*
138:                 ** $Log: log.c,v $
139:                 ** Revision 1.2  2001/04/27 14:37:11  neil
140:                 ** wheeee
141:                 **
142:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
143:                 ** initial
144:                 **
145:                 ** Revision 1.14  2000/11/13 00:56:17  matt
146:                 ** doesn't look as nasty now
147:                 **
148:                 ** Revision 1.13  2000/11/06 02:15:07  matt
149:                 ** more robust logging routines
150:                 **
151:                 ** Revision 1.12  2000/10/15 13:28:12  matt
152:                 ** need stdlib.h for exit()
153:                 **
154:                 ** Revision 1.11  2000/10/10 13:13:13  matt
155:                 ** dumb bug in log_chain_logfunc
156:                 **
157:                 ** Revision 1.10  2000/10/10 13:03:54  matt
158:                 ** Mr. Clean makes a guest appearance
159:                 **
160:                 ** Revision 1.9  2000/08/28 01:47:10  matt
161:                 ** quelled fricking compiler complaints
162:                 **
163:                 ** Revision 1.8  2000/07/31 04:28:46  matt
164:                 ** one million cleanups
165:                 **
166:                 ** Revision 1.7  2000/07/17 01:52:27  matt
167:                 ** made sure last line of all source files is a newline
168:                 **
169:                 ** Revision 1.6  2000/07/06 17:20:52  matt
170:                 ** block manager space itself wasn't being freed - d'oh!
171:                 **
172:                 ** Revision 1.5  2000/06/26 04:55:33  matt
173:                 ** minor change
174:                 **
175:                 ** Revision 1.4  2000/06/09 15:12:25  matt
176:                 ** initial revision
177:                 **
178:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/libsnss/libsnss.c  -------------------------
1:                   /**************************************************************************/
2:                   /*
3:                         libsnss.c
4:                   
5:                         (C) 2000 The SNSS Group
6:                         See README.TXT file for license and terms of use.
7:                   
8:                         $Id: libsnss.c,v 1.2 2001/04/27 14:37:11 neil Exp $
9:                   */
10:                  /**************************************************************************/
11:                  
12:                  #include <stdio.h>
13:                  #include <stdlib.h>
14:                  #include <string.h>
15:                  #include <libsnss.h>
16:                  
17:                  /**************************************************************************/
18:                  /* This section deals with endian-specific code. */
19:                  /**************************************************************************/
20:                  
21:                  static unsigned int
22:                  swaap32 (unsigned int source)
23:                  {
24:                  #ifdef USE_LITTLE_ENDIAN
25:                     char buffer[4];
26:                     
27:                     buffer[0] = ((char *) &source)[3];
28:                     buffer[1] = ((char *) &source)[2];
29:                     buffer[2] = ((char *) &source)[1];
30:                     buffer[3] = ((char *) &source)[0];
31:                  
32:                     return *((unsigned int *) buffer);
33:                  #else /* !USE_LITTLE_ENDIAN */
34:                     return source;
35:                  #endif /* !USE_LITTLE_ENDIAN */
36:                  }
37:                  
38:                  static unsigned short
39:                  swaap16 (unsigned short source)
40:                  {
41:                  #ifdef USE_LITTLE_ENDIAN
42:                     char buffer[2];
43:                     
44:                     buffer[0] = ((char *) &source)[1];
45:                     buffer[1] = ((char *) &source)[0];
46:                  
47:                     return *((unsigned short *) buffer);
48:                  #else /* !USE_LITTLE_ENDIAN */
49:                     return source;
50:                  #endif /* !USE_LITTLE_ENDIAN */
51:                  }
52:                  
53:                  /**************************************************************************/
54:                  /* support functions */
55:                  /**************************************************************************/
56:                  
57:                  #define MIN(a,b) (((a) < (b)) ? (a) : (b))
58:                  
59:                  /**************************************************************************/
60:                  
61:                  static SNSS_RETURN_CODE
62:                  SNSS_ReadBlockHeader (SnssBlockHeader *header, SNSS_FILE *snssFile)
63:                  {
9D021C50  27BDFFD8   ADDIU SP, SP, -40
9D021C54  AFBF0024   SW RA, 36(SP)
9D021C58  AFB00020   SW S0, 32(SP)
9D021C5C  00808021   ADDU S0, A0, ZERO
64:                     char headerBytes[12];
65:                  
66:                     if (fread (headerBytes, 12, 1, snssFile->fp) != 1)
9D021C60  8CA70000   LW A3, 0(A1)
9D021C64  27A40010   ADDIU A0, SP, 16
9D021C68  2405000C   ADDIU A1, ZERO, 12
9D021C6C  0F40E52C   JAL .Letext0, .LFE1, fread
9D021C70  24060001   ADDIU A2, ZERO, 1
9D021C74  24050001   ADDIU A1, ZERO, 1
9D021C78  1445000F   BNE V0, A1, 0x9D021CB8
9D021C7C  24070004   ADDIU A3, ZERO, 4
67:                     {
68:                        return SNSS_READ_FAILED;
69:                     }
70:                  
71:                     strncpy (header->tag, &headerBytes[0], TAG_LENGTH);
9D021C80  02002021   ADDU A0, S0, ZERO
9D021C84  27A50010   ADDIU A1, SP, 16
9D021C88  0F40FA4F   JAL .LFE23, strncpy
9D021C8C  24060004   ADDIU A2, ZERO, 4
72:                     header->tag[4] = '\0';
9D021C90  A2000004   SB ZERO, 4(S0)
73:                     header->blockVersion = *((unsigned int *) &headerBytes[4]);
74:                     header->blockVersion = swap32 (header->blockVersion);
9D021C94  8FA20014   LW V0, 20(SP)
9D021C98  7C0218A0   WSBH V1, V0
9D021C9C  00231C02   ROTR V1, V1, 16
9D021CA0  AE030008   SW V1, 8(S0)
75:                     header->blockLength = *((unsigned int *) &headerBytes[8]);
76:                     header->blockLength = swap32 (header->blockLength);
9D021CA4  8FA40018   LW A0, 24(SP)
9D021CA8  7C0430A0   WSBH A2, A0
9D021CAC  00263402   ROTR A2, A2, 16
9D021CB0  AE06000C   SW A2, 12(S0)
77:                  
78:                     return SNSS_OK;
9D021CB4  00003821   ADDU A3, ZERO, ZERO
79:                  }
9D021CB8  00E01021   ADDU V0, A3, ZERO
9D021CBC  8FBF0024   LW RA, 36(SP)
9D021CC0  8FB00020   LW S0, 32(SP)
9D021CC4  03E00008   JR RA
9D021CC8  27BD0028   ADDIU SP, SP, 40
80:                  
81:                  /**************************************************************************/
82:                  
83:                  static SNSS_RETURN_CODE
84:                  SNSS_WriteBlockHeader (SnssBlockHeader *header, SNSS_FILE *snssFile)
85:                  {
9D0221D8  27BDFFD0   ADDIU SP, SP, -48
9D0221DC  AFBF002C   SW RA, 44(SP)
9D0221E0  AFB10028   SW S1, 40(SP)
9D0221E4  AFB00024   SW S0, 36(SP)
9D0221E8  00808021   ADDU S0, A0, ZERO
9D0221EC  00A08821   ADDU S1, A1, ZERO
86:                     char headerBytes[12];
87:                     unsigned int tempInt;
88:                  
89:                     strncpy (&headerBytes[0], header->tag, TAG_LENGTH);
9D0221F0  27A40010   ADDIU A0, SP, 16
9D0221F4  02002821   ADDU A1, S0, ZERO
9D0221F8  0F40FA4F   JAL .LFE23, strncpy
9D0221FC  24060004   ADDIU A2, ZERO, 4
90:                  
91:                     tempInt = swap32 (header->blockVersion);
9D022200  8E020008   LW V0, 8(S0)
9D022204  7C0220A0   WSBH A0, V0
9D022208  00242402   ROTR A0, A0, 16
92:                     headerBytes[4] = ((char *) &tempInt)[0];
9D02220C  A3A40014   SB A0, 20(SP)
93:                     headerBytes[5] = ((char *) &tempInt)[1];
9D022210  00041A02   SRL V1, A0, 8
9D022214  A3A30015   SB V1, 21(SP)
94:                     headerBytes[6] = ((char *) &tempInt)[2];
9D022218  00042C02   SRL A1, A0, 16
9D02221C  A3A50016   SB A1, 22(SP)
95:                     headerBytes[7] = ((char *) &tempInt)[3];
9D022220  00043602   SRL A2, A0, 24
9D022224  A3A60017   SB A2, 23(SP)
96:                  
97:                     tempInt = swap32 (header->blockLength);
9D022228  8E07000C   LW A3, 12(S0)
9D02222C  7C0740A0   WSBH T0, A3
9D022230  00284402   ROTR T0, T0, 16
9D022234  AFA8001C   SW T0, 28(SP)
98:                     headerBytes[8] = ((char *) &tempInt)[0];
9D022238  A3A80018   SB T0, 24(SP)
99:                     headerBytes[9] = ((char *) &tempInt)[1];
9D02223C  00084A02   SRL T1, T0, 8
9D022240  A3A90019   SB T1, 25(SP)
100:                    headerBytes[10] = ((char *) &tempInt)[2];
9D022244  00085402   SRL T2, T0, 16
9D022248  A3AA001A   SB T2, 26(SP)
101:                    headerBytes[11] = ((char *) &tempInt)[3];
9D02224C  00085E02   SRL T3, T0, 24
9D022250  A3AB001B   SB T3, 27(SP)
102:                 
103:                    if (fwrite (headerBytes, 12, 1, snssFile->fp) != 1)
9D022254  27A40010   ADDIU A0, SP, 16
9D022258  2405000C   ADDIU A1, ZERO, 12
9D02225C  24060001   ADDIU A2, ZERO, 1
9D022260  0F4108EC   JAL fwrite
9D022264  8E270000   LW A3, 0(S1)
104:                    {
105:                       return SNSS_WRITE_FAILED;
9D022268  384C0001   XORI T4, V0, 1
106:                    }
107:                 
108:                    return SNSS_OK;
109:                 }
9D02226C  240D0005   ADDIU T5, ZERO, 5
9D022270  000C680A   MOVZ T5, ZERO, T4
9D022274  01A01021   ADDU V0, T5, ZERO
9D022278  8FBF002C   LW RA, 44(SP)
9D02227C  8FB10028   LW S1, 40(SP)
9D022280  8FB00024   LW S0, 36(SP)
9D022284  03E00008   JR RA
9D022288  27BD0030   ADDIU SP, SP, 48
110:                 
111:                 /**************************************************************************/
112:                 
113:                 const char *
114:                 SNSS_GetErrorString (SNSS_RETURN_CODE code)
115:                 {
116:                    switch (code)
9D0227B4  2C820008   SLTIU V0, A0, 8
9D0227B8  10400024   BEQ V0, ZERO, 0x9D02284C
9D0227BC  00042080   SLL A0, A0, 2
9D0227C0  3C039D02   LUI V1, -25342
9D0227C4  246527D8   ADDIU A1, V1, 10200
9D0227C8  00A43021   ADDU A2, A1, A0
9D0227CC  8CC70000   LW A3, 0(A2)
9D0227D0  00E00008   JR A3
9D0227D4  00000000   NOP
117:                    {
118:                    case SNSS_OK:
119:                       return "no error";
9D0227F8  3C0E9D04   LUI T6, -25340
9D0227FC  03E00008   JR RA
9D022800  25C2E204   ADDIU V0, T6, -7676
120:                 
121:                    case SNSS_BAD_FILE_TAG:
122:                       return "not an SNSS file";
9D022858  3C0D9D04   LUI T5, -25340
123:                 
124:                    case SNSS_OPEN_FAILED:
125:                       return "could not open SNSS file";
9D022804  3C0C9D04   LUI T4, -25340
9D022808  03E00008   JR RA
9D02280C  2582E224   ADDIU V0, T4, -7644
126:                 
127:                    case SNSS_CLOSE_FAILED:
128:                       return "could not close SNSS file";
9D022810  3C0B9D04   LUI T3, -25340
9D022814  03E00008   JR RA
9D022818  2562E240   ADDIU V0, T3, -7616
129:                 
130:                    case SNSS_READ_FAILED:
131:                       return "could not read from SNSS file";
9D02281C  3C0A9D04   LUI T2, -25340
9D022820  03E00008   JR RA
9D022824  2542E25C   ADDIU V0, T2, -7588
132:                 
133:                    case SNSS_WRITE_FAILED:
134:                       return "could not write to SNSS file";
9D022828  3C099D04   LUI T1, -25340
9D02282C  03E00008   JR RA
9D022830  2522E27C   ADDIU V0, T1, -7556
135:                 
136:                    case SNSS_OUT_OF_MEMORY:
137:                       return "out of memory";
9D022834  3C089D04   LUI T0, -25340
9D022838  03E00008   JR RA
9D02283C  2502E29C   ADDIU V0, T0, -7524
138:                 
139:                    case SNSS_UNSUPPORTED_BLOCK:
140:                       return "unsupported block type";
9D022840  3C0F9D04   LUI T7, -25340
9D022844  03E00008   JR RA
9D022848  25E2E2AC   ADDIU V0, T7, -7508
141:                 
142:                    default:
143:                       return "unknown error";
9D02284C  3C189D04   LUI T8, -25340
9D022850  03E00008   JR RA
9D022854  2702E2C4   ADDIU V0, T8, -7484
144:                    }
145:                 }
9D02285C  03E00008   JR RA
9D022860  25A2E210   ADDIU V0, T5, -7664
146:                 
147:                 /**************************************************************************/
148:                 /* functions for reading and writing SNSS file headers */
149:                 /**************************************************************************/
150:                 
151:                 static SNSS_RETURN_CODE 
152:                 SNSS_ReadFileHeader (SNSS_FILE *snssFile)
153:                 {
154:                    if (fread (snssFile->headerBlock.tag, 4, 1, snssFile->fp) != 1)
9D022928  02002021   ADDU A0, S0, ZERO
155:                    {
156:                       return SNSS_READ_FAILED;
157:                    }
158:                  
159:                    if (0 != strncmp(snssFile->headerBlock.tag, "SNSS", 4))
9D022944  02002021   ADDU A0, S0, ZERO
160:                    {
161:                       return SNSS_BAD_FILE_TAG;
162:                    }
163:                    
164:                    snssFile->headerBlock.tag[4] = '\0';
9D022960  A240000C   SB ZERO, 12(S2)
165:                 
166:                    if (fread (&snssFile->headerBlock.numberOfBlocks, sizeof (unsigned int), 1, snssFile->fp) != 1)
9D022964  26440010   ADDIU A0, S2, 16
167:                    {
168:                       return SNSS_READ_FAILED;
169:                    }
170:                 
171:                    snssFile->headerBlock.numberOfBlocks = swap32 (snssFile->headerBlock.numberOfBlocks);
9D022984  8E4B0010   LW T3, 16(S2)
9D022988  7C0B60A0   WSBH T4, T3
9D02298C  002C6402   ROTR T4, T4, 16
9D022990  AE4C0010   SW T4, 16(S2)
172:                 
173:                    return SNSS_OK;
9D022994  0B408A6A   J 0x9D0229A8
9D022998  00003821   ADDU A3, ZERO, ZERO
174:                 }
175:                 
176:                 /**************************************************************************/
177:                 
178:                 static SNSS_RETURN_CODE 
179:                 SNSS_WriteFileHeader (SNSS_FILE *snssFile)
180:                 {
9D021BDC  27BDFFD8   ADDIU SP, SP, -40
9D021BE0  AFBF0024   SW RA, 36(SP)
9D021BE4  00801821   ADDU V1, A0, ZERO
181:                    unsigned int tempInt;
182:                    char writeBuffer[8];
183:                 
184:                    /* always place the SNSS tag in this field */
185:                    strncpy (&writeBuffer[0], "SNSS", 4);
9D021BE8  3C025353   LUI V0, 21331
9D021BEC  24444E53   ADDIU A0, V0, 20051
9D021BF0  AFA40014   SW A0, 20(SP)
186:                    tempInt = swap32 (snssFile->headerBlock.numberOfBlocks);
9D021BF4  8C650010   LW A1, 16(V1)
9D021BF8  7C0530A0   WSBH A2, A1
9D021BFC  00263402   ROTR A2, A2, 16
9D021C00  AFA60010   SW A2, 16(SP)
187:                    writeBuffer[4] = ((char *) &tempInt)[0];
9D021C04  A3A60018   SB A2, 24(SP)
188:                    writeBuffer[5] = ((char *) &tempInt)[1];
9D021C08  00063A02   SRL A3, A2, 8
9D021C0C  A3A70019   SB A3, 25(SP)
189:                    writeBuffer[6] = ((char *) &tempInt)[2];
9D021C10  00064402   SRL T0, A2, 16
9D021C14  A3A8001A   SB T0, 26(SP)
190:                    writeBuffer[7] = ((char *) &tempInt)[3];
9D021C18  00064E02   SRL T1, A2, 24
9D021C1C  A3A9001B   SB T1, 27(SP)
191:                 
192:                    if (fwrite (writeBuffer, 8, 1, snssFile->fp) != 1)
9D021C20  27A40014   ADDIU A0, SP, 20
9D021C24  24050008   ADDIU A1, ZERO, 8
9D021C28  24060001   ADDIU A2, ZERO, 1
9D021C2C  0F4108EC   JAL fwrite
9D021C30  8C670000   LW A3, 0(V1)
193:                    {
194:                       return SNSS_WRITE_FAILED;
9D021C34  384A0001   XORI T2, V0, 1
195:                    }
196:                 
197:                    return SNSS_OK;
198:                 }
9D021C38  240B0005   ADDIU T3, ZERO, 5
9D021C3C  000A580A   MOVZ T3, ZERO, T2
9D021C40  01601021   ADDU V0, T3, ZERO
9D021C44  8FBF0024   LW RA, 36(SP)
9D021C48  03E00008   JR RA
9D021C4C  27BD0028   ADDIU SP, SP, 40
199:                 
200:                 /**************************************************************************/
201:                 /* general file manipulation functions */
202:                 /**************************************************************************/
203:                 SNSS_RETURN_CODE
204:                 SNSS_OpenFile (SNSS_FILE **snssFile, const char *filename, SNSS_OPEN_MODE mode)
205:                 {
9D022864  27BDFFE0   ADDIU SP, SP, -32
9D022868  AFBF001C   SW RA, 28(SP)
9D02286C  AFB20018   SW S2, 24(SP)
9D022870  AFB10014   SW S1, 20(SP)
9D022874  AFB00010   SW S0, 16(SP)
9D022878  00808021   ADDU S0, A0, ZERO
9D02287C  00A09021   ADDU S2, A1, ZERO
9D022880  00C08821   ADDU S1, A2, ZERO
206:                    *snssFile = malloc(sizeof(SNSS_FILE));
9D022884  0F40C453   JAL .Letext0, .LFE16, malloc
9D022888  240479FC   ADDIU A0, ZERO, 31228
9D02288C  AE020000   SW V0, 0(S0)
207:                    if (NULL == *snssFile)
9D022890  10400045   BEQ V0, ZERO, 0x9D0229A8
9D022894  24070006   ADDIU A3, ZERO, 6
208:                    {
209:                       return SNSS_OUT_OF_MEMORY;
210:                    }
211:                  
212:                    /* zero the memory */
213:                    memset (*snssFile, 0, sizeof(SNSS_FILE));
9D022898  00402021   ADDU A0, V0, ZERO
9D02289C  00002821   ADDU A1, ZERO, ZERO
9D0228A0  0F4100B4   JAL .Letext0, .LFE0, memset
9D0228A4  240679FC   ADDIU A2, ZERO, 31228
214:                 
215:                    (*snssFile)->mode = mode;
9D0228A8  8E020000   LW V0, 0(S0)
216:                 
217:                    if (SNSS_OPEN_READ == mode)
9D0228AC  1620000D   BNE S1, ZERO, 0x9D0228E4
9D0228B0  AC510004   SW S1, 4(V0)
218:                    {
219:                       (*snssFile)->fp = fopen (filename, "rb");
9D0228B4  8E110000   LW S1, 0(S0)
9D0228B8  02402021   ADDU A0, S2, ZERO
9D0228BC  3C069D04   LUI A2, -25340
9D0228C0  0F40F363   JAL .Letext0, .LFE12, fopen
9D0228C4  24C5E2D4   ADDIU A1, A2, -7468
9D0228C8  AE220000   SW V0, 0(S1)
220:                    }
221:                    else
222:                    {
223:                       (*snssFile)->fp = fopen (filename, "wb");
9D0228E4  8E110000   LW S1, 0(S0)
9D0228E8  02402021   ADDU A0, S2, ZERO
9D0228EC  3C059D04   LUI A1, -25340
9D0228F0  0F40F363   JAL .Letext0, .LFE12, fopen
9D0228F4  24A5E2D8   ADDIU A1, A1, -7464
9D0228F8  AE220000   SW V0, 0(S1)
224:                       (*snssFile)->headerBlock.numberOfBlocks = 0;
9D0228FC  8E030000   LW V1, 0(S0)
9D022900  AC600010   SW ZERO, 16(V1)
225:                    }
226:                 
227:                    if (NULL == (*snssFile)->fp)
9D0228CC  8E120000   LW S2, 0(S0)
9D0228D0  8E470000   LW A3, 0(S2)
9D0228D4  54E00014   BNEL A3, ZERO, .LBB25
9D0228D8  26500008   ADDIU S0, S2, 8
9D0228DC  0B408A45   J 0x9D022914
9D0228E0  00000000   NOP
9D022904  8E120000   LW S2, 0(S0)
9D022908  8E440000   LW A0, 0(S2)
9D02290C  14800023   BNE A0, ZERO, 0x9D02299C
9D022910  00000000   NOP
228:                    {
229:                       free(*snssFile);
9D022914  0F40E912   JAL free
9D022918  02402021   ADDU A0, S2, ZERO
230:                       *snssFile = NULL;
9D02291C  AE000000   SW ZERO, 0(S0)
231:                       return SNSS_OPEN_FAILED;
9D022920  0B408A6A   J 0x9D0229A8
9D022924  24070002   ADDIU A3, ZERO, 2
232:                    }
233:                 
234:                    if (SNSS_OPEN_READ == mode)
235:                    {
236:                       return SNSS_ReadFileHeader(*snssFile);
237:                    }
238:                    else
239:                    {
240:                       return SNSS_WriteFileHeader(*snssFile);
9D02299C  0F4086F7   JAL .LFE41, .Letext0, .LFB14, SNSS_WriteFileHeader, .Ltext0
9D0229A0  02402021   ADDU A0, S2, ZERO
9D0229A4  00403821   ADDU A3, V0, ZERO
241:                    }
242:                 }
9D0229A8  00E01021   ADDU V0, A3, ZERO
9D0229AC  8FBF001C   LW RA, 28(SP)
9D0229B0  8FB20018   LW S2, 24(SP)
9D0229B4  8FB10014   LW S1, 20(SP)
9D0229B8  8FB00010   LW S0, 16(SP)
9D0229BC  03E00008   JR RA
9D0229C0  27BD0020   ADDIU SP, SP, 32
243:                 
244:                 /**************************************************************************/
245:                 
246:                 SNSS_RETURN_CODE
247:                 SNSS_CloseFile (SNSS_FILE **snssFile)
248:                 {
9D0229C4  27BDFFE0   ADDIU SP, SP, -32
9D0229C8  AFBF001C   SW RA, 28(SP)
9D0229CC  AFB10018   SW S1, 24(SP)
9D0229D0  AFB00014   SW S0, 20(SP)
249:                    int prevLoc;
250:                    SNSS_RETURN_CODE code;
251:                 
252:                    /* file was never open, so this should indicate success- kinda. */
253:                    if (NULL == *snssFile)
9D0229D4  8C820000   LW V0, 0(A0)
9D0229D8  10400020   BEQ V0, ZERO, 0x9D022A5C
9D0229DC  00808021   ADDU S0, A0, ZERO
254:                    {
255:                       return SNSS_OK;
9D022A5C  00004021   ADDU T0, ZERO, ZERO
256:                    }
257:                 
258:                    if (SNSS_OPEN_WRITE == (*snssFile)->mode)
9D0229E0  8C440004   LW A0, 4(V0)
9D0229E4  24030001   ADDIU V1, ZERO, 1
9D0229E8  54830013   BNEL A0, V1, 0x9D022A38
9D0229EC  8E070000   LW A3, 0(S0)
259:                    {
260:                       prevLoc = ftell((*snssFile)->fp);
9D0229F0  0F410640   JAL ftell
9D0229F4  8C440000   LW A0, 0(V0)
9D0229F8  00408821   ADDU S1, V0, ZERO
261:                       fseek((*snssFile)->fp, 0, SEEK_SET);
9D0229FC  8E050000   LW A1, 0(S0)
9D022A00  8CA40000   LW A0, 0(A1)
9D022A04  00002821   ADDU A1, ZERO, ZERO
9D022A08  0F4102D7   JAL fseek
9D022A0C  00003021   ADDU A2, ZERO, ZERO
262:                 
263:                       /* write the header again to update block count */
264:                       if (SNSS_OK != (code = SNSS_WriteFileHeader(*snssFile)))
9D022A10  0F4086F7   JAL .LFE41, .Letext0, .LFB14, SNSS_WriteFileHeader, .Ltext0
9D022A14  8E040000   LW A0, 0(S0)
9D022A18  14400011   BNE V0, ZERO, 0x9D022A60
9D022A1C  24080003   ADDIU T0, ZERO, 3
265:                       {
266:                          return SNSS_CLOSE_FAILED;
267:                       }
268:                 
269:                       fseek((*snssFile)->fp, prevLoc, SEEK_SET);
9D022A20  8E060000   LW A2, 0(S0)
9D022A24  8CC40000   LW A0, 0(A2)
9D022A28  02202821   ADDU A1, S1, ZERO
9D022A2C  0F4102D7   JAL fseek
9D022A30  00003021   ADDU A2, ZERO, ZERO
270:                    }
271:                 
272:                    if (fclose ((*snssFile)->fp) != 0)
9D022A34  8E070000   LW A3, 0(S0)
9D022A38  0F4102B5   JAL .Letext0, .LFE1, fclose
9D022A3C  8CE40000   LW A0, 0(A3)
9D022A40  14400007   BNE V0, ZERO, 0x9D022A60
9D022A44  24080003   ADDIU T0, ZERO, 3
273:                    {
274:                       return SNSS_CLOSE_FAILED;
275:                    }
276:                 
277:                    free(*snssFile);
9D022A48  0F40E912   JAL free
9D022A4C  8E040000   LW A0, 0(S0)
278:                    *snssFile = NULL;
9D022A50  AE000000   SW ZERO, 0(S0)
279:                 
280:                    return SNSS_OK;
9D022A54  0B408A98   J 0x9D022A60
9D022A58  00004021   ADDU T0, ZERO, ZERO
281:                 }
9D022A60  01001021   ADDU V0, T0, ZERO
9D022A64  8FBF001C   LW RA, 28(SP)
9D022A68  8FB10018   LW S1, 24(SP)
9D022A6C  8FB00014   LW S0, 20(SP)
9D022A70  03E00008   JR RA
9D022A74  27BD0020   ADDIU SP, SP, 32
282:                 
283:                 /**************************************************************************/
284:                 
285:                 SNSS_RETURN_CODE 
286:                 SNSS_GetNextBlockType (SNSS_BLOCK_TYPE *blockType, SNSS_FILE *snssFile)
287:                 {
9D022A78  27BDFFD8   ADDIU SP, SP, -40
9D022A7C  AFBF0024   SW RA, 36(SP)
9D022A80  AFB10020   SW S1, 32(SP)
9D022A84  AFB0001C   SW S0, 28(SP)
9D022A88  00808821   ADDU S1, A0, ZERO
9D022A8C  00A08021   ADDU S0, A1, ZERO
288:                    char tagBuffer[TAG_LENGTH + 1];
289:                 
290:                    if (fread (tagBuffer, TAG_LENGTH, 1, snssFile->fp) != 1)
9D022A90  27A40010   ADDIU A0, SP, 16
9D022A94  24050004   ADDIU A1, ZERO, 4
9D022A98  24060001   ADDIU A2, ZERO, 1
9D022A9C  0F40E52C   JAL .Letext0, .LFE1, fread
9D022AA0  8E070000   LW A3, 0(S0)
9D022AA4  24050001   ADDIU A1, ZERO, 1
9D022AA8  14450040   BNE V0, A1, 0x9D022BAC
9D022AAC  240A0004   ADDIU T2, ZERO, 4
291:                    {
292:                       return SNSS_READ_FAILED;
293:                    }
294:                    tagBuffer[TAG_LENGTH] = '\0';
9D022AB0  A3A00014   SB ZERO, 20(SP)
295:                 
296:                    /* reset the file pointer to the start of the block */
297:                    if (fseek (snssFile->fp, -TAG_LENGTH, SEEK_CUR) != 0)
9D022AB4  8E040000   LW A0, 0(S0)
9D022AB8  2405FFFC   ADDIU A1, ZERO, -4
9D022ABC  0F4102D7   JAL fseek
9D022AC0  24060001   ADDIU A2, ZERO, 1
9D022AC4  14400039   BNE V0, ZERO, 0x9D022BAC
9D022AC8  240A0004   ADDIU T2, ZERO, 4
298:                    {
299:                       return SNSS_READ_FAILED;
300:                    }
301:                 
302:                    /* figure out which type of block it is */
303:                    if (strcmp (tagBuffer, "BASR") == 0)
9D022ACC  27A40010   ADDIU A0, SP, 16
9D022AD0  3C029D04   LUI V0, -25340
9D022AD4  0F40F722   JAL .Letext0, .LFE2, strcmp
9D022AD8  2445E2E4   ADDIU A1, V0, -7452
9D022ADC  14400004   BNE V0, ZERO, 0x9D022AF0
9D022AE0  27A40010   ADDIU A0, SP, 16
304:                    {
305:                       *blockType = SNSS_BASR;
9D022AE4  AE200000   SW ZERO, 0(S1)
9D022AE8  0B408AEB   J 0x9D022BAC
9D022AEC  00005021   ADDU T2, ZERO, ZERO
306:                    }
307:                    else if (strcmp (tagBuffer, "VRAM") == 0)
9D022AF0  3C039D04   LUI V1, -25340
9D022AF4  0F40F722   JAL .Letext0, .LFE2, strcmp
9D022AF8  2465E2EC   ADDIU A1, V1, -7444
9D022AFC  14400005   BNE V0, ZERO, 0x9D022B14
9D022B00  27A40010   ADDIU A0, SP, 16
308:                    {
309:                       *blockType = SNSS_VRAM;
9D022B04  240F0001   ADDIU T7, ZERO, 1
9D022B08  AE2F0000   SW T7, 0(S1)
9D022B0C  0B408AEB   J 0x9D022BAC
9D022B10  00005021   ADDU T2, ZERO, ZERO
310:                    }
311:                    else if (strcmp (tagBuffer, "SRAM") == 0)
9D022B14  3C069D04   LUI A2, -25340
9D022B18  0F40F722   JAL .Letext0, .LFE2, strcmp
9D022B1C  24C5E2F4   ADDIU A1, A2, -7436
9D022B20  14400005   BNE V0, ZERO, 0x9D022B38
9D022B24  27A40010   ADDIU A0, SP, 16
312:                    {
313:                       *blockType = SNSS_SRAM;
9D022B28  240E0002   ADDIU T6, ZERO, 2
9D022B2C  AE2E0000   SW T6, 0(S1)
9D022B30  0B408AEB   J 0x9D022BAC
9D022B34  00005021   ADDU T2, ZERO, ZERO
314:                    }
315:                    else if (strcmp (tagBuffer, "MPRD") == 0)
9D022B38  3C079D04   LUI A3, -25340
9D022B3C  0F40F722   JAL .Letext0, .LFE2, strcmp
9D022B40  24E5E2FC   ADDIU A1, A3, -7428
9D022B44  14400005   BNE V0, ZERO, 0x9D022B5C
9D022B48  27A40010   ADDIU A0, SP, 16
316:                    {
317:                       *blockType = SNSS_MPRD;
9D022B4C  240D0003   ADDIU T5, ZERO, 3
9D022B50  AE2D0000   SW T5, 0(S1)
9D022B54  0B408AEB   J 0x9D022BAC
9D022B58  00005021   ADDU T2, ZERO, ZERO
318:                    }
319:                    else if (strcmp (tagBuffer, "CNTR") == 0)
9D022B5C  3C089D04   LUI T0, -25340
9D022B60  0F40F722   JAL .Letext0, .LFE2, strcmp
9D022B64  2505E304   ADDIU A1, T0, -7420
9D022B68  14400005   BNE V0, ZERO, 0x9D022B80
9D022B6C  27A40010   ADDIU A0, SP, 16
320:                    {
321:                       *blockType = SNSS_CNTR;
9D022B70  240C0004   ADDIU T4, ZERO, 4
9D022B74  AE2C0000   SW T4, 0(S1)
9D022B78  0B408AEB   J 0x9D022BAC
9D022B7C  00005021   ADDU T2, ZERO, ZERO
322:                    }
323:                    else if (strcmp (tagBuffer, "SOUN") == 0)
9D022B80  3C099D04   LUI T1, -25340
9D022B84  0F40F722   JAL .Letext0, .LFE2, strcmp
9D022B88  2525E30C   ADDIU A1, T1, -7412
9D022B8C  14400005   BNE V0, ZERO, 0x9D022BA4
9D022B90  24040006   ADDIU A0, ZERO, 6
324:                    {
325:                       *blockType = SNSS_SOUN;
9D022B94  240B0005   ADDIU T3, ZERO, 5
9D022B98  AE2B0000   SW T3, 0(S1)
9D022B9C  0B408AEB   J 0x9D022BAC
9D022BA0  00005021   ADDU T2, ZERO, ZERO
326:                    }
327:                    else
328:                    {
329:                       *blockType = SNSS_UNKNOWN_BLOCK;
9D022BA4  AE240000   SW A0, 0(S1)
330:                    }
331:                 
332:                    return SNSS_OK;
9D022BA8  00005021   ADDU T2, ZERO, ZERO
333:                 }
9D022BAC  01401021   ADDU V0, T2, ZERO
9D022BB0  8FBF0024   LW RA, 36(SP)
9D022BB4  8FB10020   LW S1, 32(SP)
9D022BB8  8FB0001C   LW S0, 28(SP)
9D022BBC  03E00008   JR RA
9D022BC0  27BD0028   ADDIU SP, SP, 40
334:                 
335:                 /**************************************************************************/
336:                 
337:                 SNSS_RETURN_CODE 
338:                 SNSS_SkipNextBlock (SNSS_FILE *snssFile)
339:                 {
9D022BC4  27BDFFE0   ADDIU SP, SP, -32
9D022BC8  AFBF001C   SW RA, 28(SP)
9D022BCC  AFB00018   SW S0, 24(SP)
9D022BD0  00808021   ADDU S0, A0, ZERO
340:                    unsigned int blockLength;
341:                 
342:                    /* skip the block's tag and version */
343:                    if (fseek (snssFile->fp, TAG_LENGTH + sizeof (unsigned int), SEEK_CUR) != 0)
9D022BD4  8C840000   LW A0, 0(A0)
9D022BD8  24050008   ADDIU A1, ZERO, 8
9D022BDC  0F4102D7   JAL fseek
9D022BE0  24060001   ADDIU A2, ZERO, 1
9D022BE4  14400012   BNE V0, ZERO, 0x9D022C30
9D022BE8  24030004   ADDIU V1, ZERO, 4
344:                    {
345:                       return SNSS_READ_FAILED;
346:                    }
347:                 
348:                    /* get the block data length */
349:                    if (fread (&blockLength, sizeof (unsigned int), 1, snssFile->fp) != 1)
9D022BEC  27A40010   ADDIU A0, SP, 16
9D022BF0  24050004   ADDIU A1, ZERO, 4
9D022BF4  24060001   ADDIU A2, ZERO, 1
9D022BF8  0F40E52C   JAL .Letext0, .LFE1, fread
9D022BFC  8E070000   LW A3, 0(S0)
9D022C00  24040001   ADDIU A0, ZERO, 1
9D022C04  1444000A   BNE V0, A0, 0x9D022C30
9D022C08  24030004   ADDIU V1, ZERO, 4
350:                    {
351:                       return SNSS_READ_FAILED;
352:                    }
353:                    blockLength = swap32 (blockLength);
9D022C0C  8FA50010   LW A1, 16(SP)
9D022C10  7C0528A0   WSBH A1, A1
9D022C14  00252C02   ROTR A1, A1, 16
9D022C18  AFA50010   SW A1, 16(SP)
354:                 
355:                    /* skip over the block data */
356:                    if (fseek (snssFile->fp, blockLength, SEEK_CUR) != 0)
9D022C1C  8E040000   LW A0, 0(S0)
9D022C20  0F4102D7   JAL fseek
9D022C24  24060001   ADDIU A2, ZERO, 1
357:                    {
358:                       return SNSS_READ_FAILED;
9D022C28  24030004   ADDIU V1, ZERO, 4
9D022C2C  0002180A   MOVZ V1, ZERO, V0
359:                    }
360:                 
361:                    return SNSS_OK;
362:                 }
9D022C30  00601021   ADDU V0, V1, ZERO
9D022C34  8FBF001C   LW RA, 28(SP)
9D022C38  8FB00018   LW S0, 24(SP)
9D022C3C  03E00008   JR RA
9D022C40  27BD0020   ADDIU SP, SP, 32
363:                 
364:                 /**************************************************************************/
365:                 /* functions for reading and writing base register blocks */
366:                 /**************************************************************************/
367:                 
368:                 static SNSS_RETURN_CODE 
369:                 SNSS_ReadBaseBlock (SNSS_FILE *snssFile)
370:                 {
9D021CCC  27BDE6A0   ADDIU SP, SP, -6496
9D021CD0  AFBF195C   SW RA, 6492(SP)
9D021CD4  AFB01958   SW S0, 6488(SP)
9D021CD8  00808021   ADDU S0, A0, ZERO
371:                    char blockBytes[BASE_BLOCK_LENGTH];
372:                    SnssBlockHeader header;
373:                 
374:                    if (SNSS_ReadBlockHeader (&header, snssFile) != SNSS_OK)
9D021CDC  27A41944   ADDIU A0, SP, 6468
9D021CE0  0F408714   JAL .LFB10, SNSS_ReadBlockHeader, .LFE14
9D021CE4  02002821   ADDU A1, S0, ZERO
9D021CE8  14400136   BNE V0, ZERO, 0x9D0221C4
9D021CEC  240E0004   ADDIU T6, ZERO, 4
375:                    {
376:                       return SNSS_READ_FAILED;
377:                    }
378:                 
379:                    if (fread (blockBytes, MIN (header.blockLength, BASE_BLOCK_LENGTH), 1, snssFile->fp) != 1)
9D021CF0  8FA21950   LW V0, 6480(SP)
9D021CF4  2C451932   SLTIU A1, V0, 6450
9D021CF8  27A40010   ADDIU A0, SP, 16
9D021CFC  24031931   ADDIU V1, ZERO, 6449
9D021D00  0045180B   MOVN V1, V0, A1
9D021D04  00602821   ADDU A1, V1, ZERO
9D021D08  24060001   ADDIU A2, ZERO, 1
9D021D0C  0F40E52C   JAL .Letext0, .LFE1, fread
9D021D10  8E070000   LW A3, 0(S0)
9D021D14  24040001   ADDIU A0, ZERO, 1
9D021D18  1444012A   BNE V0, A0, 0x9D0221C4
9D021D1C  240E0004   ADDIU T6, ZERO, 4
380:                    {
381:                       return SNSS_READ_FAILED;
382:                    }
383:                 
384:                    snssFile->baseBlock.regA = blockBytes[0x0];
9D021D20  93A60010   LBU A2, 16(SP)
9D021D24  A2060014   SB A2, 20(S0)
385:                    snssFile->baseBlock.regX = blockBytes[0x1];
9D021D28  93A70011   LBU A3, 17(SP)
9D021D2C  A2070015   SB A3, 21(S0)
386:                    snssFile->baseBlock.regY = blockBytes[0x2];
9D021D30  93A80012   LBU T0, 18(SP)
9D021D34  A2080016   SB T0, 22(S0)
387:                    snssFile->baseBlock.regFlags = blockBytes[0x3];
9D021D38  93A90013   LBU T1, 19(SP)
9D021D3C  A2090017   SB T1, 23(S0)
388:                    snssFile->baseBlock.regStack = blockBytes[0x4];
9D021D40  93AA0014   LBU T2, 20(SP)
9D021D44  A20A0018   SB T2, 24(S0)
389:                    snssFile->baseBlock.regPc = *((unsigned short *) &blockBytes[0x5]);
9D021D48  93AB0015   LBU T3, 21(SP)
9D021D4C  93AC0016   LBU T4, 22(SP)
9D021D50  000C6A00   SLL T5, T4, 8
9D021D54  01AB7025   OR T6, T5, T3
390:                    snssFile->baseBlock.regPc = swap16 (snssFile->baseBlock.regPc);
9D021D58  7C0E78A0   WSBH T7, T6
9D021D5C  A60F001A   SH T7, 26(S0)
391:                    snssFile->baseBlock.reg2000 = blockBytes[0x7];
9D021D60  93B80017   LBU T8, 23(SP)
9D021D64  A218001C   SB T8, 28(S0)
392:                    snssFile->baseBlock.reg2001 = blockBytes[0x8];
9D021D68  93B90018   LBU T9, 24(SP)
9D021D6C  A219001D   SB T9, 29(S0)
393:                    memcpy (&snssFile->baseBlock.cpuRam, &blockBytes[0x9], 0x800);
9D021D70  27A30019   ADDIU V1, SP, 25
9D021D74  2602001E   ADDIU V0, S0, 30
9D021D78  27BF0819   ADDIU RA, SP, 2073
9D021D7C  88670003   LWL A3, 3(V1)
9D021D80  98670000   LWR A3, 0(V1)
9D021D84  88660007   LWL A2, 7(V1)
9D021D88  98660004   LWR A2, 4(V1)
9D021D8C  8865000B   LWL A1, 11(V1)
9D021D90  98650008   LWR A1, 8(V1)
9D021D94  8864000F   LWL A0, 15(V1)
9D021D98  9864000C   LWR A0, 12(V1)
9D021D9C  A8470003   SWL A3, 3(V0)
9D021DA0  B8470000   SWR A3, 0(V0)
9D021DA4  A8460007   SWL A2, 7(V0)
9D021DA8  B8460004   SWR A2, 4(V0)
9D021DAC  A845000B   SWL A1, 11(V0)
9D021DB0  B8450008   SWR A1, 8(V0)
9D021DB4  A844000F   SWL A0, 15(V0)
9D021DB8  B844000C   SWR A0, 12(V0)
9D021DBC  24630010   ADDIU V1, V1, 16
9D021DC0  244D0010   ADDIU T5, V0, 16
9D021DC4  886A0003   LWL T2, 3(V1)
9D021DC8  986A0000   LWR T2, 0(V1)
9D021DCC  88690007   LWL T1, 7(V1)
9D021DD0  98690004   LWR T1, 4(V1)
9D021DD4  8868000B   LWL T0, 11(V1)
9D021DD8  98680008   LWR T0, 8(V1)
9D021DDC  886B000F   LWL T3, 15(V1)
9D021DE0  986B000C   LWR T3, 12(V1)
9D021DE4  A9AA0003   SWL T2, 3(T5)
9D021DE8  B9AA0000   SWR T2, 0(T5)
9D021DEC  A9A90007   SWL T1, 7(T5)
9D021DF0  B9A90004   SWR T1, 4(T5)
9D021DF4  A9A8000B   SWL T0, 11(T5)
9D021DF8  B9A80008   SWR T0, 8(T5)
9D021DFC  A9AB000F   SWL T3, 15(T5)
9D021E00  B9AB000C   SWR T3, 12(T5)
9D021E04  24780010   ADDIU T8, V1, 16
9D021E08  24420020   ADDIU V0, V0, 32
9D021E0C  8B190003   LWL T9, 3(T8)
9D021E10  9B190000   LWR T9, 0(T8)
9D021E14  8B070007   LWL A3, 7(T8)
9D021E18  9B070004   LWR A3, 4(T8)
9D021E1C  8B06000B   LWL A2, 11(T8)
9D021E20  9B060008   LWR A2, 8(T8)
9D021E24  8B05000F   LWL A1, 15(T8)
9D021E28  9B05000C   LWR A1, 12(T8)
9D021E2C  A8590003   SWL T9, 3(V0)
9D021E30  B8590000   SWR T9, 0(V0)
9D021E34  A8470007   SWL A3, 7(V0)
9D021E38  B8470004   SWR A3, 4(V0)
9D021E3C  A846000B   SWL A2, 11(V0)
9D021E40  B8460008   SWR A2, 8(V0)
9D021E44  A845000F   SWL A1, 15(V0)
9D021E48  B845000C   SWR A1, 12(V0)
9D021E4C  246C0020   ADDIU T4, V1, 32
9D021E50  25AE0020   ADDIU T6, T5, 32
9D021E54  89890003   LWL T1, 3(T4)
9D021E58  99890000   LWR T1, 0(T4)
9D021E5C  89880007   LWL T0, 7(T4)
9D021E60  99880004   LWR T0, 4(T4)
9D021E64  898B000B   LWL T3, 11(T4)
9D021E68  998B0008   LWR T3, 8(T4)
9D021E6C  898A000F   LWL T2, 15(T4)
9D021E70  998A000C   LWR T2, 12(T4)
9D021E74  A9C90003   SWL T1, 3(T6)
9D021E78  B9C90000   SWR T1, 0(T6)
9D021E7C  A9C80007   SWL T0, 7(T6)
9D021E80  B9C80004   SWR T0, 4(T6)
9D021E84  A9CB000B   SWL T3, 11(T6)
9D021E88  B9CB0008   SWR T3, 8(T6)
9D021E8C  A9CA000F   SWL T2, 15(T6)
9D021E90  B9CA000C   SWR T2, 12(T6)
9D021E94  24630030   ADDIU V1, V1, 48
9D021E98  147FFFB8   BNE V1, RA, 0x9D021D7C
9D021E9C  25A20030   ADDIU V0, T5, 48
394:                    memcpy (&snssFile->baseBlock.spriteRam, &blockBytes[0x809], 0x100);
9D021EA0  27AC0819   ADDIU T4, SP, 2073
9D021EA4  2603081E   ADDIU V1, S0, 2078
9D021EA8  27BF0919   ADDIU RA, SP, 2329
9D021EAC  898D0003   LWL T5, 3(T4)
9D021EB0  998D0000   LWR T5, 0(T4)
9D021EB4  89980007   LWL T8, 7(T4)
9D021EB8  99980004   LWR T8, 4(T4)
9D021EBC  8999000B   LWL T9, 11(T4)
9D021EC0  99990008   LWR T9, 8(T4)
9D021EC4  8987000F   LWL A3, 15(T4)
9D021EC8  9987000C   LWR A3, 12(T4)
9D021ECC  A86D0003   SWL T5, 3(V1)
9D021ED0  B86D0000   SWR T5, 0(V1)
9D021ED4  A8780007   SWL T8, 7(V1)
9D021ED8  B8780004   SWR T8, 4(V1)
9D021EDC  A879000B   SWL T9, 11(V1)
9D021EE0  B8790008   SWR T9, 8(V1)
9D021EE4  A867000F   SWL A3, 15(V1)
9D021EE8  B867000C   SWR A3, 12(V1)
9D021EEC  258C0010   ADDIU T4, T4, 16
9D021EF0  24660010   ADDIU A2, V1, 16
9D021EF4  898E0003   LWL T6, 3(T4)
9D021EF8  998E0000   LWR T6, 0(T4)
9D021EFC  89890007   LWL T1, 7(T4)
9D021F00  99890004   LWR T1, 4(T4)
9D021F04  8988000B   LWL T0, 11(T4)
9D021F08  99880008   LWR T0, 8(T4)
9D021F0C  898B000F   LWL T3, 15(T4)
9D021F10  998B000C   LWR T3, 12(T4)
9D021F14  A8CE0003   SWL T6, 3(A2)
9D021F18  B8CE0000   SWR T6, 0(A2)
9D021F1C  A8C90007   SWL T1, 7(A2)
9D021F20  B8C90004   SWR T1, 4(A2)
9D021F24  A8C8000B   SWL T0, 11(A2)
9D021F28  B8C80008   SWR T0, 8(A2)
9D021F2C  A8CB000F   SWL T3, 15(A2)
9D021F30  B8CB000C   SWR T3, 12(A2)
9D021F34  258F0010   ADDIU T7, T4, 16
9D021F38  24630020   ADDIU V1, V1, 32
9D021F3C  89E20003   LWL V0, 3(T7)
9D021F40  99E20000   LWR V0, 0(T7)
9D021F44  89ED0007   LWL T5, 7(T7)
9D021F48  99ED0004   LWR T5, 4(T7)
9D021F4C  89F8000B   LWL T8, 11(T7)
9D021F50  99F80008   LWR T8, 8(T7)
9D021F54  89F9000F   LWL T9, 15(T7)
9D021F58  99F9000C   LWR T9, 12(T7)
9D021F5C  A8620003   SWL V0, 3(V1)
9D021F60  B8620000   SWR V0, 0(V1)
9D021F64  A86D0007   SWL T5, 7(V1)
9D021F68  B86D0004   SWR T5, 4(V1)
9D021F6C  A878000B   SWL T8, 11(V1)
9D021F70  B8780008   SWR T8, 8(V1)
9D021F74  A879000F   SWL T9, 15(V1)
9D021F78  B879000C   SWR T9, 12(V1)
9D021F7C  25840020   ADDIU A0, T4, 32
9D021F80  24CE0020   ADDIU T6, A2, 32
9D021F84  88890003   LWL T1, 3(A0)
9D021F88  98890000   LWR T1, 0(A0)
9D021F8C  88880007   LWL T0, 7(A0)
9D021F90  98880004   LWR T0, 4(A0)
9D021F94  8885000B   LWL A1, 11(A0)
9D021F98  98850008   LWR A1, 8(A0)
9D021F9C  888B000F   LWL T3, 15(A0)
9D021FA0  988B000C   LWR T3, 12(A0)
9D021FA4  A9C90003   SWL T1, 3(T6)
9D021FA8  B9C90000   SWR T1, 0(T6)
9D021FAC  A9C80007   SWL T0, 7(T6)
9D021FB0  B9C80004   SWR T0, 4(T6)
9D021FB4  A9C5000B   SWL A1, 11(T6)
9D021FB8  B9C50008   SWR A1, 8(T6)
9D021FBC  A9CB000F   SWL T3, 15(T6)
9D021FC0  B9CB000C   SWR T3, 12(T6)
9D021FC4  258C0030   ADDIU T4, T4, 48
9D021FC8  159FFFB8   BNE T4, RA, 0x9D021EAC
9D021FCC  24C30030   ADDIU V1, A2, 48
395:                    memcpy (&snssFile->baseBlock.ppuRam, &blockBytes[0x909], 0x1000);
9D021FD0  27B90919   ADDIU T9, SP, 2329
9D021FD4  2602091E   ADDIU V0, S0, 2334
9D021FD8  27BF1919   ADDIU RA, SP, 6425
9D021FDC  8B2F0003   LWL T7, 3(T9)
9D021FE0  9B2F0000   LWR T7, 0(T9)
9D021FE4  8B260007   LWL A2, 7(T9)
9D021FE8  9B260004   LWR A2, 4(T9)
9D021FEC  8B2D000B   LWL T5, 11(T9)
9D021FF0  9B2D0008   LWR T5, 8(T9)
9D021FF4  8B38000F   LWL T8, 15(T9)
9D021FF8  9B38000C   LWR T8, 12(T9)
9D021FFC  A84F0003   SWL T7, 3(V0)
9D022000  B84F0000   SWR T7, 0(V0)
9D022004  A8460007   SWL A2, 7(V0)
9D022008  B8460004   SWR A2, 4(V0)
9D02200C  A84D000B   SWL T5, 11(V0)
9D022010  B84D0008   SWR T5, 8(V0)
9D022014  A858000F   SWL T8, 15(V0)
9D022018  B858000C   SWR T8, 12(V0)
9D02201C  27390010   ADDIU T9, T9, 16
9D022020  244E0010   ADDIU T6, V0, 16
9D022024  8B2A0003   LWL T2, 3(T9)
9D022028  9B2A0000   LWR T2, 0(T9)
9D02202C  8B290007   LWL T1, 7(T9)
9D022030  9B290004   LWR T1, 4(T9)
9D022034  8B28000B   LWL T0, 11(T9)
9D022038  9B280008   LWR T0, 8(T9)
9D02203C  8B25000F   LWL A1, 15(T9)
9D022040  9B25000C   LWR A1, 12(T9)
9D022044  A9CA0003   SWL T2, 3(T6)
9D022048  B9CA0000   SWR T2, 0(T6)
9D02204C  A9C90007   SWL T1, 7(T6)
9D022050  B9C90004   SWR T1, 4(T6)
9D022054  A9C8000B   SWL T0, 11(T6)
9D022058  B9C80008   SWR T0, 8(T6)
9D02205C  A9C5000F   SWL A1, 15(T6)
9D022060  B9C5000C   SWR A1, 12(T6)
9D022064  272C0010   ADDIU T4, T9, 16
9D022068  24420020   ADDIU V0, V0, 32
9D02206C  89830003   LWL V1, 3(T4)
9D022070  99830000   LWR V1, 0(T4)
9D022074  898F0007   LWL T7, 7(T4)
9D022078  998F0004   LWR T7, 4(T4)
9D02207C  8986000B   LWL A2, 11(T4)
9D022080  99860008   LWR A2, 8(T4)
9D022084  898D000F   LWL T5, 15(T4)
9D022088  998D000C   LWR T5, 12(T4)
9D02208C  A8430003   SWL V1, 3(V0)
9D022090  B8430000   SWR V1, 0(V0)
9D022094  A84F0007   SWL T7, 7(V0)
9D022098  B84F0004   SWR T7, 4(V0)
9D02209C  A846000B   SWL A2, 11(V0)
9D0220A0  B8460008   SWR A2, 8(V0)
9D0220A4  A84D000F   SWL T5, 15(V0)
9D0220A8  B84D000C   SWR T5, 12(V0)
9D0220AC  27270020   ADDIU A3, T9, 32
9D0220B0  25CB0020   ADDIU T3, T6, 32
9D0220B4  88E90003   LWL T1, 3(A3)
9D0220B8  98E90000   LWR T1, 0(A3)
9D0220BC  88E80007   LWL T0, 7(A3)
9D0220C0  98E80004   LWR T0, 4(A3)
9D0220C4  88E5000B   LWL A1, 11(A3)
9D0220C8  98E50008   LWR A1, 8(A3)
9D0220CC  88E4000F   LWL A0, 15(A3)
9D0220D0  98E4000C   LWR A0, 12(A3)
9D0220D4  A9690003   SWL T1, 3(T3)
9D0220D8  B9690000   SWR T1, 0(T3)
9D0220DC  A9680007   SWL T0, 7(T3)
9D0220E0  B9680004   SWR T0, 4(T3)
9D0220E4  A965000B   SWL A1, 11(T3)
9D0220E8  B9650008   SWR A1, 8(T3)
9D0220EC  A964000F   SWL A0, 15(T3)
9D0220F0  B964000C   SWR A0, 12(T3)
9D0220F4  27390030   ADDIU T9, T9, 48
9D0220F8  173FFFB8   BNE T9, RA, 0x9D021FDC
9D0220FC  25C20030   ADDIU V0, T6, 48
396:                    memcpy (&snssFile->baseBlock.palette, &blockBytes[0x1909], 0x20);
9D022100  261F191E   ADDIU RA, S0, 6430
9D022104  8BAE191C   LWL T6, 6428(SP)
9D022108  9BAE1919   LWR T6, 6425(SP)
9D02210C  8BAC1920   LWL T4, 6432(SP)
9D022110  9BAC191D   LWR T4, 6429(SP)
9D022114  8BAF1924   LWL T7, 6436(SP)
9D022118  9BAF1921   LWR T7, 6433(SP)
9D02211C  8BAD1928   LWL T5, 6440(SP)
9D022120  9BAD1925   LWR T5, 6437(SP)
9D022124  8BA6192C   LWL A2, 6444(SP)
9D022128  9BA61929   LWR A2, 6441(SP)
9D02212C  8BB81930   LWL T8, 6448(SP)
9D022130  9BB8192D   LWR T8, 6445(SP)
9D022134  8BA71934   LWL A3, 6452(SP)
9D022138  9BA71931   LWR A3, 6449(SP)
9D02213C  8BA31938   LWL V1, 6456(SP)
9D022140  9BA31935   LWR V1, 6453(SP)
9D022144  ABEE0003   SWL T6, 3(RA)
9D022148  BBEE0000   SWR T6, 0(RA)
9D02214C  ABEC0007   SWL T4, 7(RA)
9D022150  BBEC0004   SWR T4, 4(RA)
9D022154  ABEF000B   SWL T7, 11(RA)
9D022158  BBEF0008   SWR T7, 8(RA)
9D02215C  ABED000F   SWL T5, 15(RA)
9D022160  BBED000C   SWR T5, 12(RA)
9D022164  ABE60013   SWL A2, 19(RA)
9D022168  BBE60010   SWR A2, 16(RA)
9D02216C  ABF80017   SWL T8, 23(RA)
9D022170  BBF80014   SWR T8, 20(RA)
9D022174  ABE7001B   SWL A3, 27(RA)
9D022178  BBE70018   SWR A3, 24(RA)
9D02217C  ABE3001F   SWL V1, 31(RA)
9D022180  BBE3001C   SWR V1, 28(RA)
397:                    memcpy (&snssFile->baseBlock.mirrorState, &blockBytes[0x1929], 0x4);
9D022184  260B193E   ADDIU T3, S0, 6462
9D022188  8BA9193C   LWL T1, 6460(SP)
9D02218C  9BA91939   LWR T1, 6457(SP)
9D022190  AA091941   SWL T1, 6465(S0)
9D022194  B9690000   SWR T1, 0(T3)
398:                    snssFile->baseBlock.vramAddress = *((unsigned short *) &blockBytes[0x192D]);
9D022198  93A8193D   LBU T0, 6461(SP)
9D02219C  93A5193E   LBU A1, 6462(SP)
9D0221A0  00052200   SLL A0, A1, 8
9D0221A4  00885025   OR T2, A0, T0
399:                    snssFile->baseBlock.vramAddress = swap16 (snssFile->baseBlock.vramAddress);
9D0221A8  7C0AC8A0   WSBH T9, T2
9D0221AC  A6191942   SH T9, 6466(S0)
400:                    snssFile->baseBlock.spriteRamAddress = blockBytes[0x192F];
9D0221B0  93A2193F   LBU V0, 6463(SP)
9D0221B4  A2021944   SB V0, 6468(S0)
401:                    snssFile->baseBlock.tileXOffset = blockBytes[0x1930];
9D0221B8  93BF1940   LBU RA, 6464(SP)
9D0221BC  A21F1945   SB RA, 6469(S0)
402:                 
403:                    return SNSS_OK;
9D0221C0  00007021   ADDU T6, ZERO, ZERO
404:                 }
9D0221C4  01C01021   ADDU V0, T6, ZERO
9D0221C8  8FBF195C   LW RA, 6492(SP)
9D0221CC  8FB01958   LW S0, 6488(SP)
9D0221D0  03E00008   JR RA
9D0221D4  27BD1960   ADDIU SP, SP, 6496
405:                 
406:                 /**************************************************************************/
407:                 
408:                 static SNSS_RETURN_CODE 
409:                 SNSS_WriteBaseBlock (SNSS_FILE *snssFile)
410:                 {
9D02228C  27BDE6A0   ADDIU SP, SP, -6496
9D022290  AFBF195C   SW RA, 6492(SP)
9D022294  AFB01958   SW S0, 6488(SP)
9D022298  00808021   ADDU S0, A0, ZERO
411:                    SnssBlockHeader header;
412:                    SNSS_RETURN_CODE returnCode;
413:                    char blockBytes[BASE_BLOCK_LENGTH];
414:                    unsigned short tempShort;
415:                 
416:                    strcpy (header.tag, "BASR");
9D02229C  3C025253   LUI V0, 21075
9D0222A0  24434142   ADDIU V1, V0, 16706
9D0222A4  AFA30010   SW V1, 16(SP)
9D0222A8  A3A00014   SB ZERO, 20(SP)
417:                    header.blockVersion = SNSS_BLOCK_VERSION;
9D0222AC  24040001   ADDIU A0, ZERO, 1
9D0222B0  AFA40018   SW A0, 24(SP)
418:                    header.blockLength = BASE_BLOCK_LENGTH;
9D0222B4  24051931   ADDIU A1, ZERO, 6449
9D0222B8  AFA5001C   SW A1, 28(SP)
419:                 
420:                    if ((returnCode = SNSS_WriteBlockHeader (&header, snssFile)) != SNSS_OK)
9D0222BC  27A40010   ADDIU A0, SP, 16
9D0222C0  0F408876   JAL .LFB11, SNSS_WriteBlockHeader, .LFE19
9D0222C4  02002821   ADDU A1, S0, ZERO
9D0222C8  14400135   BNE V0, ZERO, 0x9D0227A0
9D0222CC  00406821   ADDU T5, V0, ZERO
421:                    {
422:                       return returnCode;
423:                    }
424:                 
425:                    blockBytes[0x0] = snssFile->baseBlock.regA;
9D0222D0  92060014   LBU A2, 20(S0)
9D0222D4  A3A60020   SB A2, 32(SP)
426:                    blockBytes[0x1] = snssFile->baseBlock.regX;
9D0222D8  92070015   LBU A3, 21(S0)
9D0222DC  A3A70021   SB A3, 33(SP)
427:                    blockBytes[0x2] = snssFile->baseBlock.regY;
9D0222E0  92080016   LBU T0, 22(S0)
9D0222E4  A3A80022   SB T0, 34(SP)
428:                    blockBytes[0x3] = snssFile->baseBlock.regFlags;
9D0222E8  92090017   LBU T1, 23(S0)
9D0222EC  A3A90023   SB T1, 35(SP)
429:                    blockBytes[0x4] = snssFile->baseBlock.regStack;
9D0222F0  920A0018   LBU T2, 24(S0)
9D0222F4  A3AA0024   SB T2, 36(SP)
430:                    tempShort = swap16 (snssFile->baseBlock.regPc);
9D0222F8  960B001A   LHU T3, 26(S0)
9D0222FC  7C0B60A0   WSBH T4, T3
9D022300  A7AC1952   SH T4, 6482(SP)
431:                    blockBytes[0x5] = ((char *) &tempShort)[0];
9D022304  A3AC0025   SB T4, 37(SP)
432:                    blockBytes[0x6] = ((char *) &tempShort)[1];
9D022308  000C6A02   SRL T5, T4, 8
9D02230C  A3AD0026   SB T5, 38(SP)
433:                    blockBytes[0x7] = snssFile->baseBlock.reg2000;
9D022310  920E001C   LBU T6, 28(S0)
9D022314  A3AE0027   SB T6, 39(SP)
434:                    blockBytes[0x8] = snssFile->baseBlock.reg2001;
9D022318  920F001D   LBU T7, 29(S0)
9D02231C  A3AF0028   SB T7, 40(SP)
435:                    memcpy (&blockBytes[0x9], &snssFile->baseBlock.cpuRam, 0x800);
9D022320  2603001E   ADDIU V1, S0, 30
9D022324  27A20029   ADDIU V0, SP, 41
9D022328  2618081E   ADDIU T8, S0, 2078
9D02232C  88790003   LWL T9, 3(V1)
9D022330  98790000   LWR T9, 0(V1)
9D022334  887F0007   LWL RA, 7(V1)
9D022338  987F0004   LWR RA, 4(V1)
9D02233C  8865000B   LWL A1, 11(V1)
9D022340  98650008   LWR A1, 8(V1)
9D022344  8864000F   LWL A0, 15(V1)
9D022348  9864000C   LWR A0, 12(V1)
9D02234C  A8590003   SWL T9, 3(V0)
9D022350  B8590000   SWR T9, 0(V0)
9D022354  A85F0007   SWL RA, 7(V0)
9D022358  B85F0004   SWR RA, 4(V0)
9D02235C  A845000B   SWL A1, 11(V0)
9D022360  B8450008   SWR A1, 8(V0)
9D022364  A844000F   SWL A0, 15(V0)
9D022368  B844000C   SWR A0, 12(V0)
9D02236C  24630010   ADDIU V1, V1, 16
9D022370  24460010   ADDIU A2, V0, 16
9D022374  886A0003   LWL T2, 3(V1)
9D022378  986A0000   LWR T2, 0(V1)
9D02237C  88690007   LWL T1, 7(V1)
9D022380  98690004   LWR T1, 4(V1)
9D022384  8868000B   LWL T0, 11(V1)
9D022388  98680008   LWR T0, 8(V1)
9D02238C  886B000F   LWL T3, 15(V1)
9D022390  986B000C   LWR T3, 12(V1)
9D022394  A8CA0003   SWL T2, 3(A2)
9D022398  B8CA0000   SWR T2, 0(A2)
9D02239C  A8C90007   SWL T1, 7(A2)
9D0223A0  B8C90004   SWR T1, 4(A2)
9D0223A4  A8C8000B   SWL T0, 11(A2)
9D0223A8  B8C80008   SWR T0, 8(A2)
9D0223AC  A8CB000F   SWL T3, 15(A2)
9D0223B0  B8CB000C   SWR T3, 12(A2)
9D0223B4  246E0010   ADDIU T6, V1, 16
9D0223B8  24420020   ADDIU V0, V0, 32
9D0223BC  89CF0003   LWL T7, 3(T6)
9D0223C0  99CF0000   LWR T7, 0(T6)
9D0223C4  89D90007   LWL T9, 7(T6)
9D0223C8  99D90004   LWR T9, 4(T6)
9D0223CC  89DF000B   LWL RA, 11(T6)
9D0223D0  99DF0008   LWR RA, 8(T6)
9D0223D4  89C5000F   LWL A1, 15(T6)
9D0223D8  99C5000C   LWR A1, 12(T6)
9D0223DC  A84F0003   SWL T7, 3(V0)
9D0223E0  B84F0000   SWR T7, 0(V0)
9D0223E4  A8590007   SWL T9, 7(V0)
9D0223E8  B8590004   SWR T9, 4(V0)
9D0223EC  A85F000B   SWL RA, 11(V0)
9D0223F0  B85F0008   SWR RA, 8(V0)
9D0223F4  A845000F   SWL A1, 15(V0)
9D0223F8  B845000C   SWR A1, 12(V0)
9D0223FC  24670020   ADDIU A3, V1, 32
9D022400  24CC0020   ADDIU T4, A2, 32
9D022404  88E90003   LWL T1, 3(A3)
9D022408  98E90000   LWR T1, 0(A3)
9D02240C  88E80007   LWL T0, 7(A3)
9D022410  98E80004   LWR T0, 4(A3)
9D022414  88EB000B   LWL T3, 11(A3)
9D022418  98EB0008   LWR T3, 8(A3)
9D02241C  88EA000F   LWL T2, 15(A3)
9D022420  98EA000C   LWR T2, 12(A3)
9D022424  A9890003   SWL T1, 3(T4)
9D022428  B9890000   SWR T1, 0(T4)
9D02242C  A9880007   SWL T0, 7(T4)
9D022430  B9880004   SWR T0, 4(T4)
9D022434  A98B000B   SWL T3, 11(T4)
9D022438  B98B0008   SWR T3, 8(T4)
9D02243C  A98A000F   SWL T2, 15(T4)
9D022440  B98A000C   SWR T2, 12(T4)
9D022444  24630030   ADDIU V1, V1, 48
9D022448  1478FFB8   BNE V1, T8, 0x9D02232C
9D02244C  24C20030   ADDIU V0, A2, 48
436:                    memcpy (&blockBytes[0x809], &snssFile->baseBlock.spriteRam, 0x100);
9D022450  261F081E   ADDIU RA, S0, 2078
9D022454  27A30829   ADDIU V1, SP, 2089
9D022458  2618091E   ADDIU T8, S0, 2334
9D02245C  8BEE0003   LWL T6, 3(RA)
9D022460  9BEE0000   LWR T6, 0(RA)
9D022464  8BE60007   LWL A2, 7(RA)
9D022468  9BE60004   LWR A2, 4(RA)
9D02246C  8BEF000B   LWL T7, 11(RA)
9D022470  9BEF0008   LWR T7, 8(RA)
9D022474  8BF9000F   LWL T9, 15(RA)
9D022478  9BF9000C   LWR T9, 12(RA)
9D02247C  A86E0003   SWL T6, 3(V1)
9D022480  B86E0000   SWR T6, 0(V1)
9D022484  A8660007   SWL A2, 7(V1)
9D022488  B8660004   SWR A2, 4(V1)
9D02248C  A86F000B   SWL T7, 11(V1)
9D022490  B86F0008   SWR T7, 8(V1)
9D022494  A879000F   SWL T9, 15(V1)
9D022498  B879000C   SWR T9, 12(V1)
9D02249C  27FF0010   ADDIU RA, RA, 16
9D0224A0  24670010   ADDIU A3, V1, 16
9D0224A4  8BEC0003   LWL T4, 3(RA)
9D0224A8  9BEC0000   LWR T4, 0(RA)
9D0224AC  8BE90007   LWL T1, 7(RA)
9D0224B0  9BE90004   LWR T1, 4(RA)
9D0224B4  8BE8000B   LWL T0, 11(RA)
9D0224B8  9BE80008   LWR T0, 8(RA)
9D0224BC  8BEB000F   LWL T3, 15(RA)
9D0224C0  9BEB000C   LWR T3, 12(RA)
9D0224C4  A8EC0003   SWL T4, 3(A3)
9D0224C8  B8EC0000   SWR T4, 0(A3)
9D0224CC  A8E90007   SWL T1, 7(A3)
9D0224D0  B8E90004   SWR T1, 4(A3)
9D0224D4  A8E8000B   SWL T0, 11(A3)
9D0224D8  B8E80008   SWR T0, 8(A3)
9D0224DC  A8EB000F   SWL T3, 15(A3)
9D0224E0  B8EB000C   SWR T3, 12(A3)
9D0224E4  27ED0010   ADDIU T5, RA, 16
9D0224E8  24630020   ADDIU V1, V1, 32
9D0224EC  89A20003   LWL V0, 3(T5)
9D0224F0  99A20000   LWR V0, 0(T5)
9D0224F4  89AE0007   LWL T6, 7(T5)
9D0224F8  99AE0004   LWR T6, 4(T5)
9D0224FC  89A6000B   LWL A2, 11(T5)
9D022500  99A60008   LWR A2, 8(T5)
9D022504  89AF000F   LWL T7, 15(T5)
9D022508  99AF000C   LWR T7, 12(T5)
9D02250C  A8620003   SWL V0, 3(V1)
9D022510  B8620000   SWR V0, 0(V1)
9D022514  A86E0007   SWL T6, 7(V1)
9D022518  B86E0004   SWR T6, 4(V1)
9D02251C  A866000B   SWL A2, 11(V1)
9D022520  B8660008   SWR A2, 8(V1)
9D022524  A86F000F   SWL T7, 15(V1)
9D022528  B86F000C   SWR T7, 12(V1)
9D02252C  27E40020   ADDIU A0, RA, 32
9D022530  24EC0020   ADDIU T4, A3, 32
9D022534  88890003   LWL T1, 3(A0)
9D022538  98890000   LWR T1, 0(A0)
9D02253C  88880007   LWL T0, 7(A0)
9D022540  98880004   LWR T0, 4(A0)
9D022544  8885000B   LWL A1, 11(A0)
9D022548  98850008   LWR A1, 8(A0)
9D02254C  888B000F   LWL T3, 15(A0)
9D022550  988B000C   LWR T3, 12(A0)
9D022554  A9890003   SWL T1, 3(T4)
9D022558  B9890000   SWR T1, 0(T4)
9D02255C  A9880007   SWL T0, 7(T4)
9D022560  B9880004   SWR T0, 4(T4)
9D022564  A985000B   SWL A1, 11(T4)
9D022568  B9850008   SWR A1, 8(T4)
9D02256C  A98B000F   SWL T3, 15(T4)
9D022570  B98B000C   SWR T3, 12(T4)
9D022574  27FF0030   ADDIU RA, RA, 48
9D022578  17F8FFB8   BNE RA, T8, 0x9D02245C
9D02257C  24E30030   ADDIU V1, A3, 48
437:                    memcpy (&blockBytes[0x909], &snssFile->baseBlock.ppuRam, 0x1000);
9D022580  260F091E   ADDIU T7, S0, 2334
9D022584  27A20929   ADDIU V0, SP, 2345
9D022588  2618191E   ADDIU T8, S0, 6430
9D02258C  89E70003   LWL A3, 3(T7)
9D022590  99E70000   LWR A3, 0(T7)
9D022594  89ED0007   LWL T5, 7(T7)
9D022598  99ED0004   LWR T5, 4(T7)
9D02259C  89EE000B   LWL T6, 11(T7)
9D0225A0  99EE0008   LWR T6, 8(T7)
9D0225A4  89E6000F   LWL A2, 15(T7)
9D0225A8  99E6000C   LWR A2, 12(T7)
9D0225AC  A8470003   SWL A3, 3(V0)
9D0225B0  B8470000   SWR A3, 0(V0)
9D0225B4  A84D0007   SWL T5, 7(V0)
9D0225B8  B84D0004   SWR T5, 4(V0)
9D0225BC  A84E000B   SWL T6, 11(V0)
9D0225C0  B84E0008   SWR T6, 8(V0)
9D0225C4  A846000F   SWL A2, 15(V0)
9D0225C8  B846000C   SWR A2, 12(V0)
9D0225CC  25EF0010   ADDIU T7, T7, 16
9D0225D0  244C0010   ADDIU T4, V0, 16
9D0225D4  89EA0003   LWL T2, 3(T7)
9D0225D8  99EA0000   LWR T2, 0(T7)
9D0225DC  89E90007   LWL T1, 7(T7)
9D0225E0  99E90004   LWR T1, 4(T7)
9D0225E4  89E8000B   LWL T0, 11(T7)
9D0225E8  99E80008   LWR T0, 8(T7)
9D0225EC  89E5000F   LWL A1, 15(T7)
9D0225F0  99E5000C   LWR A1, 12(T7)
9D0225F4  A98A0003   SWL T2, 3(T4)
9D0225F8  B98A0000   SWR T2, 0(T4)
9D0225FC  A9890007   SWL T1, 7(T4)
9D022600  B9890004   SWR T1, 4(T4)
9D022604  A988000B   SWL T0, 11(T4)
9D022608  B9880008   SWR T0, 8(T4)
9D02260C  A985000F   SWL A1, 15(T4)
9D022610  B985000C   SWR A1, 12(T4)
9D022614  25FF0010   ADDIU RA, T7, 16
9D022618  24420020   ADDIU V0, V0, 32
9D02261C  8BE30003   LWL V1, 3(RA)
9D022620  9BE30000   LWR V1, 0(RA)
9D022624  8BE70007   LWL A3, 7(RA)
9D022628  9BE70004   LWR A3, 4(RA)
9D02262C  8BED000B   LWL T5, 11(RA)
9D022630  9BED0008   LWR T5, 8(RA)
9D022634  8BEE000F   LWL T6, 15(RA)
9D022638  9BEE000C   LWR T6, 12(RA)
9D02263C  A8430003   SWL V1, 3(V0)
9D022640  B8430000   SWR V1, 0(V0)
9D022644  A8470007   SWL A3, 7(V0)
9D022648  B8470004   SWR A3, 4(V0)
9D02264C  A84D000B   SWL T5, 11(V0)
9D022650  B84D0008   SWR T5, 8(V0)
9D022654  A84E000F   SWL T6, 15(V0)
9D022658  B84E000C   SWR T6, 12(V0)
9D02265C  25F90020   ADDIU T9, T7, 32
9D022660  258B0020   ADDIU T3, T4, 32
9D022664  8B290003   LWL T1, 3(T9)
9D022668  9B290000   LWR T1, 0(T9)
9D02266C  8B280007   LWL T0, 7(T9)
9D022670  9B280004   LWR T0, 4(T9)
9D022674  8B25000B   LWL A1, 11(T9)
9D022678  9B250008   LWR A1, 8(T9)
9D02267C  8B24000F   LWL A0, 15(T9)
9D022680  9B24000C   LWR A0, 12(T9)
9D022684  A9690003   SWL T1, 3(T3)
9D022688  B9690000   SWR T1, 0(T3)
9D02268C  A9680007   SWL T0, 7(T3)
9D022690  B9680004   SWR T0, 4(T3)
9D022694  A965000B   SWL A1, 11(T3)
9D022698  B9650008   SWR A1, 8(T3)
9D02269C  A964000F   SWL A0, 15(T3)
9D0226A0  B964000C   SWR A0, 12(T3)
9D0226A4  25EF0030   ADDIU T7, T7, 48
9D0226A8  15F8FFB8   BNE T7, T8, 0x9D02258C
9D0226AC  25820030   ADDIU V0, T4, 48
438:                    memcpy (&blockBytes[0x1909], &snssFile->baseBlock.palette, 0x20);
9D0226B0  2618191E   ADDIU T8, S0, 6430
9D0226B4  8B0C0003   LWL T4, 3(T8)
9D0226B8  9B0C0000   LWR T4, 0(T8)
9D0226BC  8B1F0007   LWL RA, 7(T8)
9D0226C0  9B1F0004   LWR RA, 4(T8)
9D0226C4  8B07000B   LWL A3, 11(T8)
9D0226C8  9B070008   LWR A3, 8(T8)
9D0226CC  8B0D000F   LWL T5, 15(T8)
9D0226D0  9B0D000C   LWR T5, 12(T8)
9D0226D4  8B0E0013   LWL T6, 19(T8)
9D0226D8  9B0E0010   LWR T6, 16(T8)
9D0226DC  8B060017   LWL A2, 23(T8)
9D0226E0  9B060014   LWR A2, 20(T8)
9D0226E4  8B03001B   LWL V1, 27(T8)
9D0226E8  9B030018   LWR V1, 24(T8)
9D0226EC  8B19001F   LWL T9, 31(T8)
9D0226F0  9B19001C   LWR T9, 28(T8)
9D0226F4  ABAC192C   SWL T4, 6444(SP)
9D0226F8  BBAC1929   SWR T4, 6441(SP)
9D0226FC  ABBF1930   SWL RA, 6448(SP)
9D022700  BBBF192D   SWR RA, 6445(SP)
9D022704  ABA71934   SWL A3, 6452(SP)
9D022708  BBA71931   SWR A3, 6449(SP)
9D02270C  ABAD1938   SWL T5, 6456(SP)
9D022710  BBAD1935   SWR T5, 6453(SP)
9D022714  ABAE193C   SWL T6, 6460(SP)
9D022718  BBAE1939   SWR T6, 6457(SP)
9D02271C  ABA61940   SWL A2, 6464(SP)
9D022720  BBA6193D   SWR A2, 6461(SP)
9D022724  ABA31944   SWL V1, 6468(SP)
9D022728  BBA31941   SWR V1, 6465(SP)
9D02272C  ABB91948   SWL T9, 6472(SP)
9D022730  BBB91945   SWR T9, 6469(SP)
439:                    memcpy (&blockBytes[0x1929], &snssFile->baseBlock.mirrorState, 0x4);
9D022734  2609193E   ADDIU T1, S0, 6462
9D022738  89280003   LWL T0, 3(T1)
9D02273C  99280000   LWR T0, 0(T1)
9D022740  ABA8194C   SWL T0, 6476(SP)
9D022744  BBA81949   SWR T0, 6473(SP)
440:                    tempShort = swap16 (snssFile->baseBlock.vramAddress);
9D022748  96041942   LHU A0, 6466(S0)
9D02274C  7C0450A0   WSBH T2, A0
9D022750  A7AA1952   SH T2, 6482(SP)
441:                    blockBytes[0x192D] = ((char *) &tempShort)[0];
9D022754  A3AA194D   SB T2, 6477(SP)
442:                    blockBytes[0x192E] = ((char *) &tempShort)[1];
9D022758  000A7A02   SRL T7, T2, 8
9D02275C  A3AF194E   SB T7, 6478(SP)
443:                    blockBytes[0x192F] = snssFile->baseBlock.spriteRamAddress;
9D022760  92021944   LBU V0, 6468(S0)
9D022764  A3A2194F   SB V0, 6479(SP)
444:                    blockBytes[0x1930] = snssFile->baseBlock.tileXOffset;
9D022768  92181945   LBU T8, 6469(S0)
9D02276C  A3B81950   SB T8, 6480(SP)
445:                 
446:                    if (fwrite (blockBytes, BASE_BLOCK_LENGTH, 1, snssFile->fp) != 1)
9D022770  27A40020   ADDIU A0, SP, 32
9D022774  24051931   ADDIU A1, ZERO, 6449
9D022778  24060001   ADDIU A2, ZERO, 1
9D02277C  0F4108EC   JAL fwrite
9D022780  8E070000   LW A3, 0(S0)
9D022784  240C0001   ADDIU T4, ZERO, 1
9D022788  144C0005   BNE V0, T4, 0x9D0227A0
9D02278C  240D0005   ADDIU T5, ZERO, 5
447:                    {
448:                       return SNSS_WRITE_FAILED;
449:                    }
450:                 
451:                    snssFile->headerBlock.numberOfBlocks++;
9D022790  8E1F0010   LW RA, 16(S0)
9D022794  27E70001   ADDIU A3, RA, 1
9D022798  AE070010   SW A3, 16(S0)
452:                 
453:                    return SNSS_OK;
9D02279C  00006821   ADDU T5, ZERO, ZERO
454:                 }
9D0227A0  01A01021   ADDU V0, T5, ZERO
9D0227A4  8FBF195C   LW RA, 6492(SP)
9D0227A8  8FB01958   LW S0, 6488(SP)
9D0227AC  03E00008   JR RA
9D0227B0  27BD1960   ADDIU SP, SP, 6496
455:                 
456:                 /**************************************************************************/
457:                 /* functions for reading and writing VRAM blocks */
458:                 /**************************************************************************/
459:                 
460:                 static SNSS_RETURN_CODE 
461:                 SNSS_ReadVramBlock (SNSS_FILE *snssFile)
462:                 {
463:                    SnssBlockHeader header;
464:                 
465:                    if (SNSS_ReadBlockHeader (&header, snssFile) != SNSS_OK)
9D022CB0  27A40010   ADDIU A0, SP, 16
466:                    {
467:                       return SNSS_READ_FAILED;
468:                    }
469:                 
470:                    if (fread (snssFile->vramBlock.vram, MIN (header.blockLength, VRAM_16K), 1, snssFile->fp) != 1)
9D022CC4  8FB8001C   LW T8, 28(SP)
471:                    {
472:                       return SNSS_READ_FAILED;
473:                    }
474:                 
475:                    snssFile->vramBlock.vramSize = header.blockLength;
9D022CF4  8FA2001C   LW V0, 28(SP)
9D022CF8  A6021946   SH V0, 6470(S0)
476:                 
477:                    return SNSS_OK;
9D022CFC  0B408BC6   J 0x9D022F18
9D022D00  00004021   ADDU T0, ZERO, ZERO
478:                 }
479:                 
480:                 /**************************************************************************/
481:                 
482:                 static SNSS_RETURN_CODE 
483:                 SNSS_WriteVramBlock (SNSS_FILE *snssFile)
484:                 {
485:                    SnssBlockHeader header;
486:                    SNSS_RETURN_CODE returnCode;
487:                 
488:                    strcpy (header.tag, "VRAM");
9D022F98  3C194D41   LUI T9, 19777
489:                    header.blockVersion = SNSS_BLOCK_VERSION;
9D022FA8  24050001   ADDIU A1, ZERO, 1
490:                    header.blockLength = snssFile->vramBlock.vramSize;
9D022FB0  96021946   LHU V0, 6470(S0)
491:                 
492:                    if ((returnCode = SNSS_WriteBlockHeader (&header, snssFile)) != SNSS_OK)
9D022FB8  27A40010   ADDIU A0, SP, 16
493:                    {
494:                       return returnCode;
495:                    }
496:                 
497:                    if (fwrite (snssFile->vramBlock.vram, snssFile->vramBlock.vramSize, 1, snssFile->fp) != 1)
9D022FCC  26041948   ADDIU A0, S0, 6472
498:                    {
499:                       return SNSS_WRITE_FAILED;
500:                    }
501:                 
502:                    snssFile->headerBlock.numberOfBlocks++;
9D022FEC  8E040010   LW A0, 16(S0)
9D022FF0  24860001   ADDIU A2, A0, 1
9D022FF4  AE060010   SW A2, 16(S0)
503:                 
504:                    return SNSS_OK;
9D022FF8  0B408CA7   J 0x9D02329C
9D022FFC  00004021   ADDU T0, ZERO, ZERO
505:                 }
506:                 
507:                 /**************************************************************************/
508:                 /* functions for reading and writing SRAM blocks */
509:                 /**************************************************************************/
510:                 
511:                 static SNSS_RETURN_CODE 
512:                 SNSS_ReadSramBlock (SNSS_FILE *snssFile)
513:                 {
514:                    SnssBlockHeader header;
515:                 
516:                    if (SNSS_ReadBlockHeader (&header, snssFile) != SNSS_OK)
9D022D04  27A40010   ADDIU A0, SP, 16
517:                    {
518:                       return SNSS_READ_FAILED;
519:                    }
520:                 
521:                    if (fread (&snssFile->sramBlock.sramEnabled, 1, 1, snssFile->fp) != 1)
9D022D18  2604594A   ADDIU A0, S0, 22858
522:                    {
523:                       return SNSS_READ_FAILED;
524:                    }
525:                 
526:                    /* read blockLength - 1 bytes to get all of the SRAM */
527:                    if (fread (&snssFile->sramBlock.sram, MIN (header.blockLength - 1, SRAM_8K), 1, snssFile->fp) != 1)
9D022D38  8FA9001C   LW T1, 28(SP)
528:                    {
529:                       return SNSS_READ_FAILED;
530:                    }
531:                 
532:                    /* SRAM size is the size of the block - 1 (SRAM enabled byte) */
533:                    snssFile->sramBlock.sramSize = header.blockLength - 1;
9D022D6C  8FAE001C   LW T6, 28(SP)
9D022D70  25CFFFFF   ADDIU T7, T6, -1
9D022D74  A60F5948   SH T7, 22856(S0)
534:                 
535:                    return SNSS_OK;
9D022D78  0B408BC6   J 0x9D022F18
9D022D7C  00004021   ADDU T0, ZERO, ZERO
536:                 }
537:                 
538:                 /**************************************************************************/
539:                 
540:                 static SNSS_RETURN_CODE 
541:                 SNSS_WriteSramBlock (SNSS_FILE *snssFile)
542:                 {
543:                    SnssBlockHeader header;
544:                    SNSS_RETURN_CODE returnCode;
545:                 
546:                    strcpy (header.tag, "SRAM");
9D023000  3C084D41   LUI T0, 19777
547:                    header.blockVersion = SNSS_BLOCK_VERSION;
9D023010  240A0001   ADDIU T2, ZERO, 1
548:                    /* length of block is size of SRAM plus SRAM enabled byte */
549:                    header.blockLength = snssFile->sramBlock.sramSize + 1;
9D023018  960B5948   LHU T3, 22856(S0)
550:                    if ((returnCode = SNSS_WriteBlockHeader (&header, snssFile)) != SNSS_OK)
9D023024  27A40010   ADDIU A0, SP, 16
551:                    {
552:                       return returnCode;
553:                    }
554:                 
555:                    if (fwrite (&snssFile->sramBlock.sramEnabled, 1, 1, snssFile->fp) != 1)
9D023038  2604594A   ADDIU A0, S0, 22858
556:                    {
557:                       return SNSS_WRITE_FAILED;
558:                    }
559:                 
560:                    if (fwrite (snssFile->sramBlock.sram, snssFile->sramBlock.sramSize, 1, snssFile->fp) != 1)
9D023058  2604594B   ADDIU A0, S0, 22859
561:                    {
562:                       return SNSS_WRITE_FAILED;
563:                    }
564:                 
565:                    snssFile->headerBlock.numberOfBlocks++;
9D023078  8E0F0010   LW T7, 16(S0)
9D02307C  25F80001   ADDIU T8, T7, 1
9D023080  AE180010   SW T8, 16(S0)
566:                 
567:                    return SNSS_OK;
9D023084  0B408CA7   J 0x9D02329C
9D023088  00004021   ADDU T0, ZERO, ZERO
568:                 }
569:                 
570:                 /**************************************************************************/
571:                 /* functions for reading and writing mapper data blocks */
572:                 /**************************************************************************/
573:                 
574:                 static SNSS_RETURN_CODE 
575:                 SNSS_ReadMapperBlock (SNSS_FILE *snssFile)
576:                 {
577:                    char *blockBytes;
578:                    int i;
579:                    SnssBlockHeader header;
580:                 
581:                    if (SNSS_ReadBlockHeader (&header, snssFile) != SNSS_OK)
9D022D80  27A40010   ADDIU A0, SP, 16
9D022D84  0F408714   JAL .LFB10, SNSS_ReadBlockHeader, .LFE14
9D022D88  02002821   ADDU A1, S0, ZERO
9D022D8C  14400062   BNE V0, ZERO, 0x9D022F18
9D022D90  24080004   ADDIU T0, ZERO, 4
582:                    {
583:                       return SNSS_READ_FAILED;
584:                    }
585:                 
586:                    if ((blockBytes = (char *) malloc (0x8 + 0x10 + 0x80)) == NULL)
9D022D94  0F40C453   JAL .Letext0, .LFE16, malloc
9D022D98  24040098   ADDIU A0, ZERO, 152
9D022D9C  00408821   ADDU S1, V0, ZERO
9D022DA0  1040005D   BEQ V0, ZERO, 0x9D022F18
9D022DA4  24080006   ADDIU T0, ZERO, 6
587:                    {
588:                       return SNSS_OUT_OF_MEMORY;
589:                    }
590:                 
591:                    if (fread (blockBytes, MIN (0x8 + 0x10 + 0x80, header.blockLength), 1, snssFile->fp) != 1)
9D022DA8  8FA9001C   LW T1, 28(SP)
9D022DAC  2D2A0099   SLTIU T2, T1, 153
9D022DB0  00402021   ADDU A0, V0, ZERO
9D022DB4  240B0098   ADDIU T3, ZERO, 152
9D022DB8  012A580B   MOVN T3, T1, T2
9D022DBC  01602821   ADDU A1, T3, ZERO
9D022DC0  24060001   ADDIU A2, ZERO, 1
9D022DC4  0F40E52C   JAL .Letext0, .LFE1, fread
9D022DC8  8E070000   LW A3, 0(S0)
9D022DCC  240C0001   ADDIU T4, ZERO, 1
9D022DD0  504C0005   BEQL V0, T4, 0x9D022DE8
9D022DD4  962D0000   LHU T5, 0(S1)
592:                    {
593:                       free(blockBytes);
9D022DD8  0F40E912   JAL free
9D022DDC  02202021   ADDU A0, S1, ZERO
594:                       return SNSS_READ_FAILED;
9D022DE0  0B408BC6   J 0x9D022F18
9D022DE4  24080004   ADDIU T0, ZERO, 4
595:                    }
596:                 
597:                    for (i = 0; i < 4; i++)
598:                    {
599:                       snssFile->mapperBlock.prgPages[i] = *((unsigned short *) &blockBytes[i * 2]);
600:                       snssFile->mapperBlock.prgPages[i] = swap16 (snssFile->mapperBlock.prgPages[i]);
9D022DE8  7C0D70A0   WSBH T6, T5
9D022DEC  A60E794C   SH T6, 31052(S0)
9D022DF0  962F0002   LHU T7, 2(S1)
9D022DF4  7C0FC0A0   WSBH T8, T7
9D022DF8  A618794E   SH T8, 31054(S0)
9D022DFC  96390004   LHU T9, 4(S1)
9D022E00  7C19F8A0   WSBH RA, T9
9D022E04  A61F7950   SH RA, 31056(S0)
9D022E08  96220006   LHU V0, 6(S1)
9D022E0C  7C0228A0   WSBH A1, V0
9D022E10  A6057952   SH A1, 31058(S0)
601:                    }
602:                 
603:                    for (i = 0; i < 8; i++)
604:                    {
605:                       snssFile->mapperBlock.chrPages[i] = *((unsigned short *) &blockBytes[0x8 + (i * 2)]);
606:                       snssFile->mapperBlock.chrPages[i] = swap16 (snssFile->mapperBlock.chrPages[i]);
9D022E14  96230008   LHU V1, 8(S1)
9D022E18  7C0320A0   WSBH A0, V1
9D022E1C  A6047954   SH A0, 31060(S0)
9D022E20  9626000A   LHU A2, 10(S1)
9D022E24  7C0638A0   WSBH A3, A2
9D022E28  A6077956   SH A3, 31062(S0)
9D022E2C  9628000C   LHU T0, 12(S1)
9D022E30  7C0848A0   WSBH T1, T0
9D022E34  A6097958   SH T1, 31064(S0)
9D022E38  962A000E   LHU T2, 14(S1)
9D022E3C  7C0A58A0   WSBH T3, T2
9D022E40  A60B795A   SH T3, 31066(S0)
9D022E44  962C0010   LHU T4, 16(S1)
9D022E48  7C0C68A0   WSBH T5, T4
9D022E4C  A60D795C   SH T5, 31068(S0)
9D022E50  962E0012   LHU T6, 18(S1)
9D022E54  7C0E78A0   WSBH T7, T6
9D022E58  A60F795E   SH T7, 31070(S0)
9D022E5C  96380014   LHU T8, 20(S1)
9D022E60  7C18C8A0   WSBH T9, T8
9D022E64  A6197960   SH T9, 31072(S0)
9D022E68  963F0016   LHU RA, 22(S1)
9D022E6C  7C1F10A0   WSBH V0, RA
9D022E70  A6027962   SH V0, 31074(S0)
607:                    }
608:                 
609:                    memcpy (&snssFile->mapperBlock.extraData.mapperData, &blockBytes[0x18], 0x80);
9D022E74  26280018   ADDIU T0, S1, 24
9D022E78  26107964   ADDIU S0, S0, 31076
9D022E7C  26270098   ADDIU A3, S1, 152
9D022E80  8D060000   LW A2, 0(T0)
9D022E84  8D050004   LW A1, 4(T0)
9D022E88  8D040008   LW A0, 8(T0)
9D022E8C  8D03000C   LW V1, 12(T0)
9D022E90  AA060003   SWL A2, 3(S0)
9D022E94  BA060000   SWR A2, 0(S0)
9D022E98  AA050007   SWL A1, 7(S0)
9D022E9C  BA050004   SWR A1, 4(S0)
9D022EA0  AA04000B   SWL A0, 11(S0)
9D022EA4  BA040008   SWR A0, 8(S0)
9D022EA8  AA03000F   SWL V1, 15(S0)
9D022EAC  BA03000C   SWR V1, 12(S0)
9D022EB0  25080010   ADDIU T0, T0, 16
9D022EB4  1507FFF2   BNE T0, A3, 0x9D022E80
9D022EB8  26100010   ADDIU S0, S0, 16
610:                 
611:                    free (blockBytes);
9D022EBC  0F40E912   JAL free
9D022EC0  02202021   ADDU A0, S1, ZERO
612:                 
613:                    return SNSS_OK;
9D022EC4  0B408BC6   J 0x9D022F18
9D022EC8  00004021   ADDU T0, ZERO, ZERO
614:                 }
615:                 
616:                 /**************************************************************************/
617:                 
618:                 static SNSS_RETURN_CODE 
619:                 SNSS_WriteMapperBlock (SNSS_FILE *snssFile)
620:                 {
621:                    SnssBlockHeader header;
622:                    char blockBytes[MAPPER_BLOCK_LENGTH];
623:                    unsigned short tempShort;
624:                    int i;
625:                    SNSS_RETURN_CODE returnCode;
626:                 
627:                    strcpy (header.tag, "MPRD");
9D02308C  3C094452   LUI T1, 17490
628:                    header.blockVersion = SNSS_BLOCK_VERSION;
9D02309C  240B0001   ADDIU T3, ZERO, 1
629:                    header.blockLength = MAPPER_BLOCK_LENGTH;
9D0230A4  240C0098   ADDIU T4, ZERO, 152
630:                 
631:                    if ((returnCode = SNSS_WriteBlockHeader (&header, snssFile)) != SNSS_OK)
9D0230AC  27A400A8   ADDIU A0, SP, 168
632:                    {
633:                       return returnCode;
634:                    }
635:                 
636:                    for (i = 0; i < 4; i++)
637:                    {
638:                       tempShort = swap16 (snssFile->mapperBlock.prgPages[i]);
9D0230C0  960D794C   LHU T5, 31052(S0)
9D0230D4  9618794E   LHU T8, 31054(S0)
9D0230E8  96027950   LHU V0, 31056(S0)
9D0230FC  96047952   LHU A0, 31058(S0)
639:                       blockBytes[(i * 2) + 0] = ((char *) &tempShort)[0];
9D0230C8  A3AE0010   SB T6, 16(SP)
9D0230DC  A3B90012   SB T9, 18(SP)
9D0230F0  A3A50014   SB A1, 20(SP)
9D023104  A3A60016   SB A2, 22(SP)
640:                       blockBytes[(i * 2) + 1] = ((char *) &tempShort)[1];
9D0230CC  000E7A02   SRL T7, T6, 8
9D0230E0  0019FA02   SRL RA, T9, 8
9D0230F4  00051A02   SRL V1, A1, 8
9D023108  00063A02   SRL A3, A2, 8
641:                    }
642:                 
643:                    for (i = 0; i < 8; i++)
644:                    {
645:                       tempShort = swap16 (snssFile->mapperBlock.chrPages[i]);
9D023110  96087954   LHU T0, 31060(S0)
9D023124  960B7956   LHU T3, 31062(S0)
9D023138  960E7958   LHU T6, 31064(S0)
9D02314C  9619795A   LHU T9, 31066(S0)
9D023160  9605795C   LHU A1, 31068(S0)
9D023174  9606795E   LHU A2, 31070(S0)
9D023188  96097960   LHU T1, 31072(S0)
9D02319C  960C7962   LHU T4, 31074(S0)
646:                       blockBytes[0x8 + (i * 2) + 0] = ((char *) &tempShort)[0];
9D023118  A3A90018   SB T1, 24(SP)
9D02312C  A3AC001A   SB T4, 26(SP)
9D023140  A3AF001C   SB T7, 28(SP)
9D023154  A3BF001E   SB RA, 30(SP)
9D023168  A3A30020   SB V1, 32(SP)
9D02317C  A3A70022   SB A3, 34(SP)
9D023190  A3AA0024   SB T2, 36(SP)
9D0231A8  A3AD0026   SB T5, 38(SP)
647:                       blockBytes[0x8 + (i * 2) + 1] = ((char *) &tempShort)[1];
9D02311C  00095202   SRL T2, T1, 8
9D023130  000C6A02   SRL T5, T4, 8
9D023144  000FC202   SRL T8, T7, 8
9D023158  001F1202   SRL V0, RA, 8
9D02316C  00032202   SRL A0, V1, 8
9D023180  00074202   SRL T0, A3, 8
9D023194  000A5A02   SRL T3, T2, 8
9D0231AC  000D7202   SRL T6, T5, 8
648:                    }
649:                 
650:                    memcpy (&blockBytes[0x18], &snssFile->mapperBlock.extraData.mapperData, 0x80);
9D0231B4  26027964   ADDIU V0, S0, 31076
651:                 
652:                    if (fwrite (blockBytes, MAPPER_BLOCK_LENGTH, 1, snssFile->fp) != 1)
9D0231FC  27A40010   ADDIU A0, SP, 16
653:                    {
654:                       return SNSS_WRITE_FAILED;
655:                    }
656:                 
657:                    snssFile->headerBlock.numberOfBlocks++;
9D02321C  8E060010   LW A2, 16(S0)
9D023220  24C70001   ADDIU A3, A2, 1
9D023224  AE070010   SW A3, 16(S0)
658:                 
659:                    return SNSS_OK;
9D023228  0B408CA7   J 0x9D02329C
9D02322C  00004021   ADDU T0, ZERO, ZERO
660:                 }
661:                 
662:                 /**************************************************************************/
663:                 /* functions for reading and writing controller data blocks */
664:                 /**************************************************************************/
665:                 
666:                 static SNSS_RETURN_CODE 
667:                 SNSS_ReadControllersBlock (SNSS_FILE *snssFile)
668:                 {
669:                    /* quell warnings */
670:                    snssFile = snssFile;
671:                 
672:                    return SNSS_OK;
673:                 }
674:                 
675:                 /**************************************************************************/
676:                 
677:                 static SNSS_RETURN_CODE 
678:                 SNSS_WriteControllersBlock (SNSS_FILE *snssFile)
679:                 {
680:                    /* quell warnings */
681:                    snssFile = snssFile;
682:                 
683:                    return SNSS_OK;
684:                 }
685:                 
686:                 /**************************************************************************/
687:                 /* functions for reading and writing sound blocks */
688:                 /**************************************************************************/
689:                 
690:                 static SNSS_RETURN_CODE 
691:                 SNSS_ReadSoundBlock (SNSS_FILE *snssFile)
692:                 {
693:                    SnssBlockHeader header;
694:                 
695:                    if (SNSS_ReadBlockHeader (&header, snssFile) != SNSS_OK)
9D022ECC  27A40010   ADDIU A0, SP, 16
696:                    {
697:                       return SNSS_READ_FAILED;
698:                    }
699:                 
700:                    if (fread (snssFile->soundBlock.soundRegisters, MIN (header.blockLength, 0x16), 1, snssFile->fp) != 1)
9D022EE0  8FA6001C   LW A2, 28(SP)
701:                    {
702:                       return SNSS_READ_FAILED;
9D022F04  38440001   XORI A0, V0, 1
9D022F08  24080004   ADDIU T0, ZERO, 4
703:                    }
704:                 
705:                    return SNSS_OK;
706:                 }
707:                 
708:                 /**************************************************************************/
709:                 
710:                 static SNSS_RETURN_CODE 
711:                 SNSS_WriteSoundBlock (SNSS_FILE *snssFile)
712:                 {
713:                    SnssBlockHeader header;
714:                    SNSS_RETURN_CODE returnCode;
715:                 
716:                    strcpy (header.tag, "SOUN");
9D023230  3C074E55   LUI A3, 20053
717:                    header.blockVersion = SNSS_BLOCK_VERSION;
9D023240  24090001   ADDIU T1, ZERO, 1
718:                    header.blockLength = SOUND_BLOCK_LENGTH;
9D023248  240A0016   ADDIU T2, ZERO, 22
719:                 
720:                    if ((returnCode = SNSS_WriteBlockHeader (&header, snssFile)) != SNSS_OK)
9D023250  27A40010   ADDIU A0, SP, 16
721:                    {
722:                       return returnCode;
723:                    }
724:                 
725:                    if (fwrite (snssFile->soundBlock.soundRegisters, SOUND_BLOCK_LENGTH, 1, snssFile->fp) != 1)
9D023264  260479E5   ADDIU A0, S0, 31205
726:                    {
727:                       return SNSS_WRITE_FAILED;
728:                    }
729:                 
730:                    snssFile->headerBlock.numberOfBlocks++;
9D023284  8E0C0010   LW T4, 16(S0)
9D023288  258D0001   ADDIU T5, T4, 1
9D02328C  AE0D0010   SW T5, 16(S0)
731:                 
732:                    return SNSS_OK;
9D023290  0B408CA7   J 0x9D02329C
9D023294  00004021   ADDU T0, ZERO, ZERO
733:                 }
734:                 
735:                 /**************************************************************************/
736:                 /* general functions for reading and writing SNSS data blocks */
737:                 /**************************************************************************/
738:                 
739:                 SNSS_RETURN_CODE
740:                 SNSS_ReadBlock (SNSS_FILE *snssFile, SNSS_BLOCK_TYPE blockType)
741:                 {
9D022C50  27BDFFD0   ADDIU SP, SP, -48
9D022C54  AFBF002C   SW RA, 44(SP)
9D022C58  AFB10028   SW S1, 40(SP)
9D022C5C  AFB00024   SW S0, 36(SP)
9D022C60  00808021   ADDU S0, A0, ZERO
742:                    switch (blockType)
9D022C44  2CA20006   SLTIU V0, A1, 6
9D022C48  10400012   BEQ V0, ZERO, 0x9D022C94
9D022C4C  00052880   SLL A1, A1, 2
9D022C64  3C039D02   LUI V1, -25342
9D022C68  24642C7C   ADDIU A0, V1, 11388
9D022C6C  00853021   ADDU A2, A0, A1
9D022C70  8CC70000   LW A3, 0(A2)
9D022C74  00E00008   JR A3
9D022C78  00000000   NOP
743:                    {
744:                    case SNSS_BASR:
745:                       return SNSS_ReadBaseBlock (snssFile);
9D022CA0  0F408733   JAL .LFB19, SNSS_ReadBaseBlock, .LFE10
9D022CA4  02002021   ADDU A0, S0, ZERO
9D022CA8  0B408BC6   J 0x9D022F18
9D022CAC  00404021   ADDU T0, V0, ZERO
746:                 
747:                    case SNSS_VRAM:
748:                       return SNSS_ReadVramBlock (snssFile);
749:                 
750:                    case SNSS_SRAM:
751:                       return SNSS_ReadSramBlock (snssFile);
752:                 
753:                    case SNSS_MPRD:
754:                       return SNSS_ReadMapperBlock (snssFile);
755:                 
756:                    case SNSS_CNTR:
757:                       return SNSS_ReadControllersBlock (snssFile);
9D022F14  00004021   ADDU T0, ZERO, ZERO
758:                 
759:                    case SNSS_SOUN:
760:                       return SNSS_ReadSoundBlock (snssFile);
761:                 
762:                    case SNSS_UNKNOWN_BLOCK:
763:                    default:
764:                        return SNSS_UNSUPPORTED_BLOCK;
9D022C94  24080007   ADDIU T0, ZERO, 7
765:                    }
766:                 }
9D022C98  03E00008   JR RA
9D022C9C  01001021   ADDU V0, T0, ZERO
9D022F18  01001021   ADDU V0, T0, ZERO
9D022F1C  8FBF002C   LW RA, 44(SP)
9D022F20  8FB10028   LW S1, 40(SP)
9D022F24  8FB00024   LW S0, 36(SP)
9D022F28  03E00008   JR RA
9D022F2C  27BD0030   ADDIU SP, SP, 48
767:                 
768:                 /**************************************************************************/
769:                 
770:                 SNSS_RETURN_CODE
771:                 SNSS_WriteBlock (SNSS_FILE *snssFile, SNSS_BLOCK_TYPE blockType)
772:                 {
9D022F3C  27BDFF38   ADDIU SP, SP, -200
9D022F40  AFBF00C4   SW RA, 196(SP)
9D022F44  AFB000C0   SW S0, 192(SP)
9D022F48  00808021   ADDU S0, A0, ZERO
773:                    switch (blockType)
9D022F30  2CA20006   SLTIU V0, A1, 6
9D022F34  10400011   BEQ V0, ZERO, 0x9D022F7C
9D022F38  00052880   SLL A1, A1, 2
9D022F4C  3C039D02   LUI V1, -25342
9D022F50  24642F64   ADDIU A0, V1, 12132
9D022F54  00853021   ADDU A2, A0, A1
9D022F58  8CC70000   LW A3, 0(A2)
9D022F5C  00E00008   JR A3
9D022F60  00000000   NOP
774:                    {
775:                    case SNSS_BASR:
776:                       return SNSS_WriteBaseBlock (snssFile);
9D022F88  0F4088A3   JAL .LFB20, SNSS_WriteBaseBlock, .LFE11
9D022F8C  02002021   ADDU A0, S0, ZERO
9D022F90  0B408CA7   J 0x9D02329C
9D022F94  00404021   ADDU T0, V0, ZERO
777:                 
778:                    case SNSS_VRAM:
779:                       return SNSS_WriteVramBlock (snssFile);
780:                 
781:                    case SNSS_SRAM:
782:                       return SNSS_WriteSramBlock (snssFile);
783:                 
784:                    case SNSS_MPRD:
785:                       return SNSS_WriteMapperBlock (snssFile);
786:                 
787:                    case SNSS_CNTR:
788:                       return SNSS_WriteControllersBlock (snssFile);
9D023298  00004021   ADDU T0, ZERO, ZERO
789:                 
790:                    case SNSS_SOUN:
791:                       return SNSS_WriteSoundBlock (snssFile);
792:                 
793:                    case SNSS_UNKNOWN_BLOCK:
794:                    default:
795:                        return SNSS_UNSUPPORTED_BLOCK;
9D022F7C  240E0007   ADDIU T6, ZERO, 7
796:                    }
797:                 }
9D022F80  03E00008   JR RA
9D022F84  01C01021   ADDU V0, T6, ZERO
9D02329C  01001021   ADDU V0, T0, ZERO
9D0232A0  8FBF00C4   LW RA, 196(SP)
9D0232A4  8FB000C0   LW S0, 192(SP)
9D0232A8  03E00008   JR RA
9D0232AC  27BD00C8   ADDIU SP, SP, 200
798:                 
799:                 /*
800:                 ** $Log: libsnss.c,v $
801:                 ** Revision 1.2  2001/04/27 14:37:11  neil
802:                 ** wheeee
803:                 **
804:                 ** Revision 1.1  2001/04/27 12:54:40  neil
805:                 ** blah
806:                 **
807:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
808:                 ** initial
809:                 **
810:                 ** Revision 1.1  2000/10/24 12:19:01  matt
811:                 ** changed directory structure
812:                 **
813:                 ** Revision 1.9  2000/10/10 13:03:54  matt
814:                 ** Mr. Clean makes a guest appearance
815:                 **
816:                 ** Revision 1.8  2000/08/16 02:58:34  matt
817:                 ** random cleanups
818:                 **
819:                 ** Revision 1.7  2000/07/17 01:52:27  matt
820:                 ** made sure last line of all source files is a newline
821:                 **
822:                 ** Revision 1.6  2000/07/10 01:54:16  matt
823:                 ** state is now zeroed when it is allocated
824:                 **
825:                 ** Revision 1.5  2000/07/09 15:37:21  matt
826:                 ** all block read/write calls now pass through a common handler
827:                 **
828:                 ** Revision 1.4  2000/07/09 03:39:06  matt
829:                 ** minor modifications
830:                 **
831:                 ** Revision 1.3  2000/07/08 16:01:39  matt
832:                 ** added bald's changes, made error checking more robust
833:                 **
834:                 ** Revision 1.2  2000/07/04 04:46:06  matt
835:                 ** simplified handling of SNSS states
836:                 **
837:                 ** Revision 1.1  2000/06/29 14:13:28  matt
838:                 ** initial revision
839:                 **
840:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/intro.c  -----------------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** intro.c
21:                  **
22:                  ** Nofrendo intro -- 6502 code
23:                  ** $Id: intro.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <string.h>
27:                  #include <stdlib.h>
28:                  #include <noftypes.h>
29:                  #include <intro.h>
30:                  
31:                  #define  CODE_SIZE   0x4000
32:                  #define  VROM_SIZE   0x2000
33:                  
34:                  /* 6502 code for the intro */
35:                  static uint8 intro_code[301] =
36:                  {
37:                     0x78, 0xD8, 0xA2, 0x00, 0x8E, 0x00, 0x20, 0x8E, 0x01, 0x20, 0xAD, 0x02, 0x20, 0xAD, 0x02, 0x20, 
38:                     0x10, 0xFB, 0xAD, 0x02, 0x20, 0x10, 0xFB, 0x8E, 0x03, 0x20, 0xCA, 0x9A, 0xA9, 0x3F, 0x8D, 0x06, 
39:                     0x20, 0xA9, 0x00, 0x8D, 0x06, 0x20, 0xA2, 0x20, 0xA9, 0x0F, 0x8D, 0x07, 0x20, 0xCA, 0xD0, 0xFA, 
40:                     0xA9, 0x20, 0x8D, 0x06, 0x20, 0xA9, 0x00, 0x8D, 0x06, 0x20, 0xAA, 0xA0, 0x10, 0x8D, 0x07, 0x20, 
41:                     0xE8, 0xD0, 0xFA, 0x88, 0xD0, 0xF7, 0xA9, 0xF8, 0xA2, 0x00, 0x9D, 0x00, 0x02, 0xE8, 0xD0, 0xFA, 
42:                     0xA9, 0x02, 0x8D, 0x14, 0x40, 0xA9, 0x21, 0x8D, 0x06, 0x20, 0xA9, 0x89, 0x8D, 0x06, 0x20, 0xA0, 
43:                     0x10, 0xA2, 0xF0, 0x8C, 0x07, 0x20, 0xC8, 0xCA, 0xD0, 0xF9, 0xA9, 0x00, 0x8D, 0x05, 0x20, 0x8D, 
44:                     0x05, 0x20, 0xA9, 0x1E, 0x8D, 0x01, 0x20, 0xA9, 0x80, 0x8D, 0x00, 0x20, 0x20, 0x8B, 0x80, 0x20, 
45:                     0xFE, 0x80, 0x20, 0xF3, 0x80, 0x20, 0xC0, 0x80, 0x4C, 0x88, 0x80, 0xA2, 0x00, 0xA0, 0x06, 0xAD, 
46:                     0x02, 0x20, 0x10, 0xFB, 0x88, 0xD0, 0xF8, 0xA9, 0x00, 0x8D, 0x00, 0x20, 0x8D, 0x01, 0x20, 0xA9, 
47:                     0x3F, 0x8D, 0x06, 0x20, 0xA9, 0x01, 0x8D, 0x06, 0x20, 0xBD, 0x28, 0x81, 0x8D, 0x07, 0x20, 0xA9, 
48:                     0x1E, 0x8D, 0x01, 0x20, 0xA9, 0x80, 0x8D, 0x00, 0x20, 0xE8, 0x8A, 0xC9, 0x05, 0xD0, 0xCE, 0x60, 
49:                     0xA2, 0x05, 0xCA, 0xA0, 0x06, 0xAD, 0x02, 0x20, 0x10, 0xFB, 0x88, 0xD0, 0xF8, 0xA9, 0x00, 0x8D, 
50:                     0x00, 0x20, 0x8D, 0x01, 0x20, 0xA9, 0x3F, 0x8D, 0x06, 0x20, 0xA9, 0x01, 0x8D, 0x06, 0x20, 0xBD, 
51:                     0x28, 0x81, 0x8D, 0x07, 0x20, 0xA9, 0x1E, 0x8D, 0x01, 0x20, 0xA9, 0x80, 0x8D, 0x00, 0x20, 0x8A, 
52:                     0xD0, 0xD0, 0x60, 0xA2, 0x60, 0xAD, 0x02, 0x20, 0x10, 0xFB, 0xCA, 0xD0, 0xF8, 0x60, 0xA9, 0x0F, 
53:                     0x8D, 0x15, 0x40, 0xA9, 0x8D, 0x8D, 0x00, 0x40, 0xA9, 0x7F, 0x8D, 0x01, 0x40, 0xA9, 0x70, 0x8D, 
54:                     0x02, 0x40, 0xA9, 0x08, 0x8D, 0x03, 0x40, 0xA0, 0x05, 0xAD, 0x02, 0x20, 0x10, 0xFB, 0x88, 0xD0, 
55:                     0xF8, 0xA9, 0x54, 0x8D, 0x02, 0x40, 0x60, 0x40, 0x0F, 0x2D, 0x10, 0x3D, 0x20, 
56:                  } ;
57:                  
58:                  /* interrupt vectors (FFFAh - FFFFh) */
59:                  static uint8 intro_vec[6] =
60:                  {
61:                     0x27, 0x81, 0x00, 0x80, 0x27, 0x81
62:                  };
63:                  
64:                  /* graphics */
65:                  static uint8 intro_vrom[4096] = 
66:                  {
67:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
68:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
69:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
70:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
71:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
72:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
73:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
74:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
75:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
76:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
77:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
78:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
79:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
80:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
81:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
82:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
83:                     0x7F, 0x80, 0xBE, 0xBF, 0xBF, 0xBF, 0xBF, 0xBE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
84:                     0xFF, 0x00, 0x01, 0x01, 0x01, 0x81, 0xC1, 0xC1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
85:                     0xFF, 0x00, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
86:                     0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
87:                     0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
88:                     0xFF, 0x00, 0x7F, 0xFF, 0xF3, 0xF1, 0xF8, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
89:                     0xFF, 0x00, 0x00, 0x80, 0xC0, 0x80, 0x00, 0x7D, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
90:                     0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
91:                     0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
92:                     0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x81, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
93:                     0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xF7, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
94:                     0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
95:                     0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
96:                     0xFF, 0x00, 0x7C, 0x7C, 0x7C, 0x7C, 0x7C, 0x7C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
97:                     0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x0F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
98:                     0xFE, 0x01, 0x01, 0x01, 0x01, 0x01, 0x01, 0xC1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
99:                     0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
100:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
101:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
102:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
103:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
104:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
105:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
106:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
107:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
108:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
109:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
110:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
111:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
112:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
113:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
114:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
115:                    0xBE, 0xBE, 0xBE, 0xBE, 0xBE, 0xBE, 0xBE, 0xBE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
116:                    0xE1, 0x71, 0x31, 0x39, 0x1D, 0x0D, 0x0F, 0x07, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
117:                    0xF0, 0xF1, 0xF3, 0xF3, 0xF3, 0xF3, 0xF3, 0xF1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
118:                    0xF3, 0xE1, 0xE1, 0xE1, 0xE1, 0xE1, 0xE1, 0xE1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
119:                    0xC7, 0xE0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xE0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
120:                    0xFF, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
121:                    0x7F, 0x7E, 0x7C, 0x7C, 0x7C, 0x7C, 0x7C, 0x7C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
122:                    0xFC, 0x3C, 0x19, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
123:                    0x79, 0xF0, 0xF0, 0xF0, 0xFF, 0xF0, 0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
124:                    0xE1, 0xF1, 0xF9, 0xF9, 0xF9, 0x01, 0xF9, 0xF1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
125:                    0xFF, 0xF8, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0xF0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
126:                    0xF8, 0xF8, 0x7C, 0x7C, 0x7C, 0x7C, 0x7C, 0x7C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
127:                    0x3C, 0x78, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
128:                    0xFC, 0x7C, 0x7C, 0x7C, 0x7C, 0x7C, 0x7C, 0x7C, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
129:                    0x3C, 0x78, 0xF8, 0xF8, 0xF8, 0xF8, 0xF8, 0x78, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
130:                    0xF1, 0x79, 0x7D, 0x7D, 0x7D, 0x7D, 0x7D, 0x79, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
131:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
132:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
133:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
134:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
135:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
136:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
137:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
138:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
139:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
140:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
141:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
142:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
143:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
144:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
145:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
146:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
147:                    0xBE, 0xBE, 0x80, 0x80, 0xBD, 0xA1, 0xBD, 0xA1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
148:                    0x03, 0x03, 0x00, 0x00, 0xE7, 0x11, 0x11, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
149:                    0xF0, 0xF0, 0x00, 0x00, 0xDE, 0x10, 0x1E, 0x10, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
150:                    0xF3, 0x3F, 0x00, 0x00, 0xF3, 0x88, 0xF0, 0x88, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
151:                    0xC0, 0x00, 0x00, 0x00, 0xE7, 0x88, 0x8F, 0x88, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
152:                    0xF8, 0xF8, 0x00, 0x00, 0x2F, 0xA8, 0xA8, 0xA8, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
153:                    0x7C, 0x7C, 0x00, 0x00, 0x3F, 0xA4, 0xA4, 0xA4, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
154:                    0x00, 0x00, 0x00, 0x00, 0x3D, 0xA1, 0xBD, 0xA1, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
155:                    0x79, 0x1F, 0x00, 0x00, 0xE7, 0x11, 0x11, 0x11, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
156:                    0xE1, 0x81, 0x00, 0x00, 0xC3, 0x04, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
157:                    0xF0, 0xF0, 0x00, 0x00, 0xD1, 0x11, 0x8E, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
158:                    0x7C, 0x7C, 0x00, 0x00, 0x3D, 0x40, 0x38, 0x04, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
159:                    0x3C, 0x1F, 0x00, 0x00, 0xF7, 0x44, 0x47, 0x44, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
160:                    0xFC, 0x7C, 0x00, 0x00, 0xBF, 0x24, 0xA4, 0x24, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
161:                    0x3C, 0x0F, 0x00, 0x00, 0x02, 0x82, 0x82, 0x82, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
162:                    0xF1, 0xC1, 0x01, 0x01, 0x19, 0x25, 0x25, 0x25, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
163:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
164:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
165:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
166:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
167:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
168:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
169:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
170:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
171:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
172:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
173:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
174:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
175:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
176:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
177:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
178:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
179:                    0x9D, 0x80, 0x7F, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
180:                    0x11, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
181:                    0x0E, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
182:                    0x88, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
183:                    0x88, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
184:                    0xA8, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
185:                    0xA4, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
186:                    0x9D, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
187:                    0x11, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
188:                    0x07, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
189:                    0x84, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
190:                    0x78, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
191:                    0x43, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
192:                    0xA4, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
193:                    0x82, 0x00, 0xFF, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
194:                    0x99, 0x01, 0xFE, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
195:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
196:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
197:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
198:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
199:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
200:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
201:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
202:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
203:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
204:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
205:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
206:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
207:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
208:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
209:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
210:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
211:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
212:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
213:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
214:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
215:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
216:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
217:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
218:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
219:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
220:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
221:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
222:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
223:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
224:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
225:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
226:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
227:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
228:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
229:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
230:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
231:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
232:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
233:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
234:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
235:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
236:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
237:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
238:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
239:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
240:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
241:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
242:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
243:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
244:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
245:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
246:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
247:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
248:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
249:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
250:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
251:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
252:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
253:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
254:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
255:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
256:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
257:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
258:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
259:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
260:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
261:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
262:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
263:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
264:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
265:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
266:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
267:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
268:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
269:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
270:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
271:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
272:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
273:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
274:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
275:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
276:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
277:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
278:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
279:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
280:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
281:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
282:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
283:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
284:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
285:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
286:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
287:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
288:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
289:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
290:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
291:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
292:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
293:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
294:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
295:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
296:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
297:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
298:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
299:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
300:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
301:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
302:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
303:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
304:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
305:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
306:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
307:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
308:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
309:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
310:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
311:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
312:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
313:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
314:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
315:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
316:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
317:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
318:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
319:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
320:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
321:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
322:                    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 
323:                 };
324:                 
325:                 static uint8 *intro_getrom(void)
326:                 {
327:                    uint8 *rom;
328:                    
329:                    rom = malloc(CODE_SIZE);   
9D0370C0  0F40F30A   JAL _my_malloc
330:                    if (NULL != rom)
9D0370C8  1040006E   BEQ V0, ZERO, .LBE7, .LBE6
331:                    {
332:                       /* good measure */
333:                       memset(rom, 0, CODE_SIZE);
9D0370D0  00402021   ADDU A0, V0, ZERO
334:                 
335:                       /* copy in the code */
336:                       memcpy(rom, intro_code, sizeof(intro_code));
9D0370E0  3C029D03   LUI V0, -25341
337:                 
338:                       /* copy in the interrupt vectors */
339:                       memcpy(rom + (CODE_SIZE - sizeof(intro_vec)), intro_vec, sizeof(intro_vec));
9D037260  3C089D03   LUI T0, -25341
9D037264  8D0494C8   LW A0, -27448(T0)
9D037268  AA043FFD   SWL A0, 16381(S0)
9D03726C  BA043FFA   SWR A0, 16378(S0)
9D037270  250D94C8   ADDIU T5, T0, -27448
9D037274  91A90004   LBU T1, 4(T5)
9D037278  A2093FFE   SB T1, 16382(S0)
9D03727C  91AE0005   LBU T6, 5(T5)
9D037280  A20E3FFF   SB T6, 16383(S0)
340:                    }
341:                 
342:                    return rom;
343:                 }
344:                 
345:                 static uint8 *intro_getvrom(void)
346:                 {
347:                    uint8 *vrom;
348:                 
349:                    vrom = malloc(VROM_SIZE);
9D037288  0F40F30A   JAL _my_malloc
350:                    if (NULL != vrom)
9D037290  10400055   BEQ V0, ZERO, .LBE9, .LBE8
351:                    {
352:                       memcpy(vrom, intro_vrom, sizeof(intro_vrom));
9D037298  260F84C8   ADDIU T7, S0, -31544
9D03729C  25FF1000   ADDIU RA, T7, 4096
9D0372A0  8DE30000   LW V1, 0(T7)
9D0372A4  8DEA0004   LW T2, 4(T7)
9D0372A8  8DE60008   LW A2, 8(T7)
9D0372AC  8DF8000C   LW T8, 12(T7)
9D0372B0  A8430003   SWL V1, 3(V0)
9D0372B4  B8430000   SWR V1, 0(V0)
9D0372B8  A84A0007   SWL T2, 7(V0)
9D0372BC  B84A0004   SWR T2, 4(V0)
9D0372C0  A846000B   SWL A2, 11(V0)
9D0372C4  B8460008   SWR A2, 8(V0)
9D0372C8  A858000F   SWL T8, 15(V0)
9D0372CC  B858000C   SWR T8, 12(V0)
9D0372D0  25EA0010   ADDIU T2, T7, 16
9D0372D4  24430010   ADDIU V1, V0, 16
9D0372D8  8D4B0000   LW T3, 0(T2)
9D0372DC  8D470004   LW A3, 4(T2)
9D0372E0  8D4C0008   LW T4, 8(T2)
9D0372E4  8D48000C   LW T0, 12(T2)
9D0372E8  A86B0003   SWL T3, 3(V1)
9D0372EC  B86B0000   SWR T3, 0(V1)
9D0372F0  A8670007   SWL A3, 7(V1)
9D0372F4  B8670004   SWR A3, 4(V1)
9D0372F8  A86C000B   SWL T4, 11(V1)
9D0372FC  B86C0008   SWR T4, 8(V1)
9D037300  A868000F   SWL T0, 15(V1)
9D037304  B868000C   SWR T0, 12(V1)
9D037308  254D0010   ADDIU T5, T2, 16
9D03730C  24690010   ADDIU T1, V1, 16
9D037310  8D4E0010   LW T6, 16(T2)
9D037314  8DB00004   LW S0, 4(T5)
9D037318  8DAF0008   LW T7, 8(T5)
9D03731C  8DA5000C   LW A1, 12(T5)
9D037320  A92E0003   SWL T6, 3(T1)
9D037324  B92E0000   SWR T6, 0(T1)
9D037328  A9300007   SWL S0, 7(T1)
9D03732C  B9300004   SWR S0, 4(T1)
9D037330  A92F000B   SWL T7, 11(T1)
9D037334  B92F0008   SWR T7, 8(T1)
9D037338  A925000F   SWL A1, 15(T1)
9D03733C  B925000C   SWR A1, 12(T1)
9D037340  24790020   ADDIU T9, V1, 32
9D037344  8DA30010   LW V1, 16(T5)
9D037348  8DAA0014   LW T2, 20(T5)
9D03734C  8DA60018   LW A2, 24(T5)
9D037350  8DB8001C   LW T8, 28(T5)
9D037354  AB230003   SWL V1, 3(T9)
9D037358  BB230000   SWR V1, 0(T9)
9D03735C  AB2A0007   SWL T2, 7(T9)
9D037360  BB2A0004   SWR T2, 4(T9)
9D037364  AB26000B   SWL A2, 11(T9)
9D037368  BB260008   SWR A2, 8(T9)
9D03736C  AB38000F   SWL T8, 15(T9)
9D037370  BB38000C   SWR T8, 12(T9)
9D037374  252B0020   ADDIU T3, T1, 32
9D037378  8DA70020   LW A3, 32(T5)
9D03737C  8DAC0024   LW T4, 36(T5)
9D037380  8DA80028   LW T0, 40(T5)
9D037384  8DA4002C   LW A0, 44(T5)
9D037388  A9670003   SWL A3, 3(T3)
9D03738C  B9670000   SWR A3, 0(T3)
9D037390  A96C0007   SWL T4, 7(T3)
9D037394  B96C0004   SWR T4, 4(T3)
9D037398  A968000B   SWL T0, 11(T3)
9D03739C  B9680008   SWR T0, 8(T3)
9D0373A0  A964000F   SWL A0, 15(T3)
9D0373A4  B964000C   SWR A0, 12(T3)
9D0373A8  252E0030   ADDIU T6, T1, 48
9D0373AC  8DB00030   LW S0, 48(T5)
9D0373B0  8DAF0034   LW T7, 52(T5)
9D0373B4  8DA50038   LW A1, 56(T5)
9D0373B8  8DB9003C   LW T9, 60(T5)
9D0373BC  A9D00003   SWL S0, 3(T6)
9D0373C0  B9D00000   SWR S0, 0(T6)
9D0373C4  A9CF0007   SWL T7, 7(T6)
9D0373C8  B9CF0004   SWR T7, 4(T6)
9D0373CC  A9C5000B   SWL A1, 11(T6)
9D0373D0  B9C50008   SWR A1, 8(T6)
9D0373D4  A9D9000F   SWL T9, 15(T6)
9D0373D8  B9D9000C   SWR T9, 12(T6)
9D0373DC  25AA0040   ADDIU T2, T5, 64
9D0373E0  155FFFBD   BNE T2, RA, 0x9D0372D8
9D0373E4  25230040   ADDIU V1, T1, 64
353:                    }
354:                 
355:                    return vrom;
356:                 }
357:                 
358:                 void intro_get_header(rominfo_t *rominfo)
359:                 {
9D03705C  27BDFFE8   ADDIU SP, SP, -24
9D037060  AFBF0014   SW RA, 20(SP)
360:                    ASSERT(rominfo);
361:                 
362:                    rominfo->rom_banks = CODE_SIZE / 0x4000;
9D037064  24020001   ADDIU V0, ZERO, 1
9D037068  AC820010   SW V0, 16(A0)
363:                    rominfo->vrom_banks = VROM_SIZE / 0x2000;
9D03706C  AC820014   SW V0, 20(A0)
364:                    rominfo->mirror = MIRROR_VERT;
9D037070  AC820024   SW V0, 36(A0)
365:                    rominfo->flags = 0;
9D037074  A0800028   SB ZERO, 40(A0)
366:                    rominfo->mapper_number = 0;
9D037078  AC800020   SW ZERO, 32(A0)
367:                    
368:                    rominfo->sram_banks = 0;
9D03707C  AC800018   SW ZERO, 24(A0)
369:                    rominfo->vram_banks = 0;
9D037080  AC80001C   SW ZERO, 28(A0)
370:                    rominfo->sram = NULL;
9D037084  AC800008   SW ZERO, 8(A0)
371:                    rominfo->vram = NULL;
9D037088  AC80000C   SW ZERO, 12(A0)
372:                 
373:                    strncpy(rominfo->filename, "Nofrendo intro", PATH_MAX);
9D03708C  24840029   ADDIU A0, A0, 41
9D037090  3C059D03   LUI A1, -25341
9D037094  24A584B8   ADDIU A1, A1, -31560
9D037098  0F40FA4F   JAL .LFE23, strncpy
9D03709C  24060200   ADDIU A2, ZERO, 512
374:                 }
9D0370A0  8FBF0014   LW RA, 20(SP)
9D0370A4  03E00008   JR RA
9D0370A8  27BD0018   ADDIU SP, SP, 24
375:                 
376:                 int intro_get_rom(rominfo_t *rominfo)
377:                 {
9D0370AC  27BDFFE0   ADDIU SP, SP, -32
9D0370B0  AFBF001C   SW RA, 28(SP)
9D0370B4  AFB10018   SW S1, 24(SP)
9D0370B8  AFB00014   SW S0, 20(SP)
9D0370BC  00808821   ADDU S1, A0, ZERO
378:                    ASSERT(rominfo);
379:                 
380:                    rominfo->rom = intro_getrom();
9D037284  AE300000   SW S0, 0(S1)
381:                    rominfo->vrom = intro_getvrom();
9D0373E8  AE220004   SW V0, 4(S1)
382:                    if (NULL == rominfo->rom || NULL == rominfo->vrom)
9D0373EC  8E310000   LW S1, 0(S1)
9D0373F0  12200003   BEQ S1, ZERO, 0x9D037400
9D0373F4  2C420001   SLTIU V0, V0, 1
9D0373F8  0B40DD01   J 0x9D037404
9D0373FC  00021023   SUBU V0, ZERO, V0
383:                       return -1; 
9D037400  2402FFFF   ADDIU V0, ZERO, -1
384:                 
385:                    return 0;
386:                 }
9D037404  8FBF001C   LW RA, 28(SP)
9D037408  8FB10018   LW S1, 24(SP)
9D03740C  8FB00014   LW S0, 20(SP)
9D037410  03E00008   JR RA
9D037414  27BD0020   ADDIU SP, SP, 32
387:                 
388:                 /*
389:                 ** $Log: intro.c,v $
390:                 ** Revision 1.2  2001/04/27 14:37:11  neil
391:                 ** wheeee
392:                 **
393:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
394:                 ** initial
395:                 **
396:                 ** Revision 1.5  2000/10/17 03:22:37  matt
397:                 ** cleaning up rom module
398:                 **
399:                 ** Revision 1.4  2000/10/10 13:58:13  matt
400:                 ** stroustrup squeezing his way in the door
401:                 **
402:                 ** Revision 1.3  2000/10/10 13:03:54  matt
403:                 ** Mr. Clean makes a guest appearance
404:                 **
405:                 ** Revision 1.2  2000/07/31 04:28:46  matt
406:                 ** one million cleanups
407:                 **
408:                 ** Revision 1.1  2000/07/30 04:29:11  matt
409:                 ** initial revision
410:                 **
411:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/gui.c  -------------------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** gui.c
21:                  **
22:                  ** GUI routines
23:                  ** $Id: gui.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <stdio.h>
27:                  #include <string.h>
28:                  #include <stdarg.h>
29:                  #include <noftypes.h>
30:                  #include <nes_ppu.h>
31:                  #include <nes_apu.h>
32:                  #include <nesinput.h>
33:                  #include <nes.h>
34:                  #include <log.h>
35:                  #include <osd.h>
36:                  
37:                  #include <bitmap.h>
38:                  
39:                  #include <gui.h>
40:                  #include <gui_elem.h>
41:                  #include <vid_drv.h>
42:                  
43:                  /* TODO: oh god */
44:                  /* 8-bit GUI color table */
45:                  rgb_t gui_pal[GUI_TOTALCOLORS] =
46:                  {
47:                     { 0x00, 0x00, 0x00 }, /* black      */
48:                     { 0x3F, 0x3F, 0x3F }, /* dark gray  */
49:                     { 0x7F, 0x7F, 0x7F }, /* gray       */
50:                     { 0xBF, 0xBF, 0xBF }, /* light gray */
51:                     { 0xFF, 0xFF, 0xFF }, /* white      */
52:                     { 0xFF, 0x00, 0x00 }, /* red        */
53:                     { 0x00, 0xFF, 0x00 }, /* green      */
54:                     { 0x00, 0x00, 0xFF }, /* blue       */
55:                     { 0xFF, 0xFF, 0x00 }, /* yellow     */
56:                     { 0xFF, 0xAF, 0x00 }, /* orange     */
57:                     { 0xFF, 0x00, 0xFF }, /* purple     */
58:                     { 0x3F, 0x7F, 0x7F }, /* teal       */
59:                     { 0x00, 0x2A, 0x00 }, /* dk. green  */
60:                     { 0x00, 0x00, 0x3F }  /* dark blue  */
61:                  };
62:                  
63:                  /**************************************************************/
64:                  #include <pcx.h>
65:                  #include <nesstate.h>
66:                  static bool option_drawsprites = true;
67:                  
68:                  /* save a PCX snapshot */
69:                  void gui_savesnap(void)
70:                  {
9D021920  27BDFDE8   ADDIU SP, SP, -536
9D021924  AFBF0214   SW RA, 532(SP)
71:                     char filename[PATH_MAX];
72:                     nes_t *nes = nes_getcontextptr();
9D021928  0F4097E7   JAL nes_getcontextptr
9D02192C  AFB00210   SW S0, 528(SP)
73:                  
74:                     //if (osd_makesnapname(filename, PATH_MAX) < 0)
75:                     //   return;
76:                  
77:                     if (pcx_write(filename, vid_getbuffer(), nes->ppu->curpal)) 
9D021930  0F40D0CF   JAL vid_getbuffer
9D021934  00408021   ADDU S0, V0, ZERO
9D021938  8E060304   LW A2, 772(S0)
9D02193C  27A40010   ADDIU A0, SP, 16
9D021940  00402821   ADDU A1, V0, ZERO
9D021944  0F40D635   JAL pcx_write
9D021948  24C611AC   ADDIU A2, A2, 4524
9D02194C  14400007   BNE V0, ZERO, 0x9D02196C
9D021950  8FBF0214   LW RA, 532(SP)
78:                        return;
79:                  
80:                     gui_sendmsg(GUI_GREEN, "Screen saved to %s", filename);
9D021954  240400C6   ADDIU A0, ZERO, 198
9D021958  3C059D04   LUI A1, -25340
9D02195C  24A5F068   ADDIU A1, A1, -3992
9D021960  0F408633   JAL gui_sendmsg
9D021964  27A60010   ADDIU A2, SP, 16
81:                  }
9D021968  8FBF0214   LW RA, 532(SP)
9D02196C  8FB00210   LW S0, 528(SP)
9D021970  03E00008   JR RA
9D021974  27BD0218   ADDIU SP, SP, 536
82:                  
83:                  /* Show/hide sprites (hiding sprites useful for making maps) */
84:                  void gui_togglesprites(void)
85:                  {
9D021978  27BDFFE8   ADDIU SP, SP, -24
9D02197C  AFBF0014   SW RA, 20(SP)
86:                     option_drawsprites ^= true;
9D021980  8F848020   LW A0, -32736(GP)
9D021984  38840001   XORI A0, A0, 1
87:                     ppu_displaysprites(option_drawsprites);
9D021988  0F40577F   JAL ppu_displaysprites
9D02198C  AF848020   SW A0, -32736(GP)
88:                     gui_sendmsg(GUI_GREEN, "Sprites %s", option_drawsprites ? "displayed" : "hidden");
9D021990  8F828020   LW V0, -32736(GP)
9D021994  50400004   BEQL V0, ZERO, 0x9D0219A8
9D021998  3C069D04   LUI A2, -25340
9D02199C  3C039D04   LUI V1, -25340
9D0219A0  0B40866B   J 0x9D0219AC
9D0219A4  2466F07C   ADDIU A2, V1, -3972
9D0219A8  24C6F088   ADDIU A2, A2, -3960
9D0219AC  240400C6   ADDIU A0, ZERO, 198
9D0219B0  3C059D04   LUI A1, -25340
9D0219B4  0F408633   JAL gui_sendmsg
9D0219B8  24A5F090   ADDIU A1, A1, -3952
89:                  }
9D0219BC  8FBF0014   LW RA, 20(SP)
9D0219C0  03E00008   JR RA
9D0219C4  27BD0018   ADDIU SP, SP, 24
90:                  
91:                  /* Set the frameskip policy */
92:                  void gui_togglefs(void)
93:                  {
9D0219C8  27BDFFE8   ADDIU SP, SP, -24
9D0219CC  AFBF0014   SW RA, 20(SP)
94:                     nes_t *machine = nes_getcontextptr();
9D0219D0  0F4097E7   JAL nes_getcontextptr
9D0219D4  00000000   NOP
95:                  
96:                     machine->autoframeskip ^= true;
9D0219D8  8C430328   LW V1, 808(V0)
9D0219DC  38640001   XORI A0, V1, 1
97:                     if (machine->autoframeskip)
9D0219E0  10800007   BEQ A0, ZERO, .LVL301
9D0219E4  AC440328   SW A0, 808(V0)
98:                        gui_sendmsg(GUI_YELLOW, "automatic frameskip");
9D0219E8  240400C8   ADDIU A0, ZERO, 200
9D0219EC  3C029D04   LUI V0, -25340
9D0219F0  0F408633   JAL gui_sendmsg
9D0219F4  2445F09C   ADDIU A1, V0, -3940
9D0219F8  0B408685   J 0x9D021A14
9D0219FC  8FBF0014   LW RA, 20(SP)
99:                     else
100:                       gui_sendmsg(GUI_YELLOW, "unthrottled emulation");
9D021A00  240400C8   ADDIU A0, ZERO, 200
9D021A04  3C059D04   LUI A1, -25340
9D021A08  0F408633   JAL gui_sendmsg
9D021A0C  24A5F0B0   ADDIU A1, A1, -3920
101:                 }
9D021A10  8FBF0014   LW RA, 20(SP)
9D021A14  03E00008   JR RA
9D021A18  27BD0018   ADDIU SP, SP, 24
102:                 
103:                 /* display rom information */
104:                 void gui_displayinfo()
105:                 {
9D021A1C  27BDFFE8   ADDIU SP, SP, -24
9D021A20  AFBF0014   SW RA, 20(SP)
106:                    gui_sendmsg(GUI_ORANGE, (char *) rom_getinfo(nes_getcontextptr()->rominfo));
9D021A24  0F4097E7   JAL nes_getcontextptr
9D021A28  00000000   NOP
9D021A2C  0F40C288   JAL rom_getinfo
9D021A30  8C440310   LW A0, 784(V0)
9D021A34  240400C9   ADDIU A0, ZERO, 201
9D021A38  0F408633   JAL gui_sendmsg
9D021A3C  00402821   ADDU A1, V0, ZERO
107:                 }
9D021A40  8FBF0014   LW RA, 20(SP)
9D021A44  03E00008   JR RA
9D021A48  27BD0018   ADDIU SP, SP, 24
108:                 
109:                 void gui_toggle_chan(int chan)
110:                 {
9D021A4C  27BDFFD8   ADDIU SP, SP, -40
9D021A50  AFBF0024   SW RA, 36(SP)
9D021A54  AFB00020   SW S0, 32(SP)
111:                 #define  FILL_CHAR   0x7C           /* ASCII 124 '|' */
112:                 #define  BLANK_CHAR  0x7F           /* ASCII 127   [delta] */
113:                    static bool chan_enabled[6] = { true, true, true, true, true, true };
114:                 
115:                    chan_enabled[chan] ^= true;
9D021A58  3C10A001   LUI S0, -24575
9D021A5C  00041880   SLL V1, A0, 2
9D021A60  26024928   ADDIU V0, S0, 18728
9D021A64  00623021   ADDU A2, V1, V0
9D021A68  8CC50000   LW A1, 0(A2)
9D021A6C  38A50001   XORI A1, A1, 1
116:                    apu_setchan(chan, chan_enabled[chan]);
9D021A70  0F407E1D   JAL apu_setchan
9D021A74  ACC50000   SW A1, 0(A2)
117:                 
118:                    gui_sendmsg(GUI_ORANGE, "%ca %cb %cc %cd %ce %cext",
9D021A78  8E0A4928   LW T2, 18728(S0)
9D021A80  8C87492C   LW A3, 18732(A0)
9D021A88  8D094930   LW T1, 18736(T0)
9D021A8C  240B007C   ADDIU T3, ZERO, 124
9D021A90  240C007F   ADDIU T4, ZERO, 127
9D021A94  0189580A   MOVZ T3, T4, T1
9D021A9C  8DCF4934   LW T7, 18740(T6)
9D021AA0  2418007C   ADDIU T8, ZERO, 124
9D021AA4  018FC00A   MOVZ T8, T4, T7
9D021AAC  8E034938   LW V1, 18744(S0)
9D021AB0  2402007C   ADDIU V0, ZERO, 124
9D021AB4  0043600B   MOVN T4, V0, V1
9D021ABC  8CC5493C   LW A1, 18748(A2)
9D021AC0  2404007C   ADDIU A0, ZERO, 124
9D021AC4  2408007F   ADDIU T0, ZERO, 127
9D021AC8  0085400B   MOVN T0, A0, A1
9D021ACC  AFAB0010   SW T3, 16(SP)
9D021AD0  AFB80014   SW T8, 20(SP)
9D021AD4  AFAC0018   SW T4, 24(SP)
9D021AD8  AFA8001C   SW T0, 28(SP)
9D021ADC  240400C9   ADDIU A0, ZERO, 201
9D021AE0  3C099D04   LUI T1, -25340
9D021AE4  2525F0C8   ADDIU A1, T1, -3896
9D021AE8  240B007C   ADDIU T3, ZERO, 124
9D021AEC  240C007F   ADDIU T4, ZERO, 127
9D021AF0  018A580A   MOVZ T3, T4, T2
9D021AF4  01603021   ADDU A2, T3, ZERO
9D021AF8  240A007C   ADDIU T2, ZERO, 124
9D021AFC  0187500A   MOVZ T2, T4, A3
9D021B00  0F408633   JAL gui_sendmsg
9D021B04  01403821   ADDU A3, T2, ZERO
119:                                chan_enabled[0] ? FILL_CHAR : BLANK_CHAR,
120:                                chan_enabled[1] ? FILL_CHAR : BLANK_CHAR,
9D021A7C  3C04A001   LUI A0, -24575
121:                                chan_enabled[2] ? FILL_CHAR : BLANK_CHAR,
9D021A84  3C08A001   LUI T0, -24575
122:                                chan_enabled[3] ? FILL_CHAR : BLANK_CHAR,
9D021A98  3C0EA001   LUI T6, -24575
123:                                chan_enabled[4] ? FILL_CHAR : BLANK_CHAR,
9D021AA8  3C10A001   LUI S0, -24575
124:                                chan_enabled[5] ? FILL_CHAR : BLANK_CHAR);
9D021AB8  3C06A001   LUI A2, -24575
125:                 }
9D021B08  8FBF0024   LW RA, 36(SP)
9D021B0C  8FB00020   LW S0, 32(SP)
9D021B10  03E00008   JR RA
9D021B14  27BD0028   ADDIU SP, SP, 40
126:                                         
127:                 void gui_setfilter(int filter_type)
128:                 {
9D021B18  27BDFFD8   ADDIU SP, SP, -40
9D021B1C  AFBF0024   SW RA, 36(SP)
9D021B20  AFB00020   SW S0, 32(SP)
9D021B24  00808021   ADDU S0, A0, ZERO
129:                    char *types[3] = { "no", "lowpass", "weighted" };
9D021B28  3C029D04   LUI V0, -25340
9D021B2C  2443F0E4   ADDIU V1, V0, -3868
9D021B30  AFA30010   SW V1, 16(SP)
9D021B34  3C049D04   LUI A0, -25340
9D021B38  2485F0E8   ADDIU A1, A0, -3864
9D021B3C  AFA50014   SW A1, 20(SP)
9D021B40  3C069D04   LUI A2, -25340
9D021B44  24C7F0F0   ADDIU A3, A2, -3856
9D021B48  AFA70018   SW A3, 24(SP)
130:                    static int last_filter = 2;
131:                 
132:                    if (last_filter == filter_type || filter_type < 0 || filter_type > 2)
9D021B4C  8F888018   LW T0, -32744(GP)
9D021B50  1110000D   BEQ T0, S0, 0x9D021B88
9D021B54  2E090003   SLTIU T1, S0, 3
9D021B58  1120000C   BEQ T1, ZERO, 0x9D021B8C
9D021B5C  8FBF0024   LW RA, 36(SP)
133:                       return;
134:                 
135:                    apu_setfilter(filter_type);
9D021B60  0F407FCC   JAL .LFB18, .LFE16, apu_setfilter
9D021B64  02002021   ADDU A0, S0, ZERO
136:                    gui_sendmsg(GUI_ORANGE, "%s filter", types[filter_type]);
9D021B68  00105080   SLL T2, S0, 2
9D021B6C  03AA5821   ADDU T3, SP, T2
9D021B70  240400C9   ADDIU A0, ZERO, 201
9D021B74  3C0C9D04   LUI T4, -25340
9D021B78  2585F0FC   ADDIU A1, T4, -3844
9D021B7C  0F408633   JAL gui_sendmsg
9D021B80  8D660010   LW A2, 16(T3)
137:                    last_filter = filter_type;
9D021B84  AF908018   SW S0, -32744(GP)
138:                 }
9D021B88  8FBF0024   LW RA, 36(SP)
9D021B8C  8FB00020   LW S0, 32(SP)
9D021B90  03E00008   JR RA
9D021B94  27BD0028   ADDIU SP, SP, 40
139:                 /**************************************************************/
140:                 
141:                 
142:                 enum
143:                 {
144:                    GUI_WAVENONE,
145:                    GUI_WAVELINE,
146:                    GUI_WAVESOLID,
147:                    GUI_NUMWAVESTYLES
148:                 };
149:                 
150:                 enum
151:                 {
152:                    BUTTON_UP,
153:                    BUTTON_DOWN
154:                 };
155:                 
156:                 
157:                 /* TODO: roll options into a structure */
158:                 static message_t msg;
159:                 static bool option_showfps = false;
160:                 static bool option_showgui = false;
161:                 static int option_wavetype = GUI_WAVENONE;
162:                 static bool option_showpattern = false;
163:                 static bool option_showoam = false;
164:                 static int pattern_col = 0;
165:                 
166:                 /* timimg variables */
167:                 static bool gui_fpsupdate = false;
168:                 static int gui_ticks = 0;
169:                 static int gui_fps = 0;
170:                 static int gui_refresh = 60; /* default to 60Hz */
171:                 
172:                 static int mouse_x, mouse_y, mouse_button;
173:                 
174:                 static bitmap_t *gui_surface;
175:                 
176:                 
177:                 /* Put a pixel on our bitmap- just for GUI use */
178:                 INLINE void gui_putpixel(int x_pos, int y_pos, uint8 color)
179:                 {
180:                    gui_surface->line[y_pos][x_pos] = color;
9D0204CC  24A50004   ADDIU A1, A1, 4
9D0204D0  00053080   SLL A2, A1, 2
9D0204D4  8F838094   LW V1, -32620(GP)
9D0204D8  00664021   ADDU T0, V1, A2
9D0204DC  00024827   NOR T1, ZERO, V0
9D0204E0  01245021   ADDU T2, T1, A0
9D0204E4  314B0007   ANDI T3, T2, 7
9D0204E8  8D0C0004   LW T4, 4(T0)
9D0204EC  01826821   ADDU T5, T4, V0
9D0204F0  24420001   ADDIU V0, V0, 1
9D020504  8D0A0004   LW T2, 4(T0)
9D020508  01425821   ADDU T3, T2, V0
9D02050C  A1670000   SB A3, 0(T3)
9D020510  244C0001   ADDIU T4, V0, 1
9D020514  8D0D0004   LW T5, 4(T0)
9D020518  01AC7021   ADDU T6, T5, T4
9D02051C  A1C70000   SB A3, 0(T6)
9D020520  8D0F0004   LW T7, 4(T0)
9D020524  01ECC021   ADDU T8, T7, T4
9D020528  A3070001   SB A3, 1(T8)
9D02052C  8D190004   LW T9, 4(T0)
9D020530  032C2821   ADDU A1, T9, T4
9D020534  A0A70002   SB A3, 2(A1)
9D020538  8D060004   LW A2, 4(T0)
9D02053C  00CC1821   ADDU V1, A2, T4
9D020540  A0670003   SB A3, 3(V1)
9D020544  8D090004   LW T1, 4(T0)
9D020548  012C1021   ADDU V0, T1, T4
9D02054C  A0470004   SB A3, 4(V0)
9D020550  8D0A0004   LW T2, 4(T0)
9D020554  014C5821   ADDU T3, T2, T4
9D020558  A1670005   SB A3, 5(T3)
9D02055C  8D0D0004   LW T5, 4(T0)
9D020560  01AC7021   ADDU T6, T5, T4
9D020564  25820007   ADDIU V0, T4, 7
9D0205A8  51660006   BEQL T3, A2, 0x9D0205C4
9D0205AC  8D0A0004   LW T2, 4(T0)
9D0205B0  8D030004   LW V1, 4(T0)
9D0205B4  00624821   ADDU T1, V1, V0
9D0205B8  A1270000   SB A3, 0(T1)
9D0205BC  24420001   ADDIU V0, V0, 1
9D0205C0  8D0A0004   LW T2, 4(T0)
9D0205C4  01425821   ADDU T3, T2, V0
9D0205C8  A1670000   SB A3, 0(T3)
9D0205CC  24420001   ADDIU V0, V0, 1
9D0205D0  8D0C0004   LW T4, 4(T0)
9D0205D4  01826821   ADDU T5, T4, V0
9D0205D8  A1A70000   SB A3, 0(T5)
9D0205DC  24420001   ADDIU V0, V0, 1
9D0205E0  8D0E0004   LW T6, 4(T0)
9D0205E4  01C27821   ADDU T7, T6, V0
9D0205E8  A1E70000   SB A3, 0(T7)
9D0205EC  24420001   ADDIU V0, V0, 1
9D0205F0  8D180004   LW T8, 4(T0)
9D0205F4  0302C821   ADDU T9, T8, V0
9D0205F8  A3270000   SB A3, 0(T9)
9D0205FC  24420001   ADDIU V0, V0, 1
9D020600  8D050004   LW A1, 4(T0)
9D020604  00A23021   ADDU A2, A1, V0
9D020608  A0C70000   SB A3, 0(A2)
9D02060C  24420001   ADDIU V0, V0, 1
9D020610  8D030004   LW V1, 4(T0)
9D020614  00624821   ADDU T1, V1, V0
9D020618  24420001   ADDIU V0, V0, 1
9D02064C  8D280004   LW T0, 4(T1)
9D020650  01046021   ADDU T4, T0, A0
9D020654  A1870000   SB A3, 0(T4)
9D02066C  8C480000   LW T0, 0(V0)
9D020670  01046021   ADDU T4, T0, A0
9D020674  A1870000   SB A3, 0(T4)
9D020678  244D0004   ADDIU T5, V0, 4
9D02067C  8C4E0004   LW T6, 4(V0)
9D020680  01C47821   ADDU T7, T6, A0
9D020684  A1E70000   SB A3, 0(T7)
9D020688  8DB80004   LW T8, 4(T5)
9D02068C  0304C821   ADDU T9, T8, A0
9D020690  A3270000   SB A3, 0(T9)
9D020694  8DA50008   LW A1, 8(T5)
9D020698  00A43021   ADDU A2, A1, A0
9D02069C  A0C70000   SB A3, 0(A2)
9D0206A0  8DA9000C   LW T1, 12(T5)
9D0206A4  01245821   ADDU T3, T1, A0
9D0206A8  A1670000   SB A3, 0(T3)
9D0206AC  8DA20010   LW V0, 16(T5)
9D0206B0  00444021   ADDU T0, V0, A0
9D0206B4  A1070000   SB A3, 0(T0)
9D0206B8  8DAC0014   LW T4, 20(T5)
9D0206BC  01847021   ADDU T6, T4, A0
9D0206C0  A1C70000   SB A3, 0(T6)
9D0206C4  8DAF0018   LW T7, 24(T5)
9D0206C8  01E4C021   ADDU T8, T7, A0
9D0206CC  A3070000   SB A3, 0(T8)
9D020714  51650007   BEQL T3, A1, 0x9D020734
9D020718  8C4B0000   LW T3, 0(V0)
9D02071C  8C460000   LW A2, 0(V0)
9D020720  00C44821   ADDU T1, A2, A0
9D020724  A1270000   SB A3, 0(T1)
9D020730  8C4B0000   LW T3, 0(V0)
9D020734  01644021   ADDU T0, T3, A0
9D020738  A1070000   SB A3, 0(T0)
9D020744  8C4C0000   LW T4, 0(V0)
9D020748  01846821   ADDU T5, T4, A0
9D02074C  A1A70000   SB A3, 0(T5)
9D020758  8C4E0000   LW T6, 0(V0)
9D02075C  01C47821   ADDU T7, T6, A0
9D020760  A1E70000   SB A3, 0(T7)
9D02076C  8C580000   LW T8, 0(V0)
9D020770  0304C821   ADDU T9, T8, A0
9D020774  A3270000   SB A3, 0(T9)
9D020780  8C450000   LW A1, 0(V0)
9D020784  00A43021   ADDU A2, A1, A0
9D020788  A0C70000   SB A3, 0(A2)
9D020794  8C490000   LW T1, 0(V0)
9D020798  01245821   ADDU T3, T1, A0
9D02079C  A1670000   SB A3, 0(T3)
9D02085C  8CC40000   LW A0, 0(A2)
9D020860  00824821   ADDU T1, A0, V0
9D020864  A1300000   SB S0, 0(T1)
9D020874  8CC40000   LW A0, 0(A2)
9D020878  008F4821   ADDU T1, A0, T7
9D02087C  A1300000   SB S0, 0(T1)
9D02088C  8CC40000   LW A0, 0(A2)
9D020890  008E4821   ADDU T1, A0, T6
9D020894  A1300000   SB S0, 0(T1)
9D0208A4  8CC40000   LW A0, 0(A2)
9D0208A8  008D4821   ADDU T1, A0, T5
9D0208AC  A1300000   SB S0, 0(T1)
9D0208BC  8CC40000   LW A0, 0(A2)
9D0208C0  008C4821   ADDU T1, A0, T4
9D0208C4  A1300000   SB S0, 0(T1)
9D0208D4  8CC40000   LW A0, 0(A2)
9D0208D8  00874821   ADDU T1, A0, A3
9D0208DC  A1300000   SB S0, 0(T1)
9D0208EC  8CC40000   LW A0, 0(A2)
9D0208F0  00854821   ADDU T1, A0, A1
9D0208F4  A1300000   SB S0, 0(T1)
9D020900  8CCA0000   LW T2, 0(A2)
9D020904  01555821   ADDU T3, T2, S5
9D020908  A1700000   SB S0, 0(T3)
9D02090C  24C60004   ADDIU A2, A2, 4
9D0210E4  8F8D8094   LW T5, -32620(GP)
9D0210E8  8DAE0098   LW T6, 152(T5)
9D0210EC  01D07821   ADDU T7, T6, S0
9D0210F0  2411FFC6   ADDIU S1, ZERO, -58
9D0210F4  0B40844B   J .LVL188
9D0210F8  A1F10000   SB S1, 0(T7)
9D021318  8F878094   LW A3, -32620(GP)
9D02131C  8CE80098   LW T0, 152(A3)
9D021320  01114821   ADDU T1, T0, S1
9D021324  240AFFC6   ADDIU T2, ZERO, -58
9D021328  A12A0000   SB T2, 0(T1)
9D02132C  26100001   ADDIU S0, S0, 1
9D0216FC  93E30000   LBU V1, 0(RA)
9D021700  0B4085B9   J .LVL244
9D021704  A3230000   SB V1, 0(T9)
9D021728  90EA0000   LBU T2, 0(A3)
9D02172C  0B4085C4   J .LVL248
9D021730  A10A0001   SB T2, 1(T0)
9D021754  93190000   LBU T9, 0(T8)
9D021758  0B4085CF   J .LVL252
9D02175C  A1F90002   SB T9, 2(T7)
9D021780  92080000   LBU T0, 0(S0)
9D021784  0B4085DA   J .LVL256
9D021788  A0A80003   SB T0, 3(A1)
9D0217AC  91AF0000   LBU T7, 0(T5)
9D0217B0  0B4085E5   J .LVL260
9D0217B4  A14F0004   SB T7, 4(T2)
9D0217D8  90650000   LBU A1, 0(V1)
9D0217DC  0B4085F0   J .LVL264
9D0217E0  A3E50005   SB A1, 5(RA)
9D021804  90EA0000   LBU T2, 0(A3)
9D021808  0B4085FB   J .LVL268
9D02180C  A16A0006   SB T2, 6(T3)
9D021830  933F0000   LBU RA, 0(T9)
9D021834  0B408606   J .LVL272
9D021838  A31F0007   SB RA, 7(T8)
9D02185C  910B0000   LBU T3, 0(T0)
9D021860  0B408611   J .LVL276
9D021864  A20B0008   SB T3, 8(S0)
9D021888  91F80000   LBU T8, 0(T7)
9D02188C  0B40861C   J .LVL280
9D021890  A1580009   SB T8, 9(T2)
9D02189C  8C9F0014   LW RA, 20(A0)
9D0218A4  90650000   LBU A1, 0(V1)
9D0218A8  A3E5000A   SB A1, 10(RA)
9D0218AC  2442000B   ADDIU V0, V0, 11
181:                 }
182:                 
183:                 /* Line drawing */
184:                 static void gui_hline(int x_pos, int y_pos, int length, uint8 color)
185:                 {
186:                    while (length--)
9D0204C0  10C0000E   BEQ A2, ZERO, 0x9D0204FC
9D0204C4  00801021   ADDU V0, A0, ZERO
9D0204C8  00C42021   ADDU A0, A2, A0
9D0204F4  14440020   BNE V0, A0, .LVL9
9D0204F8  A1A70000   SB A3, 0(T5)
9D0204FC  03E00008   JR RA
9D020500  00000000   NOP
9D020568  1444FFE6   BNE V0, A0, .LVL7, .LBB20
9D02056C  A1C70006   SB A3, 6(T6)
9D020570  03E00008   JR RA
9D020574  00000000   NOP
9D020578  1160FFE2   BEQ T3, ZERO, .LVL7, .LBB20
9D02057C  240E0001   ADDIU T6, ZERO, 1
9D020580  116E0023   BEQ T3, T6, 0x9D020610
9D020584  240F0002   ADDIU T7, ZERO, 2
9D020588  116F001D   BEQ T3, T7, 0x9D020600
9D02058C  24180003   ADDIU T8, ZERO, 3
9D020590  11780017   BEQ T3, T8, 0x9D0205F0
9D020594  24190004   ADDIU T9, ZERO, 4
9D020598  11790011   BEQ T3, T9, 0x9D0205E0
9D02059C  24050005   ADDIU A1, ZERO, 5
9D0205A0  1165000B   BEQ T3, A1, 0x9D0205D0
9D0205A4  24060006   ADDIU A2, ZERO, 6
9D02061C  1444FFB9   BNE V0, A0, .LVL7, .LBB20
9D020620  A1270000   SB A3, 0(T1)
9D020624  03E00008   JR RA
9D020628  00000000   NOP
187:                       gui_putpixel(x_pos++, y_pos, color);
188:                 }
189:                 
190:                 static void gui_vline(int x_pos, int y_pos, int height, uint8 color)
191:                 {
192:                    while (height--)
9D02062C  10C0000D   BEQ A2, ZERO, 0x9D020664
9D020630  24C3FFFF   ADDIU V1, A2, -1
9D020634  24A50004   ADDIU A1, A1, 4
9D020638  00053080   SLL A2, A1, 2
9D02063C  8F828094   LW V0, -32620(GP)
9D020640  00464821   ADDU T1, V0, A2
9D020644  240AFFFF   ADDIU T2, ZERO, -1
9D020648  306B0007   ANDI T3, V1, 7
9D020658  2463FFFF   ADDIU V1, V1, -1
9D02065C  146A0021   BNE V1, T2, .LVL23
9D020660  25220008   ADDIU V0, T1, 8
9D020664  03E00008   JR RA
9D020668  00000000   NOP
9D0206D0  2463FFF8   ADDIU V1, V1, -8
9D0206D4  146AFFE5   BNE V1, T2, .LVL21, .LBB32
9D0206D8  25A2001C   ADDIU V0, T5, 28
9D0206DC  03E00008   JR RA
9D0206E0  00000000   NOP
9D0206E4  1160FFE1   BEQ T3, ZERO, .LVL21, .LBB32
9D0206E8  240D0001   ADDIU T5, ZERO, 1
9D0206EC  116D0029   BEQ T3, T5, .LBB39
9D0206F0  240E0002   ADDIU T6, ZERO, 2
9D0206F4  116E0022   BEQ T3, T6, .LBB38
9D0206F8  240F0003   ADDIU T7, ZERO, 3
9D0206FC  116F001B   BEQ T3, T7, .LBB37
9D020700  24180004   ADDIU T8, ZERO, 4
9D020704  11780014   BEQ T3, T8, .LBB36
9D020708  24190005   ADDIU T9, ZERO, 5
9D02070C  1179000D   BEQ T3, T9, .LBB35
9D020710  24050006   ADDIU A1, ZERO, 6
9D020728  2463FFFF   ADDIU V1, V1, -1
9D02072C  24420004   ADDIU V0, V0, 4
9D02073C  2463FFFF   ADDIU V1, V1, -1
9D020740  24420004   ADDIU V0, V0, 4
9D020750  2463FFFF   ADDIU V1, V1, -1
9D020754  24420004   ADDIU V0, V0, 4
9D020764  2463FFFF   ADDIU V1, V1, -1
9D020768  24420004   ADDIU V0, V0, 4
9D020778  2463FFFF   ADDIU V1, V1, -1
9D02077C  24420004   ADDIU V0, V0, 4
9D02078C  2463FFFF   ADDIU V1, V1, -1
9D020790  24420004   ADDIU V0, V0, 4
9D0207A0  2463FFFF   ADDIU V1, V1, -1
9D0207A4  146AFFB1   BNE V1, T2, .LVL21, .LBB32
9D0207A8  24420004   ADDIU V0, V0, 4
9D0207AC  03E00008   JR RA
9D0207B0  00000000   NOP
193:                       gui_putpixel(x_pos, y_pos++, color);
194:                 }
195:                 
196:                 /* Rectangles */
197:                 static void gui_rect(int x_pos, int y_pos, int width, int height, uint8 color)
198:                 {
199:                    gui_hline(x_pos, y_pos, width, color);
9D021144  00002821   ADDU A1, ZERO, ZERO
9D021338  0B408451   J .LVL191, .LBB99
9D02133C  24040080   ADDIU A0, ZERO, 128
200:                    gui_hline(x_pos, y_pos + height - 1, width, color);
9D021154  24040080   ADDIU A0, ZERO, 128
201:                    gui_vline(x_pos, y_pos + 1, height - 2, color);
9D021168  24040080   ADDIU A0, ZERO, 128
202:                    gui_vline(x_pos + width - 1, y_pos + 1, height - 2, color);
9D02117C  240400FF   ADDIU A0, ZERO, 255
9D021180  24050001   ADDIU A1, ZERO, 1
9D021184  24060040   ADDIU A2, ZERO, 64
9D021188  0F40818B   JAL .LFB13, gui_vline, .LVL17, .LFE12
9D02118C  240700C1   ADDIU A3, ZERO, 193
203:                 }
204:                 
205:                 static void gui_rectfill(int x_pos, int y_pos, int width, int height, uint8 color)
206:                 {
207:                    while (height--)
9D020B7C  2694FFFF   ADDIU S4, S4, -1
9D020B80  129E0026   BEQ S4, FP, .LVL96
9D020B84  02602021   ADDU A0, S3, ZERO
9D020C10  2694FFF9   ADDIU S4, S4, -7
9D020C84  2694FFFF   ADDIU S4, S4, -1
9D020C88  240E0001   ADDIU T6, ZERO, 1
9D020CD4  2694FFFF   ADDIU S4, S4, -1
9D020CF4  2694FFFF   ADDIU S4, S4, -1
9D020D14  2694FFFF   ADDIU S4, S4, -1
9D020D34  2694FFFF   ADDIU S4, S4, -1
9D020D54  2694FFFF   ADDIU S4, S4, -1
9D020D74  2694FFFF   ADDIU S4, S4, -1
208:                       gui_hline(x_pos, y_pos++, width, color);
9D020B64  26160001   ADDIU S6, S0, 1
9D020B68  02602021   ADDU A0, S3, ZERO
9D020B6C  02002821   ADDU A1, S0, ZERO
9D020B70  02403021   ADDU A2, S2, ZERO
9D020B74  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020B78  02203821   ADDU A3, S1, ZERO
9D020B88  02C02821   ADDU A1, S6, ZERO
9D020B8C  02403021   ADDU A2, S2, ZERO
9D020B90  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020B94  02203821   ADDU A3, S1, ZERO
9D020B98  02602021   ADDU A0, S3, ZERO
9D020B9C  26C50001   ADDIU A1, S6, 1
9D020BA0  02403021   ADDU A2, S2, ZERO
9D020BA4  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020BA8  02203821   ADDU A3, S1, ZERO
9D020BAC  02602021   ADDU A0, S3, ZERO
9D020BB0  26C50002   ADDIU A1, S6, 2
9D020BB4  02403021   ADDU A2, S2, ZERO
9D020BB8  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020BBC  02203821   ADDU A3, S1, ZERO
9D020BC0  02602021   ADDU A0, S3, ZERO
9D020BC4  26C50003   ADDIU A1, S6, 3
9D020BC8  02403021   ADDU A2, S2, ZERO
9D020BCC  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020BD0  02203821   ADDU A3, S1, ZERO
9D020BD4  02602021   ADDU A0, S3, ZERO
9D020BD8  26C50004   ADDIU A1, S6, 4
9D020BDC  02403021   ADDU A2, S2, ZERO
9D020BE0  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020BE4  02203821   ADDU A3, S1, ZERO
9D020BE8  02602021   ADDU A0, S3, ZERO
9D020BEC  26C50005   ADDIU A1, S6, 5
9D020BF0  02403021   ADDU A2, S2, ZERO
9D020BF4  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020BF8  02203821   ADDU A3, S1, ZERO
9D020BFC  02602021   ADDU A0, S3, ZERO
9D020C00  26C50006   ADDIU A1, S6, 6
9D020C04  02403021   ADDU A2, S2, ZERO
9D020C08  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020C0C  02203821   ADDU A3, S1, ZERO
9D020C14  0B4082D9   J .LVL83, .LBB85
9D020C18  26D00007   ADDIU S0, S6, 7
9D020C68  260D0001   ADDIU T5, S0, 1
9D020C6C  AFAD0018   SW T5, 24(SP)
9D020C70  02602021   ADDU A0, S3, ZERO
9D020C74  02002821   ADDU A1, S0, ZERO
9D020C78  02403021   ADDU A2, S2, ZERO
9D020C7C  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020C80  02203821   ADDU A3, S1, ZERO
9D020C8C  12CEFFB5   BEQ S6, T6, .LVL83, .LBB85
9D020C90  8FB00018   LW S0, 24(SP)
9D020C94  240F0002   ADDIU T7, ZERO, 2
9D020C98  12CF0030   BEQ S6, T7, .LVL129
9D020C9C  24180003   ADDIU T8, ZERO, 3
9D020CA0  12D80026   BEQ S6, T8, .LVL125
9D020CA4  24190004   ADDIU T9, ZERO, 4
9D020CA8  12D9001C   BEQ S6, T9, .LVL121
9D020CAC  241F0005   ADDIU RA, ZERO, 5
9D020CB0  12DF0012   BEQ S6, RA, .LVL117
9D020CB4  24050006   ADDIU A1, ZERO, 6
9D020CB8  12C50009   BEQ S6, A1, .LVL114
9D020CBC  26160001   ADDIU S6, S0, 1
9D020CC0  02602021   ADDU A0, S3, ZERO
9D020CC4  02002821   ADDU A1, S0, ZERO
9D020CC8  02403021   ADDU A2, S2, ZERO
9D020CCC  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020CD0  02203821   ADDU A3, S1, ZERO
9D020CD8  02C08021   ADDU S0, S6, ZERO
9D020CDC  26160001   ADDIU S6, S0, 1
9D020CE0  02602021   ADDU A0, S3, ZERO
9D020CE4  02002821   ADDU A1, S0, ZERO
9D020CE8  02403021   ADDU A2, S2, ZERO
9D020CEC  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020CF0  02203821   ADDU A3, S1, ZERO
9D020CF8  02C08021   ADDU S0, S6, ZERO
9D020CFC  26160001   ADDIU S6, S0, 1
9D020D00  02602021   ADDU A0, S3, ZERO
9D020D04  02002821   ADDU A1, S0, ZERO
9D020D08  02403021   ADDU A2, S2, ZERO
9D020D0C  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020D10  02203821   ADDU A3, S1, ZERO
9D020D18  02C08021   ADDU S0, S6, ZERO
9D020D1C  26160001   ADDIU S6, S0, 1
9D020D20  02602021   ADDU A0, S3, ZERO
9D020D24  02002821   ADDU A1, S0, ZERO
9D020D28  02403021   ADDU A2, S2, ZERO
9D020D2C  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020D30  02203821   ADDU A3, S1, ZERO
9D020D38  02C08021   ADDU S0, S6, ZERO
9D020D3C  26160001   ADDIU S6, S0, 1
9D020D40  02602021   ADDU A0, S3, ZERO
9D020D44  02002821   ADDU A1, S0, ZERO
9D020D48  02403021   ADDU A2, S2, ZERO
9D020D4C  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020D50  02203821   ADDU A3, S1, ZERO
9D020D58  02C08021   ADDU S0, S6, ZERO
9D020D5C  26160001   ADDIU S6, S0, 1
9D020D60  02602021   ADDU A0, S3, ZERO
9D020D64  02002821   ADDU A1, S0, ZERO
9D020D68  02403021   ADDU A2, S2, ZERO
9D020D6C  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020D70  02203821   ADDU A3, S1, ZERO
9D020D78  0B4082D9   J .LVL83, .LBB85
9D020D7C  02C08021   ADDU S0, S6, ZERO
9D020D80  1100FF19   BEQ T0, ZERO, .LVL72, .LBB81
9D020D84  240C0001   ADDIU T4, ZERO, 1
9D020D88  110C0035   BEQ T0, T4, 0x9D020E60
9D020D8C  240D0002   ADDIU T5, ZERO, 2
9D020D90  110D002C   BEQ T0, T5, 0x9D020E44
9D020D94  240E0003   ADDIU T6, ZERO, 3
9D020D98  110E0023   BEQ T0, T6, 0x9D020E28
9D020D9C  240F0004   ADDIU T7, ZERO, 4
9D020DA0  110F001A   BEQ T0, T7, 0x9D020E0C
9D020DA4  24130005   ADDIU S3, ZERO, 5
9D020DA8  11130011   BEQ T0, S3, 0x9D020DF0
9D020DAC  24140006   ADDIU S4, ZERO, 6
209:                 }
210:                 
211:                 /* Draw the outline of a button */
212:                 static void gui_buttonrect(int x_pos, int y_pos, int width, int height, bool down)
213:                 {
214:                    uint8 color1, color2;
215:                 
216:                    if (down)
217:                    {
218:                       color1 = GUI_GRAY;
219:                       color2 = GUI_WHITE;
9D020AD0  240300C4   ADDIU V1, ZERO, 196
220:                    }
221:                    else
222:                    {
223:                       color1 = GUI_WHITE;
224:                       color2 = GUI_GRAY;
225:                    }
226:                 
227:                    gui_hline(x_pos, y_pos, width - 1, color1);
9D020AE8  02A02021   ADDU A0, S5, ZERO
228:                    gui_vline(x_pos, y_pos + 1, height - 2, color1);
9D020AFC  26F00001   ADDIU S0, S7, 1
229:                    gui_hline(x_pos, y_pos + height - 1, width, color2);
9D020B14  8FA70018   LW A3, 24(SP)
230:                    gui_vline(x_pos + width - 1, y_pos, height - 1, color2);
9D020B30  03D55821   ADDU T3, FP, S5
231:                 }
232:                 
233:                 /* Text blitting */
234:                 INLINE void gui_charline(char ch, int x_pos, int y_pos, uint8 color)
235:                 {
236:                    int count = 8;
237:                    while (count--)
238:                    {
239:                       if (ch & (1 << count))
9D020854  04610004   BGEZ V1, .LVL45, .LBE50
9D020858  306A0040   ANDI T2, V1, 64
9D020868  7C0A5C20   SEB T3, T2
9D02086C  11600004   BEQ T3, ZERO, .LVL47, .LBE59
9D020870  306A0020   ANDI T2, V1, 32
9D020880  7C0A5C20   SEB T3, T2
9D020884  11600004   BEQ T3, ZERO, .LVL49, .LBE60
9D020888  306A0010   ANDI T2, V1, 16
9D020898  7C0A5C20   SEB T3, T2
9D02089C  11600004   BEQ T3, ZERO, .LVL51, .LBE61
9D0208A0  306A0008   ANDI T2, V1, 8
9D0208B0  7C0A5C20   SEB T3, T2
9D0208B4  11600004   BEQ T3, ZERO, .LVL53, .LBE62
9D0208B8  306A0004   ANDI T2, V1, 4
9D0208C8  7C0A5C20   SEB T3, T2
9D0208CC  11600004   BEQ T3, ZERO, .LVL55, .LBE63
9D0208D0  306A0002   ANDI T2, V1, 2
9D0208E0  7C0A5C20   SEB T3, T2
9D0208E4  11600004   BEQ T3, ZERO, .LVL57, .LBE64
9D0208E8  30630001   ANDI V1, V1, 1
9D0208F8  50600005   BEQL V1, ZERO, .LVL60, .LBE65, .LBE67
9D0208FC  24C60004   ADDIU A2, A2, 4
240:                          gui_putpixel(x_pos, y_pos, color);
241:                       x_pos++;
9D020830  244F0001   ADDIU T7, V0, 1
9D020834  244E0002   ADDIU T6, V0, 2
9D020838  244D0003   ADDIU T5, V0, 3
9D02083C  244C0004   ADDIU T4, V0, 4
9D020840  24470005   ADDIU A3, V0, 5
9D020844  24450006   ADDIU A1, V0, 6
9D020848  0B408244   J .LVL60, .LBE65, .LBE67
9D02084C  24550007   ADDIU S5, V0, 7
242:                    }
243:                 }
244:                 
245:                 static void gui_putchar(const uint8 *dat, int height, int x_pos, int y_pos, uint8 color)
246:                 {
247:                    while (height--)
9D020910  551FFFCF   BNEL T0, RA, .LVL42, .LBB69
9D020914  25080001   ADDIU T0, T0, 1
248:                       gui_charline(*dat++, x_pos, y_pos++, color);
9D020850  8103FFFF   LB V1, -1(T0)
249:                 }
250:                 
251:                 /* Return length of text in pixels */
252:                 static int gui_textlen(char *str, font_t *font)
253:                 {
254:                    int pixels = 0;
9D020AB8  00009021   ADDU S2, ZERO, ZERO
255:                    int num_chars = strlen(str);
9D0209A0  0F40F2B0   JAL strlen
9D0209A4  8FB00060   LW S0, 96(SP)
256:                 
257:                    while (num_chars--)
9D0209A8  10400043   BEQ V0, ZERO, .LVL73, .LBB82
9D0209AC  8F848030   LW A0, -32720(GP)
9D0209B0  8FA30048   LW V1, 72(SP)
9D0209B4  00621021   ADDU V0, V1, V0
9D0209B8  00032827   NOR A1, ZERO, V1
9D0209BC  00453021   ADDU A2, V0, A1
9D0209C0  30C80007   ANDI T0, A2, 7
9D0209D8  146200E9   BNE V1, V0, .LVL133
9D0209DC  9172FF26   LBU S2, -218(T3)
9D020AA8  1462FFCF   BNE V1, V0, .LVL72, .LBB81
9D020AAC  03289021   ADDU S2, T9, T0
9D020E78  1462FEDB   BNE V1, V0, .LVL72, .LBB81
9D020E7C  02539021   ADDU S2, S2, S3
258:                       pixels += font->character[(*str++ - 32)].spacing;
9D0209C4  24630001   ADDIU V1, V1, 1
9D0209C8  8069FFFF   LB T1, -1(V1)
9D0209CC  000938C0   SLL A3, T1, 3
9D0209D0  00E95023   SUBU T2, A3, T1
9D0209D4  008A5821   ADDU T3, A0, T2
9D0209E8  80740000   LB S4, 0(V1)
9D0209EC  0014B0C0   SLL S6, S4, 3
9D0209F0  02D4C023   SUBU T8, S6, S4
9D0209F4  0098C821   ADDU T9, A0, T8
9D0209F8  933EFF26   LBU FP, -218(T9)
9D0209FC  025EF821   ADDU RA, S2, FP
9D020A00  80650001   LB A1, 1(V1)
9D020A04  000530C0   SLL A2, A1, 3
9D020A08  00C54023   SUBU T0, A2, A1
9D020A0C  00884821   ADDU T1, A0, T0
9D020A10  9127FF26   LBU A3, -218(T1)
9D020A14  03E75021   ADDU T2, RA, A3
9D020A18  806B0002   LB T3, 2(V1)
9D020A1C  000B60C0   SLL T4, T3, 3
9D020A20  018B6823   SUBU T5, T4, T3
9D020A24  008D7021   ADDU T6, A0, T5
9D020A28  91CFFF26   LBU T7, -218(T6)
9D020A2C  014F9821   ADDU S3, T2, T7
9D020A30  80720003   LB S2, 3(V1)
9D020A34  0012A0C0   SLL S4, S2, 3
9D020A38  0292B023   SUBU S6, S4, S2
9D020A3C  0096C021   ADDU T8, A0, S6
9D020A40  9319FF26   LBU T9, -218(T8)
9D020A44  0279F021   ADDU FP, S3, T9
9D020A48  807F0004   LB RA, 4(V1)
9D020A4C  001F28C0   SLL A1, RA, 3
9D020A50  00BF3023   SUBU A2, A1, RA
9D020A54  00864021   ADDU T0, A0, A2
9D020A58  9109FF26   LBU T1, -218(T0)
9D020A5C  03C93821   ADDU A3, FP, T1
9D020A60  806A0005   LB T2, 5(V1)
9D020A64  000A58C0   SLL T3, T2, 3
9D020A68  016A6023   SUBU T4, T3, T2
9D020A6C  008C6821   ADDU T5, A0, T4
9D020A70  91AEFF26   LBU T6, -218(T5)
9D020A74  00EE7821   ADDU T7, A3, T6
9D020A78  80730006   LB S3, 6(V1)
9D020A7C  001390C0   SLL S2, S3, 3
9D020A80  0253A023   SUBU S4, S2, S3
9D020A84  0094B021   ADDU S6, A0, S4
9D020A88  92D8FF26   LBU T8, -218(S6)
9D020A8C  01F8C821   ADDU T9, T7, T8
9D020A90  24630008   ADDIU V1, V1, 8
9D020A94  807EFFFF   LB FP, -1(V1)
9D020A98  001EF8C0   SLL RA, FP, 3
9D020A9C  03FE2823   SUBU A1, RA, FP
9D020AA0  00853021   ADDU A2, A0, A1
9D020AA4  90C8FF26   LBU T0, -218(A2)
9D020DB0  51140009   BEQL T0, S4, 0x9D020DD8
9D020DB4  80650000   LB A1, 0(V1)
9D020DB8  80760000   LB S6, 0(V1)
9D020DBC  24630001   ADDIU V1, V1, 1
9D020DC0  0016C0C0   SLL T8, S6, 3
9D020DC4  0316C823   SUBU T9, T8, S6
9D020DC8  0099F021   ADDU FP, A0, T9
9D020DCC  93DFFF26   LBU RA, -218(FP)
9D020DD0  025F9021   ADDU S2, S2, RA
9D020DD4  80650000   LB A1, 0(V1)
9D020DD8  24630001   ADDIU V1, V1, 1
9D020DDC  000530C0   SLL A2, A1, 3
9D020DE0  00C54023   SUBU T0, A2, A1
9D020DE4  00884821   ADDU T1, A0, T0
9D020DE8  9127FF26   LBU A3, -218(T1)
9D020DEC  02479021   ADDU S2, S2, A3
9D020DF0  806A0000   LB T2, 0(V1)
9D020DF4  24630001   ADDIU V1, V1, 1
9D020DF8  000A58C0   SLL T3, T2, 3
9D020DFC  016A6023   SUBU T4, T3, T2
9D020E00  008C6821   ADDU T5, A0, T4
9D020E04  91AEFF26   LBU T6, -218(T5)
9D020E08  024E9021   ADDU S2, S2, T6
9D020E0C  806F0000   LB T7, 0(V1)
9D020E10  24630001   ADDIU V1, V1, 1
9D020E14  000F98C0   SLL S3, T7, 3
9D020E18  026FA023   SUBU S4, S3, T7
9D020E1C  0094B021   ADDU S6, A0, S4
9D020E20  92D8FF26   LBU T8, -218(S6)
9D020E24  02589021   ADDU S2, S2, T8
9D020E28  80790000   LB T9, 0(V1)
9D020E2C  24630001   ADDIU V1, V1, 1
9D020E30  0019F0C0   SLL FP, T9, 3
9D020E34  03D9F823   SUBU RA, FP, T9
9D020E38  009F2821   ADDU A1, A0, RA
9D020E3C  90A6FF26   LBU A2, -218(A1)
9D020E40  02469021   ADDU S2, S2, A2
9D020E44  80680000   LB T0, 0(V1)
9D020E48  24630001   ADDIU V1, V1, 1
9D020E4C  000848C0   SLL T1, T0, 3
9D020E50  01283823   SUBU A3, T1, T0
9D020E54  00875021   ADDU T2, A0, A3
9D020E58  914BFF26   LBU T3, -218(T2)
9D020E5C  024B9021   ADDU S2, S2, T3
9D020E60  24630001   ADDIU V1, V1, 1
9D020E64  806CFFFF   LB T4, -1(V1)
9D020E68  000C68C0   SLL T5, T4, 3
9D020E6C  01AC7023   SUBU T6, T5, T4
9D020E70  008E7821   ADDU T7, A0, T6
9D020E74  91F3FF26   LBU S3, -218(T7)
259:                 
260:                    return pixels;
261:                 }
262:                 
263:                 /* Simple textout() type function */
264:                 static int gui_textout(char *str, int x_pos, int y_pos, font_t *font, uint8 color)
265:                 {
9D0207B4  27BDFFD0   ADDIU SP, SP, -48
9D0207B8  AFBF002C   SW RA, 44(SP)
9D0207BC  AFB50028   SW S5, 40(SP)
9D0207C0  AFB40024   SW S4, 36(SP)
9D0207C4  AFB30020   SW S3, 32(SP)
9D0207C8  AFB2001C   SW S2, 28(SP)
9D0207CC  AFB10018   SW S1, 24(SP)
9D0207D0  AFB00014   SW S0, 20(SP)
9D0207D4  00808821   ADDU S1, A0, ZERO
9D0207D8  00A09821   ADDU S3, A1, ZERO
9D0207DC  00C0A821   ADDU S5, A2, ZERO
9D0207E0  00E09021   ADDU S2, A3, ZERO
266:                    int x_new;
267:                    int num_chars = strlen(str);
9D0207E4  0F40F2B0   JAL strlen
9D0207E8  93B00040   LBU S0, 64(SP)
268:                    int code;
269:                 
270:                    x_new = x_pos;
9D0207F4  02601021   ADDU V0, S3, ZERO
9D0207F8  26A30004   ADDIU V1, S5, 4
9D0207FC  00032080   SLL A0, V1, 2
9D020800  8F998094   LW T9, -32620(GP)
9D020804  0324C821   ADDU T9, T9, A0
9D020934  02601021   ADDU V0, S3, ZERO
271:                 
272:                    while (num_chars--)
9D0207EC  10400051   BEQ V0, ZERO, .LVL62
9D0207F0  0222A021   ADDU S4, S1, V0
9D020924  1634FFB8   BNE S1, S4, .LVL33
9D020928  004B1021   ADDU V0, V0, T3
9D02092C  0B40824F   J .LVL64
9D020930  00531023   SUBU V0, V0, S3
273:                    {
274:                       /* Turn ASCII code into letter */
275:                       code = *str++;
9D020808  26310001   ADDIU S1, S1, 1
9D02080C  8225FFFF   LB A1, -1(S1)
276:                       if (code > 0x7F)
277:                          code = 0x7F;
278:                       code -= 32; /* normalize */
9D020810  24A6FFE0   ADDIU A2, A1, -32
279:                       gui_putchar(font->character[code].lines, font->height, x_new, y_pos, color);
9D020814  0006C0C0   SLL T8, A2, 3
9D020818  0306C023   SUBU T8, T8, A2
9D02081C  8E480000   LW T0, 0(S2)
9D020820  01184021   ADDU T0, T0, T8
9D020824  27260004   ADDIU A2, T9, 4
9D020828  92470004   LBU A3, 4(S2)
9D02082C  0107F821   ADDU RA, T0, A3
280:                       x_new += font->character[code].spacing;
9D020918  8E490000   LW T1, 0(S2)
9D02091C  01385021   ADDU T2, T1, T8
9D020920  914B0006   LBU T3, 6(T2)
281:                    }
282:                 
283:                    /* Return the length in pixels */
284:                    return (x_new - x_pos);
285:                 }
9D020938  00531023   SUBU V0, V0, S3
9D02093C  8FBF002C   LW RA, 44(SP)
9D020940  8FB50028   LW S5, 40(SP)
9D020944  8FB40024   LW S4, 36(SP)
9D020948  8FB30020   LW S3, 32(SP)
9D02094C  8FB2001C   LW S2, 28(SP)
9D020950  8FB10018   LW S1, 24(SP)
9D020954  8FB00014   LW S0, 20(SP)
9D020958  03E00008   JR RA
9D02095C  27BD0030   ADDIU SP, SP, 48
286:                 
287:                 /* Draw bar-/button-type text */
288:                 static int gui_textbar(char *str, int x_pos, int y_pos, font_t *font,
289:                                        uint8 color, uint8 bgcolor, bool buttonstate)
290:                 {
9D020960  27BDFFB8   ADDIU SP, SP, -72
9D020964  AFBF0044   SW RA, 68(SP)
9D020968  AFBE0040   SW FP, 64(SP)
9D02096C  AFB7003C   SW S7, 60(SP)
9D020970  AFB60038   SW S6, 56(SP)
9D020974  AFB50034   SW S5, 52(SP)
9D020978  AFB40030   SW S4, 48(SP)
9D02097C  AFB3002C   SW S3, 44(SP)
9D020980  AFB20028   SW S2, 40(SP)
9D020984  AFB10024   SW S1, 36(SP)
9D020988  AFB00020   SW S0, 32(SP)
9D02098C  AFA40048   SW A0, 72(SP)
9D020990  00A0A821   ADDU S5, A1, ZERO
9D020994  00C0B821   ADDU S7, A2, ZERO
9D020998  AFA70054   SW A3, 84(SP)
9D02099C  93B1005C   LBU S1, 92(SP)
291:                    int width = gui_textlen(str, &small);
292:                 
293:                    /* Fill the 'button' */
294:                    gui_buttonrect(x_pos, y_pos, width + 3, font->height + 3, buttonstate);
9D0209E0  0B4082B0   J 0x9D020AC0
9D0209E4  265E0003   ADDIU FP, S2, 3
9D020AB0  0B4082B0   J 0x9D020AC0
9D020AB4  265E0003   ADDIU FP, S2, 3
9D020ABC  265E0003   ADDIU FP, S2, 3
9D020AC0  8FA40054   LW A0, 84(SP)
9D020AC4  90960004   LBU S6, 4(A0)
9D020AC8  26C20003   ADDIU V0, S6, 3
9D020ACC  AFA20018   SW V0, 24(SP)
9D020E80  0B4082B0   J 0x9D020AC0
9D020E84  265E0003   ADDIU FP, S2, 3
295:                    gui_rectfill(x_pos + 1, y_pos + 1, width + 1, font->height + 1, bgcolor);
9D020B48  26B30001   ADDIU S3, S5, 1
9D020B4C  26520001   ADDIU S2, S2, 1
9D020B50  8FAC0054   LW T4, 84(SP)
9D020B54  91940004   LBU S4, 4(T4)
9D020B58  32960007   ANDI S6, S4, 7
9D020B5C  16C00042   BNE S6, ZERO, .LVL106, .LBB89
9D020B60  241EFFFF   ADDIU FP, ZERO, -1
296:                 
297:                    /* Print the text */
298:                    return gui_textout(str, x_pos + 2, y_pos + 2, font, color);
9D020C1C  93B10058   LBU S1, 88(SP)
9D020C20  AFB10010   SW S1, 16(SP)
9D020C24  8FA40048   LW A0, 72(SP)
9D020C28  26A50002   ADDIU A1, S5, 2
9D020C2C  26E60002   ADDIU A2, S7, 2
9D020C30  0F4081ED   JAL .LFB20, gui_textout, .LVL31, .LFE13
9D020C34  8FA70054   LW A3, 84(SP)
299:                 }
9D020C38  8FBF0044   LW RA, 68(SP)
9D020C3C  8FBE0040   LW FP, 64(SP)
9D020C40  8FB7003C   LW S7, 60(SP)
9D020C44  8FB60038   LW S6, 56(SP)
9D020C48  8FB50034   LW S5, 52(SP)
9D020C4C  8FB40030   LW S4, 48(SP)
9D020C50  8FB3002C   LW S3, 44(SP)
9D020C54  8FB20028   LW S2, 40(SP)
9D020C58  8FB10024   LW S1, 36(SP)
9D020C5C  8FB00020   LW S0, 32(SP)
9D020C60  03E00008   JR RA
9D020C64  27BD0048   ADDIU SP, SP, 72
9D020C68  260D0001   ADDIU T5, S0, 1
9D020C6C  AFAD0018   SW T5, 24(SP)
9D020C70  02602021   ADDU A0, S3, ZERO
9D020C74  02002821   ADDU A1, S0, ZERO
9D020C78  02403021   ADDU A2, S2, ZERO
9D020C7C  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020C80  02203821   ADDU A3, S1, ZERO
9D020C84  2694FFFF   ADDIU S4, S4, -1
9D020C88  240E0001   ADDIU T6, ZERO, 1
9D020C8C  12CEFFB5   BEQ S6, T6, .LVL83, .LBB85
9D020C90  8FB00018   LW S0, 24(SP)
9D020C94  240F0002   ADDIU T7, ZERO, 2
9D020C98  12CF0030   BEQ S6, T7, .LVL129
9D020C9C  24180003   ADDIU T8, ZERO, 3
9D020CA0  12D80026   BEQ S6, T8, .LVL125
9D020CA4  24190004   ADDIU T9, ZERO, 4
9D020CA8  12D9001C   BEQ S6, T9, .LVL121
9D020CAC  241F0005   ADDIU RA, ZERO, 5
9D020CB0  12DF0012   BEQ S6, RA, .LVL117
9D020CB4  24050006   ADDIU A1, ZERO, 6
9D020CB8  12C50009   BEQ S6, A1, .LVL114
9D020CBC  26160001   ADDIU S6, S0, 1
9D020CC0  02602021   ADDU A0, S3, ZERO
9D020CC4  02002821   ADDU A1, S0, ZERO
9D020CC8  02403021   ADDU A2, S2, ZERO
9D020CCC  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020CD0  02203821   ADDU A3, S1, ZERO
9D020CD4  2694FFFF   ADDIU S4, S4, -1
9D020CD8  02C08021   ADDU S0, S6, ZERO
9D020CDC  26160001   ADDIU S6, S0, 1
9D020CE0  02602021   ADDU A0, S3, ZERO
9D020CE4  02002821   ADDU A1, S0, ZERO
9D020CE8  02403021   ADDU A2, S2, ZERO
9D020CEC  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020CF0  02203821   ADDU A3, S1, ZERO
9D020CF4  2694FFFF   ADDIU S4, S4, -1
9D020CF8  02C08021   ADDU S0, S6, ZERO
9D020CFC  26160001   ADDIU S6, S0, 1
9D020D00  02602021   ADDU A0, S3, ZERO
9D020D04  02002821   ADDU A1, S0, ZERO
9D020D08  02403021   ADDU A2, S2, ZERO
9D020D0C  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020D10  02203821   ADDU A3, S1, ZERO
9D020D14  2694FFFF   ADDIU S4, S4, -1
9D020D18  02C08021   ADDU S0, S6, ZERO
9D020D1C  26160001   ADDIU S6, S0, 1
9D020D20  02602021   ADDU A0, S3, ZERO
9D020D24  02002821   ADDU A1, S0, ZERO
9D020D28  02403021   ADDU A2, S2, ZERO
9D020D2C  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020D30  02203821   ADDU A3, S1, ZERO
9D020D34  2694FFFF   ADDIU S4, S4, -1
9D020D38  02C08021   ADDU S0, S6, ZERO
9D020D3C  26160001   ADDIU S6, S0, 1
9D020D40  02602021   ADDU A0, S3, ZERO
9D020D44  02002821   ADDU A1, S0, ZERO
9D020D48  02403021   ADDU A2, S2, ZERO
9D020D4C  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020D50  02203821   ADDU A3, S1, ZERO
9D020D54  2694FFFF   ADDIU S4, S4, -1
9D020D58  02C08021   ADDU S0, S6, ZERO
9D020D5C  26160001   ADDIU S6, S0, 1
9D020D60  02602021   ADDU A0, S3, ZERO
9D020D64  02002821   ADDU A1, S0, ZERO
9D020D68  02403021   ADDU A2, S2, ZERO
9D020D6C  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020D70  02203821   ADDU A3, S1, ZERO
9D020D74  2694FFFF   ADDIU S4, S4, -1
9D020D78  0B4082D9   J .LVL83, .LBB85
9D020D7C  02C08021   ADDU S0, S6, ZERO
9D020D80  1100FF19   BEQ T0, ZERO, .LVL72, .LBB81
9D020D84  240C0001   ADDIU T4, ZERO, 1
9D020D88  110C0035   BEQ T0, T4, 0x9D020E60
9D020D8C  240D0002   ADDIU T5, ZERO, 2
9D020D90  110D002C   BEQ T0, T5, 0x9D020E44
9D020D94  240E0003   ADDIU T6, ZERO, 3
9D020D98  110E0023   BEQ T0, T6, 0x9D020E28
9D020D9C  240F0004   ADDIU T7, ZERO, 4
9D020DA0  110F001A   BEQ T0, T7, 0x9D020E0C
9D020DA4  24130005   ADDIU S3, ZERO, 5
9D020DA8  11130011   BEQ T0, S3, 0x9D020DF0
9D020DAC  24140006   ADDIU S4, ZERO, 6
9D020DB0  51140009   BEQL T0, S4, 0x9D020DD8
9D020DB4  80650000   LB A1, 0(V1)
9D020DB8  80760000   LB S6, 0(V1)
9D020DBC  24630001   ADDIU V1, V1, 1
9D020DC0  0016C0C0   SLL T8, S6, 3
9D020DC4  0316C823   SUBU T9, T8, S6
9D020DC8  0099F021   ADDU FP, A0, T9
9D020DCC  93DFFF26   LBU RA, -218(FP)
9D020DD0  025F9021   ADDU S2, S2, RA
9D020DD4  80650000   LB A1, 0(V1)
9D020DD8  24630001   ADDIU V1, V1, 1
9D020DDC  000530C0   SLL A2, A1, 3
9D020DE0  00C54023   SUBU T0, A2, A1
9D020DE4  00884821   ADDU T1, A0, T0
9D020DE8  9127FF26   LBU A3, -218(T1)
9D020DEC  02479021   ADDU S2, S2, A3
9D020DF0  806A0000   LB T2, 0(V1)
9D020DF4  24630001   ADDIU V1, V1, 1
9D020DF8  000A58C0   SLL T3, T2, 3
9D020DFC  016A6023   SUBU T4, T3, T2
9D020E00  008C6821   ADDU T5, A0, T4
9D020E04  91AEFF26   LBU T6, -218(T5)
9D020E08  024E9021   ADDU S2, S2, T6
9D020E0C  806F0000   LB T7, 0(V1)
9D020E10  24630001   ADDIU V1, V1, 1
9D020E14  000F98C0   SLL S3, T7, 3
9D020E18  026FA023   SUBU S4, S3, T7
9D020E1C  0094B021   ADDU S6, A0, S4
9D020E20  92D8FF26   LBU T8, -218(S6)
9D020E24  02589021   ADDU S2, S2, T8
9D020E28  80790000   LB T9, 0(V1)
9D020E2C  24630001   ADDIU V1, V1, 1
9D020E30  0019F0C0   SLL FP, T9, 3
9D020E34  03D9F823   SUBU RA, FP, T9
9D020E38  009F2821   ADDU A1, A0, RA
9D020E3C  90A6FF26   LBU A2, -218(A1)
9D020E40  02469021   ADDU S2, S2, A2
9D020E44  80680000   LB T0, 0(V1)
9D020E48  24630001   ADDIU V1, V1, 1
9D020E4C  000848C0   SLL T1, T0, 3
9D020E50  01283823   SUBU A3, T1, T0
9D020E54  00875021   ADDU T2, A0, A3
9D020E58  914BFF26   LBU T3, -218(T2)
9D020E5C  024B9021   ADDU S2, S2, T3
9D020E60  24630001   ADDIU V1, V1, 1
9D020E64  806CFFFF   LB T4, -1(V1)
9D020E68  000C68C0   SLL T5, T4, 3
9D020E6C  01AC7023   SUBU T6, T5, T4
9D020E70  008E7821   ADDU T7, A0, T6
9D020E74  91F3FF26   LBU S3, -218(T7)
9D020E78  1462FEDB   BNE V1, V0, .LVL72, .LBB81
9D020E7C  02539021   ADDU S2, S2, S3
9D020E80  0B4082B0   J 0x9D020AC0
9D020E84  265E0003   ADDIU FP, S2, 3
300:                 
301:                 /* Draw the mouse pointer */
302:                 static void gui_drawmouse(void)
303:                 {
304:                    int ythresh, xthresh;
305:                    int i, j, color;
306:                 
307:                    ythresh = gui_surface->height - mouse_y - 1;
9D021698  8F898094   LW T1, -32620(GP)
9D02169C  8D280004   LW T0, 4(T1)
9D0216A0  2506FFFF   ADDIU A2, T0, -1
9D0216A4  3C0A9D03   LUI T2, -25341
9D0216A8  254277AA   ADDIU V0, T2, 30634
9D0216AC  01202021   ADDU A0, T1, ZERO
9D0216B0  3C0B9D03   LUI T3, -25341
9D0216B4  256C787B   ADDIU T4, T3, 30843
308:                    for (j = 0; j < CURSOR_HEIGHT; j++)
9D0218B0  144CFF83   BNE V0, T4, .LVL240
9D0218B4  24840004   ADDIU A0, A0, 4
309:                    {
310:                       if (ythresh < 0)
9D0216C0  04C2007B   BLTZL A2, .LBE153
9D0216C4  2442000B   ADDIU V0, V0, 11
311:                          continue;
312:                 
313:                       xthresh = gui_surface->width - mouse_x - 1;
9D0216C8  8D2E0000   LW T6, 0(T1)
9D0216CC  25CFFFFF   ADDIU T7, T6, -1
314:                       for (i = 0; i < CURSOR_WIDTH; i++)
315:                       {
316:                          if (xthresh < 0)
9D0216D0  05E20076   BLTZL T7, .LVL285
9D0216D4  24C6FFFF   ADDIU A2, A2, -1
9D0216E8  04A30007   BGEZL A1, .LVL247, .LBB175
9D0216EC  9050FFF7   LBU S0, -9(V0)
9D021714  05630007   BGEZL T3, .LVL251, .LBB177
9D021718  904DFFF8   LBU T5, -8(V0)
9D021740  07E30007   BGEZL RA, .LVL255, .LBB179
9D021744  9043FFF9   LBU V1, -7(V0)
9D02176C  04E30007   BGEZL A3, .LVL259, .LBB181
9D021770  904BFFFA   LBU T3, -6(V0)
9D021798  07030007   BGEZL T8, .LVL263, .LBB183
9D02179C  9059FFFB   LBU T9, -5(V0)
9D0217C4  06030007   BGEZL S0, .LVL267, .LBB185
9D0217C8  9048FFFC   LBU T0, -4(V0)
9D0217F0  05A30007   BGEZL T5, .LVL271, .LBB187
9D0217F4  904FFFFD   LBU T7, -3(V0)
9D02181C  04630007   BGEZL V1, .LVL275, .LBB189
9D021820  9045FFFE   LBU A1, -2(V0)
9D021848  04E30007   BGEZL A3, .LVL279, .LBB191
9D02184C  904DFFFF   LBU T5, -1(V0)
9D021874  05C30007   BGEZL T6, .LVL283, .LBB193
9D021878  90590000   LBU T9, 0(V0)
317:                             continue;
318:                 
319:                          color = cursor[(j * CURSOR_WIDTH) + i];
9D0216D8  9058FFF6   LBU T8, -10(V0)
320:                 
321:                          if (color)
9D0216DC  57000006   BNEL T8, ZERO, .LVL246, .LBB174
9D0216E0  8C990014   LW T9, 20(A0)
9D021708  56000006   BNEL S0, ZERO, .LVL250, .LBB176
9D02170C  8C880014   LW T0, 20(A0)
9D021734  55A00006   BNEL T5, ZERO, .LVL254, .LBB178
9D021738  8C8F0014   LW T7, 20(A0)
9D021760  54600006   BNEL V1, ZERO, .LVL258, .LBB180
9D021764  8C850014   LW A1, 20(A0)
9D02178C  55600006   BNEL T3, ZERO, .LVL262, .LBB182
9D021790  8C8A0014   LW T2, 20(A0)
9D0217B8  57200006   BNEL T9, ZERO, .LVL266, .LBB184
9D0217BC  8C9F0014   LW RA, 20(A0)
9D0217E4  55000006   BNEL T0, ZERO, .LVL270, .LBB186
9D0217E8  8C8B0014   LW T3, 20(A0)
9D021810  55E00006   BNEL T7, ZERO, .LVL274, .LBB188
9D021814  8C980014   LW T8, 20(A0)
9D02183C  54A00006   BNEL A1, ZERO, .LVL278, .LBB190
9D021840  8C900014   LW S0, 20(A0)
9D021868  55A00006   BNEL T5, ZERO, .LVL282, .LBB192
9D02186C  8C8A0014   LW T2, 20(A0)
9D021894  13200005   BEQ T9, ZERO, .LVL285
9D021898  24C6FFFF   ADDIU A2, A2, -1
322:                             gui_putpixel(mouse_x + i, mouse_y + j, cursor_color[color]);
9D0216B8  3C0D9D03   LUI T5, -25341
9D0216BC  25B17874   ADDIU S1, T5, 30836
9D0216F8  0311F821   ADDU RA, T8, S1
9D021724  02113821   ADDU A3, S0, S1
9D021750  01B1C021   ADDU T8, T5, S1
9D02177C  00718021   ADDU S0, V1, S1
9D0217A8  01716821   ADDU T5, T3, S1
9D0217D4  03311821   ADDU V1, T9, S1
9D021800  01113821   ADDU A3, T0, S1
9D02182C  01F1C821   ADDU T9, T7, S1
9D021858  00B14021   ADDU T0, A1, S1
9D021884  01B17821   ADDU T7, T5, S1
9D0218A0  03311821   ADDU V1, T9, S1
323:                          xthresh--;
9D0216E4  25C5FFFE   ADDIU A1, T6, -2
9D021710  25CBFFFD   ADDIU T3, T6, -3
9D02173C  25DFFFFC   ADDIU RA, T6, -4
9D021768  25C7FFFB   ADDIU A3, T6, -5
9D021794  25D8FFFA   ADDIU T8, T6, -6
9D0217C0  25D0FFF9   ADDIU S0, T6, -7
9D0217EC  25CDFFF8   ADDIU T5, T6, -8
9D021818  25C3FFF7   ADDIU V1, T6, -9
9D021844  25C7FFF6   ADDIU A3, T6, -10
9D021870  25CEFFF5   ADDIU T6, T6, -11
324:                       }
325:                       ythresh--;
9D0216F0  0B40862B   J .LVL285
9D0216F4  24C6FFFF   ADDIU A2, A2, -1
9D02171C  0B40862B   J .LVL285
9D021720  24C6FFFF   ADDIU A2, A2, -1
9D021748  0B40862B   J .LVL285
9D02174C  24C6FFFF   ADDIU A2, A2, -1
9D021774  0B40862B   J .LVL285
9D021778  24C6FFFF   ADDIU A2, A2, -1
9D0217A0  0B40862B   J .LVL285
9D0217A4  24C6FFFF   ADDIU A2, A2, -1
9D0217CC  0B40862B   J .LVL285
9D0217D0  24C6FFFF   ADDIU A2, A2, -1
9D0217F8  0B40862B   J .LVL285
9D0217FC  24C6FFFF   ADDIU A2, A2, -1
9D021824  0B40862B   J .LVL285
9D021828  24C6FFFF   ADDIU A2, A2, -1
9D021850  0B40862B   J .LVL285
9D021854  24C6FFFF   ADDIU A2, A2, -1
9D02187C  0B40862B   J .LVL285
9D021880  24C6FFFF   ADDIU A2, A2, -1
326:                    }
327:                 }
328:                 
329:                 void gui_tick(int ticks)
330:                 {
331:                 
332:                    static int fps_counter = 0;
333:                 
334:                    gui_ticks += ticks;
9D021340  8F82809C   LW V0, -32612(GP)
9D021344  00441821   ADDU V1, V0, A0
9D021348  AF83809C   SW V1, -32612(GP)
335:                    fps_counter += ticks;
9D02134C  8F858090   LW A1, -32624(GP)
9D021350  00852021   ADDU A0, A0, A1
9D021354  AF848090   SW A0, -32624(GP)
336:                    
337:                    if (fps_counter >= gui_refresh)
9D021358  8F86801C   LW A2, -32740(GP)
9D02135C  0086382A   SLT A3, A0, A2
9D021360  14E00004   BNE A3, ZERO, 0x9D021374
9D021364  00864023   SUBU T0, A0, A2
338:                    {
339:                       fps_counter -= gui_refresh;
9D021368  AF888090   SW T0, -32624(GP)
340:                       gui_fpsupdate = true;
9D02136C  24090001   ADDIU T1, ZERO, 1
9D021370  AF8980A0   SW T1, -32608(GP)
9D021374  03E00008   JR RA
9D021378  00000000   NOP
341:                    }
342:                 }
343:                 
344:                 /* updated in sync with the timer interrupt */
345:                 static void gui_tickdec(void)
346:                 {
347:                 #ifdef NOFRENDO_DEBUG
348:                    static int hertz_ticks = 0;
349:                 #endif
350:                    int ticks = gui_ticks;
9D021460  8F84809C   LW A0, -32612(GP)
351:                 
352:                    if (0 == ticks)
9D021464  1080000B   BEQ A0, ZERO, .LBE119
9D021468  3C05A001   LUI A1, -24575
353:                       return;
354:                 
355:                    gui_ticks = 0;
9D02146C  AF80809C   SW ZERO, -32612(GP)
356:                 
357:                 #ifdef NOFRENDO_DEBUG
358:                    /* Check for corrupt memory block every 10 seconds */
359:                    hertz_ticks += ticks;
360:                    if (hertz_ticks >= (10 * gui_refresh))
361:                    {
362:                       hertz_ticks -= (10 * gui_refresh);
363:                       mem_checkblocks(); 
364:                    }
365:                 #endif
366:                 
367:                    /* TODO: bleh */
368:                    if (msg.ttl > 0)
9D021470  8CA64664   LW A2, 18020(A1)
9D021474  18C00007   BLEZ A2, .LBE119
9D021478  00C43823   SUBU A3, A2, A0
369:                    {
370:                       msg.ttl -= ticks;
9D021484  0B408525   J .LBE119
9D021488  AD074664   SW A3, 18020(T0)
371:                       if (msg.ttl < 0)
9D02147C  04E00003   BLTZ A3, .LBB119
9D021480  3C08A001   LUI T0, -24575
372:                          msg.ttl = 0;
9D02148C  3C09A001   LUI T1, -24575
9D021490  AD204664   SW ZERO, 18020(T1)
373:                    }
374:                 }
375:                 
376:                 /* Update the FPS display */
377:                 static void gui_updatefps(void)
378:                 {
379:                    static char fpsbuf[20];
380:                 
381:                    /* Check to see if we need to do an sprintf or not */
382:                    if (true == gui_fpsupdate)
9D0214A0  240B0001   ADDIU T3, ZERO, 1
383:                    {
384:                       sprintf(fpsbuf, "%4d FPS /%4d%%", gui_fps, (gui_fps * 100) / gui_refresh);
9D0214B0  8F868098   LW A2, -32616(GP)
385:                       gui_fps = 0;
9D0214EC  AF808098   SW ZERO, -32616(GP)
386:                       gui_fpsupdate = false;
9D0214F0  AF8080A0   SW ZERO, -32608(GP)
387:                    }
388:                 
389:                    gui_textout(fpsbuf, gui_surface->width - 1 - 90, 1, &small, GUI_GREEN);
9D0214F4  8F828094   LW V0, -32620(GP)
390:                 }
391:                 
392:                 /* Turn FPS on/off */
393:                 void gui_togglefps(void)
394:                 {
395:                    option_showfps ^= true;
9D02137C  8F8280B8   LW V0, -32584(GP)
9D021380  38430001   XORI V1, V0, 1
9D021384  03E00008   JR RA
9D021388  AF8380B8   SW V1, -32584(GP)
396:                 }
397:                 
398:                 /* Turn GUI on/off */
399:                 void gui_togglegui(void)
400:                 {
401:                    option_showgui ^= true;
9D02138C  8F8280B4   LW V0, -32588(GP)
9D021390  38430001   XORI V1, V0, 1
9D021394  03E00008   JR RA
9D021398  AF8380B4   SW V1, -32588(GP)
402:                 }
403:                 
404:                 void gui_togglewave(void)
405:                 {
406:                    option_wavetype = (option_wavetype + 1) % GUI_NUMWAVESTYLES;
9D02139C  8F8280B0   LW V0, -32592(GP)
9D0213A0  24450001   ADDIU A1, V0, 1
9D0213A4  3C035555   LUI V1, 21845
9D0213A8  24645556   ADDIU A0, V1, 21846
9D0213AC  00A40018   MULT 0, A1, A0
9D0213B0  00003010   MFHI A2
9D0213B4  00053FC3   SRA A3, A1, 31
9D0213B8  00C74023   SUBU T0, A2, A3
9D0213BC  00084840   SLL T1, T0, 1
9D0213C0  01285021   ADDU T2, T1, T0
9D0213C4  00AA5823   SUBU T3, A1, T2
9D0213C8  03E00008   JR RA
9D0213CC  AF8B80B0   SW T3, -32592(GP)
407:                 }
408:                 
409:                 void gui_toggleoam(void)
410:                 {
411:                    option_showoam ^= true;
9D0213D0  8F8280A8   LW V0, -32600(GP)
9D0213D4  38430001   XORI V1, V0, 1
9D0213D8  03E00008   JR RA
9D0213DC  AF8380A8   SW V1, -32600(GP)
412:                 }
413:                 
414:                 /* TODO: hack! */
415:                 void gui_togglepattern(void)
416:                 {
417:                    option_showpattern ^= true;
9D0213E0  8F8280AC   LW V0, -32596(GP)
9D0213E4  38430001   XORI V1, V0, 1
9D0213E8  03E00008   JR RA
9D0213EC  AF8380AC   SW V1, -32596(GP)
418:                 }
419:                 
420:                 /* TODO: hack! */
421:                 void gui_decpatterncol(void)
422:                 {
423:                    if (pattern_col && option_showpattern)
9D0213F0  8F8280A4   LW V0, -32604(GP)
9D0213F4  10400004   BEQ V0, ZERO, 0x9D021408
9D0213F8  8F8380AC   LW V1, -32596(GP)
9D0213FC  10600002   BEQ V1, ZERO, 0x9D021408
9D021400  2444FFFF   ADDIU A0, V0, -1
424:                       pattern_col--;
9D021404  AF8480A4   SW A0, -32604(GP)
9D021408  03E00008   JR RA
9D02140C  00000000   NOP
425:                 }
426:                 
427:                 /* TODO: hack! */
428:                 void gui_incpatterncol(void)
429:                 {
430:                    if ((pattern_col < 7) && option_showpattern)
9D021410  8F8280A4   LW V0, -32604(GP)
9D021414  28430007   SLTI V1, V0, 7
9D021418  10600004   BEQ V1, ZERO, 0x9D02142C
9D02141C  8F8480AC   LW A0, -32596(GP)
9D021420  10800002   BEQ A0, ZERO, 0x9D02142C
9D021424  24450001   ADDIU A1, V0, 1
431:                       pattern_col++;
9D021428  AF8580A4   SW A1, -32604(GP)
9D02142C  03E00008   JR RA
9D021430  00000000   NOP
432:                 }
433:                 
434:                 /* Downward-scrolling message display */
435:                 static void gui_updatemsg(void)
436:                 {
437:                    if (msg.ttl)
9D021648  8F3F4664   LW RA, 18020(T9)
438:                       gui_textbar(msg.text, 2, gui_surface->height - 10, &small, msg.color, GUI_DKGRAY, BUTTON_UP);
9D021654  8F828094   LW V0, -32620(GP)
9D021658  8C430004   LW V1, 4(V0)
9D02165C  3C04A001   LUI A0, -24575
9D021660  90854768   LBU A1, 18280(A0)
9D021664  AFA50010   SW A1, 16(SP)
9D021668  240600C1   ADDIU A2, ZERO, 193
9D02166C  AFA60014   SW A2, 20(SP)
9D021670  AFA00018   SW ZERO, 24(SP)
9D021674  3C10A001   LUI S0, -24575
9D021678  26044668   ADDIU A0, S0, 18024
9D02167C  24050002   ADDIU A1, ZERO, 2
9D021680  2466FFF6   ADDIU A2, V1, -10
9D021684  0F408258   JAL .LFB21, gui_textbar, .LVL69, .LFE20
9D021688  27878030   ADDIU A3, GP, -32720
439:                 }
440:                 
441:                 /* Little thing to display the waveform */
442:                 static void gui_updatewave(int wave_type)
443:                 {
9D020E88  27BDFE48   ADDIU SP, SP, -440
9D020E8C  AFBF01B4   SW RA, 436(SP)
9D020E90  AFBE01B0   SW FP, 432(SP)
9D020E94  AFB701AC   SW S7, 428(SP)
9D020E98  AFB601A8   SW S6, 424(SP)
9D020E9C  AFB501A4   SW S5, 420(SP)
9D020EA0  AFB401A0   SW S4, 416(SP)
9D020EA4  AFB3019C   SW S3, 412(SP)
9D020EA8  AFB20198   SW S2, 408(SP)
9D020EAC  AFB10194   SW S1, 404(SP)
9D020EB0  AFB00190   SW S0, 400(SP)
9D020EB4  00808021   ADDU S0, A0, ZERO
444:                 #define  WAVEDISP_WIDTH   128
445:                    int loop, xofs, yofs;
446:                    int difference, offset;
447:                    float scale;
448:                    uint8 val, oldval;
449:                    int vis_length = 0;
450:                    void *vis_buffer = NULL;
451:                    int vis_bps;
452:                    apu_t apu;
453:                 
454:                    apu_getcontext(&apu);
9D020EB8  0F407DCC   JAL apu_getcontext
9D020EBC  27A40020   ADDIU A0, SP, 32
455:                    vis_buffer = apu.buffer;
9D020EC0  8FB20158   LW S2, 344(SP)
456:                    vis_length = apu.num_samples;
457:                    vis_bps = apu.sample_bits;
9D020EC4  8FB30174   LW S3, 372(SP)
458:                 
459:                    xofs = (NES_SCREEN_WIDTH - WAVEDISP_WIDTH);
460:                    yofs = 1;
461:                    scale = (float) (vis_length / (float) WAVEDISP_WIDTH);
9D020EC8  0F4105E3   JAL sitofp
9D020ECC  8FA4015C   LW A0, 348(SP)
9D020ED0  00402021   ADDU A0, V0, ZERO
9D020ED4  3C029D04   LUI V0, -25340
9D020ED8  0F40EEB0   JAL __mulsf3
9D020EDC  8C45F108   LW A1, -3832(V0)
462:                 
463:                    if (NULL == vis_buffer)
9D020EE0  16400013   BNE S2, ZERO, .LVL147
9D020EE4  24030001   ADDIU V1, ZERO, 1
464:                    {
465:                       /* draw centerline */
466:                       gui_hline(xofs, yofs + 0x20, WAVEDISP_WIDTH, GUI_GRAY);
9D020EE8  24040080   ADDIU A0, ZERO, 128
9D020EEC  24050021   ADDIU A1, ZERO, 33
9D020EF0  24060080   ADDIU A2, ZERO, 128
9D020EF4  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020EF8  240700C2   ADDIU A3, ZERO, 194
467:                       gui_textbar("no sound", xofs + 40, yofs + 0x20 - 4, &small, GUI_RED, GUI_DKGRAY, BUTTON_UP);
9D020EFC  241200C5   ADDIU S2, ZERO, 197
9D020F00  AFB20010   SW S2, 16(SP)
9D020F04  241300C1   ADDIU S3, ZERO, 193
9D020F08  AFB30014   SW S3, 20(SP)
9D020F0C  AFA00018   SW ZERO, 24(SP)
9D020F10  3C149D04   LUI S4, -25340
9D020F14  2684F020   ADDIU A0, S4, -4064
9D020F18  240500A8   ADDIU A1, ZERO, 168
9D020F1C  2406001D   ADDIU A2, ZERO, 29
9D020F20  0F408258   JAL .LFB21, gui_textbar, .LVL69, .LFE20
9D020F24  27878030   ADDIU A3, GP, -32720
9D020F28  0B408451   J .LVL191, .LBB99
9D020F2C  24040080   ADDIU A0, ZERO, 128
468:                 
469:                    }
470:                    else if (GUI_WAVELINE == wave_type)
9D020F30  16030049   BNE S0, V1, .LVL170
9D020F34  0040A021   ADDU S4, V0, ZERO
471:                    {
472:                       /* draw centerline */
473:                       gui_hline(xofs, yofs + 0x20, WAVEDISP_WIDTH, GUI_GRAY);
9D020F38  24040080   ADDIU A0, ZERO, 128
9D020F3C  24050021   ADDIU A1, ZERO, 33
9D020F40  24060080   ADDIU A2, ZERO, 128
9D020F44  0F408130   JAL .LFB12, gui_hline, .LVL0, .Ltext0, .Letext0, .LFE24
9D020F48  240700C2   ADDIU A3, ZERO, 194
474:                 
475:                       /* initial old value */
476:                       if (16 == vis_bps)
9D020F4C  24160010   ADDIU S6, ZERO, 16
9D020F50  56760008   BNEL S3, S6, .LVL150
9D020F54  92550000   LBU S5, 0(S2)
477:                          oldval = 0x40 - (((((uint16 *) vis_buffer)[0] >> 8) ^ 0x80) >> 2);
9D020F58  964C0000   LHU T4, 0(S2)
9D020F5C  398D8000   XORI T5, T4, -32768
9D020F60  000D7282   SRL T6, T5, 10
9D020F64  240F0040   ADDIU T7, ZERO, 64
9D020F68  01EE8823   SUBU S1, T7, T6
9D020F6C  0B408466   J .LVL196
9D020F70  323000FF   ANDI S0, S1, 255
478:                       else
479:                          oldval = 0x40 - (((uint8 *) vis_buffer)[0] >> 2);
9D020F74  0015F082   SRL FP, S5, 2
9D020F78  24170040   ADDIU S7, ZERO, 64
9D020F7C  02FE5823   SUBU T3, S7, FP
9D020F80  0B408466   J .LVL196
9D020F84  317000FF   ANDI S0, T3, 255
480:                 
481:                       for (loop = 1; loop < WAVEDISP_WIDTH; loop++)
9D021040  26D60001   ADDIU S6, S6, 1
9D021044  240C0080   ADDIU T4, ZERO, 128
9D021048  16CCFFCF   BNE S6, T4, .LVL152
9D02104C  02C08821   ADDU S1, S6, ZERO
9D021050  0B408451   J .LVL191, .LBB99
9D021054  24040080   ADDIU A0, ZERO, 128
9D021274  0B4083E6   J .LVL153
9D021278  26D60001   ADDIU S6, S6, 1
482:                       {
483:                          //val = 0x40 - (vis_buffer[(uint32) (loop * scale)] >> 2);
484:                          if (16 == vis_bps)
9D020F88  16770092   BNE S3, S7, .LVL198
9D020F8C  00000000   NOP
9D020F90  0B408482   J .LVL203
9D020F94  00000000   NOP
9D020F98  16770010   BNE S3, S7, .LVL158
9D020F9C  00000000   NOP
9D02119C  24170010   ADDIU S7, ZERO, 16
485:                             val = 0x40 - (((((uint16 *) vis_buffer)[(uint32) (loop * scale)] >> 8) ^ 0x80) >> 2);
9D020FA0  0F4105E3   JAL sitofp
9D020FA4  02C02021   ADDU A0, S6, ZERO
9D020FA8  00402021   ADDU A0, V0, ZERO
9D020FAC  0F40EEB0   JAL __mulsf3
9D020FB0  02802821   ADDU A1, S4, ZERO
9D020FB4  0F4103BC   JAL fptoui
9D020FB8  00402021   ADDU A0, V0, ZERO
9D020FBC  00022040   SLL A0, V0, 1
9D020FC0  02442821   ADDU A1, S2, A0
9D020FC4  94A60000   LHU A2, 0(A1)
9D020FC8  38C78000   XORI A3, A2, -32768
9D020FCC  00074282   SRL T0, A3, 10
9D020FD0  03C84823   SUBU T1, FP, T0
9D020FD4  0B408403   J .LVL162
9D020FD8  313500FF   ANDI S5, T1, 255
9D021208  0F4105E3   JAL sitofp
9D02120C  02202021   ADDU A0, S1, ZERO
9D021210  00402021   ADDU A0, V0, ZERO
9D021214  0F40EEB0   JAL __mulsf3
9D021218  02802821   ADDU A1, S4, ZERO
9D02121C  0F4103BC   JAL fptoui
9D021220  00402021   ADDU A0, V0, ZERO
9D021224  0002C840   SLL T9, V0, 1
9D021228  02591021   ADDU V0, S2, T9
9D02122C  94430000   LHU V1, 0(V0)
9D021230  38648000   XORI A0, V1, -32768
9D021234  00042A82   SRL A1, A0, 10
9D021238  03C53023   SUBU A2, FP, A1
9D02123C  30D000FF   ANDI S0, A2, 255
486:                          else
487:                             val = 0x40 - (((uint8 *) vis_buffer)[(uint32) (loop * scale)] >> 2);
9D020FDC  0F4105E3   JAL sitofp
9D020FE0  02C02021   ADDU A0, S6, ZERO
9D020FE4  00402021   ADDU A0, V0, ZERO
9D020FE8  0F40EEB0   JAL __mulsf3
9D020FEC  02802821   ADDU A1, S4, ZERO
9D020FF0  0F4103BC   JAL fptoui
9D020FF4  00402021   ADDU A0, V0, ZERO
9D020FF8  0242C021   ADDU T8, S2, V0
9D020FFC  93190000   LBU T9, 0(T8)
9D021000  00191082   SRL V0, T9, 2
9D021004  03C21823   SUBU V1, FP, V0
9D021008  307500FF   ANDI S5, V1, 255
9D0211A0  0B4083E6   J .LVL153
9D0211A4  241E0040   ADDIU FP, ZERO, 64
9D0211D4  0F4105E3   JAL sitofp
9D0211D8  02202021   ADDU A0, S1, ZERO
9D0211DC  00402021   ADDU A0, V0, ZERO
9D0211E0  0F40EEB0   JAL __mulsf3
9D0211E4  02802821   ADDU A1, S4, ZERO
9D0211E8  0F4103BC   JAL fptoui
9D0211EC  00402021   ADDU A0, V0, ZERO
9D0211F0  02426821   ADDU T5, S2, V0
9D0211F4  91AE0000   LBU T6, 0(T5)
9D0211F8  000E7882   SRL T7, T6, 2
9D0211FC  03CFC023   SUBU T8, FP, T7
9D021200  0B408490   J .LVL207
9D021204  331000FF   ANDI S0, T8, 255
488:                          if (oldval < val)
9D02100C  0215F82B   SLTU RA, S0, S5
9D021010  53E00005   BEQL RA, ZERO, .LVL165
9D021014  02A05021   ADDU T2, S5, ZERO
9D021240  02B0382B   SLTU A3, S5, S0
9D021244  54E00005   BNEL A3, ZERO, 0x9D02125C
9D021248  02A04021   ADDU T0, S5, ZERO
489:                          {
490:                             offset = oldval;
9D021018  02005021   ADDU T2, S0, ZERO
491:                             difference = (val - oldval) + 1;
9D02101C  02B05823   SUBU T3, S5, S0
9D021020  0B40840C   J .LVL167
9D021024  25660001   ADDIU A2, T3, 1
9D02125C  02154823   SUBU T1, S0, S5
9D021260  25260001   ADDIU A2, T1, 1
492:                          }
493:                          else
494:                          {
495:                             offset = val;
9D02124C  02004021   ADDU T0, S0, ZERO
496:                             difference = (oldval - val) + 1;
9D021028  02158023   SUBU S0, S0, S5
9D02102C  26060001   ADDIU A2, S0, 1
9D021250  02B0A823   SUBU S5, S5, S0
9D021254  0B408499   J 0x9D021264
9D021258  26A60001   ADDIU A2, S5, 1
497:                          }
498:                 
499:                          gui_vline(xofs + loop, yofs + offset, difference, GUI_GREEN);
9D021030  26C40080   ADDIU A0, S6, 128
9D021034  25450001   ADDIU A1, T2, 1
9D021038  0F40818B   JAL .LFB13, gui_vline, .LVL17, .LFE12
9D02103C  240700C6   ADDIU A3, ZERO, 198
9D021264  26240080   ADDIU A0, S1, 128
9D021268  25050001   ADDIU A1, T0, 1
9D02126C  0F40818B   JAL .LFB13, gui_vline, .LVL17, .LFE12
9D021270  240700C6   ADDIU A3, ZERO, 198
500:                          oldval = val;
9D021198  24160001   ADDIU S6, ZERO, 1
501:                       }
502:                    }
503:                    /* solid wave */
504:                    else if (GUI_WAVESOLID == wave_type)
9D021058  24040002   ADDIU A0, ZERO, 2
9D02105C  56040039   BNEL S0, A0, .LVL191, .LBB99
9D021060  24040080   ADDIU A0, ZERO, 128
9D021064  24100080   ADDIU S0, ZERO, 128
505:                    {
506:                       for (loop = 0; loop < WAVEDISP_WIDTH; loop++)
9D021074  24170100   ADDIU S7, ZERO, 256
9D021330  1617FF51   BNE S0, S7, .LVL172
9D021334  00000000   NOP
507:                       {
508:                          //val = vis_buffer[(uint32) (loop * scale)] >> 2;
509:                          if (16 == vis_bps)
9D021068  24160010   ADDIU S6, ZERO, 16
9D021078  1676000E   BNE S3, S6, .LVL177
9D02107C  2604FF80   ADDIU A0, S0, -128
9D021134  16760051   BNE S3, S6, .LVL209
9D021138  2604FF80   ADDIU A0, S0, -128
9D02113C  0B4084AA   J 0x9D0212A8
9D021140  00000000   NOP
510:                             val = ((((uint16 *) vis_buffer)[(uint32) (loop * scale)] >> 8) ^ 0x80) >> 2;
9D021080  0F4105E3   JAL sitofp
9D021084  00000000   NOP
9D021088  00402021   ADDU A0, V0, ZERO
9D02108C  0F40EEB0   JAL __mulsf3
9D021090  02802821   ADDU A1, S4, ZERO
9D021094  0F4103BC   JAL fptoui
9D021098  00402021   ADDU A0, V0, ZERO
9D02109C  00024040   SLL T0, V0, 1
9D0210A0  02484821   ADDU T1, S2, T0
9D0210A4  952A0000   LHU T2, 0(T1)
9D0210A8  394B8000   XORI T3, T2, -32768
9D0210AC  0B408437   J .LVL181
9D0210B0  000B3A82   SRL A3, T3, 10
9D0212A8  0F4105E3   JAL sitofp
9D0212AC  00000000   NOP
9D0212B0  00402021   ADDU A0, V0, ZERO
9D0212B4  0F40EEB0   JAL __mulsf3
9D0212B8  02802821   ADDU A1, S4, ZERO
9D0212BC  0F4103BC   JAL fptoui
9D0212C0  00402021   ADDU A0, V0, ZERO
9D0212C4  00021040   SLL V0, V0, 1
9D0212C8  02421821   ADDU V1, S2, V0
9D0212CC  94640000   LHU A0, 0(V1)
9D0212D0  38858000   XORI A1, A0, -32768
9D0212D4  00053282   SRL A2, A1, 10
511:                          else
512:                             val = ((uint8 *) vis_buffer)[(uint32) (loop * scale)] >> 2;
9D0210B4  0F4105E3   JAL sitofp
9D0210B8  00000000   NOP
9D0210BC  00402021   ADDU A0, V0, ZERO
9D0210C0  0F40EEB0   JAL __mulsf3
9D0210C4  02802821   ADDU A1, S4, ZERO
9D0210C8  0F4103BC   JAL fptoui
9D0210CC  00402021   ADDU A0, V0, ZERO
9D0210D0  02422821   ADDU A1, S2, V0
9D0210D4  90A60000   LBU A2, 0(A1)
9D0210D8  00063882   SRL A3, A2, 2
9D02127C  0F4105E3   JAL sitofp
9D021280  00000000   NOP
9D021284  00402021   ADDU A0, V0, ZERO
9D021288  0F40EEB0   JAL __mulsf3
9D02128C  02802821   ADDU A1, S4, ZERO
9D021290  0F4103BC   JAL fptoui
9D021294  00402021   ADDU A0, V0, ZERO
9D021298  0242C021   ADDU T8, S2, V0
9D02129C  93190000   LBU T9, 0(T8)
9D0212A0  0B4084B6   J 0x9D0212D8
9D0212A4  00193082   SRL A2, T9, 2
513:                          if (val == 0x20)
9D02106C  24150020   ADDIU S5, ZERO, 32
9D0210DC  14F50007   BNE A3, S5, .LVL183
9D0210E0  2CEC0020   SLTIU T4, A3, 32
9D0212D8  10D5000F   BEQ A2, S5, .LVL218, .LBB101
9D0212DC  2CDF0020   SLTIU RA, A2, 32
514:                             gui_putpixel(xofs + loop, yofs + 0x20, GUI_GREEN);
515:                          else if (val < 0x20)
9D0210FC  11800007   BEQ T4, ZERO, .LVL186
9D021100  02002021   ADDU A0, S0, ZERO
9D0212E0  17E00007   BNE RA, ZERO, 0x9D021300
9D0212E4  02202021   ADDU A0, S1, ZERO
516:                             gui_vline(xofs + loop, yofs + 0x20, 0x20 - val, GUI_GREEN);
9D021104  24050021   ADDIU A1, ZERO, 33
9D021108  02A73023   SUBU A2, S5, A3
9D02110C  0F40818B   JAL .LFB13, gui_vline, .LVL17, .LFE12
9D021110  240700C6   ADDIU A3, ZERO, 198
9D021114  0B40844C   J .LVL189
9D021118  26100001   ADDIU S0, S0, 1
9D021300  24050021   ADDIU A1, ZERO, 33
9D021304  02A63023   SUBU A2, S5, A2
9D021308  0F40818B   JAL .LFB13, gui_vline, .LVL17, .LFE12
9D02130C  240700C6   ADDIU A3, ZERO, 198
9D021310  0B4084CC   J .LBE101
9D021314  26100001   ADDIU S0, S0, 1
517:                          else
518:                             gui_vline(xofs + loop, yofs + 0x20 - (val - 0x20), val - 0x20,
9D021070  241E0041   ADDIU FP, ZERO, 65
9D02111C  03C72823   SUBU A1, FP, A3
9D021120  24E6FFE0   ADDIU A2, A3, -32
9D021124  0F40818B   JAL .LFB13, gui_vline, .LVL17, .LFE12
9D021128  240700C6   ADDIU A3, ZERO, 198
9D02112C  26100001   ADDIU S0, S0, 1
9D021130  02008821   ADDU S1, S0, ZERO
9D0212E8  03C62823   SUBU A1, FP, A2
9D0212EC  24C6FFE0   ADDIU A2, A2, -32
9D0212F0  0F40818B   JAL .LFB13, gui_vline, .LVL17, .LFE12
9D0212F4  240700C6   ADDIU A3, ZERO, 198
9D0212F8  0B4084CC   J .LBE101
9D0212FC  26100001   ADDIU S0, S0, 1
519:                                       GUI_GREEN);
520:                       }
521:                    }
522:                 
523:                    gui_rect(xofs, yofs - 1, WAVEDISP_WIDTH, 66, GUI_DKGRAY);
524:                 }
9D021190  0B40846A   J .LVL197
9D021194  8FBF01B4   LW RA, 436(SP)
9D0211A8  8FBE01B0   LW FP, 432(SP)
9D0211AC  8FB701AC   LW S7, 428(SP)
9D0211B0  8FB601A8   LW S6, 424(SP)
9D0211B4  8FB501A4   LW S5, 420(SP)
9D0211B8  8FB401A0   LW S4, 416(SP)
9D0211BC  8FB3019C   LW S3, 412(SP)
9D0211C0  8FB20198   LW S2, 408(SP)
9D0211C4  8FB10194   LW S1, 404(SP)
9D0211C8  8FB00190   LW S0, 400(SP)
9D0211CC  03E00008   JR RA
9D0211D0  27BD01B8   ADDIU SP, SP, 440
9D0211D4  0F4105E3   JAL sitofp
9D0211D8  02202021   ADDU A0, S1, ZERO
9D0211DC  00402021   ADDU A0, V0, ZERO
9D0211E0  0F40EEB0   JAL __mulsf3
9D0211E4  02802821   ADDU A1, S4, ZERO
9D0211E8  0F4103BC   JAL fptoui
9D0211EC  00402021   ADDU A0, V0, ZERO
9D0211F0  02426821   ADDU T5, S2, V0
9D0211F4  91AE0000   LBU T6, 0(T5)
9D0211F8  000E7882   SRL T7, T6, 2
9D0211FC  03CFC023   SUBU T8, FP, T7
9D021200  0B408490   J .LVL207
9D021204  331000FF   ANDI S0, T8, 255
9D021208  0F4105E3   JAL sitofp
9D02120C  02202021   ADDU A0, S1, ZERO
9D021210  00402021   ADDU A0, V0, ZERO
9D021214  0F40EEB0   JAL __mulsf3
9D021218  02802821   ADDU A1, S4, ZERO
9D02121C  0F4103BC   JAL fptoui
9D021220  00402021   ADDU A0, V0, ZERO
9D021224  0002C840   SLL T9, V0, 1
9D021228  02591021   ADDU V0, S2, T9
9D02122C  94430000   LHU V1, 0(V0)
9D021230  38648000   XORI A0, V1, -32768
9D021234  00042A82   SRL A1, A0, 10
9D021238  03C53023   SUBU A2, FP, A1
9D02123C  30D000FF   ANDI S0, A2, 255
9D021240  02B0382B   SLTU A3, S5, S0
9D021244  54E00005   BNEL A3, ZERO, 0x9D02125C
9D021248  02A04021   ADDU T0, S5, ZERO
9D02124C  02004021   ADDU T0, S0, ZERO
9D021250  02B0A823   SUBU S5, S5, S0
9D021254  0B408499   J 0x9D021264
9D021258  26A60001   ADDIU A2, S5, 1
9D02125C  02154823   SUBU T1, S0, S5
9D021260  25260001   ADDIU A2, T1, 1
9D021264  26240080   ADDIU A0, S1, 128
9D021268  25050001   ADDIU A1, T0, 1
9D02126C  0F40818B   JAL .LFB13, gui_vline, .LVL17, .LFE12
9D021270  240700C6   ADDIU A3, ZERO, 198
9D021274  0B4083E6   J .LVL153
9D021278  26D60001   ADDIU S6, S6, 1
9D02127C  0F4105E3   JAL sitofp
9D021280  00000000   NOP
9D021284  00402021   ADDU A0, V0, ZERO
9D021288  0F40EEB0   JAL __mulsf3
9D02128C  02802821   ADDU A1, S4, ZERO
9D021290  0F4103BC   JAL fptoui
9D021294  00402021   ADDU A0, V0, ZERO
9D021298  0242C021   ADDU T8, S2, V0
9D02129C  93190000   LBU T9, 0(T8)
9D0212A0  0B4084B6   J 0x9D0212D8
9D0212A4  00193082   SRL A2, T9, 2
9D0212A8  0F4105E3   JAL sitofp
9D0212AC  00000000   NOP
9D0212B0  00402021   ADDU A0, V0, ZERO
9D0212B4  0F40EEB0   JAL __mulsf3
9D0212B8  02802821   ADDU A1, S4, ZERO
9D0212BC  0F4103BC   JAL fptoui
9D0212C0  00402021   ADDU A0, V0, ZERO
9D0212C4  00021040   SLL V0, V0, 1
9D0212C8  02421821   ADDU V1, S2, V0
9D0212CC  94640000   LHU A0, 0(V1)
9D0212D0  38858000   XORI A1, A0, -32768
9D0212D4  00053282   SRL A2, A1, 10
9D0212D8  10D5000F   BEQ A2, S5, .LVL218, .LBB101
9D0212DC  2CDF0020   SLTIU RA, A2, 32
9D0212E0  17E00007   BNE RA, ZERO, 0x9D021300
9D0212E4  02202021   ADDU A0, S1, ZERO
9D0212E8  03C62823   SUBU A1, FP, A2
9D0212EC  24C6FFE0   ADDIU A2, A2, -32
9D0212F0  0F40818B   JAL .LFB13, gui_vline, .LVL17, .LFE12
9D0212F4  240700C6   ADDIU A3, ZERO, 198
9D0212F8  0B4084CC   J .LBE101
9D0212FC  26100001   ADDIU S0, S0, 1
9D021300  24050021   ADDIU A1, ZERO, 33
9D021304  02A63023   SUBU A2, S5, A2
9D021308  0F40818B   JAL .LFB13, gui_vline, .LVL17, .LFE12
9D02130C  240700C6   ADDIU A3, ZERO, 198
9D021310  0B4084CC   J .LBE101
9D021314  26100001   ADDIU S0, S0, 1
9D021318  8F878094   LW A3, -32620(GP)
9D02131C  8CE80098   LW T0, 152(A3)
9D021320  01114821   ADDU T1, T0, S1
9D021324  240AFFC6   ADDIU T2, ZERO, -58
9D021328  A12A0000   SB T2, 0(T1)
9D02132C  26100001   ADDIU S0, S0, 1
9D021330  1617FF51   BNE S0, S7, .LVL172
9D021334  00000000   NOP
9D021338  0B408451   J .LVL191, .LBB99
9D02133C  24040080   ADDIU A0, ZERO, 128
525:                 
526:                 
527:                 static void gui_updatepattern(void)
528:                 {
529:                    /* Pretty it up a bit */
530:                    gui_textbar("Pattern Table 0", 0, 0, &small, GUI_GREEN, GUI_DKGRAY, BUTTON_UP);
9D02153C  241100C6   ADDIU S1, ZERO, 198
531:                    gui_textbar("Pattern Table 1", 128, 0, &small, GUI_GREEN, GUI_DKGRAY, BUTTON_UP);
9D021568  AFB10010   SW S1, 16(SP)
532:                    gui_hline(0, 9, 256, GUI_DKGRAY);
9D02158C  00002021   ADDU A0, ZERO, ZERO
533:                    gui_hline(0, 138, 256, GUI_DKGRAY);
9D0215A0  00002021   ADDU A0, ZERO, ZERO
534:                 
535:                    /* Dump the actual tables */
536:                    ppu_dumppattern(gui_surface, 0, 0, 10, pattern_col);
9D0215B4  8F8980A4   LW T1, -32604(GP)
537:                    ppu_dumppattern(gui_surface, 1, 128, 10, pattern_col);
9D0215D0  8F8A80A4   LW T2, -32604(GP)
9D0215D4  AFAA0010   SW T2, 16(SP)
9D0215D8  8F848094   LW A0, -32620(GP)
9D0215DC  24050001   ADDIU A1, ZERO, 1
9D0215E0  24060080   ADDIU A2, ZERO, 128
9D0215E4  0F40613A   JAL ppu_dumppattern
9D0215E8  2407000A   ADDIU A3, ZERO, 10
538:                 }
539:                 
540:                 static void gui_updateoam(void)
541:                 {
542:                    int y;
543:                 
544:                    y = option_showpattern ? 140 : 0;
9D0215F8  240C008C   ADDIU T4, ZERO, 140
545:                    gui_textbar("Current OAM", 0, y, &small, GUI_GREEN, GUI_DKGRAY, BUTTON_UP);
9D021608  240E00C6   ADDIU T6, ZERO, 198
546:                    ppu_dumpoam(gui_surface, 0, y + 9);
9D021634  8F848094   LW A0, -32620(GP)
9D021638  00002821   ADDU A1, ZERO, ZERO
9D02163C  0F405FE3   JAL ppu_dumpoam
9D021640  26260009   ADDIU A2, S1, 9
547:                 }
548:                 
549:                 
550:                 /* The GUI overlay */
551:                 void gui_frame(bool draw)
552:                 {
9D021434  27BDFFD0   ADDIU SP, SP, -48
9D021438  AFBF002C   SW RA, 44(SP)
9D02143C  AFB10028   SW S1, 40(SP)
9D021440  AFB00024   SW S0, 36(SP)
553:                    gui_fps++;
9D021444  8F828098   LW V0, -32616(GP)
9D021448  24430001   ADDIU V1, V0, 1
554:                    if (false == draw)
9D02144C  1080011A   BEQ A0, ZERO, .LVL286, .LBE193
9D021450  AF838098   SW V1, -32616(GP)
555:                       return;
556:                 
557:                    gui_surface = vid_getbuffer();
9D021454  0F40D0CF   JAL vid_getbuffer
9D021458  00000000   NOP
9D02145C  AF828094   SW V0, -32620(GP)
558:                 
559:                    ASSERT(gui_surface);
560:                 
561:                    gui_tickdec();
562:                 
563:                    if (option_showfps)
9D021494  8F8A80B8   LW T2, -32584(GP)
9D021498  11400021   BEQ T2, ZERO, 0x9D021520
9D02149C  8F8480B0   LW A0, -32592(GP)
564:                       gui_updatefps();
565:                 
566:                    if (option_wavetype != GUI_WAVENONE)
9D02151C  8F8480B0   LW A0, -32592(GP)
9D021520  10800004   BEQ A0, ZERO, 0x9D021534
9D021524  8F8680AC   LW A2, -32596(GP)
567:                       gui_updatewave(option_wavetype);
9D021528  0F4083A2   JAL .LFB34, gui_updatewave, .LVL135, .LFE21
9D02152C  00000000   NOP
568:                 
569:                    if (option_showpattern)
9D021530  8F8680AC   LW A2, -32596(GP)
9D021534  10C0002E   BEQ A2, ZERO, 0x9D0215F0
9D021538  8F8B80A8   LW T3, -32600(GP)
570:                       gui_updatepattern();
571:                 
572:                    if (option_showoam)
9D0215EC  8F8B80A8   LW T3, -32600(GP)
9D0215F0  11600015   BEQ T3, ZERO, .LBB126
9D0215F4  3C19A001   LUI T9, -24575
573:                       gui_updateoam();
574:                 
575:                    if (msg.ttl)
9D021644  3C19A001   LUI T9, -24575
576:                       gui_updatemsg();
577:                 
578:                    if (option_showgui)
9D02168C  8F8780B4   LW A3, -32588(GP)
9D021690  10E0008A   BEQ A3, ZERO, 0x9D0218BC
9D021694  8FBF002C   LW RA, 44(SP)
579:                    {
580:                       //osd_getmouse(&mouse_x, &mouse_y, &mouse_button);
581:                       gui_drawmouse();
582:                    }
583:                 }
9D0218B8  8FBF002C   LW RA, 44(SP)
9D0218BC  8FB10028   LW S1, 40(SP)
9D0218C0  8FB00024   LW S0, 36(SP)
9D0218C4  03E00008   JR RA
9D0218C8  27BD0030   ADDIU SP, SP, 48
584:                 
585:                 void gui_sendmsg(int color, char *format, ...)
586:                 {
9D0218CC  27BDFFE0   ADDIU SP, SP, -32
9D0218D0  AFBF001C   SW RA, 28(SP)
9D0218D4  AFB00018   SW S0, 24(SP)
9D0218D8  00808021   ADDU S0, A0, ZERO
9D0218DC  AFA60028   SW A2, 40(SP)
9D0218E0  AFA7002C   SW A3, 44(SP)
587:                    va_list arg;
588:                    va_start(arg, format);
9D0218E4  27A60028   ADDIU A2, SP, 40
9D0218E8  AFA60010   SW A2, 16(SP)
589:                    vsprintf(msg.text, format, arg);
9D0218EC  3C04A001   LUI A0, -24575
9D0218F0  0F410657   JAL vsprintf
9D0218F4  24844668   ADDIU A0, A0, 18024
590:                 
591:                 #ifdef NOFRENDO_DEBUG
592:                    log_print("GUI: ");
593:                    log_print(msg.text);
594:                    log_print("\n");
595:                 #endif
596:                 
597:                    va_end(arg);
598:                 
599:                    msg.ttl = gui_refresh * 2; /* 2 second delay */
9D0218F8  3C02A001   LUI V0, -24575
9D0218FC  8F83801C   LW V1, -32740(GP)
9D021900  00032840   SLL A1, V1, 1
9D021904  AC454664   SW A1, 18020(V0)
600:                    msg.color = color;
9D021908  24464664   ADDIU A2, V0, 18020
9D02190C  A0D00104   SB S0, 260(A2)
601:                 }
9D021910  8FBF001C   LW RA, 28(SP)
9D021914  8FB00018   LW S0, 24(SP)
9D021918  03E00008   JR RA
9D02191C  27BD0020   ADDIU SP, SP, 32
602:                 
603:                 void gui_setrefresh(int frequency)
604:                 {
605:                    gui_refresh = frequency;
9D021B98  03E00008   JR RA
9D021B9C  AF84801C   SW A0, -32740(GP)
606:                 }
607:                 
608:                 int gui_init(void)
609:                 {
9D021BA0  27BDFFE8   ADDIU SP, SP, -24
9D021BA4  AFBF0014   SW RA, 20(SP)
610:                    gui_refresh = 60;
9D021BA8  2402003C   ADDIU V0, ZERO, 60
9D021BAC  AF82801C   SW V0, -32740(GP)
611:                    memset(&msg, 0, sizeof(message_t));
9D021BB0  3C04A001   LUI A0, -24575
9D021BB4  24844664   ADDIU A0, A0, 18020
9D021BB8  00002821   ADDU A1, ZERO, ZERO
9D021BBC  0F4100B4   JAL .Letext0, .LFE0, memset
9D021BC0  24060108   ADDIU A2, ZERO, 264
612:                 
613:                    return 0; /* can't fail */
614:                 }
9D021BC4  00001021   ADDU V0, ZERO, ZERO
9D021BC8  8FBF0014   LW RA, 20(SP)
9D021BCC  03E00008   JR RA
9D021BD0  27BD0018   ADDIU SP, SP, 24
615:                 
616:                 void gui_shutdown(void)
617:                 {
9D021BD4  03E00008   JR RA
618:                 }
619:                 
620:                 /*
621:                 ** $Log: gui.c,v $
622:                 ** Revision 1.2  2001/04/27 14:37:11  neil
623:                 ** wheeee
624:                 **
625:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
626:                 ** initial
627:                 **
628:                 ** Revision 1.26  2000/11/25 20:26:05  matt
629:                 ** removed fds "system"
630:                 **
631:                 ** Revision 1.25  2000/11/09 14:05:43  matt
632:                 ** state load fixed, state save mostly fixed
633:                 **
634:                 ** Revision 1.24  2000/11/05 16:37:18  matt
635:                 ** rolled rgb.h into bitmap.h
636:                 **
637:                 ** Revision 1.23  2000/10/27 12:57:49  matt
638:                 ** fixed pcx snapshots
639:                 **
640:                 ** Revision 1.22  2000/10/25 00:23:16  matt
641:                 ** makefiles updated for new directory structure
642:                 **
643:                 ** Revision 1.21  2000/10/23 17:50:47  matt
644:                 ** adding fds support
645:                 **
646:                 ** Revision 1.20  2000/10/23 15:52:04  matt
647:                 ** better system handling
648:                 **
649:                 ** Revision 1.19  2000/10/22 19:15:39  matt
650:                 ** more sane timer ISR / autoframeskip
651:                 **
652:                 ** Revision 1.18  2000/10/17 03:22:37  matt
653:                 ** cleaning up rom module
654:                 **
655:                 ** Revision 1.17  2000/10/10 13:58:13  matt
656:                 ** stroustrup squeezing his way in the door
657:                 **
658:                 ** Revision 1.16  2000/10/10 13:03:53  matt
659:                 ** Mr. Clean makes a guest appearance
660:                 **
661:                 ** Revision 1.15  2000/10/08 17:59:12  matt
662:                 ** gui_ticks is volatile
663:                 **
664:                 ** Revision 1.14  2000/09/15 04:58:06  matt
665:                 ** simplifying and optimizing APU core
666:                 **
667:                 ** Revision 1.13  2000/07/31 04:28:46  matt
668:                 ** one million cleanups
669:                 **
670:                 ** Revision 1.12  2000/07/30 04:29:59  matt
671:                 ** no more apu_getpcmdata hack
672:                 **
673:                 ** Revision 1.11  2000/07/25 02:20:47  matt
674:                 ** moved gui palette filth here, for the time being
675:                 **
676:                 ** Revision 1.10  2000/07/24 04:32:05  matt
677:                 ** bugfix on message delay
678:                 **
679:                 ** Revision 1.9  2000/07/23 15:16:25  matt
680:                 ** moved non-osd code here
681:                 **
682:                 ** Revision 1.8  2000/07/17 01:52:27  matt
683:                 ** made sure last line of all source files is a newline
684:                 **
685:                 ** Revision 1.7  2000/07/11 04:40:23  matt
686:                 ** updated for new screen dimension defines
687:                 **
688:                 ** Revision 1.6  2000/07/09 03:39:33  matt
689:                 ** small gui_frame cleanup
690:                 **
691:                 ** Revision 1.5  2000/07/06 16:47:18  matt
692:                 ** new video driver interface
693:                 **
694:                 ** Revision 1.4  2000/06/09 15:12:25  matt
695:                 ** initial revision
696:                 **
697:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/event.c  -----------------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** event.c
21:                  **
22:                  ** OS-independent event handling
23:                  ** $Id: event.c,v 1.3 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <stdlib.h>
27:                  #include <noftypes.h>
28:                  #include <event.h>
29:                  #include <nofrendo.h>
30:                  #include <gui.h>
31:                  #include <osd.h>
32:                  
33:                  /* TODO: put system specific stuff in their own files... */
34:                  #include <nes.h>
35:                  #include <nesinput.h>
36:                  #include <nes_pal.h>
37:                  #include <nesstate.h>
38:                  
39:                  /* pointer to our current system's event handler table */
40:                  static event_t *system_events = NULL;
41:                  
42:                  /* standard keyboard input */
43:                  static nesinput_t kb_input = { INP_JOYPAD0, 0 };
44:                  static nesinput_t kb_alt_input = { INP_JOYPAD1, 0 };
45:                  
46:                  static void func_event_quit(int code)
47:                  {
9D02C8E4  27BDFFE8   ADDIU SP, SP, -24
9D02C8E8  AFBF0014   SW RA, 20(SP)
48:                     UNUSED(code);
49:                     main_quit();
9D02C8EC  0F40E6E5   JAL main_quit
9D02C8F0  00000000   NOP
50:                  }
9D02C8F4  8FBF0014   LW RA, 20(SP)
9D02C8F8  03E00008   JR RA
9D02C8FC  27BD0018   ADDIU SP, SP, 24
51:                  
52:                  static void func_event_insert(int code)
53:                  {
9D02BE4C  03E00008   JR RA
9D02BE50  00000000   NOP
54:                     UNUSED(code);
55:                     /* TODO: after the GUI */
56:                  }
57:                  
58:                  static void func_event_eject(int code)
59:                  {
9D02C8C4  27BDFFE8   ADDIU SP, SP, -24
9D02C8C8  AFBF0014   SW RA, 20(SP)
60:                     if (INP_STATE_MAKE == code)
9D02C8B8  24020001   ADDIU V0, ZERO, 1
9D02C8BC  14820007   BNE A0, V0, 0x9D02C8DC
9D02C8C0  00000000   NOP
61:                        main_eject();
9D02C8CC  0F40E6CB   JAL main_eject
9D02C8D0  00000000   NOP
62:                  }
9D02C8D4  8FBF0014   LW RA, 20(SP)
9D02C8D8  27BD0018   ADDIU SP, SP, 24
9D02C8DC  03E00008   JR RA
9D02C8E0  00000000   NOP
63:                  
64:                  static void func_event_togglepause(int code)
65:                  {
9D02C898  27BDFFE8   ADDIU SP, SP, -24
9D02C89C  AFBF0014   SW RA, 20(SP)
66:                     if (INP_STATE_MAKE == code)
9D02C88C  24020001   ADDIU V0, ZERO, 1
9D02C890  14820007   BNE A0, V0, 0x9D02C8B0
9D02C894  00000000   NOP
67:                        nes_togglepause();
9D02C8A0  0F4099BD   JAL nes_togglepause
9D02C8A4  00000000   NOP
68:                  }
9D02C8A8  8FBF0014   LW RA, 20(SP)
9D02C8AC  27BD0018   ADDIU SP, SP, 24
9D02C8B0  03E00008   JR RA
9D02C8B4  00000000   NOP
69:                  
70:                  static void func_event_soft_reset(int code)
71:                  {
9D02C86C  27BDFFE8   ADDIU SP, SP, -24
9D02C870  AFBF0014   SW RA, 20(SP)
72:                     if (INP_STATE_MAKE == code) 
9D02C860  24020001   ADDIU V0, ZERO, 1
9D02C864  14820007   BNE A0, V0, 0x9D02C884
9D02C868  00000000   NOP
73:                        nes_reset(SOFT_RESET);
9D02C874  0F409908   JAL nes_reset
9D02C878  00002021   ADDU A0, ZERO, ZERO
74:                  }
9D02C87C  8FBF0014   LW RA, 20(SP)
9D02C880  27BD0018   ADDIU SP, SP, 24
9D02C884  03E00008   JR RA
9D02C888  00000000   NOP
75:                  
76:                  static void func_event_hard_reset(int code)
77:                  {
9D02C840  27BDFFE8   ADDIU SP, SP, -24
9D02C844  AFBF0014   SW RA, 20(SP)
78:                     if (INP_STATE_MAKE == code)
9D02C834  24020001   ADDIU V0, ZERO, 1
9D02C838  14820007   BNE A0, V0, 0x9D02C858
9D02C83C  00000000   NOP
79:                        nes_reset(HARD_RESET);
9D02C848  0F409908   JAL nes_reset
9D02C84C  24040001   ADDIU A0, ZERO, 1
80:                  }
9D02C850  8FBF0014   LW RA, 20(SP)
9D02C854  27BD0018   ADDIU SP, SP, 24
9D02C858  03E00008   JR RA
9D02C85C  00000000   NOP
81:                  
82:                  static void func_event_snapshot(int code)
83:                  {
9D02C814  27BDFFE8   ADDIU SP, SP, -24
9D02C818  AFBF0014   SW RA, 20(SP)
84:                     if (INP_STATE_MAKE == code)
9D02C808  24020001   ADDIU V0, ZERO, 1
9D02C80C  14820007   BNE A0, V0, 0x9D02C82C
9D02C810  00000000   NOP
85:                        gui_savesnap();
9D02C81C  0F408648   JAL gui_savesnap
9D02C820  00000000   NOP
86:                  }
9D02C824  8FBF0014   LW RA, 20(SP)
9D02C828  27BD0018   ADDIU SP, SP, 24
9D02C82C  03E00008   JR RA
9D02C830  00000000   NOP
87:                  
88:                  static void func_event_toggle_frameskip(int code)
89:                  {
9D02C7E8  27BDFFE8   ADDIU SP, SP, -24
9D02C7EC  AFBF0014   SW RA, 20(SP)
90:                     if (INP_STATE_MAKE == code)
9D02C7DC  24020001   ADDIU V0, ZERO, 1
9D02C7E0  14820007   BNE A0, V0, 0x9D02C800
9D02C7E4  00000000   NOP
91:                        gui_togglefs();
9D02C7F0  0F408672   JAL gui_togglefs
9D02C7F4  00000000   NOP
92:                  }
9D02C7F8  8FBF0014   LW RA, 20(SP)
9D02C7FC  27BD0018   ADDIU SP, SP, 24
9D02C800  03E00008   JR RA
9D02C804  00000000   NOP
93:                  
94:                  static void func_event_state_save(int code)
95:                  {
9D02C7BC  27BDFFE8   ADDIU SP, SP, -24
9D02C7C0  AFBF0014   SW RA, 20(SP)
96:                     if (INP_STATE_MAKE == code)
9D02C7B0  24020001   ADDIU V0, ZERO, 1
9D02C7B4  14820007   BNE A0, V0, 0x9D02C7D4
9D02C7B8  00000000   NOP
97:                        state_save();
9D02C7C4  0F408CBC   JAL state_save
9D02C7C8  00000000   NOP
98:                  }
9D02C7CC  8FBF0014   LW RA, 20(SP)
9D02C7D0  27BD0018   ADDIU SP, SP, 24
9D02C7D4  03E00008   JR RA
9D02C7D8  00000000   NOP
99:                  
100:                 static void func_event_state_load(int code)
101:                 {
9D02C790  27BDFFE8   ADDIU SP, SP, -24
9D02C794  AFBF0014   SW RA, 20(SP)
102:                    if (INP_STATE_MAKE == code)
9D02C784  24020001   ADDIU V0, ZERO, 1
9D02C788  14820007   BNE A0, V0, 0x9D02C7A8
9D02C78C  00000000   NOP
103:                       state_load();
9D02C798  0F408F7B   JAL state_load
9D02C79C  00000000   NOP
104:                 }
9D02C7A0  8FBF0014   LW RA, 20(SP)
9D02C7A4  27BD0018   ADDIU SP, SP, 24
9D02C7A8  03E00008   JR RA
9D02C7AC  00000000   NOP
105:                 
106:                 static void func_event_state_slot_0(int code)
107:                 {
9D02C764  27BDFFE8   ADDIU SP, SP, -24
9D02C768  AFBF0014   SW RA, 20(SP)
108:                    if (INP_STATE_MAKE == code)
9D02C758  24020001   ADDIU V0, ZERO, 1
9D02C75C  14820007   BNE A0, V0, 0x9D02C77C
9D02C760  00000000   NOP
109:                       state_setslot(0);
9D02C76C  0F408CAC   JAL state_setslot
9D02C770  00002021   ADDU A0, ZERO, ZERO
110:                 }
9D02C774  8FBF0014   LW RA, 20(SP)
9D02C778  27BD0018   ADDIU SP, SP, 24
9D02C77C  03E00008   JR RA
9D02C780  00000000   NOP
111:                 
112:                 static void func_event_state_slot_1(int code)
113:                 {
9D02C738  27BDFFE8   ADDIU SP, SP, -24
9D02C73C  AFBF0014   SW RA, 20(SP)
114:                    if (INP_STATE_MAKE == code) 
9D02C72C  24020001   ADDIU V0, ZERO, 1
9D02C730  14820007   BNE A0, V0, 0x9D02C750
9D02C734  00000000   NOP
115:                       state_setslot(1);
9D02C740  0F408CAC   JAL state_setslot
9D02C744  24040001   ADDIU A0, ZERO, 1
116:                 }
9D02C748  8FBF0014   LW RA, 20(SP)
9D02C74C  27BD0018   ADDIU SP, SP, 24
9D02C750  03E00008   JR RA
9D02C754  00000000   NOP
117:                 
118:                 static void func_event_state_slot_2(int code)
119:                 {
9D02C70C  27BDFFE8   ADDIU SP, SP, -24
9D02C710  AFBF0014   SW RA, 20(SP)
120:                    if (INP_STATE_MAKE == code) 
9D02C700  24020001   ADDIU V0, ZERO, 1
9D02C704  14820007   BNE A0, V0, 0x9D02C724
9D02C708  00000000   NOP
121:                       state_setslot(2);
9D02C714  0F408CAC   JAL state_setslot
9D02C718  24040002   ADDIU A0, ZERO, 2
122:                 }
9D02C71C  8FBF0014   LW RA, 20(SP)
9D02C720  27BD0018   ADDIU SP, SP, 24
9D02C724  03E00008   JR RA
9D02C728  00000000   NOP
123:                 
124:                 static void func_event_state_slot_3(int code)
125:                 {
9D02C6E0  27BDFFE8   ADDIU SP, SP, -24
9D02C6E4  AFBF0014   SW RA, 20(SP)
126:                    if (INP_STATE_MAKE == code)
9D02C6D4  24020001   ADDIU V0, ZERO, 1
9D02C6D8  14820007   BNE A0, V0, 0x9D02C6F8
9D02C6DC  00000000   NOP
127:                       state_setslot(3);
9D02C6E8  0F408CAC   JAL state_setslot
9D02C6EC  24040003   ADDIU A0, ZERO, 3
128:                 }
9D02C6F0  8FBF0014   LW RA, 20(SP)
9D02C6F4  27BD0018   ADDIU SP, SP, 24
9D02C6F8  03E00008   JR RA
9D02C6FC  00000000   NOP
129:                 
130:                 static void func_event_state_slot_4(int code)
131:                 {
9D02C6B4  27BDFFE8   ADDIU SP, SP, -24
9D02C6B8  AFBF0014   SW RA, 20(SP)
132:                    if (INP_STATE_MAKE == code)
9D02C6A8  24020001   ADDIU V0, ZERO, 1
9D02C6AC  14820007   BNE A0, V0, 0x9D02C6CC
9D02C6B0  00000000   NOP
133:                       state_setslot(4);
9D02C6BC  0F408CAC   JAL state_setslot
9D02C6C0  24040004   ADDIU A0, ZERO, 4
134:                 }
9D02C6C4  8FBF0014   LW RA, 20(SP)
9D02C6C8  27BD0018   ADDIU SP, SP, 24
9D02C6CC  03E00008   JR RA
9D02C6D0  00000000   NOP
135:                 
136:                 static void func_event_state_slot_5(int code)
137:                 {
9D02C688  27BDFFE8   ADDIU SP, SP, -24
9D02C68C  AFBF0014   SW RA, 20(SP)
138:                    if (INP_STATE_MAKE == code) 
9D02C67C  24020001   ADDIU V0, ZERO, 1
9D02C680  14820007   BNE A0, V0, 0x9D02C6A0
9D02C684  00000000   NOP
139:                       state_setslot(5);
9D02C690  0F408CAC   JAL state_setslot
9D02C694  24040005   ADDIU A0, ZERO, 5
140:                 }
9D02C698  8FBF0014   LW RA, 20(SP)
9D02C69C  27BD0018   ADDIU SP, SP, 24
9D02C6A0  03E00008   JR RA
9D02C6A4  00000000   NOP
141:                 
142:                 static void func_event_state_slot_6(int code)
143:                 {
9D02C65C  27BDFFE8   ADDIU SP, SP, -24
9D02C660  AFBF0014   SW RA, 20(SP)
144:                    if (INP_STATE_MAKE == code) 
9D02C650  24020001   ADDIU V0, ZERO, 1
9D02C654  14820007   BNE A0, V0, 0x9D02C674
9D02C658  00000000   NOP
145:                       state_setslot(6);
9D02C664  0F408CAC   JAL state_setslot
9D02C668  24040006   ADDIU A0, ZERO, 6
146:                 }
9D02C66C  8FBF0014   LW RA, 20(SP)
9D02C670  27BD0018   ADDIU SP, SP, 24
9D02C674  03E00008   JR RA
9D02C678  00000000   NOP
147:                 
148:                 static void func_event_state_slot_7(int code)
149:                 {
9D02C630  27BDFFE8   ADDIU SP, SP, -24
9D02C634  AFBF0014   SW RA, 20(SP)
150:                    if (INP_STATE_MAKE == code) 
9D02C624  24020001   ADDIU V0, ZERO, 1
9D02C628  14820007   BNE A0, V0, 0x9D02C648
9D02C62C  00000000   NOP
151:                       state_setslot(7);
9D02C638  0F408CAC   JAL state_setslot
9D02C63C  24040007   ADDIU A0, ZERO, 7
152:                 }
9D02C640  8FBF0014   LW RA, 20(SP)
9D02C644  27BD0018   ADDIU SP, SP, 24
9D02C648  03E00008   JR RA
9D02C64C  00000000   NOP
153:                 
154:                 static void func_event_state_slot_8(int code)
155:                 {
9D02C604  27BDFFE8   ADDIU SP, SP, -24
9D02C608  AFBF0014   SW RA, 20(SP)
156:                    if (INP_STATE_MAKE == code)
9D02C5F8  24020001   ADDIU V0, ZERO, 1
9D02C5FC  14820007   BNE A0, V0, 0x9D02C61C
9D02C600  00000000   NOP
157:                       state_setslot(8);
9D02C60C  0F408CAC   JAL state_setslot
9D02C610  24040008   ADDIU A0, ZERO, 8
158:                 }
9D02C614  8FBF0014   LW RA, 20(SP)
9D02C618  27BD0018   ADDIU SP, SP, 24
9D02C61C  03E00008   JR RA
9D02C620  00000000   NOP
159:                 
160:                 static void func_event_state_slot_9(int code)
161:                 {
9D02C5D8  27BDFFE8   ADDIU SP, SP, -24
9D02C5DC  AFBF0014   SW RA, 20(SP)
162:                    if (INP_STATE_MAKE == code)
9D02C5CC  24020001   ADDIU V0, ZERO, 1
9D02C5D0  14820007   BNE A0, V0, 0x9D02C5F0
9D02C5D4  00000000   NOP
163:                       state_setslot(9);
9D02C5E0  0F408CAC   JAL state_setslot
9D02C5E4  24040009   ADDIU A0, ZERO, 9
164:                 }
9D02C5E8  8FBF0014   LW RA, 20(SP)
9D02C5EC  27BD0018   ADDIU SP, SP, 24
9D02C5F0  03E00008   JR RA
9D02C5F4  00000000   NOP
165:                 
166:                 static void func_event_gui_toggle_oam(int code)
167:                 {
9D02C5AC  27BDFFE8   ADDIU SP, SP, -24
9D02C5B0  AFBF0014   SW RA, 20(SP)
168:                    if (INP_STATE_MAKE == code)
9D02C5A0  24020001   ADDIU V0, ZERO, 1
9D02C5A4  14820007   BNE A0, V0, 0x9D02C5C4
9D02C5A8  00000000   NOP
169:                       gui_toggleoam();
9D02C5B4  0F4084F4   JAL gui_toggleoam
9D02C5B8  00000000   NOP
170:                 }
9D02C5BC  8FBF0014   LW RA, 20(SP)
9D02C5C0  27BD0018   ADDIU SP, SP, 24
9D02C5C4  03E00008   JR RA
9D02C5C8  00000000   NOP
171:                 
172:                 static void func_event_gui_toggle_wave(int code)
173:                 {
9D02C580  27BDFFE8   ADDIU SP, SP, -24
9D02C584  AFBF0014   SW RA, 20(SP)
174:                    if (INP_STATE_MAKE == code)
9D02C574  24020001   ADDIU V0, ZERO, 1
9D02C578  14820007   BNE A0, V0, 0x9D02C598
9D02C57C  00000000   NOP
175:                       gui_togglewave();
9D02C588  0F4084E7   JAL gui_togglewave
9D02C58C  00000000   NOP
176:                 }
9D02C590  8FBF0014   LW RA, 20(SP)
9D02C594  27BD0018   ADDIU SP, SP, 24
9D02C598  03E00008   JR RA
9D02C59C  00000000   NOP
177:                 
178:                 static void func_event_gui_toggle_pattern(int code)
179:                 {
9D02C554  27BDFFE8   ADDIU SP, SP, -24
9D02C558  AFBF0014   SW RA, 20(SP)
180:                    if (INP_STATE_MAKE == code)
9D02C548  24020001   ADDIU V0, ZERO, 1
9D02C54C  14820007   BNE A0, V0, 0x9D02C56C
9D02C550  00000000   NOP
181:                       gui_togglepattern();
9D02C55C  0F4084F8   JAL gui_togglepattern
9D02C560  00000000   NOP
182:                 }
9D02C564  8FBF0014   LW RA, 20(SP)
9D02C568  27BD0018   ADDIU SP, SP, 24
9D02C56C  03E00008   JR RA
9D02C570  00000000   NOP
183:                 
184:                 static void func_event_gui_pattern_color_up(int code)
185:                 {
9D02C528  27BDFFE8   ADDIU SP, SP, -24
9D02C52C  AFBF0014   SW RA, 20(SP)
186:                    if (INP_STATE_MAKE == code)
9D02C51C  24020001   ADDIU V0, ZERO, 1
9D02C520  14820007   BNE A0, V0, 0x9D02C540
9D02C524  00000000   NOP
187:                       gui_incpatterncol();
9D02C530  0F408504   JAL gui_incpatterncol
9D02C534  00000000   NOP
188:                 }
9D02C538  8FBF0014   LW RA, 20(SP)
9D02C53C  27BD0018   ADDIU SP, SP, 24
9D02C540  03E00008   JR RA
9D02C544  00000000   NOP
189:                 
190:                 static void func_event_gui_pattern_color_down(int code)
191:                 {
9D02C4FC  27BDFFE8   ADDIU SP, SP, -24
9D02C500  AFBF0014   SW RA, 20(SP)
192:                    if (INP_STATE_MAKE == code)
9D02C4F0  24020001   ADDIU V0, ZERO, 1
9D02C4F4  14820007   BNE A0, V0, 0x9D02C514
9D02C4F8  00000000   NOP
193:                       gui_decpatterncol();
9D02C504  0F4084FC   JAL gui_decpatterncol
9D02C508  00000000   NOP
194:                 }
9D02C50C  8FBF0014   LW RA, 20(SP)
9D02C510  27BD0018   ADDIU SP, SP, 24
9D02C514  03E00008   JR RA
9D02C518  00000000   NOP
195:                 
196:                 static void func_event_gui_toggle_fps(int code)
197:                 {
9D02C4D0  27BDFFE8   ADDIU SP, SP, -24
9D02C4D4  AFBF0014   SW RA, 20(SP)
198:                    if (INP_STATE_MAKE == code)
9D02C4C4  24020001   ADDIU V0, ZERO, 1
9D02C4C8  14820007   BNE A0, V0, 0x9D02C4E8
9D02C4CC  00000000   NOP
199:                       gui_togglefps();
9D02C4D8  0F4084DF   JAL gui_togglefps
9D02C4DC  00000000   NOP
200:                 }
9D02C4E0  8FBF0014   LW RA, 20(SP)
9D02C4E4  27BD0018   ADDIU SP, SP, 24
9D02C4E8  03E00008   JR RA
9D02C4EC  00000000   NOP
201:                 
202:                 static void func_event_gui_display_info(int code)
203:                 {
9D02C4A4  27BDFFE8   ADDIU SP, SP, -24
9D02C4A8  AFBF0014   SW RA, 20(SP)
204:                    if (INP_STATE_MAKE == code)
9D02C498  24020001   ADDIU V0, ZERO, 1
9D02C49C  14820007   BNE A0, V0, 0x9D02C4BC
9D02C4A0  00000000   NOP
205:                       gui_displayinfo();
9D02C4AC  0F408687   JAL gui_displayinfo
9D02C4B0  00000000   NOP
206:                 }
9D02C4B4  8FBF0014   LW RA, 20(SP)
9D02C4B8  27BD0018   ADDIU SP, SP, 24
9D02C4BC  03E00008   JR RA
9D02C4C0  00000000   NOP
207:                 
208:                 static void func_event_gui_toggle(int code)
209:                 {
9D02C478  27BDFFE8   ADDIU SP, SP, -24
9D02C47C  AFBF0014   SW RA, 20(SP)
210:                    if (INP_STATE_MAKE == code)
9D02C46C  24020001   ADDIU V0, ZERO, 1
9D02C470  14820007   BNE A0, V0, 0x9D02C490
9D02C474  00000000   NOP
211:                       gui_togglegui();
9D02C480  0F4084E3   JAL gui_togglegui
9D02C484  00000000   NOP
212:                 }
9D02C488  8FBF0014   LW RA, 20(SP)
9D02C48C  27BD0018   ADDIU SP, SP, 24
9D02C490  03E00008   JR RA
9D02C494  00000000   NOP
213:                 
214:                 static void func_event_toggle_channel_0(int code)
215:                 {
9D02C44C  27BDFFE8   ADDIU SP, SP, -24
9D02C450  AFBF0014   SW RA, 20(SP)
216:                    if (INP_STATE_MAKE == code)
9D02C440  24020001   ADDIU V0, ZERO, 1
9D02C444  14820007   BNE A0, V0, 0x9D02C464
9D02C448  00000000   NOP
217:                       gui_toggle_chan(0);
9D02C454  0F408693   JAL gui_toggle_chan
9D02C458  00002021   ADDU A0, ZERO, ZERO
218:                 }
9D02C45C  8FBF0014   LW RA, 20(SP)
9D02C460  27BD0018   ADDIU SP, SP, 24
9D02C464  03E00008   JR RA
9D02C468  00000000   NOP
219:                 
220:                 static void func_event_toggle_channel_1(int code)
221:                 {
9D02C420  27BDFFE8   ADDIU SP, SP, -24
9D02C424  AFBF0014   SW RA, 20(SP)
222:                    if (INP_STATE_MAKE == code)
9D02C414  24020001   ADDIU V0, ZERO, 1
9D02C418  14820007   BNE A0, V0, 0x9D02C438
9D02C41C  00000000   NOP
223:                       gui_toggle_chan(1);
9D02C428  0F408693   JAL gui_toggle_chan
9D02C42C  24040001   ADDIU A0, ZERO, 1
224:                 }
9D02C430  8FBF0014   LW RA, 20(SP)
9D02C434  27BD0018   ADDIU SP, SP, 24
9D02C438  03E00008   JR RA
9D02C43C  00000000   NOP
225:                 
226:                 static void func_event_toggle_channel_2(int code)
227:                 {
9D02C3F4  27BDFFE8   ADDIU SP, SP, -24
9D02C3F8  AFBF0014   SW RA, 20(SP)
228:                    if (INP_STATE_MAKE == code)
9D02C3E8  24020001   ADDIU V0, ZERO, 1
9D02C3EC  14820007   BNE A0, V0, 0x9D02C40C
9D02C3F0  00000000   NOP
229:                       gui_toggle_chan(2);
9D02C3FC  0F408693   JAL gui_toggle_chan
9D02C400  24040002   ADDIU A0, ZERO, 2
230:                 }
9D02C404  8FBF0014   LW RA, 20(SP)
9D02C408  27BD0018   ADDIU SP, SP, 24
9D02C40C  03E00008   JR RA
9D02C410  00000000   NOP
231:                 
232:                 static void func_event_toggle_channel_3(int code)
233:                 {
9D02C3C8  27BDFFE8   ADDIU SP, SP, -24
9D02C3CC  AFBF0014   SW RA, 20(SP)
234:                    if (INP_STATE_MAKE == code)
9D02C3BC  24020001   ADDIU V0, ZERO, 1
9D02C3C0  14820007   BNE A0, V0, 0x9D02C3E0
9D02C3C4  00000000   NOP
235:                       gui_toggle_chan(3);
9D02C3D0  0F408693   JAL gui_toggle_chan
9D02C3D4  24040003   ADDIU A0, ZERO, 3
236:                 }
9D02C3D8  8FBF0014   LW RA, 20(SP)
9D02C3DC  27BD0018   ADDIU SP, SP, 24
9D02C3E0  03E00008   JR RA
9D02C3E4  00000000   NOP
237:                 
238:                 static void func_event_toggle_channel_4(int code)
239:                 {
9D02C39C  27BDFFE8   ADDIU SP, SP, -24
9D02C3A0  AFBF0014   SW RA, 20(SP)
240:                    if (INP_STATE_MAKE == code)
9D02C390  24020001   ADDIU V0, ZERO, 1
9D02C394  14820007   BNE A0, V0, 0x9D02C3B4
9D02C398  00000000   NOP
241:                       gui_toggle_chan(4);
9D02C3A4  0F408693   JAL gui_toggle_chan
9D02C3A8  24040004   ADDIU A0, ZERO, 4
242:                 }
9D02C3AC  8FBF0014   LW RA, 20(SP)
9D02C3B0  27BD0018   ADDIU SP, SP, 24
9D02C3B4  03E00008   JR RA
9D02C3B8  00000000   NOP
243:                 
244:                 static void func_event_toggle_channel_5(int code)
245:                 {
9D02C370  27BDFFE8   ADDIU SP, SP, -24
9D02C374  AFBF0014   SW RA, 20(SP)
246:                    if (INP_STATE_MAKE == code)
9D02C364  24020001   ADDIU V0, ZERO, 1
9D02C368  14820007   BNE A0, V0, 0x9D02C388
9D02C36C  00000000   NOP
247:                       gui_toggle_chan(5);
9D02C378  0F408693   JAL gui_toggle_chan
9D02C37C  24040005   ADDIU A0, ZERO, 5
248:                 }
9D02C380  8FBF0014   LW RA, 20(SP)
9D02C384  27BD0018   ADDIU SP, SP, 24
9D02C388  03E00008   JR RA
9D02C38C  00000000   NOP
249:                 
250:                 static void func_event_set_filter_0(int code)
251:                 {
9D02C344  27BDFFE8   ADDIU SP, SP, -24
9D02C348  AFBF0014   SW RA, 20(SP)
252:                    if (INP_STATE_MAKE == code)
9D02C338  24020001   ADDIU V0, ZERO, 1
9D02C33C  14820007   BNE A0, V0, 0x9D02C35C
9D02C340  00000000   NOP
253:                       gui_setfilter(0);
9D02C34C  0F4086C6   JAL gui_setfilter
9D02C350  00002021   ADDU A0, ZERO, ZERO
254:                 }
9D02C354  8FBF0014   LW RA, 20(SP)
9D02C358  27BD0018   ADDIU SP, SP, 24
9D02C35C  03E00008   JR RA
9D02C360  00000000   NOP
255:                 
256:                 static void func_event_set_filter_1(int code)
257:                 {
9D02C318  27BDFFE8   ADDIU SP, SP, -24
9D02C31C  AFBF0014   SW RA, 20(SP)
258:                    if (INP_STATE_MAKE == code)
9D02C30C  24020001   ADDIU V0, ZERO, 1
9D02C310  14820007   BNE A0, V0, 0x9D02C330
9D02C314  00000000   NOP
259:                       gui_setfilter(1);
9D02C320  0F4086C6   JAL gui_setfilter
9D02C324  24040001   ADDIU A0, ZERO, 1
260:                 }
9D02C328  8FBF0014   LW RA, 20(SP)
9D02C32C  27BD0018   ADDIU SP, SP, 24
9D02C330  03E00008   JR RA
9D02C334  00000000   NOP
261:                 
262:                 static void func_event_set_filter_2(int code)
263:                 {
9D02C2EC  27BDFFE8   ADDIU SP, SP, -24
9D02C2F0  AFBF0014   SW RA, 20(SP)
264:                    if (INP_STATE_MAKE == code)
9D02C2E0  24020001   ADDIU V0, ZERO, 1
9D02C2E4  14820007   BNE A0, V0, 0x9D02C304
9D02C2E8  00000000   NOP
265:                       gui_setfilter(2);
9D02C2F4  0F4086C6   JAL gui_setfilter
9D02C2F8  24040002   ADDIU A0, ZERO, 2
266:                 }
9D02C2FC  8FBF0014   LW RA, 20(SP)
9D02C300  27BD0018   ADDIU SP, SP, 24
9D02C304  03E00008   JR RA
9D02C308  00000000   NOP
267:                 
268:                 static void func_event_toggle_sprites(int code)
269:                 {
9D02C2C0  27BDFFE8   ADDIU SP, SP, -24
9D02C2C4  AFBF0014   SW RA, 20(SP)
270:                    if (INP_STATE_MAKE == code)
9D02C2B4  24020001   ADDIU V0, ZERO, 1
9D02C2B8  14820007   BNE A0, V0, 0x9D02C2D8
9D02C2BC  00000000   NOP
271:                       gui_togglesprites();
9D02C2C8  0F40865E   JAL gui_togglesprites
9D02C2CC  00000000   NOP
272:                 }
9D02C2D0  8FBF0014   LW RA, 20(SP)
9D02C2D4  27BD0018   ADDIU SP, SP, 24
9D02C2D8  03E00008   JR RA
9D02C2DC  00000000   NOP
273:                 
274:                 static void func_event_palette_hue_up(int code)
275:                 {
9D02C258  27BDFFE8   ADDIU SP, SP, -24
9D02C25C  AFBF0014   SW RA, 20(SP)
9D02C260  AFB00010   SW S0, 16(SP)
276:                    /* make sure we don't have a VS game */
277:                    if (nes_getcontextptr()->rominfo->flags & ROM_FLAG_VERSUS)
9D02C264  0F4097E7   JAL nes_getcontextptr
9D02C268  00808021   ADDU S0, A0, ZERO
9D02C26C  8C420310   LW V0, 784(V0)
9D02C270  90430028   LBU V1, 40(V0)
9D02C274  30640008   ANDI A0, V1, 8
9D02C278  308500FF   ANDI A1, A0, 255
9D02C27C  14A00009   BNE A1, ZERO, .LVL81
9D02C280  24060001   ADDIU A2, ZERO, 1
278:                       return;
279:                 
280:                    if (INP_STATE_MAKE == code)
9D02C284  16060008   BNE S0, A2, 0x9D02C2A8
9D02C288  8FBF0014   LW RA, 20(SP)
281:                    {
282:                       pal_inchue();
9D02C28C  0F40DAF0   JAL pal_inchue
9D02C290  00000000   NOP
283:                       ppu_setdefaultpal(nes_getcontextptr()->ppu);
9D02C294  0F4097E7   JAL nes_getcontextptr
9D02C298  00000000   NOP
9D02C29C  0F405C58   JAL ppu_setdefaultpal
9D02C2A0  8C440304   LW A0, 772(V0)
284:                    }
285:                 }
9D02C2A4  8FBF0014   LW RA, 20(SP)
9D02C2A8  8FB00010   LW S0, 16(SP)
9D02C2AC  03E00008   JR RA
9D02C2B0  27BD0018   ADDIU SP, SP, 24
286:                 
287:                 static void func_event_palette_hue_down(int code)
288:                 {
9D02C1FC  27BDFFE8   ADDIU SP, SP, -24
9D02C200  AFBF0014   SW RA, 20(SP)
9D02C204  AFB00010   SW S0, 16(SP)
289:                    /* make sure we don't have a VS game */
290:                    if (nes_getcontextptr()->rominfo->flags & ROM_FLAG_VERSUS)
9D02C208  0F4097E7   JAL nes_getcontextptr
9D02C20C  00808021   ADDU S0, A0, ZERO
9D02C210  8C420310   LW V0, 784(V0)
9D02C214  90430028   LBU V1, 40(V0)
9D02C218  30640008   ANDI A0, V1, 8
9D02C21C  308500FF   ANDI A1, A0, 255
9D02C220  14A00009   BNE A1, ZERO, .LVL75
9D02C224  24060001   ADDIU A2, ZERO, 1
291:                       return;
292:                 
293:                    if (INP_STATE_MAKE == code)
9D02C228  16060008   BNE S0, A2, 0x9D02C24C
9D02C22C  8FBF0014   LW RA, 20(SP)
294:                    {
295:                       pal_dechue();
9D02C230  0F40DADF   JAL pal_dechue
9D02C234  00000000   NOP
296:                       ppu_setdefaultpal(nes_getcontextptr()->ppu);
9D02C238  0F4097E7   JAL nes_getcontextptr
9D02C23C  00000000   NOP
9D02C240  0F405C58   JAL ppu_setdefaultpal
9D02C244  8C440304   LW A0, 772(V0)
297:                    }
298:                 }
9D02C248  8FBF0014   LW RA, 20(SP)
9D02C24C  8FB00010   LW S0, 16(SP)
9D02C250  03E00008   JR RA
9D02C254  27BD0018   ADDIU SP, SP, 24
299:                 
300:                 static void func_event_palette_tint_up(int code)
301:                 {
9D02C1A0  27BDFFE8   ADDIU SP, SP, -24
9D02C1A4  AFBF0014   SW RA, 20(SP)
9D02C1A8  AFB00010   SW S0, 16(SP)
302:                    /* make sure we don't have a VS game */
303:                    if (nes_getcontextptr()->rominfo->flags & ROM_FLAG_VERSUS)
9D02C1AC  0F4097E7   JAL nes_getcontextptr
9D02C1B0  00808021   ADDU S0, A0, ZERO
9D02C1B4  8C420310   LW V0, 784(V0)
9D02C1B8  90430028   LBU V1, 40(V0)
9D02C1BC  30640008   ANDI A0, V1, 8
9D02C1C0  308500FF   ANDI A1, A0, 255
9D02C1C4  14A00009   BNE A1, ZERO, .LVL69
9D02C1C8  24060001   ADDIU A2, ZERO, 1
304:                       return;
305:                 
306:                    if (INP_STATE_MAKE == code)
9D02C1CC  16060008   BNE S0, A2, 0x9D02C1F0
9D02C1D0  8FBF0014   LW RA, 20(SP)
307:                    {
308:                       pal_inctint();
9D02C1D4  0F40DB12   JAL pal_inctint
9D02C1D8  00000000   NOP
309:                       ppu_setdefaultpal(nes_getcontextptr()->ppu);
9D02C1DC  0F4097E7   JAL nes_getcontextptr
9D02C1E0  00000000   NOP
9D02C1E4  0F405C58   JAL ppu_setdefaultpal
9D02C1E8  8C440304   LW A0, 772(V0)
310:                    }
311:                 }
9D02C1EC  8FBF0014   LW RA, 20(SP)
9D02C1F0  8FB00010   LW S0, 16(SP)
9D02C1F4  03E00008   JR RA
9D02C1F8  27BD0018   ADDIU SP, SP, 24
312:                 
313:                 static void func_event_palette_tint_down(int code)
314:                 {
9D02C144  27BDFFE8   ADDIU SP, SP, -24
9D02C148  AFBF0014   SW RA, 20(SP)
9D02C14C  AFB00010   SW S0, 16(SP)
315:                    /* make sure we don't have a VS game */
316:                    if (nes_getcontextptr()->rominfo->flags & ROM_FLAG_VERSUS)
9D02C150  0F4097E7   JAL nes_getcontextptr
9D02C154  00808021   ADDU S0, A0, ZERO
9D02C158  8C420310   LW V0, 784(V0)
9D02C15C  90430028   LBU V1, 40(V0)
9D02C160  30640008   ANDI A0, V1, 8
9D02C164  308500FF   ANDI A1, A0, 255
9D02C168  14A00009   BNE A1, ZERO, .LVL63
9D02C16C  24060001   ADDIU A2, ZERO, 1
317:                       return;
318:                 
319:                    if (INP_STATE_MAKE == code)
9D02C170  16060008   BNE S0, A2, 0x9D02C194
9D02C174  8FBF0014   LW RA, 20(SP)
320:                    {
321:                       pal_dectint();
9D02C178  0F40DB01   JAL pal_dectint
9D02C17C  00000000   NOP
322:                       ppu_setdefaultpal(nes_getcontextptr()->ppu);
9D02C180  0F4097E7   JAL nes_getcontextptr
9D02C184  00000000   NOP
9D02C188  0F405C58   JAL ppu_setdefaultpal
9D02C18C  8C440304   LW A0, 772(V0)
323:                    }
324:                 }
9D02C190  8FBF0014   LW RA, 20(SP)
9D02C194  8FB00010   LW S0, 16(SP)
9D02C198  03E00008   JR RA
9D02C19C  27BD0018   ADDIU SP, SP, 24
325:                 
326:                 static void func_event_palette_set_default(int code)
327:                 {
9D02C0F0  27BDFFE8   ADDIU SP, SP, -24
9D02C0F4  AFBF0014   SW RA, 20(SP)
9D02C0F8  AFB00010   SW S0, 16(SP)
328:                    /* make sure we don't have a VS game */
329:                    if (nes_getcontextptr()->rominfo->flags & ROM_FLAG_VERSUS)
9D02C0FC  0F4097E7   JAL nes_getcontextptr
9D02C100  00808021   ADDU S0, A0, ZERO
9D02C104  8C420310   LW V0, 784(V0)
9D02C108  90430028   LBU V1, 40(V0)
9D02C10C  30640008   ANDI A0, V1, 8
9D02C110  308500FF   ANDI A1, A0, 255
9D02C114  14A00007   BNE A1, ZERO, .LVL57
9D02C118  24060001   ADDIU A2, ZERO, 1
330:                       return;
331:                 
332:                    if (INP_STATE_MAKE == code)
9D02C11C  16060006   BNE S0, A2, 0x9D02C138
9D02C120  8FBF0014   LW RA, 20(SP)
333:                       ppu_setdefaultpal(nes_getcontextptr()->ppu);
9D02C124  0F4097E7   JAL nes_getcontextptr
9D02C128  00000000   NOP
9D02C12C  0F405C58   JAL ppu_setdefaultpal
9D02C130  8C440304   LW A0, 772(V0)
334:                 }
9D02C134  8FBF0014   LW RA, 20(SP)
9D02C138  8FB00010   LW S0, 16(SP)
9D02C13C  03E00008   JR RA
9D02C140  27BD0018   ADDIU SP, SP, 24
335:                 
336:                 static void func_event_palette_set_shady(int code)
337:                 {
9D02C094  27BDFFE8   ADDIU SP, SP, -24
9D02C098  AFBF0014   SW RA, 20(SP)
9D02C09C  AFB00010   SW S0, 16(SP)
338:                    /* make sure we don't have a VS game */
339:                    if (nes_getcontextptr()->rominfo->flags & ROM_FLAG_VERSUS)
9D02C0A0  0F4097E7   JAL nes_getcontextptr
9D02C0A4  00808021   ADDU S0, A0, ZERO
9D02C0A8  8C420310   LW V0, 784(V0)
9D02C0AC  90430028   LBU V1, 40(V0)
9D02C0B0  30640008   ANDI A0, V1, 8
9D02C0B4  308500FF   ANDI A1, A0, 255
9D02C0B8  14A00009   BNE A1, ZERO, .LVL52
9D02C0BC  24060001   ADDIU A2, ZERO, 1
340:                       return;
341:                 
342:                    if (INP_STATE_MAKE == code)
9D02C0C0  16060008   BNE S0, A2, 0x9D02C0E4
9D02C0C4  8FBF0014   LW RA, 20(SP)
343:                       ppu_setpal(nes_getcontextptr()->ppu, shady_palette);
9D02C0C8  0F4097E7   JAL nes_getcontextptr
9D02C0CC  00000000   NOP
9D02C0D0  8C440304   LW A0, 772(V0)
9D02C0D4  3C07A001   LUI A3, -24575
9D02C0D8  0F405B4B   JAL ppu_setpal
9D02C0DC  24E53EE4   ADDIU A1, A3, 16100
344:                 }
9D02C0E0  8FBF0014   LW RA, 20(SP)
9D02C0E4  8FB00010   LW S0, 16(SP)
9D02C0E8  03E00008   JR RA
9D02C0EC  27BD0018   ADDIU SP, SP, 24
345:                 
346:                 static void func_event_joypad1_a(int code)
347:                 {
9D02C070  27BDFFE8   ADDIU SP, SP, -24
9D02C074  AFBF0014   SW RA, 20(SP)
9D02C078  00802821   ADDU A1, A0, ZERO
348:                    input_event(&kb_input, code, INP_PAD_A);
9D02C07C  27848040   ADDIU A0, GP, -32704
9D02C080  0F40D519   JAL input_event
9D02C084  24060001   ADDIU A2, ZERO, 1
349:                 }
9D02C088  8FBF0014   LW RA, 20(SP)
9D02C08C  03E00008   JR RA
9D02C090  27BD0018   ADDIU SP, SP, 24
350:                 
351:                 static void func_event_joypad1_b(int code)
352:                 {
9D02C04C  27BDFFE8   ADDIU SP, SP, -24
9D02C050  AFBF0014   SW RA, 20(SP)
9D02C054  00802821   ADDU A1, A0, ZERO
353:                    input_event(&kb_input, code, INP_PAD_B);
9D02C058  27848040   ADDIU A0, GP, -32704
9D02C05C  0F40D519   JAL input_event
9D02C060  24060002   ADDIU A2, ZERO, 2
354:                 }
9D02C064  8FBF0014   LW RA, 20(SP)
9D02C068  03E00008   JR RA
9D02C06C  27BD0018   ADDIU SP, SP, 24
355:                 
356:                 static void func_event_joypad1_start(int code)
357:                 {
9D02C028  27BDFFE8   ADDIU SP, SP, -24
9D02C02C  AFBF0014   SW RA, 20(SP)
9D02C030  00802821   ADDU A1, A0, ZERO
358:                    input_event(&kb_input, code, INP_PAD_START);
9D02C034  27848040   ADDIU A0, GP, -32704
9D02C038  0F40D519   JAL input_event
9D02C03C  24060008   ADDIU A2, ZERO, 8
359:                 }
9D02C040  8FBF0014   LW RA, 20(SP)
9D02C044  03E00008   JR RA
9D02C048  27BD0018   ADDIU SP, SP, 24
360:                 
361:                 static void func_event_joypad1_select(int code)
362:                 {
9D02C004  27BDFFE8   ADDIU SP, SP, -24
9D02C008  AFBF0014   SW RA, 20(SP)
9D02C00C  00802821   ADDU A1, A0, ZERO
363:                    input_event(&kb_input, code, INP_PAD_SELECT);
9D02C010  27848040   ADDIU A0, GP, -32704
9D02C014  0F40D519   JAL input_event
9D02C018  24060004   ADDIU A2, ZERO, 4
364:                 }
9D02C01C  8FBF0014   LW RA, 20(SP)
9D02C020  03E00008   JR RA
9D02C024  27BD0018   ADDIU SP, SP, 24
365:                 
366:                 static void func_event_joypad1_up(int code)
367:                 {
9D02BFE0  27BDFFE8   ADDIU SP, SP, -24
9D02BFE4  AFBF0014   SW RA, 20(SP)
9D02BFE8  00802821   ADDU A1, A0, ZERO
368:                    input_event(&kb_input, code, INP_PAD_UP);
9D02BFEC  27848040   ADDIU A0, GP, -32704
9D02BFF0  0F40D519   JAL input_event
9D02BFF4  24060010   ADDIU A2, ZERO, 16
369:                 }
9D02BFF8  8FBF0014   LW RA, 20(SP)
9D02BFFC  03E00008   JR RA
9D02C000  27BD0018   ADDIU SP, SP, 24
370:                 
371:                 static void func_event_joypad1_down(int code)
372:                 {
9D02BFBC  27BDFFE8   ADDIU SP, SP, -24
9D02BFC0  AFBF0014   SW RA, 20(SP)
9D02BFC4  00802821   ADDU A1, A0, ZERO
373:                    input_event(&kb_input, code, INP_PAD_DOWN);
9D02BFC8  27848040   ADDIU A0, GP, -32704
9D02BFCC  0F40D519   JAL input_event
9D02BFD0  24060020   ADDIU A2, ZERO, 32
374:                 }
9D02BFD4  8FBF0014   LW RA, 20(SP)
9D02BFD8  03E00008   JR RA
9D02BFDC  27BD0018   ADDIU SP, SP, 24
375:                 
376:                 static void func_event_joypad1_left(int code)
377:                 {
9D02BF98  27BDFFE8   ADDIU SP, SP, -24
9D02BF9C  AFBF0014   SW RA, 20(SP)
9D02BFA0  00802821   ADDU A1, A0, ZERO
378:                    input_event(&kb_input, code, INP_PAD_LEFT);
9D02BFA4  27848040   ADDIU A0, GP, -32704
9D02BFA8  0F40D519   JAL input_event
9D02BFAC  24060040   ADDIU A2, ZERO, 64
379:                 }
9D02BFB0  8FBF0014   LW RA, 20(SP)
9D02BFB4  03E00008   JR RA
9D02BFB8  27BD0018   ADDIU SP, SP, 24
380:                 
381:                 static void func_event_joypad1_right(int code)
382:                 {
9D02BF74  27BDFFE8   ADDIU SP, SP, -24
9D02BF78  AFBF0014   SW RA, 20(SP)
9D02BF7C  00802821   ADDU A1, A0, ZERO
383:                    input_event(&kb_input, code, INP_PAD_RIGHT);
9D02BF80  27848040   ADDIU A0, GP, -32704
9D02BF84  0F40D519   JAL input_event
9D02BF88  24060080   ADDIU A2, ZERO, 128
384:                 }
9D02BF8C  8FBF0014   LW RA, 20(SP)
9D02BF90  03E00008   JR RA
9D02BF94  27BD0018   ADDIU SP, SP, 24
385:                 
386:                 static void func_event_joypad2_a(int code)
387:                 {
9D02BF50  27BDFFE8   ADDIU SP, SP, -24
9D02BF54  AFBF0014   SW RA, 20(SP)
9D02BF58  00802821   ADDU A1, A0, ZERO
388:                    input_event(&kb_alt_input, code, INP_PAD_A);
9D02BF5C  27848038   ADDIU A0, GP, -32712
9D02BF60  0F40D519   JAL input_event
9D02BF64  24060001   ADDIU A2, ZERO, 1
389:                 }
9D02BF68  8FBF0014   LW RA, 20(SP)
9D02BF6C  03E00008   JR RA
9D02BF70  27BD0018   ADDIU SP, SP, 24
390:                 
391:                 static void func_event_joypad2_b(int code)
392:                 {
9D02BF2C  27BDFFE8   ADDIU SP, SP, -24
9D02BF30  AFBF0014   SW RA, 20(SP)
9D02BF34  00802821   ADDU A1, A0, ZERO
393:                    input_event(&kb_alt_input, code, INP_PAD_B);
9D02BF38  27848038   ADDIU A0, GP, -32712
9D02BF3C  0F40D519   JAL input_event
9D02BF40  24060002   ADDIU A2, ZERO, 2
394:                 }
9D02BF44  8FBF0014   LW RA, 20(SP)
9D02BF48  03E00008   JR RA
9D02BF4C  27BD0018   ADDIU SP, SP, 24
395:                 
396:                 static void func_event_joypad2_start(int code)
397:                 {
9D02BF08  27BDFFE8   ADDIU SP, SP, -24
9D02BF0C  AFBF0014   SW RA, 20(SP)
9D02BF10  00802821   ADDU A1, A0, ZERO
398:                    input_event(&kb_alt_input, code, INP_PAD_START);
9D02BF14  27848038   ADDIU A0, GP, -32712
9D02BF18  0F40D519   JAL input_event
9D02BF1C  24060008   ADDIU A2, ZERO, 8
399:                 }
9D02BF20  8FBF0014   LW RA, 20(SP)
9D02BF24  03E00008   JR RA
9D02BF28  27BD0018   ADDIU SP, SP, 24
400:                 
401:                 static void func_event_joypad2_select(int code)
402:                 {
9D02BEE4  27BDFFE8   ADDIU SP, SP, -24
9D02BEE8  AFBF0014   SW RA, 20(SP)
9D02BEEC  00802821   ADDU A1, A0, ZERO
403:                    input_event(&kb_alt_input, code, INP_PAD_SELECT);
9D02BEF0  27848038   ADDIU A0, GP, -32712
9D02BEF4  0F40D519   JAL input_event
9D02BEF8  24060004   ADDIU A2, ZERO, 4
404:                 }
9D02BEFC  8FBF0014   LW RA, 20(SP)
9D02BF00  03E00008   JR RA
9D02BF04  27BD0018   ADDIU SP, SP, 24
405:                 
406:                 static void func_event_joypad2_up(int code)
407:                 {
9D02BEC0  27BDFFE8   ADDIU SP, SP, -24
9D02BEC4  AFBF0014   SW RA, 20(SP)
9D02BEC8  00802821   ADDU A1, A0, ZERO
408:                    input_event(&kb_alt_input, code, INP_PAD_UP);
9D02BECC  27848038   ADDIU A0, GP, -32712
9D02BED0  0F40D519   JAL input_event
9D02BED4  24060010   ADDIU A2, ZERO, 16
409:                 }
9D02BED8  8FBF0014   LW RA, 20(SP)
9D02BEDC  03E00008   JR RA
9D02BEE0  27BD0018   ADDIU SP, SP, 24
410:                 
411:                 static void func_event_joypad2_down(int code)
412:                 {
9D02BE9C  27BDFFE8   ADDIU SP, SP, -24
9D02BEA0  AFBF0014   SW RA, 20(SP)
9D02BEA4  00802821   ADDU A1, A0, ZERO
413:                    input_event(&kb_alt_input, code, INP_PAD_DOWN);
9D02BEA8  27848038   ADDIU A0, GP, -32712
9D02BEAC  0F40D519   JAL input_event
9D02BEB0  24060020   ADDIU A2, ZERO, 32
414:                 }
9D02BEB4  8FBF0014   LW RA, 20(SP)
9D02BEB8  03E00008   JR RA
9D02BEBC  27BD0018   ADDIU SP, SP, 24
415:                 
416:                 static void func_event_joypad2_left(int code)
417:                 {
9D02BE78  27BDFFE8   ADDIU SP, SP, -24
9D02BE7C  AFBF0014   SW RA, 20(SP)
9D02BE80  00802821   ADDU A1, A0, ZERO
418:                    input_event(&kb_alt_input, code, INP_PAD_LEFT);
9D02BE84  27848038   ADDIU A0, GP, -32712
9D02BE88  0F40D519   JAL input_event
9D02BE8C  24060040   ADDIU A2, ZERO, 64
419:                 }
9D02BE90  8FBF0014   LW RA, 20(SP)
9D02BE94  03E00008   JR RA
9D02BE98  27BD0018   ADDIU SP, SP, 24
420:                 
421:                 static void func_event_joypad2_right(int code)
422:                 {
9D02BE54  27BDFFE8   ADDIU SP, SP, -24
9D02BE58  AFBF0014   SW RA, 20(SP)
9D02BE5C  00802821   ADDU A1, A0, ZERO
423:                    input_event(&kb_alt_input, code, INP_PAD_RIGHT);
9D02BE60  27848038   ADDIU A0, GP, -32712
9D02BE64  0F40D519   JAL input_event
9D02BE68  24060080   ADDIU A2, ZERO, 128
424:                 }
9D02BE6C  8FBF0014   LW RA, 20(SP)
9D02BE70  03E00008   JR RA
9D02BE74  27BD0018   ADDIU SP, SP, 24
425:                 
426:                 static void func_event_songup(int code)
427:                 {
428:                 }
429:                 
430:                 static void func_event_songdown(int code)
431:                 {
432:                 }
433:                 
434:                 static void func_event_startsong(int code)
435:                 {
436:                 }
437:                 
438:                 /* NES events */
439:                 static event_t nes_events[] =
440:                 {
441:                    NULL, /* 0 */
442:                    func_event_quit,
443:                    func_event_insert,
444:                    func_event_eject,
445:                    func_event_togglepause,
446:                    func_event_soft_reset,
447:                    func_event_hard_reset,
448:                    func_event_snapshot,
449:                    func_event_toggle_frameskip,
450:                    /* saves */
451:                    func_event_state_save,
452:                    func_event_state_load, /* 10 */
453:                    func_event_state_slot_0,
454:                    func_event_state_slot_1,
455:                    func_event_state_slot_2,
456:                    func_event_state_slot_3,
457:                    func_event_state_slot_4,
458:                    func_event_state_slot_5,
459:                    func_event_state_slot_6,
460:                    func_event_state_slot_7,
461:                    func_event_state_slot_8,
462:                    func_event_state_slot_9, /* 20 */
463:                    /* GUI */
464:                    func_event_gui_toggle_oam,
465:                    func_event_gui_toggle_wave,
466:                    func_event_gui_toggle_pattern,
467:                    func_event_gui_pattern_color_up,
468:                    func_event_gui_pattern_color_down,
469:                    func_event_gui_toggle_fps,
470:                    func_event_gui_display_info,
471:                    func_event_gui_toggle,
472:                    /* sound */
473:                    func_event_toggle_channel_0,
474:                    func_event_toggle_channel_1, /* 30 */
475:                    func_event_toggle_channel_2,
476:                    func_event_toggle_channel_3,
477:                    func_event_toggle_channel_4,
478:                    func_event_toggle_channel_5,
479:                    func_event_set_filter_0,
480:                    func_event_set_filter_1,
481:                    func_event_set_filter_2,
482:                    /* picture */
483:                    func_event_toggle_sprites,
484:                    func_event_palette_hue_up,
485:                    func_event_palette_hue_down,
486:                    func_event_palette_tint_up, /* 40 */
487:                    func_event_palette_tint_down,
488:                    func_event_palette_set_default,
489:                    func_event_palette_set_shady,
490:                    /* joypad 1 */
491:                    func_event_joypad1_a,
492:                    func_event_joypad1_b, 
493:                    func_event_joypad1_start,
494:                    func_event_joypad1_select,
495:                    func_event_joypad1_up,
496:                    func_event_joypad1_down,
497:                    func_event_joypad1_left, /* 50 */
498:                    func_event_joypad1_right,
499:                    /* joypad 2 */
500:                    func_event_joypad2_a,
501:                    func_event_joypad2_b,
502:                    func_event_joypad2_start,
503:                    func_event_joypad2_select,
504:                    func_event_joypad2_up,
505:                    func_event_joypad2_down,
506:                    func_event_joypad2_left,
507:                    func_event_joypad2_right,
508:                    /* NSF control */
509:                    NULL, /* 60 */
510:                    NULL,
511:                    NULL,
512:                    /* OS-specific */
513:                    NULL,
514:                    NULL,
515:                    NULL,
516:                    NULL,
517:                    NULL,
518:                    NULL,
519:                    NULL,
520:                    NULL, /* 70 */
521:                    NULL,
522:                    /* last */
523:                    NULL
524:                 };
525:                 
526:                 
527:                 static event_t *event_system_table[NUM_SUPPORTED_SYSTEMS] =
528:                 {
529:                    NULL, /* unknown */
530:                    NULL, /* autodetect */
531:                    nes_events, /* nes */
532:                 };
533:                 
534:                 void event_init(void)
535:                 {
9D02C900  27BDFFE8   ADDIU SP, SP, -24
9D02C904  AFBF0014   SW RA, 20(SP)
536:                    input_register(&kb_input);
9D02C908  0F40D50E   JAL input_register
9D02C90C  27848040   ADDIU A0, GP, -32704
537:                    input_register(&kb_alt_input);
9D02C910  0F40D50E   JAL input_register
9D02C914  27848038   ADDIU A0, GP, -32712
538:                 }
9D02C918  8FBF0014   LW RA, 20(SP)
9D02C91C  03E00008   JR RA
9D02C920  27BD0018   ADDIU SP, SP, 24
539:                 
540:                 /* set up the event system for a certain console/system type */
541:                 void event_set_system(system_t type)
542:                 {
543:                    ASSERT(type < NUM_SUPPORTED_SYSTEMS);
544:                 
545:                    system_events = event_system_table[type];
9D02C924  00042080   SLL A0, A0, 2
9D02C928  3C029D04   LUI V0, -25340
9D02C92C  24432738   ADDIU V1, V0, 10040
9D02C930  00832821   ADDU A1, A0, V1
9D02C934  8CA60000   LW A2, 0(A1)
9D02C938  03E00008   JR RA
9D02C93C  AF8680F4   SW A2, -32524(GP)
546:                 }
547:                 
548:                 void event_set(int index, event_t handler)
549:                 {
550:                    /* now, event_set is used to set osd-specific events.  We should assume
551:                    ** (for now, at least) that these events should be used across all
552:                    ** emulated systems, so let's loop through all system event handler
553:                    ** tables and add this event...
554:                    */
555:                    int i;
556:                 
557:                    for (i = 0; i < NUM_SUPPORTED_SYSTEMS; i++)
558:                    {
559:                       if(event_system_table[i])
560:                       {
561:                          event_system_table[i][index] = handler;
9D02C940  00042080   SLL A0, A0, 2
9D02C944  3C02A001   LUI V0, -24575
9D02C948  24434528   ADDIU V1, V0, 17704
9D02C94C  00643021   ADDU A2, V1, A0
9D02C950  03E00008   JR RA
9D02C954  ACC50000   SW A1, 0(A2)
562:                       }
563:                    }
564:                 }
565:                 
566:                 event_t event_get(int index)
567:                 {
568:                    return system_events[index];
9D02C958  00042080   SLL A0, A0, 2
9D02C95C  8F8280F4   LW V0, -32524(GP)
9D02C960  00441821   ADDU V1, V0, A0
569:                 }
9D02C964  03E00008   JR RA
9D02C968  8C620000   LW V0, 0(V1)
570:                 
571:                 
572:                 /*
573:                 ** $Log: event.c,v $
574:                 ** Revision 1.3  2001/04/27 14:37:11  neil
575:                 ** wheeee
576:                 **
577:                 ** Revision 1.2  2001/04/27 11:10:08  neil
578:                 ** compile
579:                 **
580:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
581:                 ** initial
582:                 **
583:                 ** Revision 1.18  2000/11/25 20:26:05  matt
584:                 ** removed fds "system"
585:                 **
586:                 ** Revision 1.17  2000/11/09 14:05:42  matt
587:                 ** state load fixed, state save mostly fixed
588:                 **
589:                 ** Revision 1.16  2000/11/05 16:37:18  matt
590:                 ** rolled rgb.h into bitmap.h
591:                 **
592:                 ** Revision 1.15  2000/11/01 17:33:26  neil
593:                 ** little crash bugs fixed
594:                 **
595:                 ** Revision 1.14  2000/11/01 14:15:35  matt
596:                 ** multi-system event system, or whatever
597:                 **
598:                 ** Revision 1.13  2000/10/27 12:59:48  matt
599:                 ** api change for ppu palette functions
600:                 **
601:                 ** Revision 1.12  2000/10/26 22:48:05  matt
602:                 ** no need for extern
603:                 **
604:                 ** Revision 1.11  2000/10/25 00:23:16  matt
605:                 ** makefiles updated for new directory structure
606:                 **
607:                 ** Revision 1.10  2000/10/23 17:50:46  matt
608:                 ** adding fds support
609:                 **
610:                 ** Revision 1.9  2000/10/23 15:52:04  matt
611:                 ** better system handling
612:                 **
613:                 ** Revision 1.8  2000/10/22 15:01:51  matt
614:                 ** prevented palette changing in VS unisystem games
615:                 **
616:                 ** Revision 1.7  2000/10/10 13:03:54  matt
617:                 ** Mr. Clean makes a guest appearance
618:                 **
619:                 ** Revision 1.6  2000/08/16 02:58:34  matt
620:                 ** random cleanups
621:                 **
622:                 ** Revision 1.5  2000/07/27 01:15:33  matt
623:                 ** name changes
624:                 **
625:                 ** Revision 1.4  2000/07/26 21:36:13  neil
626:                 ** Big honkin' change -- see the mailing list
627:                 **
628:                 ** Revision 1.3  2000/07/23 15:17:19  matt
629:                 ** non-osd calls moved from osd.c to gui.c
630:                 **
631:                 ** Revision 1.2  2000/07/21 12:07:40  neil
632:                 ** added room in event_array for all osd events
633:                 **
634:                 ** Revision 1.1  2000/07/21 04:26:38  matt
635:                 ** initial revision
636:                 **
637:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/cpu/nes6502.c  -----------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** nes6502.c
21:                  **
22:                  ** NES custom 6502 (2A03) CPU implementation
23:                  ** $Id: nes6502.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  
27:                  #include <noftypes.h>
28:                  #include "nes6502.h"
29:                  #include "dis6502.h"
30:                  
31:                  #//define  NES6502_DISASM
32:                  
33:                  #ifdef __GNUC__
34:                  #define  NES6502_JUMPTABLE
35:                  #endif /* __GNUC__ */
36:                  
37:                  
38:                  #define  ADD_CYCLES(x) \
39:                  { \
40:                     remaining_cycles -= (x); \
41:                     cpu.total_cycles += (x); \
42:                  }
43:                  
44:                  /*
45:                  ** Check to see if an index reg addition overflowed to next page
46:                  */
47:                  #define PAGE_CROSS_CHECK(addr, reg) \
48:                  { \
49:                     if ((reg) > (uint8) (addr)) \
50:                        ADD_CYCLES(1); \
51:                  }
52:                  
53:                  #define EMPTY_READ(value)  /* empty */
54:                  
55:                  /*
56:                  ** Addressing mode macros
57:                  */
58:                  
59:                  /* Immediate */
60:                  #define IMMEDIATE_BYTE(value) \
61:                  { \
62:                     value = bank_readbyte(PC++); \
63:                  }
64:                  
65:                  /* Absolute */
66:                  #define ABSOLUTE_ADDR(address) \
67:                  { \
68:                     address = bank_readword(PC); \
69:                     PC += 2; \
70:                  }
71:                  
72:                  #define ABSOLUTE(address, value) \
73:                  { \
74:                     ABSOLUTE_ADDR(address); \
75:                     value = mem_readbyte(address); \
76:                  }
77:                  
78:                  #define ABSOLUTE_BYTE(value) \
79:                  { \
80:                     ABSOLUTE(temp, value); \
81:                  }
82:                  
83:                  /* Absolute indexed X */
84:                  #define ABS_IND_X_ADDR(address) \
85:                  { \
86:                     ABSOLUTE_ADDR(address); \
87:                     address = (address + X) & 0xFFFF; \
88:                  }
89:                  
90:                  #define ABS_IND_X(address, value) \
91:                  { \
92:                     ABS_IND_X_ADDR(address); \
93:                     value = mem_readbyte(address); \
94:                  }
95:                  
96:                  #define ABS_IND_X_BYTE(value) \
97:                  { \
98:                     ABS_IND_X(temp, value); \
99:                  }
100:                 
101:                 /* special page-cross check version for read instructions */
102:                 #define ABS_IND_X_BYTE_READ(value) \
103:                 { \
104:                    ABS_IND_X_ADDR(temp); \
105:                    PAGE_CROSS_CHECK(temp, X); \
106:                    value = mem_readbyte(temp); \
107:                 }
108:                 
109:                 /* Absolute indexed Y */
110:                 #define ABS_IND_Y_ADDR(address) \
111:                 { \
112:                    ABSOLUTE_ADDR(address); \
113:                    address = (address + Y) & 0xFFFF; \
114:                 }
115:                 
116:                 #define ABS_IND_Y(address, value) \
117:                 { \
118:                    ABS_IND_Y_ADDR(address); \
119:                    value = mem_readbyte(address); \
120:                 }
121:                 
122:                 #define ABS_IND_Y_BYTE(value) \
123:                 { \
124:                    ABS_IND_Y(temp, value); \
125:                 }
126:                 
127:                 /* special page-cross check version for read instructions */
128:                 #define ABS_IND_Y_BYTE_READ(value) \
129:                 { \
130:                    ABS_IND_Y_ADDR(temp); \
131:                    PAGE_CROSS_CHECK(temp, Y); \
132:                    value = mem_readbyte(temp); \
133:                 }
134:                 
135:                 /* Zero-page */
136:                 #define ZERO_PAGE_ADDR(address) \
137:                 { \
138:                    IMMEDIATE_BYTE(address); \
139:                 }
140:                 
141:                 #define ZERO_PAGE(address, value) \
142:                 { \
143:                    ZERO_PAGE_ADDR(address); \
144:                    value = ZP_READBYTE(address); \
145:                 }
146:                 
147:                 #define ZERO_PAGE_BYTE(value) \
148:                 { \
149:                    ZERO_PAGE(btemp, value); \
150:                 }
151:                 
152:                 /* Zero-page indexed X */
153:                 #define ZP_IND_X_ADDR(address) \
154:                 { \
155:                    ZERO_PAGE_ADDR(address); \
156:                    address += X; \
157:                 }
158:                 
159:                 #define ZP_IND_X(address, value) \
160:                 { \
161:                    ZP_IND_X_ADDR(address); \
162:                    value = ZP_READBYTE(address); \
163:                 }
164:                 
165:                 #define ZP_IND_X_BYTE(value) \
166:                 { \
167:                    ZP_IND_X(btemp, value); \
168:                 }
169:                 
170:                 /* Zero-page indexed Y */
171:                 /* Not really an adressing mode, just for LDx/STx */
172:                 #define ZP_IND_Y_ADDR(address) \
173:                 { \
174:                    ZERO_PAGE_ADDR(address); \
175:                    address += Y; \
176:                 }
177:                 
178:                 #define ZP_IND_Y_BYTE(value) \
179:                 { \
180:                    ZP_IND_Y_ADDR(btemp); \
181:                    value = ZP_READBYTE(btemp); \
182:                 }  
183:                 
184:                 /* Indexed indirect */
185:                 #define INDIR_X_ADDR(address) \
186:                 { \
187:                    ZERO_PAGE_ADDR(btemp); \
188:                    btemp += X; \
189:                    address = zp_readword(btemp); \
190:                 }
191:                 
192:                 #define INDIR_X(address, value) \
193:                 { \
194:                    INDIR_X_ADDR(address); \
195:                    value = mem_readbyte(address); \
196:                 } 
197:                 
198:                 #define INDIR_X_BYTE(value) \
199:                 { \
200:                    INDIR_X(temp, value); \
201:                 }
202:                 
203:                 /* Indirect indexed */
204:                 #define INDIR_Y_ADDR(address) \
205:                 { \
206:                    ZERO_PAGE_ADDR(btemp); \
207:                    address = (zp_readword(btemp) + Y) & 0xFFFF; \
208:                 }
209:                 
210:                 #define INDIR_Y(address, value) \
211:                 { \
212:                    INDIR_Y_ADDR(address); \
213:                    value = mem_readbyte(address); \
214:                 } 
215:                 
216:                 #define INDIR_Y_BYTE(value) \
217:                 { \
218:                    INDIR_Y(temp, value); \
219:                 }
220:                 
221:                 /* special page-cross check version for read instructions */
222:                 #define INDIR_Y_BYTE_READ(value) \
223:                 { \
224:                    INDIR_Y_ADDR(temp); \
225:                    PAGE_CROSS_CHECK(temp, Y); \
226:                    value = mem_readbyte(temp); \
227:                 }
228:                 
229:                 
230:                 
231:                 /* Stack push/pull */
232:                 #define  PUSH(value)             stack[S--] = (uint8) (value)
233:                 #define  PULL()                  stack[++S]
234:                 
235:                 
236:                 /*
237:                 ** flag register helper macros
238:                 */
239:                 
240:                 /* Theory: Z and N flags are set in just about every
241:                 ** instruction, so we will just store the value in those
242:                 ** flag variables, and mask out the irrelevant data when
243:                 ** we need to check them (branches, etc).  This makes the
244:                 ** zero flag only really be 'set' when z_flag == 0.
245:                 ** The rest of the flags are stored as true booleans.
246:                 */
247:                 
248:                 /* Scatter flags to separate variables */
249:                 #define  SCATTER_FLAGS(value) \
250:                 { \
251:                    n_flag = (value) & N_FLAG; \
252:                    v_flag = (value) & V_FLAG; \
253:                    b_flag = (value) & B_FLAG; \
254:                    d_flag = (value) & D_FLAG; \
255:                    i_flag = (value) & I_FLAG; \
256:                    z_flag = (0 == ((value) & Z_FLAG)); \
257:                    c_flag = (value) & C_FLAG; \
258:                 }
259:                 
260:                 /* Combine flags into flag register */
261:                 #define  COMBINE_FLAGS() \
262:                 ( \
263:                    (n_flag & N_FLAG) \
264:                    | (v_flag ? V_FLAG : 0) \
265:                    | R_FLAG \
266:                    | (b_flag ? B_FLAG : 0) \
267:                    | (d_flag ? D_FLAG : 0) \
268:                    | (i_flag ? I_FLAG : 0) \
269:                    | (z_flag ? 0 : Z_FLAG) \
270:                    | c_flag \
271:                 )
272:                 
273:                 /* Set N and Z flags based on given value */
274:                 #define  SET_NZ_FLAGS(value)     n_flag = z_flag = (value);
275:                 
276:                 /* For BCC, BCS, BEQ, BMI, BNE, BPL, BVC, BVS */
277:                 #define RELATIVE_BRANCH(condition) \
278:                 { \
279:                    if (condition) \
280:                    { \
281:                       IMMEDIATE_BYTE(btemp); \
282:                       if (((int8) btemp + (PC & 0x00FF)) & 0x100) \
283:                          ADD_CYCLES(1); \
284:                       ADD_CYCLES(3); \
285:                       PC += (int8) btemp; \
286:                    } \
287:                    else \
288:                    { \
289:                       PC++; \
290:                       ADD_CYCLES(2); \
291:                    } \
292:                 }
293:                 
294:                 #define JUMP(address) \
295:                 { \
296:                    PC = bank_readword((address)); \
297:                 }
298:                 
299:                 /*
300:                 ** Interrupt macros
301:                 */
302:                 #define NMI_PROC() \
303:                 { \
304:                    PUSH(PC >> 8); \
305:                    PUSH(PC & 0xFF); \
306:                    b_flag = 0; \
307:                    PUSH(COMBINE_FLAGS()); \
308:                    i_flag = 1; \
309:                    JUMP(NMI_VECTOR); \
310:                 }
311:                 
312:                 #define IRQ_PROC() \
313:                 { \
314:                    PUSH(PC >> 8); \
315:                    PUSH(PC & 0xFF); \
316:                    b_flag = 0; \
317:                    PUSH(COMBINE_FLAGS()); \
318:                    i_flag = 1; \
319:                    JUMP(IRQ_VECTOR); \
320:                 }
321:                 
322:                 /*
323:                 ** Instruction macros
324:                 */
325:                 
326:                 /* Warning! NES CPU has no decimal mode, so by default this does no BCD! */
327:                 #ifdef NES6502_DECIMAL
328:                 #define ADC(cycles, read_func) \
329:                 { \
330:                    read_func(data); \
331:                    if (d_flag) \
332:                    { \
333:                       temp = (A & 0x0F) + (data & 0x0F) + c_flag; \
334:                       if (temp >= 10) \
335:                          temp = (temp - 10) | 0x10; \
336:                       temp += (A & 0xF0) + (data & 0xF0); \
337:                       z_flag = (A + data + c_flag) & 0xFF; \
338:                       n_flag = temp; \
339:                       v_flag = ((~(A ^ data)) & (A ^ temp) & 0x80); \
340:                       if (temp > 0x90) \
341:                       { \
342:                          temp += 0x60; \
343:                          c_flag = 1; \
344:                       } \
345:                       else \
346:                       { \
347:                          c_flag = 0; \
348:                       } \
349:                       A = (uint8) temp; \
350:                    } \
351:                    else \
352:                    { \
353:                       temp = A + data + c_flag; \
354:                       c_flag = (temp >> 8) & 1; \
355:                       v_flag = ((~(A ^ data)) & (A ^ temp) & 0x80); \
356:                       A = (uint8) temp; \
357:                       SET_NZ_FLAGS(A); \
358:                    }\
359:                    ADD_CYCLES(cycles); \
360:                 }
361:                 #else
362:                 #define ADC(cycles, read_func) \
363:                 { \
364:                    read_func(data); \
365:                    temp = A + data + c_flag; \
366:                    c_flag = (temp >> 8) & 1; \
367:                    v_flag = ((~(A ^ data)) & (A ^ temp) & 0x80); \
368:                    A = (uint8) temp; \
369:                    SET_NZ_FLAGS(A); \
370:                    ADD_CYCLES(cycles); \
371:                 }
372:                 #endif /* NES6502_DECIMAL */
373:                 
374:                 /* undocumented */
375:                 #define ANC(cycles, read_func) \
376:                 { \
377:                    read_func(data); \
378:                    A &= data; \
379:                    c_flag = (n_flag & N_FLAG) >> 7; \
380:                    SET_NZ_FLAGS(A); \
381:                    ADD_CYCLES(cycles); \
382:                 }
383:                 
384:                 #define AND(cycles, read_func) \
385:                 { \
386:                    read_func(data); \
387:                    A &= data; \
388:                    SET_NZ_FLAGS(A); \
389:                    ADD_CYCLES(cycles); \
390:                 }
391:                 
392:                 /* undocumented */
393:                 #define ANE(cycles, read_func) \
394:                 { \
395:                    read_func(data); \
396:                    A = (A | 0xEE) & X & data; \
397:                    SET_NZ_FLAGS(A); \
398:                    ADD_CYCLES(cycles); \
399:                 }
400:                 
401:                 /* undocumented */
402:                 #ifdef NES6502_DECIMAL
403:                 #define ARR(cycles, read_func) \
404:                 { \
405:                    read_func(data); \
406:                    data &= A; \
407:                    if (d_flag) \
408:                    { \
409:                       temp = (data >> 1) | (c_flag << 7); \
410:                       SET_NZ_FLAGS(temp); \
411:                       v_flag = (temp ^ data) & 0x40; \
412:                       if (((data & 0x0F) + (data & 0x01)) > 5) \
413:                          temp = (temp & 0xF0) | ((temp + 0x6) & 0x0F); \
414:                       if (((data & 0xF0) + (data & 0x10)) > 0x50) \
415:                       { \
416:                          temp = (temp & 0x0F) | ((temp + 0x60) & 0xF0); \
417:                          c_flag = 1; \
418:                       } \
419:                       else \
420:                       { \
421:                          c_flag = 0; \
422:                       } \
423:                       A = (uint8) temp; \
424:                    } \
425:                    else \
426:                    { \
427:                       A = (data >> 1) | (c_flag << 7); \
428:                       SET_NZ_FLAGS(A); \
429:                       c_flag = (A & 0x40) >> 6; \
430:                       v_flag = ((A >> 6) ^ (A >> 5)) & 1; \
431:                    }\
432:                    ADD_CYCLES(cycles); \
433:                 }
434:                 #else
435:                 #define ARR(cycles, read_func) \
436:                 { \
437:                    read_func(data); \
438:                    data &= A; \
439:                    A = (data >> 1) | (c_flag << 7); \
440:                    SET_NZ_FLAGS(A); \
441:                    c_flag = (A & 0x40) >> 6; \
442:                    v_flag = ((A >> 6) ^ (A >> 5)) & 1; \
443:                    ADD_CYCLES(cycles); \
444:                 }
445:                 #endif /* NES6502_DECIMAL */
446:                 
447:                 #define ASL(cycles, read_func, write_func, addr) \
448:                 { \
449:                    read_func(addr, data); \
450:                    c_flag = data >> 7; \
451:                    data <<= 1; \
452:                    write_func(addr, data); \
453:                    SET_NZ_FLAGS(data); \
454:                    ADD_CYCLES(cycles); \
455:                 }
456:                 
457:                 #define ASL_A() \
458:                 { \
459:                    c_flag = A >> 7; \
460:                    A <<= 1; \
461:                    SET_NZ_FLAGS(A); \
462:                    ADD_CYCLES(2); \
463:                 }
464:                 
465:                 /* undocumented */
466:                 #define ASR(cycles, read_func) \
467:                 { \
468:                    read_func(data); \
469:                    data &= A; \
470:                    c_flag = data & 1; \
471:                    A = data >> 1; \
472:                    SET_NZ_FLAGS(A); \
473:                    ADD_CYCLES(cycles); \
474:                 }
475:                 
476:                 #define BCC() \
477:                 { \
478:                    RELATIVE_BRANCH(0 == c_flag); \
479:                 }
480:                 
481:                 #define BCS() \
482:                 { \
483:                    RELATIVE_BRANCH(0 != c_flag); \
484:                 }
485:                 
486:                 #define BEQ() \
487:                 { \
488:                    RELATIVE_BRANCH(0 == z_flag); \
489:                 }
490:                 
491:                 /* bit 7/6 of data move into N/V flags */
492:                 #define BIT(cycles, read_func) \
493:                 { \
494:                    read_func(data); \
495:                    n_flag = data; \
496:                    v_flag = data & V_FLAG; \
497:                    z_flag = data & A; \
498:                    ADD_CYCLES(cycles); \
499:                 }
500:                 
501:                 #define BMI() \
502:                 { \
503:                    RELATIVE_BRANCH(n_flag & N_FLAG); \
504:                 }
505:                 
506:                 #define BNE() \
507:                 { \
508:                    RELATIVE_BRANCH(0 != z_flag); \
509:                 }
510:                 
511:                 #define BPL() \
512:                 { \
513:                    RELATIVE_BRANCH(0 == (n_flag & N_FLAG)); \
514:                 }
515:                 
516:                 /* Software interrupt type thang */
517:                 #define BRK() \
518:                 { \
519:                    PC++; \
520:                    PUSH(PC >> 8); \
521:                    PUSH(PC & 0xFF); \
522:                    b_flag = 1; \
523:                    PUSH(COMBINE_FLAGS()); \
524:                    i_flag = 1; \
525:                    JUMP(IRQ_VECTOR); \
526:                    ADD_CYCLES(7); \
527:                 }
528:                 
529:                 #define BVC() \
530:                 { \
531:                    RELATIVE_BRANCH(0 == v_flag); \
532:                 }
533:                 
534:                 #define BVS() \
535:                 { \
536:                    RELATIVE_BRANCH(0 != v_flag); \
537:                 }
538:                 
539:                 #define CLC() \
540:                 { \
541:                    c_flag = 0; \
542:                    ADD_CYCLES(2); \
543:                 }
544:                 
545:                 #define CLD() \
546:                 { \
547:                    d_flag = 0; \
548:                    ADD_CYCLES(2); \
549:                 }
550:                 
551:                 #define CLI() \
552:                 { \
553:                    i_flag = 0; \
554:                    ADD_CYCLES(2); \
555:                    if (cpu.int_pending && remaining_cycles > 0) \
556:                    { \
557:                       cpu.int_pending = 0; \
558:                       IRQ_PROC(); \
559:                       ADD_CYCLES(INT_CYCLES); \
560:                    } \
561:                 }
562:                 
563:                 #define CLV() \
564:                 { \
565:                    v_flag = 0; \
566:                    ADD_CYCLES(2); \
567:                 }
568:                 
569:                 /* C is clear when data > A */ 
570:                 #define _COMPARE(reg, value) \
571:                 { \
572:                    temp = (reg) - (value); \
573:                    c_flag = ((temp & 0x100) >> 8) ^ 1; \
574:                    SET_NZ_FLAGS((uint8) temp); \
575:                 }
576:                 
577:                 #define CMP(cycles, read_func) \
578:                 { \
579:                    read_func(data); \
580:                    _COMPARE(A, data); \
581:                    ADD_CYCLES(cycles); \
582:                 }
583:                 
584:                 #define CPX(cycles, read_func) \
585:                 { \
586:                    read_func(data); \
587:                    _COMPARE(X, data); \
588:                    ADD_CYCLES(cycles); \
589:                 }
590:                 
591:                 #define CPY(cycles, read_func) \
592:                 { \
593:                    read_func(data); \
594:                    _COMPARE(Y, data); \
595:                    ADD_CYCLES(cycles); \
596:                 }
597:                 
598:                 /* undocumented */
599:                 #define DCP(cycles, read_func, write_func, addr) \
600:                 { \
601:                    read_func(addr, data); \
602:                    data--; \
603:                    write_func(addr, data); \
604:                    CMP(cycles, EMPTY_READ); \
605:                 }
606:                 
607:                 #define DEC(cycles, read_func, write_func, addr) \
608:                 { \
609:                    read_func(addr, data); \
610:                    data--; \
611:                    write_func(addr, data); \
612:                    SET_NZ_FLAGS(data); \
613:                    ADD_CYCLES(cycles); \
614:                 }
615:                 
616:                 #define DEX() \
617:                 { \
618:                    X--; \
619:                    SET_NZ_FLAGS(X); \
620:                    ADD_CYCLES(2); \
621:                 }
622:                 
623:                 #define DEY() \
624:                 { \
625:                    Y--; \
626:                    SET_NZ_FLAGS(Y); \
627:                    ADD_CYCLES(2); \
628:                 }
629:                 
630:                 /* undocumented (double-NOP) */
631:                 #define DOP(cycles) \
632:                 { \
633:                    PC++; \
634:                    ADD_CYCLES(cycles); \
635:                 }
636:                 
637:                 #define EOR(cycles, read_func) \
638:                 { \
639:                    read_func(data); \
640:                    A ^= data; \
641:                    SET_NZ_FLAGS(A); \
642:                    ADD_CYCLES(cycles); \
643:                 }
644:                 
645:                 #define INC(cycles, read_func, write_func, addr) \
646:                 { \
647:                    read_func(addr, data); \
648:                    data++; \
649:                    write_func(addr, data); \
650:                    SET_NZ_FLAGS(data); \
651:                    ADD_CYCLES(cycles); \
652:                 }
653:                 
654:                 #define INX() \
655:                 { \
656:                    X++; \
657:                    SET_NZ_FLAGS(X); \
658:                    ADD_CYCLES(2); \
659:                 }
660:                 
661:                 #define INY() \
662:                 { \
663:                    Y++; \
664:                    SET_NZ_FLAGS(Y); \
665:                    ADD_CYCLES(2); \
666:                 }
667:                 
668:                 /* undocumented */
669:                 #define ISB(cycles, read_func, write_func, addr) \
670:                 { \
671:                    read_func(addr, data); \
672:                    data++; \
673:                    write_func(addr, data); \
674:                    SBC(cycles, EMPTY_READ); \
675:                 }
676:                 
677:                 /* TODO: make this a function callback */
678:                 #ifdef NES6502_TESTOPS
679:                 #define JAM() \
680:                 { \
681:                    cpu_Jam(); \
682:                 }
683:                 #else /* !NES6502_TESTOPS */
684:                 #define JAM() \
685:                 { \
686:                    PC--; \
687:                    cpu.jammed = true; \
688:                    cpu.int_pending = 0; \
689:                    ADD_CYCLES(2); \
690:                 }
691:                 #endif /* !NES6502_TESTOPS */
692:                 
693:                 #define JMP_INDIRECT() \
694:                 { \
695:                    temp = bank_readword(PC); \
696:                    /* bug in crossing page boundaries */ \
697:                    if (0xFF == (temp & 0xFF)) \
698:                       PC = (bank_readbyte(temp & 0xFF00) << 8) | bank_readbyte(temp); \
699:                    else \
700:                       JUMP(temp); \
701:                    ADD_CYCLES(5); \
702:                 }
703:                 
704:                 #define JMP_ABSOLUTE() \
705:                 { \
706:                    JUMP(PC); \
707:                    ADD_CYCLES(3); \
708:                 }
709:                 
710:                 #define JSR() \
711:                 { \
712:                    PC++; \
713:                    PUSH(PC >> 8); \
714:                    PUSH(PC & 0xFF); \
715:                    JUMP(PC - 1); \
716:                    ADD_CYCLES(6); \
717:                 }
718:                 
719:                 /* undocumented */
720:                 #define LAS(cycles, read_func) \
721:                 { \
722:                    read_func(data); \
723:                    A = X = S = (S & data); \
724:                    SET_NZ_FLAGS(A); \
725:                    ADD_CYCLES(cycles); \
726:                 }
727:                 
728:                 /* undocumented */
729:                 #define LAX(cycles, read_func) \
730:                 { \
731:                    read_func(A); \
732:                    X = A; \
733:                    SET_NZ_FLAGS(A); \
734:                    ADD_CYCLES(cycles); \
735:                 }
736:                 
737:                 #define LDA(cycles, read_func) \
738:                 { \
739:                    read_func(A); \
740:                    SET_NZ_FLAGS(A); \
741:                    ADD_CYCLES(cycles); \
742:                 }
743:                 
744:                 #define LDX(cycles, read_func) \
745:                 { \
746:                    read_func(X); \
747:                    SET_NZ_FLAGS(X);\
748:                    ADD_CYCLES(cycles); \
749:                 }
750:                 
751:                 #define LDY(cycles, read_func) \
752:                 { \
753:                    read_func(Y); \
754:                    SET_NZ_FLAGS(Y);\
755:                    ADD_CYCLES(cycles); \
756:                 }
757:                 
758:                 #define LSR(cycles, read_func, write_func, addr) \
759:                 { \
760:                    read_func(addr, data); \
761:                    c_flag = data & 1; \
762:                    data >>= 1; \
763:                    write_func(addr, data); \
764:                    SET_NZ_FLAGS(data); \
765:                    ADD_CYCLES(cycles); \
766:                 }
767:                 
768:                 #define LSR_A() \
769:                 { \
770:                    c_flag = A & 1; \
771:                    A >>= 1; \
772:                    SET_NZ_FLAGS(A); \
773:                    ADD_CYCLES(2); \
774:                 }
775:                 
776:                 /* undocumented */
777:                 #define LXA(cycles, read_func) \
778:                 { \
779:                    read_func(data); \
780:                    A = X = ((A | 0xEE) & data); \
781:                    SET_NZ_FLAGS(A); \
782:                    ADD_CYCLES(cycles); \
783:                 }
784:                 
785:                 #define NOP() \
786:                 { \
787:                    ADD_CYCLES(2); \
788:                 }
789:                 
790:                 #define ORA(cycles, read_func) \
791:                 { \
792:                    read_func(data); \
793:                    A |= data; \
794:                    SET_NZ_FLAGS(A);\
795:                    ADD_CYCLES(cycles); \
796:                 }
797:                 
798:                 #define PHA() \
799:                 { \
800:                    PUSH(A); \
801:                    ADD_CYCLES(3); \
802:                 }
803:                 
804:                 #define PHP() \
805:                 { \
806:                    /* B flag is pushed on stack as well */ \
807:                    PUSH(COMBINE_FLAGS() | B_FLAG); \
808:                    ADD_CYCLES(3); \
809:                 }
810:                 
811:                 #define PLA() \
812:                 { \
813:                    A = PULL(); \
814:                    SET_NZ_FLAGS(A); \
815:                    ADD_CYCLES(4); \
816:                 }
817:                 
818:                 #define PLP() \
819:                 { \
820:                    btemp = PULL(); \
821:                    SCATTER_FLAGS(btemp); \
822:                    ADD_CYCLES(4); \
823:                 }
824:                 
825:                 /* undocumented */
826:                 #define RLA(cycles, read_func, write_func, addr) \
827:                 { \
828:                    read_func(addr, data); \
829:                    btemp = c_flag; \
830:                    c_flag = data >> 7; \
831:                    data = (data << 1) | btemp; \
832:                    write_func(addr, data); \
833:                    A &= data; \
834:                    SET_NZ_FLAGS(A); \
835:                    ADD_CYCLES(cycles); \
836:                 }
837:                 
838:                 /* 9-bit rotation (carry flag used for rollover) */
839:                 #define ROL(cycles, read_func, write_func, addr) \
840:                 { \
841:                    read_func(addr, data); \
842:                    btemp = c_flag; \
843:                    c_flag = data >> 7; \
844:                    data = (data << 1) | btemp; \
845:                    write_func(addr, data); \
846:                    SET_NZ_FLAGS(data); \
847:                    ADD_CYCLES(cycles); \
848:                 }
849:                 
850:                 #define ROL_A() \
851:                 { \
852:                    btemp = c_flag; \
853:                    c_flag = A >> 7; \
854:                    A = (A << 1) | btemp; \
855:                    SET_NZ_FLAGS(A); \
856:                    ADD_CYCLES(2); \
857:                 }
858:                 
859:                 #define ROR(cycles, read_func, write_func, addr) \
860:                 { \
861:                    read_func(addr, data); \
862:                    btemp = c_flag << 7; \
863:                    c_flag = data & 1; \
864:                    data = (data >> 1) | btemp; \
865:                    write_func(addr, data); \
866:                    SET_NZ_FLAGS(data); \
867:                    ADD_CYCLES(cycles); \
868:                 }
869:                 
870:                 #define ROR_A() \
871:                 { \
872:                    btemp = c_flag << 7; \
873:                    c_flag = A & 1; \
874:                    A = (A >> 1) | btemp; \
875:                    SET_NZ_FLAGS(A); \
876:                    ADD_CYCLES(2); \
877:                 }
878:                 
879:                 /* undocumented */
880:                 #define RRA(cycles, read_func, write_func, addr) \
881:                 { \
882:                    read_func(addr, data); \
883:                    btemp = c_flag << 7; \
884:                    c_flag = data & 1; \
885:                    data = (data >> 1) | btemp; \
886:                    write_func(addr, data); \
887:                    ADC(cycles, EMPTY_READ); \
888:                 }
889:                 
890:                 #define RTI() \
891:                 { \
892:                    btemp = PULL(); \
893:                    SCATTER_FLAGS(btemp); \
894:                    PC = PULL(); \
895:                    PC |= PULL() << 8; \
896:                    ADD_CYCLES(6); \
897:                    if (0 == i_flag && cpu.int_pending && remaining_cycles > 0) \
898:                    { \
899:                       cpu.int_pending = 0; \
900:                       IRQ_PROC(); \
901:                       ADD_CYCLES(INT_CYCLES); \
902:                    } \
903:                 }
904:                 
905:                 #define RTS() \
906:                 { \
907:                    PC = PULL(); \
908:                    PC = (PC | (PULL() << 8)) + 1; \
909:                    ADD_CYCLES(6); \
910:                 }
911:                 
912:                 /* undocumented */
913:                 #define SAX(cycles, read_func, write_func, addr) \
914:                 { \
915:                    read_func(addr); \
916:                    data = A & X; \
917:                    write_func(addr, data); \
918:                    ADD_CYCLES(cycles); \
919:                 }
920:                 
921:                 /* Warning! NES CPU has no decimal mode, so by default this does no BCD! */
922:                 #ifdef NES6502_DECIMAL
923:                 #define SBC(cycles, read_func) \
924:                 { \
925:                    read_func(data); \
926:                    temp = A - data - (c_flag ^ 1); \
927:                    if (d_flag) \
928:                    { \
929:                       uint8 al, ah; \
930:                       al = (A & 0x0F) - (data & 0x0F) - (c_flag ^ 1); \
931:                       ah = (A >> 4) - (data >> 4); \
932:                       if (al & 0x10) \
933:                       { \
934:                          al -= 6; \
935:                          ah--; \
936:                       } \
937:                       if (ah & 0x10) \
938:                       { \
939:                          ah -= 6; \
940:                          c_flag = 0; \
941:                       } \
942:                       else \
943:                       { \
944:                          c_flag = 1; \
945:                       } \
946:                       v_flag = (A ^ temp) & (A ^ data) & 0x80; \
947:                       SET_NZ_FLAGS(temp & 0xFF); \
948:                       A = (ah << 4) | (al & 0x0F); \
949:                    } \
950:                    else \
951:                    { \
952:                       v_flag = (A ^ temp) & (A ^ data) & 0x80; \
953:                       c_flag = ((temp & 0x100) >> 8) ^ 1; \
954:                       A = (uint8) temp; \
955:                       SET_NZ_FLAGS(A & 0xFF); \
956:                    } \
957:                    ADD_CYCLES(cycles); \
958:                 }
959:                 #else
960:                 #define SBC(cycles, read_func) \
961:                 { \
962:                    read_func(data); \
963:                    temp = A - data - (c_flag ^ 1); \
964:                    v_flag = (A ^ data) & (A ^ temp) & 0x80; \
965:                    c_flag = ((temp >> 8) & 1) ^ 1; \
966:                    A = (uint8) temp; \
967:                    SET_NZ_FLAGS(A); \
968:                    ADD_CYCLES(cycles); \
969:                 }
970:                 #endif /* NES6502_DECIMAL */
971:                 
972:                 /* undocumented */
973:                 #define SBX(cycles, read_func) \
974:                 { \
975:                    read_func(data); \
976:                    temp = (A & X) - data; \
977:                    c_flag = ((temp >> 8) & 1) ^ 1; \
978:                    X = temp & 0xFF; \
979:                    SET_NZ_FLAGS(X); \
980:                    ADD_CYCLES(cycles); \
981:                 }
982:                 
983:                 #define SEC() \
984:                 { \
985:                    c_flag = 1; \
986:                    ADD_CYCLES(2); \
987:                 }
988:                 
989:                 #define SED() \
990:                 { \
991:                    d_flag = 1; \
992:                    ADD_CYCLES(2); \
993:                 }
994:                 
995:                 #define SEI() \
996:                 { \
997:                    i_flag = 1; \
998:                    ADD_CYCLES(2); \
999:                 }
1000:                
1001:                /* undocumented */
1002:                #define SHA(cycles, read_func, write_func, addr) \
1003:                { \
1004:                   read_func(addr); \
1005:                   data = A & X & ((uint8) ((addr >> 8) + 1)); \
1006:                   write_func(addr, data); \
1007:                   ADD_CYCLES(cycles); \
1008:                }
1009:                
1010:                /* undocumented */
1011:                #define SHS(cycles, read_func, write_func, addr) \
1012:                { \
1013:                   read_func(addr); \
1014:                   S = A & X; \
1015:                   data = S & ((uint8) ((addr >> 8) + 1)); \
1016:                   write_func(addr, data); \
1017:                   ADD_CYCLES(cycles); \
1018:                }
1019:                
1020:                /* undocumented */
1021:                #define SHX(cycles, read_func, write_func, addr) \
1022:                { \
1023:                   read_func(addr); \
1024:                   data = X & ((uint8) ((addr >> 8) + 1)); \
1025:                   write_func(addr, data); \
1026:                   ADD_CYCLES(cycles); \
1027:                }
1028:                
1029:                /* undocumented */
1030:                #define SHY(cycles, read_func, write_func, addr) \
1031:                { \
1032:                   read_func(addr); \
1033:                   data = Y & ((uint8) ((addr >> 8 ) + 1)); \
1034:                   write_func(addr, data); \
1035:                   ADD_CYCLES(cycles); \
1036:                }
1037:                
1038:                /* undocumented */
1039:                #define SLO(cycles, read_func, write_func, addr) \
1040:                { \
1041:                   read_func(addr, data); \
1042:                   c_flag = data >> 7; \
1043:                   data <<= 1; \
1044:                   write_func(addr, data); \
1045:                   A |= data; \
1046:                   SET_NZ_FLAGS(A); \
1047:                   ADD_CYCLES(cycles); \
1048:                }
1049:                
1050:                /* undocumented */
1051:                #define SRE(cycles, read_func, write_func, addr) \
1052:                { \
1053:                   read_func(addr, data); \
1054:                   c_flag = data & 1; \
1055:                   data >>= 1; \
1056:                   write_func(addr, data); \
1057:                   A ^= data; \
1058:                   SET_NZ_FLAGS(A); \
1059:                   ADD_CYCLES(cycles); \
1060:                }
1061:                
1062:                #define STA(cycles, read_func, write_func, addr) \
1063:                { \
1064:                   read_func(addr); \
1065:                   write_func(addr, A); \
1066:                   ADD_CYCLES(cycles); \
1067:                }
1068:                
1069:                #define STX(cycles, read_func, write_func, addr) \
1070:                { \
1071:                   read_func(addr); \
1072:                   write_func(addr, X); \
1073:                   ADD_CYCLES(cycles); \
1074:                }
1075:                
1076:                #define STY(cycles, read_func, write_func, addr) \
1077:                { \
1078:                   read_func(addr); \
1079:                   write_func(addr, Y); \
1080:                   ADD_CYCLES(cycles); \
1081:                }
1082:                
1083:                #define TAX() \
1084:                { \
1085:                   X = A; \
1086:                   SET_NZ_FLAGS(X);\
1087:                   ADD_CYCLES(2); \
1088:                }
1089:                
1090:                #define TAY() \
1091:                { \
1092:                   Y = A; \
1093:                   SET_NZ_FLAGS(Y);\
1094:                   ADD_CYCLES(2); \
1095:                }
1096:                
1097:                /* undocumented (triple-NOP) */
1098:                #define TOP() \
1099:                { \
1100:                   PC += 2; \
1101:                   ADD_CYCLES(4); \
1102:                }
1103:                
1104:                #define TSX() \
1105:                { \
1106:                   X = S; \
1107:                   SET_NZ_FLAGS(X);\
1108:                   ADD_CYCLES(2); \
1109:                }
1110:                
1111:                #define TXA() \
1112:                { \
1113:                   A = X; \
1114:                   SET_NZ_FLAGS(A);\
1115:                   ADD_CYCLES(2); \
1116:                }
1117:                
1118:                #define TXS() \
1119:                { \
1120:                   S = X; \
1121:                   ADD_CYCLES(2); \
1122:                }
1123:                
1124:                #define TYA() \
1125:                { \
1126:                   A = Y; \
1127:                   SET_NZ_FLAGS(A); \
1128:                   ADD_CYCLES(2); \
1129:                }
1130:                
1131:                
1132:                
1133:                /* internal CPU context */
1134:                static nes6502_context cpu;
1135:                static int remaining_cycles = 0; /* so we can release timeslice */
1136:                /* memory region pointers */
1137:                static uint8 *ram = NULL, *stack = NULL;
1138:                static uint8 null_page[NES6502_BANKSIZE];
1139:                
1140:                
1141:                /*
1142:                ** Zero-page helper macros
1143:                */
1144:                
1145:                #define  ZP_READBYTE(addr)          ram[(addr)]
1146:                #define  ZP_WRITEBYTE(addr, value)  ram[(addr)] = (uint8) (value)
1147:                
1148:                #ifdef HOST_LITTLE_ENDIAN
1149:                
1150:                /* NOTE: following two functions will fail on architectures
1151:                ** which do not support byte alignment
1152:                */
1153:                INLINE uint32 zp_readword(register uint8 address)
1154:                {
1155:                   return (uint32) (*(uint16 *)(ram + address));
9D00CB14  31CF00FF   ANDI T7, T6, 255
9D00CC38  30EA00FF   ANDI T2, A3, 255
9D00CC3C  8F9F80E4   LW RA, -32540(GP)
9D00CC40  03EA3021   ADDU A2, RA, T2
9D00CC44  94C30000   LHU V1, 0(A2)
9D00CC48  AFA3002C   SW V1, 44(SP)
9D00D494  918D0000   LBU T5, 0(T4)
9D00D498  8F8E80E4   LW T6, -32540(GP)
9D00D49C  01CD2821   ADDU A1, T6, T5
9D00D4A0  94AF0000   LHU T7, 0(A1)
9D00D574  90860000   LBU A2, 0(A0)
9D00D578  8F8880E4   LW T0, -32540(GP)
9D00D57C  01064821   ADDU T1, T0, A2
9D00D580  95230000   LHU V1, 0(T1)
9D00DDF8  306E00FF   ANDI T6, V1, 255
9D00DDFC  8F8580E4   LW A1, -32540(GP)
9D00DE00  00AE7821   ADDU T7, A1, T6
9D00DEA0  332700FF   ANDI A3, T9, 255
9D00DEA4  8F8A80E4   LW T2, -32540(GP)
9D00DEA8  01475821   ADDU T3, T2, A3
9D00DEAC  95680000   LHU T0, 0(T3)
9D00DEB0  AFA8002C   SW T0, 44(SP)
9D00E770  906F0000   LBU T7, 0(V1)
9D00E774  8F9F80E4   LW RA, -32540(GP)
9D00E778  03EF2821   ADDU A1, RA, T7
9D00E77C  94B80000   LHU T8, 0(A1)
9D00E850  918D0000   LBU T5, 0(T4)
9D00E854  8F8E80E4   LW T6, -32540(GP)
9D00E858  01CD1821   ADDU V1, T6, T5
9D00E85C  946F0000   LHU T7, 0(V1)
9D00F094  304C00FF   ANDI T4, V0, 255
9D00F098  8F8480E4   LW A0, -32540(GP)
9D00F09C  008C7021   ADDU T6, A0, T4
9D00F138  31E500FF   ANDI A1, T7, 255
9D00F13C  8F8380E4   LW V1, -32540(GP)
9D00F140  0065C021   ADDU T8, V1, A1
9D00F144  971F0000   LHU RA, 0(T8)
9D00F148  AFBF002C   SW RA, 44(SP)
9D00F8CC  906B0000   LBU T3, 0(V1)
9D00F8D0  8F9F80E4   LW RA, -32540(GP)
9D00F8D4  03EB3821   ADDU A3, RA, T3
9D00F8D8  94E60000   LHU A2, 0(A3)
9D00F9A8  908F0000   LBU T7, 0(A0)
9D00F9AC  8F8580E4   LW A1, -32540(GP)
9D00F9B0  00AFC021   ADDU T8, A1, T7
9D00F9B4  97190000   LHU T9, 0(T8)
9D01016C  307F00FF   ANDI RA, V1, 255
9D010170  8F8880E4   LW T0, -32540(GP)
9D010174  011F4821   ADDU T1, T0, RA
9D010238  332B00FF   ANDI T3, T9, 255
9D01023C  8F8480E4   LW A0, -32540(GP)
9D010240  008B3821   ADDU A3, A0, T3
9D010244  94F20000   LHU S2, 0(A3)
9D010B88  906D0000   LBU T5, 0(V1)
9D010B8C  8F8C80E4   LW T4, -32540(GP)
9D010B90  018D4821   ADDU T1, T4, T5
9D010B94  953F0000   LHU RA, 0(T1)
9D010C8C  91AC0000   LBU T4, 0(T5)
9D010C90  8F8980E4   LW T1, -32540(GP)
9D010C94  012C7021   ADDU T6, T1, T4
9D010C98  95C50000   LHU A1, 0(T6)
9D0114D0  31C500FF   ANDI A1, T6, 255
9D0114D4  8F9880E4   LW T8, -32540(GP)
9D0114D8  0305F821   ADDU RA, T8, A1
9D01156C  30CA00FF   ANDI T2, A2, 255
9D011570  8F8D80E4   LW T5, -32540(GP)
9D011574  01AA1821   ADDU V1, T5, T2
9D011C0C  90EC0000   LBU T4, 0(A3)
9D011C10  8F8380E4   LW V1, -32540(GP)
9D011C14  006C7021   ADDU T6, V1, T4
9D011C18  95C80000   LHU T0, 0(T6)
9D011CAC  905F0000   LBU RA, 0(V0)
9D011CB0  8F8680E4   LW A2, -32540(GP)
9D011CB4  00DF5021   ADDU T2, A2, RA
9D011CB8  954D0000   LHU T5, 0(T2)
9D0123CC  332900FF   ANDI T1, T9, 255
9D0123D0  8F8480E4   LW A0, -32540(GP)
9D0123D4  0089F821   ADDU RA, A0, T1
9D0124FC  33DF00FF   ANDI RA, FP, 255
9D012500  8F8B80E4   LW T3, -32540(GP)
9D012504  017F7821   ADDU T7, T3, RA
9D012CE0  90C20000   LBU V0, 0(A2)
9D012CE4  8F8A80E4   LW T2, -32540(GP)
9D012CE8  0142F821   ADDU RA, T2, V0
9D012CEC  97ED0000   LHU T5, 0(RA)
9D012DB8  91340000   LBU S4, 0(T1)
9D012DBC  8F9580E4   LW S5, -32540(GP)
9D012DC0  02B45821   ADDU T3, S5, S4
9D012DC4  95640000   LHU A0, 0(T3)
9D0136E0  308600FF   ANDI A2, A0, 255
9D0136E4  8F8A80E4   LW T2, -32540(GP)
9D0136E8  0146F821   ADDU RA, T2, A2
9D01378C  30EC00FF   ANDI T4, A3, 255
9D013790  8F8E80E4   LW T6, -32540(GP)
9D013794  01CC4021   ADDU T0, T6, T4
9D013798  95170000   LHU S7, 0(T0)
9D013FE4  90690000   LBU T1, 0(V1)
9D013FE8  8F8B80E4   LW T3, -32540(GP)
9D013FEC  01697821   ADDU T7, T3, T1
9D013FF0  95F90000   LHU T9, 0(T7)
9D0140C4  91050000   LBU A1, 0(T0)
9D0140C8  8F9880E4   LW T8, -32540(GP)
9D0140CC  03051821   ADDU V1, T8, A1
9D0140D0  94690000   LHU T1, 0(V1)
9D0147B4  306600FF   ANDI A2, V1, 255
9D0147B8  8F8A80E4   LW T2, -32540(GP)
9D0147BC  0146F821   ADDU RA, T2, A2
9D014888  330B00FF   ANDI T3, T8, 255
9D01488C  8F8980E4   LW T1, -32540(GP)
9D014890  012B7821   ADDU T7, T1, T3
9D014894  95F20000   LHU S2, 0(T7)
9D015114  91180000   LBU T8, 0(T0)
9D015118  8F8580E4   LW A1, -32540(GP)
9D01511C  00B87021   ADDU T6, A1, T8
9D015120  95CB0000   LHU T3, 0(T6)
9D015218  93050000   LBU A1, 0(T8)
9D01521C  8F8E80E4   LW T6, -32540(GP)
9D015220  01C55821   ADDU T3, T6, A1
9D015224  95690000   LHU T1, 0(T3)
1156:                }
1157:                
1158:                uint32 bank_readword(register uint32 address)
1159:                {
1160:                   /* technically, this should fail if the address is $xFFF, but
1161:                   ** any code that does this would be suspect anyway, as it would
1162:                   ** be fetching a word across page boundaries, which only would
1163:                   ** make sense if the banks were physically consecutive.
1164:                   */
1165:                   return (uint32) (*(uint16 *)(cpu.mem_page[address >> NES6502_BANKSHIFT] + (address & NES6502_BANKMASK)));
9D00C29C  00041B02   SRL V1, A0, 12
9D00C2A0  00032880   SLL A1, V1, 2
9D00C2A4  3C02A001   LUI V0, -24575
9D00C2A8  24463010   ADDIU A2, V0, 12304
9D00C2AC  00A63821   ADDU A3, A1, A2
9D00C2B0  30840FFF   ANDI A0, A0, 4095
9D00C2B4  8CE80000   LW T0, 0(A3)
9D00C2B8  01044821   ADDU T1, T0, A0
1166:                }
9D00C2BC  03E00008   JR RA
9D00C2C0  95220000   LHU V0, 0(T1)
1167:                
1168:                #else /* !HOST_LITTLE_ENDIAN */
1169:                
1170:                INLINE uint32 zp_readword(register uint8 address)
1171:                {
1172:                #ifdef TARGET_CPU_PPC
1173:                   return __lhbrx(ram, address);
1174:                #else /* !TARGET_CPU_PPC */
1175:                   uint32 x = (uint32) *(uint16 *)(ram + address);
1176:                   return (x << 8) | (x >> 8);
1177:                #endif /* !TARGET_CPU_PPC */
1178:                }
1179:                
1180:                INLINE uint32 bank_readword(register uint32 address)
1181:                {
1182:                #ifdef TARGET_CPU_PPC
1183:                   return __lhbrx(cpu.mem_page[address >> NES6502_BANKSHIFT], address & NES6502_BANKMASK);
1184:                #else /* !TARGET_CPU_PPC */
1185:                   uint32 x = (uint32) *(uint16 *)(cpu.mem_page[address >> NES6502_BANKSHIFT] + (address & NES6502_BANKMASK));
1186:                   return (x << 8) | (x >> 8);
1187:                #endif /* !TARGET_CPU_PPC */
1188:                }
1189:                
1190:                #endif /* !HOST_LITTLE_ENDIAN */
1191:                
1192:                INLINE uint8 bank_readbyte(register uint32 address)
1193:                {
1194:                   return cpu.mem_page[address >> NES6502_BANKSHIFT][address & NES6502_BANKMASK];
9D00C150  00041B02   SRL V1, A0, 12
9D00C1C8  00046B02   SRL T5, A0, 12
9D00C778  00041B02   SRL V1, A0, 12
9D00C77C  00032880   SLL A1, V1, 2
9D00C780  3C02A001   LUI V0, -24575
9D00C784  24463010   ADDIU A2, V0, 12304
9D00C788  00A63821   ADDU A3, A1, A2
9D00C78C  30840FFF   ANDI A0, A0, 4095
9D00C790  8CE80000   LW T0, 0(A3)
9D00C794  01044821   ADDU T1, T0, A0
9D00C984  00111302   SRL V0, S1, 12
9D00CAAC  00026B02   SRL T5, V0, 12
9D00CAF0  00109302   SRL S2, S0, 12
9D00CB5C  0011FB02   SRL RA, S1, 12
9D00CC14  0010BB02   SRL S7, S0, 12
9D00CCA0  00116B02   SRL T5, S1, 12
9D00CCA4  000D7080   SLL T6, T5, 2
9D00CCA8  26753010   ADDIU S5, S3, 12304
9D00CCAC  01D57821   ADDU T7, T6, S5
9D00CCB0  32310FFF   ANDI S1, S1, 4095
9D00CCB4  8DF80000   LW T8, 0(T7)
9D00CCB8  0311C821   ADDU T9, T8, S1
9D00CD08  00114302   SRL T0, S1, 12
9D00CD0C  00085880   SLL T3, T0, 2
9D00CD10  26693010   ADDIU T1, S3, 12304
9D00CD14  01696021   ADDU T4, T3, T1
9D00CD18  322D0FFF   ANDI T5, S1, 4095
9D00CD1C  8D8E0000   LW T6, 0(T4)
9D00CD20  01CD7821   ADDU T7, T6, T5
9D00CD3C  00109302   SRL S2, S0, 12
9D00CD40  0012A880   SLL S5, S2, 2
9D00CD44  26623010   ADDIU V0, S3, 12304
9D00CD48  02A22021   ADDU A0, S5, V0
9D00CD4C  32070FFF   ANDI A3, S0, 4095
9D00CD50  8C8A0000   LW T2, 0(A0)
9D00CD54  0147F821   ADDU RA, T2, A3
9D00CD9C  00117302   SRL T6, S1, 12
9D00CDA0  000E7880   SLL T7, T6, 2
9D00CDA4  26783010   ADDIU T8, S3, 12304
9D00CDA8  01F8C821   ADDU T9, T7, T8
9D00CDAC  32310FFF   ANDI S1, S1, 4095
9D00CDB0  8F350000   LW S5, 0(T9)
9D00CDB4  02B11021   ADDU V0, S5, S1
9D00CDD8  0010BB02   SRL S7, S0, 12
9D00CDDC  00179080   SLL S2, S7, 2
9D00CDE0  267F3010   ADDIU RA, S3, 12304
9D00CDE4  025F3021   ADDU A2, S2, RA
9D00CDE8  32030FFF   ANDI V1, S0, 4095
9D00CDEC  8CC50000   LW A1, 0(A2)
9D00CDF0  00A34021   ADDU T0, A1, V1
9D00CE3C  00111302   SRL V0, S1, 12
9D00CE40  00022080   SLL A0, V0, 2
9D00CE44  26673010   ADDIU A3, S3, 12304
9D00CE48  00875021   ADDU T2, A0, A3
9D00CE4C  32310FFF   ANDI S1, S1, 4095
9D00CE50  8D5F0000   LW RA, 0(T2)
9D00CE54  03F13021   ADDU A2, RA, S1
9D00CE74  0010BB02   SRL S7, S0, 12
9D00CE78  00179080   SLL S2, S7, 2
9D00CE7C  266B3010   ADDIU T3, S3, 12304
9D00CE80  024B4821   ADDU T1, S2, T3
9D00CE84  320C0FFF   ANDI T4, S0, 4095
9D00CE88  8D2D0000   LW T5, 0(T1)
9D00CE8C  01AC7021   ADDU T6, T5, T4
9D00CEE4  00111B02   SRL V1, S1, 12
9D00CEE8  00032880   SLL A1, V1, 2
9D00CEEC  26683010   ADDIU T0, S3, 12304
9D00CEF0  00A85821   ADDU T3, A1, T0
9D00CEF4  32310FFF   ANDI S1, S1, 4095
9D00CEF8  8D690000   LW T1, 0(T3)
9D00CEFC  01316021   ADDU T4, T1, S1
9D00CFC0  00104B02   SRL T1, S0, 12
9D00CFC4  00092880   SLL A1, T1, 2
9D00CFC8  266C3010   ADDIU T4, S3, 12304
9D00CFCC  00AC6821   ADDU T5, A1, T4
9D00CFD0  320E0FFF   ANDI T6, S0, 4095
9D00CFD4  8DAF0000   LW T7, 0(T5)
9D00CFD8  01EEC021   ADDU T8, T7, T6
9D00CFFC  00109302   SRL S2, S0, 12
9D00D000  0012A880   SLL S5, S2, 2
9D00D004  266A3010   ADDIU T2, S3, 12304
9D00D008  02AA2021   ADDU A0, S5, T2
9D00D00C  320B0FFF   ANDI T3, S0, 4095
9D00D010  8C9F0000   LW RA, 0(A0)
9D00D014  03EB3021   ADDU A2, RA, T3
9D00D050  00116B02   SRL T5, S1, 12
9D00D054  000D7080   SLL T6, T5, 2
9D00D058  266F3010   ADDIU T7, S3, 12304
9D00D05C  01CFC021   ADDU T8, T6, T7
9D00D060  32310FFF   ANDI S1, S1, 4095
9D00D064  8F190000   LW T9, 0(T8)
9D00D068  03311021   ADDU V0, T9, S1
9D00D0C4  0010A302   SRL S4, S0, 12
9D00D0C8  00141880   SLL V1, S4, 2
9D00D0CC  26693010   ADDIU T1, S3, 12304
9D00D0D0  00692821   ADDU A1, V1, T1
9D00D0D4  320C0FFF   ANDI T4, S0, 4095
9D00D0D8  8CAD0000   LW T5, 0(A1)
9D00D0DC  01AC7021   ADDU T6, T5, T4
9D00D104  0010BB02   SRL S7, S0, 12
9D00D108  0017C880   SLL T9, S7, 2
9D00D10C  26623010   ADDIU V0, S3, 12304
9D00D110  03223821   ADDU A3, T9, V0
9D00D114  32150FFF   ANDI S5, S0, 4095
9D00D118  8CEA0000   LW T2, 0(A3)
9D00D11C  01552021   ADDU A0, T2, S5
9D00D158  0011A302   SRL S4, S1, 12
9D00D15C  00141880   SLL V1, S4, 2
9D00D160  26693010   ADDIU T1, S3, 12304
9D00D164  00692821   ADDU A1, V1, T1
9D00D168  322C0FFF   ANDI T4, S1, 4095
9D00D16C  8CAD0000   LW T5, 0(A1)
9D00D170  01AC7021   ADDU T6, T5, T4
9D00D1B8  00115B02   SRL T3, S1, 12
9D00D1BC  000BF880   SLL RA, T3, 2
9D00D1C0  26663010   ADDIU A2, S3, 12304
9D00D1C4  03E64021   ADDU T0, RA, A2
9D00D1C8  32230FFF   ANDI V1, S1, 4095
9D00D1CC  8D090000   LW T1, 0(T0)
9D00D1D0  01232821   ADDU A1, T1, V1
9D00D234  00113B02   SRL A3, S1, 12
9D00D238  00075080   SLL T2, A3, 2
9D00D23C  26643010   ADDIU A0, S3, 12304
9D00D240  01445821   ADDU T3, T2, A0
9D00D244  32310FFF   ANDI S1, S1, 4095
9D00D248  8D7F0000   LW RA, 0(T3)
9D00D24C  03F13021   ADDU A2, RA, S1
9D00D2C8  0011C302   SRL T8, S1, 12
9D00D2CC  0018C880   SLL T9, T8, 2
9D00D2D0  26623010   ADDIU V0, S3, 12304
9D00D2D4  03223821   ADDU A3, T9, V0
9D00D2D8  322A0FFF   ANDI T2, S1, 4095
9D00D2DC  8CE40000   LW A0, 0(A3)
9D00D2E0  008A5821   ADDU T3, A0, T2
9D00D364  00117302   SRL T6, S1, 12
9D00D368  000E7880   SLL T7, T6, 2
9D00D36C  26783010   ADDIU T8, S3, 12304
9D00D370  01F8C821   ADDU T9, T7, T8
9D00D374  32270FFF   ANDI A3, S1, 4095
9D00D378  8F220000   LW V0, 0(T9)
9D00D37C  00475021   ADDU T2, V0, A3
9D00D3A8  00106302   SRL T4, S0, 12
9D00D3AC  000C6880   SLL T5, T4, 2
9D00D3B0  266E3010   ADDIU T6, S3, 12304
9D00D3B4  01AE7821   ADDU T7, T5, T6
9D00D3B8  32180FFF   ANDI T8, S0, 4095
9D00D3BC  8DF90000   LW T9, 0(T7)
9D00D3C0  03383821   ADDU A3, T9, T8
9D00D448  00117B02   SRL T7, S1, 12
9D00D44C  000FC080   SLL T8, T7, 2
9D00D450  26793010   ADDIU T9, S3, 12304
9D00D454  03193821   ADDU A3, T8, T9
9D00D458  322A0FFF   ANDI T2, S1, 4095
9D00D45C  8CE20000   LW V0, 0(A3)
9D00D460  004A2021   ADDU A0, V0, T2
9D00D478  0010AB02   SRL S5, S0, 12
9D00D47C  00159080   SLL S2, S5, 2
9D00D480  26663010   ADDIU A2, S3, 12304
9D00D484  02464021   ADDU T0, S2, A2
9D00D488  32090FFF   ANDI T1, S0, 4095
9D00D48C  8D030000   LW V1, 0(T0)
9D00D490  00696021   ADDU T4, V1, T1
9D00D51C  00116302   SRL T4, S1, 12
9D00D520  000C6880   SLL T5, T4, 2
9D00D524  266E3010   ADDIU T6, S3, 12304
9D00D528  01AE2821   ADDU A1, T5, T6
9D00D52C  32310FFF   ANDI S1, S1, 4095
9D00D530  8CAF0000   LW T7, 0(A1)
9D00D534  01F1C021   ADDU T8, T7, S1
9D00D558  0010BB02   SRL S7, S0, 12
9D00D55C  00171080   SLL V0, S7, 2
9D00D560  26753010   ADDIU S5, S3, 12304
9D00D564  00555821   ADDU T3, V0, S5
9D00D568  321F0FFF   ANDI RA, S0, 4095
9D00D56C  8D720000   LW S2, 0(T3)
9D00D570  025F2021   ADDU A0, S2, RA
9D00D5E8  00115302   SRL T2, S1, 12
9D00D5EC  000AA880   SLL S5, T2, 2
9D00D5F0  26623010   ADDIU V0, S3, 12304
9D00D5F4  02A25821   ADDU T3, S5, V0
9D00D5F8  32310FFF   ANDI S1, S1, 4095
9D00D5FC  8D7F0000   LW RA, 0(T3)
9D00D600  03F12021   ADDU A0, RA, S1
9D00D668  00117B02   SRL T7, S1, 12
9D00D66C  000FC080   SLL T8, T7, 2
9D00D670  26793010   ADDIU T9, S3, 12304
9D00D674  03193821   ADDU A3, T8, T9
9D00D678  322A0FFF   ANDI T2, S1, 4095
9D00D67C  8CE20000   LW V0, 0(A3)
9D00D680  004A5821   ADDU T3, V0, T2
9D00D69C  00109302   SRL S2, S0, 12
9D00D6A0  0012A880   SLL S5, S2, 2
9D00D6A4  26663010   ADDIU A2, S3, 12304
9D00D6A8  02A64021   ADDU T0, S5, A2
9D00D6AC  32090FFF   ANDI T1, S0, 4095
9D00D6B0  8D030000   LW V1, 0(T0)
9D00D6B4  00696021   ADDU T4, V1, T1
9D00D704  0011FB02   SRL RA, S1, 12
9D00D708  001F2080   SLL A0, RA, 2
9D00D70C  26753010   ADDIU S5, S3, 12304
9D00D710  00953021   ADDU A2, A0, S5
9D00D714  32310FFF   ANDI S1, S1, 4095
9D00D718  8CC80000   LW T0, 0(A2)
9D00D71C  01114821   ADDU T1, T0, S1
9D00D740  0010BB02   SRL S7, S0, 12
9D00D744  00179080   SLL S2, S7, 2
9D00D748  266E3010   ADDIU T6, S3, 12304
9D00D74C  024E2821   ADDU A1, S2, T6
9D00D750  320F0FFF   ANDI T7, S0, 4095
9D00D754  8CB80000   LW T8, 0(A1)
9D00D758  030FC821   ADDU T9, T8, T7
9D00D7AC  00116302   SRL T4, S1, 12
9D00D7B0  000C6880   SLL T5, T4, 2
9D00D7B4  266E3010   ADDIU T6, S3, 12304
9D00D7B8  01AE2821   ADDU A1, T5, T6
9D00D7BC  32310FFF   ANDI S1, S1, 4095
9D00D7C0  8CAF0000   LW T7, 0(A1)
9D00D7C4  01F1C021   ADDU T8, T7, S1
9D00D7E4  0010BB02   SRL S7, S0, 12
9D00D7E8  00179080   SLL S2, S7, 2
9D00D7EC  26623010   ADDIU V0, S3, 12304
9D00D7F0  02425821   ADDU T3, S2, V0
9D00D7F4  321F0FFF   ANDI RA, S0, 4095
9D00D7F8  8D640000   LW A0, 0(T3)
9D00D7FC  009FA821   ADDU S5, A0, RA
9D00D85C  00115302   SRL T2, S1, 12
9D00D860  000A5880   SLL T3, T2, 2
9D00D864  26623010   ADDIU V0, S3, 12304
9D00D868  0162F821   ADDU RA, T3, V0
9D00D86C  32310FFF   ANDI S1, S1, 4095
9D00D870  8FE40000   LW A0, 0(RA)
9D00D874  0091A821   ADDU S5, A0, S1
9D00D8C0  00102B02   SRL A1, S0, 12
9D00D8C4  00057880   SLL T7, A1, 2
9D00D8C8  26783010   ADDIU T8, S3, 12304
9D00D8CC  01F8C821   ADDU T9, T7, T8
9D00D8D0  32070FFF   ANDI A3, S0, 4095
9D00D8D4  8F2A0000   LW T2, 0(T9)
9D00D8D8  01475821   ADDU T3, T2, A3
9D00D978  00113B02   SRL A3, S1, 12
9D00D97C  00075080   SLL T2, A3, 2
9D00D980  266B3010   ADDIU T3, S3, 12304
9D00D984  014B1021   ADDU V0, T2, T3
9D00D988  323F0FFF   ANDI RA, S1, 4095
9D00D98C  8C510000   LW S1, 0(V0)
9D00D990  023F2021   ADDU A0, S1, RA
9D00D9F8  00102B02   SRL A1, S0, 12
9D00D9FC  00057880   SLL T7, A1, 2
9D00DA00  26783010   ADDIU T8, S3, 12304
9D00DA04  01F8C821   ADDU T9, T7, T8
9D00DA08  32070FFF   ANDI A3, S0, 4095
9D00DA0C  8F2A0000   LW T2, 0(T9)
9D00DA10  01475821   ADDU T3, T2, A3
9D00DA9C  00116B02   SRL T5, S1, 12
9D00DAA0  000D7080   SLL T6, T5, 2
9D00DAA4  26653010   ADDIU A1, S3, 12304
9D00DAA8  01C57821   ADDU T7, T6, A1
9D00DAAC  32380FFF   ANDI T8, S1, 4095
9D00DAB0  8DF90000   LW T9, 0(T7)
9D00DAB4  03383821   ADDU A3, T9, T8
9D00DB1C  00116302   SRL T4, S1, 12
9D00DB20  000C1880   SLL V1, T4, 2
9D00DB24  266D3010   ADDIU T5, S3, 12304
9D00DB28  006D7021   ADDU T6, V1, T5
9D00DB2C  32310FFF   ANDI S1, S1, 4095
9D00DB30  8DC50000   LW A1, 0(T6)
9D00DB34  00B17821   ADDU T7, A1, S1
9D00DBC8  00117302   SRL T6, S1, 12
9D00DBCC  000E2880   SLL A1, T6, 2
9D00DBD0  266F3010   ADDIU T7, S3, 12304
9D00DBD4  00AFC021   ADDU T8, A1, T7
9D00DBD8  32310FFF   ANDI S1, S1, 4095
9D00DBDC  8F190000   LW T9, 0(T8)
9D00DBE0  03313821   ADDU A3, T9, S1
9D00DC60  0011FB02   SRL RA, S1, 12
9D00DC64  001F6080   SLL T4, RA, 2
9D00DC68  26633010   ADDIU V1, S3, 12304
9D00DC6C  01836821   ADDU T5, T4, V1
9D00DC70  322E0FFF   ANDI T6, S1, 4095
9D00DC74  8DA50000   LW A1, 0(T5)
9D00DC78  00AE7821   ADDU T7, A1, T6
9D00DD00  00114B02   SRL T1, S1, 12
9D00DD04  0009F880   SLL RA, T1, 2
9D00DD08  266C3010   ADDIU T4, S3, 12304
9D00DD0C  03EC1821   ADDU V1, RA, T4
9D00DD10  322D0FFF   ANDI T5, S1, 4095
9D00DD14  8C6E0000   LW T6, 0(V1)
9D00DD18  01CD2821   ADDU A1, T6, T5
9D00DDA0  00027B02   SRL T7, V0, 12
9D00DDA4  000FC080   SLL T8, T7, 2
9D00DDA8  26793010   ADDIU T9, S3, 12304
9D00DDAC  03193821   ADDU A3, T8, T9
9D00DDB0  30510FFF   ANDI S1, V0, 4095
9D00DDB4  8CEA0000   LW T2, 0(A3)
9D00DDB8  01515821   ADDU T3, T2, S1
9D00DDD4  0010AB02   SRL S5, S0, 12
9D00DDD8  00159080   SLL S2, S5, 2
9D00DDDC  26753010   ADDIU S5, S3, 12304
9D00DDE0  02552021   ADDU A0, S2, S5
9D00DDE4  32090FFF   ANDI T1, S0, 4095
9D00DDE8  8C9F0000   LW RA, 0(A0)
9D00DDEC  03E96021   ADDU T4, RA, T1
9D00DE40  00115B02   SRL T3, S1, 12
9D00DE44  000B4080   SLL T0, T3, 2
9D00DE48  26623010   ADDIU V0, S3, 12304
9D00DE4C  01023021   ADDU A2, T0, V0
9D00DE50  32310FFF   ANDI S1, S1, 4095
9D00DE54  8CD50000   LW S5, 0(A2)
9D00DE58  02B12021   ADDU A0, S5, S1
9D00DE7C  00109302   SRL S2, S0, 12
9D00DE80  00126880   SLL T5, S2, 2
9D00DE84  26753010   ADDIU S5, S3, 12304
9D00DE88  01B51821   ADDU V1, T5, S5
9D00DE8C  320E0FFF   ANDI T6, S0, 4095
9D00DE90  8C650000   LW A1, 0(V1)
9D00DE94  00AE7821   ADDU T7, A1, T6
9D00DF10  0011FB02   SRL RA, S1, 12
9D00DF14  001F6880   SLL T5, RA, 2
9D00DF18  26753010   ADDIU S5, S3, 12304
9D00DF1C  01B51821   ADDU V1, T5, S5
9D00DF20  32310FFF   ANDI S1, S1, 4095
9D00DF24  8C6E0000   LW T6, 0(V1)
9D00DF28  01D12821   ADDU A1, T6, S1
9D00DF50  00103B02   SRL A3, S0, 12
9D00DF54  00075080   SLL T2, A3, 2
9D00DF58  266B3010   ADDIU T3, S3, 12304
9D00DF5C  014B4021   ADDU T0, T2, T3
9D00DF60  32060FFF   ANDI A2, S0, 4095
9D00DF64  8D020000   LW V0, 0(T0)
9D00DF68  00469021   ADDU S2, V0, A2
9D00DFAC  0011C302   SRL T8, S1, 12
9D00DFB0  0018C880   SLL T9, T8, 2
9D00DFB4  032B3821   ADDU A3, T9, T3
9D00DFB8  32310FFF   ANDI S1, S1, 4095
9D00DFBC  8CEA0000   LW T2, 0(A3)
9D00DFC0  01515821   ADDU T3, T2, S1
9D00DFDC  0010AB02   SRL S5, S0, 12
9D00DFE0  00159080   SLL S2, S5, 2
9D00DFE4  26693010   ADDIU T1, S3, 12304
9D00DFE8  02492021   ADDU A0, S2, T1
9D00DFEC  320C0FFF   ANDI T4, S0, 4095
9D00DFF0  8C9F0000   LW RA, 0(A0)
9D00DFF4  03EC6821   ADDU T5, RA, T4
9D00E038  00115302   SRL T2, S1, 12
9D00E03C  000A5880   SLL T3, T2, 2
9D00E040  26683010   ADDIU T0, S3, 12304
9D00E044  01683021   ADDU A2, T3, T0
9D00E048  32310FFF   ANDI S1, S1, 4095
9D00E04C  8CC20000   LW V0, 0(A2)
9D00E050  0051A821   ADDU S5, V0, S1
9D00E074  00109302   SRL S2, S0, 12
9D00E078  0012F880   SLL RA, S2, 2
9D00E07C  266D3010   ADDIU T5, S3, 12304
9D00E080  03ED7021   ADDU T6, RA, T5
9D00E084  32030FFF   ANDI V1, S0, 4095
9D00E088  8DC50000   LW A1, 0(T6)
9D00E08C  00A37821   ADDU T7, A1, V1
9D00E0E0  00112302   SRL A0, S1, 12
9D00E0E4  00046080   SLL T4, A0, 2
9D00E0E8  267F3010   ADDIU RA, S3, 12304
9D00E0EC  019F6821   ADDU T5, T4, RA
9D00E0F0  32310FFF   ANDI S1, S1, 4095
9D00E0F4  8DAE0000   LW T6, 0(T5)
9D00E0F8  01D11821   ADDU V1, T6, S1
9D00E11C  00109302   SRL S2, S0, 12
9D00E120  0012C880   SLL T9, S2, 2
9D00E124  26673010   ADDIU A3, S3, 12304
9D00E128  03275021   ADDU T2, T9, A3
9D00E12C  320B0FFF   ANDI T3, S0, 4095
9D00E130  8D480000   LW T0, 0(T2)
9D00E134  010B3021   ADDU A2, T0, T3
9D00E190  00117B02   SRL T7, S1, 12
9D00E194  000FC080   SLL T8, T7, 2
9D00E198  26793010   ADDIU T9, S3, 12304
9D00E19C  03193821   ADDU A3, T8, T9
9D00E1A0  32310FFF   ANDI S1, S1, 4095
9D00E1A4  8CEA0000   LW T2, 0(A3)
9D00E1A8  01515821   ADDU T3, T2, S1
9D00E254  00104B02   SRL T1, S0, 12
9D00E258  00092080   SLL A0, T1, 2
9D00E25C  266C3010   ADDIU T4, S3, 12304
9D00E260  008CF821   ADDU RA, A0, T4
9D00E264  320D0FFF   ANDI T5, S0, 4095
9D00E268  8FEE0000   LW T6, 0(RA)
9D00E26C  01CD1821   ADDU V1, T6, T5
9D00E28C  00109302   SRL S2, S0, 12
9D00E290  0012A880   SLL S5, S2, 2
9D00E294  26793010   ADDIU T9, S3, 12304
9D00E298  02B93821   ADDU A3, S5, T9
9D00E29C  320A0FFF   ANDI T2, S0, 4095
9D00E2A0  8CEB0000   LW T3, 0(A3)
9D00E2A4  016A4021   ADDU T0, T3, T2
9D00E2DC  00116302   SRL T4, S1, 12
9D00E2E0  000CF880   SLL RA, T4, 2
9D00E2E4  266D3010   ADDIU T5, S3, 12304
9D00E2E8  03ED7021   ADDU T6, RA, T5
9D00E2EC  32310FFF   ANDI S1, S1, 4095
9D00E2F0  8DC30000   LW V1, 0(T6)
9D00E2F4  00712821   ADDU A1, V1, S1
9D00E358  0010A302   SRL S4, S0, 12
9D00E35C  00144880   SLL T1, S4, 2
9D00E360  26623010   ADDIU V0, S3, 12304
9D00E364  01222021   ADDU A0, T1, V0
9D00E368  320C0FFF   ANDI T4, S0, 4095
9D00E36C  8C9F0000   LW RA, 0(A0)
9D00E370  03EC6821   ADDU T5, RA, T4
9D00E39C  00102B02   SRL A1, S0, 12
9D00E3A0  00057880   SLL T7, A1, 2
9D00E3A4  26783010   ADDIU T8, S3, 12304
9D00E3A8  01F8A821   ADDU S5, T7, T8
9D00E3AC  32190FFF   ANDI T9, S0, 4095
9D00E3B0  8EB70000   LW S7, 0(S5)
9D00E3B4  02F93821   ADDU A3, S7, T9
9D00E3F0  0011A302   SRL S4, S1, 12
9D00E3F4  00144880   SLL T1, S4, 2
9D00E3F8  26623010   ADDIU V0, S3, 12304
9D00E3FC  01222021   ADDU A0, T1, V0
9D00E400  322C0FFF   ANDI T4, S1, 4095
9D00E404  8C9F0000   LW RA, 0(A0)
9D00E408  03EC6821   ADDU T5, RA, T4
9D00E478  00113302   SRL A2, S1, 12
9D00E47C  00064880   SLL T1, A2, 2
9D00E480  26623010   ADDIU V0, S3, 12304
9D00E484  01222021   ADDU A0, T1, V0
9D00E488  322C0FFF   ANDI T4, S1, 4095
9D00E48C  8C9F0000   LW RA, 0(A0)
9D00E490  03EC6821   ADDU T5, RA, T4
9D00E4F4  00113B02   SRL A3, S1, 12
9D00E4F8  00075080   SLL T2, A3, 2
9D00E4FC  266B3010   ADDIU T3, S3, 12304
9D00E500  014B4021   ADDU T0, T2, T3
9D00E504  32260FFF   ANDI A2, S1, 4095
9D00E508  8D090000   LW T1, 0(T0)
9D00E50C  01261021   ADDU V0, T1, A2
9D00E594  0011CB02   SRL T9, S1, 12
9D00E598  00193880   SLL A3, T9, 2
9D00E59C  266A3010   ADDIU T2, S3, 12304
9D00E5A0  00EA5821   ADDU T3, A3, T2
9D00E5A4  32310FFF   ANDI S1, S1, 4095
9D00E5A8  8D680000   LW T0, 0(T3)
9D00E5AC  01113021   ADDU A2, T0, S1
9D00E63C  0011FB02   SRL RA, S1, 12
9D00E640  001FC080   SLL T8, RA, 2
9D00E644  26793010   ADDIU T9, S3, 12304
9D00E648  03193821   ADDU A3, T8, T9
9D00E64C  322A0FFF   ANDI T2, S1, 4095
9D00E650  8CEB0000   LW T3, 0(A3)
9D00E654  016A8821   ADDU S1, T3, T2
9D00E688  00101B02   SRL V1, S0, 12
9D00E68C  00037880   SLL T7, V1, 2
9D00E690  267F3010   ADDIU RA, S3, 12304
9D00E694  01FFC021   ADDU T8, T7, RA
9D00E698  32190FFF   ANDI T9, S0, 4095
9D00E69C  8F070000   LW A3, 0(T8)
9D00E6A0  00F95021   ADDU T2, A3, T9
9D00E724  0011C302   SRL T8, S1, 12
9D00E728  0018C880   SLL T9, T8, 2
9D00E72C  26673010   ADDIU A3, S3, 12304
9D00E730  03275021   ADDU T2, T9, A3
9D00E734  322B0FFF   ANDI T3, S1, 4095
9D00E738  8D510000   LW S1, 0(T2)
9D00E73C  022B4021   ADDU T0, S1, T3
9D00E754  0010AB02   SRL S5, S0, 12
9D00E758  00159080   SLL S2, S5, 2
9D00E75C  26643010   ADDIU A0, S3, 12304
9D00E760  02446021   ADDU T4, S2, A0
9D00E764  320D0FFF   ANDI T5, S0, 4095
9D00E768  8D8E0000   LW T6, 0(T4)
9D00E76C  01CD1821   ADDU V1, T6, T5
9D00E7F8  00117B02   SRL T7, S1, 12
9D00E7FC  000FF880   SLL RA, T7, 2
9D00E800  26653010   ADDIU A1, S3, 12304
9D00E804  03E5C021   ADDU T8, RA, A1
9D00E808  32310FFF   ANDI S1, S1, 4095
9D00E80C  8F190000   LW T9, 0(T8)
9D00E810  03313821   ADDU A3, T9, S1
9D00E834  00109302   SRL S2, S0, 12
9D00E838  00123080   SLL A2, S2, 2
9D00E83C  26753010   ADDIU S5, S3, 12304
9D00E840  00D54821   ADDU T1, A2, S5
9D00E844  32020FFF   ANDI V0, S0, 4095
9D00E848  8D240000   LW A0, 0(T1)
9D00E84C  00826021   ADDU T4, A0, V0
9D00E8CC  00113302   SRL A2, S1, 12
9D00E8D0  0006A880   SLL S5, A2, 2
9D00E8D4  26693010   ADDIU T1, S3, 12304
9D00E8D8  02A91021   ADDU V0, S5, T1
9D00E8DC  32310FFF   ANDI S1, S1, 4095
9D00E8E0  8C440000   LW A0, 0(V0)
9D00E8E4  00916021   ADDU T4, A0, S1
9D00E90C  00107B02   SRL T7, S0, 12
9D00E910  000FF880   SLL RA, T7, 2
9D00E914  26653010   ADDIU A1, S3, 12304
9D00E918  03E5C021   ADDU T8, RA, A1
9D00E91C  32190FFF   ANDI T9, S0, 4095
9D00E920  8F070000   LW A3, 0(T8)
9D00E924  00F99021   ADDU S2, A3, T9
9D00E970  00116B02   SRL T5, S1, 12
9D00E974  000D7080   SLL T6, T5, 2
9D00E978  26633010   ADDIU V1, S3, 12304
9D00E97C  01C37821   ADDU T7, T6, V1
9D00E980  32310FFF   ANDI S1, S1, 4095
9D00E984  8DFF0000   LW RA, 0(T7)
9D00E988  03F12821   ADDU A1, RA, S1
9D00E9AC  00109302   SRL S2, S0, 12
9D00E9B0  00125080   SLL T2, S2, 2
9D00E9B4  266B3010   ADDIU T3, S3, 12304
9D00E9B8  014B4021   ADDU T0, T2, T3
9D00E9BC  32060FFF   ANDI A2, S0, 4095
9D00E9C0  8D150000   LW S5, 0(T0)
9D00E9C4  02A64821   ADDU T1, S5, A2
9D00EA20  00115302   SRL T2, S1, 12
9D00EA24  000A5880   SLL T3, T2, 2
9D00EA28  26683010   ADDIU T0, S3, 12304
9D00EA2C  01683021   ADDU A2, T3, T0
9D00EA30  32310FFF   ANDI S1, S1, 4095
9D00EA34  8CD50000   LW S5, 0(A2)
9D00EA38  02B14821   ADDU T1, S5, S1
9D00EA5C  00109302   SRL S2, S0, 12
9D00EA60  00126880   SLL T5, S2, 2
9D00EA64  266E3010   ADDIU T6, S3, 12304
9D00EA68  01AE7821   ADDU T7, T5, T6
9D00EA6C  32030FFF   ANDI V1, S0, 4095
9D00EA70  8DFF0000   LW RA, 0(T7)
9D00EA74  03E32821   ADDU A1, RA, V1
9D00EAD8  00116B02   SRL T5, S1, 12
9D00EADC  000D7080   SLL T6, T5, 2
9D00EAE0  266F3010   ADDIU T7, S3, 12304
9D00EAE4  01CF1821   ADDU V1, T6, T7
9D00EAE8  32310FFF   ANDI S1, S1, 4095
9D00EAEC  8C7F0000   LW RA, 0(V1)
9D00EAF0  03F12821   ADDU A1, RA, S1
9D00EB40  00104B02   SRL T1, S0, 12
9D00EB44  00092080   SLL A0, T1, 2
9D00EB48  26623010   ADDIU V0, S3, 12304
9D00EB4C  00826021   ADDU T4, A0, V0
9D00EB50  320D0FFF   ANDI T5, S0, 4095
9D00EB54  8D8E0000   LW T6, 0(T4)
9D00EB58  01CD7821   ADDU T7, T6, T5
9D00EBF8  00116B02   SRL T5, S1, 12
9D00EBFC  000D7080   SLL T6, T5, 2
9D00EC00  266F3010   ADDIU T7, S3, 12304
9D00EC04  01CF1821   ADDU V1, T6, T7
9D00EC08  32310FFF   ANDI S1, S1, 4095
9D00EC0C  8C7F0000   LW RA, 0(V1)
9D00EC10  03F1A821   ADDU S5, RA, S1
9D00ECA8  00112302   SRL A0, S1, 12
9D00ECAC  00046080   SLL T4, A0, 2
9D00ECB0  266D3010   ADDIU T5, S3, 12304
9D00ECB4  018D7021   ADDU T6, T4, T5
9D00ECB8  322F0FFF   ANDI T7, S1, 4095
9D00ECBC  8DC30000   LW V1, 0(T6)
9D00ECC0  006F8821   ADDU S1, V1, T7
9D00ED60  00117302   SRL T6, S1, 12
9D00ED64  000E7880   SLL T7, T6, 2
9D00ED68  26633010   ADDIU V1, S3, 12304
9D00ED6C  01E3F821   ADDU RA, T7, V1
9D00ED70  32310FFF   ANDI S1, S1, 4095
9D00ED74  8FE50000   LW A1, 0(RA)
9D00ED78  00B1C021   ADDU T8, A1, S1
9D00EE04  00112302   SRL A0, S1, 12
9D00EE08  00046880   SLL T5, A0, 2
9D00EE0C  266E3010   ADDIU T6, S3, 12304
9D00EE10  01AE7821   ADDU T7, T5, T6
9D00EE14  32230FFF   ANDI V1, S1, 4095
9D00EE18  8DFF0000   LW RA, 0(T7)
9D00EE1C  03E38821   ADDU S1, RA, V1
9D00EEB0  00116302   SRL T4, S1, 12
9D00EEB4  000C2080   SLL A0, T4, 2
9D00EEB8  266D3010   ADDIU T5, S3, 12304
9D00EEBC  008D7021   ADDU T6, A0, T5
9D00EEC0  322F0FFF   ANDI T7, S1, 4095
9D00EEC4  8DC30000   LW V1, 0(T6)
9D00EEC8  006FF821   ADDU RA, V1, T7
9D00F038  00112302   SRL A0, S1, 12
9D00F03C  00047080   SLL T6, A0, 2
9D00F040  266F3010   ADDIU T7, S3, 12304
9D00F044  01CFF821   ADDU RA, T6, T7
9D00F048  32230FFF   ANDI V1, S1, 4095
9D00F04C  8FE50000   LW A1, 0(RA)
9D00F050  00A38821   ADDU S1, A1, V1
9D00F070  00109302   SRL S2, S0, 12
9D00F074  00125880   SLL T3, S2, 2
9D00F078  26753010   ADDIU S5, S3, 12304
9D00F07C  01753021   ADDU A2, T3, S5
9D00F080  320A0FFF   ANDI T2, S0, 4095
9D00F084  8CC80000   LW T0, 0(A2)
9D00F088  010A4821   ADDU T1, T0, T2
9D00F0DC  0011FB02   SRL RA, S1, 12
9D00F0E0  001FC880   SLL T9, RA, 2
9D00F0E4  26673010   ADDIU A3, S3, 12304
9D00F0E8  03275821   ADDU T3, T9, A3
9D00F0EC  32310FFF   ANDI S1, S1, 4095
9D00F0F0  8D750000   LW S5, 0(T3)
9D00F0F4  02B13021   ADDU A2, S5, S1
9D00F114  0010BB02   SRL S7, S0, 12
9D00F118  00179080   SLL S2, S7, 2
9D00F11C  26753010   ADDIU S5, S3, 12304
9D00F120  02556821   ADDU T5, S2, S5
9D00F124  32020FFF   ANDI V0, S0, 4095
9D00F128  8DAC0000   LW T4, 0(T5)
9D00F12C  01822021   ADDU A0, T4, V0
9D00F1A0  00115302   SRL T2, S1, 12
9D00F1A4  000A4080   SLL T0, T2, 2
9D00F1A8  26693010   ADDIU T1, S3, 12304
9D00F1AC  0109A821   ADDU S5, T0, T1
9D00F1B0  32310FFF   ANDI S1, S1, 4095
9D00F1B4  8EAD0000   LW T5, 0(S5)
9D00F1B8  01B11021   ADDU V0, T5, S1
9D00F1DC  00107B02   SRL T7, S0, 12
9D00F1E0  000F2880   SLL A1, T7, 2
9D00F1E4  26783010   ADDIU T8, S3, 12304
9D00F1E8  00B8F821   ADDU RA, A1, T8
9D00F1EC  32030FFF   ANDI V1, S0, 4095
9D00F1F0  8FF20000   LW S2, 0(RA)
9D00F1F4  0243C821   ADDU T9, S2, V1
9D00F23C  00111302   SRL V0, S1, 12
9D00F240  00026080   SLL T4, V0, 2
9D00F244  26643010   ADDIU A0, S3, 12304
9D00F248  01847021   ADDU T6, T4, A0
9D00F24C  32310FFF   ANDI S1, S1, 4095
9D00F250  8DCF0000   LW T7, 0(T6)
9D00F254  01F12821   ADDU A1, T7, S1
9D00F278  0010BB02   SRL S7, S0, 12
9D00F27C  00179080   SLL S2, S7, 2
9D00F280  26793010   ADDIU T9, S3, 12304
9D00F284  02593821   ADDU A3, S2, T9
9D00F288  320B0FFF   ANDI T3, S0, 4095
9D00F28C  8CE60000   LW A2, 0(A3)
9D00F290  00CB5021   ADDU T2, A2, T3
9D00F2D8  00117B02   SRL T7, S1, 12
9D00F2DC  000F2880   SLL A1, T7, 2
9D00F2E0  26783010   ADDIU T8, S3, 12304
9D00F2E4  00B8F821   ADDU RA, A1, T8
9D00F2E8  32310FFF   ANDI S1, S1, 4095
9D00F2EC  8FE30000   LW V1, 0(RA)
9D00F2F0  0071C821   ADDU T9, V1, S1
9D00F310  0010BB02   SRL S7, S0, 12
9D00F314  00179080   SLL S2, S7, 2
9D00F318  266A3010   ADDIU T2, S3, 12304
9D00F31C  024A4021   ADDU T0, S2, T2
9D00F320  32090FFF   ANDI T1, S0, 4095
9D00F324  8D150000   LW S5, 0(T0)
9D00F328  02A96821   ADDU T5, S5, T1
9D00F37C  0011CB02   SRL T9, S1, 12
9D00F380  00193880   SLL A3, T9, 2
9D00F384  266B3010   ADDIU T3, S3, 12304
9D00F388  00EB3021   ADDU A2, A3, T3
9D00F38C  32310FFF   ANDI S1, S1, 4095
9D00F390  8CCA0000   LW T2, 0(A2)
9D00F394  01514021   ADDU T0, T2, S1
9D00F3F8  00103B02   SRL A3, S0, 12
9D00F3FC  00075880   SLL T3, A3, 2
9D00F400  26663010   ADDIU A2, S3, 12304
9D00F404  01668821   ADDU S1, T3, A2
9D00F408  320A0FFF   ANDI T2, S0, 4095
9D00F40C  8E280000   LW T0, 0(S1)
9D00F410  010A4821   ADDU T1, T0, T2
9D00F434  00109302   SRL S2, S0, 12
9D00F438  0012A880   SLL S5, S2, 2
9D00F43C  266E3010   ADDIU T6, S3, 12304
9D00F440  02AE2021   ADDU A0, S5, T6
9D00F444  320F0FFF   ANDI T7, S0, 4095
9D00F448  8C850000   LW A1, 0(A0)
9D00F44C  00AFC021   ADDU T8, A1, T7
9D00F488  00113302   SRL A2, S1, 12
9D00F48C  00065080   SLL T2, A2, 2
9D00F490  26683010   ADDIU T0, S3, 12304
9D00F494  01484821   ADDU T1, T2, T0
9D00F498  32310FFF   ANDI S1, S1, 4095
9D00F49C  8D2D0000   LW T5, 0(T1)
9D00F4A0  01B16021   ADDU T4, T5, S1
9D00F4F8  0010A302   SRL S4, S0, 12
9D00F4FC  00141880   SLL V1, S4, 2
9D00F500  26793010   ADDIU T9, S3, 12304
9D00F504  00793821   ADDU A3, V1, T9
9D00F508  320B0FFF   ANDI T3, S0, 4095
9D00F50C  8CE60000   LW A2, 0(A3)
9D00F510  00CB5021   ADDU T2, A2, T3
9D00F538  0010BB02   SRL S7, S0, 12
9D00F53C  00179080   SLL S2, S7, 2
9D00F540  266D3010   ADDIU T5, S3, 12304
9D00F544  024D6021   ADDU T4, S2, T5
9D00F548  32020FFF   ANDI V0, S0, 4095
9D00F54C  8D950000   LW S5, 0(T4)
9D00F550  02A27021   ADDU T6, S5, V0
9D00F590  00111B02   SRL V1, S1, 12
9D00F594  0003C880   SLL T9, V1, 2
9D00F598  26673010   ADDIU A3, S3, 12304
9D00F59C  03275821   ADDU T3, T9, A3
9D00F5A0  32260FFF   ANDI A2, S1, 4095
9D00F5A4  8D6A0000   LW T2, 0(T3)
9D00F5A8  01464021   ADDU T0, T2, A2
9D00F5F8  00117B02   SRL T7, S1, 12
9D00F5FC  000F2880   SLL A1, T7, 2
9D00F600  26783010   ADDIU T8, S3, 12304
9D00F604  00B8F821   ADDU RA, A1, T8
9D00F608  32230FFF   ANDI V1, S1, 4095
9D00F60C  8FF90000   LW T9, 0(RA)
9D00F610  03233821   ADDU A3, T9, V1
9D00F674  00116302   SRL T4, S1, 12
9D00F678  000C7080   SLL T6, T4, 2
9D00F67C  26623010   ADDIU V0, S3, 12304
9D00F680  01C22021   ADDU A0, T6, V0
9D00F684  32310FFF   ANDI S1, S1, 4095
9D00F688  8C8F0000   LW T7, 0(A0)
9D00F68C  01F12821   ADDU A1, T7, S1
9D00F704  00114302   SRL T0, S1, 12
9D00F708  00084880   SLL T1, T0, 2
9D00F70C  266D3010   ADDIU T5, S3, 12304
9D00F710  012D6021   ADDU T4, T1, T5
9D00F714  322E0FFF   ANDI T6, S1, 4095
9D00F718  8D820000   LW V0, 0(T4)
9D00F71C  004E2021   ADDU A0, V0, T6
9D00F79C  0011FB02   SRL RA, S1, 12
9D00F7A0  001F3080   SLL A2, RA, 2
9D00F7A4  266A3010   ADDIU T2, S3, 12304
9D00F7A8  00CA4021   ADDU T0, A2, T2
9D00F7AC  32290FFF   ANDI T1, S1, 4095
9D00F7B0  8D0D0000   LW T5, 0(T0)
9D00F7B4  01A96021   ADDU T4, T5, T1
9D00F7E4  00101B02   SRL V1, S0, 12
9D00F7E8  00035880   SLL T3, V1, 2
9D00F7EC  267F3010   ADDIU RA, S3, 12304
9D00F7F0  017F3021   ADDU A2, T3, RA
9D00F7F4  320A0FFF   ANDI T2, S0, 4095
9D00F7F8  8CC80000   LW T0, 0(A2)
9D00F7FC  010A4821   ADDU T1, T0, T2
9D00F880  00113302   SRL A2, S1, 12
9D00F884  00065080   SLL T2, A2, 2
9D00F888  26683010   ADDIU T0, S3, 12304
9D00F88C  01484821   ADDU T1, T2, T0
9D00F890  322D0FFF   ANDI T5, S1, 4095
9D00F894  8D2C0000   LW T4, 0(T1)
9D00F898  018D7021   ADDU T6, T4, T5
9D00F8B0  0010AB02   SRL S5, S0, 12
9D00F8B4  00159080   SLL S2, S5, 2
9D00F8B8  266F3010   ADDIU T7, S3, 12304
9D00F8BC  024F2821   ADDU A1, S2, T7
9D00F8C0  32180FFF   ANDI T8, S0, 4095
9D00F8C4  8CB90000   LW T9, 0(A1)
9D00F8C8  03381821   ADDU V1, T9, T8
9D00F954  00111B02   SRL V1, S1, 12
9D00F958  00035880   SLL T3, V1, 2
9D00F95C  267F3010   ADDIU RA, S3, 12304
9D00F960  017F3821   ADDU A3, T3, RA
9D00F964  32310FFF   ANDI S1, S1, 4095
9D00F968  8CE60000   LW A2, 0(A3)
9D00F96C  00D15021   ADDU T2, A2, S1
9D00F98C  0010BB02   SRL S7, S0, 12
9D00F990  00176080   SLL T4, S7, 2
9D00F994  26753010   ADDIU S5, S3, 12304
9D00F998  01957021   ADDU T6, T4, S5
9D00F99C  32020FFF   ANDI V0, S0, 4095
9D00F9A0  8DD20000   LW S2, 0(T6)
9D00F9A4  02422021   ADDU A0, S2, V0
9D00FA1C  00114B02   SRL T1, S1, 12
9D00FA20  00096880   SLL T5, T1, 2
9D00FA24  266C3010   ADDIU T4, S3, 12304
9D00FA28  01ACA821   ADDU S5, T5, T4
9D00FA2C  32310FFF   ANDI S1, S1, 4095
9D00FA30  8EAE0000   LW T6, 0(S5)
9D00FA34  01D11021   ADDU V0, T6, S1
9D00FA58  0010C302   SRL T8, S0, 12
9D00FA5C  0018C880   SLL T9, T8, 2
9D00FA60  266B3010   ADDIU T3, S3, 12304
9D00FA64  032BF821   ADDU RA, T9, T3
9D00FA68  32030FFF   ANDI V1, S0, 4095
9D00FA6C  8FF20000   LW S2, 0(RA)
9D00FA70  02433821   ADDU A3, S2, V1
9D00FAC0  00117B02   SRL T7, S1, 12
9D00FAC4  000F2880   SLL A1, T7, 2
9D00FAC8  26783010   ADDIU T8, S3, 12304
9D00FACC  00B8C821   ADDU T9, A1, T8
9D00FAD0  32310FFF   ANDI S1, S1, 4095
9D00FAD4  8F2B0000   LW T3, 0(T9)
9D00FAD8  0171F821   ADDU RA, T3, S1
9D00FAFC  0010BB02   SRL S7, S0, 12
9D00FB00  00179080   SLL S2, S7, 2
9D00FB04  266A3010   ADDIU T2, S3, 12304
9D00FB08  024A4021   ADDU T0, S2, T2
9D00FB0C  32090FFF   ANDI T1, S0, 4095
9D00FB10  8D0D0000   LW T5, 0(T0)
9D00FB14  01A96021   ADDU T4, T5, T1
9D00FB64  00111B02   SRL V1, S1, 12
9D00FB68  00033880   SLL A3, V1, 2
9D00FB6C  26663010   ADDIU A2, S3, 12304
9D00FB70  00E65021   ADDU T2, A3, A2
9D00FB74  32310FFF   ANDI S1, S1, 4095
9D00FB78  8D480000   LW T0, 0(T2)
9D00FB7C  01114821   ADDU T1, T0, S1
9D00FB9C  0010BB02   SRL S7, S0, 12
9D00FBA0  00179080   SLL S2, S7, 2
9D00FBA4  266E3010   ADDIU T6, S3, 12304
9D00FBA8  024E1021   ADDU V0, S2, T6
9D00FBAC  320F0FFF   ANDI T7, S0, 4095
9D00FBB0  8C440000   LW A0, 0(V0)
9D00FBB4  008F2821   ADDU A1, A0, T7
9D00FC10  00116302   SRL T4, S1, 12
9D00FC14  000CA880   SLL S5, T4, 2
9D00FC18  266E3010   ADDIU T6, S3, 12304
9D00FC1C  02AE1021   ADDU V0, S5, T6
9D00FC20  32310FFF   ANDI S1, S1, 4095
9D00FC24  8C4F0000   LW T7, 0(V0)
9D00FC28  01F12021   ADDU A0, T7, S1
9D00FD48  001F3880   SLL A3, RA, 2
9D00FD4C  26663010   ADDIU A2, S3, 12304
9D00FD50  00E61821   ADDU V1, A3, A2
9D00FD54  320A0FFF   ANDI T2, S0, 4095
9D00FD58  8C680000   LW T0, 0(V1)
9D00FD5C  010A4821   ADDU T1, T0, T2
9D00FDF8  00114302   SRL T0, S1, 12
9D00FDFC  00084880   SLL T1, T0, 2
9D00FE00  266D3010   ADDIU T5, S3, 12304
9D00FE04  012D6021   ADDU T4, T1, T5
9D00FE08  32310FFF   ANDI S1, S1, 4095
9D00FE0C  8D8E0000   LW T6, 0(T4)
9D00FE10  01D1A821   ADDU S5, T6, S1
9D00FE9C  0011FB02   SRL RA, S1, 12
9D00FEA0  001F3080   SLL A2, RA, 2
9D00FEA4  26633010   ADDIU V1, S3, 12304
9D00FEA8  00C35021   ADDU T2, A2, V1
9D00FEAC  32280FFF   ANDI T0, S1, 4095
9D00FEB0  8D490000   LW T1, 0(T2)
9D00FEB4  01286821   ADDU T5, T1, T0
9D00FF50  0011FB02   SRL RA, S1, 12
9D00FF54  001F4080   SLL T0, RA, 2
9D00FF58  26693010   ADDIU T1, S3, 12304
9D00FF5C  01096821   ADDU T5, T0, T1
9D00FF60  322C0FFF   ANDI T4, S1, 4095
9D00FF64  8DB10000   LW S1, 0(T5)
9D00FF68  022C7021   ADDU T6, S1, T4
9D00FFE4  00113302   SRL A2, S1, 12
9D00FFE8  00061880   SLL V1, A2, 2
9D00FFEC  266A3010   ADDIU T2, S3, 12304
9D00FFF0  006AF821   ADDU RA, V1, T2
9D00FFF4  32280FFF   ANDI T0, S1, 4095
9D00FFF8  8FE90000   LW T1, 0(RA)
9D00FFFC  01286821   ADDU T5, T1, T0
9D010080  00115B02   SRL T3, S1, 12
9D010084  000B2080   SLL A0, T3, 2
9D010088  26673010   ADDIU A3, S3, 12304
9D01008C  00873021   ADDU A2, A0, A3
9D010090  32230FFF   ANDI V1, S1, 4095
9D010094  8CCA0000   LW T2, 0(A2)
9D010098  0143F821   ADDU RA, T2, V1
9D010114  00114B02   SRL T1, S1, 12
9D010118  00096880   SLL T5, T1, 2
9D01011C  266C3010   ADDIU T4, S3, 12304
9D010120  01AC7021   ADDU T6, T5, T4
9D010124  32310FFF   ANDI S1, S1, 4095
9D010128  8DC20000   LW V0, 0(T6)
9D01012C  00517821   ADDU T7, V0, S1
9D010148  0010AB02   SRL S5, S0, 12
9D01014C  00159080   SLL S2, S5, 2
9D010150  26753010   ADDIU S5, S3, 12304
9D010154  02555821   ADDU T3, S2, S5
9D010158  32040FFF   ANDI A0, S0, 4095
9D01015C  8D670000   LW A3, 0(T3)
9D010160  00E43021   ADDU A2, A3, A0
9D0101D8  0011AB02   SRL S5, S1, 12
9D0101DC  00153880   SLL A3, S5, 2
9D0101E0  26663010   ADDIU A2, S3, 12304
9D0101E4  00E65021   ADDU T2, A3, A2
9D0101E8  32310FFF   ANDI S1, S1, 4095
9D0101EC  8D430000   LW V1, 0(T2)
9D0101F0  0071F821   ADDU RA, V1, S1
9D010214  00109302   SRL S2, S0, 12
9D010218  00126080   SLL T4, S2, 2
9D01021C  26753010   ADDIU S5, S3, 12304
9D010220  01957021   ADDU T6, T4, S5
9D010224  32020FFF   ANDI V0, S0, 4095
9D010228  8DCF0000   LW T7, 0(T6)
9D01022C  01E22821   ADDU A1, T7, V0
9D0102D8  0011FB02   SRL RA, S1, 12
9D0102DC  001FA880   SLL S5, RA, 2
9D0102E0  26663010   ADDIU A2, S3, 12304
9D0102E4  02A65021   ADDU T2, S5, A2
9D0102E8  32310FFF   ANDI S1, S1, 4095
9D0102EC  8D430000   LW V1, 0(T2)
9D0102F0  00714021   ADDU T0, V1, S1
9D010314  00109302   SRL S2, S0, 12
9D010318  00127080   SLL T6, S2, 2
9D01031C  26623010   ADDIU V0, S3, 12304
9D010320  01C27821   ADDU T7, T6, V0
9D010324  32050FFF   ANDI A1, S0, 4095
9D010328  8DF80000   LW T8, 0(T7)
9D01032C  0305C821   ADDU T9, T8, A1
9D010398  00111302   SRL V0, S1, 12
9D01039C  00022880   SLL A1, V0, 2
9D0103A0  26783010   ADDIU T8, S3, 12304
9D0103A4  00B8C821   ADDU T9, A1, T8
9D0103A8  32310FFF   ANDI S1, S1, 4095
9D0103AC  8F2B0000   LW T3, 0(T9)
9D0103B0  01712021   ADDU A0, T3, S1
9D0103D4  00109302   SRL S2, S0, 12
9D0103D8  00123080   SLL A2, S2, 2
9D0103DC  266A3010   ADDIU T2, S3, 12304
9D0103E0  00CA4021   ADDU T0, A2, T2
9D0103E4  32030FFF   ANDI V1, S0, 4095
9D0103E8  8D090000   LW T1, 0(T0)
9D0103EC  01236821   ADDU T5, T1, V1
9D010440  0011FB02   SRL RA, S1, 12
9D010444  001FA880   SLL S5, RA, 2
9D010448  26663010   ADDIU A2, S3, 12304
9D01044C  02A65021   ADDU T2, S5, A2
9D010450  32310FFF   ANDI S1, S1, 4095
9D010454  8D480000   LW T0, 0(T2)
9D010458  01111821   ADDU V1, T0, S1
9D010478  00109302   SRL S2, S0, 12
9D01047C  00127080   SLL T6, S2, 2
9D010480  266F3010   ADDIU T7, S3, 12304
9D010484  01CF1021   ADDU V0, T6, T7
9D010488  32050FFF   ANDI A1, S0, 4095
9D01048C  8C580000   LW T8, 0(V0)
9D010490  0305C821   ADDU T9, T8, A1
9D010514  00117B02   SRL T7, S1, 12
9D010518  000F2080   SLL A0, T7, 2
9D01051C  26673010   ADDIU A3, S3, 12304
9D010520  0087F821   ADDU RA, A0, A3
9D010524  32310FFF   ANDI S1, S1, 4095
9D010528  8FF50000   LW S5, 0(RA)
9D01052C  02B13021   ADDU A2, S5, S1
9D01059C  00107B02   SRL T7, S0, 12
9D0105A0  000F2080   SLL A0, T7, 2
9D0105A4  26673010   ADDIU A3, S3, 12304
9D0105A8  0087F821   ADDU RA, A0, A3
9D0105AC  32110FFF   ANDI S1, S0, 4095
9D0105B0  8FF50000   LW S5, 0(RA)
9D0105B4  02B13021   ADDU A2, S5, S1
9D0105DC  00109302   SRL S2, S0, 12
9D0105E0  00124880   SLL T1, S2, 2
9D0105E4  266D3010   ADDIU T5, S3, 12304
9D0105E8  012D6021   ADDU T4, T1, T5
9D0105EC  320E0FFF   ANDI T6, S0, 4095
9D0105F0  8D820000   LW V0, 0(T4)
9D0105F4  004E2821   ADDU A1, V0, T6
9D0105F8  90B80000   LBU T8, 0(A1)
9D010654  00111B02   SRL V1, S1, 12
9D010658  00034880   SLL T1, V1, 2
9D01065C  266D3010   ADDIU T5, S3, 12304
9D010660  012D6021   ADDU T4, T1, T5
9D010664  32310FFF   ANDI S1, S1, 4095
9D010668  8D8E0000   LW T6, 0(T4)
9D01066C  01D11021   ADDU V0, T6, S1
9D0106D0  0010AB02   SRL S5, S0, 12
9D0106D4  00153080   SLL A2, S5, 2
9D0106D8  266A3010   ADDIU T2, S3, 12304
9D0106DC  00CA4021   ADDU T0, A2, T2
9D0106E0  32090FFF   ANDI T1, S0, 4095
9D0106E4  8D030000   LW V1, 0(T0)
9D0106E8  00696821   ADDU T5, V1, T1
9D010710  00101302   SRL V0, S0, 12
9D010714  00022880   SLL A1, V0, 2
9D010718  26783010   ADDIU T8, S3, 12304
9D01071C  00B8C821   ADDU T9, A1, T8
9D010720  320B0FFF   ANDI T3, S0, 4095
9D010724  8F320000   LW S2, 0(T9)
9D010728  024B7821   ADDU T7, S2, T3
9D010788  00117302   SRL T6, S1, 12
9D01078C  000E2880   SLL A1, T6, 2
9D010790  26623010   ADDIU V0, S3, 12304
9D010794  00A2C021   ADDU T8, A1, V0
9D010798  32310FFF   ANDI S1, S1, 4095
9D01079C  8F190000   LW T9, 0(T8)
9D0107A0  03315821   ADDU T3, T9, S1
9D0107D8  001F3080   SLL A2, RA, 2
9D0107DC  266A3010   ADDIU T2, S3, 12304
9D0107E0  00CA4021   ADDU T0, A2, T2
9D0107E4  30490F00   ANDI T1, V0, 3840
9D0107E8  8D030000   LW V1, 0(T0)
9D0107EC  00696821   ADDU T5, V1, T1
9D0107F8  00022B02   SRL A1, V0, 12
9D0107FC  0005C080   SLL T8, A1, 2
9D010800  030A8821   ADDU S1, T8, T2
9D010804  30420FFF   ANDI V0, V0, 4095
9D010808  8E390000   LW T9, 0(S1)
9D01080C  03225821   ADDU T3, T9, V0
9D01084C  00115302   SRL T2, S1, 12
9D010850  000A4080   SLL T0, T2, 2
9D010854  26693010   ADDIU T1, S3, 12304
9D010858  01091821   ADDU V1, T0, T1
9D01085C  322D0FFF   ANDI T5, S1, 4095
9D010860  8C6C0000   LW T4, 0(V1)
9D010864  018D7021   ADDU T6, T4, T5
9D0108EC  0011FB02   SRL RA, S1, 12
9D0108F0  001F4880   SLL T1, RA, 2
9D0108F4  26633010   ADDIU V1, S3, 12304
9D0108F8  01236821   ADDU T5, T1, V1
9D0108FC  322C0FFF   ANDI T4, S1, 4095
9D010900  8DAE0000   LW T6, 0(T5)
9D010904  01CC2821   ADDU A1, T6, T4
9D010988  00115302   SRL T2, S1, 12
9D01098C  000A2080   SLL A0, T2, 2
9D010990  26683010   ADDIU T0, S3, 12304
9D010994  0088F821   ADDU RA, A0, T0
9D010998  32290FFF   ANDI T1, S1, 4095
9D01099C  8FE30000   LW V1, 0(RA)
9D0109A0  00696821   ADDU T5, V1, T1
9D010A58  0011FB02   SRL RA, S1, 12
9D010A5C  001F7080   SLL T6, RA, 2
9D010A60  26653010   ADDIU A1, S3, 12304
9D010A64  01C5C021   ADDU T8, T6, A1
9D010A68  32310FFF   ANDI S1, S1, 4095
9D010A6C  8F150000   LW S5, 0(T8)
9D010A70  02B1C821   ADDU T9, S5, S1
9D010AA0  00101B02   SRL V1, S0, 12
9D010AA4  00036880   SLL T5, V1, 2
9D010AA8  266C3010   ADDIU T4, S3, 12304
9D010AAC  01ACF821   ADDU RA, T5, T4
9D010AB0  320E0FFF   ANDI T6, S0, 4095
9D010AB4  8FE50000   LW A1, 0(RA)
9D010AB8  00AEC021   ADDU T8, A1, T6
9D010B3C  0011FB02   SRL RA, S1, 12
9D010B40  001F7080   SLL T6, RA, 2
9D010B44  26653010   ADDIU A1, S3, 12304
9D010B48  01C5C021   ADDU T8, T6, A1
9D010B4C  32310FFF   ANDI S1, S1, 4095
9D010B50  8F190000   LW T9, 0(T8)
9D010B54  03311021   ADDU V0, T9, S1
9D010B6C  00109302   SRL S2, S0, 12
9D010B70  0012A880   SLL S5, S2, 2
9D010B74  26663010   ADDIU A2, S3, 12304
9D010B78  02A65021   ADDU T2, S5, A2
9D010B7C  32040FFF   ANDI A0, S0, 4095
9D010B80  8D480000   LW T0, 0(T2)
9D010B84  01041821   ADDU V1, T0, A0
9D010C34  0011FB02   SRL RA, S1, 12
9D010C38  001FC080   SLL T8, RA, 2
9D010C3C  26793010   ADDIU T9, S3, 12304
9D010C40  03191021   ADDU V0, T8, T9
9D010C44  32310FFF   ANDI S1, S1, 4095
9D010C48  8C4B0000   LW T3, 0(V0)
9D010C4C  01717821   ADDU T7, T3, S1
9D010C70  00109302   SRL S2, S0, 12
9D010C74  00125080   SLL T2, S2, 2
9D010C78  26753010   ADDIU S5, S3, 12304
9D010C7C  01552021   ADDU A0, T2, S5
9D010C80  32080FFF   ANDI T0, S0, 4095
9D010C84  8C830000   LW V1, 0(A0)
9D010C88  00686821   ADDU T5, V1, T0
9D010D38  0011AB02   SRL S5, S1, 12
9D010D3C  0015F880   SLL RA, S5, 2
9D010D40  26793010   ADDIU T9, S3, 12304
9D010D44  03F91021   ADDU V0, RA, T9
9D010D48  32310FFF   ANDI S1, S1, 4095
9D010D4C  8C4B0000   LW T3, 0(V0)
9D010D50  01717821   ADDU T7, T3, S1
9D010D74  00109302   SRL S2, S0, 12
9D010D78  00122080   SLL A0, S2, 2
9D010D7C  26683010   ADDIU T0, S3, 12304
9D010D80  00886821   ADDU T5, A0, T0
9D010D84  32030FFF   ANDI V1, S0, 4095
9D010D88  8DAC0000   LW T4, 0(T5)
9D010D8C  01834821   ADDU T1, T4, V1
9D010E00  00114302   SRL T0, S1, 12
9D010E04  00084880   SLL T1, T0, 2
9D010E08  266E3010   ADDIU T6, S3, 12304
9D010E0C  012E2821   ADDU A1, T1, T6
9D010E10  32310FFF   ANDI S1, S1, 4095
9D010E14  8CB80000   LW T8, 0(A1)
9D010E18  0311A821   ADDU S5, T8, S1
9D010E3C  00109302   SRL S2, S0, 12
9D010E40  00125880   SLL T3, S2, 2
9D010E44  266F3010   ADDIU T7, S3, 12304
9D010E48  016F3821   ADDU A3, T3, T7
9D010E4C  32060FFF   ANDI A2, S0, 4095
9D010E50  8CEA0000   LW T2, 0(A3)
9D010E54  01462021   ADDU A0, T2, A2
9D010EB0  00115B02   SRL T3, S1, 12
9D010EB4  000B7880   SLL T7, T3, 2
9D010EB8  26673010   ADDIU A3, S3, 12304
9D010EBC  01E73021   ADDU A2, T7, A3
9D010EC0  32310FFF   ANDI S1, S1, 4095
9D010EC4  8CCA0000   LW T2, 0(A2)
9D010EC8  01512021   ADDU A0, T2, S1
9D010EE8  00109302   SRL S2, S0, 12
9D010EEC  00124080   SLL T0, S2, 2
9D010EF0  26693010   ADDIU T1, S3, 12304
9D010EF4  01097021   ADDU T6, T0, T1
9D010EF8  32050FFF   ANDI A1, S0, 4095
9D010EFC  8DD80000   LW T8, 0(T6)
9D010F00  0305A821   ADDU S5, T8, A1
9D010F8C  00114B02   SRL T1, S1, 12
9D010F90  00095880   SLL T3, T1, 2
9D010F94  266F3010   ADDIU T7, S3, 12304
9D010F98  016F3821   ADDU A3, T3, T7
9D010F9C  32310FFF   ANDI S1, S1, 4095
9D010FA0  8CE60000   LW A2, 0(A3)
9D010FA4  00D15021   ADDU T2, A2, S1
9D010FF4  0010FB02   SRL RA, S0, 12
9D010FF8  001FC880   SLL T9, RA, 2
9D010FFC  26623010   ADDIU V0, S3, 12304
9D011000  03224821   ADDU T1, T9, V0
9D011004  320B0FFF   ANDI T3, S0, 4095
9D011008  8D2F0000   LW T7, 0(T1)
9D01100C  01EB3821   ADDU A3, T7, T3
9D0110D4  00111B02   SRL V1, S1, 12
9D0110D8  00036080   SLL T4, V1, 2
9D0110DC  26683010   ADDIU T0, S3, 12304
9D0110E0  01887021   ADDU T6, T4, T0
9D0110E4  32310FFF   ANDI S1, S1, 4095
9D0110E8  8DC50000   LW A1, 0(T6)
9D0110EC  00B1C021   ADDU T8, A1, S1
9D0111B0  0011FB02   SRL RA, S1, 12
9D0111B4  001F4880   SLL T1, RA, 2
9D0111B8  26623010   ADDIU V0, S3, 12304
9D0111BC  01225821   ADDU T3, T1, V0
9D0111C0  32310FFF   ANDI S1, S1, 4095
9D0111C4  8D750000   LW S5, 0(T3)
9D0111C8  02B17821   ADDU T7, S5, S1
9D011288  0011FB02   SRL RA, S1, 12
9D01128C  001F1880   SLL V1, RA, 2
9D011290  266C3010   ADDIU T4, S3, 12304
9D011294  006C4021   ADDU T0, V1, T4
9D011298  32310FFF   ANDI S1, S1, 4095
9D01129C  8D0E0000   LW T6, 0(T0)
9D0112A0  01D12821   ADDU A1, T6, S1
9D011328  00116B02   SRL T5, S1, 12
9D01132C  000DF880   SLL RA, T5, 2
9D011330  26633010   ADDIU V1, S3, 12304
9D011334  03E36021   ADDU T4, RA, V1
9D011338  32280FFF   ANDI T0, S1, 4095
9D01133C  8D910000   LW S1, 0(T4)
9D011340  02287021   ADDU T6, S1, T0
9D0113FC  0011FB02   SRL RA, S1, 12
9D011400  001F2080   SLL A0, RA, 2
9D011404  26793010   ADDIU T9, S3, 12304
9D011408  00994821   ADDU T1, A0, T9
9D01140C  32310FFF   ANDI S1, S1, 4095
9D011410  8D350000   LW S5, 0(T1)
9D011414  02B15821   ADDU T3, S5, S1
9D011474  00114302   SRL T0, S1, 12
9D011478  00087080   SLL T6, T0, 2
9D01147C  26653010   ADDIU A1, S3, 12304
9D011480  01C5C021   ADDU T8, T6, A1
9D011484  323F0FFF   ANDI RA, S1, 4095
9D011488  8F040000   LW A0, 0(T8)
9D01148C  009FC821   ADDU T9, A0, RA
9D0114A8  00101302   SRL V0, S0, 12
9D0114AC  00027880   SLL T7, V0, 2
9D0114B0  3C07A001   LUI A3, -24575
9D0114B4  24E63010   ADDIU A2, A3, 12304
9D0114B8  01E65021   ADDU T2, T7, A2
9D0114BC  320D0FFF   ANDI T5, S0, 4095
9D0114C0  8D430000   LW V1, 0(T2)
9D0114C4  006D6021   ADDU T4, V1, T5
9D011510  00113B02   SRL A3, S1, 12
9D011514  00073080   SLL A2, A3, 2
9D011518  266A3010   ADDIU T2, S3, 12304
9D01151C  00CA6821   ADDU T5, A2, T2
9D011520  32310FFF   ANDI S1, S1, 4095
9D011524  8DA30000   LW V1, 0(T5)
9D011528  00716021   ADDU T4, V1, S1
9D011544  0010C302   SRL T8, S0, 12
9D011548  0018F880   SLL RA, T8, 2
9D01154C  3C04A001   LUI A0, -24575
9D011550  24993010   ADDIU T9, A0, 12304
9D011554  03F94821   ADDU T1, RA, T9
9D011558  320B0FFF   ANDI T3, S0, 4095
9D01155C  8D220000   LW V0, 0(T1)
9D011560  004B7821   ADDU T7, V0, T3
9D0115B0  0011FB02   SRL RA, S1, 12
9D0115B4  001F4880   SLL T1, RA, 2
9D0115B8  266B3010   ADDIU T3, S3, 12304
9D0115BC  012B1021   ADDU V0, T1, T3
9D0115C0  32310FFF   ANDI S1, S1, 4095
9D0115C4  8C4F0000   LW T7, 0(V0)
9D0115C8  01F13821   ADDU A3, T7, S1
9D0115E4  00101B02   SRL V1, S0, 12
9D0115E8  00036080   SLL T4, V1, 2
9D0115EC  266E3010   ADDIU T6, S3, 12304
9D0115F0  018E4021   ADDU T0, T4, T6
9D0115F4  32050FFF   ANDI A1, S0, 4095
9D0115F8  8D180000   LW T8, 0(T0)
9D0115FC  03052021   ADDU A0, T8, A1
9D011634  00115302   SRL T2, S1, 12
9D011638  000A6880   SLL T5, T2, 2
9D01163C  01AE1821   ADDU V1, T5, T6
9D011640  32310FFF   ANDI S1, S1, 4095
9D011644  8C6C0000   LW T4, 0(V1)
9D011648  01917021   ADDU T6, T4, S1
9D011664  00102302   SRL A0, S0, 12
9D011668  0004C880   SLL T9, A0, 2
9D01166C  267F3010   ADDIU RA, S3, 12304
9D011670  033F4821   ADDU T1, T9, RA
9D011674  320B0FFF   ANDI T3, S0, 4095
9D011678  8D220000   LW V0, 0(T1)
9D01167C  004B7821   ADDU T7, V0, T3
9D0116B0  00114302   SRL T0, S1, 12
9D0116B4  00082880   SLL A1, T0, 2
9D0116B8  00BFC021   ADDU T8, A1, RA
9D0116BC  32310FFF   ANDI S1, S1, 4095
9D0116C0  8F040000   LW A0, 0(T8)
9D0116C4  0091C821   ADDU T9, A0, S1
9D0116E0  00101302   SRL V0, S0, 12
9D0116E4  00027880   SLL T7, V0, 2
9D0116E8  26673010   ADDIU A3, S3, 12304
9D0116EC  01E73021   ADDU A2, T7, A3
9D0116F0  320A0FFF   ANDI T2, S0, 4095
9D0116F4  8CCD0000   LW T5, 0(A2)
9D0116F8  01AA1821   ADDU V1, T5, T2
9D01172C  0011FB02   SRL RA, S1, 12
9D011730  001F4880   SLL T1, RA, 2
9D011734  01275821   ADDU T3, T1, A3
9D011738  32310FFF   ANDI S1, S1, 4095
9D01173C  8D620000   LW V0, 0(T3)
9D011740  00517821   ADDU T7, V0, S1
9D01175C  00106B02   SRL T5, S0, 12
9D011760  000D1880   SLL V1, T5, 2
9D011764  266C3010   ADDIU T4, S3, 12304
9D011768  006C7021   ADDU T6, V1, T4
9D01176C  32080FFF   ANDI T0, S0, 4095
9D011770  8DC50000   LW A1, 0(T6)
9D011774  00A8C021   ADDU T8, A1, T0
9D0117AC  00113302   SRL A2, S1, 12
9D0117B0  00065080   SLL T2, A2, 2
9D0117B4  014C6821   ADDU T5, T2, T4
9D0117B8  32310FFF   ANDI S1, S1, 4095
9D0117BC  8DA30000   LW V1, 0(T5)
9D0117C0  00716021   ADDU T4, V1, S1
9D011814  00105B02   SRL T3, S0, 12
9D011818  000B7880   SLL T7, T3, 2
9D01181C  26623010   ADDIU V0, S3, 12304
9D011820  01E23821   ADDU A3, T7, V0
9D011824  32060FFF   ANDI A2, S0, 4095
9D011828  8CEA0000   LW T2, 0(A3)
9D01182C  01466821   ADDU T5, T2, A2
9D011884  0010AB02   SRL S5, S0, 12
9D011888  0015C080   SLL T8, S5, 2
9D01188C  26793010   ADDIU T9, S3, 12304
9D011890  0319F821   ADDU RA, T8, T9
9D011894  32040FFF   ANDI A0, S0, 4095
9D011898  8FE90000   LW T1, 0(RA)
9D01189C  01245821   ADDU T3, T1, A0
9D0118D4  00101B02   SRL V1, S0, 12
9D0118D8  00036080   SLL T4, V1, 2
9D0118DC  26743010   ADDIU S4, S3, 12304
9D0118E0  01947021   ADDU T6, T4, S4
9D0118E4  32080FFF   ANDI T0, S0, 4095
9D0118E8  8DC50000   LW A1, 0(T6)
9D0118EC  00A89021   ADDU S2, A1, T0
9D011924  00114B02   SRL T1, S1, 12
9D011928  00095880   SLL T3, T1, 2
9D01192C  266F3010   ADDIU T7, S3, 12304
9D011930  016F1021   ADDU V0, T3, T7
9D011934  32310FFF   ANDI S1, S1, 4095
9D011938  8C470000   LW A3, 0(V0)
9D01193C  00F13021   ADDU A2, A3, S1
9D011998  0011CB02   SRL T9, S1, 12
9D01199C  0019F880   SLL RA, T9, 2
9D0119A0  26643010   ADDIU A0, S3, 12304
9D0119A4  03E44821   ADDU T1, RA, A0
9D0119A8  322B0FFF   ANDI T3, S1, 4095
9D0119AC  8D2F0000   LW T7, 0(T1)
9D0119B0  01EB1021   ADDU V0, T7, T3
9D011A04  00114302   SRL T0, S1, 12
9D011A08  00082880   SLL A1, T0, 2
9D011A0C  26783010   ADDIU T8, S3, 12304
9D011A10  00B8C821   ADDU T9, A1, T8
9D011A14  323F0FFF   ANDI RA, S1, 4095
9D011A18  8F240000   LW A0, 0(T9)
9D011A1C  009F4821   ADDU T1, A0, RA
9D011A70  00116302   SRL T4, S1, 12
9D011A74  000C7080   SLL T6, T4, 2
9D011A78  26683010   ADDIU T0, S3, 12304
9D011A7C  01C82821   ADDU A1, T6, T0
9D011A80  32310FFF   ANDI S1, S1, 4095
9D011A84  8CB80000   LW T8, 0(A1)
9D011A88  0311C821   ADDU T9, T8, S1
9D011AE0  00111B02   SRL V1, S1, 12
9D011AE4  00036080   SLL T4, V1, 2
9D011AE8  266E3010   ADDIU T6, S3, 12304
9D011AEC  018E4021   ADDU T0, T4, T6
9D011AF0  32250FFF   ANDI A1, S1, 4095
9D011AF4  8D110000   LW S1, 0(T0)
9D011AF8  0225C021   ADDU T8, S1, A1
9D011B1C  00103302   SRL A2, S0, 12
9D011B20  00065080   SLL T2, A2, 2
9D011B24  266D3010   ADDIU T5, S3, 12304
9D011B28  014D1821   ADDU V1, T2, T5
9D011B2C  320C0FFF   ANDI T4, S0, 4095
9D011B30  8C6E0000   LW T6, 0(V1)
9D011B34  01CC4021   ADDU T0, T6, T4
9D011BB8  00111B02   SRL V1, S1, 12
9D011BBC  00036080   SLL T4, V1, 2
9D011BC0  266E3010   ADDIU T6, S3, 12304
9D011BC4  018E4021   ADDU T0, T4, T6
9D011BC8  32250FFF   ANDI A1, S1, 4095
9D011BCC  8D110000   LW S1, 0(T0)
9D011BD0  0225C021   ADDU T8, S1, A1
9D011BEC  00104B02   SRL T1, S0, 12
9D011BF0  00095880   SLL T3, T1, 2
9D011BF4  3C0FA001   LUI T7, -24575
9D011BF8  25E23010   ADDIU V0, T7, 12304
9D011BFC  01623021   ADDU A2, T3, V0
9D011C00  320A0FFF   ANDI T2, S0, 4095
9D011C04  8CCD0000   LW T5, 0(A2)
9D011C08  01AA3821   ADDU A3, T5, T2
9D011C58  0011FB02   SRL RA, S1, 12
9D011C5C  001F3080   SLL A2, RA, 2
9D011C60  266A3010   ADDIU T2, S3, 12304
9D011C64  00CA6821   ADDU T5, A2, T2
9D011C68  32310FFF   ANDI S1, S1, 4095
9D011C6C  8DA70000   LW A3, 0(T5)
9D011C70  00F16021   ADDU T4, A3, S1
9D011C8C  00102B02   SRL A1, S0, 12
9D011C90  0005C080   SLL T8, A1, 2
9D011C94  3C19A001   LUI T9, -24575
9D011C98  27243010   ADDIU A0, T9, 12304
9D011C9C  03044821   ADDU T1, T8, A0
9D011CA0  320B0FFF   ANDI T3, S0, 4095
9D011CA4  8D2F0000   LW T7, 0(T1)
9D011CA8  01EB1021   ADDU V0, T7, T3
9D011D08  00111302   SRL V0, S1, 12
9D011D0C  0002F880   SLL RA, V0, 2
9D011D10  26663010   ADDIU A2, S3, 12304
9D011D14  03E65021   ADDU T2, RA, A2
9D011D18  32310FFF   ANDI S1, S1, 4095
9D011D1C  8D4D0000   LW T5, 0(T2)
9D011D20  01B13821   ADDU A3, T5, S1
9D011D3C  00104302   SRL T0, S0, 12
9D011D40  00082880   SLL A1, T0, 2
9D011D44  26783010   ADDIU T8, S3, 12304
9D011D48  00B8C821   ADDU T9, A1, T8
9D011D4C  32090FFF   ANDI T1, S0, 4095
9D011D50  8F240000   LW A0, 0(T9)
9D011D54  00895821   ADDU T3, A0, T1
9D011D94  00114302   SRL T0, S1, 12
9D011D98  00082880   SLL A1, T0, 2
9D011D9C  00B8C021   ADDU T8, A1, T8
9D011DA0  32310FFF   ANDI S1, S1, 4095
9D011DA4  8F190000   LW T9, 0(T8)
9D011DA8  03314821   ADDU T1, T9, S1
9D011DC4  00101302   SRL V0, S0, 12
9D011DC8  0002F880   SLL RA, V0, 2
9D011DCC  26663010   ADDIU A2, S3, 12304
9D011DD0  03E65021   ADDU T2, RA, A2
9D011DD4  320D0FFF   ANDI T5, S0, 4095
9D011DD8  8D470000   LW A3, 0(T2)
9D011DDC  00ED6021   ADDU T4, A3, T5
9D011E18  00117B02   SRL T7, S1, 12
9D011E1C  000F1080   SLL V0, T7, 2
9D011E20  0046F821   ADDU RA, V0, A2
9D011E24  32310FFF   ANDI S1, S1, 4095
9D011E28  8FE60000   LW A2, 0(RA)
9D011E2C  00D15021   ADDU T2, A2, S1
9D011E48  00101B02   SRL V1, S0, 12
9D011E4C  00037080   SLL T6, V1, 2
9D011E50  26683010   ADDIU T0, S3, 12304
9D011E54  01C82821   ADDU A1, T6, T0
9D011E58  32180FFF   ANDI T8, S0, 4095
9D011E5C  8CB90000   LW T9, 0(A1)
9D011E60  03384821   ADDU T1, T9, T8
9D011EA0  00111B02   SRL V1, S1, 12
9D011EA4  00037080   SLL T6, V1, 2
9D011EA8  01C84021   ADDU T0, T6, T0
9D011EAC  32310FFF   ANDI S1, S1, 4095
9D011EB0  8D050000   LW A1, 0(T0)
9D011EB4  00B1C021   ADDU T8, A1, S1
9D011ED0  00105B02   SRL T3, S0, 12
9D011ED4  000B7880   SLL T7, T3, 2
9D011ED8  26623010   ADDIU V0, S3, 12304
9D011EDC  01E2F821   ADDU RA, T7, V0
9D011EE0  32060FFF   ANDI A2, S0, 4095
9D011EE4  8FEA0000   LW T2, 0(RA)
9D011EE8  01466821   ADDU T5, T2, A2
9D011F2C  00117B02   SRL T7, S1, 12
9D011F30  000FF880   SLL RA, T7, 2
9D011F34  03E21021   ADDU V0, RA, V0
9D011F38  32310FFF   ANDI S1, S1, 4095
9D011F3C  8C460000   LW A2, 0(V0)
9D011F40  00D15021   ADDU T2, A2, S1
9D011F8C  00104302   SRL T0, S0, 12
9D011F90  00082880   SLL A1, T0, 2
9D011F94  26783010   ADDIU T8, S3, 12304
9D011F98  00B8C821   ADDU T9, A1, T8
9D011F9C  32090FFF   ANDI T1, S0, 4095
9D011FA0  8F240000   LW A0, 0(T9)
9D011FA4  00895821   ADDU T3, A0, T1
9D012010  00114302   SRL T0, S1, 12
9D012014  00082880   SLL A1, T0, 2
9D012018  26783010   ADDIU T8, S3, 12304
9D01201C  00B8C821   ADDU T9, A1, T8
9D012020  32310FFF   ANDI S1, S1, 4095
9D012024  8F290000   LW T1, 0(T9)
9D012028  01312021   ADDU A0, T1, S1
9D01206C  00106302   SRL T4, S0, 12
9D012070  000C1880   SLL V1, T4, 2
9D012074  266E3010   ADDIU T6, S3, 12304
9D012078  006E4021   ADDU T0, V1, T6
9D01207C  32050FFF   ANDI A1, S0, 4095
9D012080  8D180000   LW T8, 0(T0)
9D012084  0305C821   ADDU T9, T8, A1
9D0120FC  0011FB02   SRL RA, S1, 12
9D012100  001F2880   SLL A1, RA, 2
9D012104  26783010   ADDIU T8, S3, 12304
9D012108  00B8C821   ADDU T9, A1, T8
9D01210C  32310FFF   ANDI S1, S1, 4095
9D012110  8F290000   LW T1, 0(T9)
9D012114  01312021   ADDU A0, T1, S1
9D01217C  0011FB02   SRL RA, S1, 12
9D012180  001FC880   SLL T9, RA, 2
9D012184  26693010   ADDIU T1, S3, 12304
9D012188  03292021   ADDU A0, T9, T1
9D01218C  32310FFF   ANDI S1, S1, 4095
9D012190  8C8B0000   LW T3, 0(A0)
9D012194  01717821   ADDU T7, T3, S1
9D0121EC  00112B02   SRL A1, S1, 12
9D0121F0  0005C080   SLL T8, A1, 2
9D0121F4  267F3010   ADDIU RA, S3, 12304
9D0121F8  031FC821   ADDU T9, T8, RA
9D0121FC  32290FFF   ANDI T1, S1, 4095
9D012200  8F240000   LW A0, 0(T9)
9D012204  00898821   ADDU S1, A0, T1
9D01226C  0011FB02   SRL RA, S1, 12
9D012270  001FC880   SLL T9, RA, 2
9D012274  26693010   ADDIU T1, S3, 12304
9D012278  03292021   ADDU A0, T9, T1
9D01227C  32310FFF   ANDI S1, S1, 4095
9D012280  8C8B0000   LW T3, 0(A0)
9D012284  01717821   ADDU T7, T3, S1
9D0122F0  0011FB02   SRL RA, S1, 12
9D0122F4  001F5880   SLL T3, RA, 2
9D0122F8  266F3010   ADDIU T7, S3, 12304
9D0122FC  016F1021   ADDU V0, T3, T7
9D012300  32310FFF   ANDI S1, S1, 4095
9D012304  8C460000   LW A2, 0(V0)
9D012308  00D15021   ADDU T2, A2, S1
9D012324  00109302   SRL S2, S0, 12
9D012328  0012A880   SLL S5, S2, 2
9D01232C  266E3010   ADDIU T6, S3, 12304
9D012330  02AE4021   ADDU T0, S5, T6
9D012334  32030FFF   ANDI V1, S0, 4095
9D012338  8D050000   LW A1, 0(T0)
9D01233C  00A3C021   ADDU T8, A1, V1
9D012340  93120000   LBU S2, 0(T8)
9D012360  AFB20010   SW S2, 16(SP)
9D012364  0B40565D   J .L95
9D012368  0240A821   ADDU S5, S2, ZERO
9D012370  00115B02   SRL T3, S1, 12
9D012374  000B7880   SLL T7, T3, 2
9D012378  26623010   ADDIU V0, S3, 12304
9D01237C  01E23021   ADDU A2, T7, V0
9D012380  32310FFF   ANDI S1, S1, 4095
9D012384  8CCA0000   LW T2, 0(A2)
9D012388  01516821   ADDU T5, T2, S1
9D01239C  AFB20010   SW S2, 16(SP)
9D0123A8  0010A302   SRL S4, S0, 12
9D0123AC  00149080   SLL S2, S4, 2
9D0123B0  26753010   ADDIU S5, S3, 12304
9D0123B4  02557021   ADDU T6, S2, S5
9D0123B8  32080FFF   ANDI T0, S0, 4095
9D0123BC  8DC30000   LW V1, 0(T6)
9D0123C0  00682821   ADDU A1, V1, T0
9D012414  00115302   SRL T2, S1, 12
9D012418  000A6880   SLL T5, T2, 2
9D01241C  26673010   ADDIU A3, S3, 12304
9D012420  01A76021   ADDU T4, T5, A3
9D012424  32310FFF   ANDI S1, S1, 4095
9D012428  8D940000   LW S4, 0(T4)
9D01242C  0291A821   ADDU S5, S4, S1
9D012450  0010F302   SRL FP, S0, 12
9D012454  001E9080   SLL S2, FP, 2
9D012458  26653010   ADDIU A1, S3, 12304
9D01245C  0245C021   ADDU T8, S2, A1
9D012460  32190FFF   ANDI T9, S0, 4095
9D012464  8F090000   LW T1, 0(T8)
9D012468  01392021   ADDU A0, T1, T9
9D01246C  90920000   LBU S2, 0(A0)
9D01248C  0240F021   ADDU FP, S2, ZERO
9D012490  0B40565D   J .L95
9D012494  0240A821   ADDU S5, S2, ZERO
9D01249C  00113302   SRL A2, S1, 12
9D0124A0  00065080   SLL T2, A2, 2
9D0124A4  266D3010   ADDIU T5, S3, 12304
9D0124A8  014D3821   ADDU A3, T2, T5
9D0124AC  322C0FFF   ANDI T4, S1, 4095
9D0124B0  8CF10000   LW S1, 0(A3)
9D0124B4  022CA821   ADDU S5, S1, T4
9D0124C8  0240F021   ADDU FP, S2, ZERO
9D0124D8  0010A302   SRL S4, S0, 12
9D0124DC  00149080   SLL S2, S4, 2
9D0124E0  26753010   ADDIU S5, S3, 12304
9D0124E4  02552821   ADDU A1, S2, S5
9D0124E8  32180FFF   ANDI T8, S0, 4095
9D0124EC  8CB90000   LW T9, 0(A1)
9D0124F0  03384821   ADDU T1, T9, T8
9D012544  00113B02   SRL A3, S1, 12
9D012548  00076080   SLL T4, A3, 2
9D01254C  266E3010   ADDIU T6, S3, 12304
9D012550  018E4021   ADDU T0, T4, T6
9D012554  32310FFF   ANDI S1, S1, 4095
9D012558  8D030000   LW V1, 0(T0)
9D01255C  0071A021   ADDU S4, V1, S1
9D012584  00109302   SRL S2, S0, 12
9D012588  0012C880   SLL T9, S2, 2
9D01258C  26693010   ADDIU T1, S3, 12304
9D012590  03292021   ADDU A0, T9, T1
9D012594  321F0FFF   ANDI RA, S0, 4095
9D012598  8C8B0000   LW T3, 0(A0)
9D01259C  017F7821   ADDU T7, T3, RA
9D0125DC  00114302   SRL T0, S1, 12
9D0125E0  00081880   SLL V1, T0, 2
9D0125E4  26753010   ADDIU S5, S3, 12304
9D0125E8  00752821   ADDU A1, V1, S5
9D0125EC  32310FFF   ANDI S1, S1, 4095
9D0125F0  8CB80000   LW T8, 0(A1)
9D0125F4  0311C821   ADDU T9, T8, S1
9D012618  0010A302   SRL S4, S0, 12
9D01261C  00149080   SLL S2, S4, 2
9D012620  266B3010   ADDIU T3, S3, 12304
9D012624  024B7821   ADDU T7, S2, T3
9D012628  32020FFF   ANDI V0, S0, 4095
9D01262C  8DE60000   LW A2, 0(T7)
9D012630  00C25021   ADDU T2, A2, V0
9D012670  00112B02   SRL A1, S1, 12
9D012674  0005C080   SLL T8, A1, 2
9D012678  26793010   ADDIU T9, S3, 12304
9D01267C  03194821   ADDU T1, T8, T9
9D012680  32310FFF   ANDI S1, S1, 4095
9D012684  8D240000   LW A0, 0(T1)
9D012688  0091F821   ADDU RA, A0, S1
9D0126AC  0010F302   SRL FP, S0, 12
9D0126B0  001E9080   SLL S2, FP, 2
9D0126B4  26623010   ADDIU V0, S3, 12304
9D0126B8  02423021   ADDU A2, S2, V0
9D0126BC  320A0FFF   ANDI T2, S0, 4095
9D0126C0  8CCD0000   LW T5, 0(A2)
9D0126C4  01AA3821   ADDU A3, T5, T2
9D012704  0011CB02   SRL T9, S1, 12
9D012708  00194880   SLL T1, T9, 2
9D01270C  26643010   ADDIU A0, S3, 12304
9D012710  0124F821   ADDU RA, T1, A0
9D012714  32310FFF   ANDI S1, S1, 4095
9D012718  8FEB0000   LW T3, 0(RA)
9D01271C  01717821   ADDU T7, T3, S1
9D012740  0010A302   SRL S4, S0, 12
9D012744  00149080   SLL S2, S4, 2
9D012748  266A3010   ADDIU T2, S3, 12304
9D01274C  024A6821   ADDU T5, S2, T2
9D012750  32070FFF   ANDI A3, S0, 4095
9D012754  8DAC0000   LW T4, 0(T5)
9D012758  01877021   ADDU T6, T4, A3
9D01279C  00112302   SRL A0, S1, 12
9D0127A0  0004F880   SLL RA, A0, 2
9D0127A4  266B3010   ADDIU T3, S3, 12304
9D0127A8  03EB7821   ADDU T7, RA, T3
9D0127AC  32310FFF   ANDI S1, S1, 4095
9D0127B0  8DFE0000   LW FP, 0(T7)
9D0127B4  03D11021   ADDU V0, FP, S1
9D01280C  00104302   SRL T0, S0, 12
9D012810  00081880   SLL V1, T0, 2
9D012814  26753010   ADDIU S5, S3, 12304
9D012818  00752821   ADDU A1, V1, S5
9D01281C  32180FFF   ANDI T8, S0, 4095
9D012820  8CB90000   LW T9, 0(A1)
9D012824  03384821   ADDU T1, T9, T8
9D012850  00107B02   SRL T7, S0, 12
9D012854  000F3080   SLL A2, T7, 2
9D012858  26623010   ADDIU V0, S3, 12304
9D01285C  00C2A021   ADDU S4, A2, V0
9D012860  320A0FFF   ANDI T2, S0, 4095
9D012864  8E920000   LW S2, 0(S4)
9D012868  024A6821   ADDU T5, S2, T2
9D01286C  91B20000   LBU S2, 0(T5)
9D01288C  0240A021   ADDU S4, S2, ZERO
9D012890  0B40565D   J .L95
9D012894  0240A821   ADDU S5, S2, ZERO
9D01289C  00111B02   SRL V1, S1, 12
9D0128A0  0003A880   SLL S5, V1, 2
9D0128A4  26653010   ADDIU A1, S3, 12304
9D0128A8  02A5C021   ADDU T8, S5, A1
9D0128AC  32310FFF   ANDI S1, S1, 4095
9D0128B0  8F190000   LW T9, 0(T8)
9D0128B4  03314821   ADDU T1, T9, S1
9D0128C8  0240A021   ADDU S4, S2, ZERO
9D012908  00109302   SRL S2, S0, 12
9D01290C  00126880   SLL T5, S2, 2
9D012910  26673010   ADDIU A3, S3, 12304
9D012914  01A76021   ADDU T4, T5, A3
9D012918  320E0FFF   ANDI T6, S0, 4095
9D01291C  8D880000   LW T0, 0(T4)
9D012920  010E1821   ADDU V1, T0, T6
9D012954  00104B02   SRL T1, S0, 12
9D012958  00092080   SLL A0, T1, 2
9D01295C  267F3010   ADDIU RA, S3, 12304
9D012960  009F5821   ADDU T3, A0, RA
9D012964  321E0FFF   ANDI FP, S0, 4095
9D012968  8D6F0000   LW T7, 0(T3)
9D01296C  01FE3021   ADDU A2, T7, FP
9D0129A8  00117302   SRL T6, S1, 12
9D0129AC  000E4080   SLL T0, T6, 2
9D0129B0  26633010   ADDIU V1, S3, 12304
9D0129B4  0103A821   ADDU S5, T0, V1
9D0129B8  32310FFF   ANDI S1, S1, 4095
9D0129BC  8EA50000   LW A1, 0(S5)
9D0129C0  00B1C021   ADDU T8, A1, S1
9D012A2C  0011FB02   SRL RA, S1, 12
9D012A30  001F5080   SLL T2, RA, 2
9D012A34  266D3010   ADDIU T5, S3, 12304
9D012A38  014D3821   ADDU A3, T2, T5
9D012A3C  322C0FFF   ANDI T4, S1, 4095
9D012A40  8CEE0000   LW T6, 0(A3)
9D012A44  01CC4021   ADDU T0, T6, T4
9D012AAC  00112302   SRL A0, S1, 12
9D012AB0  00045880   SLL T3, A0, 2
9D012AB4  266F3010   ADDIU T7, S3, 12304
9D012AB8  016F3021   ADDU A2, T3, T7
9D012ABC  323F0FFF   ANDI RA, S1, 4095
9D012AC0  8CC20000   LW V0, 0(A2)
9D012AC4  005F5021   ADDU T2, V0, RA
9D012B2C  00112B02   SRL A1, S1, 12
9D012B30  0005C080   SLL T8, A1, 2
9D012B34  26793010   ADDIU T9, S3, 12304
9D012B38  03194821   ADDU T1, T8, T9
9D012B3C  32310FFF   ANDI S1, S1, 4095
9D012B40  8D240000   LW A0, 0(T1)
9D012B44  00915821   ADDU T3, A0, S1
9D012BB0  00116302   SRL T4, S1, 12
9D012BB4  000CF080   SLL FP, T4, 2
9D012BB8  266E3010   ADDIU T6, S3, 12304
9D012BBC  03CE4021   ADDU T0, FP, T6
9D012BC0  32230FFF   ANDI V1, S1, 4095
9D012BC4  8D150000   LW S5, 0(T0)
9D012BC8  02A32821   ADDU A1, S5, V1
9D012BF8  00108B02   SRL S1, S0, 12
9D012BFC  00111080   SLL V0, S1, 2
9D012C00  266A3010   ADDIU T2, S3, 12304
9D012C04  004A6821   ADDU T5, V0, T2
9D012C08  32070FFF   ANDI A3, S0, 4095
9D012C0C  8DAC0000   LW T4, 0(T5)
9D012C10  01877021   ADDU T6, T4, A3
9D012C94  00116B02   SRL T5, S1, 12
9D012C98  000D3880   SLL A3, T5, 2
9D012C9C  266C3010   ADDIU T4, S3, 12304
9D012CA0  00EC7021   ADDU T6, A3, T4
9D012CA4  32280FFF   ANDI T0, S1, 4095
9D012CA8  8DC30000   LW V1, 0(T6)
9D012CAC  00682821   ADDU A1, V1, T0
9D012CC4  00109302   SRL S2, S0, 12
9D012CC8  0012A080   SLL S4, S2, 2
9D012CCC  26753010   ADDIU S5, S3, 12304
9D012CD0  02952021   ADDU A0, S4, S5
9D012CD4  320B0FFF   ANDI T3, S0, 4095
9D012CD8  8C8F0000   LW T7, 0(A0)
9D012CDC  01EB3021   ADDU A2, T7, T3
9D012D64  00113302   SRL A2, S1, 12
9D012D68  00065080   SLL T2, A2, 2
9D012D6C  26623010   ADDIU V0, S3, 12304
9D012D70  0142F821   ADDU RA, T2, V0
9D012D74  32310FFF   ANDI S1, S1, 4095
9D012D78  8FED0000   LW T5, 0(RA)
9D012D7C  01B13821   ADDU A3, T5, S1
9D012D9C  0010F302   SRL FP, S0, 12
9D012DA0  001E9080   SLL S2, FP, 2
9D012DA4  26633010   ADDIU V1, S3, 12304
9D012DA8  02432821   ADDU A1, S2, V1
9D012DAC  32180FFF   ANDI T8, S0, 4095
9D012DB0  8CB90000   LW T9, 0(A1)
9D012DB4  03384821   ADDU T1, T9, T8
9D012E40  0011CB02   SRL T9, S1, 12
9D012E44  00194880   SLL T1, T9, 2
9D012E48  26743010   ADDIU S4, S3, 12304
9D012E4C  0134A821   ADDU S5, T1, S4
9D012E50  32310FFF   ANDI S1, S1, 4095
9D012E54  8EAB0000   LW T3, 0(S5)
9D012E58  01712021   ADDU A0, T3, S1
9D012E80  00109302   SRL S2, S0, 12
9D012E84  0012F880   SLL RA, S2, 2
9D012E88  26623010   ADDIU V0, S3, 12304
9D012E8C  03E26821   ADDU T5, RA, V0
9D012E90  32070FFF   ANDI A3, S0, 4095
9D012E94  8DAC0000   LW T4, 0(T5)
9D012E98  01877021   ADDU T6, T4, A3
9D012EE0  00117B02   SRL T7, S1, 12
9D012EE4  000F3080   SLL A2, T7, 2
9D012EE8  266A3010   ADDIU T2, S3, 12304
9D012EEC  00CAF821   ADDU RA, A2, T2
9D012EF0  32310FFF   ANDI S1, S1, 4095
9D012EF4  8FE20000   LW V0, 0(RA)
9D012EF8  00516821   ADDU T5, V0, S1
9D012F1C  0010A302   SRL S4, S0, 12
9D012F20  00149080   SLL S2, S4, 2
9D012F24  26683010   ADDIU T0, S3, 12304
9D012F28  02482821   ADDU A1, S2, T0
9D012F2C  32030FFF   ANDI V1, S0, 4095
9D012F30  8CB80000   LW T8, 0(A1)
9D012F34  0303C821   ADDU T9, T8, V1
9D012F7C  00116B02   SRL T5, S1, 12
9D012F80  000D3880   SLL A3, T5, 2
9D012F84  266C3010   ADDIU T4, S3, 12304
9D012F88  00EC7021   ADDU T6, A3, T4
9D012F8C  32310FFF   ANDI S1, S1, 4095
9D012F90  8DD40000   LW S4, 0(T6)
9D012F94  02914021   ADDU T0, S4, S1
9D012FB8  0010F302   SRL FP, S0, 12
9D012FBC  001E9080   SLL S2, FP, 2
9D012FC0  26793010   ADDIU T9, S3, 12304
9D012FC4  02594821   ADDU T1, S2, T9
9D012FC8  32150FFF   ANDI S5, S0, 4095
9D012FCC  8D2B0000   LW T3, 0(T1)
9D012FD0  01752021   ADDU A0, T3, S5
9D01301C  00112B02   SRL A1, S1, 12
9D013020  00051880   SLL V1, A1, 2
9D013024  26783010   ADDIU T8, S3, 12304
9D013028  0078F021   ADDU FP, V1, T8
9D01302C  32310FFF   ANDI S1, S1, 4095
9D013030  8FD90000   LW T9, 0(FP)
9D013034  03314821   ADDU T1, T9, S1
9D013058  0010A302   SRL S4, S0, 12
9D01305C  00149080   SLL S2, S4, 2
9D013060  266F3010   ADDIU T7, S3, 12304
9D013064  024F3021   ADDU A2, S2, T7
9D013068  320A0FFF   ANDI T2, S0, 4095
9D01306C  8CDF0000   LW RA, 0(A2)
9D013070  03EA1021   ADDU V0, RA, T2
9D0130C0  00114B02   SRL T1, S1, 12
9D0130C4  0009A880   SLL S5, T1, 2
9D0130C8  266B3010   ADDIU T3, S3, 12304
9D0130CC  02AB2021   ADDU A0, S5, T3
9D0130D0  32310FFF   ANDI S1, S1, 4095
9D0130D4  8C940000   LW S4, 0(A0)
9D0130D8  02917821   ADDU T7, S4, S1
9D013128  00104302   SRL T0, S0, 12
9D01312C  00082880   SLL A1, T0, 2
9D013130  26633010   ADDIU V1, S3, 12304
9D013134  00A3C021   ADDU T8, A1, V1
9D013138  32190FFF   ANDI T9, S0, 4095
9D01313C  8F090000   LW T1, 0(T8)
9D013140  01395821   ADDU T3, T1, T9
9D0131DC  0011C302   SRL T8, S1, 12
9D0131E0  0018C880   SLL T9, T8, 2
9D0131E4  26693010   ADDIU T1, S3, 12304
9D0131E8  03295821   ADDU T3, T9, T1
9D0131EC  32240FFF   ANDI A0, S1, 4095
9D0131F0  8D710000   LW S1, 0(T3)
9D0131F4  02247821   ADDU T7, S1, A0
9D013248  00106B02   SRL T5, S0, 12
9D01324C  000D3880   SLL A3, T5, 2
9D013250  266C3010   ADDIU T4, S3, 12304
9D013254  00EC7021   ADDU T6, A3, T4
9D013258  32080FFF   ANDI T0, S0, 4095
9D01325C  8DC50000   LW A1, 0(T6)
9D013260  00A81821   ADDU V1, A1, T0
9D013318  00111B02   SRL V1, S1, 12
9D01331C  0003C080   SLL T8, V1, 2
9D013320  26793010   ADDIU T9, S3, 12304
9D013324  03194821   ADDU T1, T8, T9
9D013328  32310FFF   ANDI S1, S1, 4095
9D01332C  8D2B0000   LW T3, 0(T1)
9D013330  01712021   ADDU A0, T3, S1
9D0133D0  0011CB02   SRL T9, S1, 12
9D0133D4  00194880   SLL T1, T9, 2
9D0133D8  266B3010   ADDIU T3, S3, 12304
9D0133DC  012B2021   ADDU A0, T1, T3
9D0133E0  32310FFF   ANDI S1, S1, 4095
9D0133E4  8C8F0000   LW T7, 0(A0)
9D0133E8  01F1A821   ADDU S5, T7, S1
9D013480  00115B02   SRL T3, S1, 12
9D013484  000B2080   SLL A0, T3, 2
9D013488  266F3010   ADDIU T7, S3, 12304
9D01348C  008FA821   ADDU S5, A0, T7
9D013490  32310FFF   ANDI S1, S1, 4095
9D013494  8EA60000   LW A2, 0(S5)
9D013498  00D15021   ADDU T2, A2, S1
9D013534  00117B02   SRL T7, S1, 12
9D013538  000FA880   SLL S5, T7, 2
9D01353C  26663010   ADDIU A2, S3, 12304
9D013540  02A65021   ADDU T2, S5, A2
9D013544  32310FFF   ANDI S1, S1, 4095
9D013548  8D5F0000   LW RA, 0(T2)
9D01354C  03F16821   ADDU T5, RA, S1
9D0135EC  00113302   SRL A2, S1, 12
9D0135F0  00065080   SLL T2, A2, 2
9D0135F4  267F3010   ADDIU RA, S3, 12304
9D0135F8  015F6821   ADDU T5, T2, RA
9D0135FC  32310FFF   ANDI S1, S1, 4095
9D013600  8DBE0000   LW FP, 0(T5)
9D013604  03D11021   ADDU V0, FP, S1
9D01362C  0010BB02   SRL S7, S0, 12
9D013630  00179080   SLL S2, S7, 2
9D013634  266E3010   ADDIU T6, S3, 12304
9D013638  024E4021   ADDU T0, S2, T6
9D01363C  32050FFF   ANDI A1, S0, 4095
9D013640  8D180000   LW T8, 0(T0)
9D013644  03051821   ADDU V1, T8, A1
9D013688  0011FB02   SRL RA, S1, 12
9D01368C  001F6880   SLL T5, RA, 2
9D013690  26623010   ADDIU V0, S3, 12304
9D013694  01A23821   ADDU A3, T5, V0
9D013698  32310FFF   ANDI S1, S1, 4095
9D01369C  8CEC0000   LW T4, 0(A3)
9D0136A0  01917021   ADDU T6, T4, S1
9D0136BC  0010BB02   SRL S7, S0, 12
9D0136C0  00179080   SLL S2, S7, 2
9D0136C4  26753010   ADDIU S5, S3, 12304
9D0136C8  02551821   ADDU V1, S2, S5
9D0136CC  32190FFF   ANDI T9, S0, 4095
9D0136D0  8C690000   LW T1, 0(V1)
9D0136D4  01395821   ADDU T3, T1, T9
9D013730  00112B02   SRL A1, S1, 12
9D013734  0005C080   SLL T8, A1, 2
9D013738  26753010   ADDIU S5, S3, 12304
9D01373C  03151821   ADDU V1, T8, S5
9D013740  32310FFF   ANDI S1, S1, 4095
9D013744  8C790000   LW T9, 0(V1)
9D013748  03314821   ADDU T1, T9, S1
9D013768  0010BB02   SRL S7, S0, 12
9D01376C  00179080   SLL S2, S7, 2
9D013770  26753010   ADDIU S5, S3, 12304
9D013774  02553021   ADDU A2, S2, S5
9D013778  320A0FFF   ANDI T2, S0, 4095
9D01377C  8CDF0000   LW RA, 0(A2)
9D013780  03EA6821   ADDU T5, RA, T2
9D0137F0  00112302   SRL A0, S1, 12
9D0137F4  0004A880   SLL S5, A0, 2
9D0137F8  26663010   ADDIU A2, S3, 12304
9D0137FC  02A65021   ADDU T2, S5, A2
9D013800  32310FFF   ANDI S1, S1, 4095
9D013804  8D5F0000   LW RA, 0(T2)
9D013808  03F16821   ADDU T5, RA, S1
9D013828  00107302   SRL T6, S0, 12
9D01382C  000E4080   SLL T0, T6, 2
9D013830  26653010   ADDIU A1, S3, 12304
9D013834  0105B821   ADDU S7, T0, A1
9D013838  32120FFF   ANDI S2, S0, 4095
9D01383C  8EF80000   LW T8, 0(S7)
9D013840  03121821   ADDU V1, T8, S2
9D013890  00113B02   SRL A3, S1, 12
9D013894  00076080   SLL T4, A3, 2
9D013898  266E3010   ADDIU T6, S3, 12304
9D01389C  018E4021   ADDU T0, T4, T6
9D0138A0  32310FFF   ANDI S1, S1, 4095
9D0138A4  8D050000   LW A1, 0(T0)
9D0138A8  00B1C021   ADDU T8, A1, S1
9D0138C8  0010BB02   SRL S7, S0, 12
9D0138CC  00179080   SLL S2, S7, 2
9D0138D0  266B3010   ADDIU T3, S3, 12304
9D0138D4  024B7821   ADDU T7, S2, T3
9D0138D8  32150FFF   ANDI S5, S0, 4095
9D0138DC  8DE40000   LW A0, 0(T7)
9D0138E0  00953021   ADDU A2, A0, S5
9D01392C  00111B02   SRL V1, S1, 12
9D013930  0003C880   SLL T9, V1, 2
9D013934  26693010   ADDIU T1, S3, 12304
9D013938  03295821   ADDU T3, T9, T1
9D01393C  32310FFF   ANDI S1, S1, 4095
9D013940  8D6F0000   LW T7, 0(T3)
9D013944  01F1A821   ADDU S5, T7, S1
9D013964  00109302   SRL S2, S0, 12
9D013968  0012F880   SLL RA, S2, 2
9D01396C  266D3010   ADDIU T5, S3, 12304
9D013970  03ED1021   ADDU V0, RA, T5
9D013974  32070FFF   ANDI A3, S0, 4095
9D013978  8C4C0000   LW T4, 0(V0)
9D01397C  01877021   ADDU T6, T4, A3
9D0139C4  00112302   SRL A0, S1, 12
9D0139C8  00043080   SLL A2, A0, 2
9D0139CC  266A3010   ADDIU T2, S3, 12304
9D0139D0  00CAF821   ADDU RA, A2, T2
9D0139D4  32310FFF   ANDI S1, S1, 4095
9D0139D8  8FED0000   LW T5, 0(RA)
9D0139DC  01B11021   ADDU V0, T5, S1
9D0139FC  0010BB02   SRL S7, S0, 12
9D013A00  00179080   SLL S2, S7, 2
9D013A04  26683010   ADDIU T0, S3, 12304
9D013A08  02482821   ADDU A1, S2, T0
9D013A0C  32180FFF   ANDI T8, S0, 4095
9D013A10  8CA30000   LW V1, 0(A1)
9D013A14  0078C821   ADDU T9, V1, T8
9D013A6C  00117302   SRL T6, S1, 12
9D013A70  000E4080   SLL T0, T6, 2
9D013A74  26653010   ADDIU A1, S3, 12304
9D013A78  0105C021   ADDU T8, T0, A1
9D013A7C  32310FFF   ANDI S1, S1, 4095
9D013A80  8F030000   LW V1, 0(T8)
9D013A84  0071C821   ADDU T9, V1, S1
9D013ADC  00101302   SRL V0, S0, 12
9D013AE0  00023880   SLL A3, V0, 2
9D013AE4  266C3010   ADDIU T4, S3, 12304
9D013AE8  00EC7021   ADDU T6, A3, T4
9D013AEC  32080FFF   ANDI T0, S0, 4095
9D013AF0  8DC50000   LW A1, 0(T6)
9D013AF4  00A8C021   ADDU T8, A1, T0
9D013B1C  0010BB02   SRL S7, S0, 12
9D013B20  00174880   SLL T1, S7, 2
9D013B24  266B3010   ADDIU T3, S3, 12304
9D013B28  012B7821   ADDU T7, T1, T3
9D013B2C  32120FFF   ANDI S2, S0, 4095
9D013B30  8DF50000   LW S5, 0(T7)
9D013B34  02B22021   ADDU A0, S5, S2
9D013B74  00117302   SRL T6, S1, 12
9D013B78  000E4080   SLL T0, T6, 2
9D013B7C  26653010   ADDIU A1, S3, 12304
9D013B80  0105C021   ADDU T8, T0, A1
9D013B84  32310FFF   ANDI S1, S1, 4095
9D013B88  8F030000   LW V1, 0(T8)
9D013B8C  0071C821   ADDU T9, V1, S1
9D013BE0  00106B02   SRL T5, S0, 12
9D013BE4  000D3880   SLL A3, T5, 2
9D013BE8  26623010   ADDIU V0, S3, 12304
9D013BEC  00E26021   ADDU T4, A3, V0
9D013BF0  320E0FFF   ANDI T6, S0, 4095
9D013BF4  8D880000   LW T0, 0(T4)
9D013BF8  010E2821   ADDU A1, T0, T6
9D013C28  0010CB02   SRL T9, S0, 12
9D013C2C  00194880   SLL T1, T9, 2
9D013C30  266B3010   ADDIU T3, S3, 12304
9D013C34  012B7821   ADDU T7, T1, T3
9D013C38  321E0FFF   ANDI FP, S0, 4095
9D013C3C  8DF50000   LW S5, 0(T7)
9D013C40  02BE3021   ADDU A2, S5, FP
9D013C84  00117302   SRL T6, S1, 12
9D013C88  000E4080   SLL T0, T6, 2
9D013C8C  26653010   ADDIU A1, S3, 12304
9D013C90  0105C021   ADDU T8, T0, A1
9D013C94  32310FFF   ANDI S1, S1, 4095
9D013C98  8F030000   LW V1, 0(T8)
9D013C9C  0071C821   ADDU T9, V1, S1
9D013D10  0011FB02   SRL RA, S1, 12
9D013D14  001F6080   SLL T4, RA, 2
9D013D18  26623010   ADDIU V0, S3, 12304
9D013D1C  01827021   ADDU T6, T4, V0
9D013D20  32280FFF   ANDI T0, S1, 4095
9D013D24  8DC50000   LW A1, 0(T6)
9D013D28  00A8C021   ADDU T8, A1, T0
9D013D94  00112302   SRL A0, S1, 12
9D013D98  00043880   SLL A3, A0, 2
9D013D9C  267F3010   ADDIU RA, S3, 12304
9D013DA0  00FF6021   ADDU T4, A3, RA
9D013DA4  322E0FFF   ANDI T6, S1, 4095
9D013DA8  8D820000   LW V0, 0(T4)
9D013DAC  004E4021   ADDU T0, V0, T6
9D013E20  00113302   SRL A2, S1, 12
9D013E24  00065080   SLL T2, A2, 2
9D013E28  266D3010   ADDIU T5, S3, 12304
9D013E2C  014D2021   ADDU A0, T2, T5
9D013E30  32270FFF   ANDI A3, S1, 4095
9D013E34  8C9F0000   LW RA, 0(A0)
9D013E38  03E76021   ADDU T4, RA, A3
9D013EBC  00113302   SRL A2, S1, 12
9D013EC0  00065080   SLL T2, A2, 2
9D013EC4  266D3010   ADDIU T5, S3, 12304
9D013EC8  014D2021   ADDU A0, T2, T5
9D013ECC  32310FFF   ANDI S1, S1, 4095
9D013ED0  8C870000   LW A3, 0(A0)
9D013ED4  00F1F821   ADDU RA, A3, S1
9D013EFC  00104B02   SRL T1, S0, 12
9D013F00  00095880   SLL T3, T1, 2
9D013F04  266F3010   ADDIU T7, S3, 12304
9D013F08  016F3021   ADDU A2, T3, T7
9D013F0C  320A0FFF   ANDI T2, S0, 4095
9D013F10  8CCD0000   LW T5, 0(A2)
9D013F14  01AA2021   ADDU A0, T5, T2
9D013F98  00113302   SRL A2, S1, 12
9D013F9C  00065080   SLL T2, A2, 2
9D013FA0  266D3010   ADDIU T5, S3, 12304
9D013FA4  014D2021   ADDU A0, T2, T5
9D013FA8  32310FFF   ANDI S1, S1, 4095
9D013FAC  8C870000   LW A3, 0(A0)
9D013FB0  00F1F821   ADDU RA, A3, S1
9D013FC8  0010BB02   SRL S7, S0, 12
9D013FCC  0017A880   SLL S5, S7, 2
9D013FD0  26723010   ADDIU S2, S3, 12304
9D013FD4  02B24021   ADDU T0, S5, S2
9D013FD8  32050FFF   ANDI A1, S0, 4095
9D013FDC  8D180000   LW T8, 0(T0)
9D013FE0  03051821   ADDU V1, T8, A1
9D014070  00115B02   SRL T3, S1, 12
9D014074  000B7880   SLL T7, T3, 2
9D014078  26793010   ADDIU T9, S3, 12304
9D01407C  01F93021   ADDU A2, T7, T9
9D014080  32310FFF   ANDI S1, S1, 4095
9D014084  8CCA0000   LW T2, 0(A2)
9D014088  01516821   ADDU T5, T2, S1
9D0140A8  00109302   SRL S2, S0, 12
9D0140AC  00127080   SLL T6, S2, 2
9D0140B0  26753010   ADDIU S5, S3, 12304
9D0140B4  01D5B821   ADDU S7, T6, S5
9D0140B8  32020FFF   ANDI V0, S0, 4095
9D0140BC  8EE40000   LW A0, 0(S7)
9D0140C0  00824021   ADDU T0, A0, V0
9D014134  0011FB02   SRL RA, S1, 12
9D014138  001FA880   SLL S5, RA, 2
9D01413C  26623010   ADDIU V0, S3, 12304
9D014140  02A22021   ADDU A0, S5, V0
9D014144  32310FFF   ANDI S1, S1, 4095
9D014148  8C880000   LW T0, 0(A0)
9D01414C  01112821   ADDU A1, T0, S1
9D01416C  00105B02   SRL T3, S0, 12
9D014170  000B7880   SLL T7, T3, 2
9D014174  26793010   ADDIU T9, S3, 12304
9D014178  01F9B821   ADDU S7, T7, T9
9D01417C  32120FFF   ANDI S2, S0, 4095
9D014180  8EE60000   LW A2, 0(S7)
9D014184  00D25021   ADDU T2, A2, S2
9D0141D8  00114B02   SRL T1, S1, 12
9D0141DC  00095880   SLL T3, T1, 2
9D0141E0  266F3010   ADDIU T7, S3, 12304
9D0141E4  016FC821   ADDU T9, T3, T7
9D0141E8  32310FFF   ANDI S1, S1, 4095
9D0141EC  8F260000   LW A2, 0(T9)
9D0141F0  00D15021   ADDU T2, A2, S1
9D014210  00109302   SRL S2, S0, 12
9D014214  00127080   SLL T6, S2, 2
9D014218  267F3010   ADDIU RA, S3, 12304
9D01421C  01DFA821   ADDU S5, T6, RA
9D014220  32020FFF   ANDI V0, S0, 4095
9D014224  8EA40000   LW A0, 0(S5)
9D014228  00824021   ADDU T0, A0, V0
9D014278  00116302   SRL T4, S1, 12
9D01427C  000C7080   SLL T6, T4, 2
9D014280  267F3010   ADDIU RA, S3, 12304
9D014284  01DFA821   ADDU S5, T6, RA
9D014288  32310FFF   ANDI S1, S1, 4095
9D01428C  8EA20000   LW V0, 0(S5)
9D014290  00512021   ADDU A0, V0, S1
9D0142B0  0010BB02   SRL S7, S0, 12
9D0142B4  00179080   SLL S2, S7, 2
9D0142B8  26693010   ADDIU T1, S3, 12304
9D0142BC  02495821   ADDU T3, S2, T1
9D0142C0  32030FFF   ANDI V1, S0, 4095
9D0142C4  8D6F0000   LW T7, 0(T3)
9D0142C8  01E3C821   ADDU T9, T7, V1
9D014328  00114B02   SRL T1, S1, 12
9D01432C  00091880   SLL V1, T1, 2
9D014330  266F3010   ADDIU T7, S3, 12304
9D014334  006FC821   ADDU T9, V1, T7
9D014338  32310FFF   ANDI S1, S1, 4095
9D01433C  8F260000   LW A2, 0(T9)
9D014340  00D15021   ADDU T2, A2, S1
9D014388  00102B02   SRL A1, S0, 12
9D01438C  0005C080   SLL T8, A1, 2
9D014390  266B3010   ADDIU T3, S3, 12304
9D014394  030B4821   ADDU T1, T8, T3
9D014398  320F0FFF   ANDI T7, S0, 4095
9D01439C  8D230000   LW V1, 0(T1)
9D0143A0  006FC821   ADDU T9, V1, T7
9D014444  00111B02   SRL V1, S1, 12
9D014448  0003C880   SLL T9, V1, 2
9D01444C  26663010   ADDIU A2, S3, 12304
9D014450  03265021   ADDU T2, T9, A2
9D014454  32310FFF   ANDI S1, S1, 4095
9D014458  8D550000   LW S5, 0(T2)
9D01445C  02B16821   ADDU T5, S5, S1
9D0144E8  0011FB02   SRL RA, S1, 12
9D0144EC  001F1880   SLL V1, RA, 2
9D0144F0  26793010   ADDIU T9, S3, 12304
9D0144F4  00793021   ADDU A2, V1, T9
9D0144F8  322A0FFF   ANDI T2, S1, 4095
9D0144FC  8CD10000   LW S1, 0(A2)
9D014500  022A6821   ADDU T5, S1, T2
9D01459C  0011FB02   SRL RA, S1, 12
9D0145A0  001F6880   SLL T5, RA, 2
9D0145A4  26673010   ADDIU A3, S3, 12304
9D0145A8  01A76021   ADDU T4, T5, A3
9D0145AC  32310FFF   ANDI S1, S1, 4095
9D0145B0  8D8E0000   LW T6, 0(T4)
9D0145B4  01D1A821   ADDU S5, T6, S1
9D01462C  00111B02   SRL V1, S1, 12
9D014630  00033080   SLL A2, V1, 2
9D014634  266A3010   ADDIU T2, S3, 12304
9D014638  00CAF821   ADDU RA, A2, T2
9D01463C  322D0FFF   ANDI T5, S1, 4095
9D014640  8FE70000   LW A3, 0(RA)
9D014644  00ED6021   ADDU T4, A3, T5
9D0146CC  00111B02   SRL V1, S1, 12
9D0146D0  00033080   SLL A2, V1, 2
9D0146D4  266A3010   ADDIU T2, S3, 12304
9D0146D8  00CAF821   ADDU RA, A2, T2
9D0146DC  322D0FFF   ANDI T5, S1, 4095
9D0146E0  8FE70000   LW A3, 0(RA)
9D0146E4  00ED6021   ADDU T4, A3, T5
9D014704  0010BB02   SRL S7, S0, 12
9D014708  0017A880   SLL S5, S7, 2
9D01470C  26683010   ADDIU T0, S3, 12304
9D014710  02A89021   ADDU S2, S5, T0
9D014714  32050FFF   ANDI A1, S0, 4095
9D014718  8E580000   LW T8, 0(S2)
9D01471C  03055821   ADDU T3, T8, A1
9D01475C  0011FB02   SRL RA, S1, 12
9D014760  001F6880   SLL T5, RA, 2
9D014764  26673010   ADDIU A3, S3, 12304
9D014768  01A76021   ADDU T4, T5, A3
9D01476C  32310FFF   ANDI S1, S1, 4095
9D014770  8D8E0000   LW T6, 0(T4)
9D014774  01D11021   ADDU V0, T6, S1
9D014790  00109302   SRL S2, S0, 12
9D014794  0012C080   SLL T8, S2, 2
9D014798  26753010   ADDIU S5, S3, 12304
9D01479C  03155821   ADDU T3, T8, S5
9D0147A0  32090FFF   ANDI T1, S0, 4095
9D0147A4  8D6F0000   LW T7, 0(T3)
9D0147A8  01E92021   ADDU A0, T7, T1
9D014828  0011AB02   SRL S5, S1, 12
9D01482C  00157880   SLL T7, S5, 2
9D014830  26643010   ADDIU A0, S3, 12304
9D014834  01E4C821   ADDU T9, T7, A0
9D014838  32310FFF   ANDI S1, S1, 4095
9D01483C  8F230000   LW V1, 0(T9)
9D014840  00713021   ADDU A2, V1, S1
9D014864  00109302   SRL S2, S0, 12
9D014868  00123880   SLL A3, S2, 2
9D01486C  26753010   ADDIU S5, S3, 12304
9D014870  00F56021   ADDU T4, A3, S5
9D014874  320E0FFF   ANDI T6, S0, 4095
9D014878  8D820000   LW V0, 0(T4)
9D01487C  004E4021   ADDU T0, V0, T6
9D014918  0011FB02   SRL RA, S1, 12
9D01491C  001FA880   SLL S5, RA, 2
9D014920  266B3010   ADDIU T3, S3, 12304
9D014924  02AB4821   ADDU T1, S5, T3
9D014928  32310FFF   ANDI S1, S1, 4095
9D01492C  8D2F0000   LW T7, 0(T1)
9D014930  01F12021   ADDU A0, T7, S1
9D014954  00109302   SRL S2, S0, 12
9D014958  0012B880   SLL S7, S2, 2
9D01495C  266A3010   ADDIU T2, S3, 12304
9D014960  02EA6821   ADDU T5, S7, T2
9D014964  32070FFF   ANDI A3, S0, 4095
9D014968  8DAC0000   LW T4, 0(T5)
9D01496C  01877021   ADDU T6, T4, A3
9D0149B8  0011CB02   SRL T9, S1, 12
9D0149BC  00191880   SLL V1, T9, 2
9D0149C0  26663010   ADDIU A2, S3, 12304
9D0149C4  00665021   ADDU T2, V1, A2
9D0149C8  32310FFF   ANDI S1, S1, 4095
9D0149CC  8D4D0000   LW T5, 0(T2)
9D0149D0  01B13821   ADDU A3, T5, S1
9D0149F0  00109302   SRL S2, S0, 12
9D0149F4  00124080   SLL T0, S2, 2
9D0149F8  26653010   ADDIU A1, S3, 12304
9D0149FC  0105C021   ADDU T8, T0, A1
9D014A00  321F0FFF   ANDI RA, S0, 4095
9D014A04  8F150000   LW S5, 0(T8)
9D014A08  02BF5821   ADDU T3, S5, RA
9D014A78  00112B02   SRL A1, S1, 12
9D014A7C  0005F880   SLL RA, A1, 2
9D014A80  26753010   ADDIU S5, S3, 12304
9D014A84  03F55821   ADDU T3, RA, S5
9D014A88  32310FFF   ANDI S1, S1, 4095
9D014A8C  8D690000   LW T1, 0(T3)
9D014A90  01317821   ADDU T7, T1, S1
9D014AB4  00109302   SRL S2, S0, 12
9D014AB8  00123080   SLL A2, S2, 2
9D014ABC  266A3010   ADDIU T2, S3, 12304
9D014AC0  00CA6821   ADDU T5, A2, T2
9D014AC4  32070FFF   ANDI A3, S0, 4095
9D014AC8  8DAC0000   LW T4, 0(T5)
9D014ACC  01877021   ADDU T6, T4, A3
9D014B14  00112302   SRL A0, S1, 12
9D014B18  0004C880   SLL T9, A0, 2
9D014B1C  26633010   ADDIU V1, S3, 12304
9D014B20  03233021   ADDU A2, T9, V1
9D014B24  32310FFF   ANDI S1, S1, 4095
9D014B28  8CCA0000   LW T2, 0(A2)
9D014B2C  01516821   ADDU T5, T2, S1
9D014B4C  00109302   SRL S2, S0, 12
9D014B50  00124080   SLL T0, S2, 2
9D014B54  26623010   ADDIU V0, S3, 12304
9D014B58  0102C021   ADDU T8, T0, V0
9D014B5C  32050FFF   ANDI A1, S0, 4095
9D014B60  8F1F0000   LW RA, 0(T8)
9D014B64  03E5A821   ADDU S5, RA, A1
9D014BE0  00111302   SRL V0, S1, 12
9D014BE4  0002A880   SLL S5, V0, 2
9D014BE8  266B3010   ADDIU T3, S3, 12304
9D014BEC  02AB4821   ADDU T1, S5, T3
9D014BF0  32310FFF   ANDI S1, S1, 4095
9D014BF4  8D2F0000   LW T7, 0(T1)
9D014BF8  01F12021   ADDU A0, T7, S1
9D014C50  00104302   SRL T0, S0, 12
9D014C54  0008C080   SLL T8, T0, 2
9D014C58  26653010   ADDIU A1, S3, 12304
9D014C5C  0305F821   ADDU RA, T8, A1
9D014C60  32020FFF   ANDI V0, S0, 4095
9D014C64  8FF50000   LW S5, 0(RA)
9D014C68  02A25821   ADDU T3, S5, V0
9D014C90  00109302   SRL S2, S0, 12
9D014C94  00122080   SLL A0, S2, 2
9D014C98  26793010   ADDIU T9, S3, 12304
9D014C9C  00993021   ADDU A2, A0, T9
9D014CA0  32030FFF   ANDI V1, S0, 4095
9D014CA4  8CCA0000   LW T2, 0(A2)
9D014CA8  01436821   ADDU T5, T2, V1
9D014CAC  91A70000   LBU A3, 0(T5)
9D014D0C  00117B02   SRL T7, S1, 12
9D014D10  000F2080   SLL A0, T7, 2
9D014D14  26793010   ADDIU T9, S3, 12304
9D014D18  00993021   ADDU A2, A0, T9
9D014D1C  32310FFF   ANDI S1, S1, 4095
9D014D20  8CC30000   LW V1, 0(A2)
9D014D24  00715021   ADDU T2, V1, S1
9D014D6C  00101302   SRL V0, S0, 12
9D014D70  00025880   SLL T3, V0, 2
9D014D74  26693010   ADDIU T1, S3, 12304
9D014D78  01697821   ADDU T7, T3, T1
9D014D7C  32040FFF   ANDI A0, S0, 4095
9D014D80  8DF90000   LW T9, 0(T7)
9D014D84  03243021   ADDU A2, T9, A0
9D014DF0  00114302   SRL T0, S1, 12
9D014DF4  0008C080   SLL T8, T0, 2
9D014DF8  26653010   ADDIU A1, S3, 12304
9D014DFC  0305F821   ADDU RA, T8, A1
9D014E00  322B0FFF   ANDI T3, S1, 4095
9D014E04  8FE20000   LW V0, 0(RA)
9D014E08  004B4821   ADDU T1, V0, T3
9D014E98  0011FB02   SRL RA, S1, 12
9D014E9C  001F5880   SLL T3, RA, 2
9D014EA0  26623010   ADDIU V0, S3, 12304
9D014EA4  01624821   ADDU T1, T3, V0
9D014EA8  32310FFF   ANDI S1, S1, 4095
9D014EAC  8D2F0000   LW T7, 0(T1)
9D014EB0  01F12021   ADDU A0, T7, S1
9D014F28  00114302   SRL T0, S1, 12
9D014F2C  0008C080   SLL T8, T0, 2
9D014F30  26653010   ADDIU A1, S3, 12304
9D014F34  0305F821   ADDU RA, T8, A1
9D014F38  322B0FFF   ANDI T3, S1, 4095
9D014F3C  8FE20000   LW V0, 0(RA)
9D014F40  004B4821   ADDU T1, V0, T3
9D014FE8  0011FB02   SRL RA, S1, 12
9D014FEC  001F4880   SLL T1, RA, 2
9D014FF0  26623010   ADDIU V0, S3, 12304
9D014FF4  01227821   ADDU T7, T1, V0
9D014FF8  32310FFF   ANDI S1, S1, 4095
9D014FFC  8DE40000   LW A0, 0(T7)
9D015000  0091C821   ADDU T9, A0, S1
9D01502C  00104302   SRL T0, S0, 12
9D015030  0008C080   SLL T8, T0, 2
9D015034  26653010   ADDIU A1, S3, 12304
9D015038  03055821   ADDU T3, T8, A1
9D01503C  321F0FFF   ANDI RA, S0, 4095
9D015040  8D690000   LW T1, 0(T3)
9D015044  013F1021   ADDU V0, T1, RA
9D0150C8  00115B02   SRL T3, S1, 12
9D0150CC  000BF880   SLL RA, T3, 2
9D0150D0  26693010   ADDIU T1, S3, 12304
9D0150D4  03E91021   ADDU V0, RA, T1
9D0150D8  322F0FFF   ANDI T7, S1, 4095
9D0150DC  8C510000   LW S1, 0(V0)
9D0150E0  022F2021   ADDU A0, S1, T7
9D0150F8  00109302   SRL S2, S0, 12
9D0150FC  0012A880   SLL S5, S2, 2
9D015100  26633010   ADDIU V1, S3, 12304
9D015104  02A36821   ADDU T5, S5, V1
9D015108  32070FFF   ANDI A3, S0, 4095
9D01510C  8DAC0000   LW T4, 0(T5)
9D015110  01874021   ADDU T0, T4, A3
9D0151C0  0011FB02   SRL RA, S1, 12
9D0151C4  001F7880   SLL T7, RA, 2
9D0151C8  26623010   ADDIU V0, S3, 12304
9D0151CC  01E2C821   ADDU T9, T7, V0
9D0151D0  32310FFF   ANDI S1, S1, 4095
9D0151D4  8F260000   LW A2, 0(T9)
9D0151D8  00D15021   ADDU T2, A2, S1
9D0151FC  00109302   SRL S2, S0, 12
9D015200  00126880   SLL T5, S2, 2
9D015204  26753010   ADDIU S5, S3, 12304
9D015208  01B53821   ADDU A3, T5, S5
9D01520C  320C0FFF   ANDI T4, S0, 4095
9D015210  8CE80000   LW T0, 0(A3)
9D015214  010CC021   ADDU T8, T0, T4
9D0152B4  0011AB02   SRL S5, S1, 12
9D0152B8  00155880   SLL T3, S5, 2
9D0152BC  26693010   ADDIU T1, S3, 12304
9D0152C0  0169F821   ADDU RA, T3, T1
9D0152C4  32310FFF   ANDI S1, S1, 4095
9D0152C8  8FEF0000   LW T7, 0(RA)
9D0152CC  01F11021   ADDU V0, T7, S1
9D0152F0  00109302   SRL S2, S0, 12
9D0152F4  00122080   SLL A0, S2, 2
9D0152F8  266D3010   ADDIU T5, S3, 12304
9D0152FC  008D3821   ADDU A3, A0, T5
9D015300  32030FFF   ANDI V1, S0, 4095
9D015304  8CEC0000   LW T4, 0(A3)
9D015308  01834021   ADDU T0, T4, V1
9D015380  00116B02   SRL T5, S1, 12
9D015384  000D4080   SLL T0, T5, 2
9D015388  26783010   ADDIU T8, S3, 12304
9D01538C  01182821   ADDU A1, T0, T8
9D015390  32310FFF   ANDI S1, S1, 4095
9D015394  8CAE0000   LW T6, 0(A1)
9D015398  01D1A821   ADDU S5, T6, S1
9D0153BC  00109302   SRL S2, S0, 12
9D0153C0  00127880   SLL T7, S2, 2
9D0153C4  26623010   ADDIU V0, S3, 12304
9D0153C8  01E2C821   ADDU T9, T7, V0
9D0153CC  32060FFF   ANDI A2, S0, 4095
9D0153D0  8F2A0000   LW T2, 0(T9)
9D0153D4  01462021   ADDU A0, T2, A2
9D015424  0011FB02   SRL RA, S1, 12
9D015428  001F7880   SLL T7, RA, 2
9D01542C  26623010   ADDIU V0, S3, 12304
9D015430  01E2C821   ADDU T9, T7, V0
9D015434  32310FFF   ANDI S1, S1, 4095
9D015438  8F260000   LW A2, 0(T9)
9D01543C  00D15021   ADDU T2, A2, S1
9D01545C  00109302   SRL S2, S0, 12
9D015460  00126080   SLL T4, S2, 2
9D015464  266D3010   ADDIU T5, S3, 12304
9D015468  018D4021   ADDU T0, T4, T5
9D01546C  32180FFF   ANDI T8, S0, 4095
9D015470  8D050000   LW A1, 0(T0)
9D015474  00B87021   ADDU T6, A1, T8
9D0154F8  00116B02   SRL T5, S1, 12
9D0154FC  000D5880   SLL T3, T5, 2
9D015500  26693010   ADDIU T1, S3, 12304
9D015504  0169F821   ADDU RA, T3, T1
9D015508  32310FFF   ANDI S1, S1, 4095
9D01550C  8FEF0000   LW T7, 0(RA)
9D015510  01F11021   ADDU V0, T7, S1
9D015560  0010C302   SRL T8, S0, 12
9D015564  00182880   SLL A1, T8, 2
9D015568  266E3010   ADDIU T6, S3, 12304
9D01556C  00AE6821   ADDU T5, A1, T6
9D015570  320B0FFF   ANDI T3, S0, 4095
9D015574  8DA90000   LW T1, 0(T5)
9D015578  012BF821   ADDU RA, T1, T3
9D015640  0011FB02   SRL RA, S1, 12
9D015644  001F5080   SLL T2, RA, 2
9D015648  26673010   ADDIU A3, S3, 12304
9D01564C  01471821   ADDU V1, T2, A3
9D015650  32310FFF   ANDI S1, S1, 4095
9D015654  8C6C0000   LW T4, 0(V1)
9D015658  01914021   ADDU T0, T4, S1
9D01570C  0011FB02   SRL RA, S1, 12
9D015710  001FC080   SLL T8, RA, 2
9D015714  26643010   ADDIU A0, S3, 12304
9D015718  03042821   ADDU A1, T8, A0
9D01571C  32310FFF   ANDI S1, S1, 4095
9D015720  8CAE0000   LW T6, 0(A1)
9D015724  01D16821   ADDU T5, T6, S1
9D0157E4  0011FB02   SRL RA, S1, 12
9D0157E8  001FC880   SLL T9, RA, 2
9D0157EC  26623010   ADDIU V0, S3, 12304
9D0157F0  03223021   ADDU A2, T9, V0
9D0157F4  32310FFF   ANDI S1, S1, 4095
9D0157F8  8CCA0000   LW T2, 0(A2)
9D0157FC  01513821   ADDU A3, T2, S1
9D015878  00114B02   SRL T1, S1, 12
9D01587C  00097880   SLL T7, T1, 2
9D015880  267F3010   ADDIU RA, S3, 12304
9D015884  01FFC821   ADDU T9, T7, RA
9D015888  32260FFF   ANDI A2, S1, 4095
9D01588C  8F220000   LW V0, 0(T9)
9D015890  00468821   ADDU S1, V0, A2
9D01593C  0011FB02   SRL RA, S1, 12
9D015940  001F5080   SLL T2, RA, 2
9D015944  26673010   ADDIU A3, S3, 12304
9D015948  01471821   ADDU V1, T2, A3
9D01594C  32310FFF   ANDI S1, S1, 4095
9D015950  8C6C0000   LW T4, 0(V1)
9D015954  01914021   ADDU T0, T4, S1
1195:                }
1196:                
1197:                INLINE void bank_writebyte(register uint32 address, register uint8 value)
1198:                {
1199:                   cpu.mem_page[address >> NES6502_BANKSHIFT][address & NES6502_BANKMASK] = value;
9D00C26C  00046302   SRL T4, A0, 12
9D00C270  000C6880   SLL T5, T4, 2
9D00C274  3C0EA001   LUI T6, -24575
9D00C278  25CF3010   ADDIU T7, T6, 12304
9D00C27C  01AFC021   ADDU T8, T5, T7
9D00C280  30840FFF   ANDI A0, A0, 4095
9D00C284  8F190000   LW T9, 0(T8)
9D00C288  0324F821   ADDU RA, T9, A0
9D00C28C  A3E50000   SB A1, 0(RA)
1200:                }
1201:                
1202:                /* read a byte of 6502 memory */
1203:                static uint8 mem_readbyte(uint32 address)
1204:                {
9D00C120  27BDFFE8   ADDIU SP, SP, -24
1205:                   nes6502_memread *mr;
1206:                
1207:                   /* TODO: following 2 cases are N2A03-specific */
1208:                   if (address < 0x800)
9D00C124  2C820800   SLTIU V0, A0, 2048
9D00C128  10400005   BEQ V0, ZERO, 0x9D00C140
9D00C12C  AFBF0014   SW RA, 20(SP)
1209:                   {
1210:                      /* RAM */
1211:                      return ram[address];
9D00C130  8F8C80E4   LW T4, -32540(GP)
9D00C134  01846821   ADDU T5, T4, A0
9D00C138  0B40307B   J .LBE755
9D00C13C  91A20000   LBU V0, 0(T5)
1212:                   }
1213:                   else if (address >= 0x8000)
9D00C140  34038000   ORI V1, ZERO, -32768
9D00C144  0083282B   SLTU A1, A0, V1
9D00C148  14A0000B   BNE A1, ZERO, 0x9D00C178
9D00C14C  3C06A001   LUI A2, -24575
1214:                   {
1215:                      /* always paged memory */
1216:                      return bank_readbyte(address);
9D00C170  0B40307B   J .LBE755
9D00C174  91620000   LBU V0, 0(T3)
1217:                   }
1218:                   /* check memory range handlers */
1219:                   else
1220:                   {
1221:                      for (mr = cpu.read_handler; mr->min_range != 0xFFFFFFFF; mr++)
9D00C178  8CCB3050   LW T3, 12368(A2)
9D00C17C  8D6C0000   LW T4, 0(T3)
9D00C180  2407FFFF   ADDIU A3, ZERO, -1
9D00C184  11870011   BEQ T4, A3, 0x9D00C1CC
9D00C188  00046B02   SRL T5, A0, 12
9D00C1BC  8D6C0000   LW T4, 0(T3)
9D00C1C0  1587FFF3   BNE T4, A3, 0x9D00C190
9D00C1C4  008C402B   SLTU T0, A0, T4
1222:                      {
1223:                         if (address >= mr->min_range && address <= mr->max_range)
9D00C18C  008C402B   SLTU T0, A0, T4
9D00C190  5500000A   BNEL T0, ZERO, 0x9D00C1BC
9D00C194  256B000C   ADDIU T3, T3, 12
9D00C198  8D690004   LW T1, 4(T3)
9D00C19C  0124502B   SLTU T2, T1, A0
9D00C1A0  55400006   BNEL T2, ZERO, 0x9D00C1BC
9D00C1A4  256B000C   ADDIU T3, T3, 12
1224:                            return mr->read_func(address);
9D00C1A8  8D620008   LW V0, 8(T3)
9D00C1AC  0040F809   JALR V0
9D00C1B0  00000000   NOP
9D00C1B4  0B40307C   J 0x9D00C1F0
9D00C1B8  8FBF0014   LW RA, 20(SP)
1225:                      }
1226:                   }
1227:                
1228:                   /* return paged memory */
1229:                   return bank_readbyte(address);
1230:                }
9D00C1EC  8FBF0014   LW RA, 20(SP)
9D00C1F0  03E00008   JR RA
9D00C1F4  27BD0018   ADDIU SP, SP, 24
1231:                
1232:                /* write a byte of data to 6502 memory */
1233:                static void mem_writebyte(uint32 address, uint8 value)
1234:                {
9D00C1F8  27BDFFE8   ADDIU SP, SP, -24
1235:                   nes6502_memwrite *mw;
1236:                
1237:                   /* RAM */
1238:                   if (address < 0x800)
9D00C1FC  2C820800   SLTIU V0, A0, 2048
9D00C200  10400005   BEQ V0, ZERO, 0x9D00C218
9D00C204  AFBF0014   SW RA, 20(SP)
1239:                   {
1240:                      ram[address] = value;
9D00C208  8F8380E4   LW V1, -32540(GP)
9D00C20C  00643021   ADDU A2, V1, A0
1241:                      return;
9D00C210  0B4030A4   J .LBE757
9D00C214  A0C50000   SB A1, 0(A2)
1242:                   }
1243:                   /* check memory range handlers */
1244:                   else
1245:                   {
1246:                      for (mw = cpu.write_handler; mw->min_range != 0xFFFFFFFF; mw++)
9D00C218  3C03A001   LUI V1, -24575
9D00C21C  8C6A3054   LW T2, 12372(V1)
9D00C220  8D4B0000   LW T3, 0(T2)
9D00C224  2406FFFF   ADDIU A2, ZERO, -1
9D00C228  11660011   BEQ T3, A2, 0x9D00C270
9D00C22C  00046302   SRL T4, A0, 12
9D00C260  8D4B0000   LW T3, 0(T2)
9D00C264  1566FFF3   BNE T3, A2, 0x9D00C234
9D00C268  008B382B   SLTU A3, A0, T3
1247:                      {
1248:                         if (address >= mw->min_range && address <= mw->max_range)
9D00C230  008B382B   SLTU A3, A0, T3
9D00C234  54E0000A   BNEL A3, ZERO, 0x9D00C260
9D00C238  254A000C   ADDIU T2, T2, 12
9D00C23C  8D480004   LW T0, 4(T2)
9D00C240  0104482B   SLTU T1, T0, A0
9D00C244  55200006   BNEL T1, ZERO, 0x9D00C260
9D00C248  254A000C   ADDIU T2, T2, 12
1249:                         {
1250:                            mw->write_func(address, value);
9D00C24C  8D420008   LW V0, 8(T2)
9D00C250  0040F809   JALR V0
9D00C254  00000000   NOP
1251:                            return;
9D00C258  0B4030A5   J 0x9D00C294
9D00C25C  8FBF0014   LW RA, 20(SP)
1252:                         }
1253:                      }
1254:                   }
1255:                
1256:                   /* write to paged memory */
1257:                   bank_writebyte(address, value);
1258:                }
9D00C290  8FBF0014   LW RA, 20(SP)
9D00C294  03E00008   JR RA
9D00C298  27BD0018   ADDIU SP, SP, 24
1259:                
1260:                /* set the current context */
1261:                void nes6502_setcontext(nes6502_context *context)
1262:                {
1263:                   int loop;
1264:                
1265:                   ASSERT(context);
1266:                
1267:                   cpu = *context;
9D00C2C4  3C02A001   LUI V0, -24575
9D00C2C8  24483010   ADDIU T0, V0, 12304
9D00C2CC  8C870000   LW A3, 0(A0)
9D00C2D0  8C860004   LW A2, 4(A0)
9D00C2D4  8C850008   LW A1, 8(A0)
9D00C2D8  8C83000C   LW V1, 12(A0)
9D00C2DC  AD070000   SW A3, 0(T0)
9D00C2E0  AD060004   SW A2, 4(T0)
9D00C2E4  AD050008   SW A1, 8(T0)
9D00C2E8  AD03000C   SW V1, 12(T0)
9D00C2EC  24840010   ADDIU A0, A0, 16
9D00C2F0  250A0010   ADDIU T2, T0, 16
9D00C2F4  8C8C0000   LW T4, 0(A0)
9D00C2F8  8C8D0004   LW T5, 4(A0)
9D00C2FC  8C8E0008   LW T6, 8(A0)
9D00C300  8C8F000C   LW T7, 12(A0)
9D00C304  AD4C0000   SW T4, 0(T2)
9D00C308  AD4D0004   SW T5, 4(T2)
9D00C30C  AD4E0008   SW T6, 8(T2)
9D00C310  AD4F000C   SW T7, 12(T2)
9D00C314  8C980010   LW T8, 16(A0)
9D00C318  8C990014   LW T9, 20(A0)
9D00C31C  8C820018   LW V0, 24(A0)
9D00C320  8C88001C   LW T0, 28(A0)
9D00C324  AD580010   SW T8, 16(T2)
9D00C328  AD590014   SW T9, 20(T2)
9D00C32C  AD420018   SW V0, 24(T2)
9D00C330  AD48001C   SW T0, 28(T2)
9D00C334  8C830020   LW V1, 32(A0)
9D00C338  8C870024   LW A3, 36(A0)
9D00C33C  8C860028   LW A2, 40(A0)
9D00C340  8C85002C   LW A1, 44(A0)
9D00C344  AD430020   SW V1, 32(T2)
9D00C348  AD470024   SW A3, 36(T2)
9D00C34C  AD460028   SW A2, 40(T2)
9D00C350  AD45002C   SW A1, 44(T2)
9D00C354  8C890030   LW T1, 48(A0)
9D00C358  8C8B0034   LW T3, 52(A0)
9D00C35C  8C8C0038   LW T4, 56(A0)
9D00C360  8C8D003C   LW T5, 60(A0)
9D00C364  AD490030   SW T1, 48(T2)
9D00C368  AD4B0034   SW T3, 52(T2)
9D00C36C  AD4C0038   SW T4, 56(T2)
9D00C370  AD4D003C   SW T5, 60(T2)
9D00C374  8C8E0040   LW T6, 64(A0)
9D00C378  8C8F0044   LW T7, 68(A0)
9D00C37C  8C980048   LW T8, 72(A0)
9D00C380  AD4E0040   SW T6, 64(T2)
9D00C384  AD4F0044   SW T7, 68(T2)
9D00C388  AD580048   SW T8, 72(T2)
1268:                
1269:                   /* set dead page for all pages not pointed at anything */
1270:                   for (loop = 0; loop < NES6502_NUMBANKS; loop++)
1271:                   {
1272:                      if (NULL == cpu.mem_page[loop])
9D00C38C  3C04A001   LUI A0, -24575
9D00C390  8C8A3010   LW T2, 12304(A0)
9D00C394  15400005   BNE T2, ZERO, 0x9D00C3AC
9D00C398  3C03A001   LUI V1, -24575
9D00C3AC  8C673014   LW A3, 12308(V1)
9D00C3B0  14E00005   BNE A3, ZERO, 0x9D00C3C8
9D00C3B4  3C0BA001   LUI T3, -24575
9D00C3C8  8D6C3018   LW T4, 12312(T3)
9D00C3CC  15800005   BNE T4, ZERO, 0x9D00C3E4
9D00C3D0  3C18A001   LUI T8, -24575
9D00C3E4  8F04301C   LW A0, 12316(T8)
9D00C3E8  14800005   BNE A0, ZERO, 0x9D00C400
9D00C3EC  3C02A001   LUI V0, -24575
9D00C400  8C433020   LW V1, 12320(V0)
9D00C404  14600005   BNE V1, ZERO, 0x9D00C41C
9D00C408  3C09A001   LUI T1, -24575
9D00C41C  8D2B3024   LW T3, 12324(T1)
9D00C420  15600005   BNE T3, ZERO, 0x9D00C438
9D00C424  3C0FA001   LUI T7, -24575
9D00C438  8DF83028   LW T8, 12328(T7)
9D00C43C  17000005   BNE T8, ZERO, 0x9D00C454
9D00C440  3C08A001   LUI T0, -24575
9D00C454  8D02302C   LW V0, 12332(T0)
9D00C458  14400005   BNE V0, ZERO, 0x9D00C470
9D00C45C  3C05A001   LUI A1, -24575
9D00C470  8CA93030   LW T1, 12336(A1)
9D00C474  15200005   BNE T1, ZERO, 0x9D00C48C
9D00C478  3C0EA001   LUI T6, -24575
9D00C48C  8DCF3034   LW T7, 12340(T6)
9D00C490  15E00005   BNE T7, ZERO, 0x9D00C4A8
9D00C494  3C19A001   LUI T9, -24575
9D00C4A8  8F283038   LW T0, 12344(T9)
9D00C4AC  15000005   BNE T0, ZERO, 0x9D00C4C4
9D00C4B0  3C06A001   LUI A2, -24575
9D00C4C4  8CC5303C   LW A1, 12348(A2)
9D00C4C8  14A00005   BNE A1, ZERO, 0x9D00C4E0
9D00C4CC  3C0DA001   LUI T5, -24575
9D00C4E0  8DAE3040   LW T6, 12352(T5)
9D00C4E4  15C00005   BNE T6, ZERO, 0x9D00C4FC
9D00C4E8  3C0AA001   LUI T2, -24575
9D00C4FC  8D593044   LW T9, 12356(T2)
9D00C500  17200005   BNE T9, ZERO, 0x9D00C518
9D00C504  3C07A001   LUI A3, -24575
9D00C518  8CE63048   LW A2, 12360(A3)
9D00C51C  14C00005   BNE A2, ZERO, 0x9D00C534
9D00C520  3C0CA001   LUI T4, -24575
9D00C534  8D8D304C   LW T5, 12364(T4)
9D00C538  15A00005   BNE T5, ZERO, 0x9D00C550
9D00C53C  3C04A001   LUI A0, -24575
1273:                         cpu.mem_page[loop] = null_page;
9D00C39C  3C19A001   LUI T9, -24575
9D00C3A0  27282010   ADDIU T0, T9, 8208
9D00C3A4  3C02A001   LUI V0, -24575
9D00C3A8  AC483010   SW T0, 12304(V0)
9D00C3B8  3C06A001   LUI A2, -24575
9D00C3BC  24C52010   ADDIU A1, A2, 8208
9D00C3C0  3C09A001   LUI T1, -24575
9D00C3C4  AD253014   SW A1, 12308(T1)
9D00C3D4  3C0DA001   LUI T5, -24575
9D00C3D8  25AE2010   ADDIU T6, T5, 8208
9D00C3DC  3C0FA001   LUI T7, -24575
9D00C3E0  ADEE3018   SW T6, 12312(T7)
9D00C3F0  3C0AA001   LUI T2, -24575
9D00C3F4  25592010   ADDIU T9, T2, 8208
9D00C3F8  3C08A001   LUI T0, -24575
9D00C3FC  AD19301C   SW T9, 12316(T0)
9D00C40C  3C07A001   LUI A3, -24575
9D00C410  24E62010   ADDIU A2, A3, 8208
9D00C414  3C05A001   LUI A1, -24575
9D00C418  ACA63020   SW A2, 12320(A1)
9D00C428  3C0CA001   LUI T4, -24575
9D00C42C  258D2010   ADDIU T5, T4, 8208
9D00C430  3C0EA001   LUI T6, -24575
9D00C434  ADCD3024   SW T5, 12324(T6)
9D00C444  3C04A001   LUI A0, -24575
9D00C448  248A2010   ADDIU T2, A0, 8208
9D00C44C  3C19A001   LUI T9, -24575
9D00C450  AF2A3028   SW T2, 12328(T9)
9D00C460  3C03A001   LUI V1, -24575
9D00C464  24672010   ADDIU A3, V1, 8208
9D00C468  3C06A001   LUI A2, -24575
9D00C46C  ACC7302C   SW A3, 12332(A2)
9D00C47C  3C0BA001   LUI T3, -24575
9D00C480  256C2010   ADDIU T4, T3, 8208
9D00C484  3C0DA001   LUI T5, -24575
9D00C488  ADAC3030   SW T4, 12336(T5)
9D00C498  3C18A001   LUI T8, -24575
9D00C49C  27042010   ADDIU A0, T8, 8208
9D00C4A0  3C0AA001   LUI T2, -24575
9D00C4A4  AD443034   SW A0, 12340(T2)
9D00C4B4  3C02A001   LUI V0, -24575
9D00C4B8  24432010   ADDIU V1, V0, 8208
9D00C4BC  3C07A001   LUI A3, -24575
9D00C4C0  ACE33038   SW V1, 12344(A3)
9D00C4D0  3C09A001   LUI T1, -24575
9D00C4D4  252B2010   ADDIU T3, T1, 8208
9D00C4D8  3C0CA001   LUI T4, -24575
9D00C4DC  AD8B303C   SW T3, 12348(T4)
9D00C4EC  3C0FA001   LUI T7, -24575
9D00C4F0  25F82010   ADDIU T8, T7, 8208
9D00C4F4  3C04A001   LUI A0, -24575
9D00C4F8  AC983040   SW T8, 12352(A0)
9D00C508  3C08A001   LUI T0, -24575
9D00C50C  25032010   ADDIU V1, T0, 8208
9D00C510  3C02A001   LUI V0, -24575
9D00C514  AC433044   SW V1, 12356(V0)
9D00C524  3C05A001   LUI A1, -24575
9D00C528  24A92010   ADDIU T1, A1, 8208
9D00C52C  3C0BA001   LUI T3, -24575
9D00C530  AD693048   SW T1, 12360(T3)
9D00C540  3C0EA001   LUI T6, -24575
9D00C544  25CF2010   ADDIU T7, T6, 8208
9D00C548  3C18A001   LUI T8, -24575
9D00C54C  AF0F304C   SW T7, 12364(T8)
1274:                   }
1275:                
1276:                   ram = cpu.mem_page[0];  /* quick zero-page/RAM references */
9D00C550  8C8A3010   LW T2, 12304(A0)
9D00C554  AF8A80E4   SW T2, -32540(GP)
1277:                   stack = ram + STACK_OFFSET;
9D00C558  25590100   ADDIU T9, T2, 256
9D00C55C  03E00008   JR RA
9D00C560  AF9980E0   SW T9, -32544(GP)
1278:                }
1279:                
1280:                /* get the current context */
1281:                void nes6502_getcontext(nes6502_context *context)
1282:                {
1283:                   int loop;
1284:                
1285:                   ASSERT(context);
1286:                
1287:                   *context = cpu;
9D00C564  3C03A001   LUI V1, -24575
9D00C568  24693010   ADDIU T1, V1, 12304
9D00C56C  8D280000   LW T0, 0(T1)
9D00C570  8D270004   LW A3, 4(T1)
9D00C574  8D260008   LW A2, 8(T1)
9D00C578  8D25000C   LW A1, 12(T1)
9D00C57C  AC880000   SW T0, 0(A0)
9D00C580  AC870004   SW A3, 4(A0)
9D00C584  AC860008   SW A2, 8(A0)
9D00C588  AC85000C   SW A1, 12(A0)
9D00C58C  252A0010   ADDIU T2, T1, 16
9D00C590  248C0010   ADDIU T4, A0, 16
9D00C594  8D4E0000   LW T6, 0(T2)
9D00C598  8D4F0004   LW T7, 4(T2)
9D00C59C  8D580008   LW T8, 8(T2)
9D00C5A0  8D59000C   LW T9, 12(T2)
9D00C5A4  AD8E0000   SW T6, 0(T4)
9D00C5A8  AD8F0004   SW T7, 4(T4)
9D00C5AC  AD980008   SW T8, 8(T4)
9D00C5B0  AD99000C   SW T9, 12(T4)
9D00C5B4  8D430010   LW V1, 16(T2)
9D00C5B8  8D490014   LW T1, 20(T2)
9D00C5BC  8D420018   LW V0, 24(T2)
9D00C5C0  8D48001C   LW T0, 28(T2)
9D00C5C4  AD830010   SW V1, 16(T4)
9D00C5C8  AD890014   SW T1, 20(T4)
9D00C5CC  AD820018   SW V0, 24(T4)
9D00C5D0  AD88001C   SW T0, 28(T4)
9D00C5D4  8D450020   LW A1, 32(T2)
9D00C5D8  8D4B0024   LW T3, 36(T2)
9D00C5DC  8D470028   LW A3, 40(T2)
9D00C5E0  8D46002C   LW A2, 44(T2)
9D00C5E4  AD850020   SW A1, 32(T4)
9D00C5E8  AD8B0024   SW T3, 36(T4)
9D00C5EC  AD870028   SW A3, 40(T4)
9D00C5F0  AD86002C   SW A2, 44(T4)
9D00C5F4  8D4D0030   LW T5, 48(T2)
9D00C5F8  8D4E0034   LW T6, 52(T2)
9D00C5FC  8D4F0038   LW T7, 56(T2)
9D00C600  8D58003C   LW T8, 60(T2)
9D00C604  AD8D0030   SW T5, 48(T4)
9D00C608  AD8E0034   SW T6, 52(T4)
9D00C60C  AD8F0038   SW T7, 56(T4)
9D00C610  AD98003C   SW T8, 60(T4)
9D00C614  8D590040   LW T9, 64(T2)
9D00C618  8D490044   LW T1, 68(T2)
9D00C61C  254A0040   ADDIU T2, T2, 64
9D00C620  8D430008   LW V1, 8(T2)
9D00C624  AD990040   SW T9, 64(T4)
9D00C628  AD890044   SW T1, 68(T4)
9D00C62C  AD830048   SW V1, 72(T4)
1288:                
1289:                   /* reset dead pages to null */
1290:                   for (loop = 0; loop < NES6502_NUMBANKS; loop++)
1291:                   {
1292:                      if (null_page == context->mem_page[loop])
9D00C630  8C8C0000   LW T4, 0(A0)
9D00C634  3C02A001   LUI V0, -24575
9D00C638  24482010   ADDIU T0, V0, 8208
9D00C63C  51880001   BEQL T4, T0, 0x9D00C644
9D00C640  AC800000   SW ZERO, 0(A0)
9D00C644  8C850004   LW A1, 4(A0)
9D00C648  3C0BA001   LUI T3, -24575
9D00C64C  25672010   ADDIU A3, T3, 8208
9D00C650  50A70001   BEQL A1, A3, 0x9D00C658
9D00C654  AC800004   SW ZERO, 4(A0)
9D00C658  8C860008   LW A2, 8(A0)
9D00C65C  3C0DA001   LUI T5, -24575
9D00C660  25AE2010   ADDIU T6, T5, 8208
9D00C664  50CE0001   BEQL A2, T6, 0x9D00C66C
9D00C668  AC800008   SW ZERO, 8(A0)
9D00C66C  8C8F000C   LW T7, 12(A0)
9D00C670  3C18A001   LUI T8, -24575
9D00C674  27192010   ADDIU T9, T8, 8208
9D00C678  51F90001   BEQL T7, T9, 0x9D00C680
9D00C67C  AC80000C   SW ZERO, 12(A0)
9D00C680  8C890010   LW T1, 16(A0)
9D00C684  3C0AA001   LUI T2, -24575
9D00C688  25432010   ADDIU V1, T2, 8208
9D00C68C  51230001   BEQL T1, V1, 0x9D00C694
9D00C690  AC800010   SW ZERO, 16(A0)
9D00C694  8C8C0014   LW T4, 20(A0)
9D00C698  3C02A001   LUI V0, -24575
9D00C69C  24482010   ADDIU T0, V0, 8208
9D00C6A0  51880001   BEQL T4, T0, 0x9D00C6A8
9D00C6A4  AC800014   SW ZERO, 20(A0)
9D00C6A8  8C850018   LW A1, 24(A0)
9D00C6AC  3C0BA001   LUI T3, -24575
9D00C6B0  25672010   ADDIU A3, T3, 8208
9D00C6B4  50A70001   BEQL A1, A3, 0x9D00C6BC
9D00C6B8  AC800018   SW ZERO, 24(A0)
9D00C6BC  8C86001C   LW A2, 28(A0)
9D00C6C0  3C0DA001   LUI T5, -24575
9D00C6C4  25AE2010   ADDIU T6, T5, 8208
9D00C6C8  50CE0001   BEQL A2, T6, 0x9D00C6D0
9D00C6CC  AC80001C   SW ZERO, 28(A0)
9D00C6D0  8C8F0020   LW T7, 32(A0)
9D00C6D4  3C18A001   LUI T8, -24575
9D00C6D8  27192010   ADDIU T9, T8, 8208
9D00C6DC  51F90001   BEQL T7, T9, 0x9D00C6E4
9D00C6E0  AC800020   SW ZERO, 32(A0)
9D00C6E4  8C890024   LW T1, 36(A0)
9D00C6E8  3C0AA001   LUI T2, -24575
9D00C6EC  25432010   ADDIU V1, T2, 8208
9D00C6F0  51230001   BEQL T1, V1, 0x9D00C6F8
9D00C6F4  AC800024   SW ZERO, 36(A0)
9D00C6F8  8C8C0028   LW T4, 40(A0)
9D00C6FC  3C02A001   LUI V0, -24575
9D00C700  24482010   ADDIU T0, V0, 8208
9D00C704  51880001   BEQL T4, T0, 0x9D00C70C
9D00C708  AC800028   SW ZERO, 40(A0)
9D00C70C  8C85002C   LW A1, 44(A0)
9D00C710  3C0BA001   LUI T3, -24575
9D00C714  25672010   ADDIU A3, T3, 8208
9D00C718  50A70001   BEQL A1, A3, 0x9D00C720
9D00C71C  AC80002C   SW ZERO, 44(A0)
9D00C720  8C860030   LW A2, 48(A0)
9D00C724  3C0DA001   LUI T5, -24575
9D00C728  25AE2010   ADDIU T6, T5, 8208
9D00C72C  50CE0001   BEQL A2, T6, 0x9D00C734
9D00C730  AC800030   SW ZERO, 48(A0)
9D00C734  8C8F0034   LW T7, 52(A0)
9D00C738  3C18A001   LUI T8, -24575
9D00C73C  27192010   ADDIU T9, T8, 8208
9D00C740  51F90001   BEQL T7, T9, 0x9D00C748
9D00C744  AC800034   SW ZERO, 52(A0)
9D00C748  8C890038   LW T1, 56(A0)
9D00C74C  3C0AA001   LUI T2, -24575
9D00C750  25432010   ADDIU V1, T2, 8208
9D00C754  51230001   BEQL T1, V1, 0x9D00C75C
9D00C758  AC800038   SW ZERO, 56(A0)
9D00C75C  8C8C003C   LW T4, 60(A0)
9D00C760  3C02A001   LUI V0, -24575
9D00C764  24482010   ADDIU T0, V0, 8208
9D00C768  51880001   BEQL T4, T0, 0x9D00C770
9D00C76C  AC80003C   SW ZERO, 60(A0)
9D00C770  03E00008   JR RA
9D00C774  00000000   NOP
1293:                         context->mem_page[loop] = NULL;
1294:                   }
1295:                }
1296:                
1297:                /* DMA a byte of data from ROM */
1298:                uint8 nes6502_getbyte(uint32 address)
1299:                {
1300:                   return bank_readbyte(address);
1301:                }
9D00C798  03E00008   JR RA
9D00C79C  91220000   LBU V0, 0(T1)
1302:                
1303:                /* get number of elapsed cycles */
1304:                uint32 nes6502_getcycles(bool reset_flag)
1305:                {
1306:                   uint32 cycles = cpu.total_cycles;
9D00C7A0  3C02A001   LUI V0, -24575
1307:                
1308:                   if (reset_flag)
9D00C7A4  10800003   BEQ A0, ZERO, 0x9D00C7B4
9D00C7A8  8C423064   LW V0, 12388(V0)
1309:                      cpu.total_cycles = 0;
9D00C7AC  3C03A001   LUI V1, -24575
9D00C7B0  AC603064   SW ZERO, 12388(V1)
1310:                
1311:                   return cycles;
1312:                }
9D00C7B4  03E00008   JR RA
9D00C7B8  00000000   NOP
1313:                
1314:                #define  GET_GLOBAL_REGS() \
1315:                { \
1316:                   PC = cpu.pc_reg; \
1317:                   A = cpu.a_reg; \
1318:                   X = cpu.x_reg; \
1319:                   Y = cpu.y_reg; \
1320:                   SCATTER_FLAGS(cpu.p_reg); \
1321:                   S = cpu.s_reg; \
1322:                }
1323:                
1324:                #define  STORE_LOCAL_REGS() \
1325:                { \
1326:                   cpu.pc_reg = PC; \
1327:                   cpu.a_reg = A; \
1328:                   cpu.x_reg = X; \
1329:                   cpu.y_reg = Y; \
1330:                   cpu.p_reg = COMBINE_FLAGS(); \
1331:                   cpu.s_reg = S; \
1332:                }
1333:                
1334:                #define  MIN(a,b)    (((a) < (b)) ? (a) : (b))
1335:                
1336:                #ifdef NES6502_JUMPTABLE
1337:                
1338:                #define  OPCODE_BEGIN(xx)  op##xx:
1339:                #ifdef NES6502_DISASM
1340:                
1341:                #define  OPCODE_END \
1342:                   if (remaining_cycles <= 0) \
1343:                      goto end_execute; \
1344:                   log_printf(nes6502_disasm(PC, COMBINE_FLAGS(), A, X, Y, S)); \
1345:                   goto *opcode_table[bank_readbyte(PC++)];
1346:                
1347:                #else /* !NES6520_DISASM */
1348:                
1349:                #define  OPCODE_END \
1350:                   if (remaining_cycles <= 0) \
1351:                      goto end_execute; \
1352:                   goto *opcode_table[bank_readbyte(PC++)];
1353:                
1354:                #endif /* !NES6502_DISASM */
1355:                
1356:                #else /* !NES6502_JUMPTABLE */
1357:                #define  OPCODE_BEGIN(xx)  case 0x##xx:
1358:                #define  OPCODE_END        break;
1359:                #endif /* !NES6502_JUMPTABLE */
1360:                
1361:                
1362:                /* Execute instructions until count expires
1363:                **
1364:                ** Returns the number of cycles *actually* executed, which will be
1365:                ** anywhere from zero to timeslice_cycles + 6
1366:                */
1367:                int nes6502_execute(int timeslice_cycles)
1368:                {
9D00C7BC  27BDFFA0   ADDIU SP, SP, -96
9D00C7C0  AFBF005C   SW RA, 92(SP)
9D00C7C4  AFBE0058   SW FP, 88(SP)
9D00C7C8  AFB70054   SW S7, 84(SP)
9D00C7CC  AFB60050   SW S6, 80(SP)
9D00C7D0  AFB5004C   SW S5, 76(SP)
9D00C7D4  AFB40048   SW S4, 72(SP)
9D00C7D8  AFB30044   SW S3, 68(SP)
9D00C7DC  AFB20040   SW S2, 64(SP)
9D00C7E0  AFB1003C   SW S1, 60(SP)
9D00C7E4  AFB00038   SW S0, 56(SP)
1369:                   int old_cycles = cpu.total_cycles;
9D00C7E8  3C02A001   LUI V0, -24575
9D00C7EC  24473010   ADDIU A3, V0, 12304
9D00C7F0  8CE30054   LW V1, 84(A3)
9D00C7F4  AFA30024   SW V1, 36(SP)
1370:                
1371:                   uint32 temp, addr; /* for macros */
1372:                   uint8 btemp, baddr; /* for macros */
1373:                   uint8 data;
1374:                
1375:                   /* flags */
1376:                   uint8 n_flag, v_flag, b_flag;
1377:                   uint8 d_flag, i_flag, z_flag, c_flag;
1378:                
1379:                   /* local copies of regs */
1380:                   uint32 PC;
1381:                   uint8 A, X, Y, S;
1382:                
1383:                #ifdef NES6502_JUMPTABLE
1384:                   
1385:                   static const void *opcode_table[256] =
1386:                   {
1387:                      &&op00, &&op01, &&op02, &&op03, &&op04, &&op05, &&op06, &&op07,
1388:                      &&op08, &&op09, &&op0A, &&op0B, &&op0C, &&op0D, &&op0E, &&op0F,
1389:                      &&op10, &&op11, &&op12, &&op13, &&op14, &&op15, &&op16, &&op17,
1390:                      &&op18, &&op19, &&op1A, &&op1B, &&op1C, &&op1D, &&op1E, &&op1F,
1391:                      &&op20, &&op21, &&op22, &&op23, &&op24, &&op25, &&op26, &&op27,
1392:                      &&op28, &&op29, &&op2A, &&op2B, &&op2C, &&op2D, &&op2E, &&op2F,
1393:                      &&op30, &&op31, &&op32, &&op33, &&op34, &&op35, &&op36, &&op37,
1394:                      &&op38, &&op39, &&op3A, &&op3B, &&op3C, &&op3D, &&op3E, &&op3F,
1395:                      &&op40, &&op41, &&op42, &&op43, &&op44, &&op45, &&op46, &&op47,
1396:                      &&op48, &&op49, &&op4A, &&op4B, &&op4C, &&op4D, &&op4E, &&op4F,
1397:                      &&op50, &&op51, &&op52, &&op53, &&op54, &&op55, &&op56, &&op57,
1398:                      &&op58, &&op59, &&op5A, &&op5B, &&op5C, &&op5D, &&op5E, &&op5F,
1399:                      &&op60, &&op61, &&op62, &&op63, &&op64, &&op65, &&op66, &&op67,
1400:                      &&op68, &&op69, &&op6A, &&op6B, &&op6C, &&op6D, &&op6E, &&op6F,
1401:                      &&op70, &&op71, &&op72, &&op73, &&op74, &&op75, &&op76, &&op77,
1402:                      &&op78, &&op79, &&op7A, &&op7B, &&op7C, &&op7D, &&op7E, &&op7F,
1403:                      &&op80, &&op81, &&op82, &&op83, &&op84, &&op85, &&op86, &&op87,
1404:                      &&op88, &&op89, &&op8A, &&op8B, &&op8C, &&op8D, &&op8E, &&op8F,
1405:                      &&op90, &&op91, &&op92, &&op93, &&op94, &&op95, &&op96, &&op97,
1406:                      &&op98, &&op99, &&op9A, &&op9B, &&op9C, &&op9D, &&op9E, &&op9F,
1407:                      &&opA0, &&opA1, &&opA2, &&opA3, &&opA4, &&opA5, &&opA6, &&opA7,
1408:                      &&opA8, &&opA9, &&opAA, &&opAB, &&opAC, &&opAD, &&opAE, &&opAF,
1409:                      &&opB0, &&opB1, &&opB2, &&opB3, &&opB4, &&opB5, &&opB6, &&opB7,
1410:                      &&opB8, &&opB9, &&opBA, &&opBB, &&opBC, &&opBD, &&opBE, &&opBF,
1411:                      &&opC0, &&opC1, &&opC2, &&opC3, &&opC4, &&opC5, &&opC6, &&opC7,
1412:                      &&opC8, &&opC9, &&opCA, &&opCB, &&opCC, &&opCD, &&opCE, &&opCF,
1413:                      &&opD0, &&opD1, &&opD2, &&opD3, &&opD4, &&opD5, &&opD6, &&opD7,
1414:                      &&opD8, &&opD9, &&opDA, &&opDB, &&opDC, &&opDD, &&opDE, &&opDF,
1415:                      &&opE0, &&opE1, &&opE2, &&opE3, &&opE4, &&opE5, &&opE6, &&opE7,
1416:                      &&opE8, &&opE9, &&opEA, &&opEB, &&opEC, &&opED, &&opEE, &&opEF,
1417:                      &&opF0, &&opF1, &&opF2, &&opF3, &&opF4, &&opF5, &&opF6, &&opF7,
1418:                      &&opF8, &&opF9, &&opFA, &&opFB, &&opFC, &&opFD, &&opFE, &&opFF
1419:                   };
1420:                
1421:                #endif /* NES6502_JUMPTABLE */
1422:                
1423:                   remaining_cycles = timeslice_cycles;
9D00C7F8  AF8480E8   SW A0, -32536(GP)
1424:                
1425:                   GET_GLOBAL_REGS();
9D00C7FC  8CF10048   LW S1, 72(A3)
9D00C800  90F4004C   LBU S4, 76(A3)
9D00C804  90FE004E   LBU FP, 78(A3)
9D00C808  90E5004F   LBU A1, 79(A3)
9D00C80C  AFA50010   SW A1, 16(SP)
9D00C810  90F7004D   LBU S7, 77(A3)
9D00C814  32F20080   ANDI S2, S7, 128
9D00C818  32E60040   ANDI A2, S7, 64
9D00C81C  30C800FF   ANDI T0, A2, 255
9D00C820  AFA80014   SW T0, 20(SP)
9D00C824  32E90010   ANDI T1, S7, 16
9D00C828  312A00FF   ANDI T2, T1, 255
9D00C82C  AFAA0028   SW T2, 40(SP)
9D00C830  32EB0008   ANDI T3, S7, 8
9D00C834  316C00FF   ANDI T4, T3, 255
9D00C838  AFAC0020   SW T4, 32(SP)
9D00C83C  32ED0004   ANDI T5, S7, 4
9D00C840  31AE00FF   ANDI T6, T5, 255
9D00C844  AFAE001C   SW T6, 28(SP)
9D00C848  3AF50002   XORI S5, S7, 2
9D00C84C  7EB50040   EXT S5, S5, 1, 1
9D00C850  90EF0050   LBU T7, 80(A3)
9D00C854  AFAF0018   SW T7, 24(SP)
1426:                
1427:                   /* check for DMA cycle burning */
1428:                   if (cpu.burn_cycles && remaining_cycles > 0)
9D00C858  8CF00058   LW S0, 88(A3)
9D00C85C  1200000E   BEQ S0, ZERO, .LBE761
9D00C860  32F70001   ANDI S7, S7, 1
9D00C864  1880000C   BLEZ A0, .LBE761
9D00C868  0204982A   SLT S3, S0, A0
1429:                   {
1430:                      int burn_for;
1431:                      
1432:                      burn_for = MIN(remaining_cycles, cpu.burn_cycles);
9D00C86C  0200B021   ADDU S6, S0, ZERO
9D00C870  0093B00A   MOVZ S6, A0, S3
1433:                      ADD_CYCLES(burn_for);
9D00C874  00962023   SUBU A0, A0, S6
9D00C878  AF8480E8   SW A0, -32536(GP)
9D00C87C  3C19A001   LUI T9, -24575
9D00C880  273F3010   ADDIU RA, T9, 12304
9D00C884  8FA20024   LW V0, 36(SP)
9D00C888  00563821   ADDU A3, V0, S6
9D00C88C  AFE70054   SW A3, 84(RA)
1434:                      cpu.burn_cycles -= burn_for;
9D00C890  02161823   SUBU V1, S0, S6
9D00C894  AFE30058   SW V1, 88(RA)
1435:                   }
1436:                
1437:                   if (0 == i_flag && cpu.int_pending && remaining_cycles > 0)
9D00C898  8FA5001C   LW A1, 28(SP)
9D00C89C  14A00037   BNE A1, ZERO, 0x9D00C97C
9D00C8A0  8F9F80E8   LW RA, -32536(GP)
9D00C8A4  3C06A001   LUI A2, -24575
9D00C8A8  90C83062   LBU T0, 12386(A2)
9D00C8AC  11000033   BEQ T0, ZERO, 0x9D00C97C
9D00C8B0  8F9080E8   LW S0, -32536(GP)
9D00C8B4  1A00242F   BLEZ S0, .L95
9D00C8B8  3C09A001   LUI T1, -24575
1438:                   {
1439:                      cpu.int_pending = 0;
9D00C8BC  A1203062   SB ZERO, 12386(T1)
1440:                      IRQ_PROC();
9D00C8C0  8F8A80E0   LW T2, -32544(GP)
9D00C8C4  8FAB0018   LW T3, 24(SP)
9D00C8C8  014B6021   ADDU T4, T2, T3
9D00C8CC  00116A02   SRL T5, S1, 8
9D00C8D0  A18D0000   SB T5, 0(T4)
9D00C8D4  8FAE0018   LW T6, 24(SP)
9D00C8D8  25CFFFFE   ADDIU T7, T6, -2
9D00C8DC  31F300FF   ANDI S3, T7, 255
9D00C8E0  25D6FFFF   ADDIU S6, T6, -1
9D00C8E4  32D800FF   ANDI T8, S6, 255
9D00C8E8  01582021   ADDU A0, T2, T8
9D00C8EC  A0910000   SB S1, 0(A0)
9D00C8F0  25D1FFFD   ADDIU S1, T6, -3
9D00C8F4  323900FF   ANDI T9, S1, 255
9D00C8F8  AFB90018   SW T9, 24(SP)
9D00C8FC  0153F821   ADDU RA, T2, S3
9D00C900  2402FF80   ADDIU V0, ZERO, -128
9D00C904  02423824   AND A3, S2, V0
9D00C908  7C075420   SEB T2, A3
9D00C90C  24060040   ADDIU A2, ZERO, 64
9D00C910  8FA30014   LW V1, 20(SP)
9D00C914  0003300A   MOVZ A2, ZERO, V1
9D00C918  24050008   ADDIU A1, ZERO, 8
9D00C91C  8FA80020   LW T0, 32(SP)
9D00C920  0008280A   MOVZ A1, ZERO, T0
9D00C924  24090002   ADDIU T1, ZERO, 2
9D00C928  0015480B   MOVN T1, ZERO, S5
9D00C92C  36EB0020   ORI T3, S7, 32
9D00C930  014B6025   OR T4, T2, T3
9D00C934  00CC6825   OR T5, A2, T4
9D00C938  00AD7025   OR T6, A1, T5
9D00C93C  012E7825   OR T7, T1, T6
9D00C940  A3EF0000   SB T7, 0(RA)
9D00C944  0F4030A7   JAL bank_readword
9D00C948  3404FFFE   ORI A0, ZERO, -2
9D00C94C  00408821   ADDU S1, V0, ZERO
9D00C96C  24190001   ADDIU T9, ZERO, 1
9D00C970  AFB9001C   SW T9, 28(SP)
9D00C974  AFA00028   SW ZERO, 40(SP)
1441:                      ADD_CYCLES(INT_CYCLES);
9D00C950  2610FFF9   ADDIU S0, S0, -7
9D00C954  AF9080E8   SW S0, -32536(GP)
9D00C958  3C13A001   LUI S3, -24575
9D00C95C  26763010   ADDIU S6, S3, 12304
9D00C960  8ED80054   LW T8, 84(S6)
9D00C964  27040007   ADDIU A0, T8, 7
9D00C968  AEC40054   SW A0, 84(S6)
1442:                   }
1443:                
1444:                #ifdef NES6502_JUMPTABLE
1445:                   /* fetch first instruction */
1446:                   OPCODE_END
9D00C978  8F9F80E8   LW RA, -32536(GP)
9D00C97C  1BE023FD   BLEZ RA, .L95
9D00C980  26300001   ADDIU S0, S1, 1
9D00C9A4  91090000   LBU T1, 0(T0)
9D00C9A8  00095880   SLL T3, T1, 2
9D00C9AC  3C0C9D03   LUI T4, -25341
9D00C9B0  258D5CD4   ADDIU T5, T4, 23764
9D00C9B4  016D7021   ADDU T6, T3, T5
9D00C9B8  8DC50000   LW A1, 0(T6)
1447:                
1448:                #else /* !NES6502_JUMPTABLE */
1449:                
1450:                   /* Continue until we run out of cycles */
1451:                   while (remaining_cycles > 0)
1452:                   {
1453:                #ifdef NES6502_DISASM
1454:                      log_printf(nes6502_disasm(PC, COMBINE_FLAGS(), A, X, Y, S));
1455:                #endif /* NES6502_DISASM */
1456:                
1457:                      /* Fetch and execute instruction */
1458:                      switch (bank_readbyte(PC++))
1459:                      {
1460:                #endif /* !NES6502_JUMPTABLE */
1461:                
1462:                      OPCODE_BEGIN(00)  /* BRK */
1463:                         BRK();
9D00C9D0  26100001   ADDIU S0, S0, 1
9D00C9D4  8F9880E0   LW T8, -32544(GP)
9D00C9D8  8FA40018   LW A0, 24(SP)
9D00C9DC  0304C821   ADDU T9, T8, A0
9D00C9E0  0010FA02   SRL RA, S0, 8
9D00C9E4  A33F0000   SB RA, 0(T9)
9D00C9E8  8FA20018   LW V0, 24(SP)
9D00C9EC  2447FFFE   ADDIU A3, V0, -2
9D00C9F0  30EA00FF   ANDI T2, A3, 255
9D00C9F4  2446FFFF   ADDIU A2, V0, -1
9D00C9F8  30C300FF   ANDI V1, A2, 255
9D00C9FC  03038821   ADDU S1, T8, V1
9D00CA00  A2300000   SB S0, 0(S1)
9D00CA04  2445FFFD   ADDIU A1, V0, -3
9D00CA08  30A800FF   ANDI T0, A1, 255
9D00CA0C  AFA80018   SW T0, 24(SP)
9D00CA10  030A5821   ADDU T3, T8, T2
9D00CA14  2409FF80   ADDIU T1, ZERO, -128
9D00CA18  02496024   AND T4, S2, T1
9D00CA1C  7C0C6C20   SEB T5, T4
9D00CA20  240E0040   ADDIU T6, ZERO, 64
9D00CA24  8FAF0014   LW T7, 20(SP)
9D00CA28  000F700A   MOVZ T6, ZERO, T7
9D00CA2C  24100008   ADDIU S0, ZERO, 8
9D00CA30  8FB80020   LW T8, 32(SP)
9D00CA34  0018800A   MOVZ S0, ZERO, T8
9D00CA38  24190004   ADDIU T9, ZERO, 4
9D00CA3C  8FA4001C   LW A0, 28(SP)
9D00CA40  0004C80A   MOVZ T9, ZERO, A0
9D00CA44  241F0002   ADDIU RA, ZERO, 2
9D00CA48  0015F80B   MOVN RA, ZERO, S5
9D00CA4C  36E20030   ORI V0, S7, 48
9D00CA50  01A23825   OR A3, T5, V0
9D00CA54  01C75025   OR T2, T6, A3
9D00CA58  020A3025   OR A2, S0, T2
9D00CA5C  03261825   OR V1, T9, A2
9D00CA60  03E38825   OR S1, RA, V1
9D00CA64  A1710000   SB S1, 0(T3)
9D00CA68  0F4030A7   JAL bank_readword
9D00CA6C  3404FFFE   ORI A0, ZERO, -2
9D00CA70  00408821   ADDU S1, V0, ZERO
9D00CA74  8F8580E8   LW A1, -32536(GP)
9D00CA78  24A8FFF9   ADDIU T0, A1, -7
9D00CA7C  AF8880E8   SW T0, -32536(GP)
9D00CA80  266B3010   ADDIU T3, S3, 12304
9D00CA84  8D690054   LW T1, 84(T3)
9D00CA88  252C0007   ADDIU T4, T1, 7
9D00CA94  24130001   ADDIU S3, ZERO, 1
9D00CA98  AFB3001C   SW S3, 28(SP)
9D00CA9C  24160001   ADDIU S6, ZERO, 1
9D00CAA0  0B40565D   J .L95
9D00CAA4  AFB60028   SW S6, 40(SP)
9D00CAD8  24060001   ADDIU A2, ZERO, 1
9D00CADC  AFA6001C   SW A2, 28(SP)
9D00CAE0  24030001   ADDIU V1, ZERO, 1
1464:                         OPCODE_END
9D00CA8C  1D000006   BGTZ T0, 0x9D00CAA8
9D00CA90  AD6C0054   SW T4, 84(T3)
9D00CAA8  24500001   ADDIU S0, V0, 1
9D00CAC8  93E20000   LBU V0, 0(RA)
9D00CACC  00023880   SLL A3, V0, 2
9D00CAD0  00F65021   ADDU T2, A3, S6
9D00CAD4  8D450000   LW A1, 0(T2)
9D00CAE4  0B403272   J 0x9D00C9C8
9D00CAE8  AFA30028   SW V1, 40(SP)
1465:                
1466:                      OPCODE_BEGIN(01)  /* ORA ($nn,X) */
1467:                         ORA(6, INDIR_X_BYTE);
9D00CAEC  26110001   ADDIU S1, S0, 1
9D00CB0C  918D0000   LBU T5, 0(T4)
9D00CB10  03CD7021   ADDU T6, FP, T5
9D00CB20  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00CB24  97240000   LHU A0, 0(T9)
9D00CB28  0054A025   OR S4, V0, S4
9D00CB2C  329200FF   ANDI S2, S4, 255
9D00CB30  8F8480E8   LW A0, -32536(GP)
9D00CB34  2482FFFA   ADDIU V0, A0, -6
9D00CB38  AF8280E8   SW V0, -32536(GP)
9D00CB3C  8EA70054   LW A3, 84(S5)
9D00CB40  24EA0006   ADDIU T2, A3, 6
9D00CB4C  0240A021   ADDU S4, S2, ZERO
9D00CB50  0B40565D   J .L95
9D00CB54  0240A821   ADDU S5, S2, ZERO
9D00CB88  0240A021   ADDU S4, S2, ZERO
1468:                         OPCODE_END
9D00CB44  1C400004   BGTZ V0, 0x9D00CB58
9D00CB48  AEAA0054   SW T2, 84(S5)
9D00CB58  26100002   ADDIU S0, S0, 2
9D00CB78  910B0000   LBU T3, 0(T0)
9D00CB7C  000B4880   SLL T1, T3, 2
9D00CB80  01366021   ADDU T4, T1, S6
9D00CB84  8D850000   LW A1, 0(T4)
9D00CB8C  0B403272   J 0x9D00C9C8
9D00CB90  0240A821   ADDU S5, S2, ZERO
1469:                
1470:                      OPCODE_BEGIN(02)  /* JAM */
1471:                      OPCODE_BEGIN(12)  /* JAM */
1472:                      OPCODE_BEGIN(22)  /* JAM */
1473:                      OPCODE_BEGIN(32)  /* JAM */
1474:                      OPCODE_BEGIN(42)  /* JAM */
1475:                      OPCODE_BEGIN(52)  /* JAM */
1476:                      OPCODE_BEGIN(62)  /* JAM */
1477:                      OPCODE_BEGIN(72)  /* JAM */
1478:                      OPCODE_BEGIN(92)  /* JAM */
1479:                      OPCODE_BEGIN(B2)  /* JAM */
1480:                      OPCODE_BEGIN(D2)  /* JAM */
1481:                      OPCODE_BEGIN(F2)  /* JAM */
1482:                         JAM();
9D00CB94  0B4032FA   J 0x9D00CBE8
9D00CB98  2611FFFF   ADDIU S1, S0, -1
9D00CB9C  0B4032FA   J 0x9D00CBE8
9D00CBA0  2611FFFF   ADDIU S1, S0, -1
9D00CBA4  0B4032FA   J 0x9D00CBE8
9D00CBA8  2611FFFF   ADDIU S1, S0, -1
9D00CBAC  0B4032FA   J 0x9D00CBE8
9D00CBB0  2611FFFF   ADDIU S1, S0, -1
9D00CBB4  0B4032FA   J 0x9D00CBE8
9D00CBB8  2611FFFF   ADDIU S1, S0, -1
9D00CBBC  0B4032FA   J 0x9D00CBE8
9D00CBC0  2611FFFF   ADDIU S1, S0, -1
9D00CBC4  0B4032FA   J 0x9D00CBE8
9D00CBC8  2611FFFF   ADDIU S1, S0, -1
9D00CBCC  0B4032FA   J 0x9D00CBE8
9D00CBD0  2611FFFF   ADDIU S1, S0, -1
9D00CBD4  0B4032FA   J 0x9D00CBE8
9D00CBD8  2611FFFF   ADDIU S1, S0, -1
9D00CBDC  0B4032FA   J 0x9D00CBE8
9D00CBE0  2611FFFF   ADDIU S1, S0, -1
9D00CBE4  2611FFFF   ADDIU S1, S0, -1
9D00CBE8  3C10A001   LUI S0, -24575
9D00CBEC  26133010   ADDIU S3, S0, 12304
9D00CBF0  24160001   ADDIU S6, ZERO, 1
9D00CBF4  A2760051   SB S6, 81(S3)
9D00CBF8  A2600052   SB ZERO, 82(S3)
9D00CBFC  8E6D0054   LW T5, 84(S3)
9D00CC00  25AE0002   ADDIU T6, T5, 2
9D00CC04  AE6E0054   SW T6, 84(S3)
9D00CC08  0B40565D   J .L95
9D00CC0C  AF8080E8   SW ZERO, -32536(GP)
1483:                         /* kill the CPU */
1484:                         remaining_cycles = 0;
1485:                         OPCODE_END
1486:                
1487:                      OPCODE_BEGIN(03)  /* SLO ($nn,X) */
1488:                         SLO(8, INDIR_X, mem_writebyte, addr);
9D00CC10  26110001   ADDIU S1, S0, 1
9D00CC30  90820000   LBU V0, 0(A0)
9D00CC34  03C23821   ADDU A3, FP, V0
9D00CC4C  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00CC50  00602021   ADDU A0, V1, ZERO
9D00CC54  7C5739C0   EXT S7, V0, 7, 8
9D00CC58  00022840   SLL A1, V0, 1
9D00CC5C  30B200FF   ANDI S2, A1, 255
9D00CC60  8FA4002C   LW A0, 44(SP)
9D00CC64  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00CC68  02402821   ADDU A1, S2, ZERO
9D00CC6C  0254A025   OR S4, S2, S4
9D00CC70  329200FF   ANDI S2, S4, 255
9D00CC74  8F8880E8   LW T0, -32536(GP)
9D00CC78  250BFFF8   ADDIU T3, T0, -8
9D00CC7C  AF8B80E8   SW T3, -32536(GP)
9D00CC80  8EA90054   LW T1, 84(S5)
9D00CC84  252C0008   ADDIU T4, T1, 8
9D00CC90  0240A021   ADDU S4, S2, ZERO
9D00CC94  0B40565D   J .L95
9D00CC98  0240A821   ADDU S5, S2, ZERO
9D00CCCC  0240A021   ADDU S4, S2, ZERO
1489:                         OPCODE_END
9D00CC88  1D600004   BGTZ T3, 0x9D00CC9C
9D00CC8C  AEAC0054   SW T4, 84(S5)
9D00CC9C  26100002   ADDIU S0, S0, 2
9D00CCBC  93240000   LBU A0, 0(T9)
9D00CCC0  00041080   SLL V0, A0, 2
9D00CCC4  00563821   ADDU A3, V0, S6
9D00CCC8  8CE50000   LW A1, 0(A3)
9D00CCD0  0B403272   J 0x9D00C9C8
9D00CCD4  0240A821   ADDU S5, S2, ZERO
1490:                
1491:                      OPCODE_BEGIN(04)  /* NOP $nn */
1492:                      OPCODE_BEGIN(44)  /* NOP $nn */
1493:                      OPCODE_BEGIN(64)  /* NOP $nn */
1494:                         DOP(3);
9D00CCD8  0B403339   J 0x9D00CCE4
9D00CCDC  26110001   ADDIU S1, S0, 1
9D00CCE0  26110001   ADDIU S1, S0, 1
9D00CCE4  8F8A80E8   LW T2, -32536(GP)
9D00CCE8  255FFFFD   ADDIU RA, T2, -3
9D00CCEC  AF9F80E8   SW RA, -32536(GP)
9D00CCF0  26663010   ADDIU A2, S3, 12304
9D00CCF4  8CC30054   LW V1, 84(A2)
9D00CCF8  24650003   ADDIU A1, V1, 3
1495:                         OPCODE_END
9D00CCFC  1BE0231D   BLEZ RA, .L95
9D00CD00  ACC50054   SW A1, 84(A2)
9D00CD04  26100002   ADDIU S0, S0, 2
9D00CD24  91F10000   LBU S1, 0(T7)
9D00CD28  0011C080   SLL T8, S1, 2
9D00CD2C  0316C821   ADDU T9, T8, S6
9D00CD30  0B403272   J 0x9D00C9C8
9D00CD34  8F250000   LW A1, 0(T9)
1496:                
1497:                      OPCODE_BEGIN(05)  /* ORA $nn */
1498:                         ORA(3, ZERO_PAGE_BYTE); 
9D00CD38  26110001   ADDIU S1, S0, 1
9D00CD58  93E60000   LBU A2, 0(RA)
9D00CD5C  8F8380E4   LW V1, -32540(GP)
9D00CD60  00662821   ADDU A1, V1, A2
9D00CD64  90A80000   LBU T0, 0(A1)
9D00CD68  0288A025   OR S4, S4, T0
9D00CD6C  329200FF   ANDI S2, S4, 255
9D00CD70  8F8B80E8   LW T3, -32536(GP)
9D00CD74  2569FFFD   ADDIU T1, T3, -3
9D00CD78  AF8980E8   SW T1, -32536(GP)
9D00CD7C  8C4C0054   LW T4, 84(V0)
9D00CD80  258D0003   ADDIU T5, T4, 3
9D00CD8C  0240A021   ADDU S4, S2, ZERO
9D00CD90  0B40565D   J .L95
9D00CD94  0240A821   ADDU S5, S2, ZERO
9D00CDC8  0240A021   ADDU S4, S2, ZERO
1499:                         OPCODE_END
9D00CD84  1D200004   BGTZ T1, 0x9D00CD98
9D00CD88  AC4D0054   SW T5, 84(V0)
9D00CD98  26100002   ADDIU S0, S0, 2
9D00CDB8  90440000   LBU A0, 0(V0)
9D00CDBC  00043880   SLL A3, A0, 2
9D00CDC0  00F65021   ADDU T2, A3, S6
9D00CDC4  8D450000   LW A1, 0(T2)
9D00CDCC  0B403272   J 0x9D00C9C8
9D00CDD0  0240A821   ADDU S5, S2, ZERO
1500:                
1501:                      OPCODE_BEGIN(06)  /* ASL $nn */
1502:                         ASL(5, ZERO_PAGE, ZP_WRITEBYTE, baddr);
9D00CDD4  26110001   ADDIU S1, S0, 1
9D00CDF4  910B0000   LBU T3, 0(T0)
9D00CDF8  8F8980E4   LW T1, -32540(GP)
9D00CDFC  012B6021   ADDU T4, T1, T3
9D00CE00  918D0000   LBU T5, 0(T4)
9D00CE04  000DB9C2   SRL S7, T5, 7
9D00CE08  000D7040   SLL T6, T5, 1
9D00CE0C  31D200FF   ANDI S2, T6, 255
9D00CE10  A1920000   SB S2, 0(T4)
9D00CE14  8F8F80E8   LW T7, -32536(GP)
9D00CE18  25F8FFFB   ADDIU T8, T7, -5
9D00CE1C  AF9880E8   SW T8, -32536(GP)
9D00CE20  8FF90054   LW T9, 84(RA)
9D00CE24  27350005   ADDIU S5, T9, 5
9D00CE30  0B40565D   J .L95
9D00CE34  0240A821   ADDU S5, S2, ZERO
1503:                         OPCODE_END
9D00CE28  1F000003   BGTZ T8, 0x9D00CE38
9D00CE2C  AFF50054   SW S5, 84(RA)
9D00CE38  26100002   ADDIU S0, S0, 2
9D00CE58  90C30000   LBU V1, 0(A2)
9D00CE5C  00032880   SLL A1, V1, 2
9D00CE60  00B64021   ADDU T0, A1, S6
9D00CE64  8D050000   LW A1, 0(T0)
9D00CE68  0B403272   J 0x9D00C9C8
9D00CE6C  0240A821   ADDU S5, S2, ZERO
1504:                
1505:                      OPCODE_BEGIN(07)  /* SLO $nn */
1506:                         SLO(5, ZERO_PAGE, ZP_WRITEBYTE, baddr);
9D00CE70  26110001   ADDIU S1, S0, 1
9D00CE90  91CF0000   LBU T7, 0(T6)
9D00CE94  8F9880E4   LW T8, -32540(GP)
9D00CE98  030FC821   ADDU T9, T8, T7
9D00CE9C  93350000   LBU S5, 0(T9)
9D00CEA0  0015B9C2   SRL S7, S5, 7
9D00CEA4  00151040   SLL V0, S5, 1
9D00CEA8  304400FF   ANDI A0, V0, 255
9D00CEAC  A3240000   SB A0, 0(T9)
9D00CEB0  0094A025   OR S4, A0, S4
9D00CEB4  329200FF   ANDI S2, S4, 255
9D00CEB8  8F8780E8   LW A3, -32536(GP)
9D00CEBC  24EAFFFB   ADDIU T2, A3, -5
9D00CEC0  AF8A80E8   SW T2, -32536(GP)
9D00CEC4  8D7F0054   LW RA, 84(T3)
9D00CEC8  27E60005   ADDIU A2, RA, 5
9D00CED4  0240A021   ADDU S4, S2, ZERO
9D00CED8  0B40565D   J .L95
9D00CEDC  0240A821   ADDU S5, S2, ZERO
9D00CF10  0240A021   ADDU S4, S2, ZERO
1507:                         OPCODE_END
9D00CECC  1D400004   BGTZ T2, 0x9D00CEE0
9D00CED0  AD660054   SW A2, 84(T3)
9D00CEE0  26100002   ADDIU S0, S0, 2
9D00CF00  918D0000   LBU T5, 0(T4)
9D00CF04  000D7080   SLL T6, T5, 2
9D00CF08  01D67821   ADDU T7, T6, S6
9D00CF0C  8DE50000   LW A1, 0(T7)
9D00CF14  0B403272   J 0x9D00C9C8
9D00CF18  0240A821   ADDU S5, S2, ZERO
1508:                
1509:                      OPCODE_BEGIN(08)  /* PHP */
1510:                         PHP(); 
9D00CF1C  8FB80018   LW T8, 24(SP)
9D00CF20  2719FFFF   ADDIU T9, T8, -1
9D00CF24  332400FF   ANDI A0, T9, 255
9D00CF28  8F8280E0   LW V0, -32544(GP)
9D00CF2C  0058F821   ADDU RA, V0, T8
9D00CF30  2407FF80   ADDIU A3, ZERO, -128
9D00CF34  02475024   AND T2, S2, A3
9D00CF38  7C0A5C20   SEB T3, T2
9D00CF3C  24110040   ADDIU S1, ZERO, 64
9D00CF40  8FA60014   LW A2, 20(SP)
9D00CF44  0006880A   MOVZ S1, ZERO, A2
9D00CF48  24080010   ADDIU T0, ZERO, 16
9D00CF4C  8FA30028   LW V1, 40(SP)
9D00CF50  0003400A   MOVZ T0, ZERO, V1
9D00CF54  24090008   ADDIU T1, ZERO, 8
9D00CF58  8FA50020   LW A1, 32(SP)
9D00CF5C  0005480A   MOVZ T1, ZERO, A1
9D00CF60  240C0004   ADDIU T4, ZERO, 4
9D00CF64  8FAD001C   LW T5, 28(SP)
9D00CF68  000D600A   MOVZ T4, ZERO, T5
9D00CF6C  240E0002   ADDIU T6, ZERO, 2
9D00CF70  0015700B   MOVN T6, ZERO, S5
9D00CF74  36EF0030   ORI T7, S7, 48
9D00CF78  016FC025   OR T8, T3, T7
9D00CF7C  0238C825   OR T9, S1, T8
9D00CF80  01191025   OR V0, T0, T9
9D00CF84  01223825   OR A3, T1, V0
9D00CF88  01875025   OR T2, T4, A3
9D00CF8C  01CA5825   OR T3, T6, T2
9D00CF90  A3EB0000   SB T3, 0(RA)
9D00CF94  8F9F80E8   LW RA, -32536(GP)
9D00CF98  27F1FFFD   ADDIU S1, RA, -3
9D00CF9C  AF9180E8   SW S1, -32536(GP)
9D00CFA0  26663010   ADDIU A2, S3, 12304
9D00CFA4  8CC80054   LW T0, 84(A2)
9D00CFA8  25030003   ADDIU V1, T0, 3
9D00CFB4  AFA40018   SW A0, 24(SP)
9D00CFEC  AFA40018   SW A0, 24(SP)
1511:                         OPCODE_END
9D00CFAC  1E200004   BGTZ S1, .LBB792
9D00CFB0  ACC30054   SW V1, 84(A2)
9D00CFB8  0B40565D   J .L95
9D00CFBC  02008821   ADDU S1, S0, ZERO
9D00CFDC  93190000   LBU T9, 0(T8)
9D00CFE0  00191080   SLL V0, T9, 2
9D00CFE4  00563821   ADDU A3, V0, S6
9D00CFE8  8CE50000   LW A1, 0(A3)
9D00CFF0  0B403272   J 0x9D00C9C8
9D00CFF4  26100001   ADDIU S0, S0, 1
1512:                
1513:                      OPCODE_BEGIN(09)  /* ORA #$nn */
1514:                         ORA(2, IMMEDIATE_BYTE);
9D00CFF8  26110001   ADDIU S1, S0, 1
9D00D018  90C80000   LBU T0, 0(A2)
9D00D01C  0288A025   OR S4, S4, T0
9D00D020  329200FF   ANDI S2, S4, 255
9D00D024  8F8380E8   LW V1, -32536(GP)
9D00D028  2469FFFE   ADDIU T1, V1, -2
9D00D02C  AF8980E8   SW T1, -32536(GP)
9D00D030  8D450054   LW A1, 84(T2)
9D00D034  24AC0002   ADDIU T4, A1, 2
9D00D040  0240A021   ADDU S4, S2, ZERO
9D00D044  0B40565D   J .L95
9D00D048  0240A821   ADDU S5, S2, ZERO
9D00D07C  0240A021   ADDU S4, S2, ZERO
1515:                         OPCODE_END
9D00D038  1D200004   BGTZ T1, 0x9D00D04C
9D00D03C  AD4C0054   SW T4, 84(T2)
9D00D04C  26100002   ADDIU S0, S0, 2
9D00D06C  90470000   LBU A3, 0(V0)
9D00D070  0007A880   SLL S5, A3, 2
9D00D074  02B65021   ADDU T2, S5, S6
9D00D078  8D450000   LW A1, 0(T2)
9D00D080  0B403272   J 0x9D00C9C8
9D00D084  0240A821   ADDU S5, S2, ZERO
1516:                
1517:                      OPCODE_BEGIN(0A)  /* ASL A */
1518:                         ASL_A();
9D00D088  7E9739C0   EXT S7, S4, 7, 8
9D00D08C  00149040   SLL S2, S4, 1
9D00D090  325200FF   ANDI S2, S2, 255
9D00D094  8F8480E8   LW A0, -32536(GP)
9D00D098  248BFFFE   ADDIU T3, A0, -2
9D00D09C  AF8B80E8   SW T3, -32536(GP)
9D00D0A0  267F3010   ADDIU RA, S3, 12304
9D00D0A4  8FE60054   LW A2, 84(RA)
9D00D0A8  24C80002   ADDIU T0, A2, 2
9D00D0B4  0240A021   ADDU S4, S2, ZERO
9D00D0BC  0B40565D   J .L95
9D00D0C0  0240A821   ADDU S5, S2, ZERO
9D00D0F0  0240A021   ADDU S4, S2, ZERO
1519:                         OPCODE_END
9D00D0AC  1D600005   BGTZ T3, .LBB798
9D00D0B0  AFE80054   SW T0, 84(RA)
9D00D0B8  02008821   ADDU S1, S0, ZERO
9D00D0E0  91CF0000   LBU T7, 0(T6)
9D00D0E4  000FC080   SLL T8, T7, 2
9D00D0E8  03168821   ADDU S1, T8, S6
9D00D0EC  8E250000   LW A1, 0(S1)
9D00D0F4  26100001   ADDIU S0, S0, 1
9D00D0F8  0B403272   J 0x9D00C9C8
9D00D0FC  0240A821   ADDU S5, S2, ZERO
1520:                
1521:                      OPCODE_BEGIN(0B)  /* ANC #$nn */
1522:                         ANC(2, IMMEDIATE_BYTE);
9D00D100  26110001   ADDIU S1, S0, 1
9D00D120  908B0000   LBU T3, 0(A0)
9D00D124  028BA824   AND S5, S4, T3
9D00D128  7E5739C0   EXT S7, S2, 7, 8
9D00D12C  8F9280E8   LW S2, -32536(GP)
9D00D130  265FFFFE   ADDIU RA, S2, -2
9D00D134  AF9F80E8   SW RA, -32536(GP)
9D00D138  8C460054   LW A2, 84(V0)
9D00D13C  24C80002   ADDIU T0, A2, 2
9D00D148  02A0A021   ADDU S4, S5, ZERO
9D00D14C  0B40565D   J .L95
9D00D150  02A09021   ADDU S2, S5, ZERO
9D00D184  02A0A021   ADDU S4, S5, ZERO
1523:                         OPCODE_END
9D00D140  1FE00004   BGTZ RA, 0x9D00D154
9D00D144  AC480054   SW T0, 84(V0)
9D00D154  26100002   ADDIU S0, S0, 2
9D00D174  91CF0000   LBU T7, 0(T6)
9D00D178  000FC080   SLL T8, T7, 2
9D00D17C  03168821   ADDU S1, T8, S6
9D00D180  8E250000   LW A1, 0(S1)
9D00D188  0B403272   J 0x9D00C9C8
9D00D18C  02A09021   ADDU S2, S5, ZERO
1524:                
1525:                      OPCODE_BEGIN(0C)  /* NOP $nnnn */
1526:                         TOP(); 
9D00D190  26110002   ADDIU S1, S0, 2
9D00D194  8F9980E8   LW T9, -32536(GP)
9D00D198  2722FFFC   ADDIU V0, T9, -4
9D00D19C  AF8280E8   SW V0, -32536(GP)
9D00D1A0  26673010   ADDIU A3, S3, 12304
9D00D1A4  8CEA0054   LW T2, 84(A3)
9D00D1A8  25440004   ADDIU A0, T2, 4
1527:                         OPCODE_END
9D00D1AC  184021F1   BLEZ V0, .L95
9D00D1B0  ACE40054   SW A0, 84(A3)
9D00D1B4  26100003   ADDIU S0, S0, 3
9D00D1D4  90AC0000   LBU T4, 0(A1)
9D00D1D8  000C6880   SLL T5, T4, 2
9D00D1DC  01B67021   ADDU T6, T5, S6
9D00D1E0  0B403272   J 0x9D00C9C8
9D00D1E4  8DC50000   LW A1, 0(T6)
1528:                
1529:                      OPCODE_BEGIN(0D)  /* ORA $nnnn */
1530:                         ORA(4, ABSOLUTE_BYTE);
9D00D1E8  0F4030A7   JAL bank_readword
9D00D1EC  02002021   ADDU A0, S0, ZERO
9D00D1F0  26110002   ADDIU S1, S0, 2
9D00D1F4  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00D1F8  00402021   ADDU A0, V0, ZERO
9D00D1FC  0054A825   OR S5, V0, S4
9D00D200  32B200FF   ANDI S2, S5, 255
9D00D204  8F9480E8   LW S4, -32536(GP)
9D00D208  268FFFFC   ADDIU T7, S4, -4
9D00D20C  AF8F80E8   SW T7, -32536(GP)
9D00D210  26783010   ADDIU T8, S3, 12304
9D00D214  8F190054   LW T9, 84(T8)
9D00D218  27220004   ADDIU V0, T9, 4
9D00D224  0240A021   ADDU S4, S2, ZERO
9D00D228  0B40565D   J .L95
9D00D22C  0240A821   ADDU S5, S2, ZERO
9D00D260  0240A021   ADDU S4, S2, ZERO
1531:                         OPCODE_END
9D00D21C  1DE00004   BGTZ T7, 0x9D00D230
9D00D220  AF020054   SW V0, 84(T8)
9D00D230  26100003   ADDIU S0, S0, 3
9D00D250  90C80000   LBU T0, 0(A2)
9D00D254  00081880   SLL V1, T0, 2
9D00D258  00764821   ADDU T1, V1, S6
9D00D25C  8D250000   LW A1, 0(T1)
9D00D264  0B403272   J 0x9D00C9C8
9D00D268  0240A821   ADDU S5, S2, ZERO
1532:                
1533:                      OPCODE_BEGIN(0E)  /* ASL $nnnn */
1534:                         ASL(6, ABSOLUTE, mem_writebyte, addr);
9D00D26C  0F4030A7   JAL bank_readword
9D00D270  02002021   ADDU A0, S0, ZERO
9D00D274  0040A821   ADDU S5, V0, ZERO
9D00D278  26110002   ADDIU S1, S0, 2
9D00D27C  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00D280  00402021   ADDU A0, V0, ZERO
9D00D284  7C5739C0   EXT S7, V0, 7, 8
9D00D288  00029040   SLL S2, V0, 1
9D00D28C  325200FF   ANDI S2, S2, 255
9D00D290  02A02021   ADDU A0, S5, ZERO
9D00D294  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00D298  02402821   ADDU A1, S2, ZERO
9D00D29C  8F8580E8   LW A1, -32536(GP)
9D00D2A0  24ACFFFA   ADDIU T4, A1, -6
9D00D2A4  AF8C80E8   SW T4, -32536(GP)
9D00D2A8  266D3010   ADDIU T5, S3, 12304
9D00D2AC  8DAE0054   LW T6, 84(T5)
9D00D2B0  25CF0006   ADDIU T7, T6, 6
9D00D2BC  0B40565D   J .L95
9D00D2C0  0240A821   ADDU S5, S2, ZERO
1535:                         OPCODE_END
9D00D2B4  1D800003   BGTZ T4, 0x9D00D2C4
9D00D2B8  ADAF0054   SW T7, 84(T5)
9D00D2C4  26100003   ADDIU S0, S0, 3
9D00D2E4  91710000   LBU S1, 0(T3)
9D00D2E8  0011F880   SLL RA, S1, 2
9D00D2EC  03F63021   ADDU A2, RA, S6
9D00D2F0  8CC50000   LW A1, 0(A2)
9D00D2F4  0B403272   J 0x9D00C9C8
9D00D2F8  0240A821   ADDU S5, S2, ZERO
1536:                
1537:                      OPCODE_BEGIN(0F)  /* SLO $nnnn */
1538:                         SLO(6, ABSOLUTE, mem_writebyte, addr);
9D00D2FC  0F4030A7   JAL bank_readword
9D00D300  02002021   ADDU A0, S0, ZERO
9D00D304  0040A821   ADDU S5, V0, ZERO
9D00D308  26110002   ADDIU S1, S0, 2
9D00D30C  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00D310  00402021   ADDU A0, V0, ZERO
9D00D314  7C5739C0   EXT S7, V0, 7, 8
9D00D318  00024040   SLL T0, V0, 1
9D00D31C  311200FF   ANDI S2, T0, 255
9D00D320  02A02021   ADDU A0, S5, ZERO
9D00D324  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00D328  02402821   ADDU A1, S2, ZERO
9D00D32C  0254A025   OR S4, S2, S4
9D00D330  329200FF   ANDI S2, S4, 255
9D00D334  8F8380E8   LW V1, -32536(GP)
9D00D338  2469FFFA   ADDIU T1, V1, -6
9D00D33C  AF8980E8   SW T1, -32536(GP)
9D00D340  26653010   ADDIU A1, S3, 12304
9D00D344  8CAC0054   LW T4, 84(A1)
9D00D348  258D0006   ADDIU T5, T4, 6
9D00D354  0240A021   ADDU S4, S2, ZERO
9D00D358  0B40565D   J .L95
9D00D35C  0240A821   ADDU S5, S2, ZERO
9D00D390  0240A021   ADDU S4, S2, ZERO
1539:                         OPCODE_END
9D00D34C  1D200004   BGTZ T1, 0x9D00D360
9D00D350  ACAD0054   SW T5, 84(A1)
9D00D360  26100003   ADDIU S0, S0, 3
9D00D380  91440000   LBU A0, 0(T2)
9D00D384  00045880   SLL T3, A0, 2
9D00D388  01768821   ADDU S1, T3, S6
9D00D38C  8E250000   LW A1, 0(S1)
9D00D394  0B403272   J 0x9D00C9C8
9D00D398  0240A821   ADDU S5, S2, ZERO
1540:                
1541:                      OPCODE_BEGIN(10)  /* BPL $nnnn */
1542:                         BPL();
9D00D39C  7C12FC20   SEB RA, S2
9D00D3A0  07E0001E   BLTZ RA, 0x9D00D41C
9D00D3A4  26050001   ADDIU A1, S0, 1
9D00D3C4  80E20000   LB V0, 0(A3)
9D00D3C8  30AA00FF   ANDI T2, A1, 255
9D00D3CC  004A2021   ADDU A0, V0, T2
9D00D3D0  308B0100   ANDI T3, A0, 256
9D00D3D4  11600009   BEQ T3, ZERO, 0x9D00D3FC
9D00D3D8  8F8380E8   LW V1, -32536(GP)
9D00D3DC  8F9180E8   LW S1, -32536(GP)
9D00D3E0  263FFFFF   ADDIU RA, S1, -1
9D00D3E4  AF9F80E8   SW RA, -32536(GP)
9D00D3E8  26703010   ADDIU S0, S3, 12304
9D00D3EC  8E060054   LW A2, 84(S0)
9D00D3F0  24C80001   ADDIU T0, A2, 1
9D00D3F4  AE080054   SW T0, 84(S0)
9D00D3F8  8F8380E8   LW V1, -32536(GP)
9D00D3FC  2469FFFD   ADDIU T1, V1, -3
9D00D400  AF8980E8   SW T1, -32536(GP)
9D00D404  266C3010   ADDIU T4, S3, 12304
9D00D408  8D8D0054   LW T5, 84(T4)
9D00D40C  25AE0003   ADDIU T6, T5, 3
9D00D410  AD8E0054   SW T6, 84(T4)
9D00D414  0B40350F   J 0x9D00D43C
9D00D418  00458821   ADDU S1, V0, A1
9D00D41C  26110001   ADDIU S1, S0, 1
9D00D420  8F9080E8   LW S0, -32536(GP)
9D00D424  2606FFFE   ADDIU A2, S0, -2
9D00D428  AF8680E8   SW A2, -32536(GP)
9D00D42C  26683010   ADDIU T0, S3, 12304
9D00D430  8D030054   LW V1, 84(T0)
9D00D434  24690002   ADDIU T1, V1, 2
9D00D438  AD090054   SW T1, 84(T0)
1543:                         OPCODE_END
9D00D43C  8F8580E8   LW A1, -32536(GP)
9D00D440  18A0214C   BLEZ A1, .L95
9D00D444  26300001   ADDIU S0, S1, 1
9D00D464  908B0000   LBU T3, 0(A0)
9D00D468  000B8880   SLL S1, T3, 2
9D00D46C  0236F821   ADDU RA, S1, S6
9D00D470  0B403272   J 0x9D00C9C8
9D00D474  8FE50000   LW A1, 0(RA)
1544:                
1545:                      OPCODE_BEGIN(11)  /* ORA ($nn),Y */
1546:                         ORA(5, INDIR_Y_BYTE_READ);
9D00D4A4  8FB80010   LW T8, 16(SP)
9D00D4A8  01F8C821   ADDU T9, T7, T8
9D00D4AC  3324FFFF   ANDI A0, T9, -1
9D00D4B0  308700FF   ANDI A3, A0, 255
9D00D4B4  00F8502B   SLTU T2, A3, T8
9D00D4B8  11400008   BEQ T2, ZERO, 0x9D00D4DC
9D00D4BC  26110001   ADDIU S1, S0, 1
9D00D4C0  8F8280E8   LW V0, -32536(GP)
9D00D4C4  244BFFFF   ADDIU T3, V0, -1
9D00D4C8  AF8B80E8   SW T3, -32536(GP)
9D00D4CC  267F3010   ADDIU RA, S3, 12304
9D00D4D0  8FF50054   LW S5, 84(RA)
9D00D4D4  26B20001   ADDIU S2, S5, 1
9D00D4D8  AFF20054   SW S2, 84(RA)
9D00D4DC  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00D4E0  00000000   NOP
9D00D4E4  0054A025   OR S4, V0, S4
9D00D4E8  329200FF   ANDI S2, S4, 255
9D00D4EC  8F8480E8   LW A0, -32536(GP)
9D00D4F0  2486FFFB   ADDIU A2, A0, -5
9D00D4F4  AF8680E8   SW A2, -32536(GP)
9D00D4F8  26683010   ADDIU T0, S3, 12304
9D00D4FC  8D090054   LW T1, 84(T0)
9D00D500  25230005   ADDIU V1, T1, 5
9D00D50C  0240A021   ADDU S4, S2, ZERO
9D00D510  0B40565D   J .L95
9D00D514  0240A821   ADDU S5, S2, ZERO
9D00D548  0240A021   ADDU S4, S2, ZERO
1547:                         OPCODE_END
9D00D504  1CC00004   BGTZ A2, 0x9D00D518
9D00D508  AD030054   SW V1, 84(T0)
9D00D518  26100002   ADDIU S0, S0, 2
9D00D538  93190000   LBU T9, 0(T8)
9D00D53C  00193880   SLL A3, T9, 2
9D00D540  00F65021   ADDU T2, A3, S6
9D00D544  8D450000   LW A1, 0(T2)
9D00D54C  0B403272   J 0x9D00C9C8
9D00D550  0240A821   ADDU S5, S2, ZERO
1548:                      
1549:                      OPCODE_BEGIN(13)  /* SLO ($nn),Y */
1550:                         SLO(8, INDIR_Y, mem_writebyte, addr);
9D00D554  26110001   ADDIU S1, S0, 1
9D00D584  8FAC0010   LW T4, 16(SP)
9D00D588  006C6821   ADDU T5, V1, T4
9D00D58C  31AEFFFF   ANDI T6, T5, -1
9D00D590  AFAE002C   SW T6, 44(SP)
9D00D594  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00D598  01C02021   ADDU A0, T6, ZERO
9D00D59C  7C5739C0   EXT S7, V0, 7, 8
9D00D5A0  00022840   SLL A1, V0, 1
9D00D5A4  30B200FF   ANDI S2, A1, 255
9D00D5A8  8FA4002C   LW A0, 44(SP)
9D00D5AC  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00D5B0  02402821   ADDU A1, S2, ZERO
9D00D5B4  0254A025   OR S4, S2, S4
9D00D5B8  329200FF   ANDI S2, S4, 255
9D00D5BC  8F8F80E8   LW T7, -32536(GP)
9D00D5C0  25F8FFF8   ADDIU T8, T7, -8
9D00D5C4  AF9880E8   SW T8, -32536(GP)
9D00D5C8  8EB90054   LW T9, 84(S5)
9D00D5CC  27270008   ADDIU A3, T9, 8
9D00D5D8  0240A021   ADDU S4, S2, ZERO
9D00D5DC  0B40565D   J .L95
9D00D5E0  0240A821   ADDU S5, S2, ZERO
9D00D614  0240A021   ADDU S4, S2, ZERO
1551:                         OPCODE_END
9D00D5D0  1F000004   BGTZ T8, 0x9D00D5E4
9D00D5D4  AEA70054   SW A3, 84(S5)
9D00D5E4  26100002   ADDIU S0, S0, 2
9D00D604  90860000   LBU A2, 0(A0)
9D00D608  00064080   SLL T0, A2, 2
9D00D60C  01164821   ADDU T1, T0, S6
9D00D610  8D250000   LW A1, 0(T1)
9D00D618  0B403272   J 0x9D00C9C8
9D00D61C  0240A821   ADDU S5, S2, ZERO
1552:                
1553:                      OPCODE_BEGIN(14)  /* NOP $nn,X */
1554:                      OPCODE_BEGIN(34)  /* NOP */
1555:                      OPCODE_BEGIN(54)  /* NOP $nn,X */
1556:                      OPCODE_BEGIN(74)  /* NOP $nn,X */
1557:                      OPCODE_BEGIN(D4)  /* NOP $nn,X */
1558:                      OPCODE_BEGIN(F4)  /* NOP ($nn,X) */
1559:                         DOP(4);
9D00D620  0B403591   J 0x9D00D644
9D00D624  26110001   ADDIU S1, S0, 1
9D00D628  0B403591   J 0x9D00D644
9D00D62C  26110001   ADDIU S1, S0, 1
9D00D630  0B403591   J 0x9D00D644
9D00D634  26110001   ADDIU S1, S0, 1
9D00D638  0B403591   J 0x9D00D644
9D00D63C  26110001   ADDIU S1, S0, 1
9D00D640  26110001   ADDIU S1, S0, 1
9D00D644  8F8380E8   LW V1, -32536(GP)
9D00D648  246CFFFC   ADDIU T4, V1, -4
9D00D64C  AF8C80E8   SW T4, -32536(GP)
9D00D650  266D3010   ADDIU T5, S3, 12304
9D00D654  8DAE0054   LW T6, 84(T5)
9D00D658  25C50004   ADDIU A1, T6, 4
1560:                         OPCODE_END
9D00D65C  198020C5   BLEZ T4, .L95
9D00D660  ADA50054   SW A1, 84(T5)
9D00D664  26100002   ADDIU S0, S0, 2
9D00D684  91710000   LBU S1, 0(T3)
9D00D688  0011F880   SLL RA, S1, 2
9D00D68C  03F62021   ADDU A0, RA, S6
9D00D690  0B403272   J 0x9D00C9C8
9D00D694  8C850000   LW A1, 0(A0)
1561:                
1562:                      OPCODE_BEGIN(15)  /* ORA $nn,X */
1563:                         ORA(4, ZP_IND_X_BYTE);
9D00D698  26110001   ADDIU S1, S0, 1
9D00D6B8  918D0000   LBU T5, 0(T4)
9D00D6BC  03CD7021   ADDU T6, FP, T5
9D00D6C0  31C500FF   ANDI A1, T6, 255
9D00D6C4  8F8F80E4   LW T7, -32540(GP)
9D00D6C8  01E5C021   ADDU T8, T7, A1
9D00D6CC  93190000   LBU T9, 0(T8)
9D00D6D0  0334A025   OR S4, T9, S4
9D00D6D4  329200FF   ANDI S2, S4, 255
9D00D6D8  8F8780E8   LW A3, -32536(GP)
9D00D6DC  24EAFFFC   ADDIU T2, A3, -4
9D00D6E0  AF8A80E8   SW T2, -32536(GP)
9D00D6E4  8CC20054   LW V0, 84(A2)
9D00D6E8  244B0004   ADDIU T3, V0, 4
9D00D6F4  0240A021   ADDU S4, S2, ZERO
9D00D6F8  0B40565D   J .L95
9D00D6FC  0240A821   ADDU S5, S2, ZERO
9D00D730  0240A021   ADDU S4, S2, ZERO
1564:                         OPCODE_END
9D00D6EC  1D400004   BGTZ T2, 0x9D00D700
9D00D6F0  ACCB0054   SW T3, 84(A2)
9D00D700  26100002   ADDIU S0, S0, 2
9D00D720  91230000   LBU V1, 0(T1)
9D00D724  00036080   SLL T4, V1, 2
9D00D728  01966821   ADDU T5, T4, S6
9D00D72C  8DA50000   LW A1, 0(T5)
9D00D734  0B403272   J 0x9D00C9C8
9D00D738  0240A821   ADDU S5, S2, ZERO
1565:                
1566:                      OPCODE_BEGIN(16)  /* ASL $nn,X */
1567:                         ASL(6, ZP_IND_X, ZP_WRITEBYTE, baddr);
9D00D73C  26110001   ADDIU S1, S0, 1
9D00D75C  93270000   LBU A3, 0(T9)
9D00D760  03C75021   ADDU T2, FP, A3
9D00D764  314200FF   ANDI V0, T2, 255
9D00D768  8F8B80E4   LW T3, -32540(GP)
9D00D76C  0162F821   ADDU RA, T3, V0
9D00D770  93E40000   LBU A0, 0(RA)
9D00D774  0004B9C2   SRL S7, A0, 7
9D00D778  0004A840   SLL S5, A0, 1
9D00D77C  32B200FF   ANDI S2, S5, 255
9D00D780  A3F20000   SB S2, 0(RA)
9D00D784  8F8680E8   LW A2, -32536(GP)
9D00D788  24C8FFFA   ADDIU T0, A2, -6
9D00D78C  AF8880E8   SW T0, -32536(GP)
9D00D790  8DC90054   LW T1, 84(T6)
9D00D794  25230006   ADDIU V1, T1, 6
9D00D7A0  0B40565D   J .L95
9D00D7A4  0240A821   ADDU S5, S2, ZERO
1568:                         OPCODE_END
9D00D798  1D000003   BGTZ T0, 0x9D00D7A8
9D00D79C  ADC30054   SW V1, 84(T6)
9D00D7A8  26100002   ADDIU S0, S0, 2
9D00D7C8  93190000   LBU T9, 0(T8)
9D00D7CC  00193880   SLL A3, T9, 2
9D00D7D0  00F65021   ADDU T2, A3, S6
9D00D7D4  8D450000   LW A1, 0(T2)
9D00D7D8  0B403272   J 0x9D00C9C8
9D00D7DC  0240A821   ADDU S5, S2, ZERO
1569:                
1570:                      OPCODE_BEGIN(17)  /* SLO $nn,X */
1571:                         SLO(6, ZP_IND_X, ZP_WRITEBYTE, baddr);
9D00D7E0  26110001   ADDIU S1, S0, 1
9D00D800  92A60000   LBU A2, 0(S5)
9D00D804  03C64021   ADDU T0, FP, A2
9D00D808  310900FF   ANDI T1, T0, 255
9D00D80C  8F8380E4   LW V1, -32540(GP)
9D00D810  00696021   ADDU T4, V1, T1
9D00D814  918D0000   LBU T5, 0(T4)
9D00D818  000DB9C2   SRL S7, T5, 7
9D00D81C  000D7040   SLL T6, T5, 1
9D00D820  31C500FF   ANDI A1, T6, 255
9D00D824  A1850000   SB A1, 0(T4)
9D00D828  00B4A025   OR S4, A1, S4
9D00D82C  329200FF   ANDI S2, S4, 255
9D00D830  8F8F80E8   LW T7, -32536(GP)
9D00D834  25F8FFFA   ADDIU T8, T7, -6
9D00D838  AF9880E8   SW T8, -32536(GP)
9D00D83C  8C590054   LW T9, 84(V0)
9D00D840  27270006   ADDIU A3, T9, 6
9D00D84C  0240A021   ADDU S4, S2, ZERO
9D00D850  0B40565D   J .L95
9D00D854  0240A821   ADDU S5, S2, ZERO
9D00D888  0240A021   ADDU S4, S2, ZERO
1572:                         OPCODE_END
9D00D844  1F000004   BGTZ T8, 0x9D00D858
9D00D848  AC470054   SW A3, 84(V0)
9D00D858  26100002   ADDIU S0, S0, 2
9D00D878  92A60000   LBU A2, 0(S5)
9D00D87C  00064080   SLL T0, A2, 2
9D00D880  01164821   ADDU T1, T0, S6
9D00D884  8D250000   LW A1, 0(T1)
9D00D88C  0B403272   J 0x9D00C9C8
9D00D890  0240A821   ADDU S5, S2, ZERO
1573:                
1574:                      OPCODE_BEGIN(18)  /* CLC */
1575:                         CLC();
9D00D894  8F9780E8   LW S7, -32536(GP)
9D00D898  26ECFFFE   ADDIU T4, S7, -2
9D00D89C  AF8C80E8   SW T4, -32536(GP)
9D00D8A0  26633010   ADDIU V1, S3, 12304
9D00D8A4  8C6D0054   LW T5, 84(V1)
9D00D8A8  25AE0002   ADDIU T6, T5, 2
9D00D8B8  0B40565D   J .L95
9D00D8BC  0000B821   ADDU S7, ZERO, ZERO
1576:                         OPCODE_END
9D00D8AC  1D800004   BGTZ T4, .LBB842
9D00D8B0  AC6E0054   SW T6, 84(V1)
9D00D8B4  02008821   ADDU S1, S0, ZERO
9D00D8DC  91620000   LBU V0, 0(T3)
9D00D8E0  0002F880   SLL RA, V0, 2
9D00D8E4  03F68821   ADDU S1, RA, S6
9D00D8E8  8E250000   LW A1, 0(S1)
9D00D8EC  26100001   ADDIU S0, S0, 1
9D00D8F0  0B403272   J 0x9D00C9C8
9D00D8F4  0000B821   ADDU S7, ZERO, ZERO
1577:                
1578:                      OPCODE_BEGIN(19)  /* ORA $nnnn,Y */
1579:                         ORA(4, ABS_IND_Y_BYTE_READ);
9D00D8F8  0F4030A7   JAL bank_readword
9D00D8FC  02002021   ADDU A0, S0, ZERO
9D00D900  8FB20010   LW S2, 16(SP)
9D00D904  00522021   ADDU A0, V0, S2
9D00D908  3084FFFF   ANDI A0, A0, -1
9D00D90C  309500FF   ANDI S5, A0, 255
9D00D910  02B2302B   SLTU A2, S5, S2
9D00D914  10C00008   BEQ A2, ZERO, 0x9D00D938
9D00D918  26110002   ADDIU S1, S0, 2
9D00D91C  8F8880E8   LW T0, -32536(GP)
9D00D920  2509FFFF   ADDIU T1, T0, -1
9D00D924  AF8980E8   SW T1, -32536(GP)
9D00D928  266C3010   ADDIU T4, S3, 12304
9D00D92C  8D830054   LW V1, 84(T4)
9D00D930  246D0001   ADDIU T5, V1, 1
9D00D934  AD8D0054   SW T5, 84(T4)
9D00D938  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00D93C  00000000   NOP
9D00D940  0054A025   OR S4, V0, S4
9D00D944  329200FF   ANDI S2, S4, 255
9D00D948  8F8E80E8   LW T6, -32536(GP)
9D00D94C  25C5FFFC   ADDIU A1, T6, -4
9D00D950  AF8580E8   SW A1, -32536(GP)
9D00D954  266F3010   ADDIU T7, S3, 12304
9D00D958  8DF80054   LW T8, 84(T7)
9D00D95C  27190004   ADDIU T9, T8, 4
9D00D968  0240A021   ADDU S4, S2, ZERO
9D00D96C  0B40565D   J .L95
9D00D970  0240A821   ADDU S5, S2, ZERO
9D00D9A4  0240A021   ADDU S4, S2, ZERO
1580:                         OPCODE_END
9D00D960  1CA00004   BGTZ A1, 0x9D00D974
9D00D964  ADF90054   SW T9, 84(T7)
9D00D974  26100003   ADDIU S0, S0, 3
9D00D994  90950000   LBU S5, 0(A0)
9D00D998  00153080   SLL A2, S5, 2
9D00D99C  00D64021   ADDU T0, A2, S6
9D00D9A0  8D050000   LW A1, 0(T0)
9D00D9A8  0B403272   J 0x9D00C9C8
9D00D9AC  0240A821   ADDU S5, S2, ZERO
1581:                      
1582:                      OPCODE_BEGIN(1A)  /* NOP */
1583:                      OPCODE_BEGIN(3A)  /* NOP */
1584:                      OPCODE_BEGIN(5A)  /* NOP */
1585:                      OPCODE_BEGIN(7A)  /* NOP */
1586:                      OPCODE_BEGIN(DA)  /* NOP */
1587:                      OPCODE_BEGIN(FA)  /* NOP */
1588:                         NOP();
9D00D9B0  0B403675   J 0x9D00D9D4
9D00D9B4  8F8980E8   LW T1, -32536(GP)
9D00D9B8  0B403675   J 0x9D00D9D4
9D00D9BC  8F8980E8   LW T1, -32536(GP)
9D00D9C0  0B403675   J 0x9D00D9D4
9D00D9C4  8F8980E8   LW T1, -32536(GP)
9D00D9C8  0B403675   J 0x9D00D9D4
9D00D9CC  8F8980E8   LW T1, -32536(GP)
9D00D9D0  8F8980E8   LW T1, -32536(GP)
9D00D9D4  252CFFFE   ADDIU T4, T1, -2
9D00D9D8  AF8C80E8   SW T4, -32536(GP)
9D00D9DC  26633010   ADDIU V1, S3, 12304
9D00D9E0  8C6D0054   LW T5, 84(V1)
9D00D9E4  25AE0002   ADDIU T6, T5, 2
1589:                         OPCODE_END
9D00D9E8  1D800003   BGTZ T4, .LBB846
9D00D9EC  AC6E0054   SW T6, 84(V1)
9D00D9F0  0B40565D   J .L95
9D00D9F4  02008821   ADDU S1, S0, ZERO
9D00DA14  91620000   LBU V0, 0(T3)
9D00DA18  0002F880   SLL RA, V0, 2
9D00DA1C  03F68821   ADDU S1, RA, S6
9D00DA20  8E250000   LW A1, 0(S1)
9D00DA24  0B403272   J 0x9D00C9C8
9D00DA28  26100001   ADDIU S0, S0, 1
1590:                
1591:                      OPCODE_BEGIN(1B)  /* SLO $nnnn,Y */
1592:                         SLO(7, ABS_IND_Y, mem_writebyte, addr);
9D00DA2C  0F4030A7   JAL bank_readword
9D00DA30  02002021   ADDU A0, S0, ZERO
9D00DA34  26110002   ADDIU S1, S0, 2
9D00DA38  8FB70010   LW S7, 16(SP)
9D00DA3C  00579021   ADDU S2, V0, S7
9D00DA40  3255FFFF   ANDI S5, S2, -1
9D00DA44  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00DA48  02A02021   ADDU A0, S5, ZERO
9D00DA4C  7C5739C0   EXT S7, V0, 7, 8
9D00DA50  00022040   SLL A0, V0, 1
9D00DA54  309200FF   ANDI S2, A0, 255
9D00DA58  02A02021   ADDU A0, S5, ZERO
9D00DA5C  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00DA60  02402821   ADDU A1, S2, ZERO
9D00DA64  0254A025   OR S4, S2, S4
9D00DA68  329200FF   ANDI S2, S4, 255
9D00DA6C  8F8680E8   LW A2, -32536(GP)
9D00DA70  24C8FFF9   ADDIU T0, A2, -7
9D00DA74  AF8880E8   SW T0, -32536(GP)
9D00DA78  26693010   ADDIU T1, S3, 12304
9D00DA7C  8D2C0054   LW T4, 84(T1)
9D00DA80  25830007   ADDIU V1, T4, 7
9D00DA8C  0240A021   ADDU S4, S2, ZERO
9D00DA90  0B40565D   J .L95
9D00DA94  0240A821   ADDU S5, S2, ZERO
9D00DAC8  0240A021   ADDU S4, S2, ZERO
1593:                         OPCODE_END
9D00DA84  1D000004   BGTZ T0, 0x9D00DA98
9D00DA88  AD230054   SW V1, 84(T1)
9D00DA98  26100003   ADDIU S0, S0, 3
9D00DAB8  90EA0000   LBU T2, 0(A3)
9D00DABC  000A5880   SLL T3, T2, 2
9D00DAC0  01761021   ADDU V0, T3, S6
9D00DAC4  8C450000   LW A1, 0(V0)
9D00DACC  0B403272   J 0x9D00C9C8
9D00DAD0  0240A821   ADDU S5, S2, ZERO
1594:                
1595:                      OPCODE_BEGIN(1C)  /* NOP $nnnn,X */
1596:                      OPCODE_BEGIN(3C)  /* NOP $nnnn,X */
1597:                      OPCODE_BEGIN(5C)  /* NOP $nnnn,X */
1598:                      OPCODE_BEGIN(7C)  /* NOP $nnnn,X */
1599:                      OPCODE_BEGIN(DC)  /* NOP $nnnn,X */
1600:                      OPCODE_BEGIN(FC)  /* NOP $nnnn,X */
1601:                         TOP();
9D00DAD4  0B4036BE   J 0x9D00DAF8
9D00DAD8  26110002   ADDIU S1, S0, 2
9D00DADC  0B4036BE   J 0x9D00DAF8
9D00DAE0  26110002   ADDIU S1, S0, 2
9D00DAE4  0B4036BE   J 0x9D00DAF8
9D00DAE8  26110002   ADDIU S1, S0, 2
9D00DAEC  0B4036BE   J 0x9D00DAF8
9D00DAF0  26110002   ADDIU S1, S0, 2
9D00DAF4  26110002   ADDIU S1, S0, 2
9D00DAF8  8F9F80E8   LW RA, -32536(GP)
9D00DAFC  27E6FFFC   ADDIU A2, RA, -4
9D00DB00  AF8680E8   SW A2, -32536(GP)
9D00DB04  26683010   ADDIU T0, S3, 12304
9D00DB08  8D040054   LW A0, 84(T0)
9D00DB0C  24890004   ADDIU T1, A0, 4
1602:                         OPCODE_END
9D00DB10  18C01F98   BLEZ A2, .L95
9D00DB14  AD090054   SW T1, 84(T0)
9D00DB18  26100003   ADDIU S0, S0, 3
9D00DB38  91F80000   LBU T8, 0(T7)
9D00DB3C  0018C880   SLL T9, T8, 2
9D00DB40  03363821   ADDU A3, T9, S6
9D00DB44  0B403272   J 0x9D00C9C8
9D00DB48  8CE50000   LW A1, 0(A3)
1603:                
1604:                      OPCODE_BEGIN(1D)  /* ORA $nnnn,X */
1605:                         ORA(4, ABS_IND_X_BYTE_READ);
9D00DB4C  0F4030A7   JAL bank_readword
9D00DB50  02002021   ADDU A0, S0, ZERO
9D00DB54  005EA821   ADDU S5, V0, FP
9D00DB58  32A4FFFF   ANDI A0, S5, -1
9D00DB5C  309200FF   ANDI S2, A0, 255
9D00DB60  025E502B   SLTU T2, S2, FP
9D00DB64  11400008   BEQ T2, ZERO, 0x9D00DB88
9D00DB68  26110002   ADDIU S1, S0, 2
9D00DB6C  8F8B80E8   LW T3, -32536(GP)
9D00DB70  2562FFFF   ADDIU V0, T3, -1
9D00DB74  AF8280E8   SW V0, -32536(GP)
9D00DB78  267F3010   ADDIU RA, S3, 12304
9D00DB7C  8FE60054   LW A2, 84(RA)
9D00DB80  24C80001   ADDIU T0, A2, 1
9D00DB84  AFE80054   SW T0, 84(RA)
9D00DB88  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00DB8C  00000000   NOP
9D00DB90  0054A025   OR S4, V0, S4
9D00DB94  329200FF   ANDI S2, S4, 255
9D00DB98  8F8480E8   LW A0, -32536(GP)
9D00DB9C  2489FFFC   ADDIU T1, A0, -4
9D00DBA0  AF8980E8   SW T1, -32536(GP)
9D00DBA4  266C3010   ADDIU T4, S3, 12304
9D00DBA8  8D830054   LW V1, 84(T4)
9D00DBAC  246D0004   ADDIU T5, V1, 4
9D00DBB8  0240A021   ADDU S4, S2, ZERO
9D00DBBC  0B40565D   J .L95
9D00DBC0  0240A821   ADDU S5, S2, ZERO
9D00DBF4  0240A021   ADDU S4, S2, ZERO
1606:                         OPCODE_END
9D00DBB0  1D200004   BGTZ T1, 0x9D00DBC4
9D00DBB4  AD8D0054   SW T5, 84(T4)
9D00DBC4  26100003   ADDIU S0, S0, 3
9D00DBE4  90F50000   LBU S5, 0(A3)
9D00DBE8  00155080   SLL T2, S5, 2
9D00DBEC  01565821   ADDU T3, T2, S6
9D00DBF0  8D650000   LW A1, 0(T3)
9D00DBF8  0B403272   J 0x9D00C9C8
9D00DBFC  0240A821   ADDU S5, S2, ZERO
1607:                
1608:                      OPCODE_BEGIN(1E)  /* ASL $nnnn,X */
1609:                         ASL(7, ABS_IND_X, mem_writebyte, addr);
9D00DC00  0F4030A7   JAL bank_readword
9D00DC04  02002021   ADDU A0, S0, ZERO
9D00DC08  26110002   ADDIU S1, S0, 2
9D00DC0C  005EB821   ADDU S7, V0, FP
9D00DC10  32F5FFFF   ANDI S5, S7, -1
9D00DC14  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00DC18  02A02021   ADDU A0, S5, ZERO
9D00DC1C  7C5739C0   EXT S7, V0, 7, 8
9D00DC20  00029040   SLL S2, V0, 1
9D00DC24  325200FF   ANDI S2, S2, 255
9D00DC28  02A02021   ADDU A0, S5, ZERO
9D00DC2C  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00DC30  02402821   ADDU A1, S2, ZERO
9D00DC34  8F8280E8   LW V0, -32536(GP)
9D00DC38  2446FFF9   ADDIU A2, V0, -7
9D00DC3C  AF8680E8   SW A2, -32536(GP)
9D00DC40  26683010   ADDIU T0, S3, 12304
9D00DC44  8D040054   LW A0, 84(T0)
9D00DC48  24890007   ADDIU T1, A0, 7
9D00DC54  0B40565D   J .L95
9D00DC58  0240A821   ADDU S5, S2, ZERO
1610:                         OPCODE_END
9D00DC4C  1CC00003   BGTZ A2, 0x9D00DC5C
9D00DC50  AD090054   SW T1, 84(T0)
9D00DC5C  26100003   ADDIU S0, S0, 3
9D00DC7C  91F80000   LBU T8, 0(T7)
9D00DC80  00188880   SLL S1, T8, 2
9D00DC84  0236C821   ADDU T9, S1, S6
9D00DC88  8F250000   LW A1, 0(T9)
9D00DC8C  0B403272   J 0x9D00C9C8
9D00DC90  0240A821   ADDU S5, S2, ZERO
1611:                
1612:                      OPCODE_BEGIN(1F)  /* SLO $nnnn,X */
1613:                         SLO(7, ABS_IND_X, mem_writebyte, addr);
9D00DC94  0F4030A7   JAL bank_readword
9D00DC98  02002021   ADDU A0, S0, ZERO
9D00DC9C  26110002   ADDIU S1, S0, 2
9D00DCA0  005E3821   ADDU A3, V0, FP
9D00DCA4  30F5FFFF   ANDI S5, A3, -1
9D00DCA8  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00DCAC  02A02021   ADDU A0, S5, ZERO
9D00DCB0  7C5739C0   EXT S7, V0, 7, 8
9D00DCB4  00025040   SLL T2, V0, 1
9D00DCB8  315200FF   ANDI S2, T2, 255
9D00DCBC  02A02021   ADDU A0, S5, ZERO
9D00DCC0  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00DCC4  02402821   ADDU A1, S2, ZERO
9D00DCC8  0254A025   OR S4, S2, S4
9D00DCCC  329200FF   ANDI S2, S4, 255
9D00DCD0  8F8B80E8   LW T3, -32536(GP)
9D00DCD4  2562FFF9   ADDIU V0, T3, -7
9D00DCD8  AF8280E8   SW V0, -32536(GP)
9D00DCDC  26663010   ADDIU A2, S3, 12304
9D00DCE0  8CC80054   LW T0, 84(A2)
9D00DCE4  25040007   ADDIU A0, T0, 7
9D00DCF0  0240A021   ADDU S4, S2, ZERO
9D00DCF4  0B40565D   J .L95
9D00DCF8  0240A821   ADDU S5, S2, ZERO
9D00DD2C  0240A021   ADDU S4, S2, ZERO
1614:                         OPCODE_END
9D00DCE8  1C400004   BGTZ V0, 0x9D00DCFC
9D00DCEC  ACC40054   SW A0, 84(A2)
9D00DCFC  26100003   ADDIU S0, S0, 3
9D00DD1C  90AF0000   LBU T7, 0(A1)
9D00DD20  000FC080   SLL T8, T7, 2
9D00DD24  03168821   ADDU S1, T8, S6
9D00DD28  8E250000   LW A1, 0(S1)
9D00DD30  0B403272   J 0x9D00C9C8
9D00DD34  0240A821   ADDU S5, S2, ZERO
1615:                      
1616:                      OPCODE_BEGIN(20)  /* JSR $nnnn */
1617:                         JSR();
9D00DD38  26190001   ADDIU T9, S0, 1
9D00DD3C  8F8780E0   LW A3, -32544(GP)
9D00DD40  8FAA0018   LW T2, 24(SP)
9D00DD44  254BFFFF   ADDIU T3, T2, -1
9D00DD48  316200FF   ANDI V0, T3, 255
9D00DD4C  00EA4021   ADDU T0, A3, T2
9D00DD50  00193202   SRL A2, T9, 8
9D00DD54  A1060000   SB A2, 0(T0)
9D00DD58  8FA40018   LW A0, 24(SP)
9D00DD5C  2489FFFE   ADDIU T1, A0, -2
9D00DD60  313F00FF   ANDI RA, T1, 255
9D00DD64  AFBF0018   SW RA, 24(SP)
9D00DD68  00E26021   ADDU T4, A3, V0
9D00DD6C  A1990000   SB T9, 0(T4)
9D00DD70  0F4030A7   JAL bank_readword
9D00DD74  02002021   ADDU A0, S0, ZERO
9D00DD78  00408821   ADDU S1, V0, ZERO
9D00DD7C  8F9080E8   LW S0, -32536(GP)
9D00DD80  260DFFFA   ADDIU T5, S0, -6
9D00DD84  AF8D80E8   SW T5, -32536(GP)
9D00DD88  26633010   ADDIU V1, S3, 12304
9D00DD8C  8C6E0054   LW T6, 84(V1)
9D00DD90  25C50006   ADDIU A1, T6, 6
1618:                         OPCODE_END
9D00DD94  19A01EF7   BLEZ T5, .L95
9D00DD98  AC650054   SW A1, 84(V1)
9D00DD9C  24500001   ADDIU S0, V0, 1
9D00DDBC  91620000   LBU V0, 0(T3)
9D00DDC0  00024080   SLL T0, V0, 2
9D00DDC4  01163021   ADDU A2, T0, S6
9D00DDC8  0B403272   J 0x9D00C9C8
9D00DDCC  8CC50000   LW A1, 0(A2)
1619:                
1620:                      OPCODE_BEGIN(21)  /* AND ($nn,X) */
1621:                         AND(6, INDIR_X_BYTE);
9D00DDD0  26110001   ADDIU S1, S0, 1
9D00DDF0  918D0000   LBU T5, 0(T4)
9D00DDF4  03CD1821   ADDU V1, FP, T5
9D00DE04  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00DE08  95E40000   LHU A0, 0(T7)
9D00DE0C  0054A024   AND S4, V0, S4
9D00DE10  329200FF   ANDI S2, S4, 255
9D00DE14  8F9880E8   LW T8, -32536(GP)
9D00DE18  2719FFFA   ADDIU T9, T8, -6
9D00DE1C  AF9980E8   SW T9, -32536(GP)
9D00DE20  8EA70054   LW A3, 84(S5)
9D00DE24  24EA0006   ADDIU T2, A3, 6
9D00DE30  0240A021   ADDU S4, S2, ZERO
9D00DE34  0B40565D   J .L95
9D00DE38  0240A821   ADDU S5, S2, ZERO
9D00DE6C  0240A021   ADDU S4, S2, ZERO
1622:                         OPCODE_END
9D00DE28  1F200004   BGTZ T9, 0x9D00DE3C
9D00DE2C  AEAA0054   SW T2, 84(S5)
9D00DE3C  26100002   ADDIU S0, S0, 2
9D00DE5C  90890000   LBU T1, 0(A0)
9D00DE60  0009F880   SLL RA, T1, 2
9D00DE64  03F66021   ADDU T4, RA, S6
9D00DE68  8D850000   LW A1, 0(T4)
9D00DE70  0B403272   J 0x9D00C9C8
9D00DE74  0240A821   ADDU S5, S2, ZERO
1623:                
1624:                      OPCODE_BEGIN(23)  /* RLA ($nn,X) */
1625:                         RLA(8, INDIR_X, mem_writebyte, addr);
9D00DE78  26110001   ADDIU S1, S0, 1
9D00DE98  91F80000   LBU T8, 0(T7)
9D00DE9C  03D8C821   ADDU T9, FP, T8
9D00DEB4  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00DEB8  01002021   ADDU A0, T0, ZERO
9D00DEBC  7C4639C0   EXT A2, V0, 7, 8
9D00DEC0  AFA60030   SW A2, 48(SP)
9D00DEC4  00021040   SLL V0, V0, 1
9D00DEC8  0057B825   OR S7, V0, S7
9D00DECC  32F200FF   ANDI S2, S7, 255
9D00DED0  8FA4002C   LW A0, 44(SP)
9D00DED4  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00DED8  02402821   ADDU A1, S2, ZERO
9D00DEDC  02549024   AND S2, S2, S4
9D00DEE0  8F9480E8   LW S4, -32536(GP)
9D00DEE4  2684FFF8   ADDIU A0, S4, -8
9D00DEE8  AF8480E8   SW A0, -32536(GP)
9D00DEEC  8EA90054   LW T1, 84(S5)
9D00DEF0  252C0008   ADDIU T4, T1, 8
9D00DEFC  0240A021   ADDU S4, S2, ZERO
9D00DF00  8FB70030   LW S7, 48(SP)
9D00DF04  0B40565D   J .L95
9D00DF08  0240A821   ADDU S5, S2, ZERO
9D00DF3C  0240A021   ADDU S4, S2, ZERO
9D00DF40  8FB70030   LW S7, 48(SP)
1626:                         OPCODE_END
9D00DEF4  1C800005   BGTZ A0, 0x9D00DF0C
9D00DEF8  AEAC0054   SW T4, 84(S5)
9D00DF0C  26100002   ADDIU S0, S0, 2
9D00DF2C  90AF0000   LBU T7, 0(A1)
9D00DF30  000FC080   SLL T8, T7, 2
9D00DF34  0316C821   ADDU T9, T8, S6
9D00DF38  8F250000   LW A1, 0(T9)
9D00DF44  0B403272   J 0x9D00C9C8
9D00DF48  0240A821   ADDU S5, S2, ZERO
1627:                
1628:                      OPCODE_BEGIN(24)  /* BIT $nn */
1629:                         BIT(3, ZERO_PAGE_BYTE);
9D00DF4C  26110001   ADDIU S1, S0, 1
9D00DF6C  92490000   LBU T1, 0(S2)
9D00DF70  8F8480E4   LW A0, -32540(GP)
9D00DF74  00896021   ADDU T4, A0, T1
9D00DF78  91920000   LBU S2, 0(T4)
9D00DF7C  325F0040   ANDI RA, S2, 64
9D00DF80  33ED00FF   ANDI T5, RA, 255
9D00DF84  AFAD0014   SW T5, 20(SP)
9D00DF88  0254A824   AND S5, S2, S4
9D00DF8C  8F8380E8   LW V1, -32536(GP)
9D00DF90  246EFFFD   ADDIU T6, V1, -3
9D00DF94  AF8E80E8   SW T6, -32536(GP)
9D00DF98  8D650054   LW A1, 84(T3)
9D00DF9C  24AF0003   ADDIU T7, A1, 3
1630:                         OPCODE_END
9D00DFA0  19C01E74   BLEZ T6, .L95
9D00DFA4  AD6F0054   SW T7, 84(T3)
9D00DFA8  26100002   ADDIU S0, S0, 2
9D00DFC4  91680000   LBU T0, 0(T3)
9D00DFC8  00083080   SLL A2, T0, 2
9D00DFCC  00D61021   ADDU V0, A2, S6
9D00DFD0  0B403272   J 0x9D00C9C8
9D00DFD4  8C450000   LW A1, 0(V0)
1631:                
1632:                      OPCODE_BEGIN(25)  /* AND $nn */
1633:                         AND(3, ZERO_PAGE_BYTE);
9D00DFD8  26110001   ADDIU S1, S0, 1
9D00DFF8  91A30000   LBU V1, 0(T5)
9D00DFFC  8F8E80E4   LW T6, -32540(GP)
9D00E000  01C32821   ADDU A1, T6, V1
9D00E004  90AF0000   LBU T7, 0(A1)
9D00E008  028F9024   AND S2, S4, T7
9D00E00C  8F9480E8   LW S4, -32536(GP)
9D00E010  2698FFFD   ADDIU T8, S4, -3
9D00E014  AF9880E8   SW T8, -32536(GP)
9D00E018  8D390054   LW T9, 84(T1)
9D00E01C  27270003   ADDIU A3, T9, 3
9D00E028  0240A021   ADDU S4, S2, ZERO
9D00E02C  0B40565D   J .L95
9D00E030  0240A821   ADDU S5, S2, ZERO
9D00E064  0240A021   ADDU S4, S2, ZERO
1634:                         OPCODE_END
9D00E020  1F000004   BGTZ T8, 0x9D00E034
9D00E024  AD270054   SW A3, 84(T1)
9D00E034  26100002   ADDIU S0, S0, 2
9D00E054  92A90000   LBU T1, 0(S5)
9D00E058  00092080   SLL A0, T1, 2
9D00E05C  00966021   ADDU T4, A0, S6
9D00E060  8D850000   LW A1, 0(T4)
9D00E068  0B403272   J 0x9D00C9C8
9D00E06C  0240A821   ADDU S5, S2, ZERO
1635:                
1636:                      OPCODE_BEGIN(26)  /* ROL $nn */
1637:                         ROL(5, ZERO_PAGE, ZP_WRITEBYTE, baddr);
9D00E070  26110001   ADDIU S1, S0, 1
9D00E090  91F80000   LBU T8, 0(T7)
9D00E094  8F9980E4   LW T9, -32540(GP)
9D00E098  03383821   ADDU A3, T9, T8
9D00E09C  90EA0000   LBU T2, 0(A3)
9D00E0A0  000A59C2   SRL T3, T2, 7
9D00E0A4  000A4040   SLL T0, T2, 1
9D00E0A8  0117B825   OR S7, T0, S7
9D00E0AC  32F200FF   ANDI S2, S7, 255
9D00E0B0  A0F20000   SB S2, 0(A3)
9D00E0B4  8F8680E8   LW A2, -32536(GP)
9D00E0B8  24C2FFFB   ADDIU V0, A2, -5
9D00E0BC  AF8280E8   SW V0, -32536(GP)
9D00E0C0  8DB50054   LW S5, 84(T5)
9D00E0C4  26A90005   ADDIU T1, S5, 5
9D00E0D0  0160B821   ADDU S7, T3, ZERO
9D00E0D4  0B40565D   J .L95
9D00E0D8  0240A821   ADDU S5, S2, ZERO
9D00E10C  0160B821   ADDU S7, T3, ZERO
1638:                         OPCODE_END
9D00E0C8  1C400004   BGTZ V0, 0x9D00E0DC
9D00E0CC  ADA90054   SW T1, 84(T5)
9D00E0DC  26100002   ADDIU S0, S0, 2
9D00E0FC  90650000   LBU A1, 0(V1)
9D00E100  00057880   SLL T7, A1, 2
9D00E104  01F6C021   ADDU T8, T7, S6
9D00E108  8F050000   LW A1, 0(T8)
9D00E110  0B403272   J 0x9D00C9C8
9D00E114  0240A821   ADDU S5, S2, ZERO
1639:                
1640:                      OPCODE_BEGIN(27)  /* RLA $nn */
1641:                         RLA(5, ZERO_PAGE, ZP_WRITEBYTE, baddr);
9D00E118  26110001   ADDIU S1, S0, 1
9D00E138  90C20000   LBU V0, 0(A2)
9D00E13C  8F9580E4   LW S5, -32540(GP)
9D00E140  02A24821   ADDU T1, S5, V0
9D00E144  91240000   LBU A0, 0(T1)
9D00E148  000461C2   SRL T4, A0, 7
9D00E14C  0004F840   SLL RA, A0, 1
9D00E150  03F7B825   OR S7, RA, S7
9D00E154  32ED00FF   ANDI T5, S7, 255
9D00E158  A12D0000   SB T5, 0(T1)
9D00E15C  01B49024   AND S2, T5, S4
9D00E160  8F9480E8   LW S4, -32536(GP)
9D00E164  268EFFFB   ADDIU T6, S4, -5
9D00E168  AF8E80E8   SW T6, -32536(GP)
9D00E16C  8CE30054   LW V1, 84(A3)
9D00E170  24650005   ADDIU A1, V1, 5
9D00E17C  0240A021   ADDU S4, S2, ZERO
9D00E180  0180B821   ADDU S7, T4, ZERO
9D00E184  0B40565D   J .L95
9D00E188  0240A821   ADDU S5, S2, ZERO
9D00E1BC  0240A021   ADDU S4, S2, ZERO
9D00E1C0  0180B821   ADDU S7, T4, ZERO
1642:                         OPCODE_END
9D00E174  1DC00005   BGTZ T6, 0x9D00E18C
9D00E178  ACE50054   SW A1, 84(A3)
9D00E18C  26100002   ADDIU S0, S0, 2
9D00E1AC  91680000   LBU T0, 0(T3)
9D00E1B0  00083080   SLL A2, T0, 2
9D00E1B4  00D61021   ADDU V0, A2, S6
9D00E1B8  8C450000   LW A1, 0(V0)
9D00E1C4  0B403272   J 0x9D00C9C8
9D00E1C8  0240A821   ADDU S5, S2, ZERO
1643:                
1644:                      OPCODE_BEGIN(28)  /* PLP */
1645:                         PLP();
9D00E1CC  8FB20018   LW S2, 24(SP)
9D00E1D0  26550001   ADDIU S5, S2, 1
9D00E1D4  32A900FF   ANDI T1, S5, 255
9D00E1D8  AFA90018   SW T1, 24(SP)
9D00E1DC  8F8480E0   LW A0, -32544(GP)
9D00E1E0  8FAC0018   LW T4, 24(SP)
9D00E1E4  008CF821   ADDU RA, A0, T4
9D00E1E8  93F70000   LBU S7, 0(RA)
9D00E1EC  32F20080   ANDI S2, S7, 128
9D00E1F0  32ED0040   ANDI T5, S7, 64
9D00E1F4  31AE00FF   ANDI T6, T5, 255
9D00E1F8  AFAE0014   SW T6, 20(SP)
9D00E1FC  32E30010   ANDI V1, S7, 16
9D00E200  306500FF   ANDI A1, V1, 255
9D00E204  AFA50028   SW A1, 40(SP)
9D00E208  32EF0008   ANDI T7, S7, 8
9D00E20C  31F800FF   ANDI T8, T7, 255
9D00E210  AFB80020   SW T8, 32(SP)
9D00E214  32F90004   ANDI T9, S7, 4
9D00E218  332700FF   ANDI A3, T9, 255
9D00E21C  AFA7001C   SW A3, 28(SP)
9D00E220  3AF10002   XORI S1, S7, 2
9D00E224  7E350040   EXT S5, S1, 1, 1
9D00E228  32F70001   ANDI S7, S7, 1
9D00E22C  8F8A80E8   LW T2, -32536(GP)
9D00E230  254BFFFC   ADDIU T3, T2, -4
9D00E234  AF8B80E8   SW T3, -32536(GP)
9D00E238  26683010   ADDIU T0, S3, 12304
9D00E23C  8D060054   LW A2, 84(T0)
9D00E240  24C20004   ADDIU V0, A2, 4
1646:                         OPCODE_END
9D00E244  1D600003   BGTZ T3, .LBB888
9D00E248  AD020054   SW V0, 84(T0)
9D00E24C  0B40565D   J .L95
9D00E250  02008821   ADDU S1, S0, ZERO
9D00E270  90650000   LBU A1, 0(V1)
9D00E274  00057880   SLL T7, A1, 2
9D00E278  01F6C021   ADDU T8, T7, S6
9D00E27C  8F050000   LW A1, 0(T8)
9D00E280  0B403272   J 0x9D00C9C8
9D00E284  26100001   ADDIU S0, S0, 1
1647:                
1648:                      OPCODE_BEGIN(29)  /* AND #$nn */
1649:                         AND(2, IMMEDIATE_BYTE);
9D00E288  26110001   ADDIU S1, S0, 1
9D00E2A8  91060000   LBU A2, 0(T0)
9D00E2AC  02869024   AND S2, S4, A2
9D00E2B0  8F9480E8   LW S4, -32536(GP)
9D00E2B4  2682FFFE   ADDIU V0, S4, -2
9D00E2B8  AF8280E8   SW V0, -32536(GP)
9D00E2BC  8F290054   LW T1, 84(T9)
9D00E2C0  25240002   ADDIU A0, T1, 2
9D00E2CC  0240A021   ADDU S4, S2, ZERO
9D00E2D0  0B40565D   J .L95
9D00E2D4  0240A821   ADDU S5, S2, ZERO
9D00E308  0240A021   ADDU S4, S2, ZERO
1650:                         OPCODE_END
9D00E2C4  1C400004   BGTZ V0, 0x9D00E2D8
9D00E2C8  AF240054   SW A0, 84(T9)
9D00E2D8  26100002   ADDIU S0, S0, 2
9D00E2F8  90AF0000   LBU T7, 0(A1)
9D00E2FC  000FC080   SLL T8, T7, 2
9D00E300  0316A821   ADDU S5, T8, S6
9D00E304  8EA50000   LW A1, 0(S5)
9D00E30C  0B403272   J 0x9D00C9C8
9D00E310  0240A821   ADDU S5, S2, ZERO
1651:                
1652:                      OPCODE_BEGIN(2A)  /* ROL A */
1653:                         ROL_A();
9D00E314  7E9939C0   EXT T9, S4, 7, 8
9D00E318  00149040   SLL S2, S4, 1
9D00E31C  0257B825   OR S7, S2, S7
9D00E320  32F200FF   ANDI S2, S7, 255
9D00E324  8F8780E8   LW A3, -32536(GP)
9D00E328  24EAFFFE   ADDIU T2, A3, -2
9D00E32C  AF8A80E8   SW T2, -32536(GP)
9D00E330  266B3010   ADDIU T3, S3, 12304
9D00E334  8D680054   LW T0, 84(T3)
9D00E338  25060002   ADDIU A2, T0, 2
9D00E344  0240A021   ADDU S4, S2, ZERO
9D00E34C  0320B821   ADDU S7, T9, ZERO
9D00E350  0B40565D   J .L95
9D00E354  0240A821   ADDU S5, S2, ZERO
9D00E384  0240A021   ADDU S4, S2, ZERO
9D00E38C  0320B821   ADDU S7, T9, ZERO
1654:                         OPCODE_END
9D00E33C  1D400006   BGTZ T2, .LBB894
9D00E340  AD660054   SW A2, 84(T3)
9D00E348  02008821   ADDU S1, S0, ZERO
9D00E374  91AE0000   LBU T6, 0(T5)
9D00E378  000E8880   SLL S1, T6, 2
9D00E37C  02361821   ADDU V1, S1, S6
9D00E380  8C650000   LW A1, 0(V1)
9D00E388  26100001   ADDIU S0, S0, 1
9D00E390  0B403272   J 0x9D00C9C8
9D00E394  0240A821   ADDU S5, S2, ZERO
1655:                
1656:                      OPCODE_BEGIN(2B)  /* ANC #$nn */
1657:                         ANC(2, IMMEDIATE_BYTE);
9D00E398  26110001   ADDIU S1, S0, 1
9D00E3B8  90EA0000   LBU T2, 0(A3)
9D00E3BC  028AA824   AND S5, S4, T2
9D00E3C0  7E5739C0   EXT S7, S2, 7, 8
9D00E3C4  8F9280E8   LW S2, -32536(GP)
9D00E3C8  264BFFFE   ADDIU T3, S2, -2
9D00E3CC  AF8B80E8   SW T3, -32536(GP)
9D00E3D0  8F080054   LW T0, 84(T8)
9D00E3D4  25060002   ADDIU A2, T0, 2
9D00E3E0  02A0A021   ADDU S4, S5, ZERO
9D00E3E4  0B40565D   J .L95
9D00E3E8  02A09021   ADDU S2, S5, ZERO
9D00E41C  02A0A021   ADDU S4, S5, ZERO
1658:                         OPCODE_END
9D00E3D8  1D600004   BGTZ T3, 0x9D00E3EC
9D00E3DC  AF060054   SW A2, 84(T8)
9D00E3EC  26100002   ADDIU S0, S0, 2
9D00E40C  91AE0000   LBU T6, 0(T5)
9D00E410  000E8880   SLL S1, T6, 2
9D00E414  02361821   ADDU V1, S1, S6
9D00E418  8C650000   LW A1, 0(V1)
9D00E420  0B403272   J 0x9D00C9C8
9D00E424  02A09021   ADDU S2, S5, ZERO
1659:                
1660:                      OPCODE_BEGIN(2C)  /* BIT $nnnn */
1661:                         BIT(4, ABSOLUTE_BYTE);
9D00E428  0F4030A7   JAL bank_readword
9D00E42C  02002021   ADDU A0, S0, ZERO
9D00E430  26110002   ADDIU S1, S0, 2
9D00E434  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00E438  00402021   ADDU A0, V0, ZERO
9D00E43C  00409021   ADDU S2, V0, ZERO
9D00E440  30450040   ANDI A1, V0, 64
9D00E444  30AF00FF   ANDI T7, A1, 255
9D00E448  AFAF0014   SW T7, 20(SP)
9D00E44C  0054C024   AND T8, V0, S4
9D00E450  331500FF   ANDI S5, T8, 255
9D00E454  8F9980E8   LW T9, -32536(GP)
9D00E458  2727FFFC   ADDIU A3, T9, -4
9D00E45C  AF8780E8   SW A3, -32536(GP)
9D00E460  266A3010   ADDIU T2, S3, 12304
9D00E464  8D4B0054   LW T3, 84(T2)
9D00E468  25680004   ADDIU T0, T3, 4
1662:                         OPCODE_END
9D00E46C  18E01D41   BLEZ A3, .L95
9D00E470  AD480054   SW T0, 84(T2)
9D00E474  26100003   ADDIU S0, S0, 3
9D00E494  91AE0000   LBU T6, 0(T5)
9D00E498  000E8880   SLL S1, T6, 2
9D00E49C  02361821   ADDU V1, S1, S6
9D00E4A0  0B403272   J 0x9D00C9C8
9D00E4A4  8C650000   LW A1, 0(V1)
1663:                
1664:                      OPCODE_BEGIN(2D)  /* AND $nnnn */
1665:                         AND(4, ABSOLUTE_BYTE);
9D00E4A8  0F4030A7   JAL bank_readword
9D00E4AC  02002021   ADDU A0, S0, ZERO
9D00E4B0  26110002   ADDIU S1, S0, 2
9D00E4B4  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00E4B8  00402021   ADDU A0, V0, ZERO
9D00E4BC  0054A824   AND S5, V0, S4
9D00E4C0  32B200FF   ANDI S2, S5, 255
9D00E4C4  8F9480E8   LW S4, -32536(GP)
9D00E4C8  2685FFFC   ADDIU A1, S4, -4
9D00E4CC  AF8580E8   SW A1, -32536(GP)
9D00E4D0  266F3010   ADDIU T7, S3, 12304
9D00E4D4  8DF80054   LW T8, 84(T7)
9D00E4D8  27190004   ADDIU T9, T8, 4
9D00E4E4  0240A021   ADDU S4, S2, ZERO
9D00E4E8  0B40565D   J .L95
9D00E4EC  0240A821   ADDU S5, S2, ZERO
9D00E520  0240A021   ADDU S4, S2, ZERO
1666:                         OPCODE_END
9D00E4DC  1CA00004   BGTZ A1, 0x9D00E4F0
9D00E4E0  ADF90054   SW T9, 84(T7)
9D00E4F0  26100003   ADDIU S0, S0, 3
9D00E510  90440000   LBU A0, 0(V0)
9D00E514  00046080   SLL T4, A0, 2
9D00E518  0196F821   ADDU RA, T4, S6
9D00E51C  8FE50000   LW A1, 0(RA)
9D00E524  0B403272   J 0x9D00C9C8
9D00E528  0240A821   ADDU S5, S2, ZERO
1667:                
1668:                      OPCODE_BEGIN(2E)  /* ROL $nnnn */
1669:                         ROL(6, ABSOLUTE, mem_writebyte, addr);
9D00E52C  0F4030A7   JAL bank_readword
9D00E530  02002021   ADDU A0, S0, ZERO
9D00E534  0040A821   ADDU S5, V0, ZERO
9D00E538  26110002   ADDIU S1, S0, 2
9D00E53C  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00E540  00402021   ADDU A0, V0, ZERO
9D00E544  7C5239C0   EXT S2, V0, 7, 8
9D00E548  AFB2002C   SW S2, 44(SP)
9D00E54C  00026840   SLL T5, V0, 1
9D00E550  01B7B825   OR S7, T5, S7
9D00E554  32F200FF   ANDI S2, S7, 255
9D00E558  02A02021   ADDU A0, S5, ZERO
9D00E55C  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00E560  02402821   ADDU A1, S2, ZERO
9D00E564  8F8E80E8   LW T6, -32536(GP)
9D00E568  25C5FFFA   ADDIU A1, T6, -6
9D00E56C  AF8580E8   SW A1, -32536(GP)
9D00E570  26633010   ADDIU V1, S3, 12304
9D00E574  8C6F0054   LW T7, 84(V1)
9D00E578  25F80006   ADDIU T8, T7, 6
9D00E584  8FB7002C   LW S7, 44(SP)
9D00E588  0B40565D   J .L95
9D00E58C  0240A821   ADDU S5, S2, ZERO
9D00E5C0  8FB7002C   LW S7, 44(SP)
1670:                         OPCODE_END
9D00E57C  1CA00004   BGTZ A1, 0x9D00E590
9D00E580  AC780054   SW T8, 84(V1)
9D00E590  26100003   ADDIU S0, S0, 3
9D00E5B0  90C90000   LBU T1, 0(A2)
9D00E5B4  00091080   SLL V0, T1, 2
9D00E5B8  00562021   ADDU A0, V0, S6
9D00E5BC  8C850000   LW A1, 0(A0)
9D00E5C4  0B403272   J 0x9D00C9C8
9D00E5C8  0240A821   ADDU S5, S2, ZERO
1671:                
1672:                      OPCODE_BEGIN(2F)  /* RLA $nnnn */
1673:                         RLA(6, ABSOLUTE, mem_writebyte, addr);
9D00E5CC  0F4030A7   JAL bank_readword
9D00E5D0  02002021   ADDU A0, S0, ZERO
9D00E5D4  0040A821   ADDU S5, V0, ZERO
9D00E5D8  26110002   ADDIU S1, S0, 2
9D00E5DC  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00E5E0  00402021   ADDU A0, V0, ZERO
9D00E5E4  7C4C39C0   EXT T4, V0, 7, 8
9D00E5E8  AFAC002C   SW T4, 44(SP)
9D00E5EC  00029040   SLL S2, V0, 1
9D00E5F0  02576825   OR T5, S2, S7
9D00E5F4  31B700FF   ANDI S7, T5, 255
9D00E5F8  02A02021   ADDU A0, S5, ZERO
9D00E5FC  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00E600  02E02821   ADDU A1, S7, ZERO
9D00E604  02F49024   AND S2, S7, S4
9D00E608  8F9480E8   LW S4, -32536(GP)
9D00E60C  268EFFFA   ADDIU T6, S4, -6
9D00E610  AF8E80E8   SW T6, -32536(GP)
9D00E614  26653010   ADDIU A1, S3, 12304
9D00E618  8CA30054   LW V1, 84(A1)
9D00E61C  246F0006   ADDIU T7, V1, 6
9D00E628  0240A021   ADDU S4, S2, ZERO
9D00E62C  8FB7002C   LW S7, 44(SP)
9D00E630  0B40565D   J .L95
9D00E634  0240A821   ADDU S5, S2, ZERO
9D00E668  0240A021   ADDU S4, S2, ZERO
9D00E66C  8FB7002C   LW S7, 44(SP)
1674:                         OPCODE_END
9D00E620  1DC00005   BGTZ T6, 0x9D00E638
9D00E624  ACAF0054   SW T7, 84(A1)
9D00E638  26100003   ADDIU S0, S0, 3
9D00E658  92280000   LBU T0, 0(S1)
9D00E65C  00083080   SLL A2, T0, 2
9D00E660  00D64821   ADDU T1, A2, S6
9D00E664  8D250000   LW A1, 0(T1)
9D00E670  0B403272   J 0x9D00C9C8
9D00E674  0240A821   ADDU S5, S2, ZERO
1675:                
1676:                      OPCODE_BEGIN(30)  /* BMI $nnnn */
1677:                         BMI();
9D00E678  7C121420   SEB V0, S2
9D00E67C  0441001F   BGEZ V0, 0x9D00E6FC
9D00E680  26110001   ADDIU S1, S0, 1
9D00E684  26050001   ADDIU A1, S0, 1
9D00E6A4  814B0000   LB T3, 0(T2)
9D00E6A8  30B100FF   ANDI S1, A1, 255
9D00E6AC  01714021   ADDU T0, T3, S1
9D00E6B0  31060100   ANDI A2, T0, 256
9D00E6B4  10C00009   BEQ A2, ZERO, 0x9D00E6DC
9D00E6B8  8F8D80E8   LW T5, -32536(GP)
9D00E6BC  8F8980E8   LW T1, -32536(GP)
9D00E6C0  2522FFFF   ADDIU V0, T1, -1
9D00E6C4  AF8280E8   SW V0, -32536(GP)
9D00E6C8  26703010   ADDIU S0, S3, 12304
9D00E6CC  8E040054   LW A0, 84(S0)
9D00E6D0  248C0001   ADDIU T4, A0, 1
9D00E6D4  AE0C0054   SW T4, 84(S0)
9D00E6D8  8F8D80E8   LW T5, -32536(GP)
9D00E6DC  25AEFFFD   ADDIU T6, T5, -3
9D00E6E0  AF8E80E8   SW T6, -32536(GP)
9D00E6E4  26633010   ADDIU V1, S3, 12304
9D00E6E8  8C6F0054   LW T7, 84(V1)
9D00E6EC  25FF0003   ADDIU RA, T7, 3
9D00E6F0  AC7F0054   SW RA, 84(V1)
9D00E6F4  0B4039C6   J 0x9D00E718
9D00E6F8  01658821   ADDU S1, T3, A1
9D00E6FC  8F9080E8   LW S0, -32536(GP)
9D00E700  2604FFFE   ADDIU A0, S0, -2
9D00E704  AF8480E8   SW A0, -32536(GP)
9D00E708  266C3010   ADDIU T4, S3, 12304
9D00E70C  8D8D0054   LW T5, 84(T4)
9D00E710  25AE0002   ADDIU T6, T5, 2
9D00E714  AD8E0054   SW T6, 84(T4)
1678:                         OPCODE_END
9D00E718  8F8580E8   LW A1, -32536(GP)
9D00E71C  18A01C95   BLEZ A1, .L95
9D00E720  26300001   ADDIU S0, S1, 1
9D00E740  91060000   LBU A2, 0(T0)
9D00E744  00064880   SLL T1, A2, 2
9D00E748  01361021   ADDU V0, T1, S6
9D00E74C  0B403272   J 0x9D00C9C8
9D00E750  8C450000   LW A1, 0(V0)
1679:                
1680:                      OPCODE_BEGIN(31)  /* AND ($nn),Y */
1681:                         AND(5, INDIR_Y_BYTE_READ);
9D00E780  8FB90010   LW T9, 16(SP)
9D00E784  03193821   ADDU A3, T8, T9
9D00E788  30E4FFFF   ANDI A0, A3, -1
9D00E78C  308A00FF   ANDI T2, A0, 255
9D00E790  0159582B   SLTU T3, T2, T9
9D00E794  11600008   BEQ T3, ZERO, 0x9D00E7B8
9D00E798  26110001   ADDIU S1, S0, 1
9D00E79C  8F8880E8   LW T0, -32536(GP)
9D00E7A0  2506FFFF   ADDIU A2, T0, -1
9D00E7A4  AF8680E8   SW A2, -32536(GP)
9D00E7A8  26693010   ADDIU T1, S3, 12304
9D00E7AC  8D220054   LW V0, 84(T1)
9D00E7B0  24550001   ADDIU S5, V0, 1
9D00E7B4  AD350054   SW S5, 84(T1)
9D00E7B8  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00E7BC  00000000   NOP
9D00E7C0  0054A024   AND S4, V0, S4
9D00E7C4  329200FF   ANDI S2, S4, 255
9D00E7C8  8F8480E8   LW A0, -32536(GP)
9D00E7CC  248CFFFB   ADDIU T4, A0, -5
9D00E7D0  AF8C80E8   SW T4, -32536(GP)
9D00E7D4  266D3010   ADDIU T5, S3, 12304
9D00E7D8  8DAE0054   LW T6, 84(T5)
9D00E7DC  25C30005   ADDIU V1, T6, 5
9D00E7E8  0240A021   ADDU S4, S2, ZERO
9D00E7EC  0B40565D   J .L95
9D00E7F0  0240A821   ADDU S5, S2, ZERO
9D00E824  0240A021   ADDU S4, S2, ZERO
1682:                         OPCODE_END
9D00E7E0  1D800004   BGTZ T4, 0x9D00E7F4
9D00E7E4  ADA30054   SW V1, 84(T5)
9D00E7F4  26100002   ADDIU S0, S0, 2
9D00E814  90EA0000   LBU T2, 0(A3)
9D00E818  000A5880   SLL T3, T2, 2
9D00E81C  01764021   ADDU T0, T3, S6
9D00E820  8D050000   LW A1, 0(T0)
9D00E828  0B403272   J 0x9D00C9C8
9D00E82C  0240A821   ADDU S5, S2, ZERO
1683:                
1684:                      OPCODE_BEGIN(33)  /* RLA ($nn),Y */
1685:                         RLA(8, INDIR_Y, mem_writebyte, addr);
9D00E830  26110001   ADDIU S1, S0, 1
9D00E860  8FBF0010   LW RA, 16(SP)
9D00E864  01FF2821   ADDU A1, T7, RA
9D00E868  30B8FFFF   ANDI T8, A1, -1
9D00E86C  AFB8002C   SW T8, 44(SP)
9D00E870  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00E874  03002021   ADDU A0, T8, ZERO
9D00E878  7C5939C0   EXT T9, V0, 7, 8
9D00E87C  AFB90030   SW T9, 48(SP)
9D00E880  00023840   SLL A3, V0, 1
9D00E884  00F7B825   OR S7, A3, S7
9D00E888  32F200FF   ANDI S2, S7, 255
9D00E88C  8FA4002C   LW A0, 44(SP)
9D00E890  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00E894  02402821   ADDU A1, S2, ZERO
9D00E898  02549024   AND S2, S2, S4
9D00E89C  8F9480E8   LW S4, -32536(GP)
9D00E8A0  268AFFF8   ADDIU T2, S4, -8
9D00E8A4  AF8A80E8   SW T2, -32536(GP)
9D00E8A8  8EAB0054   LW T3, 84(S5)
9D00E8AC  25680008   ADDIU T0, T3, 8
9D00E8B8  0240A021   ADDU S4, S2, ZERO
9D00E8BC  8FB70030   LW S7, 48(SP)
9D00E8C0  0B40565D   J .L95
9D00E8C4  0240A821   ADDU S5, S2, ZERO
9D00E8F8  0240A021   ADDU S4, S2, ZERO
9D00E8FC  8FB70030   LW S7, 48(SP)
1686:                         OPCODE_END
9D00E8B0  1D400005   BGTZ T2, 0x9D00E8C8
9D00E8B4  AEA80054   SW T0, 84(S5)
9D00E8C8  26100002   ADDIU S0, S0, 2
9D00E8E8  918D0000   LBU T5, 0(T4)
9D00E8EC  000D7080   SLL T6, T5, 2
9D00E8F0  01D61821   ADDU V1, T6, S6
9D00E8F4  8C650000   LW A1, 0(V1)
9D00E900  0B403272   J 0x9D00C9C8
9D00E904  0240A821   ADDU S5, S2, ZERO
1687:                
1688:                      OPCODE_BEGIN(35)  /* AND $nn,X */
1689:                         AND(4, ZP_IND_X_BYTE);
9D00E908  26110001   ADDIU S1, S0, 1
9D00E928  924A0000   LBU T2, 0(S2)
9D00E92C  03CA5821   ADDU T3, FP, T2
9D00E930  316800FF   ANDI T0, T3, 255
9D00E934  8F8680E4   LW A2, -32540(GP)
9D00E938  00C8A821   ADDU S5, A2, T0
9D00E93C  92A90000   LBU T1, 0(S5)
9D00E940  01349024   AND S2, T1, S4
9D00E944  8F9480E8   LW S4, -32536(GP)
9D00E948  2682FFFC   ADDIU V0, S4, -4
9D00E94C  AF8280E8   SW V0, -32536(GP)
9D00E950  8CA40054   LW A0, 84(A1)
9D00E954  248C0004   ADDIU T4, A0, 4
9D00E960  0240A021   ADDU S4, S2, ZERO
9D00E964  0B40565D   J .L95
9D00E968  0240A821   ADDU S5, S2, ZERO
9D00E99C  0240A021   ADDU S4, S2, ZERO
1690:                         OPCODE_END
9D00E958  1C400004   BGTZ V0, 0x9D00E96C
9D00E95C  ACAC0054   SW T4, 84(A1)
9D00E96C  26100002   ADDIU S0, S0, 2
9D00E98C  90B80000   LBU T8, 0(A1)
9D00E990  0018C880   SLL T9, T8, 2
9D00E994  03363821   ADDU A3, T9, S6
9D00E998  8CE50000   LW A1, 0(A3)
9D00E9A0  0B403272   J 0x9D00C9C8
9D00E9A4  0240A821   ADDU S5, S2, ZERO
1691:                
1692:                      OPCODE_BEGIN(36)  /* ROL $nn,X */
1693:                         ROL(6, ZP_IND_X, ZP_WRITEBYTE, baddr);
9D00E9A8  26110001   ADDIU S1, S0, 1
9D00E9C8  91220000   LBU V0, 0(T1)
9D00E9CC  03C22021   ADDU A0, FP, V0
9D00E9D0  308C00FF   ANDI T4, A0, 255
9D00E9D4  8F8D80E4   LW T5, -32540(GP)
9D00E9D8  01AC7021   ADDU T6, T5, T4
9D00E9DC  91C30000   LBU V1, 0(T6)
9D00E9E0  000379C2   SRL T7, V1, 7
9D00E9E4  0003F840   SLL RA, V1, 1
9D00E9E8  03F7B825   OR S7, RA, S7
9D00E9EC  32F200FF   ANDI S2, S7, 255
9D00E9F0  A1D20000   SB S2, 0(T6)
9D00E9F4  8F8580E8   LW A1, -32536(GP)
9D00E9F8  24B8FFFA   ADDIU T8, A1, -6
9D00E9FC  AF9880E8   SW T8, -32536(GP)
9D00EA00  8D790054   LW T9, 84(T3)
9D00EA04  27270006   ADDIU A3, T9, 6
9D00EA10  01E0B821   ADDU S7, T7, ZERO
9D00EA14  0B40565D   J .L95
9D00EA18  0240A821   ADDU S5, S2, ZERO
9D00EA4C  01E0B821   ADDU S7, T7, ZERO
1694:                         OPCODE_END
9D00EA08  1F000004   BGTZ T8, 0x9D00EA1C
9D00EA0C  AD670054   SW A3, 84(T3)
9D00EA1C  26100002   ADDIU S0, S0, 2
9D00EA3C  91220000   LBU V0, 0(T1)
9D00EA40  00022080   SLL A0, V0, 2
9D00EA44  00966021   ADDU T4, A0, S6
9D00EA48  8D850000   LW A1, 0(T4)
9D00EA50  0B403272   J 0x9D00C9C8
9D00EA54  0240A821   ADDU S5, S2, ZERO
1695:                
1696:                      OPCODE_BEGIN(37)  /* RLA $nn,X */
1697:                         RLA(6, ZP_IND_X, ZP_WRITEBYTE, baddr);
9D00EA58  26110001   ADDIU S1, S0, 1
9D00EA78  90B80000   LBU T8, 0(A1)
9D00EA7C  03D8C821   ADDU T9, FP, T8
9D00EA80  332700FF   ANDI A3, T9, 255
9D00EA84  8F8A80E4   LW T2, -32540(GP)
9D00EA88  01475821   ADDU T3, T2, A3
9D00EA8C  91680000   LBU T0, 0(T3)
9D00EA90  000831C2   SRL A2, T0, 7
9D00EA94  0008A840   SLL S5, T0, 1
9D00EA98  02B7B825   OR S7, S5, S7
9D00EA9C  32E900FF   ANDI T1, S7, 255
9D00EAA0  A1690000   SB T1, 0(T3)
9D00EAA4  01349024   AND S2, T1, S4
9D00EAA8  8F9480E8   LW S4, -32536(GP)
9D00EAAC  2682FFFA   ADDIU V0, S4, -6
9D00EAB0  AF8280E8   SW V0, -32536(GP)
9D00EAB4  8DC40054   LW A0, 84(T6)
9D00EAB8  248C0006   ADDIU T4, A0, 6
9D00EAC4  0240A021   ADDU S4, S2, ZERO
9D00EAC8  00C0B821   ADDU S7, A2, ZERO
9D00EACC  0B40565D   J .L95
9D00EAD0  0240A821   ADDU S5, S2, ZERO
9D00EB04  0240A021   ADDU S4, S2, ZERO
9D00EB08  00C0B821   ADDU S7, A2, ZERO
1698:                         OPCODE_END
9D00EABC  1C400005   BGTZ V0, 0x9D00EAD4
9D00EAC0  ADCC0054   SW T4, 84(T6)
9D00EAD4  26100002   ADDIU S0, S0, 2
9D00EAF4  90B80000   LBU T8, 0(A1)
9D00EAF8  0018C880   SLL T9, T8, 2
9D00EAFC  03363821   ADDU A3, T9, S6
9D00EB00  8CE50000   LW A1, 0(A3)
9D00EB0C  0B403272   J 0x9D00C9C8
9D00EB10  0240A821   ADDU S5, S2, ZERO
1699:                
1700:                      OPCODE_BEGIN(38)  /* SEC */
1701:                         SEC();
9D00EB14  8F8A80E8   LW T2, -32536(GP)
9D00EB18  254BFFFE   ADDIU T3, T2, -2
9D00EB1C  AF8B80E8   SW T3, -32536(GP)
9D00EB20  26683010   ADDIU T0, S3, 12304
9D00EB24  8D060054   LW A2, 84(T0)
9D00EB28  24D70002   ADDIU S7, A2, 2
9D00EB38  0B40565D   J .L95
9D00EB3C  24170001   ADDIU S7, ZERO, 1
1702:                         OPCODE_END
9D00EB2C  1D600004   BGTZ T3, .LBB936
9D00EB30  AD170054   SW S7, 84(T0)
9D00EB34  02008821   ADDU S1, S0, ZERO
9D00EB5C  91E30000   LBU V1, 0(T7)
9D00EB60  00038880   SLL S1, V1, 2
9D00EB64  0236F821   ADDU RA, S1, S6
9D00EB68  8FE50000   LW A1, 0(RA)
9D00EB6C  26100001   ADDIU S0, S0, 1
9D00EB70  0B403272   J 0x9D00C9C8
9D00EB74  24170001   ADDIU S7, ZERO, 1
1703:                
1704:                      OPCODE_BEGIN(39)  /* AND $nnnn,Y */
1705:                         AND(4, ABS_IND_Y_BYTE_READ);
9D00EB78  0F4030A7   JAL bank_readword
9D00EB7C  02002021   ADDU A0, S0, ZERO
9D00EB80  8FB20010   LW S2, 16(SP)
9D00EB84  0052A821   ADDU S5, V0, S2
9D00EB88  32A4FFFF   ANDI A0, S5, -1
9D00EB8C  308500FF   ANDI A1, A0, 255
9D00EB90  00B2C02B   SLTU T8, A1, S2
9D00EB94  13000008   BEQ T8, ZERO, 0x9D00EBB8
9D00EB98  26110002   ADDIU S1, S0, 2
9D00EB9C  8F9980E8   LW T9, -32536(GP)
9D00EBA0  2727FFFF   ADDIU A3, T9, -1
9D00EBA4  AF8780E8   SW A3, -32536(GP)
9D00EBA8  266A3010   ADDIU T2, S3, 12304
9D00EBAC  8D4B0054   LW T3, 84(T2)
9D00EBB0  25680001   ADDIU T0, T3, 1
9D00EBB4  AD480054   SW T0, 84(T2)
9D00EBB8  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00EBBC  00000000   NOP
9D00EBC0  0054A024   AND S4, V0, S4
9D00EBC4  329200FF   ANDI S2, S4, 255
9D00EBC8  8F8680E8   LW A2, -32536(GP)
9D00EBCC  24C9FFFC   ADDIU T1, A2, -4
9D00EBD0  AF8980E8   SW T1, -32536(GP)
9D00EBD4  26623010   ADDIU V0, S3, 12304
9D00EBD8  8C440054   LW A0, 84(V0)
9D00EBDC  248C0004   ADDIU T4, A0, 4
9D00EBE8  0240A021   ADDU S4, S2, ZERO
9D00EBEC  0B40565D   J .L95
9D00EBF0  0240A821   ADDU S5, S2, ZERO
9D00EC24  0240A021   ADDU S4, S2, ZERO
1706:                         OPCODE_END
9D00EBE0  1D200004   BGTZ T1, 0x9D00EBF4
9D00EBE4  AC4C0054   SW T4, 84(V0)
9D00EBF4  26100003   ADDIU S0, S0, 3
9D00EC14  92A50000   LBU A1, 0(S5)
9D00EC18  0005C080   SLL T8, A1, 2
9D00EC1C  0316C821   ADDU T9, T8, S6
9D00EC20  8F250000   LW A1, 0(T9)
9D00EC28  0B403272   J 0x9D00C9C8
9D00EC2C  0240A821   ADDU S5, S2, ZERO
1707:                
1708:                      OPCODE_BEGIN(3B)  /* RLA $nnnn,Y */
1709:                         RLA(7, ABS_IND_Y, mem_writebyte, addr);
9D00EC30  0F4030A7   JAL bank_readword
9D00EC34  02002021   ADDU A0, S0, ZERO
9D00EC38  26110002   ADDIU S1, S0, 2
9D00EC3C  8FB20010   LW S2, 16(SP)
9D00EC40  00523821   ADDU A3, V0, S2
9D00EC44  30F5FFFF   ANDI S5, A3, -1
9D00EC48  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00EC4C  02A02021   ADDU A0, S5, ZERO
9D00EC50  7C4A39C0   EXT T2, V0, 7, 8
9D00EC54  AFAA002C   SW T2, 44(SP)
9D00EC58  00025840   SLL T3, V0, 1
9D00EC5C  0177B825   OR S7, T3, S7
9D00EC60  32F200FF   ANDI S2, S7, 255
9D00EC64  02A02021   ADDU A0, S5, ZERO
9D00EC68  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00EC6C  02402821   ADDU A1, S2, ZERO
9D00EC70  02549024   AND S2, S2, S4
9D00EC74  8F8880E8   LW T0, -32536(GP)
9D00EC78  2514FFF9   ADDIU S4, T0, -7
9D00EC7C  AF9480E8   SW S4, -32536(GP)
9D00EC80  26663010   ADDIU A2, S3, 12304
9D00EC84  8CC90054   LW T1, 84(A2)
9D00EC88  25220007   ADDIU V0, T1, 7
9D00EC94  0240A021   ADDU S4, S2, ZERO
9D00EC98  8FB7002C   LW S7, 44(SP)
9D00EC9C  0B40565D   J .L95
9D00ECA0  0240A821   ADDU S5, S2, ZERO
9D00ECD4  0240A021   ADDU S4, S2, ZERO
9D00ECD8  8FB7002C   LW S7, 44(SP)
1710:                         OPCODE_END
9D00EC8C  1E800005   BGTZ S4, 0x9D00ECA4
9D00EC90  ACC20054   SW V0, 84(A2)
9D00ECA4  26100003   ADDIU S0, S0, 3
9D00ECC4  923F0000   LBU RA, 0(S1)
9D00ECC8  001F2880   SLL A1, RA, 2
9D00ECCC  00B6C021   ADDU T8, A1, S6
9D00ECD0  8F050000   LW A1, 0(T8)
9D00ECDC  0B403272   J 0x9D00C9C8
9D00ECE0  0240A821   ADDU S5, S2, ZERO
1711:                
1712:                      OPCODE_BEGIN(3D)  /* AND $nnnn,X */
1713:                         AND(4, ABS_IND_X_BYTE_READ);
9D00ECE4  0F4030A7   JAL bank_readword
9D00ECE8  02002021   ADDU A0, S0, ZERO
9D00ECEC  005EC821   ADDU T9, V0, FP
9D00ECF0  3324FFFF   ANDI A0, T9, -1
9D00ECF4  308700FF   ANDI A3, A0, 255
9D00ECF8  00FEA82B   SLTU S5, A3, FP
9D00ECFC  12A00008   BEQ S5, ZERO, 0x9D00ED20
9D00ED00  26110002   ADDIU S1, S0, 2
9D00ED04  8F8A80E8   LW T2, -32536(GP)
9D00ED08  254BFFFF   ADDIU T3, T2, -1
9D00ED0C  AF8B80E8   SW T3, -32536(GP)
9D00ED10  26723010   ADDIU S2, S3, 12304
9D00ED14  8E480054   LW T0, 84(S2)
9D00ED18  25060001   ADDIU A2, T0, 1
9D00ED1C  AE460054   SW A2, 84(S2)
9D00ED20  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00ED24  00000000   NOP
9D00ED28  0054A024   AND S4, V0, S4
9D00ED2C  329200FF   ANDI S2, S4, 255
9D00ED30  8F8980E8   LW T1, -32536(GP)
9D00ED34  2522FFFC   ADDIU V0, T1, -4
9D00ED38  AF8280E8   SW V0, -32536(GP)
9D00ED3C  266C3010   ADDIU T4, S3, 12304
9D00ED40  8D840054   LW A0, 84(T4)
9D00ED44  248D0004   ADDIU T5, A0, 4
9D00ED50  0240A021   ADDU S4, S2, ZERO
9D00ED54  0B40565D   J .L95
9D00ED58  0240A821   ADDU S5, S2, ZERO
9D00ED8C  0240A021   ADDU S4, S2, ZERO
1714:                         OPCODE_END
9D00ED48  1C400004   BGTZ V0, 0x9D00ED5C
9D00ED4C  AD8D0054   SW T5, 84(T4)
9D00ED5C  26100003   ADDIU S0, S0, 3
9D00ED7C  93190000   LBU T9, 0(T8)
9D00ED80  00193880   SLL A3, T9, 2
9D00ED84  00F6A821   ADDU S5, A3, S6
9D00ED88  8EA50000   LW A1, 0(S5)
9D00ED90  0B403272   J 0x9D00C9C8
9D00ED94  0240A821   ADDU S5, S2, ZERO
1715:                
1716:                      OPCODE_BEGIN(3E)  /* ROL $nnnn,X */
1717:                         ROL(7, ABS_IND_X, mem_writebyte, addr);
9D00ED98  0F4030A7   JAL bank_readword
9D00ED9C  02002021   ADDU A0, S0, ZERO
9D00EDA0  26110002   ADDIU S1, S0, 2
9D00EDA4  005E5021   ADDU T2, V0, FP
9D00EDA8  3155FFFF   ANDI S5, T2, -1
9D00EDAC  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00EDB0  02A02021   ADDU A0, S5, ZERO
9D00EDB4  7C4B39C0   EXT T3, V0, 7, 8
9D00EDB8  AFAB002C   SW T3, 44(SP)
9D00EDBC  00029040   SLL S2, V0, 1
9D00EDC0  0257B825   OR S7, S2, S7
9D00EDC4  32F200FF   ANDI S2, S7, 255
9D00EDC8  02A02021   ADDU A0, S5, ZERO
9D00EDCC  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00EDD0  02402821   ADDU A1, S2, ZERO
9D00EDD4  8F8880E8   LW T0, -32536(GP)
9D00EDD8  2506FFF9   ADDIU A2, T0, -7
9D00EDDC  AF8680E8   SW A2, -32536(GP)
9D00EDE0  26693010   ADDIU T1, S3, 12304
9D00EDE4  8D220054   LW V0, 84(T1)
9D00EDE8  244C0007   ADDIU T4, V0, 7
9D00EDF4  8FB7002C   LW S7, 44(SP)
9D00EDF8  0B40565D   J .L95
9D00EDFC  0240A821   ADDU S5, S2, ZERO
9D00EE30  8FB7002C   LW S7, 44(SP)
1718:                         OPCODE_END
9D00EDEC  1CC00004   BGTZ A2, 0x9D00EE00
9D00EDF0  AD2C0054   SW T4, 84(T1)
9D00EE00  26100003   ADDIU S0, S0, 3
9D00EE20  92250000   LBU A1, 0(S1)
9D00EE24  0005C080   SLL T8, A1, 2
9D00EE28  0316C821   ADDU T9, T8, S6
9D00EE2C  8F250000   LW A1, 0(T9)
9D00EE34  0B403272   J 0x9D00C9C8
9D00EE38  0240A821   ADDU S5, S2, ZERO
1719:                
1720:                      OPCODE_BEGIN(3F)  /* RLA $nnnn,X */
1721:                         RLA(7, ABS_IND_X, mem_writebyte, addr);
9D00EE3C  0F4030A7   JAL bank_readword
9D00EE40  02002021   ADDU A0, S0, ZERO
9D00EE44  26110002   ADDIU S1, S0, 2
9D00EE48  005E3821   ADDU A3, V0, FP
9D00EE4C  30F5FFFF   ANDI S5, A3, -1
9D00EE50  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00EE54  02A02021   ADDU A0, S5, ZERO
9D00EE58  7C4A39C0   EXT T2, V0, 7, 8
9D00EE5C  AFAA002C   SW T2, 44(SP)
9D00EE60  00025840   SLL T3, V0, 1
9D00EE64  01779025   OR S2, T3, S7
9D00EE68  325700FF   ANDI S7, S2, 255
9D00EE6C  02A02021   ADDU A0, S5, ZERO
9D00EE70  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00EE74  02E02821   ADDU A1, S7, ZERO
9D00EE78  02F49024   AND S2, S7, S4
9D00EE7C  8F9480E8   LW S4, -32536(GP)
9D00EE80  2688FFF9   ADDIU T0, S4, -7
9D00EE84  AF8880E8   SW T0, -32536(GP)
9D00EE88  26663010   ADDIU A2, S3, 12304
9D00EE8C  8CC90054   LW T1, 84(A2)
9D00EE90  25220007   ADDIU V0, T1, 7
9D00EE9C  0240A021   ADDU S4, S2, ZERO
9D00EEA0  8FB7002C   LW S7, 44(SP)
9D00EEA4  0B40565D   J .L95
9D00EEA8  0240A821   ADDU S5, S2, ZERO
9D00EEDC  0240A021   ADDU S4, S2, ZERO
9D00EEE0  8FB7002C   LW S7, 44(SP)
1722:                         OPCODE_END
9D00EE94  1D000005   BGTZ T0, 0x9D00EEAC
9D00EE98  ACC20054   SW V0, 84(A2)
9D00EEAC  26100003   ADDIU S0, S0, 3
9D00EECC  93F10000   LBU S1, 0(RA)
9D00EED0  00112880   SLL A1, S1, 2
9D00EED4  00B6C021   ADDU T8, A1, S6
9D00EED8  8F050000   LW A1, 0(T8)
9D00EEE4  0B403272   J 0x9D00C9C8
9D00EEE8  0240A821   ADDU S5, S2, ZERO
1723:                
1724:                      OPCODE_BEGIN(40)  /* RTI */
1725:                         RTI();
9D00EEEC  8F9080E0   LW S0, -32544(GP)
9D00EEF0  8FB90018   LW T9, 24(SP)
9D00EEF4  27270001   ADDIU A3, T9, 1
9D00EEF8  30F500FF   ANDI S5, A3, 255
9D00EEFC  02155021   ADDU T2, S0, S5
9D00EF00  914B0000   LBU T3, 0(T2)
9D00EF04  31720080   ANDI S2, T3, 128
9D00EF08  31770040   ANDI S7, T3, 64
9D00EF0C  32E800FF   ANDI T0, S7, 255
9D00EF10  AFA80014   SW T0, 20(SP)
9D00EF14  31660010   ANDI A2, T3, 16
9D00EF18  30C900FF   ANDI T1, A2, 255
9D00EF1C  AFA90028   SW T1, 40(SP)
9D00EF20  31620008   ANDI V0, T3, 8
9D00EF24  304C00FF   ANDI T4, V0, 255
9D00EF28  AFAC0020   SW T4, 32(SP)
9D00EF2C  31640004   ANDI A0, T3, 4
9D00EF30  308D00FF   ANDI T5, A0, 255
9D00EF34  AFAD001C   SW T5, 28(SP)
9D00EF38  396E0002   XORI T6, T3, 2
9D00EF3C  7DD50040   EXT S5, T6, 1, 1
9D00EF40  31770001   ANDI S7, T3, 1
9D00EF44  272F0002   ADDIU T7, T9, 2
9D00EF48  31E300FF   ANDI V1, T7, 255
9D00EF4C  0203F821   ADDU RA, S0, V1
9D00EF50  93E50000   LBU A1, 0(RA)
9D00EF54  8FB10018   LW S1, 24(SP)
9D00EF58  26380003   ADDIU T8, S1, 3
9D00EF5C  330D00FF   ANDI T5, T8, 255
9D00EF60  020DC821   ADDU T9, S0, T5
9D00EF64  93300000   LBU S0, 0(T9)
9D00EF68  00103A00   SLL A3, S0, 8
9D00EF6C  8F9080E8   LW S0, -32536(GP)
9D00EF70  260BFFFA   ADDIU T3, S0, -6
9D00EF74  AF8B80E8   SW T3, -32536(GP)
9D00EF78  26663010   ADDIU A2, S3, 12304
9D00EF7C  8CC80054   LW T0, 84(A2)
9D00EF80  AFA8002C   SW T0, 44(SP)
9D00EF84  25090006   ADDIU T1, T0, 6
9D00EF88  ACC90054   SW T1, 84(A2)
9D00EF8C  8FA2001C   LW V0, 28(SP)
9D00EF90  14400024   BNE V0, ZERO, 0x9D00F024
9D00EF94  00E58825   OR S1, A3, A1
9D00EF98  90CC0052   LBU T4, 82(A2)
9D00EF9C  11800022   BEQ T4, ZERO, 0x9D00F028
9D00EFA0  8F8C80E8   LW T4, -32536(GP)
9D00EFA4  19600020   BLEZ T3, 0x9D00F028
9D00EFA8  26643010   ADDIU A0, S3, 12304
9D00EFAC  A0800052   SB ZERO, 82(A0)
9D00EFB0  00116A02   SRL T5, S1, 8
9D00EFB4  A32D0000   SB T5, 0(T9)
9D00EFB8  A3F10000   SB S1, 0(RA)
9D00EFBC  240EFF80   ADDIU T6, ZERO, -128
9D00EFC0  024E7824   AND T7, S2, T6
9D00EFC4  7C0FFC20   SEB RA, T7
9D00EFC8  24030002   ADDIU V1, ZERO, 2
9D00EFCC  0015180B   MOVN V1, ZERO, S5
9D00EFD0  36E50020   ORI A1, S7, 32
9D00EFD4  03E58825   OR S1, RA, A1
9D00EFD8  8FB80014   LW T8, 20(SP)
9D00EFDC  0311C825   OR T9, T8, S1
9D00EFE0  8FA70020   LW A3, 32(SP)
9D00EFE4  00F95825   OR T3, A3, T9
9D00EFE8  006B3025   OR A2, V1, T3
9D00EFEC  A1460000   SB A2, 0(T2)
9D00EFF0  0F4030A7   JAL bank_readword
9D00EFF4  3404FFFE   ORI A0, ZERO, -2
9D00EFF8  00408821   ADDU S1, V0, ZERO
9D00EFFC  260AFFF3   ADDIU T2, S0, -13
9D00F000  AF8A80E8   SW T2, -32536(GP)
9D00F004  26703010   ADDIU S0, S3, 12304
9D00F008  8FA8002C   LW T0, 44(SP)
9D00F00C  2509000D   ADDIU T1, T0, 13
9D00F010  AE090054   SW T1, 84(S0)
9D00F014  8FAD0018   LW T5, 24(SP)
9D00F018  24020001   ADDIU V0, ZERO, 1
9D00F01C  AFA2001C   SW V0, 28(SP)
9D00F020  AFA00028   SW ZERO, 40(SP)
1726:                         OPCODE_END
9D00F024  8F8C80E8   LW T4, -32536(GP)
9D00F028  1D800003   BGTZ T4, .LBB948
9D00F02C  26300001   ADDIU S0, S1, 1
9D00F030  0B40565D   J .L95
9D00F034  AFAD0018   SW T5, 24(SP)
9D00F054  92380000   LBU T8, 0(S1)
9D00F058  0018C880   SLL T9, T8, 2
9D00F05C  03363821   ADDU A3, T9, S6
9D00F060  8CE50000   LW A1, 0(A3)
9D00F064  0B403272   J 0x9D00C9C8
9D00F068  AFAD0018   SW T5, 24(SP)
1727:                
1728:                      OPCODE_BEGIN(41)  /* EOR ($nn,X) */
1729:                         EOR(6, INDIR_X_BYTE);
9D00F06C  26110001   ADDIU S1, S0, 1
9D00F08C  912D0000   LBU T5, 0(T1)
9D00F090  03CD1021   ADDU V0, FP, T5
9D00F0A0  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00F0A4  95C40000   LHU A0, 0(T6)
9D00F0A8  0054A026   XOR S4, V0, S4
9D00F0AC  329200FF   ANDI S2, S4, 255
9D00F0B0  8F8F80E8   LW T7, -32536(GP)
9D00F0B4  25E5FFFA   ADDIU A1, T7, -6
9D00F0B8  AF8580E8   SW A1, -32536(GP)
9D00F0BC  8EA30054   LW V1, 84(S5)
9D00F0C0  24780006   ADDIU T8, V1, 6
9D00F0CC  0240A021   ADDU S4, S2, ZERO
9D00F0D0  0B40565D   J .L95
9D00F0D4  0240A821   ADDU S5, S2, ZERO
9D00F108  0240A021   ADDU S4, S2, ZERO
1730:                         OPCODE_END
9D00F0C4  1CA00004   BGTZ A1, 0x9D00F0D8
9D00F0C8  AEB80054   SW T8, 84(S5)
9D00F0D8  26100002   ADDIU S0, S0, 2
9D00F0F8  90CA0000   LBU T2, 0(A2)
9D00F0FC  000A4080   SLL T0, T2, 2
9D00F100  01164821   ADDU T1, T0, S6
9D00F104  8D250000   LW A1, 0(T1)
9D00F10C  0B403272   J 0x9D00C9C8
9D00F110  0240A821   ADDU S5, S2, ZERO
1731:                
1732:                      OPCODE_BEGIN(43)  /* SRE ($nn,X) */
1733:                         SRE(8, INDIR_X, mem_writebyte, addr);
9D00F130  908E0000   LBU T6, 0(A0)
9D00F134  03CE7821   ADDU T7, FP, T6
9D00F14C  03E02021   ADDU A0, RA, ZERO
9D00F150  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00F154  26110001   ADDIU S1, S0, 1
9D00F158  30570001   ANDI S7, V0, 1
9D00F15C  7C523840   EXT S2, V0, 1, 8
9D00F160  8FA4002C   LW A0, 44(SP)
9D00F164  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00F168  02402821   ADDU A1, S2, ZERO
9D00F16C  0254A026   XOR S4, S2, S4
9D00F170  329200FF   ANDI S2, S4, 255
9D00F174  8F9980E8   LW T9, -32536(GP)
9D00F178  2727FFF8   ADDIU A3, T9, -8
9D00F17C  AF8780E8   SW A3, -32536(GP)
9D00F180  8EAB0054   LW T3, 84(S5)
9D00F184  25660008   ADDIU A2, T3, 8
9D00F190  0240A021   ADDU S4, S2, ZERO
9D00F194  0B40565D   J .L95
9D00F198  0240A821   ADDU S5, S2, ZERO
9D00F1CC  0240A021   ADDU S4, S2, ZERO
1734:                         OPCODE_END
9D00F188  1CE00004   BGTZ A3, 0x9D00F19C
9D00F18C  AEA60054   SW A2, 84(S5)
9D00F19C  26100002   ADDIU S0, S0, 2
9D00F1BC  904C0000   LBU T4, 0(V0)
9D00F1C0  000C2080   SLL A0, T4, 2
9D00F1C4  00967021   ADDU T6, A0, S6
9D00F1C8  8DC50000   LW A1, 0(T6)
9D00F1D0  0B403272   J 0x9D00C9C8
9D00F1D4  0240A821   ADDU S5, S2, ZERO
1735:                
1736:                      OPCODE_BEGIN(45)  /* EOR $nn */
1737:                         EOR(3, ZERO_PAGE_BYTE);
9D00F1D8  26110001   ADDIU S1, S0, 1
9D00F1F8  93270000   LBU A3, 0(T9)
9D00F1FC  8F8B80E4   LW T3, -32540(GP)
9D00F200  01673021   ADDU A2, T3, A3
9D00F204  90CA0000   LBU T2, 0(A2)
9D00F208  028AA026   XOR S4, S4, T2
9D00F20C  329200FF   ANDI S2, S4, 255
9D00F210  8F8880E8   LW T0, -32536(GP)
9D00F214  2509FFFD   ADDIU T1, T0, -3
9D00F218  AF8980E8   SW T1, -32536(GP)
9D00F21C  8F150054   LW S5, 84(T8)
9D00F220  26AD0003   ADDIU T5, S5, 3
9D00F22C  0240A021   ADDU S4, S2, ZERO
9D00F230  0B40565D   J .L95
9D00F234  0240A821   ADDU S5, S2, ZERO
9D00F268  0240A021   ADDU S4, S2, ZERO
1738:                         OPCODE_END
9D00F224  1D200004   BGTZ T1, 0x9D00F238
9D00F228  AF0D0054   SW T5, 84(T8)
9D00F238  26100002   ADDIU S0, S0, 2
9D00F258  90B80000   LBU T8, 0(A1)
9D00F25C  0018F880   SLL RA, T8, 2
9D00F260  03F61821   ADDU V1, RA, S6
9D00F264  8C650000   LW A1, 0(V1)
9D00F26C  0B403272   J 0x9D00C9C8
9D00F270  0240A821   ADDU S5, S2, ZERO
1739:                
1740:                      OPCODE_BEGIN(46)  /* LSR $nn */
1741:                         LSR(5, ZERO_PAGE, ZP_WRITEBYTE, baddr);
9D00F274  26110001   ADDIU S1, S0, 1
9D00F294  91480000   LBU T0, 0(T2)
9D00F298  8F8980E4   LW T1, -32540(GP)
9D00F29C  0128A821   ADDU S5, T1, T0
9D00F2A0  92AD0000   LBU T5, 0(S5)
9D00F2A4  31B70001   ANDI S7, T5, 1
9D00F2A8  000D9042   SRL S2, T5, 1
9D00F2AC  A2B20000   SB S2, 0(S5)
9D00F2B0  8F8280E8   LW V0, -32536(GP)
9D00F2B4  244CFFFB   ADDIU T4, V0, -5
9D00F2B8  AF8C80E8   SW T4, -32536(GP)
9D00F2BC  8F240054   LW A0, 84(T9)
9D00F2C0  248E0005   ADDIU T6, A0, 5
9D00F2CC  0B40565D   J .L95
9D00F2D0  0240A821   ADDU S5, S2, ZERO
1742:                         OPCODE_END
9D00F2C4  1D800003   BGTZ T4, 0x9D00F2D4
9D00F2C8  AF2E0054   SW T6, 84(T9)
9D00F2D4  26100002   ADDIU S0, S0, 2
9D00F2F4  93270000   LBU A3, 0(T9)
9D00F2F8  00075880   SLL T3, A3, 2
9D00F2FC  01763021   ADDU A2, T3, S6
9D00F300  8CC50000   LW A1, 0(A2)
9D00F304  0B403272   J 0x9D00C9C8
9D00F308  0240A821   ADDU S5, S2, ZERO
1743:                
1744:                      OPCODE_BEGIN(47)  /* SRE $nn */
1745:                         SRE(5, ZERO_PAGE, ZP_WRITEBYTE, baddr);
9D00F30C  26110001   ADDIU S1, S0, 1
9D00F32C  91A20000   LBU V0, 0(T5)
9D00F330  8F8C80E4   LW T4, -32540(GP)
9D00F334  01822021   ADDU A0, T4, V0
9D00F338  908E0000   LBU T6, 0(A0)
9D00F33C  31D70001   ANDI S7, T6, 1
9D00F340  000E7842   SRL T7, T6, 1
9D00F344  A08F0000   SB T7, 0(A0)
9D00F348  01F4A026   XOR S4, T7, S4
9D00F34C  329200FF   ANDI S2, S4, 255
9D00F350  8F8580E8   LW A1, -32536(GP)
9D00F354  24B8FFFB   ADDIU T8, A1, -5
9D00F358  AF9880E8   SW T8, -32536(GP)
9D00F35C  8D5F0054   LW RA, 84(T2)
9D00F360  27E30005   ADDIU V1, RA, 5
9D00F36C  0240A021   ADDU S4, S2, ZERO
9D00F370  0B40565D   J .L95
9D00F374  0240A821   ADDU S5, S2, ZERO
9D00F3A8  0240A021   ADDU S4, S2, ZERO
1746:                         OPCODE_END
9D00F364  1F000004   BGTZ T8, 0x9D00F378
9D00F368  AD430054   SW V1, 84(T2)
9D00F378  26100002   ADDIU S0, S0, 2
9D00F398  91090000   LBU T1, 0(T0)
9D00F39C  0009A880   SLL S5, T1, 2
9D00F3A0  02B66821   ADDU T5, S5, S6
9D00F3A4  8DA50000   LW A1, 0(T5)
9D00F3AC  0B403272   J 0x9D00C9C8
9D00F3B0  0240A821   ADDU S5, S2, ZERO
1747:                
1748:                      OPCODE_BEGIN(48)  /* PHA */
1749:                         PHA();
9D00F3B4  8FAC0018   LW T4, 24(SP)
9D00F3B8  2582FFFF   ADDIU V0, T4, -1
9D00F3BC  304400FF   ANDI A0, V0, 255
9D00F3C0  8F8E80E0   LW T6, -32544(GP)
9D00F3C4  01CC7821   ADDU T7, T6, T4
9D00F3C8  A1F40000   SB S4, 0(T7)
9D00F3CC  8F8580E8   LW A1, -32536(GP)
9D00F3D0  24B8FFFD   ADDIU T8, A1, -3
9D00F3D4  AF9880E8   SW T8, -32536(GP)
9D00F3D8  267F3010   ADDIU RA, S3, 12304
9D00F3DC  8FE30054   LW V1, 84(RA)
9D00F3E0  24790003   ADDIU T9, V1, 3
9D00F3EC  AFA40018   SW A0, 24(SP)
9D00F424  AFA40018   SW A0, 24(SP)
1750:                         OPCODE_END
9D00F3E4  1F000004   BGTZ T8, .LBB974
9D00F3E8  AFF90054   SW T9, 84(RA)
9D00F3F0  0B40565D   J .L95
9D00F3F4  02008821   ADDU S1, S0, ZERO
9D00F414  912D0000   LBU T5, 0(T1)
9D00F418  000D6080   SLL T4, T5, 2
9D00F41C  01961021   ADDU V0, T4, S6
9D00F420  8C450000   LW A1, 0(V0)
9D00F428  0B403272   J 0x9D00C9C8
9D00F42C  26100001   ADDIU S0, S0, 1
1751:                
1752:                      OPCODE_BEGIN(49)  /* EOR #$nn */
1753:                         EOR(2, IMMEDIATE_BYTE);
9D00F430  26110001   ADDIU S1, S0, 1
9D00F450  931F0000   LBU RA, 0(T8)
9D00F454  029FA026   XOR S4, S4, RA
9D00F458  329200FF   ANDI S2, S4, 255
9D00F45C  8F8380E8   LW V1, -32536(GP)
9D00F460  2479FFFE   ADDIU T9, V1, -2
9D00F464  AF9980E8   SW T9, -32536(GP)
9D00F468  8DC70054   LW A3, 84(T6)
9D00F46C  24EB0002   ADDIU T3, A3, 2
9D00F478  0240A021   ADDU S4, S2, ZERO
9D00F47C  0B40565D   J .L95
9D00F480  0240A821   ADDU S5, S2, ZERO
9D00F4B4  0240A021   ADDU S4, S2, ZERO
1754:                         OPCODE_END
9D00F470  1F200004   BGTZ T9, 0x9D00F484
9D00F474  ADCB0054   SW T3, 84(T6)
9D00F484  26100002   ADDIU S0, S0, 2
9D00F4A4  91820000   LBU V0, 0(T4)
9D00F4A8  0002A880   SLL S5, V0, 2
9D00F4AC  02B67021   ADDU T6, S5, S6
9D00F4B0  8DC50000   LW A1, 0(T6)
9D00F4B8  0B403272   J 0x9D00C9C8
9D00F4BC  0240A821   ADDU S5, S2, ZERO
1755:                
1756:                      OPCODE_BEGIN(4A)  /* LSR A */
1757:                         LSR_A();
9D00F4C0  32970001   ANDI S7, S4, 1
9D00F4C4  7E923840   EXT S2, S4, 1, 8
9D00F4C8  8F8480E8   LW A0, -32536(GP)
9D00F4CC  248FFFFE   ADDIU T7, A0, -2
9D00F4D0  AF8F80E8   SW T7, -32536(GP)
9D00F4D4  26653010   ADDIU A1, S3, 12304
9D00F4D8  8CB80054   LW T8, 84(A1)
9D00F4DC  271F0002   ADDIU RA, T8, 2
9D00F4E8  0240A021   ADDU S4, S2, ZERO
9D00F4F0  0B40565D   J .L95
9D00F4F4  0240A821   ADDU S5, S2, ZERO
9D00F524  0240A021   ADDU S4, S2, ZERO
1758:                         OPCODE_END
9D00F4E0  1DE00005   BGTZ T7, .LBB980
9D00F4E4  ACBF0054   SW RA, 84(A1)
9D00F4EC  02008821   ADDU S1, S0, ZERO
9D00F514  91480000   LBU T0, 0(T2)
9D00F518  00084880   SLL T1, T0, 2
9D00F51C  01368821   ADDU S1, T1, S6
9D00F520  8E250000   LW A1, 0(S1)
9D00F528  26100001   ADDIU S0, S0, 1
9D00F52C  0B403272   J 0x9D00C9C8
9D00F530  0240A821   ADDU S5, S2, ZERO
1759:                
1760:                      OPCODE_BEGIN(4B)  /* ASR #$nn */
1761:                         ASR(2, IMMEDIATE_BYTE);
9D00F534  26110001   ADDIU S1, S0, 1
9D00F554  91C40000   LBU A0, 0(T6)
9D00F558  02847824   AND T7, S4, A0
9D00F55C  31F70001   ANDI S7, T7, 1
9D00F560  000F9042   SRL S2, T7, 1
9D00F564  8F8580E8   LW A1, -32536(GP)
9D00F568  24B8FFFE   ADDIU T8, A1, -2
9D00F56C  AF9880E8   SW T8, -32536(GP)
9D00F570  8DBF0054   LW RA, 84(T5)
9D00F574  27F40002   ADDIU S4, RA, 2
9D00F580  0240A021   ADDU S4, S2, ZERO
9D00F584  0B40565D   J .L95
9D00F588  0240A821   ADDU S5, S2, ZERO
9D00F5BC  0240A021   ADDU S4, S2, ZERO
1762:                         OPCODE_END
9D00F578  1F000004   BGTZ T8, 0x9D00F58C
9D00F57C  ADB40054   SW S4, 84(T5)
9D00F58C  26100002   ADDIU S0, S0, 2
9D00F5AC  91090000   LBU T1, 0(T0)
9D00F5B0  00098880   SLL S1, T1, 2
9D00F5B4  02366821   ADDU T5, S1, S6
9D00F5B8  8DA50000   LW A1, 0(T5)
9D00F5C0  0B403272   J 0x9D00C9C8
9D00F5C4  0240A821   ADDU S5, S2, ZERO
1763:                
1764:                      OPCODE_BEGIN(4C)  /* JMP $nnnn */
1765:                         JMP_ABSOLUTE();
9D00F5C8  0F4030A7   JAL bank_readword
9D00F5CC  02002021   ADDU A0, S0, ZERO
9D00F5D0  00408821   ADDU S1, V0, ZERO
9D00F5D4  8F9080E8   LW S0, -32536(GP)
9D00F5D8  260CFFFD   ADDIU T4, S0, -3
9D00F5DC  AF8C80E8   SW T4, -32536(GP)
9D00F5E0  26623010   ADDIU V0, S3, 12304
9D00F5E4  8C4E0054   LW T6, 84(V0)
9D00F5E8  25C40003   ADDIU A0, T6, 3
1766:                         OPCODE_END
9D00F5EC  198018E1   BLEZ T4, .L95
9D00F5F0  AC440054   SW A0, 84(V0)
9D00F5F4  26300001   ADDIU S0, S1, 1
9D00F614  90EB0000   LBU T3, 0(A3)
9D00F618  000B3080   SLL A2, T3, 2
9D00F61C  00D65021   ADDU T2, A2, S6
9D00F620  0B403272   J 0x9D00C9C8
9D00F624  8D450000   LW A1, 0(T2)
1767:                
1768:                      OPCODE_BEGIN(4D)  /* EOR $nnnn */
1769:                         EOR(4, ABSOLUTE_BYTE);
9D00F628  0F4030A7   JAL bank_readword
9D00F62C  02002021   ADDU A0, S0, ZERO
9D00F630  26110002   ADDIU S1, S0, 2
9D00F634  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00F638  00402021   ADDU A0, V0, ZERO
9D00F63C  00549026   XOR S2, V0, S4
9D00F640  325200FF   ANDI S2, S2, 255
9D00F644  8F9580E8   LW S5, -32536(GP)
9D00F648  26B4FFFC   ADDIU S4, S5, -4
9D00F64C  AF9480E8   SW S4, -32536(GP)
9D00F650  26683010   ADDIU T0, S3, 12304
9D00F654  8D090054   LW T1, 84(T0)
9D00F658  252D0004   ADDIU T5, T1, 4
9D00F664  0240A021   ADDU S4, S2, ZERO
9D00F668  0B40565D   J .L95
9D00F66C  0240A821   ADDU S5, S2, ZERO
9D00F6A0  0240A021   ADDU S4, S2, ZERO
1770:                         OPCODE_END
9D00F65C  1E800004   BGTZ S4, 0x9D00F670
9D00F660  AD0D0054   SW T5, 84(T0)
9D00F670  26100003   ADDIU S0, S0, 3
9D00F690  90B80000   LBU T8, 0(A1)
9D00F694  0018F880   SLL RA, T8, 2
9D00F698  03F61821   ADDU V1, RA, S6
9D00F69C  8C650000   LW A1, 0(V1)
9D00F6A4  0B403272   J 0x9D00C9C8
9D00F6A8  0240A821   ADDU S5, S2, ZERO
1771:                
1772:                      OPCODE_BEGIN(4E)  /* LSR $nnnn */
1773:                         LSR(6, ABSOLUTE, mem_writebyte, addr);
9D00F6AC  0F4030A7   JAL bank_readword
9D00F6B0  02002021   ADDU A0, S0, ZERO
9D00F6B4  0040A821   ADDU S5, V0, ZERO
9D00F6B8  26110002   ADDIU S1, S0, 2
9D00F6BC  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00F6C0  00402021   ADDU A0, V0, ZERO
9D00F6C4  30570001   ANDI S7, V0, 1
9D00F6C8  7C523840   EXT S2, V0, 1, 8
9D00F6CC  02A02021   ADDU A0, S5, ZERO
9D00F6D0  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00F6D4  02402821   ADDU A1, S2, ZERO
9D00F6D8  8F9980E8   LW T9, -32536(GP)
9D00F6DC  2727FFFA   ADDIU A3, T9, -6
9D00F6E0  AF8780E8   SW A3, -32536(GP)
9D00F6E4  266B3010   ADDIU T3, S3, 12304
9D00F6E8  8D660054   LW A2, 84(T3)
9D00F6EC  24CA0006   ADDIU T2, A2, 6
9D00F6F8  0B40565D   J .L95
9D00F6FC  0240A821   ADDU S5, S2, ZERO
1774:                         OPCODE_END
9D00F6F0  1CE00003   BGTZ A3, 0x9D00F700
9D00F6F4  AD6A0054   SW T2, 84(T3)
9D00F700  26100003   ADDIU S0, S0, 3
9D00F720  90910000   LBU S1, 0(A0)
9D00F724  00117880   SLL T7, S1, 2
9D00F728  01F62821   ADDU A1, T7, S6
9D00F72C  8CA50000   LW A1, 0(A1)
9D00F730  0B403272   J 0x9D00C9C8
9D00F734  0240A821   ADDU S5, S2, ZERO
1775:                
1776:                      OPCODE_BEGIN(4F)  /* SRE $nnnn */
1777:                         SRE(6, ABSOLUTE, mem_writebyte, addr);
9D00F738  0F4030A7   JAL bank_readword
9D00F73C  02002021   ADDU A0, S0, ZERO
9D00F740  0040A821   ADDU S5, V0, ZERO
9D00F744  26110002   ADDIU S1, S0, 2
9D00F748  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00F74C  00402021   ADDU A0, V0, ZERO
9D00F750  30570001   ANDI S7, V0, 1
9D00F754  7C523840   EXT S2, V0, 1, 8
9D00F758  02A02021   ADDU A0, S5, ZERO
9D00F75C  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00F760  02402821   ADDU A1, S2, ZERO
9D00F764  0254A026   XOR S4, S2, S4
9D00F768  329200FF   ANDI S2, S4, 255
9D00F76C  8F9880E8   LW T8, -32536(GP)
9D00F770  2719FFFA   ADDIU T9, T8, -6
9D00F774  AF9980E8   SW T9, -32536(GP)
9D00F778  26633010   ADDIU V1, S3, 12304
9D00F77C  8C670054   LW A3, 84(V1)
9D00F780  24EB0006   ADDIU T3, A3, 6
9D00F78C  0240A021   ADDU S4, S2, ZERO
9D00F790  0B40565D   J .L95
9D00F794  0240A821   ADDU S5, S2, ZERO
9D00F7C8  0240A021   ADDU S4, S2, ZERO
1778:                         OPCODE_END
9D00F784  1F200004   BGTZ T9, 0x9D00F798
9D00F788  AC6B0054   SW T3, 84(V1)
9D00F798  26100003   ADDIU S0, S0, 3
9D00F7B8  918E0000   LBU T6, 0(T4)
9D00F7BC  000E1080   SLL V0, T6, 2
9D00F7C0  00562021   ADDU A0, V0, S6
9D00F7C4  8C850000   LW A1, 0(A0)
9D00F7CC  0B403272   J 0x9D00C9C8
9D00F7D0  0240A821   ADDU S5, S2, ZERO
1779:                
1780:                      OPCODE_BEGIN(50)  /* BVC $nnnn */
1781:                         BVC();
9D00F7D4  8FB10014   LW S1, 20(SP)
9D00F7D8  5620001F   BNEL S1, ZERO, 0x9D00F858
9D00F7DC  26110001   ADDIU S1, S0, 1
9D00F7E0  26070001   ADDIU A3, S0, 1
9D00F800  812D0000   LB T5, 0(T1)
9D00F804  30EC00FF   ANDI T4, A3, 255
9D00F808  01AC7021   ADDU T6, T5, T4
9D00F80C  31C20100   ANDI V0, T6, 256
9D00F810  10400009   BEQ V0, ZERO, 0x9D00F838
9D00F814  8F9880E8   LW T8, -32536(GP)
9D00F818  8F8480E8   LW A0, -32536(GP)
9D00F81C  2491FFFF   ADDIU S1, A0, -1
9D00F820  AF9180E8   SW S1, -32536(GP)
9D00F824  26703010   ADDIU S0, S3, 12304
9D00F828  8E0F0054   LW T7, 84(S0)
9D00F82C  25E50001   ADDIU A1, T7, 1
9D00F830  AE050054   SW A1, 84(S0)
9D00F834  8F9880E8   LW T8, -32536(GP)
9D00F838  2719FFFD   ADDIU T9, T8, -3
9D00F83C  AF9980E8   SW T9, -32536(GP)
9D00F840  26633010   ADDIU V1, S3, 12304
9D00F844  8C6B0054   LW T3, 84(V1)
9D00F848  257F0003   ADDIU RA, T3, 3
9D00F84C  AC7F0054   SW RA, 84(V1)
9D00F850  0B403E1D   J 0x9D00F874
9D00F854  01A78821   ADDU S1, T5, A3
9D00F858  8F9080E8   LW S0, -32536(GP)
9D00F85C  260FFFFE   ADDIU T7, S0, -2
9D00F860  AF8F80E8   SW T7, -32536(GP)
9D00F864  26653010   ADDIU A1, S3, 12304
9D00F868  8CB80054   LW T8, 84(A1)
9D00F86C  27190002   ADDIU T9, T8, 2
9D00F870  ACB90054   SW T9, 84(A1)
1782:                         OPCODE_END
9D00F874  8F8780E8   LW A3, -32536(GP)
9D00F878  18E0183E   BLEZ A3, .L95
9D00F87C  26300001   ADDIU S0, S1, 1
9D00F89C  91C20000   LBU V0, 0(T6)
9D00F8A0  00022080   SLL A0, V0, 2
9D00F8A4  00968821   ADDU S1, A0, S6
9D00F8A8  0B403272   J 0x9D00C9C8
9D00F8AC  8E250000   LW A1, 0(S1)
1783:                
1784:                      OPCODE_BEGIN(51)  /* EOR ($nn),Y */
1785:                         EOR(5, INDIR_Y_BYTE_READ);
9D00F8DC  8FAA0010   LW T2, 16(SP)
9D00F8E0  00CA4021   ADDU T0, A2, T2
9D00F8E4  3104FFFF   ANDI A0, T0, -1
9D00F8E8  308900FF   ANDI T1, A0, 255
9D00F8EC  012A682B   SLTU T5, T1, T2
9D00F8F0  11A00008   BEQ T5, ZERO, 0x9D00F914
9D00F8F4  26110001   ADDIU S1, S0, 1
9D00F8F8  8F8C80E8   LW T4, -32536(GP)
9D00F8FC  258EFFFF   ADDIU T6, T4, -1
9D00F900  AF8E80E8   SW T6, -32536(GP)
9D00F904  26623010   ADDIU V0, S3, 12304
9D00F908  8C550054   LW S5, 84(V0)
9D00F90C  26B20001   ADDIU S2, S5, 1
9D00F910  AC520054   SW S2, 84(V0)
9D00F914  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00F918  00000000   NOP
9D00F91C  0054A026   XOR S4, V0, S4
9D00F920  329200FF   ANDI S2, S4, 255
9D00F924  8F8480E8   LW A0, -32536(GP)
9D00F928  248FFFFB   ADDIU T7, A0, -5
9D00F92C  AF8F80E8   SW T7, -32536(GP)
9D00F930  26653010   ADDIU A1, S3, 12304
9D00F934  8CB80054   LW T8, 84(A1)
9D00F938  27190005   ADDIU T9, T8, 5
9D00F944  0240A021   ADDU S4, S2, ZERO
9D00F948  0B40565D   J .L95
9D00F94C  0240A821   ADDU S5, S2, ZERO
9D00F980  0240A021   ADDU S4, S2, ZERO
1786:                         OPCODE_END
9D00F93C  1DE00004   BGTZ T7, 0x9D00F950
9D00F940  ACB90054   SW T9, 84(A1)
9D00F950  26100002   ADDIU S0, S0, 2
9D00F970  91480000   LBU T0, 0(T2)
9D00F974  00084880   SLL T1, T0, 2
9D00F978  01366821   ADDU T5, T1, S6
9D00F97C  8DA50000   LW A1, 0(T5)
9D00F984  0B403272   J 0x9D00C9C8
9D00F988  0240A821   ADDU S5, S2, ZERO
1787:                
1788:                      OPCODE_BEGIN(53)  /* SRE ($nn),Y */
1789:                         SRE(8, INDIR_Y, mem_writebyte, addr);
9D00F9B8  8FA30010   LW V1, 16(SP)
9D00F9BC  03235821   ADDU T3, T9, V1
9D00F9C0  317FFFFF   ANDI RA, T3, -1
9D00F9C4  AFBF002C   SW RA, 44(SP)
9D00F9C8  03E02021   ADDU A0, RA, ZERO
9D00F9CC  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00F9D0  26110001   ADDIU S1, S0, 1
9D00F9D4  30570001   ANDI S7, V0, 1
9D00F9D8  7C523840   EXT S2, V0, 1, 8
9D00F9DC  8FA4002C   LW A0, 44(SP)
9D00F9E0  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00F9E4  02402821   ADDU A1, S2, ZERO
9D00F9E8  0254A026   XOR S4, S2, S4
9D00F9EC  329200FF   ANDI S2, S4, 255
9D00F9F0  8F8780E8   LW A3, -32536(GP)
9D00F9F4  24E6FFF8   ADDIU A2, A3, -8
9D00F9F8  AF8680E8   SW A2, -32536(GP)
9D00F9FC  8EAA0054   LW T2, 84(S5)
9D00FA00  25480008   ADDIU T0, T2, 8
9D00FA0C  0240A021   ADDU S4, S2, ZERO
9D00FA10  0B40565D   J .L95
9D00FA14  0240A821   ADDU S5, S2, ZERO
9D00FA48  0240A021   ADDU S4, S2, ZERO
1790:                         OPCODE_END
9D00FA04  1CC00004   BGTZ A2, 0x9D00FA18
9D00FA08  AEA80054   SW T0, 84(S5)
9D00FA18  26100002   ADDIU S0, S0, 2
9D00FA38  90440000   LBU A0, 0(V0)
9D00FA3C  00047880   SLL T7, A0, 2
9D00FA40  01F62821   ADDU A1, T7, S6
9D00FA44  8CA50000   LW A1, 0(A1)
9D00FA4C  0B403272   J 0x9D00C9C8
9D00FA50  0240A821   ADDU S5, S2, ZERO
1791:                
1792:                      OPCODE_BEGIN(55)  /* EOR $nn,X */
1793:                         EOR(4, ZP_IND_X_BYTE);
9D00FA54  26110001   ADDIU S1, S0, 1
9D00FA74  90E60000   LBU A2, 0(A3)
9D00FA78  03C65021   ADDU T2, FP, A2
9D00FA7C  314800FF   ANDI T0, T2, 255
9D00FA80  8F8980E4   LW T1, -32540(GP)
9D00FA84  01286821   ADDU T5, T1, T0
9D00FA88  91AC0000   LBU T4, 0(T5)
9D00FA8C  0194A026   XOR S4, T4, S4
9D00FA90  329200FF   ANDI S2, S4, 255
9D00FA94  8F9580E8   LW S5, -32536(GP)
9D00FA98  26AEFFFC   ADDIU T6, S5, -4
9D00FA9C  AF8E80E8   SW T6, -32536(GP)
9D00FAA0  8D620054   LW V0, 84(T3)
9D00FAA4  24440004   ADDIU A0, V0, 4
9D00FAB0  0240A021   ADDU S4, S2, ZERO
9D00FAB4  0B40565D   J .L95
9D00FAB8  0240A821   ADDU S5, S2, ZERO
9D00FAEC  0240A021   ADDU S4, S2, ZERO
1794:                         OPCODE_END
9D00FAA8  1DC00004   BGTZ T6, 0x9D00FABC
9D00FAAC  AD640054   SW A0, 84(T3)
9D00FABC  26100002   ADDIU S0, S0, 2
9D00FADC  93E30000   LBU V1, 0(RA)
9D00FAE0  00033880   SLL A3, V1, 2
9D00FAE4  00F63021   ADDU A2, A3, S6
9D00FAE8  8CC50000   LW A1, 0(A2)
9D00FAF0  0B403272   J 0x9D00C9C8
9D00FAF4  0240A821   ADDU S5, S2, ZERO
1795:                
1796:                      OPCODE_BEGIN(56)  /* LSR $nn,X */
1797:                         LSR(6, ZP_IND_X, ZP_WRITEBYTE, baddr);
9D00FAF8  26110001   ADDIU S1, S0, 1
9D00FB18  91950000   LBU S5, 0(T4)
9D00FB1C  03D57021   ADDU T6, FP, S5
9D00FB20  31C200FF   ANDI V0, T6, 255
9D00FB24  8F8480E4   LW A0, -32540(GP)
9D00FB28  00827821   ADDU T7, A0, V0
9D00FB2C  91E50000   LBU A1, 0(T7)
9D00FB30  30B70001   ANDI S7, A1, 1
9D00FB34  00059042   SRL S2, A1, 1
9D00FB38  A1F20000   SB S2, 0(T7)
9D00FB3C  8F9880E8   LW T8, -32536(GP)
9D00FB40  2719FFFA   ADDIU T9, T8, -6
9D00FB44  AF9980E8   SW T9, -32536(GP)
9D00FB48  8D4B0054   LW T3, 84(T2)
9D00FB4C  257F0006   ADDIU RA, T3, 6
9D00FB58  0B40565D   J .L95
9D00FB5C  0240A821   ADDU S5, S2, ZERO
1798:                         OPCODE_END
9D00FB50  1F200003   BGTZ T9, 0x9D00FB60
9D00FB54  AD5F0054   SW RA, 84(T2)
9D00FB60  26100002   ADDIU S0, S0, 2
9D00FB80  912D0000   LBU T5, 0(T1)
9D00FB84  000D6080   SLL T4, T5, 2
9D00FB88  0196A821   ADDU S5, T4, S6
9D00FB8C  8EA50000   LW A1, 0(S5)
9D00FB90  0B403272   J 0x9D00C9C8
9D00FB94  0240A821   ADDU S5, S2, ZERO
1799:                
1800:                      OPCODE_BEGIN(57)  /* SRE $nn,X */
1801:                         SRE(6, ZP_IND_X, ZP_WRITEBYTE, baddr);
9D00FB98  26110001   ADDIU S1, S0, 1
9D00FBB8  90B80000   LBU T8, 0(A1)
9D00FBBC  03D8C821   ADDU T9, FP, T8
9D00FBC0  332B00FF   ANDI T3, T9, 255
9D00FBC4  8F9F80E4   LW RA, -32540(GP)
9D00FBC8  03EB3821   ADDU A3, RA, T3
9D00FBCC  90E30000   LBU V1, 0(A3)
9D00FBD0  30770001   ANDI S7, V1, 1
9D00FBD4  00033042   SRL A2, V1, 1
9D00FBD8  A0E60000   SB A2, 0(A3)
9D00FBDC  00D4A026   XOR S4, A2, S4
9D00FBE0  329200FF   ANDI S2, S4, 255
9D00FBE4  8F8A80E8   LW T2, -32536(GP)
9D00FBE8  2548FFFA   ADDIU T0, T2, -6
9D00FBEC  AF8880E8   SW T0, -32536(GP)
9D00FBF0  8DC90054   LW T1, 84(T6)
9D00FBF4  252D0006   ADDIU T5, T1, 6
9D00FC00  0240A021   ADDU S4, S2, ZERO
9D00FC04  0B40565D   J .L95
9D00FC08  0240A821   ADDU S5, S2, ZERO
9D00FC3C  0240A021   ADDU S4, S2, ZERO
1802:                         OPCODE_END
9D00FBF8  1D000004   BGTZ T0, 0x9D00FC0C
9D00FBFC  ADCD0054   SW T5, 84(T6)
9D00FC0C  26100002   ADDIU S0, S0, 2
9D00FC2C  90850000   LBU A1, 0(A0)
9D00FC30  0005C080   SLL T8, A1, 2
9D00FC34  0316C821   ADDU T9, T8, S6
9D00FC38  8F250000   LW A1, 0(T9)
9D00FC40  0B403272   J 0x9D00C9C8
9D00FC44  0240A821   ADDU S5, S2, ZERO
1803:                
1804:                      OPCODE_BEGIN(58)  /* CLI */
1805:                         CLI();
9D00FC48  8F9180E8   LW S1, -32536(GP)
9D00FC4C  262BFFFE   ADDIU T3, S1, -2
9D00FC50  AF8B80E8   SW T3, -32536(GP)
9D00FC54  267F3010   ADDIU RA, S3, 12304
9D00FC58  8FE70054   LW A3, 84(RA)
9D00FC5C  AFA7002C   SW A3, 44(SP)
9D00FC60  24E30002   ADDIU V1, A3, 2
9D00FC64  AFE30054   SW V1, 84(RA)
9D00FC68  93E60052   LBU A2, 82(RA)
9D00FC6C  10C00031   BEQ A2, ZERO, 0x9D00FD34
9D00FC70  AFA0001C   SW ZERO, 28(SP)
9D00FC74  1960002F   BLEZ T3, 0x9D00FD34
9D00FC78  266A3010   ADDIU T2, S3, 12304
9D00FC7C  A1400052   SB ZERO, 82(T2)
9D00FC80  8F8880E0   LW T0, -32544(GP)
9D00FC84  8FA90018   LW T1, 24(SP)
9D00FC88  01096821   ADDU T5, T0, T1
9D00FC8C  00106202   SRL T4, S0, 8
9D00FC90  A1AC0000   SB T4, 0(T5)
9D00FC94  252EFFFE   ADDIU T6, T1, -2
9D00FC98  31C200FF   ANDI V0, T6, 255
9D00FC9C  252FFFFF   ADDIU T7, T1, -1
9D00FCA0  31E400FF   ANDI A0, T7, 255
9D00FCA4  01042821   ADDU A1, T0, A0
9D00FCA8  A0B00000   SB S0, 0(A1)
9D00FCAC  2530FFFD   ADDIU S0, T1, -3
9D00FCB0  321800FF   ANDI T8, S0, 255
9D00FCB4  AFB80018   SW T8, 24(SP)
9D00FCB8  0102C821   ADDU T9, T0, V0
9D00FCBC  240BFF80   ADDIU T3, ZERO, -128
9D00FCC0  024BF824   AND RA, S2, T3
9D00FCC4  7C1F3C20   SEB A3, RA
9D00FCC8  24060040   ADDIU A2, ZERO, 64
9D00FCCC  8FA30014   LW V1, 20(SP)
9D00FCD0  0003300A   MOVZ A2, ZERO, V1
9D00FCD4  240A0008   ADDIU T2, ZERO, 8
9D00FCD8  8FA80020   LW T0, 32(SP)
9D00FCDC  0008500A   MOVZ T2, ZERO, T0
9D00FCE0  24090002   ADDIU T1, ZERO, 2
9D00FCE4  0015480B   MOVN T1, ZERO, S5
9D00FCE8  36ED0020   ORI T5, S7, 32
9D00FCEC  00ED6025   OR T4, A3, T5
9D00FCF0  00CC7025   OR T6, A2, T4
9D00FCF4  014E1025   OR V0, T2, T6
9D00FCF8  01227825   OR T7, T1, V0
9D00FCFC  A32F0000   SB T7, 0(T9)
9D00FD00  0F4030A7   JAL bank_readword
9D00FD04  3404FFFE   ORI A0, ZERO, -2
9D00FD08  00408021   ADDU S0, V0, ZERO
9D00FD0C  2631FFF7   ADDIU S1, S1, -9
9D00FD10  AF9180E8   SW S1, -32536(GP)
9D00FD14  26653010   ADDIU A1, S3, 12304
9D00FD18  8FA4002C   LW A0, 44(SP)
9D00FD1C  24980009   ADDIU T8, A0, 9
9D00FD20  ACB80054   SW T8, 84(A1)
9D00FD24  24190001   ADDIU T9, ZERO, 1
9D00FD28  AFB9001C   SW T9, 28(SP)
9D00FD2C  0B403F4D   J 0x9D00FD34
9D00FD30  AFA00028   SW ZERO, 40(SP)
1806:                         OPCODE_END
9D00FD34  8F8B80E8   LW T3, -32536(GP)
9D00FD38  1D600003   BGTZ T3, .LBB1022
9D00FD3C  0010FB02   SRL RA, S0, 12
9D00FD40  0B40565D   J .L95
9D00FD44  02008821   ADDU S1, S0, ZERO
9D00FD60  912D0000   LBU T5, 0(T1)
9D00FD64  000D6080   SLL T4, T5, 2
9D00FD68  01967021   ADDU T6, T4, S6
9D00FD6C  8DC50000   LW A1, 0(T6)
9D00FD70  0B403272   J 0x9D00C9C8
9D00FD74  26100001   ADDIU S0, S0, 1
1807:                
1808:                      OPCODE_BEGIN(59)  /* EOR $nnnn,Y */
1809:                         EOR(4, ABS_IND_Y_BYTE_READ);
9D00FD78  0F4030A7   JAL bank_readword
9D00FD7C  02002021   ADDU A0, S0, ZERO
9D00FD80  8FB20010   LW S2, 16(SP)
9D00FD84  0052A821   ADDU S5, V0, S2
9D00FD88  32A4FFFF   ANDI A0, S5, -1
9D00FD8C  308200FF   ANDI V0, A0, 255
9D00FD90  0052782B   SLTU T7, V0, S2
9D00FD94  11E00008   BEQ T7, ZERO, 0x9D00FDB8
9D00FD98  26110002   ADDIU S1, S0, 2
9D00FD9C  8F8580E8   LW A1, -32536(GP)
9D00FDA0  24B8FFFF   ADDIU T8, A1, -1
9D00FDA4  AF9880E8   SW T8, -32536(GP)
9D00FDA8  26793010   ADDIU T9, S3, 12304
9D00FDAC  8F2B0054   LW T3, 84(T9)
9D00FDB0  257F0001   ADDIU RA, T3, 1
9D00FDB4  AF3F0054   SW RA, 84(T9)
9D00FDB8  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00FDBC  00000000   NOP
9D00FDC0  0054A026   XOR S4, V0, S4
9D00FDC4  329200FF   ANDI S2, S4, 255
9D00FDC8  8F8480E8   LW A0, -32536(GP)
9D00FDCC  2487FFFC   ADDIU A3, A0, -4
9D00FDD0  AF8780E8   SW A3, -32536(GP)
9D00FDD4  26663010   ADDIU A2, S3, 12304
9D00FDD8  8CC30054   LW V1, 84(A2)
9D00FDDC  246A0004   ADDIU T2, V1, 4
9D00FDE8  0240A021   ADDU S4, S2, ZERO
9D00FDEC  0B40565D   J .L95
9D00FDF0  0240A821   ADDU S5, S2, ZERO
9D00FE24  0240A021   ADDU S4, S2, ZERO
1810:                         OPCODE_END
9D00FDE0  1CE00004   BGTZ A3, 0x9D00FDF4
9D00FDE4  ACCA0054   SW T2, 84(A2)
9D00FDF4  26100003   ADDIU S0, S0, 3
9D00FE14  92A20000   LBU V0, 0(S5)
9D00FE18  00027880   SLL T7, V0, 2
9D00FE1C  01F62821   ADDU A1, T7, S6
9D00FE20  8CA50000   LW A1, 0(A1)
9D00FE28  0B403272   J 0x9D00C9C8
9D00FE2C  0240A821   ADDU S5, S2, ZERO
1811:                
1812:                      OPCODE_BEGIN(5B)  /* SRE $nnnn,Y */
1813:                         SRE(7, ABS_IND_Y, mem_writebyte, addr);
9D00FE30  0F4030A7   JAL bank_readword
9D00FE34  02002021   ADDU A0, S0, ZERO
9D00FE38  26110002   ADDIU S1, S0, 2
9D00FE3C  8FB70010   LW S7, 16(SP)
9D00FE40  00579021   ADDU S2, V0, S7
9D00FE44  3255FFFF   ANDI S5, S2, -1
9D00FE48  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00FE4C  02A02021   ADDU A0, S5, ZERO
9D00FE50  30570001   ANDI S7, V0, 1
9D00FE54  7C523840   EXT S2, V0, 1, 8
9D00FE58  02A02021   ADDU A0, S5, ZERO
9D00FE5C  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00FE60  02402821   ADDU A1, S2, ZERO
9D00FE64  0254C026   XOR T8, S2, S4
9D00FE68  331200FF   ANDI S2, T8, 255
9D00FE6C  8F9980E8   LW T9, -32536(GP)
9D00FE70  272BFFF9   ADDIU T3, T9, -7
9D00FE74  AF8B80E8   SW T3, -32536(GP)
9D00FE78  26743010   ADDIU S4, S3, 12304
9D00FE7C  8E840054   LW A0, 84(S4)
9D00FE80  24870007   ADDIU A3, A0, 7
9D00FE8C  0240A021   ADDU S4, S2, ZERO
9D00FE90  0B40565D   J .L95
9D00FE94  0240A821   ADDU S5, S2, ZERO
9D00FEC8  0240A021   ADDU S4, S2, ZERO
1814:                         OPCODE_END
9D00FE84  1D600004   BGTZ T3, 0x9D00FE98
9D00FE88  AE870054   SW A3, 84(S4)
9D00FE98  26100003   ADDIU S0, S0, 3
9D00FEB8  91AC0000   LBU T4, 0(T5)
9D00FEBC  000C8880   SLL S1, T4, 2
9D00FEC0  02367021   ADDU T6, S1, S6
9D00FEC4  8DC50000   LW A1, 0(T6)
9D00FECC  0B403272   J 0x9D00C9C8
9D00FED0  0240A821   ADDU S5, S2, ZERO
1815:                
1816:                      OPCODE_BEGIN(5D)  /* EOR $nnnn,X */
1817:                         EOR(4, ABS_IND_X_BYTE_READ);
9D00FED4  0F4030A7   JAL bank_readword
9D00FED8  02002021   ADDU A0, S0, ZERO
9D00FEDC  005E1021   ADDU V0, V0, FP
9D00FEE0  3044FFFF   ANDI A0, V0, -1
9D00FEE4  308F00FF   ANDI T7, A0, 255
9D00FEE8  01FE282B   SLTU A1, T7, FP
9D00FEEC  10A00008   BEQ A1, ZERO, 0x9D00FF10
9D00FEF0  26110002   ADDIU S1, S0, 2
9D00FEF4  8F9580E8   LW S5, -32536(GP)
9D00FEF8  26B2FFFF   ADDIU S2, S5, -1
9D00FEFC  AF9280E8   SW S2, -32536(GP)
9D00FF00  26783010   ADDIU T8, S3, 12304
9D00FF04  8F190054   LW T9, 84(T8)
9D00FF08  272B0001   ADDIU T3, T9, 1
9D00FF0C  AF0B0054   SW T3, 84(T8)
9D00FF10  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00FF14  00000000   NOP
9D00FF18  0054A026   XOR S4, V0, S4
9D00FF1C  329200FF   ANDI S2, S4, 255
9D00FF20  8F8480E8   LW A0, -32536(GP)
9D00FF24  2487FFFC   ADDIU A3, A0, -4
9D00FF28  AF8780E8   SW A3, -32536(GP)
9D00FF2C  26663010   ADDIU A2, S3, 12304
9D00FF30  8CC30054   LW V1, 84(A2)
9D00FF34  246A0004   ADDIU T2, V1, 4
9D00FF40  0240A021   ADDU S4, S2, ZERO
9D00FF44  0B40565D   J .L95
9D00FF48  0240A821   ADDU S5, S2, ZERO
9D00FF7C  0240A021   ADDU S4, S2, ZERO
1818:                         OPCODE_END
9D00FF38  1CE00004   BGTZ A3, 0x9D00FF4C
9D00FF3C  ACCA0054   SW T2, 84(A2)
9D00FF4C  26100003   ADDIU S0, S0, 3
9D00FF6C  91C20000   LBU V0, 0(T6)
9D00FF70  00027880   SLL T7, V0, 2
9D00FF74  01F62821   ADDU A1, T7, S6
9D00FF78  8CA50000   LW A1, 0(A1)
9D00FF80  0B403272   J 0x9D00C9C8
9D00FF84  0240A821   ADDU S5, S2, ZERO
1819:                
1820:                      OPCODE_BEGIN(5E)  /* LSR $nnnn,X */
1821:                         LSR(7, ABS_IND_X, mem_writebyte, addr);
9D00FF88  0F4030A7   JAL bank_readword
9D00FF8C  02002021   ADDU A0, S0, ZERO
9D00FF90  26110002   ADDIU S1, S0, 2
9D00FF94  005EB821   ADDU S7, V0, FP
9D00FF98  32F5FFFF   ANDI S5, S7, -1
9D00FF9C  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D00FFA0  02A02021   ADDU A0, S5, ZERO
9D00FFA4  30570001   ANDI S7, V0, 1
9D00FFA8  7C523840   EXT S2, V0, 1, 8
9D00FFAC  02A02021   ADDU A0, S5, ZERO
9D00FFB0  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D00FFB4  02402821   ADDU A1, S2, ZERO
9D00FFB8  8F9880E8   LW T8, -32536(GP)
9D00FFBC  2719FFF9   ADDIU T9, T8, -7
9D00FFC0  AF9980E8   SW T9, -32536(GP)
9D00FFC4  266B3010   ADDIU T3, S3, 12304
9D00FFC8  8D640054   LW A0, 84(T3)
9D00FFCC  24870007   ADDIU A3, A0, 7
9D00FFD8  0B40565D   J .L95
9D00FFDC  0240A821   ADDU S5, S2, ZERO
1822:                         OPCODE_END
9D00FFD0  1F200003   BGTZ T9, 0x9D00FFE0
9D00FFD4  AD670054   SW A3, 84(T3)
9D00FFE0  26100003   ADDIU S0, S0, 3
9D010000  91AC0000   LBU T4, 0(T5)
9D010004  000C8880   SLL S1, T4, 2
9D010008  02367021   ADDU T6, S1, S6
9D01000C  8DC50000   LW A1, 0(T6)
9D010010  0B403272   J 0x9D00C9C8
9D010014  0240A821   ADDU S5, S2, ZERO
1823:                
1824:                      OPCODE_BEGIN(5F)  /* SRE $nnnn,X */
1825:                         SRE(7, ABS_IND_X, mem_writebyte, addr);
9D010018  0F4030A7   JAL bank_readword
9D01001C  02002021   ADDU A0, S0, ZERO
9D010020  26110002   ADDIU S1, S0, 2
9D010024  005E9021   ADDU S2, V0, FP
9D010028  3255FFFF   ANDI S5, S2, -1
9D01002C  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D010030  02A02021   ADDU A0, S5, ZERO
9D010034  30570001   ANDI S7, V0, 1
9D010038  7C523840   EXT S2, V0, 1, 8
9D01003C  02A02021   ADDU A0, S5, ZERO
9D010040  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D010044  02402821   ADDU A1, S2, ZERO
9D010048  0254A026   XOR S4, S2, S4
9D01004C  329200FF   ANDI S2, S4, 255
9D010050  8F8280E8   LW V0, -32536(GP)
9D010054  244FFFF9   ADDIU T7, V0, -7
9D010058  AF8F80E8   SW T7, -32536(GP)
9D01005C  26653010   ADDIU A1, S3, 12304
9D010060  8CB80054   LW T8, 84(A1)
9D010064  27190007   ADDIU T9, T8, 7
9D010070  0240A021   ADDU S4, S2, ZERO
9D010074  0B40565D   J .L95
9D010078  0240A821   ADDU S5, S2, ZERO
9D0100AC  0240A021   ADDU S4, S2, ZERO
1826:                         OPCODE_END
9D010068  1DE00004   BGTZ T7, 0x9D01007C
9D01006C  ACB90054   SW T9, 84(A1)
9D01007C  26100003   ADDIU S0, S0, 3
9D01009C  93E80000   LBU T0, 0(RA)
9D0100A0  00084880   SLL T1, T0, 2
9D0100A4  01366821   ADDU T5, T1, S6
9D0100A8  8DA50000   LW A1, 0(T5)
9D0100B0  0B403272   J 0x9D00C9C8
9D0100B4  0240A821   ADDU S5, S2, ZERO
1827:                
1828:                      OPCODE_BEGIN(60)  /* RTS */
1829:                         RTS();
9D0100B8  8F9080E0   LW S0, -32544(GP)
9D0100BC  8FAC0018   LW T4, 24(SP)
9D0100C0  25910001   ADDIU S1, T4, 1
9D0100C4  322E00FF   ANDI T6, S1, 255
9D0100C8  020E1021   ADDU V0, S0, T6
9D0100CC  904F0000   LBU T7, 0(V0)
9D0100D0  25850002   ADDIU A1, T4, 2
9D0100D4  30B800FF   ANDI T8, A1, 255
9D0100D8  AFB80018   SW T8, 24(SP)
9D0100DC  0218C821   ADDU T9, S0, T8
9D0100E0  932B0000   LBU T3, 0(T9)
9D0100E4  000B2200   SLL A0, T3, 8
9D0100E8  008F3825   OR A3, A0, T7
9D0100EC  24F10001   ADDIU S1, A3, 1
9D0100F0  8F8680E8   LW A2, -32536(GP)
9D0100F4  24CAFFFA   ADDIU T2, A2, -6
9D0100F8  AF8A80E8   SW T2, -32536(GP)
9D0100FC  26633010   ADDIU V1, S3, 12304
9D010100  8C7F0054   LW RA, 84(V1)
9D010104  27E80006   ADDIU T0, RA, 6
1830:                         OPCODE_END
9D010108  1940161A   BLEZ T2, .L95
9D01010C  AC680054   SW T0, 84(V1)
9D010110  24F00002   ADDIU S0, A3, 2
9D010130  91E50000   LBU A1, 0(T7)
9D010134  0005C080   SLL T8, A1, 2
9D010138  0316C821   ADDU T9, T8, S6
9D01013C  0B403272   J 0x9D00C9C8
9D010140  8F250000   LW A1, 0(T9)
1831:                
1832:                      OPCODE_BEGIN(61)  /* ADC ($nn,X) */
1833:                         ADC(6, INDIR_X_BYTE);
9D010144  26110001   ADDIU S1, S0, 1
9D010164  90CA0000   LBU T2, 0(A2)
9D010168  03CA1821   ADDU V1, FP, T2
9D010178  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D01017C  95240000   LHU A0, 0(T1)
9D010180  02826821   ADDU T5, S4, V0
9D010184  01B76021   ADDU T4, T5, S7
9D010188  7D970200   EXT S7, T4, 8, 1
9D01018C  319200FF   ANDI S2, T4, 255
9D010190  00547026   XOR T6, V0, S4
9D010194  000E1027   NOR V0, ZERO, T6
9D010198  7C023004   INS V0, ZERO, 0, 7
9D01019C  0254A026   XOR S4, S2, S4
9D0101A0  00547824   AND T7, V0, S4
9D0101A4  31E500FF   ANDI A1, T7, 255
9D0101A8  AFA50014   SW A1, 20(SP)
9D0101AC  8F9880E8   LW T8, -32536(GP)
9D0101B0  2719FFFA   ADDIU T9, T8, -6
9D0101B4  AF9980E8   SW T9, -32536(GP)
9D0101B8  8EAB0054   LW T3, 84(S5)
9D0101BC  25640006   ADDIU A0, T3, 6
9D0101C8  0240A021   ADDU S4, S2, ZERO
9D0101CC  0B40565D   J .L95
9D0101D0  0240A821   ADDU S5, S2, ZERO
9D010204  0240A021   ADDU S4, S2, ZERO
1834:                         OPCODE_END
9D0101C0  1F200004   BGTZ T9, 0x9D0101D4
9D0101C4  AEA40054   SW A0, 84(S5)
9D0101D4  26100002   ADDIU S0, S0, 2
9D0101F4  93E80000   LBU T0, 0(RA)
9D0101F8  00084880   SLL T1, T0, 2
9D0101FC  01366821   ADDU T5, T1, S6
9D010200  8DA50000   LW A1, 0(T5)
9D010208  0B403272   J 0x9D00C9C8
9D01020C  0240A821   ADDU S5, S2, ZERO
1835:                
1836:                      OPCODE_BEGIN(63)  /* RRA ($nn,X) */
1837:                         RRA(8, INDIR_X, mem_writebyte, addr);
9D010210  26110001   ADDIU S1, S0, 1
9D010230  90B80000   LBU T8, 0(A1)
9D010234  03D8C821   ADDU T9, FP, T8
9D010248  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D01024C  02402021   ADDU A0, S2, ZERO
9D010250  AFA2002C   SW V0, 44(SP)
9D010254  7C463840   EXT A2, V0, 1, 8
9D010258  0017B9C0   SLL S7, S7, 7
9D01025C  00D75025   OR T2, A2, S7
9D010260  314300FF   ANDI V1, T2, 255
9D010264  AFA30014   SW V1, 20(SP)
9D010268  02402021   ADDU A0, S2, ZERO
9D01026C  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D010270  00602821   ADDU A1, V1, ZERO
9D010274  8FA80014   LW T0, 20(SP)
9D010278  02884821   ADDU T1, S4, T0
9D01027C  8FAD002C   LW T5, 44(SP)
9D010280  31AC0001   ANDI T4, T5, 1
9D010284  012C7021   ADDU T6, T1, T4
9D010288  7DD70200   EXT S7, T6, 8, 1
9D01028C  31D200FF   ANDI S2, T6, 255
9D010290  01141026   XOR V0, T0, S4
9D010294  00027827   NOR T7, ZERO, V0
9D010298  7C0F3004   INS T7, ZERO, 0, 7
9D01029C  0254A026   XOR S4, S2, S4
9D0102A0  01F42824   AND A1, T7, S4
9D0102A4  30B800FF   ANDI T8, A1, 255
9D0102A8  AFB80014   SW T8, 20(SP)
9D0102AC  8F9980E8   LW T9, -32536(GP)
9D0102B0  272BFFF8   ADDIU T3, T9, -8
9D0102B4  AF8B80E8   SW T3, -32536(GP)
9D0102B8  8EA40054   LW A0, 84(S5)
9D0102BC  24870008   ADDIU A3, A0, 8
9D0102C8  0240A021   ADDU S4, S2, ZERO
9D0102CC  0B40565D   J .L95
9D0102D0  0240A821   ADDU S5, S2, ZERO
9D010304  0240A021   ADDU S4, S2, ZERO
1838:                         OPCODE_END
9D0102C0  1D600004   BGTZ T3, 0x9D0102D4
9D0102C4  AEA70054   SW A3, 84(S5)
9D0102D4  26100002   ADDIU S0, S0, 2
9D0102F4  91090000   LBU T1, 0(T0)
9D0102F8  00096880   SLL T5, T1, 2
9D0102FC  01B66021   ADDU T4, T5, S6
9D010300  8D850000   LW A1, 0(T4)
9D010308  0B403272   J 0x9D00C9C8
9D01030C  0240A821   ADDU S5, S2, ZERO
1839:                
1840:                      OPCODE_BEGIN(65)  /* ADC $nn */
1841:                         ADC(3, ZERO_PAGE_BYTE);
9D010310  26110001   ADDIU S1, S0, 1
9D010330  932B0000   LBU T3, 0(T9)
9D010334  8F8480E4   LW A0, -32540(GP)
9D010338  008B3821   ADDU A3, A0, T3
9D01033C  90FF0000   LBU RA, 0(A3)
9D010340  029FA821   ADDU S5, S4, RA
9D010344  02B73021   ADDU A2, S5, S7
9D010348  7CD70200   EXT S7, A2, 8, 1
9D01034C  30D200FF   ANDI S2, A2, 255
9D010350  03F45026   XOR T2, RA, S4
9D010354  000A1827   NOR V1, ZERO, T2
9D010358  7C033004   INS V1, ZERO, 0, 7
9D01035C  0254A026   XOR S4, S2, S4
9D010360  00744024   AND T0, V1, S4
9D010364  310900FF   ANDI T1, T0, 255
9D010368  AFA90014   SW T1, 20(SP)
9D01036C  8F8D80E8   LW T5, -32536(GP)
9D010370  25ACFFFD   ADDIU T4, T5, -3
9D010374  AF8C80E8   SW T4, -32536(GP)
9D010378  8C4E0054   LW T6, 84(V0)
9D01037C  25CF0003   ADDIU T7, T6, 3
9D010388  0240A021   ADDU S4, S2, ZERO
9D01038C  0B40565D   J .L95
9D010390  0240A821   ADDU S5, S2, ZERO
9D0103C4  0240A021   ADDU S4, S2, ZERO
1842:                         OPCODE_END
9D010380  1D800004   BGTZ T4, 0x9D010394
9D010384  AC4F0054   SW T7, 84(V0)
9D010394  26100002   ADDIU S0, S0, 2
9D0103B4  90870000   LBU A3, 0(A0)
9D0103B8  0007F880   SLL RA, A3, 2
9D0103BC  03F6A821   ADDU S5, RA, S6
9D0103C0  8EA50000   LW A1, 0(S5)
9D0103C8  0B403272   J 0x9D00C9C8
9D0103CC  0240A821   ADDU S5, S2, ZERO
1843:                
1844:                      OPCODE_BEGIN(66)  /* ROR $nn */
1845:                         ROR(5, ZERO_PAGE, ZP_WRITEBYTE, baddr);
9D0103D0  26110001   ADDIU S1, S0, 1
9D0103F0  91AC0000   LBU T4, 0(T5)
9D0103F4  8F8E80E4   LW T6, -32540(GP)
9D0103F8  01CC7821   ADDU T7, T6, T4
9D0103FC  91E20000   LBU V0, 0(T7)
9D010400  0017B9C0   SLL S7, S7, 7
9D010404  32E500FF   ANDI A1, S7, 255
9D010408  30570001   ANDI S7, V0, 1
9D01040C  0002C042   SRL T8, V0, 1
9D010410  00B89025   OR S2, A1, T8
9D010414  A1F20000   SB S2, 0(T7)
9D010418  8F9980E8   LW T9, -32536(GP)
9D01041C  272BFFFB   ADDIU T3, T9, -5
9D010420  AF8B80E8   SW T3, -32536(GP)
9D010424  8D440054   LW A0, 84(T2)
9D010428  24870005   ADDIU A3, A0, 5
9D010434  0B40565D   J .L95
9D010438  0240A821   ADDU S5, S2, ZERO
1846:                         OPCODE_END
9D01042C  1D600003   BGTZ T3, 0x9D01043C
9D010430  AD470054   SW A3, 84(T2)
9D01043C  26100002   ADDIU S0, S0, 2
9D01045C  90690000   LBU T1, 0(V1)
9D010460  00096880   SLL T5, T1, 2
9D010464  01B66021   ADDU T4, T5, S6
9D010468  8D850000   LW A1, 0(T4)
9D01046C  0B403272   J 0x9D00C9C8
9D010470  0240A821   ADDU S5, S2, ZERO
1847:                
1848:                      OPCODE_BEGIN(67)  /* RRA $nn */
1849:                         RRA(5, ZERO_PAGE, ZP_WRITEBYTE, baddr);
9D010474  26110001   ADDIU S1, S0, 1
9D010494  932B0000   LBU T3, 0(T9)
9D010498  8F8480E4   LW A0, -32540(GP)
9D01049C  008B3821   ADDU A3, A0, T3
9D0104A0  90FF0000   LBU RA, 0(A3)
9D0104A4  001FA842   SRL S5, RA, 1
9D0104A8  0017B9C0   SLL S7, S7, 7
9D0104AC  02B73025   OR A2, S5, S7
9D0104B0  30CA00FF   ANDI T2, A2, 255
9D0104B4  A0EA0000   SB T2, 0(A3)
9D0104B8  028A4021   ADDU T0, S4, T2
9D0104BC  33E30001   ANDI V1, RA, 1
9D0104C0  01034821   ADDU T1, T0, V1
9D0104C4  7D370200   EXT S7, T1, 8, 1
9D0104C8  313200FF   ANDI S2, T1, 255
9D0104CC  01546826   XOR T5, T2, S4
9D0104D0  000D6027   NOR T4, ZERO, T5
9D0104D4  7C0C3004   INS T4, ZERO, 0, 7
9D0104D8  0254A026   XOR S4, S2, S4
9D0104DC  01947024   AND T6, T4, S4
9D0104E0  31C200FF   ANDI V0, T6, 255
9D0104E4  AFA20014   SW V0, 20(SP)
9D0104E8  8F8580E8   LW A1, -32536(GP)
9D0104EC  24B8FFFB   ADDIU T8, A1, -5
9D0104F0  AF9880E8   SW T8, -32536(GP)
9D0104F4  8DF90054   LW T9, 84(T7)
9D0104F8  272B0005   ADDIU T3, T9, 5
9D010504  0240A021   ADDU S4, S2, ZERO
9D010508  0B40565D   J .L95
9D01050C  0240A821   ADDU S5, S2, ZERO
9D010540  0240A021   ADDU S4, S2, ZERO
1850:                         OPCODE_END
9D0104FC  1F000004   BGTZ T8, 0x9D010510
9D010500  ADEB0054   SW T3, 84(T7)
9D010510  26100002   ADDIU S0, S0, 2
9D010530  90CA0000   LBU T2, 0(A2)
9D010534  000A4080   SLL T0, T2, 2
9D010538  01161821   ADDU V1, T0, S6
9D01053C  8C650000   LW A1, 0(V1)
9D010544  0B403272   J 0x9D00C9C8
9D010548  0240A821   ADDU S5, S2, ZERO
1851:                
1852:                      OPCODE_BEGIN(68)  /* PLA */
1853:                         PLA();
9D01054C  8FB20018   LW S2, 24(SP)
9D010550  26490001   ADDIU T1, S2, 1
9D010554  312D00FF   ANDI T5, T1, 255
9D010558  AFAD0018   SW T5, 24(SP)
9D01055C  8F8C80E0   LW T4, -32544(GP)
9D010560  8FB40018   LW S4, 24(SP)
9D010564  01947021   ADDU T6, T4, S4
9D010568  91D20000   LBU S2, 0(T6)
9D01056C  8F8280E8   LW V0, -32536(GP)
9D010570  2445FFFC   ADDIU A1, V0, -4
9D010574  AF8580E8   SW A1, -32536(GP)
9D010578  26783010   ADDIU T8, S3, 12304
9D01057C  8F190054   LW T9, 84(T8)
9D010580  272B0004   ADDIU T3, T9, 4
9D01058C  0240A021   ADDU S4, S2, ZERO
9D010594  0B40565D   J .L95
9D010598  0240A821   ADDU S5, S2, ZERO
9D0105C8  0240A021   ADDU S4, S2, ZERO
1854:                         OPCODE_END
9D010584  1CA00005   BGTZ A1, .LBB1060
9D010588  AF0B0054   SW T3, 84(T8)
9D010590  02008821   ADDU S1, S0, ZERO
9D0105B8  90CA0000   LBU T2, 0(A2)
9D0105BC  000A4080   SLL T0, T2, 2
9D0105C0  01161821   ADDU V1, T0, S6
9D0105C4  8C650000   LW A1, 0(V1)
9D0105CC  26100001   ADDIU S0, S0, 1
9D0105D0  0B403272   J 0x9D00C9C8
9D0105D4  0240A821   ADDU S5, S2, ZERO
1855:                
1856:                      OPCODE_BEGIN(69)  /* ADC #$nn */
1857:                         ADC(2, IMMEDIATE_BYTE);
9D0105D8  26110001   ADDIU S1, S0, 1
9D0105FC  0298C821   ADDU T9, S4, T8
9D010600  03375821   ADDU T3, T9, S7
9D010604  7D770200   EXT S7, T3, 8, 1
9D010608  317200FF   ANDI S2, T3, 255
9D01060C  03147826   XOR T7, T8, S4
9D010610  000F2027   NOR A0, ZERO, T7
9D010614  7C043004   INS A0, ZERO, 0, 7
9D010618  0254A026   XOR S4, S2, S4
9D01061C  00943824   AND A3, A0, S4
9D010620  30FF00FF   ANDI RA, A3, 255
9D010624  AFBF0014   SW RA, 20(SP)
9D010628  8F9580E8   LW S5, -32536(GP)
9D01062C  26A6FFFE   ADDIU A2, S5, -2
9D010630  AF8680E8   SW A2, -32536(GP)
9D010634  8DAA0054   LW T2, 84(T5)
9D010638  25480002   ADDIU T0, T2, 2
9D010644  0240A021   ADDU S4, S2, ZERO
9D010648  0B40565D   J .L95
9D01064C  0240A821   ADDU S5, S2, ZERO
9D010680  0240A021   ADDU S4, S2, ZERO
1858:                         OPCODE_END
9D01063C  1CC00004   BGTZ A2, 0x9D010650
9D010640  ADA80054   SW T0, 84(T5)
9D010650  26100002   ADDIU S0, S0, 2
9D010670  90450000   LBU A1, 0(V0)
9D010674  0005C080   SLL T8, A1, 2
9D010678  0316C821   ADDU T9, T8, S6
9D01067C  8F250000   LW A1, 0(T9)
9D010684  0B403272   J 0x9D00C9C8
9D010688  0240A821   ADDU S5, S2, ZERO
1859:                
1860:                      OPCODE_BEGIN(6A)  /* ROR A */
1861:                         ROR_A();
9D01068C  0017B9C0   SLL S7, S7, 7
9D010690  32EB00FF   ANDI T3, S7, 255
9D010694  32970001   ANDI S7, S4, 1
9D010698  7E923840   EXT S2, S4, 1, 8
9D01069C  024B9025   OR S2, S2, T3
9D0106A0  8F8F80E8   LW T7, -32536(GP)
9D0106A4  25F4FFFE   ADDIU S4, T7, -2
9D0106A8  AF9480E8   SW S4, -32536(GP)
9D0106AC  26673010   ADDIU A3, S3, 12304
9D0106B0  8CE40054   LW A0, 84(A3)
9D0106B4  249F0002   ADDIU RA, A0, 2
9D0106C0  0240A021   ADDU S4, S2, ZERO
9D0106C8  0B40565D   J .L95
9D0106CC  0240A821   ADDU S5, S2, ZERO
9D0106FC  0240A021   ADDU S4, S2, ZERO
1862:                         OPCODE_END
9D0106B8  1E800005   BGTZ S4, .LBB1066
9D0106BC  ACFF0054   SW RA, 84(A3)
9D0106C4  02008821   ADDU S1, S0, ZERO
9D0106EC  91AC0000   LBU T4, 0(T5)
9D0106F0  000C8880   SLL S1, T4, 2
9D0106F4  02367021   ADDU T6, S1, S6
9D0106F8  8DC50000   LW A1, 0(T6)
9D010700  26100001   ADDIU S0, S0, 1
9D010704  0B403272   J 0x9D00C9C8
9D010708  0240A821   ADDU S5, S2, ZERO
1863:                
1864:                      OPCODE_BEGIN(6B)  /* ARR #$nn */
1865:                         ARR(2, IMMEDIATE_BYTE);
9D01070C  26110001   ADDIU S1, S0, 1
9D01072C  91E70000   LBU A3, 0(T7)
9D010730  0287A024   AND S4, S4, A3
9D010734  00142042   SRL A0, S4, 1
9D010738  0017B9C0   SLL S7, S7, 7
9D01073C  0097F825   OR RA, A0, S7
9D010740  33F200FF   ANDI S2, RA, 255
9D010744  7E570180   EXT S7, S2, 6, 1
9D010748  0012A942   SRL S5, S2, 5
9D01074C  00123182   SRL A2, S2, 6
9D010750  02A65026   XOR T2, S5, A2
9D010754  31480001   ANDI T0, T2, 1
9D010758  AFA80014   SW T0, 20(SP)
9D01075C  8F8980E8   LW T1, -32536(GP)
9D010760  2523FFFE   ADDIU V1, T1, -2
9D010764  AF8380E8   SW V1, -32536(GP)
9D010768  8F0D0054   LW T5, 84(T8)
9D01076C  25AC0002   ADDIU T4, T5, 2
9D010778  0240A021   ADDU S4, S2, ZERO
9D01077C  0B40565D   J .L95
9D010780  0240A821   ADDU S5, S2, ZERO
9D0107B4  0240A021   ADDU S4, S2, ZERO
1866:                         OPCODE_END
9D010770  1C600004   BGTZ V1, 0x9D010784
9D010774  AF0C0054   SW T4, 84(T8)
9D010784  26100002   ADDIU S0, S0, 2
9D0107A4  916F0000   LBU T7, 0(T3)
9D0107A8  000F3880   SLL A3, T7, 2
9D0107AC  00F6A021   ADDU S4, A3, S6
9D0107B0  8E850000   LW A1, 0(S4)
9D0107B8  0B403272   J 0x9D00C9C8
9D0107BC  0240A821   ADDU S5, S2, ZERO
1867:                
1868:                      OPCODE_BEGIN(6C)  /* JMP ($nnnn) */
1869:                         JMP_INDIRECT();
9D0107C0  0F4030A7   JAL bank_readword
9D0107C4  02002021   ADDU A0, S0, ZERO
9D0107C8  305000FF   ANDI S0, V0, 255
9D0107CC  240400FF   ADDIU A0, ZERO, 255
9D0107D0  16040012   BNE S0, A0, 0x9D01081C
9D0107D4  7C5F1B00   EXT RA, V0, 12, 4
9D0107F0  91AC0000   LBU T4, 0(T5)
9D0107F4  000C7200   SLL T6, T4, 8
9D010810  916F0000   LBU T7, 0(T3)
9D010814  0B40420A   J 0x9D010828
9D010818  01CF8825   OR S1, T6, T7
9D01081C  0F4030A7   JAL bank_readword
9D010820  00402021   ADDU A0, V0, ZERO
9D010824  00408821   ADDU S1, V0, ZERO
9D010828  8F8780E8   LW A3, -32536(GP)
9D01082C  24F0FFFB   ADDIU S0, A3, -5
9D010830  AF9080E8   SW S0, -32536(GP)
9D010834  267F3010   ADDIU RA, S3, 12304
9D010838  8FE40054   LW A0, 84(RA)
9D01083C  24860005   ADDIU A2, A0, 5
1870:                         OPCODE_END
9D010840  1A00144C   BLEZ S0, .L95
9D010844  AFE60054   SW A2, 84(RA)
9D010848  26300001   ADDIU S0, S1, 1
9D010868  91C50000   LBU A1, 0(T6)
9D01086C  0005C080   SLL T8, A1, 2
9D010870  03168821   ADDU S1, T8, S6
9D010874  0B403272   J 0x9D00C9C8
9D010878  8E250000   LW A1, 0(S1)
1871:                
1872:                      OPCODE_BEGIN(6D)  /* ADC $nnnn */
1873:                         ADC(4, ABSOLUTE_BYTE);
9D01087C  0F4030A7   JAL bank_readword
9D010880  02002021   ADDU A0, S0, ZERO
9D010884  26110002   ADDIU S1, S0, 2
9D010888  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D01088C  00402021   ADDU A0, V0, ZERO
9D010890  02829021   ADDU S2, S4, V0
9D010894  0257A821   ADDU S5, S2, S7
9D010898  7EB70200   EXT S7, S5, 8, 1
9D01089C  32B200FF   ANDI S2, S5, 255
9D0108A0  00541026   XOR V0, V0, S4
9D0108A4  0002C827   NOR T9, ZERO, V0
9D0108A8  7C193004   INS T9, ZERO, 0, 7
9D0108AC  0254A026   XOR S4, S2, S4
9D0108B0  03345824   AND T3, T9, S4
9D0108B4  316F00FF   ANDI T7, T3, 255
9D0108B8  AFAF0014   SW T7, 20(SP)
9D0108BC  8F8780E8   LW A3, -32536(GP)
9D0108C0  24E6FFFC   ADDIU A2, A3, -4
9D0108C4  AF8680E8   SW A2, -32536(GP)
9D0108C8  266A3010   ADDIU T2, S3, 12304
9D0108CC  8D440054   LW A0, 84(T2)
9D0108D0  24880004   ADDIU T0, A0, 4
9D0108DC  0240A021   ADDU S4, S2, ZERO
9D0108E0  0B40565D   J .L95
9D0108E4  0240A821   ADDU S5, S2, ZERO
9D010918  0240A021   ADDU S4, S2, ZERO
1874:                         OPCODE_END
9D0108D4  1CC00004   BGTZ A2, 0x9D0108E8
9D0108D8  AD480054   SW T0, 84(T2)
9D0108E8  26100003   ADDIU S0, S0, 3
9D010908  90B80000   LBU T8, 0(A1)
9D01090C  00188880   SLL S1, T8, 2
9D010910  0236A821   ADDU S5, S1, S6
9D010914  8EA50000   LW A1, 0(S5)
9D01091C  0B403272   J 0x9D00C9C8
9D010920  0240A821   ADDU S5, S2, ZERO
1875:                
1876:                      OPCODE_BEGIN(6E)  /* ROR $nnnn */
1877:                         ROR(6, ABSOLUTE, mem_writebyte, addr);
9D010924  0F4030A7   JAL bank_readword
9D010928  02002021   ADDU A0, S0, ZERO
9D01092C  0040A821   ADDU S5, V0, ZERO
9D010930  26110002   ADDIU S1, S0, 2
9D010934  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D010938  00402021   ADDU A0, V0, ZERO
9D01093C  0017B9C0   SLL S7, S7, 7
9D010940  32F200FF   ANDI S2, S7, 255
9D010944  30570001   ANDI S7, V0, 1
9D010948  7C423840   EXT V0, V0, 1, 8
9D01094C  00529025   OR S2, V0, S2
9D010950  02A02021   ADDU A0, S5, ZERO
9D010954  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D010958  02402821   ADDU A1, S2, ZERO
9D01095C  8F9980E8   LW T9, -32536(GP)
9D010960  272BFFFA   ADDIU T3, T9, -6
9D010964  AF8B80E8   SW T3, -32536(GP)
9D010968  266F3010   ADDIU T7, S3, 12304
9D01096C  8DE70054   LW A3, 84(T7)
9D010970  24E60006   ADDIU A2, A3, 6
9D01097C  0B40565D   J .L95
9D010980  0240A821   ADDU S5, S2, ZERO
1878:                         OPCODE_END
9D010974  1D600003   BGTZ T3, 0x9D010984
9D010978  ADE60054   SW A2, 84(T7)
9D010984  26100003   ADDIU S0, S0, 3
9D0109A4  91AC0000   LBU T4, 0(T5)
9D0109A8  000C7080   SLL T6, T4, 2
9D0109AC  01D62821   ADDU A1, T6, S6
9D0109B0  8CA50000   LW A1, 0(A1)
9D0109B4  0B403272   J 0x9D00C9C8
9D0109B8  0240A821   ADDU S5, S2, ZERO
1879:                
1880:                      OPCODE_BEGIN(6F)  /* RRA $nnnn */
1881:                         RRA(6, ABSOLUTE, mem_writebyte, addr);
9D0109BC  0F4030A7   JAL bank_readword
9D0109C0  02002021   ADDU A0, S0, ZERO
9D0109C4  00409021   ADDU S2, V0, ZERO
9D0109C8  26110002   ADDIU S1, S0, 2
9D0109CC  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0109D0  00402021   ADDU A0, V0, ZERO
9D0109D4  AFA20014   SW V0, 20(SP)
9D0109D8  7C583840   EXT T8, V0, 1, 8
9D0109DC  0017A9C0   SLL S5, S7, 7
9D0109E0  0315B825   OR S7, T8, S5
9D0109E4  32F500FF   ANDI S5, S7, 255
9D0109E8  02402021   ADDU A0, S2, ZERO
9D0109EC  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D0109F0  02A02821   ADDU A1, S5, ZERO
9D0109F4  0295C821   ADDU T9, S4, S5
9D0109F8  8FA20014   LW V0, 20(SP)
9D0109FC  304B0001   ANDI T3, V0, 1
9D010A00  032B7821   ADDU T7, T9, T3
9D010A04  7DF70200   EXT S7, T7, 8, 1
9D010A08  31F200FF   ANDI S2, T7, 255
9D010A0C  02B43826   XOR A3, S5, S4
9D010A10  00073027   NOR A2, ZERO, A3
9D010A14  7C063004   INS A2, ZERO, 0, 7
9D010A18  0254A026   XOR S4, S2, S4
9D010A1C  00D45024   AND T2, A2, S4
9D010A20  314400FF   ANDI A0, T2, 255
9D010A24  AFA40014   SW A0, 20(SP)
9D010A28  8F8880E8   LW T0, -32536(GP)
9D010A2C  2509FFFA   ADDIU T1, T0, -6
9D010A30  AF8980E8   SW T1, -32536(GP)
9D010A34  26633010   ADDIU V1, S3, 12304
9D010A38  8C6D0054   LW T5, 84(V1)
9D010A3C  25AC0006   ADDIU T4, T5, 6
9D010A48  0240A021   ADDU S4, S2, ZERO
9D010A4C  0B40565D   J .L95
9D010A50  0240A821   ADDU S5, S2, ZERO
9D010A84  0240A021   ADDU S4, S2, ZERO
1882:                         OPCODE_END
9D010A40  1D200004   BGTZ T1, 0x9D010A54
9D010A44  AC6C0054   SW T4, 84(V1)
9D010A54  26100003   ADDIU S0, S0, 3
9D010A74  93220000   LBU V0, 0(T9)
9D010A78  00025880   SLL T3, V0, 2
9D010A7C  01767821   ADDU T7, T3, S6
9D010A80  8DE50000   LW A1, 0(T7)
9D010A88  0B403272   J 0x9D00C9C8
9D010A8C  0240A821   ADDU S5, S2, ZERO
1883:                
1884:                      OPCODE_BEGIN(70)  /* BVS $nnnn */
1885:                         BVS();
9D010A90  8FA70014   LW A3, 20(SP)
9D010A94  10E0001F   BEQ A3, ZERO, 0x9D010B14
9D010A98  26110001   ADDIU S1, S0, 1
9D010A9C  26090001   ADDIU T1, S0, 1
9D010ABC  83110000   LB S1, 0(T8)
9D010AC0  313900FF   ANDI T9, T1, 255
9D010AC4  02391021   ADDU V0, S1, T9
9D010AC8  304B0100   ANDI T3, V0, 256
9D010ACC  11600009   BEQ T3, ZERO, 0x9D010AF4
9D010AD0  8F8480E8   LW A0, -32536(GP)
9D010AD4  8F8F80E8   LW T7, -32536(GP)
9D010AD8  25E7FFFF   ADDIU A3, T7, -1
9D010ADC  AF8780E8   SW A3, -32536(GP)
9D010AE0  26703010   ADDIU S0, S3, 12304
9D010AE4  8E060054   LW A2, 84(S0)
9D010AE8  24CA0001   ADDIU T2, A2, 1
9D010AEC  AE0A0054   SW T2, 84(S0)
9D010AF0  8F8480E8   LW A0, -32536(GP)
9D010AF4  2488FFFD   ADDIU T0, A0, -3
9D010AF8  AF8880E8   SW T0, -32536(GP)
9D010AFC  26633010   ADDIU V1, S3, 12304
9D010B00  8C6D0054   LW T5, 84(V1)
9D010B04  25AC0003   ADDIU T4, T5, 3
9D010B08  AC6C0054   SW T4, 84(V1)
9D010B0C  0B4042CC   J 0x9D010B30
9D010B10  02298821   ADDU S1, S1, T1
9D010B14  8F9080E8   LW S0, -32536(GP)
9D010B18  2606FFFE   ADDIU A2, S0, -2
9D010B1C  AF8680E8   SW A2, -32536(GP)
9D010B20  266A3010   ADDIU T2, S3, 12304
9D010B24  8D440054   LW A0, 84(T2)
9D010B28  24880002   ADDIU T0, A0, 2
9D010B2C  AD480054   SW T0, 84(T2)
1886:                         OPCODE_END
9D010B30  8F8980E8   LW T1, -32536(GP)
9D010B34  1920138F   BLEZ T1, .L95
9D010B38  26300001   ADDIU S0, S1, 1
9D010B58  904B0000   LBU T3, 0(V0)
9D010B5C  000B7880   SLL T7, T3, 2
9D010B60  01F63821   ADDU A3, T7, S6
9D010B64  0B403272   J 0x9D00C9C8
9D010B68  8CE50000   LW A1, 0(A3)
1887:                
1888:                      OPCODE_BEGIN(71)  /* ADC ($nn),Y */
1889:                         ADC(5, INDIR_Y_BYTE_READ);
9D010B98  8FAE0010   LW T6, 16(SP)
9D010B9C  03EE2821   ADDU A1, RA, T6
9D010BA0  30A4FFFF   ANDI A0, A1, -1
9D010BA4  309800FF   ANDI T8, A0, 255
9D010BA8  030EC82B   SLTU T9, T8, T6
9D010BAC  13200008   BEQ T9, ZERO, 0x9D010BD0
9D010BB0  26110001   ADDIU S1, S0, 1
9D010BB4  8F8280E8   LW V0, -32536(GP)
9D010BB8  244BFFFF   ADDIU T3, V0, -1
9D010BBC  AF8B80E8   SW T3, -32536(GP)
9D010BC0  266F3010   ADDIU T7, S3, 12304
9D010BC4  8DE70054   LW A3, 84(T7)
9D010BC8  24F20001   ADDIU S2, A3, 1
9D010BCC  ADF20054   SW S2, 84(T7)
9D010BD0  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D010BD4  00000000   NOP
9D010BD8  0282A821   ADDU S5, S4, V0
9D010BDC  02B73021   ADDU A2, S5, S7
9D010BE0  7CD70200   EXT S7, A2, 8, 1
9D010BE4  30D200FF   ANDI S2, A2, 255
9D010BE8  00545026   XOR T2, V0, S4
9D010BEC  000A2027   NOR A0, ZERO, T2
9D010BF0  7C043004   INS A0, ZERO, 0, 7
9D010BF4  0254A026   XOR S4, S2, S4
9D010BF8  00944024   AND T0, A0, S4
9D010BFC  310300FF   ANDI V1, T0, 255
9D010C00  AFA30014   SW V1, 20(SP)
9D010C04  8F8D80E8   LW T5, -32536(GP)
9D010C08  25ACFFFB   ADDIU T4, T5, -5
9D010C0C  AF8C80E8   SW T4, -32536(GP)
9D010C10  26693010   ADDIU T1, S3, 12304
9D010C14  8D2E0054   LW T6, 84(T1)
9D010C18  25C50005   ADDIU A1, T6, 5
9D010C24  0240A021   ADDU S4, S2, ZERO
9D010C28  0B40565D   J .L95
9D010C2C  0240A821   ADDU S5, S2, ZERO
9D010C60  0240A021   ADDU S4, S2, ZERO
1890:                         OPCODE_END
9D010C1C  1D800004   BGTZ T4, 0x9D010C30
9D010C20  AD250054   SW A1, 84(T1)
9D010C30  26100002   ADDIU S0, S0, 2
9D010C50  91E70000   LBU A3, 0(T7)
9D010C54  0007A880   SLL S5, A3, 2
9D010C58  02B63021   ADDU A2, S5, S6
9D010C5C  8CC50000   LW A1, 0(A2)
9D010C64  0B403272   J 0x9D00C9C8
9D010C68  0240A821   ADDU S5, S2, ZERO
1891:                
1892:                      OPCODE_BEGIN(73)  /* RRA ($nn),Y */
1893:                         RRA(8, INDIR_Y, mem_writebyte, addr);
9D010C6C  26110001   ADDIU S1, S0, 1
9D010C9C  8FBF0010   LW RA, 16(SP)
9D010CA0  00BFC021   ADDU T8, A1, RA
9D010CA4  3312FFFF   ANDI S2, T8, -1
9D010CA8  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D010CAC  02402021   ADDU A0, S2, ZERO
9D010CB0  AFA2002C   SW V0, 44(SP)
9D010CB4  7C593840   EXT T9, V0, 1, 8
9D010CB8  0017B9C0   SLL S7, S7, 7
9D010CBC  03371025   OR V0, T9, S7
9D010CC0  304B00FF   ANDI T3, V0, 255
9D010CC4  AFAB0014   SW T3, 20(SP)
9D010CC8  02402021   ADDU A0, S2, ZERO
9D010CCC  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D010CD0  01602821   ADDU A1, T3, ZERO
9D010CD4  8FAF0014   LW T7, 20(SP)
9D010CD8  028F3821   ADDU A3, S4, T7
9D010CDC  8FA6002C   LW A2, 44(SP)
9D010CE0  30CA0001   ANDI T2, A2, 1
9D010CE4  00EA2021   ADDU A0, A3, T2
9D010CE8  7C970200   EXT S7, A0, 8, 1
9D010CEC  309200FF   ANDI S2, A0, 255
9D010CF0  01F44026   XOR T0, T7, S4
9D010CF4  00081827   NOR V1, ZERO, T0
9D010CF8  7C033004   INS V1, ZERO, 0, 7
9D010CFC  0254A026   XOR S4, S2, S4
9D010D00  00746824   AND T5, V1, S4
9D010D04  31AC00FF   ANDI T4, T5, 255
9D010D08  AFAC0014   SW T4, 20(SP)
9D010D0C  8F8980E8   LW T1, -32536(GP)
9D010D10  252EFFF8   ADDIU T6, T1, -8
9D010D14  AF8E80E8   SW T6, -32536(GP)
9D010D18  8EA50054   LW A1, 84(S5)
9D010D1C  24B80008   ADDIU T8, A1, 8
9D010D28  0240A021   ADDU S4, S2, ZERO
9D010D2C  0B40565D   J .L95
9D010D30  0240A821   ADDU S5, S2, ZERO
9D010D64  0240A021   ADDU S4, S2, ZERO
1894:                         OPCODE_END
9D010D20  1DC00004   BGTZ T6, 0x9D010D34
9D010D24  AEB80054   SW T8, 84(S5)
9D010D34  26100002   ADDIU S0, S0, 2
9D010D54  91E70000   LBU A3, 0(T7)
9D010D58  00073080   SLL A2, A3, 2
9D010D5C  00D65021   ADDU T2, A2, S6
9D010D60  8D450000   LW A1, 0(T2)
9D010D68  0B403272   J 0x9D00C9C8
9D010D6C  0240A821   ADDU S5, S2, ZERO
1895:                
1896:                      OPCODE_BEGIN(75)  /* ADC $nn,X */
1897:                         ADC(4, ZP_IND_X_BYTE);
9D010D70  26110001   ADDIU S1, S0, 1
9D010D90  912E0000   LBU T6, 0(T1)
9D010D94  03CE2821   ADDU A1, FP, T6
9D010D98  30B800FF   ANDI T8, A1, 255
9D010D9C  8F9580E4   LW S5, -32540(GP)
9D010DA0  02B8F821   ADDU RA, S5, T8
9D010DA4  93F90000   LBU T9, 0(RA)
9D010DA8  02991021   ADDU V0, S4, T9
9D010DAC  00575821   ADDU T3, V0, S7
9D010DB0  7D770200   EXT S7, T3, 8, 1
9D010DB4  317200FF   ANDI S2, T3, 255
9D010DB8  03347826   XOR T7, T9, S4
9D010DBC  000F3827   NOR A3, ZERO, T7
9D010DC0  7C073004   INS A3, ZERO, 0, 7
9D010DC4  0254A026   XOR S4, S2, S4
9D010DC8  00F43024   AND A2, A3, S4
9D010DCC  30CA00FF   ANDI T2, A2, 255
9D010DD0  AFAA0014   SW T2, 20(SP)
9D010DD4  8F8480E8   LW A0, -32536(GP)
9D010DD8  248DFFFC   ADDIU T5, A0, -4
9D010DDC  AF8D80E8   SW T5, -32536(GP)
9D010DE0  8D030054   LW V1, 84(T0)
9D010DE4  246C0004   ADDIU T4, V1, 4
9D010DF0  0240A021   ADDU S4, S2, ZERO
9D010DF4  0B40565D   J .L95
9D010DF8  0240A821   ADDU S5, S2, ZERO
9D010E2C  0240A021   ADDU S4, S2, ZERO
1898:                         OPCODE_END
9D010DE8  1DA00004   BGTZ T5, 0x9D010DFC
9D010DEC  AD0C0054   SW T4, 84(T0)
9D010DFC  26100002   ADDIU S0, S0, 2
9D010E1C  92BF0000   LBU RA, 0(S5)
9D010E20  001FC880   SLL T9, RA, 2
9D010E24  03361021   ADDU V0, T9, S6
9D010E28  8C450000   LW A1, 0(V0)
9D010E30  0B403272   J 0x9D00C9C8
9D010E34  0240A821   ADDU S5, S2, ZERO
1899:                
1900:                      OPCODE_BEGIN(76)  /* ROR $nn,X */
1901:                         ROR(6, ZP_IND_X, ZP_WRITEBYTE, baddr);
9D010E38  26110001   ADDIU S1, S0, 1
9D010E58  908D0000   LBU T5, 0(A0)
9D010E5C  03CD1821   ADDU V1, FP, T5
9D010E60  306C00FF   ANDI T4, V1, 255
9D010E64  8F8880E4   LW T0, -32540(GP)
9D010E68  010C4821   ADDU T1, T0, T4
9D010E6C  912E0000   LBU T6, 0(T1)
9D010E70  0017B9C0   SLL S7, S7, 7
9D010E74  32E500FF   ANDI A1, S7, 255
9D010E78  31D70001   ANDI S7, T6, 1
9D010E7C  000EC042   SRL T8, T6, 1
9D010E80  00B89025   OR S2, A1, T8
9D010E84  A1320000   SB S2, 0(T1)
9D010E88  8F9580E8   LW S5, -32536(GP)
9D010E8C  26BFFFFA   ADDIU RA, S5, -6
9D010E90  AF9F80E8   SW RA, -32536(GP)
9D010E94  8DF90054   LW T9, 84(T7)
9D010E98  27220006   ADDIU V0, T9, 6
9D010EA4  0B40565D   J .L95
9D010EA8  0240A821   ADDU S5, S2, ZERO
1902:                         OPCODE_END
9D010E9C  1FE00003   BGTZ RA, 0x9D010EAC
9D010EA0  ADE20054   SW V0, 84(T7)
9D010EAC  26100002   ADDIU S0, S0, 2
9D010ECC  908D0000   LBU T5, 0(A0)
9D010ED0  000D1880   SLL V1, T5, 2
9D010ED4  00766021   ADDU T4, V1, S6
9D010ED8  8D850000   LW A1, 0(T4)
9D010EDC  0B403272   J 0x9D00C9C8
9D010EE0  0240A821   ADDU S5, S2, ZERO
1903:                
1904:                      OPCODE_BEGIN(77)  /* RRA $nn,X */
1905:                         RRA(6, ZP_IND_X, ZP_WRITEBYTE, baddr);
9D010EE4  26110001   ADDIU S1, S0, 1
9D010F04  92BF0000   LBU RA, 0(S5)
9D010F08  03DFC821   ADDU T9, FP, RA
9D010F0C  332200FF   ANDI V0, T9, 255
9D010F10  8F8B80E4   LW T3, -32540(GP)
9D010F14  01627821   ADDU T7, T3, V0
9D010F18  91E70000   LBU A3, 0(T7)
9D010F1C  00073042   SRL A2, A3, 1
9D010F20  0017B9C0   SLL S7, S7, 7
9D010F24  00D75025   OR T2, A2, S7
9D010F28  314D00FF   ANDI T5, T2, 255
9D010F2C  A1ED0000   SB T5, 0(T7)
9D010F30  028D1821   ADDU V1, S4, T5
9D010F34  30E40001   ANDI A0, A3, 1
9D010F38  00646021   ADDU T4, V1, A0
9D010F3C  7D970200   EXT S7, T4, 8, 1
9D010F40  319200FF   ANDI S2, T4, 255
9D010F44  01B44026   XOR T0, T5, S4
9D010F48  00087027   NOR T6, ZERO, T0
9D010F4C  7C0E3004   INS T6, ZERO, 0, 7
9D010F50  0254A026   XOR S4, S2, S4
9D010F54  01D42824   AND A1, T6, S4
9D010F58  30B800FF   ANDI T8, A1, 255
9D010F5C  AFB80014   SW T8, 20(SP)
9D010F60  8F9580E8   LW S5, -32536(GP)
9D010F64  26BFFFFA   ADDIU RA, S5, -6
9D010F68  AF9F80E8   SW RA, -32536(GP)
9D010F6C  8D390054   LW T9, 84(T1)
9D010F70  27220006   ADDIU V0, T9, 6
9D010F7C  0240A021   ADDU S4, S2, ZERO
9D010F80  0B40565D   J .L95
9D010F84  0240A821   ADDU S5, S2, ZERO
9D010FB8  0240A021   ADDU S4, S2, ZERO
1906:                         OPCODE_END
9D010F74  1FE00004   BGTZ RA, 0x9D010F88
9D010F78  AD220054   SW V0, 84(T1)
9D010F88  26100002   ADDIU S0, S0, 2
9D010FA8  914D0000   LBU T5, 0(T2)
9D010FAC  000D1880   SLL V1, T5, 2
9D010FB0  00762021   ADDU A0, V1, S6
9D010FB4  8C850000   LW A1, 0(A0)
9D010FBC  0B403272   J 0x9D00C9C8
9D010FC0  0240A821   ADDU S5, S2, ZERO
1907:                
1908:                      OPCODE_BEGIN(78)  /* SEI */
1909:                         SEI();
9D010FC4  8F8C80E8   LW T4, -32536(GP)
9D010FC8  2588FFFE   ADDIU T0, T4, -2
9D010FCC  AF8880E8   SW T0, -32536(GP)
9D010FD0  266E3010   ADDIU T6, S3, 12304
9D010FD4  8DC50054   LW A1, 84(T6)
9D010FD8  24B80002   ADDIU T8, A1, 2
9D010FE8  24130001   ADDIU S3, ZERO, 1
9D010FEC  0B40565D   J .L95
9D010FF0  AFB3001C   SW S3, 28(SP)
9D011024  240D0001   ADDIU T5, ZERO, 1
1910:                         OPCODE_END
9D010FDC  1D000005   BGTZ T0, .LBB1112
9D010FE0  ADD80054   SW T8, 84(T6)
9D010FE4  02008821   ADDU S1, S0, ZERO
9D011010  90F10000   LBU S1, 0(A3)
9D011014  00113080   SLL A2, S1, 2
9D011018  00D65021   ADDU T2, A2, S6
9D01101C  8D450000   LW A1, 0(T2)
9D011020  26100001   ADDIU S0, S0, 1
9D011028  0B403272   J 0x9D00C9C8
9D01102C  AFAD001C   SW T5, 28(SP)
1911:                
1912:                      OPCODE_BEGIN(79)  /* ADC $nnnn,Y */
1913:                         ADC(4, ABS_IND_Y_BYTE_READ);
9D011030  0F4030A7   JAL bank_readword
9D011034  02002021   ADDU A0, S0, ZERO
9D011038  8FB20010   LW S2, 16(SP)
9D01103C  0052A821   ADDU S5, V0, S2
9D011040  32A4FFFF   ANDI A0, S5, -1
9D011044  308300FF   ANDI V1, A0, 255
9D011048  0072602B   SLTU T4, V1, S2
9D01104C  11800008   BEQ T4, ZERO, 0x9D011070
9D011050  26110002   ADDIU S1, S0, 2
9D011054  8F8880E8   LW T0, -32536(GP)
9D011058  250EFFFF   ADDIU T6, T0, -1
9D01105C  AF8E80E8   SW T6, -32536(GP)
9D011060  26653010   ADDIU A1, S3, 12304
9D011064  8CB80054   LW T8, 84(A1)
9D011068  271F0001   ADDIU RA, T8, 1
9D01106C  ACBF0054   SW RA, 84(A1)
9D011070  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D011074  00000000   NOP
9D011078  02822021   ADDU A0, S4, V0
9D01107C  0097C821   ADDU T9, A0, S7
9D011080  7F370200   EXT S7, T9, 8, 1
9D011084  333200FF   ANDI S2, T9, 255
9D011088  00541026   XOR V0, V0, S4
9D01108C  00024827   NOR T1, ZERO, V0
9D011090  7C093004   INS T1, ZERO, 0, 7
9D011094  0254A026   XOR S4, S2, S4
9D011098  01345824   AND T3, T1, S4
9D01109C  316F00FF   ANDI T7, T3, 255
9D0110A0  AFAF0014   SW T7, 20(SP)
9D0110A4  8F8780E8   LW A3, -32536(GP)
9D0110A8  24E6FFFC   ADDIU A2, A3, -4
9D0110AC  AF8680E8   SW A2, -32536(GP)
9D0110B0  266A3010   ADDIU T2, S3, 12304
9D0110B4  8D4D0054   LW T5, 84(T2)
9D0110B8  25B50004   ADDIU S5, T5, 4
9D0110C4  0240A021   ADDU S4, S2, ZERO
9D0110C8  0B40565D   J .L95
9D0110CC  0240A821   ADDU S5, S2, ZERO
9D011100  0240A021   ADDU S4, S2, ZERO
1914:                         OPCODE_END
9D0110BC  1CC00004   BGTZ A2, 0x9D0110D0
9D0110C0  AD550054   SW S5, 84(T2)
9D0110D0  26100003   ADDIU S0, S0, 3
9D0110F0  931F0000   LBU RA, 0(T8)
9D0110F4  001F2080   SLL A0, RA, 2
9D0110F8  0096C821   ADDU T9, A0, S6
9D0110FC  8F250000   LW A1, 0(T9)
9D011104  0B403272   J 0x9D00C9C8
9D011108  0240A821   ADDU S5, S2, ZERO
1915:                
1916:                      OPCODE_BEGIN(7B)  /* RRA $nnnn,Y */
1917:                         RRA(7, ABS_IND_Y, mem_writebyte, addr);
9D01110C  0F4030A7   JAL bank_readword
9D011110  02002021   ADDU A0, S0, ZERO
9D011114  26110002   ADDIU S1, S0, 2
9D011118  8FB20010   LW S2, 16(SP)
9D01111C  00521021   ADDU V0, V0, S2
9D011120  3052FFFF   ANDI S2, V0, -1
9D011124  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D011128  02402021   ADDU A0, S2, ZERO
9D01112C  AFA20014   SW V0, 20(SP)
9D011130  7C493840   EXT T1, V0, 1, 8
9D011134  0017B9C0   SLL S7, S7, 7
9D011138  01375825   OR T3, T1, S7
9D01113C  317500FF   ANDI S5, T3, 255
9D011140  02402021   ADDU A0, S2, ZERO
9D011144  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D011148  02A02821   ADDU A1, S5, ZERO
9D01114C  02957821   ADDU T7, S4, S5
9D011150  8FA70014   LW A3, 20(SP)
9D011154  30E60001   ANDI A2, A3, 1
9D011158  01E65021   ADDU T2, T7, A2
9D01115C  7D570200   EXT S7, T2, 8, 1
9D011160  315200FF   ANDI S2, T2, 255
9D011164  02B46826   XOR T5, S5, S4
9D011168  000D1827   NOR V1, ZERO, T5
9D01116C  7C033004   INS V1, ZERO, 0, 7
9D011170  0254A026   XOR S4, S2, S4
9D011174  00746024   AND T4, V1, S4
9D011178  318800FF   ANDI T0, T4, 255
9D01117C  AFA80014   SW T0, 20(SP)
9D011180  8F8E80E8   LW T6, -32536(GP)
9D011184  25C5FFF9   ADDIU A1, T6, -7
9D011188  AF8580E8   SW A1, -32536(GP)
9D01118C  26783010   ADDIU T8, S3, 12304
9D011190  8F040054   LW A0, 84(T8)
9D011194  24990007   ADDIU T9, A0, 7
9D0111A0  0240A021   ADDU S4, S2, ZERO
9D0111A4  0B40565D   J .L95
9D0111A8  0240A821   ADDU S5, S2, ZERO
9D0111DC  0240A021   ADDU S4, S2, ZERO
1918:                         OPCODE_END
9D011198  1CA00004   BGTZ A1, 0x9D0111AC
9D01119C  AF190054   SW T9, 84(T8)
9D0111AC  26100003   ADDIU S0, S0, 3
9D0111CC  91E70000   LBU A3, 0(T7)
9D0111D0  00073080   SLL A2, A3, 2
9D0111D4  00D65021   ADDU T2, A2, S6
9D0111D8  8D450000   LW A1, 0(T2)
9D0111E0  0B403272   J 0x9D00C9C8
9D0111E4  0240A821   ADDU S5, S2, ZERO
1919:                
1920:                      OPCODE_BEGIN(7D)  /* ADC $nnnn,X */
1921:                         ADC(4, ABS_IND_X_BYTE_READ);
9D0111E8  0F4030A7   JAL bank_readword
9D0111EC  02002021   ADDU A0, S0, ZERO
9D0111F0  005E9021   ADDU S2, V0, FP
9D0111F4  3244FFFF   ANDI A0, S2, -1
9D0111F8  308D00FF   ANDI T5, A0, 255
9D0111FC  01BE182B   SLTU V1, T5, FP
9D011200  10600008   BEQ V1, ZERO, 0x9D011224
9D011204  26110002   ADDIU S1, S0, 2
9D011208  8F8C80E8   LW T4, -32536(GP)
9D01120C  2588FFFF   ADDIU T0, T4, -1
9D011210  AF8880E8   SW T0, -32536(GP)
9D011214  266E3010   ADDIU T6, S3, 12304
9D011218  8DC50054   LW A1, 84(T6)
9D01121C  24B80001   ADDIU T8, A1, 1
9D011220  ADD80054   SW T8, 84(T6)
9D011224  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D011228  00000000   NOP
9D01122C  02822021   ADDU A0, S4, V0
9D011230  0097C821   ADDU T9, A0, S7
9D011234  7F370200   EXT S7, T9, 8, 1
9D011238  333200FF   ANDI S2, T9, 255
9D01123C  00544826   XOR T1, V0, S4
9D011240  00091027   NOR V0, ZERO, T1
9D011244  7C023004   INS V0, ZERO, 0, 7
9D011248  0254A026   XOR S4, S2, S4
9D01124C  00545824   AND T3, V0, S4
9D011250  317500FF   ANDI S5, T3, 255
9D011254  AFB50014   SW S5, 20(SP)
9D011258  8F8F80E8   LW T7, -32536(GP)
9D01125C  25E7FFFC   ADDIU A3, T7, -4
9D011260  AF8780E8   SW A3, -32536(GP)
9D011264  26663010   ADDIU A2, S3, 12304
9D011268  8CCA0054   LW T2, 84(A2)
9D01126C  254D0004   ADDIU T5, T2, 4
9D011278  0240A021   ADDU S4, S2, ZERO
9D01127C  0B40565D   J .L95
9D011280  0240A821   ADDU S5, S2, ZERO
9D0112B4  0240A021   ADDU S4, S2, ZERO
1922:                         OPCODE_END
9D011270  1CE00004   BGTZ A3, 0x9D011284
9D011274  ACCD0054   SW T5, 84(A2)
9D011284  26100003   ADDIU S0, S0, 3
9D0112A4  90B80000   LBU T8, 0(A1)
9D0112A8  00182080   SLL A0, T8, 2
9D0112AC  0096C821   ADDU T9, A0, S6
9D0112B0  8F250000   LW A1, 0(T9)
9D0112B8  0B403272   J 0x9D00C9C8
9D0112BC  0240A821   ADDU S5, S2, ZERO
1923:                
1924:                      OPCODE_BEGIN(7E)  /* ROR $nnnn,X */
1925:                         ROR(7, ABS_IND_X, mem_writebyte, addr);
9D0112C0  0F4030A7   JAL bank_readword
9D0112C4  02002021   ADDU A0, S0, ZERO
9D0112C8  26110002   ADDIU S1, S0, 2
9D0112CC  005E9021   ADDU S2, V0, FP
9D0112D0  3255FFFF   ANDI S5, S2, -1
9D0112D4  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0112D8  02A02021   ADDU A0, S5, ZERO
9D0112DC  0017B9C0   SLL S7, S7, 7
9D0112E0  32E900FF   ANDI T1, S7, 255
9D0112E4  30570001   ANDI S7, V0, 1
9D0112E8  7C423840   EXT V0, V0, 1, 8
9D0112EC  00499025   OR S2, V0, T1
9D0112F0  02A02021   ADDU A0, S5, ZERO
9D0112F4  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D0112F8  02402821   ADDU A1, S2, ZERO
9D0112FC  8F8B80E8   LW T3, -32536(GP)
9D011300  256FFFF9   ADDIU T7, T3, -7
9D011304  AF8F80E8   SW T7, -32536(GP)
9D011308  26673010   ADDIU A3, S3, 12304
9D01130C  8CE60054   LW A2, 84(A3)
9D011310  24CA0007   ADDIU T2, A2, 7
9D01131C  0B40565D   J .L95
9D011320  0240A821   ADDU S5, S2, ZERO
1926:                         OPCODE_END
9D011314  1DE00003   BGTZ T7, 0x9D011324
9D011318  ACEA0054   SW T2, 84(A3)
9D011324  26100003   ADDIU S0, S0, 3
9D011344  91C50000   LBU A1, 0(T6)
9D011348  0005C080   SLL T8, A1, 2
9D01134C  03162021   ADDU A0, T8, S6
9D011350  8C850000   LW A1, 0(A0)
9D011354  0B403272   J 0x9D00C9C8
9D011358  0240A821   ADDU S5, S2, ZERO
1927:                
1928:                      OPCODE_BEGIN(7F)  /* RRA $nnnn,X */
1929:                         RRA(7, ABS_IND_X, mem_writebyte, addr);
9D01135C  0F4030A7   JAL bank_readword
9D011360  02002021   ADDU A0, S0, ZERO
9D011364  26110002   ADDIU S1, S0, 2
9D011368  005EC821   ADDU T9, V0, FP
9D01136C  3332FFFF   ANDI S2, T9, -1
9D011370  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D011374  02402021   ADDU A0, S2, ZERO
9D011378  AFA20014   SW V0, 20(SP)
9D01137C  7C553840   EXT S5, V0, 1, 8
9D011380  0017B9C0   SLL S7, S7, 7
9D011384  02B74825   OR T1, S5, S7
9D011388  313500FF   ANDI S5, T1, 255
9D01138C  02402021   ADDU A0, S2, ZERO
9D011390  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D011394  02A02821   ADDU A1, S5, ZERO
9D011398  02955821   ADDU T3, S4, S5
9D01139C  8FA20014   LW V0, 20(SP)
9D0113A0  304F0001   ANDI T7, V0, 1
9D0113A4  016F3821   ADDU A3, T3, T7
9D0113A8  7CF70200   EXT S7, A3, 8, 1
9D0113AC  30F200FF   ANDI S2, A3, 255
9D0113B0  02B43026   XOR A2, S5, S4
9D0113B4  00065027   NOR T2, ZERO, A2
9D0113B8  7C0A3004   INS T2, ZERO, 0, 7
9D0113BC  0254A026   XOR S4, S2, S4
9D0113C0  01546824   AND T5, T2, S4
9D0113C4  31A300FF   ANDI V1, T5, 255
9D0113C8  AFA30014   SW V1, 20(SP)
9D0113CC  8F8C80E8   LW T4, -32536(GP)
9D0113D0  2588FFF9   ADDIU T0, T4, -7
9D0113D4  AF8880E8   SW T0, -32536(GP)
9D0113D8  266E3010   ADDIU T6, S3, 12304
9D0113DC  8DC50054   LW A1, 84(T6)
9D0113E0  24B80007   ADDIU T8, A1, 7
9D0113EC  0240A021   ADDU S4, S2, ZERO
9D0113F0  0B40565D   J .L95
9D0113F4  0240A821   ADDU S5, S2, ZERO
9D011428  0240A021   ADDU S4, S2, ZERO
1930:                         OPCODE_END
9D0113E4  1D000004   BGTZ T0, 0x9D0113F8
9D0113E8  ADD80054   SW T8, 84(T6)
9D0113F8  26100003   ADDIU S0, S0, 3
9D011418  91620000   LBU V0, 0(T3)
9D01141C  00027880   SLL T7, V0, 2
9D011420  01F63821   ADDU A3, T7, S6
9D011424  8CE50000   LW A1, 0(A3)
9D01142C  0B403272   J 0x9D00C9C8
9D011430  0240A821   ADDU S5, S2, ZERO
1931:                
1932:                      OPCODE_BEGIN(80)  /* NOP #$nn */
1933:                      OPCODE_BEGIN(82)  /* NOP #$nn */
1934:                      OPCODE_BEGIN(89)  /* NOP #$nn */
1935:                      OPCODE_BEGIN(C2)  /* NOP #$nn */
1936:                      OPCODE_BEGIN(E2)  /* NOP #$nn */
1937:                         DOP(2);
9D011434  0B404514   J 0x9D011450
9D011438  26110001   ADDIU S1, S0, 1
9D01143C  0B404514   J 0x9D011450
9D011440  26110001   ADDIU S1, S0, 1
9D011444  0B404514   J 0x9D011450
9D011448  26110001   ADDIU S1, S0, 1
9D01144C  26110001   ADDIU S1, S0, 1
9D011450  8F8680E8   LW A2, -32536(GP)
9D011454  24CAFFFE   ADDIU T2, A2, -2
9D011458  AF8A80E8   SW T2, -32536(GP)
9D01145C  266D3010   ADDIU T5, S3, 12304
9D011460  8DA30054   LW V1, 84(T5)
9D011464  246C0002   ADDIU T4, V1, 2
1938:                         OPCODE_END
9D011468  19401142   BLEZ T2, .L95
9D01146C  ADAC0054   SW T4, 84(T5)
9D011470  26100002   ADDIU S0, S0, 2
9D011490  93290000   LBU T1, 0(T9)
9D011494  00098880   SLL S1, T1, 2
9D011498  02365821   ADDU T3, S1, S6
9D01149C  0B403272   J 0x9D00C9C8
9D0114A0  8D650000   LW A1, 0(T3)
1939:                
1940:                      OPCODE_BEGIN(81)  /* STA ($nn,X) */
1941:                         STA(6, INDIR_X_ADDR, mem_writebyte, addr);
9D0114A4  26110001   ADDIU S1, S0, 1
9D0114C8  91880000   LBU T0, 0(T4)
9D0114CC  03C87021   ADDU T6, FP, T0
9D0114DC  97E40000   LHU A0, 0(RA)
9D0114E0  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D0114E4  02802821   ADDU A1, S4, ZERO
9D0114E8  8F8480E8   LW A0, -32536(GP)
9D0114EC  2499FFFA   ADDIU T9, A0, -6
9D0114F0  AF9980E8   SW T9, -32536(GP)
9D0114F4  3C09A001   LUI T1, -24575
9D0114F8  252B3010   ADDIU T3, T1, 12304
9D0114FC  8D620054   LW V0, 84(T3)
9D011500  244F0006   ADDIU T7, V0, 6
1942:                         OPCODE_END
9D011504  1B20111B   BLEZ T9, .L95
9D011508  AD6F0054   SW T7, 84(T3)
9D01150C  26100002   ADDIU S0, S0, 2
9D01152C  91880000   LBU T0, 0(T4)
9D011530  00087080   SLL T6, T0, 2
9D011534  01D62821   ADDU A1, T6, S6
9D011538  0B403272   J 0x9D00C9C8
9D01153C  8CA50000   LW A1, 0(A1)
1943:                
1944:                      OPCODE_BEGIN(83)  /* SAX ($nn,X) */
1945:                         SAX(6, INDIR_X_ADDR, mem_writebyte, addr);
9D011540  26110001   ADDIU S1, S0, 1
9D011564  91E70000   LBU A3, 0(T7)
9D011568  03C73021   ADDU A2, FP, A3
9D011578  03D46024   AND T4, FP, S4
9D01157C  94640000   LHU A0, 0(V1)
9D011580  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D011584  318500FF   ANDI A1, T4, 255
9D011588  8F8880E8   LW T0, -32536(GP)
9D01158C  250EFFFA   ADDIU T6, T0, -6
9D011590  AF8E80E8   SW T6, -32536(GP)
9D011594  3C05A001   LUI A1, -24575
9D011598  24B83010   ADDIU T8, A1, 12304
9D01159C  8F040054   LW A0, 84(T8)
9D0115A0  24990006   ADDIU T9, A0, 6
1946:                         OPCODE_END
9D0115A4  19C010F3   BLEZ T6, .L95
9D0115A8  AF190054   SW T9, 84(T8)
9D0115AC  26100002   ADDIU S0, S0, 2
9D0115CC  90E60000   LBU A2, 0(A3)
9D0115D0  00065080   SLL T2, A2, 2
9D0115D4  01566821   ADDU T5, T2, S6
9D0115D8  0B403272   J 0x9D00C9C8
9D0115DC  8DA50000   LW A1, 0(T5)
1947:                
1948:                      OPCODE_BEGIN(84)  /* STY $nn */
1949:                         STY(3, ZERO_PAGE_ADDR, ZP_WRITEBYTE, baddr);
9D0115E0  26110001   ADDIU S1, S0, 1
9D011600  90990000   LBU T9, 0(A0)
9D011604  8F9F80E4   LW RA, -32540(GP)
9D011608  03F94821   ADDU T1, RA, T9
9D01160C  8FAB0010   LW T3, 16(SP)
9D011610  A12B0000   SB T3, 0(T1)
9D011614  8F8280E8   LW V0, -32536(GP)
9D011618  244FFFFD   ADDIU T7, V0, -3
9D01161C  AF8F80E8   SW T7, -32536(GP)
9D011620  8DC70054   LW A3, 84(T6)
9D011624  24E60003   ADDIU A2, A3, 3
1950:                         OPCODE_END
9D011628  19E010D2   BLEZ T7, .L95
9D01162C  ADC60054   SW A2, 84(T6)
9D011630  26100002   ADDIU S0, S0, 2
9D01164C  91C80000   LBU T0, 0(T6)
9D011650  00082880   SLL A1, T0, 2
9D011654  00B6C021   ADDU T8, A1, S6
9D011658  0B403272   J 0x9D00C9C8
9D01165C  8F050000   LW A1, 0(T8)
1951:                
1952:                      OPCODE_BEGIN(85)  /* STA $nn */
1953:                         STA(3, ZERO_PAGE_ADDR, ZP_WRITEBYTE, baddr);
9D011660  26110001   ADDIU S1, S0, 1
9D011680  91E70000   LBU A3, 0(T7)
9D011684  8F8680E4   LW A2, -32540(GP)
9D011688  00C75021   ADDU T2, A2, A3
9D01168C  A1540000   SB S4, 0(T2)
9D011690  8F8D80E8   LW T5, -32536(GP)
9D011694  25A3FFFD   ADDIU V1, T5, -3
9D011698  AF8380E8   SW V1, -32536(GP)
9D01169C  8FEC0054   LW T4, 84(RA)
9D0116A0  258E0003   ADDIU T6, T4, 3
1954:                         OPCODE_END
9D0116A4  186010B3   BLEZ V1, .L95
9D0116A8  AFEE0054   SW T6, 84(RA)
9D0116AC  26100002   ADDIU S0, S0, 2
9D0116C8  933F0000   LBU RA, 0(T9)
9D0116CC  001F4880   SLL T1, RA, 2
9D0116D0  01365821   ADDU T3, T1, S6
9D0116D4  0B403272   J 0x9D00C9C8
9D0116D8  8D650000   LW A1, 0(T3)
1955:                
1956:                      OPCODE_BEGIN(86)  /* STX $nn */
1957:                         STX(3, ZERO_PAGE_ADDR, ZP_WRITEBYTE, baddr);
9D0116DC  26110001   ADDIU S1, S0, 1
9D0116FC  906C0000   LBU T4, 0(V1)
9D011700  8F8E80E4   LW T6, -32540(GP)
9D011704  01CC4021   ADDU T0, T6, T4
9D011708  A11E0000   SB FP, 0(T0)
9D01170C  8F8580E8   LW A1, -32536(GP)
9D011710  24B8FFFD   ADDIU T8, A1, -3
9D011714  AF9880E8   SW T8, -32536(GP)
9D011718  8CE40054   LW A0, 84(A3)
9D01171C  24990003   ADDIU T9, A0, 3
1958:                         OPCODE_END
9D011720  1B001094   BLEZ T8, .L95
9D011724  ACF90054   SW T9, 84(A3)
9D011728  26100002   ADDIU S0, S0, 2
9D011744  91E70000   LBU A3, 0(T7)
9D011748  00073080   SLL A2, A3, 2
9D01174C  00D65021   ADDU T2, A2, S6
9D011750  0B403272   J 0x9D00C9C8
9D011754  8D450000   LW A1, 0(T2)
1959:                
1960:                      OPCODE_BEGIN(87)  /* SAX $nn */
1961:                         SAX(3, ZERO_PAGE_ADDR, ZP_WRITEBYTE, baddr);
9D011758  26110001   ADDIU S1, S0, 1
9D011778  93190000   LBU T9, 0(T8)
9D01177C  8F8480E4   LW A0, -32540(GP)
9D011780  0099F821   ADDU RA, A0, T9
9D011784  03D44824   AND T1, FP, S4
9D011788  A3E90000   SB T1, 0(RA)
9D01178C  8F8B80E8   LW T3, -32536(GP)
9D011790  2562FFFD   ADDIU V0, T3, -3
9D011794  AF8280E8   SW V0, -32536(GP)
9D011798  8D8F0054   LW T7, 84(T4)
9D01179C  25E70003   ADDIU A3, T7, 3
1962:                         OPCODE_END
9D0117A0  18401074   BLEZ V0, .L95
9D0117A4  AD870054   SW A3, 84(T4)
9D0117A8  26100002   ADDIU S0, S0, 2
9D0117C4  918E0000   LBU T6, 0(T4)
9D0117C8  000E4080   SLL T0, T6, 2
9D0117CC  01162821   ADDU A1, T0, S6
9D0117D0  0B403272   J 0x9D00C9C8
9D0117D4  8CA50000   LW A1, 0(A1)
1963:                
1964:                      OPCODE_BEGIN(88)  /* DEY */
1965:                         DEY();
9D0117D8  8FB20010   LW S2, 16(SP)
9D0117DC  2655FFFF   ADDIU S5, S2, -1
9D0117E0  32B200FF   ANDI S2, S5, 255
9D0117E4  8F9880E8   LW T8, -32536(GP)
9D0117E8  2719FFFE   ADDIU T9, T8, -2
9D0117EC  AF9980E8   SW T9, -32536(GP)
9D0117F0  267F3010   ADDIU RA, S3, 12304
9D0117F4  8FE40054   LW A0, 84(RA)
9D0117F8  24890002   ADDIU T1, A0, 2
9D011804  AFB20010   SW S2, 16(SP)
9D01180C  0B40565D   J .L95
9D011810  0240A821   ADDU S5, S2, ZERO
9D011840  AFB20010   SW S2, 16(SP)
1966:                         OPCODE_END
9D0117FC  1F200005   BGTZ T9, .LBB1154
9D011800  AFE90054   SW T1, 84(RA)
9D011808  02008821   ADDU S1, S0, ZERO
9D011830  91B10000   LBU S1, 0(T5)
9D011834  00111880   SLL V1, S1, 2
9D011838  00766021   ADDU T4, V1, S6
9D01183C  8D850000   LW A1, 0(T4)
9D011844  26100001   ADDIU S0, S0, 1
9D011848  0B403272   J 0x9D00C9C8
9D01184C  0240A821   ADDU S5, S2, ZERO
1967:                
1968:                      OPCODE_BEGIN(8A)  /* TXA */
1969:                         TXA();
9D011850  8F9480E8   LW S4, -32536(GP)
9D011854  268EFFFE   ADDIU T6, S4, -2
9D011858  AF8E80E8   SW T6, -32536(GP)
9D01185C  26683010   ADDIU T0, S3, 12304
9D011860  8D050054   LW A1, 84(T0)
9D011864  24B20002   ADDIU S2, A1, 2
1970:                         OPCODE_END
9D011868  1DC00006   BGTZ T6, .LBB1156
9D01186C  AD120054   SW S2, 84(T0)
9D011870  03C09021   ADDU S2, FP, ZERO
9D011874  03C0A021   ADDU S4, FP, ZERO
9D011878  02008821   ADDU S1, S0, ZERO
9D01187C  0B40565D   J .L95
9D011880  03C0A821   ADDU S5, FP, ZERO
9D0118A0  916F0000   LBU T7, 0(T3)
9D0118A4  000F1080   SLL V0, T7, 2
9D0118A8  00563821   ADDU A3, V0, S6
9D0118AC  8CE50000   LW A1, 0(A3)
9D0118B0  03C0A021   ADDU S4, FP, ZERO
9D0118B4  26100001   ADDIU S0, S0, 1
9D0118B8  03C0A821   ADDU S5, FP, ZERO
9D0118BC  0B403272   J 0x9D00C9C8
9D0118C0  03C09021   ADDU S2, FP, ZERO
1971:                
1972:                      OPCODE_BEGIN(8B)  /* ANE #$nn */
1973:                         ANE(2, IMMEDIATE_BYTE);
9D0118C4  26110001   ADDIU S1, S0, 1
9D0118C8  2406FFEE   ADDIU A2, ZERO, -18
9D0118CC  02865025   OR T2, S4, A2
9D0118D0  03CA6824   AND T5, FP, T2
9D0118F0  92550000   LBU S5, 0(S2)
9D0118F4  01B59024   AND S2, T5, S5
9D0118F8  8F9880E8   LW T8, -32536(GP)
9D0118FC  2719FFFE   ADDIU T9, T8, -2
9D011900  AF9980E8   SW T9, -32536(GP)
9D011904  8E9F0054   LW RA, 84(S4)
9D011908  27E40002   ADDIU A0, RA, 2
9D011914  0240A021   ADDU S4, S2, ZERO
9D011918  0B40565D   J .L95
9D01191C  0240A821   ADDU S5, S2, ZERO
9D011950  0240A021   ADDU S4, S2, ZERO
1974:                         OPCODE_END
9D01190C  1F200004   BGTZ T9, 0x9D011920
9D011910  AE840054   SW A0, 84(S4)
9D011920  26100002   ADDIU S0, S0, 2
9D011940  90CA0000   LBU T2, 0(A2)
9D011944  000A6880   SLL T5, T2, 2
9D011948  01B61821   ADDU V1, T5, S6
9D01194C  8C650000   LW A1, 0(V1)
9D011954  0B403272   J 0x9D00C9C8
9D011958  0240A821   ADDU S5, S2, ZERO
1975:                
1976:                      OPCODE_BEGIN(8C)  /* STY $nnnn */
1977:                         STY(4, ABSOLUTE_ADDR, mem_writebyte, addr);
9D01195C  0F4030A7   JAL bank_readword
9D011960  02002021   ADDU A0, S0, ZERO
9D011964  26110002   ADDIU S1, S0, 2
9D011968  00402021   ADDU A0, V0, ZERO
9D01196C  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D011970  8FA50010   LW A1, 16(SP)
9D011974  8F8C80E8   LW T4, -32536(GP)
9D011978  258EFFFC   ADDIU T6, T4, -4
9D01197C  AF8E80E8   SW T6, -32536(GP)
9D011980  26683010   ADDIU T0, S3, 12304
9D011984  8D050054   LW A1, 84(T0)
9D011988  24B80004   ADDIU T8, A1, 4
1978:                         OPCODE_END
9D01198C  19C00FF9   BLEZ T6, .L95
9D011990  AD180054   SW T8, 84(T0)
9D011994  26100003   ADDIU S0, S0, 3
9D0119B4  90510000   LBU S1, 0(V0)
9D0119B8  00113880   SLL A3, S1, 2
9D0119BC  00F63021   ADDU A2, A3, S6
9D0119C0  0B403272   J 0x9D00C9C8
9D0119C4  8CC50000   LW A1, 0(A2)
1979:                
1980:                      OPCODE_BEGIN(8D)  /* STA $nnnn */
1981:                      //mem_writebyte(addr, A);
1982:                      //addr = bank_readword(PC);   
1983:                         STA(4, ABSOLUTE_ADDR, mem_writebyte, addr);
9D0119C8  0F4030A7   JAL bank_readword
9D0119CC  02002021   ADDU A0, S0, ZERO
9D0119D0  26110002   ADDIU S1, S0, 2
9D0119D4  00402021   ADDU A0, V0, ZERO
9D0119D8  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D0119DC  02802821   ADDU A1, S4, ZERO
9D0119E0  8F8A80E8   LW T2, -32536(GP)
9D0119E4  254DFFFC   ADDIU T5, T2, -4
9D0119E8  AF8D80E8   SW T5, -32536(GP)
9D0119EC  26633010   ADDIU V1, S3, 12304
9D0119F0  8C6C0054   LW T4, 84(V1)
9D0119F4  258E0004   ADDIU T6, T4, 4
1984:                         OPCODE_END
9D0119F8  19A00FDE   BLEZ T5, .L95
9D0119FC  AC6E0054   SW T6, 84(V1)
9D011A00  26100003   ADDIU S0, S0, 3
9D011A20  912B0000   LBU T3, 0(T1)
9D011A24  000B7880   SLL T7, T3, 2
9D011A28  01F61021   ADDU V0, T7, S6
9D011A2C  0B403272   J 0x9D00C9C8
9D011A30  8C450000   LW A1, 0(V0)
1985:                
1986:                      OPCODE_BEGIN(8E)  /* STX $nnnn */
1987:                         STX(4, ABSOLUTE_ADDR, mem_writebyte, addr);
9D011A34  0F4030A7   JAL bank_readword
9D011A38  02002021   ADDU A0, S0, ZERO
9D011A3C  26110002   ADDIU S1, S0, 2
9D011A40  00402021   ADDU A0, V0, ZERO
9D011A44  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D011A48  03C02821   ADDU A1, FP, ZERO
9D011A4C  8F8780E8   LW A3, -32536(GP)
9D011A50  24E6FFFC   ADDIU A2, A3, -4
9D011A54  AF8680E8   SW A2, -32536(GP)
9D011A58  266A3010   ADDIU T2, S3, 12304
9D011A5C  8D4D0054   LW T5, 84(T2)
9D011A60  25A30004   ADDIU V1, T5, 4
1988:                         OPCODE_END
9D011A64  18C00FC3   BLEZ A2, .L95
9D011A68  AD430054   SW V1, 84(T2)
9D011A6C  26100003   ADDIU S0, S0, 3
9D011A8C  933F0000   LBU RA, 0(T9)
9D011A90  001F2080   SLL A0, RA, 2
9D011A94  00964821   ADDU T1, A0, S6
9D011A98  0B403272   J 0x9D00C9C8
9D011A9C  8D250000   LW A1, 0(T1)
1989:                      
1990:                      OPCODE_BEGIN(8F)  /* SAX $nnnn */
1991:                         SAX(4, ABSOLUTE_ADDR, mem_writebyte, addr);
9D011AA0  0F4030A7   JAL bank_readword
9D011AA4  02002021   ADDU A0, S0, ZERO
9D011AA8  26110002   ADDIU S1, S0, 2
9D011AAC  03D45824   AND T3, FP, S4
9D011AB0  00402021   ADDU A0, V0, ZERO
9D011AB4  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D011AB8  316500FF   ANDI A1, T3, 255
9D011ABC  8F8280E8   LW V0, -32536(GP)
9D011AC0  2447FFFC   ADDIU A3, V0, -4
9D011AC4  AF8780E8   SW A3, -32536(GP)
9D011AC8  26663010   ADDIU A2, S3, 12304
9D011ACC  8CCA0054   LW T2, 84(A2)
9D011AD0  254D0004   ADDIU T5, T2, 4
1992:                         OPCODE_END
9D011AD4  18E00FA7   BLEZ A3, .L95
9D011AD8  ACCD0054   SW T5, 84(A2)
9D011ADC  26100003   ADDIU S0, S0, 3
9D011AFC  93190000   LBU T9, 0(T8)
9D011B00  0019F880   SLL RA, T9, 2
9D011B04  03F62021   ADDU A0, RA, S6
9D011B08  0B403272   J 0x9D00C9C8
9D011B0C  8C850000   LW A1, 0(A0)
1993:                
1994:                      OPCODE_BEGIN(90)  /* BCC $nnnn */
1995:                         BCC();
9D011B10  16E0001F   BNE S7, ZERO, 0x9D011B90
9D011B14  26110001   ADDIU S1, S0, 1
9D011B18  26070001   ADDIU A3, S0, 1
9D011B38  81050000   LB A1, 0(T0)
9D011B3C  30F100FF   ANDI S1, A3, 255
9D011B40  00B1C021   ADDU T8, A1, S1
9D011B44  33190100   ANDI T9, T8, 256
9D011B48  13200009   BEQ T9, ZERO, 0x9D011B70
9D011B4C  8F8F80E8   LW T7, -32536(GP)
9D011B50  8F9F80E8   LW RA, -32536(GP)
9D011B54  27E4FFFF   ADDIU A0, RA, -1
9D011B58  AF8480E8   SW A0, -32536(GP)
9D011B5C  26703010   ADDIU S0, S3, 12304
9D011B60  8E090054   LW T1, 84(S0)
9D011B64  252B0001   ADDIU T3, T1, 1
9D011B68  AE0B0054   SW T3, 84(S0)
9D011B6C  8F8F80E8   LW T7, -32536(GP)
9D011B70  25E2FFFD   ADDIU V0, T7, -3
9D011B74  AF8280E8   SW V0, -32536(GP)
9D011B78  26663010   ADDIU A2, S3, 12304
9D011B7C  8CCA0054   LW T2, 84(A2)
9D011B80  254D0003   ADDIU T5, T2, 3
9D011B84  ACCD0054   SW T5, 84(A2)
9D011B88  0B4046EB   J 0x9D011BAC
9D011B8C  00A78821   ADDU S1, A1, A3
9D011B90  8F9080E8   LW S0, -32536(GP)
9D011B94  2609FFFE   ADDIU T1, S0, -2
9D011B98  AF8980E8   SW T1, -32536(GP)
9D011B9C  266B3010   ADDIU T3, S3, 12304
9D011BA0  8D6F0054   LW T7, 84(T3)
9D011BA4  25E20002   ADDIU V0, T7, 2
9D011BA8  AD620054   SW V0, 84(T3)
1996:                         OPCODE_END
9D011BAC  8F8780E8   LW A3, -32536(GP)
9D011BB0  18E00F70   BLEZ A3, .L95
9D011BB4  26300001   ADDIU S0, S1, 1
9D011BD4  93190000   LBU T9, 0(T8)
9D011BD8  0019F880   SLL RA, T9, 2
9D011BDC  03F62021   ADDU A0, RA, S6
9D011BE0  0B403272   J 0x9D00C9C8
9D011BE4  8C850000   LW A1, 0(A0)
1997:                
1998:                      OPCODE_BEGIN(91)  /* STA ($nn),Y */
1999:                         STA(6, INDIR_Y_ADDR, mem_writebyte, addr);
9D011BE8  26110001   ADDIU S1, S0, 1
9D011C1C  8FA50010   LW A1, 16(SP)
9D011C20  0105C021   ADDU T8, T0, A1
9D011C24  3304FFFF   ANDI A0, T8, -1
9D011C28  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D011C2C  02802821   ADDU A1, S4, ZERO
9D011C30  8F9980E8   LW T9, -32536(GP)
9D011C34  2724FFFA   ADDIU A0, T9, -6
9D011C38  AF8480E8   SW A0, -32536(GP)
9D011C3C  3C09A001   LUI T1, -24575
9D011C40  252B3010   ADDIU T3, T1, 12304
9D011C44  8D6F0054   LW T7, 84(T3)
9D011C48  25E20006   ADDIU V0, T7, 6
2000:                         OPCODE_END
9D011C4C  18800F49   BLEZ A0, .L95
9D011C50  AD620054   SW V0, 84(T3)
9D011C54  26100002   ADDIU S0, S0, 2
9D011C74  91830000   LBU V1, 0(T4)
9D011C78  00037080   SLL T6, V1, 2
9D011C7C  01D64021   ADDU T0, T6, S6
9D011C80  0B403272   J 0x9D00C9C8
9D011C84  8D050000   LW A1, 0(T0)
2001:                
2002:                      OPCODE_BEGIN(93)  /* SHA ($nn),Y */
2003:                         SHA(6, INDIR_Y_ADDR, mem_writebyte, addr);
9D011C88  26110001   ADDIU S1, S0, 1
9D011CBC  8FA70010   LW A3, 16(SP)
9D011CC0  01A76021   ADDU T4, T5, A3
9D011CC4  3184FFFF   ANDI A0, T4, -1
9D011CC8  03D41824   AND V1, FP, S4
9D011CCC  00047202   SRL T6, A0, 8
9D011CD0  25C80001   ADDIU T0, T6, 1
9D011CD4  00682824   AND A1, V1, T0
9D011CD8  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D011CDC  30A500FF   ANDI A1, A1, 255
9D011CE0  8F9880E8   LW T8, -32536(GP)
9D011CE4  2719FFFA   ADDIU T9, T8, -6
9D011CE8  AF9980E8   SW T9, -32536(GP)
9D011CEC  3C04A001   LUI A0, -24575
9D011CF0  24893010   ADDIU T1, A0, 12304
9D011CF4  8D2B0054   LW T3, 84(T1)
9D011CF8  256F0006   ADDIU T7, T3, 6
2004:                         OPCODE_END
9D011CFC  1B200F1D   BLEZ T9, .L95
9D011D00  AD2F0054   SW T7, 84(T1)
9D011D04  26100002   ADDIU S0, S0, 2
9D011D24  90EC0000   LBU T4, 0(A3)
9D011D28  000C1880   SLL V1, T4, 2
9D011D2C  00767021   ADDU T6, V1, S6
9D011D30  0B403272   J 0x9D00C9C8
9D011D34  8DC50000   LW A1, 0(T6)
2005:                
2006:                      OPCODE_BEGIN(94)  /* STY $nn,X */
2007:                         STY(4, ZP_IND_X_ADDR, ZP_WRITEBYTE, baddr);
9D011D38  26110001   ADDIU S1, S0, 1
9D011D58  916F0000   LBU T7, 0(T3)
9D011D5C  03CF1021   ADDU V0, FP, T7
9D011D60  305F00FF   ANDI RA, V0, 255
9D011D64  8F8680E4   LW A2, -32540(GP)
9D011D68  00DF5021   ADDU T2, A2, RA
9D011D6C  8FAD0010   LW T5, 16(SP)
9D011D70  A14D0000   SB T5, 0(T2)
9D011D74  8F8780E8   LW A3, -32536(GP)
9D011D78  24ECFFFC   ADDIU T4, A3, -4
9D011D7C  AF8C80E8   SW T4, -32536(GP)
9D011D80  8F030054   LW V1, 84(T8)
9D011D84  246E0004   ADDIU T6, V1, 4
2008:                         OPCODE_END
9D011D88  19800EFA   BLEZ T4, .L95
9D011D8C  AF0E0054   SW T6, 84(T8)
9D011D90  26100002   ADDIU S0, S0, 2
9D011DAC  91240000   LBU A0, 0(T1)
9D011DB0  00045880   SLL T3, A0, 2
9D011DB4  01767821   ADDU T7, T3, S6
9D011DB8  0B403272   J 0x9D00C9C8
9D011DBC  8DE50000   LW A1, 0(T7)
2009:                
2010:                      OPCODE_BEGIN(95)  /* STA $nn,X */
2011:                         STA(4, ZP_IND_X_ADDR, ZP_WRITEBYTE, baddr);
9D011DC0  26110001   ADDIU S1, S0, 1
9D011DE0  91830000   LBU V1, 0(T4)
9D011DE4  03C37021   ADDU T6, FP, V1
9D011DE8  31C800FF   ANDI T0, T6, 255
9D011DEC  8F8580E4   LW A1, -32540(GP)
9D011DF0  00A8C021   ADDU T8, A1, T0
9D011DF4  A3140000   SB S4, 0(T8)
9D011DF8  8F9980E8   LW T9, -32536(GP)
9D011DFC  2729FFFC   ADDIU T1, T9, -4
9D011E00  AF8980E8   SW T1, -32536(GP)
9D011E04  8CC40054   LW A0, 84(A2)
9D011E08  248B0004   ADDIU T3, A0, 4
2012:                         OPCODE_END
9D011E0C  19200ED9   BLEZ T1, .L95
9D011E10  ACCB0054   SW T3, 84(A2)
9D011E14  26100002   ADDIU S0, S0, 2
9D011E30  914D0000   LBU T5, 0(T2)
9D011E34  000D3880   SLL A3, T5, 2
9D011E38  00F66021   ADDU T4, A3, S6
9D011E3C  0B403272   J 0x9D00C9C8
9D011E40  8D850000   LW A1, 0(T4)
2013:                
2014:                      OPCODE_BEGIN(96)  /* STX $nn,Y */
2015:                         STX(4, ZP_IND_Y_ADDR, ZP_WRITEBYTE, baddr);
9D011E44  26110001   ADDIU S1, S0, 1
9D011E64  91240000   LBU A0, 0(T1)
9D011E68  8FAB0010   LW T3, 16(SP)
9D011E6C  01647821   ADDU T7, T3, A0
9D011E70  31E200FF   ANDI V0, T7, 255
9D011E74  8F9F80E4   LW RA, -32540(GP)
9D011E78  03E23021   ADDU A2, RA, V0
9D011E7C  A0DE0000   SB FP, 0(A2)
9D011E80  8F8A80E8   LW T2, -32536(GP)
9D011E84  254DFFFC   ADDIU T5, T2, -4
9D011E88  AF8D80E8   SW T5, -32536(GP)
9D011E8C  8D070054   LW A3, 84(T0)
9D011E90  24EC0004   ADDIU T4, A3, 4
2016:                         OPCODE_END
9D011E94  19A00EB7   BLEZ T5, .L95
9D011E98  AD0C0054   SW T4, 84(T0)
9D011E9C  26100002   ADDIU S0, S0, 2
9D011EB8  93190000   LBU T9, 0(T8)
9D011EBC  00194880   SLL T1, T9, 2
9D011EC0  01362021   ADDU A0, T1, S6
9D011EC4  0B403272   J 0x9D00C9C8
9D011EC8  8C850000   LW A1, 0(A0)
2017:                
2018:                      OPCODE_BEGIN(97)  /* SAX $nn,Y */
2019:                         SAX(4, ZP_IND_Y_ADDR, ZP_WRITEBYTE, baddr);
9D011ECC  26110001   ADDIU S1, S0, 1
9D011EEC  91A70000   LBU A3, 0(T5)
9D011EF0  8FAC0010   LW T4, 16(SP)
9D011EF4  01871821   ADDU V1, T4, A3
9D011EF8  306E00FF   ANDI T6, V1, 255
9D011EFC  8F8880E4   LW T0, -32540(GP)
9D011F00  010E2821   ADDU A1, T0, T6
9D011F04  03D4C024   AND T8, FP, S4
9D011F08  A0B80000   SB T8, 0(A1)
9D011F0C  8F9980E8   LW T9, -32536(GP)
9D011F10  2729FFFC   ADDIU T1, T9, -4
9D011F14  AF8980E8   SW T1, -32536(GP)
9D011F18  8C440054   LW A0, 84(V0)
9D011F1C  248B0004   ADDIU T3, A0, 4
2020:                         OPCODE_END
9D011F20  19200E94   BLEZ T1, .L95
9D011F24  AC4B0054   SW T3, 84(V0)
9D011F28  26100002   ADDIU S0, S0, 2
9D011F44  914D0000   LBU T5, 0(T2)
9D011F48  000D3880   SLL A3, T5, 2
9D011F4C  00F66021   ADDU T4, A3, S6
9D011F50  0B403272   J 0x9D00C9C8
9D011F54  8D850000   LW A1, 0(T4)
2021:                
2022:                      OPCODE_BEGIN(98)  /* TYA */
2023:                         TYA();
9D011F58  8F9480E8   LW S4, -32536(GP)
9D011F5C  2692FFFE   ADDIU S2, S4, -2
9D011F60  AF9280E8   SW S2, -32536(GP)
9D011F64  26753010   ADDIU S5, S3, 12304
9D011F68  8EA30054   LW V1, 84(S5)
9D011F6C  246E0002   ADDIU T6, V1, 2
2024:                         OPCODE_END
9D011F70  1E400006   BGTZ S2, .LBB1202
9D011F74  AEAE0054   SW T6, 84(S5)
9D011F78  8FB20010   LW S2, 16(SP)
9D011F7C  0240A021   ADDU S4, S2, ZERO
9D011F80  02008821   ADDU S1, S0, ZERO
9D011F84  0B40565D   J .L95
9D011F88  0240A821   ADDU S5, S2, ZERO
9D011FA8  916F0000   LBU T7, 0(T3)
9D011FAC  000FF880   SLL RA, T7, 2
9D011FB0  03F61021   ADDU V0, RA, S6
9D011FB4  8C450000   LW A1, 0(V0)
9D011FB8  8FB40010   LW S4, 16(SP)
9D011FBC  26100001   ADDIU S0, S0, 1
9D011FC0  0280A821   ADDU S5, S4, ZERO
9D011FC4  0B403272   J 0x9D00C9C8
9D011FC8  02809021   ADDU S2, S4, ZERO
2025:                
2026:                      OPCODE_BEGIN(99)  /* STA $nnnn,Y */
2027:                         STA(5, ABS_IND_Y_ADDR, mem_writebyte, addr);
9D011FCC  0F4030A7   JAL bank_readword
9D011FD0  02002021   ADDU A0, S0, ZERO
9D011FD4  26110002   ADDIU S1, S0, 2
9D011FD8  8FA60010   LW A2, 16(SP)
9D011FDC  00465021   ADDU T2, V0, A2
9D011FE0  3144FFFF   ANDI A0, T2, -1
9D011FE4  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D011FE8  02802821   ADDU A1, S4, ZERO
9D011FEC  8F8D80E8   LW T5, -32536(GP)
9D011FF0  25A7FFFB   ADDIU A3, T5, -5
9D011FF4  AF8780E8   SW A3, -32536(GP)
9D011FF8  266C3010   ADDIU T4, S3, 12304
9D011FFC  8D830054   LW V1, 84(T4)
9D012000  246E0005   ADDIU T6, V1, 5
2028:                         OPCODE_END
9D012004  18E00E5B   BLEZ A3, .L95
9D012008  AD8E0054   SW T6, 84(T4)
9D01200C  26100003   ADDIU S0, S0, 3
9D01202C  908B0000   LBU T3, 0(A0)
9D012030  000B7880   SLL T7, T3, 2
9D012034  01F6F821   ADDU RA, T7, S6
9D012038  0B403272   J 0x9D00C9C8
9D01203C  8FE50000   LW A1, 0(RA)
2029:                
2030:                      OPCODE_BEGIN(9A)  /* TXS */
2031:                         TXS();
9D012040  8F8280E8   LW V0, -32536(GP)
9D012044  2446FFFE   ADDIU A2, V0, -2
9D012048  AF8680E8   SW A2, -32536(GP)
9D01204C  266A3010   ADDIU T2, S3, 12304
9D012050  8D4D0054   LW T5, 84(T2)
9D012054  25A70002   ADDIU A3, T5, 2
2032:                         OPCODE_END
9D012058  1CC00004   BGTZ A2, .LBB1206
9D01205C  AD470054   SW A3, 84(T2)
9D012060  AFBE0018   SW FP, 24(SP)
9D012064  0B40565D   J .L95
9D012068  02008821   ADDU S1, S0, ZERO
9D012088  93310000   LBU S1, 0(T9)
9D01208C  00114880   SLL T1, S1, 2
9D012090  01362021   ADDU A0, T1, S6
9D012094  8C850000   LW A1, 0(A0)
9D012098  AFBE0018   SW FP, 24(SP)
9D01209C  0B403272   J 0x9D00C9C8
9D0120A0  26100001   ADDIU S0, S0, 1
2033:                
2034:                      OPCODE_BEGIN(9B)  /* SHS $nnnn,Y */
2035:                         SHS(5, ABS_IND_Y_ADDR, mem_writebyte, addr);
9D0120A4  0F4030A7   JAL bank_readword
9D0120A8  02002021   ADDU A0, S0, ZERO
9D0120AC  26110002   ADDIU S1, S0, 2
9D0120B0  8FAB0010   LW T3, 16(SP)
9D0120B4  004B7821   ADDU T7, V0, T3
9D0120B8  31E4FFFF   ANDI A0, T7, -1
9D0120BC  03D41024   AND V0, FP, S4
9D0120C0  304600FF   ANDI A2, V0, 255
9D0120C4  AFA60018   SW A2, 24(SP)
9D0120C8  00045202   SRL T2, A0, 8
9D0120CC  254D0001   ADDIU T5, T2, 1
9D0120D0  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D0120D4  00CD2824   AND A1, A2, T5
9D0120D8  8F8780E8   LW A3, -32536(GP)
9D0120DC  24ECFFFB   ADDIU T4, A3, -5
9D0120E0  AF8C80E8   SW T4, -32536(GP)
9D0120E4  26633010   ADDIU V1, S3, 12304
9D0120E8  8C6E0054   LW T6, 84(V1)
9D0120EC  25C80005   ADDIU T0, T6, 5
2036:                         OPCODE_END
9D0120F0  19800E20   BLEZ T4, .L95
9D0120F4  AC680054   SW T0, 84(V1)
9D0120F8  26100003   ADDIU S0, S0, 3
9D012118  908B0000   LBU T3, 0(A0)
9D01211C  000B7880   SLL T7, T3, 2
9D012120  01F61021   ADDU V0, T7, S6
9D012124  0B403272   J 0x9D00C9C8
9D012128  8C450000   LW A1, 0(V0)
2037:                
2038:                      OPCODE_BEGIN(9C)  /* SHY $nnnn,X */
2039:                         SHY(5, ABS_IND_X_ADDR, mem_writebyte, addr);
9D01212C  0F4030A7   JAL bank_readword
9D012130  02002021   ADDU A0, S0, ZERO
9D012134  26110002   ADDIU S1, S0, 2
9D012138  005E3021   ADDU A2, V0, FP
9D01213C  30C4FFFF   ANDI A0, A2, -1
9D012140  00045202   SRL T2, A0, 8
9D012144  254D0001   ADDIU T5, T2, 1
9D012148  8FA70010   LW A3, 16(SP)
9D01214C  00ED6024   AND T4, A3, T5
9D012150  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D012154  318500FF   ANDI A1, T4, 255
9D012158  8F8380E8   LW V1, -32536(GP)
9D01215C  246EFFFB   ADDIU T6, V1, -5
9D012160  AF8E80E8   SW T6, -32536(GP)
9D012164  26683010   ADDIU T0, S3, 12304
9D012168  8D050054   LW A1, 84(T0)
9D01216C  24B80005   ADDIU T8, A1, 5
2040:                         OPCODE_END
9D012170  19C00E00   BLEZ T6, .L95
9D012174  AD180054   SW T8, 84(T0)
9D012178  26100003   ADDIU S0, S0, 3
9D012198  91E20000   LBU V0, 0(T7)
9D01219C  00023080   SLL A2, V0, 2
9D0121A0  00D65021   ADDU T2, A2, S6
9D0121A4  0B403272   J 0x9D00C9C8
9D0121A8  8D450000   LW A1, 0(T2)
2041:                
2042:                      OPCODE_BEGIN(9D)  /* STA $nnnn,X */
2043:                         STA(5, ABS_IND_X_ADDR, mem_writebyte, addr);
9D0121AC  0F4030A7   JAL bank_readword
9D0121B0  02002021   ADDU A0, S0, ZERO
9D0121B4  26110002   ADDIU S1, S0, 2
9D0121B8  005E6821   ADDU T5, V0, FP
9D0121BC  31A4FFFF   ANDI A0, T5, -1
9D0121C0  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D0121C4  02802821   ADDU A1, S4, ZERO
9D0121C8  8F8780E8   LW A3, -32536(GP)
9D0121CC  24ECFFFB   ADDIU T4, A3, -5
9D0121D0  AF8C80E8   SW T4, -32536(GP)
9D0121D4  26633010   ADDIU V1, S3, 12304
9D0121D8  8C6E0054   LW T6, 84(V1)
9D0121DC  25C80005   ADDIU T0, T6, 5
2044:                         OPCODE_END
9D0121E0  19800DE4   BLEZ T4, .L95
9D0121E4  AC680054   SW T0, 84(V1)
9D0121E8  26100003   ADDIU S0, S0, 3
9D012208  922B0000   LBU T3, 0(S1)
9D01220C  000B7880   SLL T7, T3, 2
9D012210  01F61021   ADDU V0, T7, S6
9D012214  0B403272   J 0x9D00C9C8
9D012218  8C450000   LW A1, 0(V0)
2045:                
2046:                      OPCODE_BEGIN(9E)  /* SHX $nnnn,Y */
2047:                         SHX(5, ABS_IND_Y_ADDR, mem_writebyte, addr);
9D01221C  0F4030A7   JAL bank_readword
9D012220  02002021   ADDU A0, S0, ZERO
9D012224  26110002   ADDIU S1, S0, 2
9D012228  8FA60010   LW A2, 16(SP)
9D01222C  00465021   ADDU T2, V0, A2
9D012230  3144FFFF   ANDI A0, T2, -1
9D012234  00046A02   SRL T5, A0, 8
9D012238  25A70001   ADDIU A3, T5, 1
9D01223C  03C76024   AND T4, FP, A3
9D012240  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D012244  318500FF   ANDI A1, T4, 255
9D012248  8F8380E8   LW V1, -32536(GP)
9D01224C  246EFFFB   ADDIU T6, V1, -5
9D012250  AF8E80E8   SW T6, -32536(GP)
9D012254  26683010   ADDIU T0, S3, 12304
9D012258  8D050054   LW A1, 84(T0)
9D01225C  24B80005   ADDIU T8, A1, 5
2048:                         OPCODE_END
9D012260  19C00DC4   BLEZ T6, .L95
9D012264  AD180054   SW T8, 84(T0)
9D012268  26100003   ADDIU S0, S0, 3
9D012288  91E20000   LBU V0, 0(T7)
9D01228C  00023080   SLL A2, V0, 2
9D012290  00D65021   ADDU T2, A2, S6
9D012294  0B403272   J 0x9D00C9C8
9D012298  8D450000   LW A1, 0(T2)
2049:                
2050:                      OPCODE_BEGIN(9F)  /* SHA $nnnn,Y */
2051:                         SHA(5, ABS_IND_Y_ADDR, mem_writebyte, addr);
9D01229C  0F4030A7   JAL bank_readword
9D0122A0  02002021   ADDU A0, S0, ZERO
9D0122A4  26110002   ADDIU S1, S0, 2
9D0122A8  8FAD0010   LW T5, 16(SP)
9D0122AC  004D3821   ADDU A3, V0, T5
9D0122B0  30E4FFFF   ANDI A0, A3, -1
9D0122B4  03D46024   AND T4, FP, S4
9D0122B8  00041A02   SRL V1, A0, 8
9D0122BC  246E0001   ADDIU T6, V1, 1
9D0122C0  018E4024   AND T0, T4, T6
9D0122C4  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D0122C8  310500FF   ANDI A1, T0, 255
9D0122CC  8F8580E8   LW A1, -32536(GP)
9D0122D0  24B8FFFB   ADDIU T8, A1, -5
9D0122D4  AF9880E8   SW T8, -32536(GP)
9D0122D8  26793010   ADDIU T9, S3, 12304
9D0122DC  8F290054   LW T1, 84(T9)
9D0122E0  25240005   ADDIU A0, T1, 5
2052:                         OPCODE_END
9D0122E4  1B000DA3   BLEZ T8, .L95
9D0122E8  AF240054   SW A0, 84(T9)
9D0122EC  26100003   ADDIU S0, S0, 3
9D01230C  914D0000   LBU T5, 0(T2)
9D012310  000D3880   SLL A3, T5, 2
9D012314  00F66021   ADDU T4, A3, S6
9D012318  0B403272   J 0x9D00C9C8
9D01231C  8D850000   LW A1, 0(T4)
2053:                      
2054:                      OPCODE_BEGIN(A0)  /* LDY #$nn */
2055:                         LDY(2, IMMEDIATE_BYTE);
9D012320  26110001   ADDIU S1, S0, 1
9D012344  8F9980E8   LW T9, -32536(GP)
9D012348  2729FFFE   ADDIU T1, T9, -2
9D01234C  AF8980E8   SW T1, -32536(GP)
9D012350  8DC40054   LW A0, 84(T6)
9D012354  249F0002   ADDIU RA, A0, 2
2056:                         OPCODE_END
9D012358  1D200004   BGTZ T1, 0x9D01236C
9D01235C  ADDF0054   SW RA, 84(T6)
9D01236C  26100002   ADDIU S0, S0, 2
9D01238C  91A70000   LBU A3, 0(T5)
9D012390  00076080   SLL T4, A3, 2
9D012394  0196A821   ADDU S5, T4, S6
9D012398  8EA50000   LW A1, 0(S5)
9D0123A0  0B403272   J 0x9D00C9C8
9D0123A4  0240A821   ADDU S5, S2, ZERO
2057:                
2058:                      OPCODE_BEGIN(A1)  /* LDA ($nn,X) */
2059:                         LDA(6, INDIR_X_BYTE);
9D0123C4  90B80000   LBU T8, 0(A1)
9D0123C8  03D8C821   ADDU T9, FP, T8
9D0123D8  97E40000   LHU A0, 0(RA)
9D0123DC  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0123E0  26110001   ADDIU S1, S0, 1
9D0123E4  00409021   ADDU S2, V0, ZERO
9D0123E8  8F8B80E8   LW T3, -32536(GP)
9D0123EC  256FFFFA   ADDIU T7, T3, -6
9D0123F0  AF8F80E8   SW T7, -32536(GP)
9D0123F4  8EA20054   LW V0, 84(S5)
9D0123F8  24460006   ADDIU A2, V0, 6
9D012404  0240A021   ADDU S4, S2, ZERO
9D012408  0B40565D   J .L95
9D01240C  0240A821   ADDU S5, S2, ZERO
9D012440  0240A021   ADDU S4, S2, ZERO
2060:                         OPCODE_END
9D0123FC  1DE00004   BGTZ T7, 0x9D012410
9D012400  AEA60054   SW A2, 84(S5)
9D012410  26100002   ADDIU S0, S0, 2
9D012430  92AE0000   LBU T6, 0(S5)
9D012434  000E4080   SLL T0, T6, 2
9D012438  01161821   ADDU V1, T0, S6
9D01243C  8C650000   LW A1, 0(V1)
9D012444  0B403272   J 0x9D00C9C8
9D012448  0240A821   ADDU S5, S2, ZERO
2061:                
2062:                      OPCODE_BEGIN(A2)  /* LDX #$nn */
2063:                         LDX(2, IMMEDIATE_BYTE);
9D01244C  26110001   ADDIU S1, S0, 1
9D012470  8F9F80E8   LW RA, -32536(GP)
9D012474  27EBFFFE   ADDIU T3, RA, -2
9D012478  AF8B80E8   SW T3, -32536(GP)
9D01247C  8CAF0054   LW T7, 84(A1)
9D012480  25E20002   ADDIU V0, T7, 2
2064:                         OPCODE_END
9D012484  1D600004   BGTZ T3, 0x9D012498
9D012488  ACA20054   SW V0, 84(A1)
9D012498  26100002   ADDIU S0, S0, 2
9D0124B8  92AE0000   LBU T6, 0(S5)
9D0124BC  000E4080   SLL T0, T6, 2
9D0124C0  01161821   ADDU V1, T0, S6
9D0124C4  8C650000   LW A1, 0(V1)
9D0124CC  0B403272   J 0x9D00C9C8
9D0124D0  0240A821   ADDU S5, S2, ZERO
2065:                
2066:                      OPCODE_BEGIN(A3)  /* LAX ($nn,X) */
2067:                         LAX(6, INDIR_X_BYTE);
9D0124D4  26110001   ADDIU S1, S0, 1
9D0124F4  91240000   LBU A0, 0(T1)
9D0124F8  03C4F021   ADDU FP, FP, A0
9D012508  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D01250C  95E40000   LHU A0, 0(T7)
9D012510  00409021   ADDU S2, V0, ZERO
9D012514  8F8280E8   LW V0, -32536(GP)
9D012518  2446FFFA   ADDIU A2, V0, -6
9D01251C  AF8680E8   SW A2, -32536(GP)
9D012520  8EAA0054   LW T2, 84(S5)
9D012524  254D0006   ADDIU T5, T2, 6
9D012530  0240F021   ADDU FP, S2, ZERO
9D012534  0240A021   ADDU S4, S2, ZERO
9D012538  0B40565D   J .L95
9D01253C  0240A821   ADDU S5, S2, ZERO
9D012570  0240F021   ADDU FP, S2, ZERO
9D012574  0240A021   ADDU S4, S2, ZERO
2068:                         OPCODE_END
9D012528  1CC00005   BGTZ A2, 0x9D012540
9D01252C  AEAD0054   SW T5, 84(S5)
9D012540  26100002   ADDIU S0, S0, 2
9D012560  92950000   LBU S5, 0(S4)
9D012564  00152880   SLL A1, S5, 2
9D012568  00B6C021   ADDU T8, A1, S6
9D01256C  8F050000   LW A1, 0(T8)
9D012578  0B403272   J 0x9D00C9C8
9D01257C  0240A821   ADDU S5, S2, ZERO
2069:                
2070:                      OPCODE_BEGIN(A4)  /* LDY $nn */
2071:                         LDY(3, ZERO_PAGE_BYTE);
9D012580  26110001   ADDIU S1, S0, 1
9D0125A0  91E20000   LBU V0, 0(T7)
9D0125A4  8F8680E4   LW A2, -32540(GP)
9D0125A8  00C25021   ADDU T2, A2, V0
9D0125AC  91520000   LBU S2, 0(T2)
9D0125B0  8F8D80E8   LW T5, -32536(GP)
9D0125B4  25A7FFFD   ADDIU A3, T5, -3
9D0125B8  AF8780E8   SW A3, -32536(GP)
9D0125BC  8D2C0054   LW T4, 84(T1)
9D0125C0  258E0003   ADDIU T6, T4, 3
9D0125CC  AFB20010   SW S2, 16(SP)
9D0125D0  0B40565D   J .L95
9D0125D4  0240A821   ADDU S5, S2, ZERO
9D012608  AFB20010   SW S2, 16(SP)
2072:                         OPCODE_END
9D0125C4  1CE00004   BGTZ A3, 0x9D0125D8
9D0125C8  AD2E0054   SW T6, 84(T1)
9D0125D8  26100002   ADDIU S0, S0, 2
9D0125F8  93290000   LBU T1, 0(T9)
9D0125FC  00092080   SLL A0, T1, 2
9D012600  0096F821   ADDU RA, A0, S6
9D012604  8FE50000   LW A1, 0(RA)
9D01260C  0B403272   J 0x9D00C9C8
9D012610  0240A821   ADDU S5, S2, ZERO
2073:                
2074:                      OPCODE_BEGIN(A5)  /* LDA $nn */
2075:                         LDA(3, ZERO_PAGE_BYTE);
9D012614  26110001   ADDIU S1, S0, 1
9D012634  914D0000   LBU T5, 0(T2)
9D012638  8F8780E4   LW A3, -32540(GP)
9D01263C  00ED6021   ADDU T4, A3, T5
9D012640  91920000   LBU S2, 0(T4)
9D012644  8F8E80E8   LW T6, -32536(GP)
9D012648  25C8FFFD   ADDIU T0, T6, -3
9D01264C  AF8880E8   SW T0, -32536(GP)
9D012650  8D630054   LW V1, 84(T3)
9D012654  24750003   ADDIU S5, V1, 3
9D012660  0240A021   ADDU S4, S2, ZERO
9D012664  0B40565D   J .L95
9D012668  0240A821   ADDU S5, S2, ZERO
9D01269C  0240A021   ADDU S4, S2, ZERO
2076:                         OPCODE_END
9D012658  1D000004   BGTZ T0, 0x9D01266C
9D01265C  AD750054   SW S5, 84(T3)
9D01266C  26100002   ADDIU S0, S0, 2
9D01268C  93F40000   LBU S4, 0(RA)
9D012690  00145880   SLL T3, S4, 2
9D012694  01767821   ADDU T7, T3, S6
9D012698  8DE50000   LW A1, 0(T7)
9D0126A0  0B403272   J 0x9D00C9C8
9D0126A4  0240A821   ADDU S5, S2, ZERO
2077:                
2078:                      OPCODE_BEGIN(A6)  /* LDX $nn */
2079:                         LDX(3, ZERO_PAGE_BYTE);
9D0126A8  26110001   ADDIU S1, S0, 1
9D0126C8  90EC0000   LBU T4, 0(A3)
9D0126CC  8F8E80E4   LW T6, -32540(GP)
9D0126D0  01CC4021   ADDU T0, T6, T4
9D0126D4  91120000   LBU S2, 0(T0)
9D0126D8  8F8380E8   LW V1, -32536(GP)
9D0126DC  2475FFFD   ADDIU S5, V1, -3
9D0126E0  AF9580E8   SW S5, -32536(GP)
9D0126E4  8C450054   LW A1, 84(V0)
9D0126E8  24B80003   ADDIU T8, A1, 3
9D0126F4  0240F021   ADDU FP, S2, ZERO
9D0126F8  0B40565D   J .L95
9D0126FC  0240A821   ADDU S5, S2, ZERO
9D012730  0240F021   ADDU FP, S2, ZERO
2080:                         OPCODE_END
9D0126EC  1EA00004   BGTZ S5, 0x9D012700
9D0126F0  AC580054   SW T8, 84(V0)
9D012700  26100002   ADDIU S0, S0, 2
9D012720  91FE0000   LBU FP, 0(T7)
9D012724  001E1080   SLL V0, FP, 2
9D012728  00563021   ADDU A2, V0, S6
9D01272C  8CC50000   LW A1, 0(A2)
9D012734  0B403272   J 0x9D00C9C8
9D012738  0240A821   ADDU S5, S2, ZERO
2081:                
2082:                      OPCODE_BEGIN(A7)  /* LAX $nn */
2083:                         LAX(3, ZERO_PAGE_BYTE);
9D01273C  26110001   ADDIU S1, S0, 1
9D01275C  91C80000   LBU T0, 0(T6)
9D012760  8F8380E4   LW V1, -32540(GP)
9D012764  0068A821   ADDU S5, V1, T0
9D012768  92B20000   LBU S2, 0(S5)
9D01276C  8F8580E8   LW A1, -32536(GP)
9D012770  24B8FFFD   ADDIU T8, A1, -3
9D012774  AF9880E8   SW T8, -32536(GP)
9D012778  8D590054   LW T9, 84(T2)
9D01277C  27290003   ADDIU T1, T9, 3
9D012788  0240F021   ADDU FP, S2, ZERO
9D01278C  0240A021   ADDU S4, S2, ZERO
9D012790  0B40565D   J .L95
9D012794  0240A821   ADDU S5, S2, ZERO
9D0127C8  0240F021   ADDU FP, S2, ZERO
9D0127CC  0240A021   ADDU S4, S2, ZERO
2084:                         OPCODE_END
9D012780  1F000005   BGTZ T8, 0x9D012798
9D012784  AD490054   SW T1, 84(T2)
9D012798  26100002   ADDIU S0, S0, 2
9D0127B8  90460000   LBU A2, 0(V0)
9D0127BC  0006A080   SLL S4, A2, 2
9D0127C0  02965021   ADDU T2, S4, S6
9D0127C4  8D450000   LW A1, 0(T2)
9D0127D0  0B403272   J 0x9D00C9C8
9D0127D4  0240A821   ADDU S5, S2, ZERO
2085:                
2086:                      OPCODE_BEGIN(A8)  /* TAY */
2087:                         TAY();
9D0127D8  8F9280E8   LW S2, -32536(GP)
9D0127DC  264DFFFE   ADDIU T5, S2, -2
9D0127E0  AF8D80E8   SW T5, -32536(GP)
9D0127E4  26673010   ADDIU A3, S3, 12304
9D0127E8  8CEC0054   LW T4, 84(A3)
9D0127EC  258E0002   ADDIU T6, T4, 2
2088:                         OPCODE_END
9D0127F0  1DA00006   BGTZ T5, .LBB1262
9D0127F4  ACEE0054   SW T6, 84(A3)
9D0127F8  02809021   ADDU S2, S4, ZERO
9D0127FC  AFB40010   SW S4, 16(SP)
9D012800  02008821   ADDU S1, S0, ZERO
9D012804  0B40565D   J .L95
9D012808  0280A821   ADDU S5, S4, ZERO
9D012828  91240000   LBU A0, 0(T1)
9D01282C  0004F880   SLL RA, A0, 2
9D012830  03F65821   ADDU T3, RA, S6
9D012834  8D650000   LW A1, 0(T3)
9D012838  AFB40010   SW S4, 16(SP)
9D01283C  26100001   ADDIU S0, S0, 1
9D012840  0280A821   ADDU S5, S4, ZERO
9D012844  0B403272   J 0x9D00C9C8
9D012848  02809021   ADDU S2, S4, ZERO
2089:                
2090:                      OPCODE_BEGIN(A9)  /* LDA #$nn */
2091:                         LDA(2, IMMEDIATE_BYTE);
9D01284C  26110001   ADDIU S1, S0, 1
9D012870  8F8780E8   LW A3, -32536(GP)
9D012874  24ECFFFE   ADDIU T4, A3, -2
9D012878  AF8C80E8   SW T4, -32536(GP)
9D01287C  8C4E0054   LW T6, 84(V0)
9D012880  25C80002   ADDIU T0, T6, 2
2092:                         OPCODE_END
9D012884  1D800004   BGTZ T4, 0x9D012898
9D012888  AC480054   SW T0, 84(V0)
9D012898  26100002   ADDIU S0, S0, 2
9D0128B8  91240000   LBU A0, 0(T1)
9D0128BC  0004F880   SLL RA, A0, 2
9D0128C0  03F65821   ADDU T3, RA, S6
9D0128C4  8D650000   LW A1, 0(T3)
9D0128CC  0B403272   J 0x9D00C9C8
9D0128D0  0240A821   ADDU S5, S2, ZERO
2093:                
2094:                      OPCODE_BEGIN(AA)  /* TAX */
2095:                         TAX();
9D0128D4  8F9E80E8   LW FP, -32536(GP)
9D0128D8  27CFFFFE   ADDIU T7, FP, -2
9D0128DC  AF8F80E8   SW T7, -32536(GP)
9D0128E0  26663010   ADDIU A2, S3, 12304
9D0128E4  8CC20054   LW V0, 84(A2)
9D0128E8  244A0002   ADDIU T2, V0, 2
2096:                         OPCODE_END
9D0128EC  1DE00006   BGTZ T7, .LBB1272
9D0128F0  ACCA0054   SW T2, 84(A2)
9D0128F4  02809021   ADDU S2, S4, ZERO
9D0128F8  0280F021   ADDU FP, S4, ZERO
9D0128FC  02008821   ADDU S1, S0, ZERO
9D012900  0B40565D   J .L95
9D012904  0280A821   ADDU S5, S4, ZERO
9D012924  90750000   LBU S5, 0(V1)
9D012928  00152880   SLL A1, S5, 2
9D01292C  00B6C021   ADDU T8, A1, S6
9D012930  8F050000   LW A1, 0(T8)
9D012934  0280F021   ADDU FP, S4, ZERO
9D012938  26100001   ADDIU S0, S0, 1
9D01293C  0280A821   ADDU S5, S4, ZERO
9D012940  0B403272   J 0x9D00C9C8
9D012944  02809021   ADDU S2, S4, ZERO
2097:                
2098:                      OPCODE_BEGIN(AB)  /* LXA #$nn */
2099:                         LXA(2, IMMEDIATE_BYTE);
9D012948  26110001   ADDIU S1, S0, 1
9D01294C  2419FFEE   ADDIU T9, ZERO, -18
9D012950  0299A025   OR S4, S4, T9
9D012970  90C20000   LBU V0, 0(A2)
9D012974  02829024   AND S2, S4, V0
9D012978  8F8A80E8   LW T2, -32536(GP)
9D01297C  254DFFFE   ADDIU T5, T2, -2
9D012980  AF8D80E8   SW T5, -32536(GP)
9D012984  8FE70054   LW A3, 84(RA)
9D012988  24EC0002   ADDIU T4, A3, 2
9D012994  0240F021   ADDU FP, S2, ZERO
9D012998  0240A021   ADDU S4, S2, ZERO
9D01299C  0B40565D   J .L95
9D0129A0  0240A821   ADDU S5, S2, ZERO
9D0129D4  0240F021   ADDU FP, S2, ZERO
9D0129D8  0240A021   ADDU S4, S2, ZERO
2100:                         OPCODE_END
9D01298C  1DA00005   BGTZ T5, 0x9D0129A4
9D012990  AFEC0054   SW T4, 84(RA)
9D0129A4  26100002   ADDIU S0, S0, 2
9D0129C4  93190000   LBU T9, 0(T8)
9D0129C8  0019A080   SLL S4, T9, 2
9D0129CC  02964821   ADDU T1, S4, S6
9D0129D0  8D250000   LW A1, 0(T1)
9D0129DC  0B403272   J 0x9D00C9C8
9D0129E0  0240A821   ADDU S5, S2, ZERO
2101:                
2102:                      OPCODE_BEGIN(AC)  /* LDY $nnnn */
2103:                         LDY(4, ABSOLUTE_BYTE);
9D0129E4  0F4030A7   JAL bank_readword
9D0129E8  02002021   ADDU A0, S0, ZERO
9D0129EC  26110002   ADDIU S1, S0, 2
9D0129F0  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0129F4  00402021   ADDU A0, V0, ZERO
9D0129F8  00409021   ADDU S2, V0, ZERO
9D0129FC  8F8480E8   LW A0, -32536(GP)
9D012A00  248BFFFC   ADDIU T3, A0, -4
9D012A04  AF8B80E8   SW T3, -32536(GP)
9D012A08  266F3010   ADDIU T7, S3, 12304
9D012A0C  8DE60054   LW A2, 84(T7)
9D012A10  24C20004   ADDIU V0, A2, 4
9D012A1C  AFB20010   SW S2, 16(SP)
9D012A20  0B40565D   J .L95
9D012A24  0240A821   ADDU S5, S2, ZERO
9D012A58  AFB20010   SW S2, 16(SP)
2104:                         OPCODE_END
9D012A14  1D600004   BGTZ T3, 0x9D012A28
9D012A18  ADE20054   SW V0, 84(T7)
9D012A28  26100003   ADDIU S0, S0, 3
9D012A48  91030000   LBU V1, 0(T0)
9D012A4C  0003A880   SLL S5, V1, 2
9D012A50  02B68821   ADDU S1, S5, S6
9D012A54  8E250000   LW A1, 0(S1)
9D012A5C  0B403272   J 0x9D00C9C8
9D012A60  0240A821   ADDU S5, S2, ZERO
2105:                
2106:                      OPCODE_BEGIN(AD)  /* LDA $nnnn */
2107:                         LDA(4, ABSOLUTE_BYTE);
9D012A64  0F4030A7   JAL bank_readword
9D012A68  02002021   ADDU A0, S0, ZERO
9D012A6C  26110002   ADDIU S1, S0, 2
9D012A70  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D012A74  00402021   ADDU A0, V0, ZERO
9D012A78  00409021   ADDU S2, V0, ZERO
9D012A7C  8F8580E8   LW A1, -32536(GP)
9D012A80  24B8FFFC   ADDIU T8, A1, -4
9D012A84  AF9880E8   SW T8, -32536(GP)
9D012A88  26793010   ADDIU T9, S3, 12304
9D012A8C  8F340054   LW S4, 84(T9)
9D012A90  26890004   ADDIU T1, S4, 4
9D012A9C  0040A021   ADDU S4, V0, ZERO
9D012AA0  0B40565D   J .L95
9D012AA4  0040A821   ADDU S5, V0, ZERO
9D012AD8  0240A021   ADDU S4, S2, ZERO
2108:                         OPCODE_END
9D012A94  1F000004   BGTZ T8, 0x9D012AA8
9D012A98  AF290054   SW T1, 84(T9)
9D012AA8  26100003   ADDIU S0, S0, 3
9D012AC8  914D0000   LBU T5, 0(T2)
9D012ACC  000D3880   SLL A3, T5, 2
9D012AD0  00F66021   ADDU T4, A3, S6
9D012AD4  8D850000   LW A1, 0(T4)
9D012ADC  0B403272   J 0x9D00C9C8
9D012AE0  0240A821   ADDU S5, S2, ZERO
2109:                      
2110:                      OPCODE_BEGIN(AE)  /* LDX $nnnn */
2111:                         LDX(4, ABSOLUTE_BYTE);
9D012AE4  0F4030A7   JAL bank_readword
9D012AE8  02002021   ADDU A0, S0, ZERO
9D012AEC  26110002   ADDIU S1, S0, 2
9D012AF0  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D012AF4  00402021   ADDU A0, V0, ZERO
9D012AF8  00409021   ADDU S2, V0, ZERO
9D012AFC  8F9E80E8   LW FP, -32536(GP)
9D012B00  27CEFFFC   ADDIU T6, FP, -4
9D012B04  AF8E80E8   SW T6, -32536(GP)
9D012B08  26683010   ADDIU T0, S3, 12304
9D012B0C  8D030054   LW V1, 84(T0)
9D012B10  24750004   ADDIU S5, V1, 4
9D012B1C  0040F021   ADDU FP, V0, ZERO
9D012B20  0B40565D   J .L95
9D012B24  0040A821   ADDU S5, V0, ZERO
9D012B58  0040F021   ADDU FP, V0, ZERO
2112:                         OPCODE_END
9D012B14  1DC00004   BGTZ T6, 0x9D012B28
9D012B18  AD150054   SW S5, 84(T0)
9D012B28  26100003   ADDIU S0, S0, 3
9D012B48  916F0000   LBU T7, 0(T3)
9D012B4C  000F3080   SLL A2, T7, 2
9D012B50  00D6F821   ADDU RA, A2, S6
9D012B54  8FE50000   LW A1, 0(RA)
9D012B5C  0B403272   J 0x9D00C9C8
9D012B60  0040A821   ADDU S5, V0, ZERO
2113:                
2114:                      OPCODE_BEGIN(AF)  /* LAX $nnnn */
2115:                         LAX(4, ABSOLUTE_BYTE);
9D012B64  0F4030A7   JAL bank_readword
9D012B68  02002021   ADDU A0, S0, ZERO
9D012B6C  26110002   ADDIU S1, S0, 2
9D012B70  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D012B74  00402021   ADDU A0, V0, ZERO
9D012B78  00409021   ADDU S2, V0, ZERO
9D012B7C  8F9480E8   LW S4, -32536(GP)
9D012B80  2682FFFC   ADDIU V0, S4, -4
9D012B84  AF8280E8   SW V0, -32536(GP)
9D012B88  266A3010   ADDIU T2, S3, 12304
9D012B8C  8D4D0054   LW T5, 84(T2)
9D012B90  25A70004   ADDIU A3, T5, 4
9D012B9C  0240F021   ADDU FP, S2, ZERO
9D012BA0  0240A021   ADDU S4, S2, ZERO
9D012BA4  0B40565D   J .L95
9D012BA8  0240A821   ADDU S5, S2, ZERO
9D012BDC  0240F021   ADDU FP, S2, ZERO
9D012BE0  0240A021   ADDU S4, S2, ZERO
2116:                         OPCODE_END
9D012B94  1C400005   BGTZ V0, 0x9D012BAC
9D012B98  AD470054   SW A3, 84(T2)
9D012BAC  26100003   ADDIU S0, S0, 3
9D012BCC  90B80000   LBU T8, 0(A1)
9D012BD0  0018C880   SLL T9, T8, 2
9D012BD4  03364821   ADDU T1, T9, S6
9D012BD8  8D250000   LW A1, 0(T1)
9D012BE4  0B403272   J 0x9D00C9C8
9D012BE8  0240A821   ADDU S5, S2, ZERO
2117:                
2118:                      OPCODE_BEGIN(B0)  /* BCS $nnnn */
2119:                         BCS();
9D012BEC  12E0001F   BEQ S7, ZERO, 0x9D012C6C
9D012BF0  26110001   ADDIU S1, S0, 1
9D012BF4  261F0001   ADDIU RA, S0, 1
9D012C14  81C80000   LB T0, 0(T6)
9D012C18  33E300FF   ANDI V1, RA, 255
9D012C1C  01032821   ADDU A1, T0, V1
9D012C20  30B80100   ANDI T8, A1, 256
9D012C24  13000009   BEQ T8, ZERO, 0x9D012C4C
9D012C28  8F8F80E8   LW T7, -32536(GP)
9D012C2C  8F9980E8   LW T9, -32536(GP)
9D012C30  2729FFFF   ADDIU T1, T9, -1
9D012C34  AF8980E8   SW T1, -32536(GP)
9D012C38  26703010   ADDIU S0, S3, 12304
9D012C3C  8E040054   LW A0, 84(S0)
9D012C40  248B0001   ADDIU T3, A0, 1
9D012C44  AE0B0054   SW T3, 84(S0)
9D012C48  8F8F80E8   LW T7, -32536(GP)
9D012C4C  25E6FFFD   ADDIU A2, T7, -3
9D012C50  AF8680E8   SW A2, -32536(GP)
9D012C54  26713010   ADDIU S1, S3, 12304
9D012C58  8E220054   LW V0, 84(S1)
9D012C5C  244A0003   ADDIU T2, V0, 3
9D012C60  AE2A0054   SW T2, 84(S1)
9D012C64  0B404B22   J 0x9D012C88
9D012C68  011F8821   ADDU S1, T0, RA
9D012C6C  8F9080E8   LW S0, -32536(GP)
9D012C70  2604FFFE   ADDIU A0, S0, -2
9D012C74  AF8480E8   SW A0, -32536(GP)
9D012C78  266B3010   ADDIU T3, S3, 12304
9D012C7C  8D6F0054   LW T7, 84(T3)
9D012C80  25E60002   ADDIU A2, T7, 2
9D012C84  AD660054   SW A2, 84(T3)
2120:                         OPCODE_END
9D012C88  8F9F80E8   LW RA, -32536(GP)
9D012C8C  1BE00B39   BLEZ RA, .L95
9D012C90  26300001   ADDIU S0, S1, 1
9D012CB0  90B80000   LBU T8, 0(A1)
9D012CB4  0018C880   SLL T9, T8, 2
9D012CB8  03364821   ADDU T1, T9, S6
9D012CBC  0B403272   J 0x9D00C9C8
9D012CC0  8D250000   LW A1, 0(T1)
2121:                
2122:                      OPCODE_BEGIN(B1)  /* LDA ($nn),Y */
2123:                         LDA(5, INDIR_Y_BYTE_READ);
9D012CF0  8FA70010   LW A3, 16(SP)
9D012CF4  01A76021   ADDU T4, T5, A3
9D012CF8  3184FFFF   ANDI A0, T4, -1
9D012CFC  308E00FF   ANDI T6, A0, 255
9D012D00  01C7402B   SLTU T0, T6, A3
9D012D04  11000008   BEQ T0, ZERO, 0x9D012D28
9D012D08  26110001   ADDIU S1, S0, 1
9D012D0C  8F8380E8   LW V1, -32536(GP)
9D012D10  2465FFFF   ADDIU A1, V1, -1
9D012D14  AF8580E8   SW A1, -32536(GP)
9D012D18  26783010   ADDIU T8, S3, 12304
9D012D1C  8F190054   LW T9, 84(T8)
9D012D20  27290001   ADDIU T1, T9, 1
9D012D24  AF090054   SW T1, 84(T8)
9D012D28  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D012D2C  00000000   NOP
9D012D30  00409021   ADDU S2, V0, ZERO
9D012D34  8F9480E8   LW S4, -32536(GP)
9D012D38  2695FFFB   ADDIU S5, S4, -5
9D012D3C  AF9580E8   SW S5, -32536(GP)
9D012D40  266B3010   ADDIU T3, S3, 12304
9D012D44  8D640054   LW A0, 84(T3)
9D012D48  248F0005   ADDIU T7, A0, 5
9D012D54  0040A021   ADDU S4, V0, ZERO
9D012D58  0B40565D   J .L95
9D012D5C  0040A821   ADDU S5, V0, ZERO
9D012D90  0240A021   ADDU S4, S2, ZERO
2124:                         OPCODE_END
9D012D4C  1EA00004   BGTZ S5, 0x9D012D60
9D012D50  AD6F0054   SW T7, 84(T3)
9D012D60  26100002   ADDIU S0, S0, 2
9D012D80  90EC0000   LBU T4, 0(A3)
9D012D84  000C7080   SLL T6, T4, 2
9D012D88  01D64021   ADDU T0, T6, S6
9D012D8C  8D050000   LW A1, 0(T0)
9D012D94  0B403272   J 0x9D00C9C8
9D012D98  0240A821   ADDU S5, S2, ZERO
2125:                
2126:                      OPCODE_BEGIN(B3)  /* LAX ($nn),Y */
2127:                         LAX(5, INDIR_Y_BYTE_READ);
9D012DC8  8FAF0010   LW T7, 16(SP)
9D012DCC  008F3021   ADDU A2, A0, T7
9D012DD0  30C4FFFF   ANDI A0, A2, -1
9D012DD4  308A00FF   ANDI T2, A0, 255
9D012DD8  014F102B   SLTU V0, T2, T7
9D012DDC  10400008   BEQ V0, ZERO, 0x9D012E00
9D012DE0  26110001   ADDIU S1, S0, 1
9D012DE4  8F9F80E8   LW RA, -32536(GP)
9D012DE8  27EDFFFF   ADDIU T5, RA, -1
9D012DEC  AF8D80E8   SW T5, -32536(GP)
9D012DF0  26673010   ADDIU A3, S3, 12304
9D012DF4  8CEC0054   LW T4, 84(A3)
9D012DF8  258E0001   ADDIU T6, T4, 1
9D012DFC  ACEE0054   SW T6, 84(A3)
9D012E00  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D012E04  00000000   NOP
9D012E08  00409021   ADDU S2, V0, ZERO
9D012E0C  8F8880E8   LW T0, -32536(GP)
9D012E10  251EFFFB   ADDIU FP, T0, -5
9D012E14  AF9E80E8   SW FP, -32536(GP)
9D012E18  26633010   ADDIU V1, S3, 12304
9D012E1C  8C650054   LW A1, 84(V1)
9D012E20  24B80005   ADDIU T8, A1, 5
9D012E2C  0040F021   ADDU FP, V0, ZERO
9D012E30  0040A021   ADDU S4, V0, ZERO
9D012E34  0B40565D   J .L95
9D012E38  0040A821   ADDU S5, V0, ZERO
9D012E6C  0040F021   ADDU FP, V0, ZERO
9D012E70  0040A021   ADDU S4, V0, ZERO
2128:                         OPCODE_END
9D012E24  1FC00005   BGTZ FP, 0x9D012E3C
9D012E28  AC780054   SW T8, 84(V1)
9D012E3C  26100002   ADDIU S0, S0, 2
9D012E5C  908F0000   LBU T7, 0(A0)
9D012E60  000F3080   SLL A2, T7, 2
9D012E64  00D65021   ADDU T2, A2, S6
9D012E68  8D450000   LW A1, 0(T2)
9D012E74  0B403272   J 0x9D00C9C8
9D012E78  0040A821   ADDU S5, V0, ZERO
2129:                
2130:                      OPCODE_BEGIN(B4)  /* LDY $nn,X */
2131:                         LDY(4, ZP_IND_X_BYTE);
9D012E7C  26110001   ADDIU S1, S0, 1
9D012E9C  91C80000   LBU T0, 0(T6)
9D012EA0  03C81821   ADDU V1, FP, T0
9D012EA4  306500FF   ANDI A1, V1, 255
9D012EA8  8F9880E4   LW T8, -32540(GP)
9D012EAC  0305C821   ADDU T9, T8, A1
9D012EB0  93320000   LBU S2, 0(T9)
9D012EB4  8F8980E8   LW T1, -32536(GP)
9D012EB8  2535FFFC   ADDIU S5, T1, -4
9D012EBC  AF9580E8   SW S5, -32536(GP)
9D012EC0  8C4B0054   LW T3, 84(V0)
9D012EC4  25640004   ADDIU A0, T3, 4
9D012ED0  AFB20010   SW S2, 16(SP)
9D012ED4  0B40565D   J .L95
9D012ED8  0240A821   ADDU S5, S2, ZERO
9D012F0C  AFB20010   SW S2, 16(SP)
2132:                         OPCODE_END
9D012EC8  1EA00004   BGTZ S5, 0x9D012EDC
9D012ECC  AC440054   SW A0, 84(V0)
9D012EDC  26100002   ADDIU S0, S0, 2
9D012EFC  91A70000   LBU A3, 0(T5)
9D012F00  00076080   SLL T4, A3, 2
9D012F04  01967021   ADDU T6, T4, S6
9D012F08  8DC50000   LW A1, 0(T6)
9D012F10  0B403272   J 0x9D00C9C8
9D012F14  0240A821   ADDU S5, S2, ZERO
2133:                
2134:                      OPCODE_BEGIN(B5)  /* LDA $nn,X */
2135:                         LDA(4, ZP_IND_X_BYTE);
9D012F18  26110001   ADDIU S1, S0, 1
9D012F38  93290000   LBU T1, 0(T9)
9D012F3C  03C9A821   ADDU S5, FP, T1
9D012F40  32AB00FF   ANDI T3, S5, 255
9D012F44  8F8480E4   LW A0, -32540(GP)
9D012F48  008B7821   ADDU T7, A0, T3
9D012F4C  91F20000   LBU S2, 0(T7)
9D012F50  8F8680E8   LW A2, -32536(GP)
9D012F54  24CAFFFC   ADDIU T2, A2, -4
9D012F58  AF8A80E8   SW T2, -32536(GP)
9D012F5C  8D1F0054   LW RA, 84(T0)
9D012F60  27E20004   ADDIU V0, RA, 4
9D012F6C  0240A021   ADDU S4, S2, ZERO
9D012F70  0B40565D   J .L95
9D012F74  0240A821   ADDU S5, S2, ZERO
9D012FA8  0240A021   ADDU S4, S2, ZERO
2136:                         OPCODE_END
9D012F64  1D400004   BGTZ T2, 0x9D012F78
9D012F68  AD020054   SW V0, 84(T0)
9D012F78  26100002   ADDIU S0, S0, 2
9D012F98  91050000   LBU A1, 0(T0)
9D012F9C  00051880   SLL V1, A1, 2
9D012FA0  0076C021   ADDU T8, V1, S6
9D012FA4  8F050000   LW A1, 0(T8)
9D012FAC  0B403272   J 0x9D00C9C8
9D012FB0  0240A821   ADDU S5, S2, ZERO
2137:                
2138:                      OPCODE_BEGIN(B6)  /* LDX $nn,Y */
2139:                         LDX(4, ZP_IND_Y_BYTE);
9D012FB4  26110001   ADDIU S1, S0, 1
9D012FD4  908F0000   LBU T7, 0(A0)
9D012FD8  8FA60010   LW A2, 16(SP)
9D012FDC  00CF5021   ADDU T2, A2, T7
9D012FE0  315F00FF   ANDI RA, T2, 255
9D012FE4  8F8280E4   LW V0, -32540(GP)
9D012FE8  005F6821   ADDU T5, V0, RA
9D012FEC  91B20000   LBU S2, 0(T5)
9D012FF0  8F8780E8   LW A3, -32536(GP)
9D012FF4  24ECFFFC   ADDIU T4, A3, -4
9D012FF8  AF8C80E8   SW T4, -32536(GP)
9D012FFC  8F2E0054   LW T6, 84(T9)
9D013000  25C80004   ADDIU T0, T6, 4
9D01300C  0240F021   ADDU FP, S2, ZERO
9D013010  0B40565D   J .L95
9D013014  0240A821   ADDU S5, S2, ZERO
9D013048  0240F021   ADDU FP, S2, ZERO
2140:                         OPCODE_END
9D013004  1D800004   BGTZ T4, 0x9D013018
9D013008  AF280054   SW T0, 84(T9)
9D013018  26100002   ADDIU S0, S0, 2
9D013038  91350000   LBU S5, 0(T1)
9D01303C  00155880   SLL T3, S5, 2
9D013040  01762021   ADDU A0, T3, S6
9D013044  8C850000   LW A1, 0(A0)
9D01304C  0B403272   J 0x9D00C9C8
9D013050  0240A821   ADDU S5, S2, ZERO
2141:                
2142:                      OPCODE_BEGIN(B7)  /* LAX $nn,Y */
2143:                         LAX(4, ZP_IND_Y_BYTE);
9D013054  26110001   ADDIU S1, S0, 1
9D013074  904D0000   LBU T5, 0(V0)
9D013078  8FA70010   LW A3, 16(SP)
9D01307C  00ED6021   ADDU T4, A3, T5
9D013080  318E00FF   ANDI T6, T4, 255
9D013084  8F8880E4   LW T0, -32540(GP)
9D013088  010E2821   ADDU A1, T0, T6
9D01308C  90B20000   LBU S2, 0(A1)
9D013090  8F8380E8   LW V1, -32536(GP)
9D013094  2478FFFC   ADDIU T8, V1, -4
9D013098  AF9880E8   SW T8, -32536(GP)
9D01309C  8DFE0054   LW FP, 84(T7)
9D0130A0  27D90004   ADDIU T9, FP, 4
9D0130AC  0240F021   ADDU FP, S2, ZERO
9D0130B0  0240A021   ADDU S4, S2, ZERO
9D0130B4  0B40565D   J .L95
9D0130B8  0240A821   ADDU S5, S2, ZERO
9D0130EC  0240F021   ADDU FP, S2, ZERO
9D0130F0  0240A021   ADDU S4, S2, ZERO
2144:                         OPCODE_END
9D0130A4  1F000005   BGTZ T8, 0x9D0130BC
9D0130A8  ADF90054   SW T9, 84(T7)
9D0130BC  26100002   ADDIU S0, S0, 2
9D0130DC  91E60000   LBU A2, 0(T7)
9D0130E0  00065080   SLL T2, A2, 2
9D0130E4  0156F821   ADDU RA, T2, S6
9D0130E8  8FE50000   LW A1, 0(RA)
9D0130F4  0B403272   J 0x9D00C9C8
9D0130F8  0240A821   ADDU S5, S2, ZERO
2145:                
2146:                      OPCODE_BEGIN(B8)  /* CLV */
2147:                         CLV();
9D0130FC  8F8280E8   LW V0, -32536(GP)
9D013100  244DFFFE   ADDIU T5, V0, -2
9D013104  AF8D80E8   SW T5, -32536(GP)
9D013108  26673010   ADDIU A3, S3, 12304
9D01310C  8CEC0054   LW T4, 84(A3)
9D013110  258E0002   ADDIU T6, T4, 2
9D013120  0B40565D   J .L95
9D013124  AFA00014   SW ZERO, 20(SP)
2148:                         OPCODE_END
9D013114  1DA00004   BGTZ T5, .LBB1318
9D013118  ACEE0054   SW T6, 84(A3)
9D01311C  02008821   ADDU S1, S0, ZERO
9D013144  91640000   LBU A0, 0(T3)
9D013148  00048880   SLL S1, A0, 2
9D01314C  02367821   ADDU T7, S1, S6
9D013150  8DE50000   LW A1, 0(T7)
9D013154  26100001   ADDIU S0, S0, 1
9D013158  0B403272   J 0x9D00C9C8
9D01315C  AFA00014   SW ZERO, 20(SP)
2149:                
2150:                      OPCODE_BEGIN(B9)  /* LDA $nnnn,Y */
2151:                         LDA(4, ABS_IND_Y_BYTE_READ);
9D013160  0F4030A7   JAL bank_readword
9D013164  02002021   ADDU A0, S0, ZERO
9D013168  8FB20010   LW S2, 16(SP)
9D01316C  0052A821   ADDU S5, V0, S2
9D013170  32A4FFFF   ANDI A0, S5, -1
9D013174  309400FF   ANDI S4, A0, 255
9D013178  0292302B   SLTU A2, S4, S2
9D01317C  10C00008   BEQ A2, ZERO, 0x9D0131A0
9D013180  26110002   ADDIU S1, S0, 2
9D013184  8F8A80E8   LW T2, -32536(GP)
9D013188  255FFFFF   ADDIU RA, T2, -1
9D01318C  AF9F80E8   SW RA, -32536(GP)
9D013190  26623010   ADDIU V0, S3, 12304
9D013194  8C4D0054   LW T5, 84(V0)
9D013198  25A70001   ADDIU A3, T5, 1
9D01319C  AC470054   SW A3, 84(V0)
9D0131A0  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0131A4  00000000   NOP
9D0131A8  00409021   ADDU S2, V0, ZERO
9D0131AC  8F8C80E8   LW T4, -32536(GP)
9D0131B0  258EFFFC   ADDIU T6, T4, -4
9D0131B4  AF8E80E8   SW T6, -32536(GP)
9D0131B8  26683010   ADDIU T0, S3, 12304
9D0131BC  8D050054   LW A1, 84(T0)
9D0131C0  24A30004   ADDIU V1, A1, 4
9D0131CC  0040A021   ADDU S4, V0, ZERO
9D0131D0  0B40565D   J .L95
9D0131D4  0040A821   ADDU S5, V0, ZERO
9D013208  0040A021   ADDU S4, V0, ZERO
2152:                         OPCODE_END
9D0131C4  1DC00004   BGTZ T6, 0x9D0131D8
9D0131C8  AD030054   SW V1, 84(T0)
9D0131D8  26100003   ADDIU S0, S0, 3
9D0131F8  91F50000   LBU S5, 0(T7)
9D0131FC  0015A080   SLL S4, S5, 2
9D013200  02963021   ADDU A2, S4, S6
9D013204  8CC50000   LW A1, 0(A2)
9D01320C  0B403272   J 0x9D00C9C8
9D013210  0040A821   ADDU S5, V0, ZERO
2153:                
2154:                      OPCODE_BEGIN(BA)  /* TSX */
2155:                         TSX();
9D013214  8F9E80E8   LW FP, -32536(GP)
9D013218  27D2FFFE   ADDIU S2, FP, -2
9D01321C  AF9280E8   SW S2, -32536(GP)
9D013220  266A3010   ADDIU T2, S3, 12304
9D013224  8D5F0054   LW RA, 84(T2)
9D013228  27E20002   ADDIU V0, RA, 2
2156:                         OPCODE_END
9D01322C  1E400006   BGTZ S2, .LBB1322
9D013230  AD420054   SW V0, 84(T2)
9D013234  8FB20018   LW S2, 24(SP)
9D013238  0240F021   ADDU FP, S2, ZERO
9D01323C  02008821   ADDU S1, S0, ZERO
9D013240  0B40565D   J .L95
9D013244  0240A821   ADDU S5, S2, ZERO
9D013264  90780000   LBU T8, 0(V1)
9D013268  0018C880   SLL T9, T8, 2
9D01326C  03364821   ADDU T1, T9, S6
9D013270  8D250000   LW A1, 0(T1)
9D013274  8FBE0018   LW FP, 24(SP)
9D013278  26100001   ADDIU S0, S0, 1
9D01327C  03C0A821   ADDU S5, FP, ZERO
9D013280  0B403272   J 0x9D00C9C8
9D013284  03C09021   ADDU S2, FP, ZERO
2157:                
2158:                      OPCODE_BEGIN(BB)  /* LAS $nnnn,Y */
2159:                         LAS(4, ABS_IND_Y_BYTE_READ);
9D013288  0F4030A7   JAL bank_readword
9D01328C  02002021   ADDU A0, S0, ZERO
9D013290  8FAB0010   LW T3, 16(SP)
9D013294  004B2021   ADDU A0, V0, T3
9D013298  3084FFFF   ANDI A0, A0, -1
9D01329C  308F00FF   ANDI T7, A0, 255
9D0132A0  8FB50010   LW S5, 16(SP)
9D0132A4  01F5A02B   SLTU S4, T7, S5
9D0132A8  12800008   BEQ S4, ZERO, 0x9D0132CC
9D0132AC  26110002   ADDIU S1, S0, 2
9D0132B0  8F8680E8   LW A2, -32536(GP)
9D0132B4  24DEFFFF   ADDIU FP, A2, -1
9D0132B8  AF9E80E8   SW FP, -32536(GP)
9D0132BC  26723010   ADDIU S2, S3, 12304
9D0132C0  8E4A0054   LW T2, 84(S2)
9D0132C4  255F0001   ADDIU RA, T2, 1
9D0132C8  AE5F0054   SW RA, 84(S2)
9D0132CC  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0132D0  00000000   NOP
9D0132D4  8FAD0018   LW T5, 24(SP)
9D0132D8  004D1024   AND V0, V0, T5
9D0132DC  305200FF   ANDI S2, V0, 255
9D0132E0  8F8780E8   LW A3, -32536(GP)
9D0132E4  24ECFFFC   ADDIU T4, A3, -4
9D0132E8  AF8C80E8   SW T4, -32536(GP)
9D0132EC  266E3010   ADDIU T6, S3, 12304
9D0132F0  8DC80054   LW T0, 84(T6)
9D0132F4  25050004   ADDIU A1, T0, 4
9D013300  AFB20018   SW S2, 24(SP)
9D013304  0240F021   ADDU FP, S2, ZERO
9D013308  0240A021   ADDU S4, S2, ZERO
9D01330C  0B40565D   J .L95
9D013310  0240A821   ADDU S5, S2, ZERO
9D013344  AFB20018   SW S2, 24(SP)
9D013348  0240F021   ADDU FP, S2, ZERO
9D01334C  0240A021   ADDU S4, S2, ZERO
2160:                         OPCODE_END
9D0132F8  1D800006   BGTZ T4, 0x9D013314
9D0132FC  ADC50054   SW A1, 84(T6)
9D013314  26100003   ADDIU S0, S0, 3
9D013334  908F0000   LBU T7, 0(A0)
9D013338  000FA880   SLL S5, T7, 2
9D01333C  02B6A021   ADDU S4, S5, S6
9D013340  8E850000   LW A1, 0(S4)
9D013350  0B403272   J 0x9D00C9C8
9D013354  0240A821   ADDU S5, S2, ZERO
2161:                
2162:                      OPCODE_BEGIN(BC)  /* LDY $nnnn,X */
2163:                         LDY(4, ABS_IND_X_BYTE_READ);
9D013358  0F4030A7   JAL bank_readword
9D01335C  02002021   ADDU A0, S0, ZERO
9D013360  005E3021   ADDU A2, V0, FP
9D013364  30C4FFFF   ANDI A0, A2, -1
9D013368  309200FF   ANDI S2, A0, 255
9D01336C  025E502B   SLTU T2, S2, FP
9D013370  11400008   BEQ T2, ZERO, 0x9D013394
9D013374  26110002   ADDIU S1, S0, 2
9D013378  8F9F80E8   LW RA, -32536(GP)
9D01337C  27EDFFFF   ADDIU T5, RA, -1
9D013380  AF8D80E8   SW T5, -32536(GP)
9D013384  26623010   ADDIU V0, S3, 12304
9D013388  8C470054   LW A3, 84(V0)
9D01338C  24EC0001   ADDIU T4, A3, 1
9D013390  AC4C0054   SW T4, 84(V0)
9D013394  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D013398  00000000   NOP
9D01339C  00409021   ADDU S2, V0, ZERO
9D0133A0  8F8E80E8   LW T6, -32536(GP)
9D0133A4  25C8FFFC   ADDIU T0, T6, -4
9D0133A8  AF8880E8   SW T0, -32536(GP)
9D0133AC  26653010   ADDIU A1, S3, 12304
9D0133B0  8CA30054   LW V1, 84(A1)
9D0133B4  24780004   ADDIU T8, V1, 4
9D0133C0  AFA20010   SW V0, 16(SP)
9D0133C4  0B40565D   J .L95
9D0133C8  0040A821   ADDU S5, V0, ZERO
9D0133FC  AFA20010   SW V0, 16(SP)
2164:                         OPCODE_END
9D0133B8  1D000004   BGTZ T0, 0x9D0133CC
9D0133BC  ACB80054   SW T8, 84(A1)
9D0133CC  26100003   ADDIU S0, S0, 3
9D0133EC  92A60000   LBU A2, 0(S5)
9D0133F0  00065080   SLL T2, A2, 2
9D0133F4  0156F821   ADDU RA, T2, S6
9D0133F8  8FE50000   LW A1, 0(RA)
9D013400  0B403272   J 0x9D00C9C8
9D013404  0040A821   ADDU S5, V0, ZERO
2165:                
2166:                      OPCODE_BEGIN(BD)  /* LDA $nnnn,X */
2167:                         LDA(4, ABS_IND_X_BYTE_READ);
9D013408  0F4030A7   JAL bank_readword
9D01340C  02002021   ADDU A0, S0, ZERO
9D013410  005EA021   ADDU S4, V0, FP
9D013414  3284FFFF   ANDI A0, S4, -1
9D013418  309200FF   ANDI S2, A0, 255
9D01341C  025E682B   SLTU T5, S2, FP
9D013420  11A00008   BEQ T5, ZERO, 0x9D013444
9D013424  26110002   ADDIU S1, S0, 2
9D013428  8F8280E8   LW V0, -32536(GP)
9D01342C  2447FFFF   ADDIU A3, V0, -1
9D013430  AF8780E8   SW A3, -32536(GP)
9D013434  266C3010   ADDIU T4, S3, 12304
9D013438  8D8E0054   LW T6, 84(T4)
9D01343C  25C80001   ADDIU T0, T6, 1
9D013440  AD880054   SW T0, 84(T4)
9D013444  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D013448  00000000   NOP
9D01344C  00409021   ADDU S2, V0, ZERO
9D013450  8F8580E8   LW A1, -32536(GP)
9D013454  24B8FFFC   ADDIU T8, A1, -4
9D013458  AF9880E8   SW T8, -32536(GP)
9D01345C  26633010   ADDIU V1, S3, 12304
9D013460  8C790054   LW T9, 84(V1)
9D013464  27290004   ADDIU T1, T9, 4
9D013470  0040A021   ADDU S4, V0, ZERO
9D013474  0B40565D   J .L95
9D013478  0040A821   ADDU S5, V0, ZERO
9D0134AC  0040A021   ADDU S4, V0, ZERO
2168:                         OPCODE_END
9D013468  1F000004   BGTZ T8, 0x9D01347C
9D01346C  AC690054   SW T1, 84(V1)
9D01347C  26100003   ADDIU S0, S0, 3
9D01349C  915F0000   LBU RA, 0(T2)
9D0134A0  001FA080   SLL S4, RA, 2
9D0134A4  02966821   ADDU T5, S4, S6
9D0134A8  8DA50000   LW A1, 0(T5)
9D0134B0  0B403272   J 0x9D00C9C8
9D0134B4  0040A821   ADDU S5, V0, ZERO
2169:                
2170:                      OPCODE_BEGIN(BE)  /* LDX $nnnn,Y */
2171:                         LDX(4, ABS_IND_Y_BYTE_READ);
9D0134B8  0F4030A7   JAL bank_readword
9D0134BC  02002021   ADDU A0, S0, ZERO
9D0134C0  8FBE0010   LW FP, 16(SP)
9D0134C4  005E9021   ADDU S2, V0, FP
9D0134C8  3244FFFF   ANDI A0, S2, -1
9D0134CC  308200FF   ANDI V0, A0, 255
9D0134D0  005E382B   SLTU A3, V0, FP
9D0134D4  10E00008   BEQ A3, ZERO, 0x9D0134F8
9D0134D8  26110002   ADDIU S1, S0, 2
9D0134DC  8F8C80E8   LW T4, -32536(GP)
9D0134E0  258EFFFF   ADDIU T6, T4, -1
9D0134E4  AF8E80E8   SW T6, -32536(GP)
9D0134E8  26683010   ADDIU T0, S3, 12304
9D0134EC  8D050054   LW A1, 84(T0)
9D0134F0  24B80001   ADDIU T8, A1, 1
9D0134F4  AD180054   SW T8, 84(T0)
9D0134F8  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0134FC  00000000   NOP
9D013500  00409021   ADDU S2, V0, ZERO
9D013504  8F8380E8   LW V1, -32536(GP)
9D013508  2479FFFC   ADDIU T9, V1, -4
9D01350C  AF9980E8   SW T9, -32536(GP)
9D013510  26693010   ADDIU T1, S3, 12304
9D013514  8D2B0054   LW T3, 84(T1)
9D013518  25640004   ADDIU A0, T3, 4
9D013524  0040F021   ADDU FP, V0, ZERO
9D013528  0B40565D   J .L95
9D01352C  0040A821   ADDU S5, V0, ZERO
9D013560  0240F021   ADDU FP, S2, ZERO
2172:                         OPCODE_END
9D01351C  1F200004   BGTZ T9, 0x9D013530
9D013520  AD240054   SW A0, 84(T1)
9D013530  26100003   ADDIU S0, S0, 3
9D013550  91BE0000   LBU FP, 0(T5)
9D013554  001E1080   SLL V0, FP, 2
9D013558  00563821   ADDU A3, V0, S6
9D01355C  8CE50000   LW A1, 0(A3)
9D013564  0B403272   J 0x9D00C9C8
9D013568  0240A821   ADDU S5, S2, ZERO
2173:                
2174:                      OPCODE_BEGIN(BF)  /* LAX $nnnn,Y */
2175:                         LAX(4, ABS_IND_Y_BYTE_READ);
9D01356C  0F4030A7   JAL bank_readword
9D013570  02002021   ADDU A0, S0, ZERO
9D013574  8FB40010   LW S4, 16(SP)
9D013578  00549021   ADDU S2, V0, S4
9D01357C  3244FFFF   ANDI A0, S2, -1
9D013580  308C00FF   ANDI T4, A0, 255
9D013584  0194702B   SLTU T6, T4, S4
9D013588  11C00008   BEQ T6, ZERO, 0x9D0135AC
9D01358C  26110002   ADDIU S1, S0, 2
9D013590  8F8880E8   LW T0, -32536(GP)
9D013594  2505FFFF   ADDIU A1, T0, -1
9D013598  AF8580E8   SW A1, -32536(GP)
9D01359C  26783010   ADDIU T8, S3, 12304
9D0135A0  8F030054   LW V1, 84(T8)
9D0135A4  24790001   ADDIU T9, V1, 1
9D0135A8  AF190054   SW T9, 84(T8)
9D0135AC  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0135B0  00000000   NOP
9D0135B4  00409021   ADDU S2, V0, ZERO
9D0135B8  8F8980E8   LW T1, -32536(GP)
9D0135BC  252BFFFC   ADDIU T3, T1, -4
9D0135C0  AF8B80E8   SW T3, -32536(GP)
9D0135C4  266F3010   ADDIU T7, S3, 12304
9D0135C8  8DE40054   LW A0, 84(T7)
9D0135CC  24950004   ADDIU S5, A0, 4
9D0135D8  0040F021   ADDU FP, V0, ZERO
9D0135DC  0040A021   ADDU S4, V0, ZERO
9D0135E0  0B40565D   J .L95
9D0135E4  0040A821   ADDU S5, V0, ZERO
9D013618  0240F021   ADDU FP, S2, ZERO
9D01361C  0240A021   ADDU S4, S2, ZERO
2176:                         OPCODE_END
9D0135D0  1D600005   BGTZ T3, 0x9D0135E8
9D0135D4  ADF50054   SW S5, 84(T7)
9D0135E8  26100003   ADDIU S0, S0, 3
9D013608  90470000   LBU A3, 0(V0)
9D01360C  0007A080   SLL S4, A3, 2
9D013610  02966021   ADDU T4, S4, S6
9D013614  8D850000   LW A1, 0(T4)
9D013620  0B403272   J 0x9D00C9C8
9D013624  0240A821   ADDU S5, S2, ZERO
2177:                
2178:                      OPCODE_BEGIN(C0)  /* CPY #$nn */
2179:                         CPY(2, IMMEDIATE_BYTE);
9D013628  26110001   ADDIU S1, S0, 1
9D013648  90790000   LBU T9, 0(V1)
9D01364C  8FA90010   LW T1, 16(SP)
9D013650  01395823   SUBU T3, T1, T9
9D013654  7D6F0200   EXT T7, T3, 8, 1
9D013658  39F70001   XORI S7, T7, 1
9D01365C  317200FF   ANDI S2, T3, 255
9D013660  8F8480E8   LW A0, -32536(GP)
9D013664  2495FFFE   ADDIU S5, A0, -2
9D013668  AF9580E8   SW S5, -32536(GP)
9D01366C  8DC60054   LW A2, 84(T6)
9D013670  24CA0002   ADDIU T2, A2, 2
9D01367C  0B40565D   J .L95
9D013680  0240A821   ADDU S5, S2, ZERO
2180:                         OPCODE_END
9D013674  1EA00003   BGTZ S5, 0x9D013684
9D013678  ADCA0054   SW T2, 84(T6)
9D013684  26100002   ADDIU S0, S0, 2
9D0136A4  91C80000   LBU T0, 0(T6)
9D0136A8  00082880   SLL A1, T0, 2
9D0136AC  00B6C021   ADDU T8, A1, S6
9D0136B0  8F050000   LW A1, 0(T8)
9D0136B4  0B403272   J 0x9D00C9C8
9D0136B8  0240A821   ADDU S5, S2, ZERO
2181:                
2182:                      OPCODE_BEGIN(C1)  /* CMP ($nn,X) */
2183:                         CMP(6, INDIR_X_BYTE);
9D0136D8  916F0000   LBU T7, 0(T3)
9D0136DC  03CF2021   ADDU A0, FP, T7
9D0136EC  97E40000   LHU A0, 0(RA)
9D0136F0  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0136F4  26110001   ADDIU S1, S0, 1
9D0136F8  02826823   SUBU T5, S4, V0
9D0136FC  7DA20200   EXT V0, T5, 8, 1
9D013700  38570001   XORI S7, V0, 1
9D013704  31B200FF   ANDI S2, T5, 255
9D013708  8F8780E8   LW A3, -32536(GP)
9D01370C  24ECFFFA   ADDIU T4, A3, -6
9D013710  AF8C80E8   SW T4, -32536(GP)
9D013714  8EAE0054   LW T6, 84(S5)
9D013718  25C80006   ADDIU T0, T6, 6
9D013724  0B40565D   J .L95
9D013728  0240A821   ADDU S5, S2, ZERO
2184:                         OPCODE_END
9D01371C  1D800003   BGTZ T4, 0x9D01372C
9D013720  AEA80054   SW T0, 84(S5)
9D01372C  26100002   ADDIU S0, S0, 2
9D01374C  912B0000   LBU T3, 0(T1)
9D013750  000B7880   SLL T7, T3, 2
9D013754  01F62021   ADDU A0, T7, S6
9D013758  8C850000   LW A1, 0(A0)
9D01375C  0B403272   J 0x9D00C9C8
9D013760  0240A821   ADDU S5, S2, ZERO
2185:                
2186:                      OPCODE_BEGIN(C3)  /* DCP ($nn,X) */
2187:                         DCP(8, INDIR_X, mem_writebyte, addr);
9D013764  26110001   ADDIU S1, S0, 1
9D013784  91A20000   LBU V0, 0(T5)
9D013788  03C23821   ADDU A3, FP, V0
9D01379C  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0137A0  02E02021   ADDU A0, S7, ZERO
9D0137A4  2445FFFF   ADDIU A1, V0, -1
9D0137A8  30B200FF   ANDI S2, A1, 255
9D0137AC  02E02021   ADDU A0, S7, ZERO
9D0137B0  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D0137B4  02402821   ADDU A1, S2, ZERO
9D0137B8  0292C023   SUBU T8, S4, S2
9D0137BC  7F030200   EXT V1, T8, 8, 1
9D0137C0  38770001   XORI S7, V1, 1
9D0137C4  331200FF   ANDI S2, T8, 255
9D0137C8  8F9980E8   LW T9, -32536(GP)
9D0137CC  2729FFF8   ADDIU T1, T9, -8
9D0137D0  AF8980E8   SW T1, -32536(GP)
9D0137D4  8EAB0054   LW T3, 84(S5)
9D0137D8  256F0008   ADDIU T7, T3, 8
9D0137E4  0B40565D   J .L95
9D0137E8  0240A821   ADDU S5, S2, ZERO
2188:                         OPCODE_END
9D0137DC  1D200003   BGTZ T1, 0x9D0137EC
9D0137E0  AEAF0054   SW T7, 84(S5)
9D0137EC  26100002   ADDIU S0, S0, 2
9D01380C  91A20000   LBU V0, 0(T5)
9D013810  00023880   SLL A3, V0, 2
9D013814  00F66021   ADDU T4, A3, S6
9D013818  8D850000   LW A1, 0(T4)
9D01381C  0B403272   J 0x9D00C9C8
9D013820  0240A821   ADDU S5, S2, ZERO
2189:                
2190:                      OPCODE_BEGIN(C4)  /* CPY $nn */
2191:                         CPY(3, ZERO_PAGE_BYTE);
9D013824  26110001   ADDIU S1, S0, 1
9D013844  90790000   LBU T9, 0(V1)
9D013848  8F8980E4   LW T1, -32540(GP)
9D01384C  01395821   ADDU T3, T1, T9
9D013850  916F0000   LBU T7, 0(T3)
9D013854  8FA40010   LW A0, 16(SP)
9D013858  008FA823   SUBU S5, A0, T7
9D01385C  7EA60200   EXT A2, S5, 8, 1
9D013860  38D70001   XORI S7, A2, 1
9D013864  32B200FF   ANDI S2, S5, 255
9D013868  8F8A80E8   LW T2, -32536(GP)
9D01386C  255FFFFD   ADDIU RA, T2, -3
9D013870  AF9F80E8   SW RA, -32536(GP)
9D013874  8CAD0054   LW T5, 84(A1)
9D013878  25A20003   ADDIU V0, T5, 3
9D013884  0B40565D   J .L95
9D013888  0240A821   ADDU S5, S2, ZERO
2192:                         OPCODE_END
9D01387C  1FE00003   BGTZ RA, 0x9D01388C
9D013880  ACA20054   SW V0, 84(A1)
9D01388C  26100002   ADDIU S0, S0, 2
9D0138AC  93030000   LBU V1, 0(T8)
9D0138B0  0003C880   SLL T9, V1, 2
9D0138B4  03364821   ADDU T1, T9, S6
9D0138B8  8D250000   LW A1, 0(T1)
9D0138BC  0B403272   J 0x9D00C9C8
9D0138C0  0240A821   ADDU S5, S2, ZERO
2193:                
2194:                      OPCODE_BEGIN(C5)  /* CMP $nn */
2195:                         CMP(3, ZERO_PAGE_BYTE);
9D0138C4  26110001   ADDIU S1, S0, 1
9D0138E4  90CA0000   LBU T2, 0(A2)
9D0138E8  8F9F80E4   LW RA, -32540(GP)
9D0138EC  03EA6821   ADDU T5, RA, T2
9D0138F0  91A20000   LBU V0, 0(T5)
9D0138F4  02823823   SUBU A3, S4, V0
9D0138F8  7CEC0200   EXT T4, A3, 8, 1
9D0138FC  39970001   XORI S7, T4, 1
9D013900  30F200FF   ANDI S2, A3, 255
9D013904  8F8E80E8   LW T6, -32536(GP)
9D013908  25C8FFFD   ADDIU T0, T6, -3
9D01390C  AF8880E8   SW T0, -32536(GP)
9D013910  8D650054   LW A1, 84(T3)
9D013914  24B80003   ADDIU T8, A1, 3
9D013920  0B40565D   J .L95
9D013924  0240A821   ADDU S5, S2, ZERO
2196:                         OPCODE_END
9D013918  1D000003   BGTZ T0, 0x9D013928
9D01391C  AD780054   SW T8, 84(T3)
9D013928  26100002   ADDIU S0, S0, 2
9D013948  92A40000   LBU A0, 0(S5)
9D01394C  00043080   SLL A2, A0, 2
9D013950  00D65021   ADDU T2, A2, S6
9D013954  8D450000   LW A1, 0(T2)
9D013958  0B403272   J 0x9D00C9C8
9D01395C  0240A821   ADDU S5, S2, ZERO
2197:                
2198:                      OPCODE_BEGIN(C6)  /* DEC $nn */
2199:                         DEC(5, ZERO_PAGE, ZP_WRITEBYTE, baddr);
9D013960  26110001   ADDIU S1, S0, 1
9D013980  91C80000   LBU T0, 0(T6)
9D013984  8F8580E4   LW A1, -32540(GP)
9D013988  00A8C021   ADDU T8, A1, T0
9D01398C  93030000   LBU V1, 0(T8)
9D013990  2479FFFF   ADDIU T9, V1, -1
9D013994  333200FF   ANDI S2, T9, 255
9D013998  A3120000   SB S2, 0(T8)
9D01399C  8F8980E8   LW T1, -32536(GP)
9D0139A0  252BFFFB   ADDIU T3, T1, -5
9D0139A4  AF8B80E8   SW T3, -32536(GP)
9D0139A8  8DAF0054   LW T7, 84(T5)
9D0139AC  25F50005   ADDIU S5, T7, 5
9D0139B8  0B40565D   J .L95
9D0139BC  0240A821   ADDU S5, S2, ZERO
2200:                         OPCODE_END
9D0139B0  1D600003   BGTZ T3, 0x9D0139C0
9D0139B4  ADB50054   SW S5, 84(T5)
9D0139C0  26100002   ADDIU S0, S0, 2
9D0139E0  90470000   LBU A3, 0(V0)
9D0139E4  00076080   SLL T4, A3, 2
9D0139E8  01967021   ADDU T6, T4, S6
9D0139EC  8DC50000   LW A1, 0(T6)
9D0139F0  0B403272   J 0x9D00C9C8
9D0139F4  0240A821   ADDU S5, S2, ZERO
2201:                
2202:                      OPCODE_BEGIN(C7)  /* DCP $nn */
2203:                         DCP(5, ZERO_PAGE, ZP_WRITEBYTE, baddr);
9D0139F8  26110001   ADDIU S1, S0, 1
9D013A18  93290000   LBU T1, 0(T9)
9D013A1C  8F8B80E4   LW T3, -32540(GP)
9D013A20  01697821   ADDU T7, T3, T1
9D013A24  91F50000   LBU S5, 0(T7)
9D013A28  26A4FFFF   ADDIU A0, S5, -1
9D013A2C  308600FF   ANDI A2, A0, 255
9D013A30  A1E60000   SB A2, 0(T7)
9D013A34  02865023   SUBU T2, S4, A2
9D013A38  7D5F0200   EXT RA, T2, 8, 1
9D013A3C  3BF70001   XORI S7, RA, 1
9D013A40  315200FF   ANDI S2, T2, 255
9D013A44  8F8D80E8   LW T5, -32536(GP)
9D013A48  25A2FFFB   ADDIU V0, T5, -5
9D013A4C  AF8280E8   SW V0, -32536(GP)
9D013A50  8D070054   LW A3, 84(T0)
9D013A54  24EC0005   ADDIU T4, A3, 5
9D013A60  0B40565D   J .L95
9D013A64  0240A821   ADDU S5, S2, ZERO
2204:                         OPCODE_END
9D013A58  1C400003   BGTZ V0, 0x9D013A68
9D013A5C  AD0C0054   SW T4, 84(T0)
9D013A68  26100002   ADDIU S0, S0, 2
9D013A88  93290000   LBU T1, 0(T9)
9D013A8C  00095880   SLL T3, T1, 2
9D013A90  01767821   ADDU T7, T3, S6
9D013A94  8DE50000   LW A1, 0(T7)
9D013A98  0B403272   J 0x9D00C9C8
9D013A9C  0240A821   ADDU S5, S2, ZERO
2205:                
2206:                      OPCODE_BEGIN(C8)  /* INY */
2207:                         INY();
9D013AA0  8FB20010   LW S2, 16(SP)
9D013AA4  26550001   ADDIU S5, S2, 1
9D013AA8  32B200FF   ANDI S2, S5, 255
9D013AAC  8F8480E8   LW A0, -32536(GP)
9D013AB0  2486FFFE   ADDIU A2, A0, -2
9D013AB4  AF8680E8   SW A2, -32536(GP)
9D013AB8  266A3010   ADDIU T2, S3, 12304
9D013ABC  8D5F0054   LW RA, 84(T2)
9D013AC0  27ED0002   ADDIU T5, RA, 2
9D013ACC  AFB20010   SW S2, 16(SP)
9D013AD4  0B40565D   J .L95
9D013AD8  0240A821   ADDU S5, S2, ZERO
9D013B08  AFB20010   SW S2, 16(SP)
2208:                         OPCODE_END
9D013AC4  1CC00005   BGTZ A2, .LBB1366
9D013AC8  AD4D0054   SW T5, 84(T2)
9D013AD0  02008821   ADDU S1, S0, ZERO
9D013AF8  93110000   LBU S1, 0(T8)
9D013AFC  00111880   SLL V1, S1, 2
9D013B00  0076C821   ADDU T9, V1, S6
9D013B04  8F250000   LW A1, 0(T9)
9D013B0C  26100001   ADDIU S0, S0, 1
9D013B10  0B403272   J 0x9D00C9C8
9D013B14  0240A821   ADDU S5, S2, ZERO
2209:                
2210:                      OPCODE_BEGIN(C9)  /* CMP #$nn */
2211:                         CMP(2, IMMEDIATE_BYTE);
9D013B18  26110001   ADDIU S1, S0, 1
9D013B38  90860000   LBU A2, 0(A0)
9D013B3C  02865023   SUBU T2, S4, A2
9D013B40  7D5F0200   EXT RA, T2, 8, 1
9D013B44  3BF70001   XORI S7, RA, 1
9D013B48  315200FF   ANDI S2, T2, 255
9D013B4C  8F8D80E8   LW T5, -32536(GP)
9D013B50  25A2FFFE   ADDIU V0, T5, -2
9D013B54  AF8280E8   SW V0, -32536(GP)
9D013B58  8D670054   LW A3, 84(T3)
9D013B5C  24EC0002   ADDIU T4, A3, 2
9D013B68  0B40565D   J .L95
9D013B6C  0240A821   ADDU S5, S2, ZERO
2212:                         OPCODE_END
9D013B60  1C400003   BGTZ V0, 0x9D013B70
9D013B64  AD6C0054   SW T4, 84(T3)
9D013B70  26100002   ADDIU S0, S0, 2
9D013B90  93290000   LBU T1, 0(T9)
9D013B94  00095880   SLL T3, T1, 2
9D013B98  01767821   ADDU T7, T3, S6
9D013B9C  8DE50000   LW A1, 0(T7)
9D013BA0  0B403272   J 0x9D00C9C8
9D013BA4  0240A821   ADDU S5, S2, ZERO
2213:                
2214:                      OPCODE_BEGIN(CA)  /* DEX */
2215:                         DEX();
9D013BA8  27DEFFFF   ADDIU FP, FP, -1
9D013BAC  33D200FF   ANDI S2, FP, 255
9D013BB0  8F9580E8   LW S5, -32536(GP)
9D013BB4  26A6FFFE   ADDIU A2, S5, -2
9D013BB8  AF8680E8   SW A2, -32536(GP)
9D013BBC  266A3010   ADDIU T2, S3, 12304
9D013BC0  8D440054   LW A0, 84(T2)
9D013BC4  249F0002   ADDIU RA, A0, 2
9D013BD0  0240F021   ADDU FP, S2, ZERO
9D013BD8  0B40565D   J .L95
9D013BDC  0240A821   ADDU S5, S2, ZERO
9D013C0C  0240F021   ADDU FP, S2, ZERO
2216:                         OPCODE_END
9D013BC8  1CC00005   BGTZ A2, .LBB1372
9D013BCC  AD5F0054   SW RA, 84(T2)
9D013BD4  02008821   ADDU S1, S0, ZERO
9D013BFC  90B80000   LBU T8, 0(A1)
9D013C00  00188880   SLL S1, T8, 2
9D013C04  02361821   ADDU V1, S1, S6
9D013C08  8C650000   LW A1, 0(V1)
9D013C10  26100001   ADDIU S0, S0, 1
9D013C14  0B403272   J 0x9D00C9C8
9D013C18  0240A821   ADDU S5, S2, ZERO
2217:                
2218:                      OPCODE_BEGIN(CB)  /* SBX #$nn */
2219:                         SBX(2, IMMEDIATE_BYTE);
9D013C1C  26110001   ADDIU S1, S0, 1
9D013C20  03D4B824   AND S7, FP, S4
9D013C24  32F200FF   ANDI S2, S7, 255
9D013C44  90CA0000   LBU T2, 0(A2)
9D013C48  024A2023   SUBU A0, S2, T2
9D013C4C  389F0100   XORI RA, A0, 256
9D013C50  7FF70200   EXT S7, RA, 8, 1
9D013C54  309200FF   ANDI S2, A0, 255
9D013C58  8F8D80E8   LW T5, -32536(GP)
9D013C5C  25A7FFFE   ADDIU A3, T5, -2
9D013C60  AF8780E8   SW A3, -32536(GP)
9D013C64  8D620054   LW V0, 84(T3)
9D013C68  244C0002   ADDIU T4, V0, 2
9D013C74  0240F021   ADDU FP, S2, ZERO
9D013C78  0B40565D   J .L95
9D013C7C  0240A821   ADDU S5, S2, ZERO
9D013CB0  0240F021   ADDU FP, S2, ZERO
2220:                         OPCODE_END
9D013C6C  1CE00004   BGTZ A3, 0x9D013C80
9D013C70  AD6C0054   SW T4, 84(T3)
9D013C80  26100002   ADDIU S0, S0, 2
9D013CA0  93290000   LBU T1, 0(T9)
9D013CA4  00095880   SLL T3, T1, 2
9D013CA8  01767821   ADDU T7, T3, S6
9D013CAC  8DE50000   LW A1, 0(T7)
9D013CB4  0B403272   J 0x9D00C9C8
9D013CB8  0240A821   ADDU S5, S2, ZERO
2221:                
2222:                      OPCODE_BEGIN(CC)  /* CPY $nnnn */
2223:                         CPY(4, ABSOLUTE_BYTE);
9D013CBC  0F4030A7   JAL bank_readword
9D013CC0  02002021   ADDU A0, S0, ZERO
9D013CC4  26110002   ADDIU S1, S0, 2
9D013CC8  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D013CCC  00402021   ADDU A0, V0, ZERO
9D013CD0  8FB70010   LW S7, 16(SP)
9D013CD4  02E29023   SUBU S2, S7, V0
9D013CD8  7E550200   EXT S5, S2, 8, 1
9D013CDC  3AB70001   XORI S7, S5, 1
9D013CE0  325200FF   ANDI S2, S2, 255
9D013CE4  8F8680E8   LW A2, -32536(GP)
9D013CE8  24CAFFFC   ADDIU T2, A2, -4
9D013CEC  AF8A80E8   SW T2, -32536(GP)
9D013CF0  266D3010   ADDIU T5, S3, 12304
9D013CF4  8DA40054   LW A0, 84(T5)
9D013CF8  24870004   ADDIU A3, A0, 4
9D013D04  0B40565D   J .L95
9D013D08  0240A821   ADDU S5, S2, ZERO
2224:                         OPCODE_END
9D013CFC  1D400003   BGTZ T2, 0x9D013D0C
9D013D00  ADA70054   SW A3, 84(T5)
9D013D0C  26100003   ADDIU S0, S0, 3
9D013D2C  93110000   LBU S1, 0(T8)
9D013D30  00111880   SLL V1, S1, 2
9D013D34  0076C821   ADDU T9, V1, S6
9D013D38  8F250000   LW A1, 0(T9)
9D013D3C  0B403272   J 0x9D00C9C8
9D013D40  0240A821   ADDU S5, S2, ZERO
2225:                
2226:                      OPCODE_BEGIN(CD)  /* CMP $nnnn */
2227:                         CMP(4, ABSOLUTE_BYTE);
9D013D44  0F4030A7   JAL bank_readword
9D013D48  02002021   ADDU A0, S0, ZERO
9D013D4C  26110002   ADDIU S1, S0, 2
9D013D50  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D013D54  00402021   ADDU A0, V0, ZERO
9D013D58  02824823   SUBU T1, S4, V0
9D013D5C  7D2B0200   EXT T3, T1, 8, 1
9D013D60  39770001   XORI S7, T3, 1
9D013D64  313200FF   ANDI S2, T1, 255
9D013D68  8F8F80E8   LW T7, -32536(GP)
9D013D6C  25F5FFFC   ADDIU S5, T7, -4
9D013D70  AF9580E8   SW S5, -32536(GP)
9D013D74  26663010   ADDIU A2, S3, 12304
9D013D78  8CCA0054   LW T2, 84(A2)
9D013D7C  254D0004   ADDIU T5, T2, 4
9D013D88  0B40565D   J .L95
9D013D8C  0240A821   ADDU S5, S2, ZERO
2228:                         OPCODE_END
9D013D80  1EA00003   BGTZ S5, 0x9D013D90
9D013D84  ACCD0054   SW T5, 84(A2)
9D013D90  26100003   ADDIU S0, S0, 3
9D013DB0  91050000   LBU A1, 0(T0)
9D013DB4  0005C080   SLL T8, A1, 2
9D013DB8  03168821   ADDU S1, T8, S6
9D013DBC  8E250000   LW A1, 0(S1)
9D013DC0  0B403272   J 0x9D00C9C8
9D013DC4  0240A821   ADDU S5, S2, ZERO
2229:                
2230:                      OPCODE_BEGIN(CE)  /* DEC $nnnn */
2231:                         DEC(6, ABSOLUTE, mem_writebyte, addr);
9D013DC8  0F4030A7   JAL bank_readword
9D013DCC  02002021   ADDU A0, S0, ZERO
9D013DD0  0040A821   ADDU S5, V0, ZERO
9D013DD4  26110002   ADDIU S1, S0, 2
9D013DD8  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D013DDC  00402021   ADDU A0, V0, ZERO
9D013DE0  2452FFFF   ADDIU S2, V0, -1
9D013DE4  325200FF   ANDI S2, S2, 255
9D013DE8  02A02021   ADDU A0, S5, ZERO
9D013DEC  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D013DF0  02402821   ADDU A1, S2, ZERO
9D013DF4  8F8380E8   LW V1, -32536(GP)
9D013DF8  2479FFFA   ADDIU T9, V1, -6
9D013DFC  AF9980E8   SW T9, -32536(GP)
9D013E00  26693010   ADDIU T1, S3, 12304
9D013E04  8D2B0054   LW T3, 84(T1)
9D013E08  256F0006   ADDIU T7, T3, 6
9D013E14  0B40565D   J .L95
9D013E18  0240A821   ADDU S5, S2, ZERO
2232:                         OPCODE_END
9D013E0C  1F200003   BGTZ T9, 0x9D013E1C
9D013E10  AD2F0054   SW T7, 84(T1)
9D013E1C  26100003   ADDIU S0, S0, 3
9D013E3C  918E0000   LBU T6, 0(T4)
9D013E40  000E1080   SLL V0, T6, 2
9D013E44  00564021   ADDU T0, V0, S6
9D013E48  8D050000   LW A1, 0(T0)
9D013E4C  0B403272   J 0x9D00C9C8
9D013E50  0240A821   ADDU S5, S2, ZERO
2233:                
2234:                      OPCODE_BEGIN(CF)  /* DCP $nnnn */
2235:                         DCP(6, ABSOLUTE, mem_writebyte, addr);
9D013E54  0F4030A7   JAL bank_readword
9D013E58  02002021   ADDU A0, S0, ZERO
9D013E5C  0040B821   ADDU S7, V0, ZERO
9D013E60  26110002   ADDIU S1, S0, 2
9D013E64  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D013E68  00402021   ADDU A0, V0, ZERO
9D013E6C  2445FFFF   ADDIU A1, V0, -1
9D013E70  30B500FF   ANDI S5, A1, 255
9D013E74  02E02021   ADDU A0, S7, ZERO
9D013E78  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D013E7C  02A02821   ADDU A1, S5, ZERO
9D013E80  0295C023   SUBU T8, S4, S5
9D013E84  7F120200   EXT S2, T8, 8, 1
9D013E88  3A570001   XORI S7, S2, 1
9D013E8C  331200FF   ANDI S2, T8, 255
9D013E90  8F8380E8   LW V1, -32536(GP)
9D013E94  2479FFFA   ADDIU T9, V1, -6
9D013E98  AF9980E8   SW T9, -32536(GP)
9D013E9C  26693010   ADDIU T1, S3, 12304
9D013EA0  8D2B0054   LW T3, 84(T1)
9D013EA4  256F0006   ADDIU T7, T3, 6
9D013EB0  0B40565D   J .L95
9D013EB4  0240A821   ADDU S5, S2, ZERO
2236:                         OPCODE_END
9D013EA8  1F200003   BGTZ T9, 0x9D013EB8
9D013EAC  AD2F0054   SW T7, 84(T1)
9D013EB8  26100003   ADDIU S0, S0, 3
9D013ED8  93EC0000   LBU T4, 0(RA)
9D013EDC  000C7080   SLL T6, T4, 2
9D013EE0  01D61021   ADDU V0, T6, S6
9D013EE4  8C450000   LW A1, 0(V0)
9D013EE8  0B403272   J 0x9D00C9C8
9D013EEC  0240A821   ADDU S5, S2, ZERO
2237:                      
2238:                      OPCODE_BEGIN(D0)  /* BNE $nnnn */
2239:                         BNE();
9D013EF0  12A0001F   BEQ S5, ZERO, 0x9D013F70
9D013EF4  26110001   ADDIU S1, S0, 1
9D013EF8  26190001   ADDIU T9, S0, 1
9D013F18  80910000   LB S1, 0(A0)
9D013F1C  332700FF   ANDI A3, T9, 255
9D013F20  0227F821   ADDU RA, S1, A3
9D013F24  33EC0100   ANDI T4, RA, 256
9D013F28  11800009   BEQ T4, ZERO, 0x9D013F50
9D013F2C  8F9880E8   LW T8, -32536(GP)
9D013F30  8F8E80E8   LW T6, -32536(GP)
9D013F34  25C2FFFF   ADDIU V0, T6, -1
9D013F38  AF8280E8   SW V0, -32536(GP)
9D013F3C  26703010   ADDIU S0, S3, 12304
9D013F40  8E080054   LW T0, 84(S0)
9D013F44  25050001   ADDIU A1, T0, 1
9D013F48  AE050054   SW A1, 84(S0)
9D013F4C  8F9880E8   LW T8, -32536(GP)
9D013F50  2703FFFD   ADDIU V1, T8, -3
9D013F54  AF8380E8   SW V1, -32536(GP)
9D013F58  26693010   ADDIU T1, S3, 12304
9D013F5C  8D2B0054   LW T3, 84(T1)
9D013F60  256F0003   ADDIU T7, T3, 3
9D013F64  AD2F0054   SW T7, 84(T1)
9D013F68  0B404FE3   J 0x9D013F8C
9D013F6C  02398821   ADDU S1, S1, T9
9D013F70  8F9080E8   LW S0, -32536(GP)
9D013F74  2608FFFE   ADDIU T0, S0, -2
9D013F78  AF8880E8   SW T0, -32536(GP)
9D013F7C  26653010   ADDIU A1, S3, 12304
9D013F80  8CB80054   LW T8, 84(A1)
9D013F84  27030002   ADDIU V1, T8, 2
9D013F88  ACA30054   SW V1, 84(A1)
2240:                         OPCODE_END
9D013F8C  8F9980E8   LW T9, -32536(GP)
9D013F90  1B200678   BLEZ T9, .L95
9D013F94  26300001   ADDIU S0, S1, 1
9D013FB4  93EC0000   LBU T4, 0(RA)
9D013FB8  000C7080   SLL T6, T4, 2
9D013FBC  01D61021   ADDU V0, T6, S6
9D013FC0  0B403272   J 0x9D00C9C8
9D013FC4  8C450000   LW A1, 0(V0)
2241:                
2242:                      OPCODE_BEGIN(D1)  /* CMP ($nn),Y */
2243:                         CMP(5, INDIR_Y_BYTE_READ);
9D013FF4  8FA60010   LW A2, 16(SP)
9D013FF8  03265021   ADDU T2, T9, A2
9D013FFC  3144FFFF   ANDI A0, T2, -1
9D014000  308D00FF   ANDI T5, A0, 255
9D014004  01A6382B   SLTU A3, T5, A2
9D014008  10E00008   BEQ A3, ZERO, 0x9D01402C
9D01400C  26110001   ADDIU S1, S0, 1
9D014010  8F9F80E8   LW RA, -32536(GP)
9D014014  27ECFFFF   ADDIU T4, RA, -1
9D014018  AF8C80E8   SW T4, -32536(GP)
9D01401C  266E3010   ADDIU T6, S3, 12304
9D014020  8DC20054   LW V0, 84(T6)
9D014024  24570001   ADDIU S7, V0, 1
9D014028  ADD70054   SW S7, 84(T6)
9D01402C  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D014030  00000000   NOP
9D014034  02822023   SUBU A0, S4, V0
9D014038  7C950200   EXT S5, A0, 8, 1
9D01403C  3AB70001   XORI S7, S5, 1
9D014040  309200FF   ANDI S2, A0, 255
9D014044  8F8880E8   LW T0, -32536(GP)
9D014048  2505FFFB   ADDIU A1, T0, -5
9D01404C  AF8580E8   SW A1, -32536(GP)
9D014050  26783010   ADDIU T8, S3, 12304
9D014054  8F030054   LW V1, 84(T8)
9D014058  24690005   ADDIU T1, V1, 5
9D014064  0B40565D   J .L95
9D014068  0240A821   ADDU S5, S2, ZERO
2244:                         OPCODE_END
9D01405C  1CA00003   BGTZ A1, 0x9D01406C
9D014060  AF090054   SW T1, 84(T8)
9D01406C  26100002   ADDIU S0, S0, 2
9D01408C  91A70000   LBU A3, 0(T5)
9D014090  0007F880   SLL RA, A3, 2
9D014094  03F66021   ADDU T4, RA, S6
9D014098  8D850000   LW A1, 0(T4)
9D01409C  0B403272   J 0x9D00C9C8
9D0140A0  0240A821   ADDU S5, S2, ZERO
2245:                
2246:                      OPCODE_BEGIN(D3)  /* DCP ($nn),Y */
2247:                         DCP(8, INDIR_Y, mem_writebyte, addr);
9D0140A4  26110001   ADDIU S1, S0, 1
9D0140D4  8FAB0010   LW T3, 16(SP)
9D0140D8  012B7821   ADDU T7, T1, T3
9D0140DC  31F7FFFF   ANDI S7, T7, -1
9D0140E0  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0140E4  02E02021   ADDU A0, S7, ZERO
9D0140E8  2459FFFF   ADDIU T9, V0, -1
9D0140EC  333200FF   ANDI S2, T9, 255
9D0140F0  02E02021   ADDU A0, S7, ZERO
9D0140F4  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D0140F8  02402821   ADDU A1, S2, ZERO
9D0140FC  02923023   SUBU A2, S4, S2
9D014100  7CCA0200   EXT T2, A2, 8, 1
9D014104  39570001   XORI S7, T2, 1
9D014108  30D200FF   ANDI S2, A2, 255
9D01410C  8F8D80E8   LW T5, -32536(GP)
9D014110  25A7FFF8   ADDIU A3, T5, -8
9D014114  AF8780E8   SW A3, -32536(GP)
9D014118  8EAC0054   LW T4, 84(S5)
9D01411C  258E0008   ADDIU T6, T4, 8
9D014128  0B40565D   J .L95
9D01412C  0240A821   ADDU S5, S2, ZERO
2248:                         OPCODE_END
9D014120  1CE00003   BGTZ A3, 0x9D014130
9D014124  AEAE0054   SW T6, 84(S5)
9D014130  26100002   ADDIU S0, S0, 2
9D014150  90B80000   LBU T8, 0(A1)
9D014154  00181880   SLL V1, T8, 2
9D014158  00764821   ADDU T1, V1, S6
9D01415C  8D250000   LW A1, 0(T1)
9D014160  0B403272   J 0x9D00C9C8
9D014164  0240A821   ADDU S5, S2, ZERO
2249:                
2250:                      OPCODE_BEGIN(D5)  /* CMP $nn,X */
2251:                         CMP(4, ZP_IND_X_BYTE);
9D014168  26110001   ADDIU S1, S0, 1
9D014188  914D0000   LBU T5, 0(T2)
9D01418C  03CD3821   ADDU A3, FP, T5
9D014190  30EC00FF   ANDI T4, A3, 255
9D014194  8F8E80E4   LW T6, -32540(GP)
9D014198  01CCF821   ADDU RA, T6, T4
9D01419C  93F50000   LBU S5, 0(RA)
9D0141A0  02951023   SUBU V0, S4, S5
9D0141A4  7C440200   EXT A0, V0, 8, 1
9D0141A8  38970001   XORI S7, A0, 1
9D0141AC  305200FF   ANDI S2, V0, 255
9D0141B0  8F8880E8   LW T0, -32536(GP)
9D0141B4  2505FFFC   ADDIU A1, T0, -4
9D0141B8  AF8580E8   SW A1, -32536(GP)
9D0141BC  8F380054   LW T8, 84(T9)
9D0141C0  27030004   ADDIU V1, T8, 4
9D0141CC  0B40565D   J .L95
9D0141D0  0240A821   ADDU S5, S2, ZERO
2252:                         OPCODE_END
9D0141C4  1CA00003   BGTZ A1, 0x9D0141D4
9D0141C8  AF230054   SW V1, 84(T9)
9D0141D4  26100002   ADDIU S0, S0, 2
9D0141F4  914D0000   LBU T5, 0(T2)
9D0141F8  000D3880   SLL A3, T5, 2
9D0141FC  00F66021   ADDU T4, A3, S6
9D014200  8D850000   LW A1, 0(T4)
9D014204  0B403272   J 0x9D00C9C8
9D014208  0240A821   ADDU S5, S2, ZERO
2253:                
2254:                      OPCODE_BEGIN(D6)  /* DEC $nn,X */
2255:                         DEC(6, ZP_IND_X, ZP_WRITEBYTE, baddr);
9D01420C  26110001   ADDIU S1, S0, 1
9D01422C  91050000   LBU A1, 0(T0)
9D014230  03C5C021   ADDU T8, FP, A1
9D014234  330300FF   ANDI V1, T8, 255
9D014238  8F8980E4   LW T1, -32540(GP)
9D01423C  01235821   ADDU T3, T1, V1
9D014240  916F0000   LBU T7, 0(T3)
9D014244  25F9FFFF   ADDIU T9, T7, -1
9D014248  333200FF   ANDI S2, T9, 255
9D01424C  A1720000   SB S2, 0(T3)
9D014250  8F8680E8   LW A2, -32536(GP)
9D014254  24CAFFFA   ADDIU T2, A2, -6
9D014258  AF8A80E8   SW T2, -32536(GP)
9D01425C  8FED0054   LW T5, 84(RA)
9D014260  25A70006   ADDIU A3, T5, 6
9D01426C  0B40565D   J .L95
9D014270  0240A821   ADDU S5, S2, ZERO
2256:                         OPCODE_END
9D014264  1D400003   BGTZ T2, 0x9D014274
9D014268  AFE70054   SW A3, 84(RA)
9D014274  26100002   ADDIU S0, S0, 2
9D014294  90880000   LBU T0, 0(A0)
9D014298  00082880   SLL A1, T0, 2
9D01429C  00B6C021   ADDU T8, A1, S6
9D0142A0  8F050000   LW A1, 0(T8)
9D0142A4  0B403272   J 0x9D00C9C8
9D0142A8  0240A821   ADDU S5, S2, ZERO
2257:                
2258:                      OPCODE_BEGIN(D7)  /* DCP $nn,X */
2259:                         DCP(6, ZP_IND_X, ZP_WRITEBYTE, baddr);
9D0142AC  26110001   ADDIU S1, S0, 1
9D0142CC  93260000   LBU A2, 0(T9)
9D0142D0  03C65021   ADDU T2, FP, A2
9D0142D4  314D00FF   ANDI T5, T2, 255
9D0142D8  8F8780E4   LW A3, -32540(GP)
9D0142DC  00ED6021   ADDU T4, A3, T5
9D0142E0  918E0000   LBU T6, 0(T4)
9D0142E4  25DFFFFF   ADDIU RA, T6, -1
9D0142E8  33F500FF   ANDI S5, RA, 255
9D0142EC  A1950000   SB S5, 0(T4)
9D0142F0  02951023   SUBU V0, S4, S5
9D0142F4  7C440200   EXT A0, V0, 8, 1
9D0142F8  38970001   XORI S7, A0, 1
9D0142FC  305200FF   ANDI S2, V0, 255
9D014300  8F8880E8   LW T0, -32536(GP)
9D014304  2505FFFA   ADDIU A1, T0, -6
9D014308  AF8580E8   SW A1, -32536(GP)
9D01430C  8D380054   LW T8, 84(T1)
9D014310  270B0006   ADDIU T3, T8, 6
9D01431C  0B40565D   J .L95
9D014320  0240A821   ADDU S5, S2, ZERO
2260:                         OPCODE_END
9D014314  1CA00003   BGTZ A1, 0x9D014324
9D014318  AD2B0054   SW T3, 84(T1)
9D014324  26100002   ADDIU S0, S0, 2
9D014344  914D0000   LBU T5, 0(T2)
9D014348  000D3880   SLL A3, T5, 2
9D01434C  00F66021   ADDU T4, A3, S6
9D014350  8D850000   LW A1, 0(T4)
9D014354  0B403272   J 0x9D00C9C8
9D014358  0240A821   ADDU S5, S2, ZERO
2261:                
2262:                      OPCODE_BEGIN(D8)  /* CLD */
2263:                         CLD();
9D01435C  8F8E80E8   LW T6, -32536(GP)
9D014360  25DFFFFE   ADDIU RA, T6, -2
9D014364  AF9F80E8   SW RA, -32536(GP)
9D014368  26623010   ADDIU V0, S3, 12304
9D01436C  8C440054   LW A0, 84(V0)
9D014370  24880002   ADDIU T0, A0, 2
9D014380  0B40565D   J .L95
9D014384  AFA00020   SW ZERO, 32(SP)
2264:                         OPCODE_END
9D014374  1FE00004   BGTZ RA, .LBB1414
9D014378  AC480054   SW T0, 84(V0)
9D01437C  02008821   ADDU S1, S0, ZERO
9D0143A4  93310000   LBU S1, 0(T9)
9D0143A8  00113080   SLL A2, S1, 2
9D0143AC  00D65021   ADDU T2, A2, S6
9D0143B0  8D450000   LW A1, 0(T2)
9D0143B4  26100001   ADDIU S0, S0, 1
9D0143B8  0B403272   J 0x9D00C9C8
9D0143BC  AFA00020   SW ZERO, 32(SP)
2265:                
2266:                      OPCODE_BEGIN(D9)  /* CMP $nnnn,Y */
2267:                         CMP(4, ABS_IND_Y_BYTE_READ);
9D0143C0  0F4030A7   JAL bank_readword
9D0143C4  02002021   ADDU A0, S0, ZERO
9D0143C8  8FB70010   LW S7, 16(SP)
9D0143CC  00579021   ADDU S2, V0, S7
9D0143D0  3244FFFF   ANDI A0, S2, -1
9D0143D4  309500FF   ANDI S5, A0, 255
9D0143D8  02B7682B   SLTU T5, S5, S7
9D0143DC  11A00008   BEQ T5, ZERO, 0x9D014400
9D0143E0  26110002   ADDIU S1, S0, 2
9D0143E4  8F8780E8   LW A3, -32536(GP)
9D0143E8  24ECFFFF   ADDIU T4, A3, -1
9D0143EC  AF8C80E8   SW T4, -32536(GP)
9D0143F0  266E3010   ADDIU T6, S3, 12304
9D0143F4  8DDF0054   LW RA, 84(T6)
9D0143F8  27E20001   ADDIU V0, RA, 1
9D0143FC  ADC20054   SW V0, 84(T6)
9D014400  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D014404  00000000   NOP
9D014408  02822023   SUBU A0, S4, V0
9D01440C  7C880200   EXT T0, A0, 8, 1
9D014410  39170001   XORI S7, T0, 1
9D014414  309200FF   ANDI S2, A0, 255
9D014418  8F8580E8   LW A1, -32536(GP)
9D01441C  24B8FFFC   ADDIU T8, A1, -4
9D014420  AF9880E8   SW T8, -32536(GP)
9D014424  266B3010   ADDIU T3, S3, 12304
9D014428  8D690054   LW T1, 84(T3)
9D01442C  252F0004   ADDIU T7, T1, 4
9D014438  0B40565D   J .L95
9D01443C  0240A821   ADDU S5, S2, ZERO
2268:                         OPCODE_END
9D014430  1F000003   BGTZ T8, 0x9D014440
9D014434  AD6F0054   SW T7, 84(T3)
9D014440  26100003   ADDIU S0, S0, 3
9D014460  91A70000   LBU A3, 0(T5)
9D014464  00076080   SLL T4, A3, 2
9D014468  01967021   ADDU T6, T4, S6
9D01446C  8DC50000   LW A1, 0(T6)
9D014470  0B403272   J 0x9D00C9C8
9D014474  0240A821   ADDU S5, S2, ZERO
2269:                
2270:                      OPCODE_BEGIN(DB)  /* DCP $nnnn,Y */
2271:                         DCP(7, ABS_IND_Y, mem_writebyte, addr);
9D014478  0F4030A7   JAL bank_readword
9D01447C  02002021   ADDU A0, S0, ZERO
9D014480  26110002   ADDIU S1, S0, 2
9D014484  8FB70010   LW S7, 16(SP)
9D014488  00579021   ADDU S2, V0, S7
9D01448C  3255FFFF   ANDI S5, S2, -1
9D014490  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D014494  02A02021   ADDU A0, S5, ZERO
9D014498  2442FFFF   ADDIU V0, V0, -1
9D01449C  305700FF   ANDI S7, V0, 255
9D0144A0  02A02021   ADDU A0, S5, ZERO
9D0144A4  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D0144A8  02E02821   ADDU A1, S7, ZERO
9D0144AC  02972023   SUBU A0, S4, S7
9D0144B0  7C880200   EXT T0, A0, 8, 1
9D0144B4  39170001   XORI S7, T0, 1
9D0144B8  309200FF   ANDI S2, A0, 255
9D0144BC  8F8580E8   LW A1, -32536(GP)
9D0144C0  24B8FFF9   ADDIU T8, A1, -7
9D0144C4  AF9880E8   SW T8, -32536(GP)
9D0144C8  266B3010   ADDIU T3, S3, 12304
9D0144CC  8D690054   LW T1, 84(T3)
9D0144D0  252F0007   ADDIU T7, T1, 7
9D0144DC  0B40565D   J .L95
9D0144E0  0240A821   ADDU S5, S2, ZERO
2272:                         OPCODE_END                  
9D0144D4  1F000003   BGTZ T8, 0x9D0144E4
9D0144D8  AD6F0054   SW T7, 84(T3)
9D0144E4  26100003   ADDIU S0, S0, 3
9D014504  91A70000   LBU A3, 0(T5)
9D014508  00076080   SLL T4, A3, 2
9D01450C  01967021   ADDU T6, T4, S6
9D014510  8DC50000   LW A1, 0(T6)
9D014514  0B403272   J 0x9D00C9C8
9D014518  0240A821   ADDU S5, S2, ZERO
2273:                
2274:                      OPCODE_BEGIN(DD)  /* CMP $nnnn,X */
2275:                         CMP(4, ABS_IND_X_BYTE_READ);
9D01451C  0F4030A7   JAL bank_readword
9D014520  02002021   ADDU A0, S0, ZERO
9D014524  005E9021   ADDU S2, V0, FP
9D014528  3244FFFF   ANDI A0, S2, -1
9D01452C  309500FF   ANDI S5, A0, 255
9D014530  02BE102B   SLTU V0, S5, FP
9D014534  10400008   BEQ V0, ZERO, 0x9D014558
9D014538  26110002   ADDIU S1, S0, 2
9D01453C  8F9780E8   LW S7, -32536(GP)
9D014540  26E8FFFF   ADDIU T0, S7, -1
9D014544  AF8880E8   SW T0, -32536(GP)
9D014548  26653010   ADDIU A1, S3, 12304
9D01454C  8CB80054   LW T8, 84(A1)
9D014550  270B0001   ADDIU T3, T8, 1
9D014554  ACAB0054   SW T3, 84(A1)
9D014558  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D01455C  00000000   NOP
9D014560  02822023   SUBU A0, S4, V0
9D014564  7C890200   EXT T1, A0, 8, 1
9D014568  39370001   XORI S7, T1, 1
9D01456C  309200FF   ANDI S2, A0, 255
9D014570  8F8F80E8   LW T7, -32536(GP)
9D014574  25F9FFFC   ADDIU T9, T7, -4
9D014578  AF9980E8   SW T9, -32536(GP)
9D01457C  26633010   ADDIU V1, S3, 12304
9D014580  8C660054   LW A2, 84(V1)
9D014584  24CA0004   ADDIU T2, A2, 4
9D014590  0B40565D   J .L95
9D014594  0240A821   ADDU S5, S2, ZERO
2276:                         OPCODE_END
9D014588  1F200003   BGTZ T9, 0x9D014598
9D01458C  AC6A0054   SW T2, 84(V1)
9D014598  26100003   ADDIU S0, S0, 3
9D0145B8  92A20000   LBU V0, 0(S5)
9D0145BC  00024080   SLL T0, V0, 2
9D0145C0  01162821   ADDU A1, T0, S6
9D0145C4  8CA50000   LW A1, 0(A1)
9D0145C8  0B403272   J 0x9D00C9C8
9D0145CC  0240A821   ADDU S5, S2, ZERO
2277:                
2278:                      OPCODE_BEGIN(DE)  /* DEC $nnnn,X */
2279:                         DEC(7, ABS_IND_X, mem_writebyte, addr);
9D0145D0  0F4030A7   JAL bank_readword
9D0145D4  02002021   ADDU A0, S0, ZERO
9D0145D8  26110002   ADDIU S1, S0, 2
9D0145DC  005E9021   ADDU S2, V0, FP
9D0145E0  3255FFFF   ANDI S5, S2, -1
9D0145E4  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0145E8  02A02021   ADDU A0, S5, ZERO
9D0145EC  2458FFFF   ADDIU T8, V0, -1
9D0145F0  331200FF   ANDI S2, T8, 255
9D0145F4  02A02021   ADDU A0, S5, ZERO
9D0145F8  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D0145FC  02402821   ADDU A1, S2, ZERO
9D014600  8F8B80E8   LW T3, -32536(GP)
9D014604  2569FFF9   ADDIU T1, T3, -7
9D014608  AF8980E8   SW T1, -32536(GP)
9D01460C  266F3010   ADDIU T7, S3, 12304
9D014610  8DE40054   LW A0, 84(T7)
9D014614  24990007   ADDIU T9, A0, 7
9D014620  0B40565D   J .L95
9D014624  0240A821   ADDU S5, S2, ZERO
2280:                         OPCODE_END
9D014618  1D200003   BGTZ T1, 0x9D014628
9D01461C  ADF90054   SW T9, 84(T7)
9D014628  26100003   ADDIU S0, S0, 3
9D014648  91910000   LBU S1, 0(T4)
9D01464C  00117080   SLL T6, S1, 2
9D014650  01D61021   ADDU V0, T6, S6
9D014654  8C450000   LW A1, 0(V0)
9D014658  0B403272   J 0x9D00C9C8
9D01465C  0240A821   ADDU S5, S2, ZERO
2281:                
2282:                      OPCODE_BEGIN(DF)  /* DCP $nnnn,X */
2283:                         DCP(7, ABS_IND_X, mem_writebyte, addr);
9D014660  0F4030A7   JAL bank_readword
9D014664  02002021   ADDU A0, S0, ZERO
9D014668  26110002   ADDIU S1, S0, 2
9D01466C  005EB821   ADDU S7, V0, FP
9D014670  32F5FFFF   ANDI S5, S7, -1
9D014674  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D014678  02A02021   ADDU A0, S5, ZERO
9D01467C  2448FFFF   ADDIU T0, V0, -1
9D014680  311200FF   ANDI S2, T0, 255
9D014684  02A02021   ADDU A0, S5, ZERO
9D014688  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D01468C  02402821   ADDU A1, S2, ZERO
9D014690  02922823   SUBU A1, S4, S2
9D014694  7CB80200   EXT T8, A1, 8, 1
9D014698  3B170001   XORI S7, T8, 1
9D01469C  30B200FF   ANDI S2, A1, 255
9D0146A0  8F8B80E8   LW T3, -32536(GP)
9D0146A4  2569FFF9   ADDIU T1, T3, -7
9D0146A8  AF8980E8   SW T1, -32536(GP)
9D0146AC  266F3010   ADDIU T7, S3, 12304
9D0146B0  8DE40054   LW A0, 84(T7)
9D0146B4  24990007   ADDIU T9, A0, 7
9D0146C0  0B40565D   J .L95
9D0146C4  0240A821   ADDU S5, S2, ZERO
2284:                         OPCODE_END
9D0146B8  1D200003   BGTZ T1, 0x9D0146C8
9D0146BC  ADF90054   SW T9, 84(T7)
9D0146C8  26100003   ADDIU S0, S0, 3
9D0146E8  91910000   LBU S1, 0(T4)
9D0146EC  00117080   SLL T6, S1, 2
9D0146F0  01D61021   ADDU V0, T6, S6
9D0146F4  8C450000   LW A1, 0(V0)
9D0146F8  0B403272   J 0x9D00C9C8
9D0146FC  0240A821   ADDU S5, S2, ZERO
2285:                
2286:                      OPCODE_BEGIN(E0)  /* CPX #$nn */
2287:                         CPX(2, IMMEDIATE_BYTE);
9D014700  26110001   ADDIU S1, S0, 1
9D014720  91690000   LBU T1, 0(T3)
9D014724  03C97823   SUBU T7, FP, T1
9D014728  7DE40200   EXT A0, T7, 8, 1
9D01472C  38970001   XORI S7, A0, 1
9D014730  31F200FF   ANDI S2, T7, 255
9D014734  8F9980E8   LW T9, -32536(GP)
9D014738  2723FFFE   ADDIU V1, T9, -2
9D01473C  AF8380E8   SW V1, -32536(GP)
9D014740  8D060054   LW A2, 84(T0)
9D014744  24CA0002   ADDIU T2, A2, 2
9D014750  0B40565D   J .L95
9D014754  0240A821   ADDU S5, S2, ZERO
2288:                         OPCODE_END
9D014748  1C600003   BGTZ V1, 0x9D014758
9D01474C  AD0A0054   SW T2, 84(T0)
9D014758  26100002   ADDIU S0, S0, 2
9D014778  90550000   LBU S5, 0(V0)
9D01477C  00154080   SLL T0, S5, 2
9D014780  01162821   ADDU A1, T0, S6
9D014784  8CA50000   LW A1, 0(A1)
9D014788  0B403272   J 0x9D00C9C8
9D01478C  0240A821   ADDU S5, S2, ZERO
2289:                
2290:                      OPCODE_BEGIN(E1)  /* SBC ($nn,X) */
2291:                         SBC(6, INDIR_X_BYTE);
9D0147AC  90990000   LBU T9, 0(A0)
9D0147B0  03D91821   ADDU V1, FP, T9
9D0147C0  97E40000   LHU A0, 0(RA)
9D0147C4  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0147C8  26110001   ADDIU S1, S0, 1
9D0147CC  02826823   SUBU T5, S4, V0
9D0147D0  3AF70001   XORI S7, S7, 1
9D0147D4  01B73823   SUBU A3, T5, S7
9D0147D8  30F200FF   ANDI S2, A3, 255
9D0147DC  00546026   XOR T4, V0, S4
9D0147E0  7C0C3004   INS T4, ZERO, 0, 7
9D0147E4  0254A026   XOR S4, S2, S4
9D0147E8  01947024   AND T6, T4, S4
9D0147EC  31C200FF   ANDI V0, T6, 255
9D0147F0  AFA20014   SW V0, 20(SP)
9D0147F4  38E80100   XORI T0, A3, 256
9D0147F8  7D170200   EXT S7, T0, 8, 1
9D0147FC  8F8580E8   LW A1, -32536(GP)
9D014800  24B8FFFA   ADDIU T8, A1, -6
9D014804  AF9880E8   SW T8, -32536(GP)
9D014808  8EAB0054   LW T3, 84(S5)
9D01480C  25690006   ADDIU T1, T3, 6
9D014818  0240A021   ADDU S4, S2, ZERO
9D01481C  0B40565D   J .L95
9D014820  0240A821   ADDU S5, S2, ZERO
9D014854  0240A021   ADDU S4, S2, ZERO
2292:                         OPCODE_END
9D014810  1F000004   BGTZ T8, 0x9D014824
9D014814  AEA90054   SW T1, 84(S5)
9D014824  26100002   ADDIU S0, S0, 2
9D014844  90CA0000   LBU T2, 0(A2)
9D014848  000AF880   SLL RA, T2, 2
9D01484C  03F66821   ADDU T5, RA, S6
9D014850  8DA50000   LW A1, 0(T5)
9D014858  0B403272   J 0x9D00C9C8
9D01485C  0240A821   ADDU S5, S2, ZERO
2293:                
2294:                      OPCODE_BEGIN(E3)  /* ISB ($nn,X) */
2295:                         ISB(8, INDIR_X, mem_writebyte, addr);
9D014860  26110001   ADDIU S1, S0, 1
9D014880  91050000   LBU A1, 0(T0)
9D014884  03C5C021   ADDU T8, FP, A1
9D014898  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D01489C  02402021   ADDU A0, S2, ZERO
9D0148A0  24440001   ADDIU A0, V0, 1
9D0148A4  309900FF   ANDI T9, A0, 255
9D0148A8  AFB90014   SW T9, 20(SP)
9D0148AC  02402021   ADDU A0, S2, ZERO
9D0148B0  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D0148B4  03202821   ADDU A1, T9, ZERO
9D0148B8  8FA30014   LW V1, 20(SP)
9D0148BC  02833023   SUBU A2, S4, V1
9D0148C0  3AF70001   XORI S7, S7, 1
9D0148C4  00D75023   SUBU T2, A2, S7
9D0148C8  315200FF   ANDI S2, T2, 255
9D0148CC  00746826   XOR T5, V1, S4
9D0148D0  7C0D3004   INS T5, ZERO, 0, 7
9D0148D4  0254A026   XOR S4, S2, S4
9D0148D8  01B43824   AND A3, T5, S4
9D0148DC  30EC00FF   ANDI T4, A3, 255
9D0148E0  AFAC0014   SW T4, 20(SP)
9D0148E4  394E0100   XORI T6, T2, 256
9D0148E8  7DD70200   EXT S7, T6, 8, 1
9D0148EC  8F8280E8   LW V0, -32536(GP)
9D0148F0  2448FFF8   ADDIU T0, V0, -8
9D0148F4  AF8880E8   SW T0, -32536(GP)
9D0148F8  8EA50054   LW A1, 84(S5)
9D0148FC  24B80008   ADDIU T8, A1, 8
9D014908  0240A021   ADDU S4, S2, ZERO
9D01490C  0B40565D   J .L95
9D014910  0240A821   ADDU S5, S2, ZERO
9D014944  0240A021   ADDU S4, S2, ZERO
2296:                         OPCODE_END
9D014900  1D000004   BGTZ T0, 0x9D014914
9D014904  AEB80054   SW T8, 84(S5)
9D014914  26100002   ADDIU S0, S0, 2
9D014934  90990000   LBU T9, 0(A0)
9D014938  00191880   SLL V1, T9, 2
9D01493C  00763021   ADDU A2, V1, S6
9D014940  8CC50000   LW A1, 0(A2)
9D014948  0B403272   J 0x9D00C9C8
9D01494C  0240A821   ADDU S5, S2, ZERO
2297:                
2298:                      OPCODE_BEGIN(E4)  /* CPX $nn */
2299:                         CPX(3, ZERO_PAGE_BYTE);
9D014950  26110001   ADDIU S1, S0, 1
9D014970  91C20000   LBU V0, 0(T6)
9D014974  8F8880E4   LW T0, -32540(GP)
9D014978  01022821   ADDU A1, T0, V0
9D01497C  90B80000   LBU T8, 0(A1)
9D014980  03D8F823   SUBU RA, FP, T8
9D014984  7FF50200   EXT S5, RA, 8, 1
9D014988  3AB70001   XORI S7, S5, 1
9D01498C  33F200FF   ANDI S2, RA, 255
9D014990  8F8B80E8   LW T3, -32536(GP)
9D014994  2569FFFD   ADDIU T1, T3, -3
9D014998  AF8980E8   SW T1, -32536(GP)
9D01499C  8D4F0054   LW T7, 84(T2)
9D0149A0  25E40003   ADDIU A0, T7, 3
9D0149AC  0B40565D   J .L95
9D0149B0  0240A821   ADDU S5, S2, ZERO
2300:                         OPCODE_END
9D0149A4  1D200003   BGTZ T1, 0x9D0149B4
9D0149A8  AD440054   SW A0, 84(T2)
9D0149B4  26100002   ADDIU S0, S0, 2
9D0149D4  90EC0000   LBU T4, 0(A3)
9D0149D8  000C7080   SLL T6, T4, 2
9D0149DC  01D61021   ADDU V0, T6, S6
9D0149E0  8C450000   LW A1, 0(V0)
9D0149E4  0B403272   J 0x9D00C9C8
9D0149E8  0240A821   ADDU S5, S2, ZERO
2301:                
2302:                      OPCODE_BEGIN(E5)  /* SBC $nn */
2303:                         SBC(3, ZERO_PAGE_BYTE);
9D0149EC  26110001   ADDIU S1, S0, 1
9D014A0C  91690000   LBU T1, 0(T3)
9D014A10  8F8F80E4   LW T7, -32540(GP)
9D014A14  01E92021   ADDU A0, T7, T1
9D014A18  90990000   LBU T9, 0(A0)
9D014A1C  02991823   SUBU V1, S4, T9
9D014A20  3AF70001   XORI S7, S7, 1
9D014A24  00773023   SUBU A2, V1, S7
9D014A28  30D200FF   ANDI S2, A2, 255
9D014A2C  03345026   XOR T2, T9, S4
9D014A30  7C0A3004   INS T2, ZERO, 0, 7
9D014A34  0254A026   XOR S4, S2, S4
9D014A38  01546824   AND T5, T2, S4
9D014A3C  31A700FF   ANDI A3, T5, 255
9D014A40  AFA70014   SW A3, 20(SP)
9D014A44  38CC0100   XORI T4, A2, 256
9D014A48  7D970200   EXT S7, T4, 8, 1
9D014A4C  8F8E80E8   LW T6, -32536(GP)
9D014A50  25C2FFFD   ADDIU V0, T6, -3
9D014A54  AF8280E8   SW V0, -32536(GP)
9D014A58  8CA80054   LW T0, 84(A1)
9D014A5C  25180003   ADDIU T8, T0, 3
9D014A68  0240A021   ADDU S4, S2, ZERO
9D014A6C  0B40565D   J .L95
9D014A70  0240A821   ADDU S5, S2, ZERO
9D014AA4  0240A021   ADDU S4, S2, ZERO
2304:                         OPCODE_END
9D014A60  1C400004   BGTZ V0, 0x9D014A74
9D014A64  ACB80054   SW T8, 84(A1)
9D014A74  26100002   ADDIU S0, S0, 2
9D014A94  91E40000   LBU A0, 0(T7)
9D014A98  0004C880   SLL T9, A0, 2
9D014A9C  03361821   ADDU V1, T9, S6
9D014AA0  8C650000   LW A1, 0(V1)
9D014AA8  0B403272   J 0x9D00C9C8
9D014AAC  0240A821   ADDU S5, S2, ZERO
2305:                
2306:                      OPCODE_BEGIN(E6)  /* INC $nn */
2307:                         INC(5, ZERO_PAGE, ZP_WRITEBYTE, baddr);
9D014AB0  26110001   ADDIU S1, S0, 1
9D014AD0  91C20000   LBU V0, 0(T6)
9D014AD4  8F8880E4   LW T0, -32540(GP)
9D014AD8  0102C021   ADDU T8, T0, V0
9D014ADC  93050000   LBU A1, 0(T8)
9D014AE0  24BF0001   ADDIU RA, A1, 1
9D014AE4  33F200FF   ANDI S2, RA, 255
9D014AE8  A3120000   SB S2, 0(T8)
9D014AEC  8F9580E8   LW S5, -32536(GP)
9D014AF0  26ABFFFB   ADDIU T3, S5, -5
9D014AF4  AF8B80E8   SW T3, -32536(GP)
9D014AF8  8D490054   LW T1, 84(T2)
9D014AFC  252F0005   ADDIU T7, T1, 5
9D014B08  0B40565D   J .L95
9D014B0C  0240A821   ADDU S5, S2, ZERO
2308:                         OPCODE_END
9D014B00  1D600003   BGTZ T3, 0x9D014B10
9D014B04  AD4F0054   SW T7, 84(T2)
9D014B10  26100002   ADDIU S0, S0, 2
9D014B30  91A70000   LBU A3, 0(T5)
9D014B34  00076080   SLL T4, A3, 2
9D014B38  01967021   ADDU T6, T4, S6
9D014B3C  8DC50000   LW A1, 0(T6)
9D014B40  0B403272   J 0x9D00C9C8
9D014B44  0240A821   ADDU S5, S2, ZERO
2309:                
2310:                      OPCODE_BEGIN(E7)  /* ISB $nn */
2311:                         ISB(5, ZERO_PAGE, ZP_WRITEBYTE, baddr);
9D014B48  26110001   ADDIU S1, S0, 1
9D014B68  92AB0000   LBU T3, 0(S5)
9D014B6C  8F8980E4   LW T1, -32540(GP)
9D014B70  012B7821   ADDU T7, T1, T3
9D014B74  91E40000   LBU A0, 0(T7)
9D014B78  24990001   ADDIU T9, A0, 1
9D014B7C  332300FF   ANDI V1, T9, 255
9D014B80  A1E30000   SB V1, 0(T7)
9D014B84  02833023   SUBU A2, S4, V1
9D014B88  3AF70001   XORI S7, S7, 1
9D014B8C  00D75023   SUBU T2, A2, S7
9D014B90  315200FF   ANDI S2, T2, 255
9D014B94  00746826   XOR T5, V1, S4
9D014B98  7C0D3004   INS T5, ZERO, 0, 7
9D014B9C  0254A026   XOR S4, S2, S4
9D014BA0  01B43824   AND A3, T5, S4
9D014BA4  30EC00FF   ANDI T4, A3, 255
9D014BA8  AFAC0014   SW T4, 20(SP)
9D014BAC  394E0100   XORI T6, T2, 256
9D014BB0  7DD70200   EXT S7, T6, 8, 1
9D014BB4  8F8880E8   LW T0, -32536(GP)
9D014BB8  2518FFFB   ADDIU T8, T0, -5
9D014BBC  AF9880E8   SW T8, -32536(GP)
9D014BC0  8C450054   LW A1, 84(V0)
9D014BC4  24BF0005   ADDIU RA, A1, 5
9D014BD0  0240A021   ADDU S4, S2, ZERO
9D014BD4  0B40565D   J .L95
9D014BD8  0240A821   ADDU S5, S2, ZERO
9D014C0C  0240A021   ADDU S4, S2, ZERO
2312:                         OPCODE_END
9D014BC8  1F000004   BGTZ T8, 0x9D014BDC
9D014BCC  AC5F0054   SW RA, 84(V0)
9D014BDC  26100002   ADDIU S0, S0, 2
9D014BFC  90990000   LBU T9, 0(A0)
9D014C00  00191880   SLL V1, T9, 2
9D014C04  00763021   ADDU A2, V1, S6
9D014C08  8CC50000   LW A1, 0(A2)
9D014C10  0B403272   J 0x9D00C9C8
9D014C14  0240A821   ADDU S5, S2, ZERO
2313:                
2314:                      OPCODE_BEGIN(E8)  /* INX */
2315:                         INX();
9D014C18  27DE0001   ADDIU FP, FP, 1
9D014C1C  33D200FF   ANDI S2, FP, 255
9D014C20  8F8A80E8   LW T2, -32536(GP)
9D014C24  254DFFFE   ADDIU T5, T2, -2
9D014C28  AF8D80E8   SW T5, -32536(GP)
9D014C2C  26673010   ADDIU A3, S3, 12304
9D014C30  8CEC0054   LW T4, 84(A3)
9D014C34  258E0002   ADDIU T6, T4, 2
9D014C40  0240F021   ADDU FP, S2, ZERO
9D014C48  0B40565D   J .L95
9D014C4C  0240A821   ADDU S5, S2, ZERO
9D014C7C  0240F021   ADDU FP, S2, ZERO
2316:                         OPCODE_END
9D014C38  1DA00005   BGTZ T5, .LBB1458
9D014C3C  ACEE0054   SW T6, 84(A3)
9D014C44  02008821   ADDU S1, S0, ZERO
9D014C6C  91690000   LBU T1, 0(T3)
9D014C70  00098880   SLL S1, T1, 2
9D014C74  02367821   ADDU T7, S1, S6
9D014C78  8DE50000   LW A1, 0(T7)
9D014C80  26100001   ADDIU S0, S0, 1
9D014C84  0B403272   J 0x9D00C9C8
9D014C88  0240A821   ADDU S5, S2, ZERO
2317:                
2318:                      OPCODE_BEGIN(E9)  /* SBC #$nn */
2319:                      OPCODE_BEGIN(EB)  /* USBC #$nn */
2320:                         SBC(2, IMMEDIATE_BYTE);
9D014C8C  26110001   ADDIU S1, S0, 1
9D014CB0  02876023   SUBU T4, S4, A3
9D014CB4  3AF70001   XORI S7, S7, 1
9D014CB8  01977023   SUBU T6, T4, S7
9D014CBC  31D200FF   ANDI S2, T6, 255
9D014CC0  00F44026   XOR T0, A3, S4
9D014CC4  7C083004   INS T0, ZERO, 0, 7
9D014CC8  0254A026   XOR S4, S2, S4
9D014CCC  0114C024   AND T8, T0, S4
9D014CD0  330500FF   ANDI A1, T8, 255
9D014CD4  AFA50014   SW A1, 20(SP)
9D014CD8  39DF0100   XORI RA, T6, 256
9D014CDC  7FF70200   EXT S7, RA, 8, 1
9D014CE0  8F8280E8   LW V0, -32536(GP)
9D014CE4  2455FFFE   ADDIU S5, V0, -2
9D014CE8  AF9580E8   SW S5, -32536(GP)
9D014CEC  8F2B0054   LW T3, 84(T9)
9D014CF0  25690002   ADDIU T1, T3, 2
9D014CFC  0240A021   ADDU S4, S2, ZERO
9D014D00  0B40565D   J .L95
9D014D04  0240A821   ADDU S5, S2, ZERO
9D014D38  0240A021   ADDU S4, S2, ZERO
2321:                         OPCODE_END
9D014CF4  1EA00004   BGTZ S5, 0x9D014D08
9D014CF8  AF290054   SW T1, 84(T9)
9D014D08  26100002   ADDIU S0, S0, 2
9D014D28  914D0000   LBU T5, 0(T2)
9D014D2C  000D3880   SLL A3, T5, 2
9D014D30  00F66021   ADDU T4, A3, S6
9D014D34  8D850000   LW A1, 0(T4)
9D014D3C  0B403272   J 0x9D00C9C8
9D014D40  0240A821   ADDU S5, S2, ZERO
2322:                
2323:                      OPCODE_BEGIN(EA)  /* NOP */
2324:                         NOP();
9D014D44  8F8E80E8   LW T6, -32536(GP)
9D014D48  25C8FFFE   ADDIU T0, T6, -2
9D014D4C  AF8880E8   SW T0, -32536(GP)
9D014D50  26783010   ADDIU T8, S3, 12304
9D014D54  8F050054   LW A1, 84(T8)
9D014D58  24BF0002   ADDIU RA, A1, 2
2325:                         OPCODE_END
9D014D5C  1D000003   BGTZ T0, .LBB1464
9D014D60  AF1F0054   SW RA, 84(T8)
9D014D64  0B40565D   J .L95
9D014D68  02008821   ADDU S1, S0, ZERO
9D014D88  90D10000   LBU S1, 0(A2)
9D014D8C  00111880   SLL V1, S1, 2
9D014D90  00765021   ADDU T2, V1, S6
9D014D94  8D450000   LW A1, 0(T2)
9D014D98  0B403272   J 0x9D00C9C8
9D014D9C  26100001   ADDIU S0, S0, 1
2326:                
2327:                      OPCODE_BEGIN(EC)  /* CPX $nnnn */
2328:                         CPX(4, ABSOLUTE_BYTE);
9D014DA0  0F4030A7   JAL bank_readword
9D014DA4  02002021   ADDU A0, S0, ZERO
9D014DA8  26110002   ADDIU S1, S0, 2
9D014DAC  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D014DB0  00402021   ADDU A0, V0, ZERO
9D014DB4  03C29023   SUBU S2, FP, V0
9D014DB8  7E570200   EXT S7, S2, 8, 1
9D014DBC  3AF70001   XORI S7, S7, 1
9D014DC0  325200FF   ANDI S2, S2, 255
9D014DC4  8F9580E8   LW S5, -32536(GP)
9D014DC8  26ADFFFC   ADDIU T5, S5, -4
9D014DCC  AF8D80E8   SW T5, -32536(GP)
9D014DD0  26673010   ADDIU A3, S3, 12304
9D014DD4  8CEC0054   LW T4, 84(A3)
9D014DD8  258E0004   ADDIU T6, T4, 4
9D014DE4  0B40565D   J .L95
9D014DE8  0240A821   ADDU S5, S2, ZERO
2329:                         OPCODE_END
9D014DDC  1DA00003   BGTZ T5, 0x9D014DEC
9D014DE0  ACEE0054   SW T6, 84(A3)
9D014DEC  26100003   ADDIU S0, S0, 3
9D014E0C  912F0000   LBU T7, 0(T1)
9D014E10  000F2080   SLL A0, T7, 2
9D014E14  0096C821   ADDU T9, A0, S6
9D014E18  8F250000   LW A1, 0(T9)
9D014E1C  0B403272   J 0x9D00C9C8
9D014E20  0240A821   ADDU S5, S2, ZERO
2330:                
2331:                      OPCODE_BEGIN(ED)  /* SBC $nnnn */
2332:                         SBC(4, ABSOLUTE_BYTE);
9D014E24  0F4030A7   JAL bank_readword
9D014E28  02002021   ADDU A0, S0, ZERO
9D014E2C  26110002   ADDIU S1, S0, 2
9D014E30  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D014E34  00402021   ADDU A0, V0, ZERO
9D014E38  02823023   SUBU A2, S4, V0
9D014E3C  3AE30001   XORI V1, S7, 1
9D014E40  00C35023   SUBU T2, A2, V1
9D014E44  315200FF   ANDI S2, T2, 255
9D014E48  0054B826   XOR S7, V0, S4
9D014E4C  7C173004   INS S7, ZERO, 0, 7
9D014E50  0254A026   XOR S4, S2, S4
9D014E54  02F4A824   AND S5, S7, S4
9D014E58  32AD00FF   ANDI T5, S5, 255
9D014E5C  AFAD0014   SW T5, 20(SP)
9D014E60  39470100   XORI A3, T2, 256
9D014E64  7CF70200   EXT S7, A3, 8, 1
9D014E68  8F8C80E8   LW T4, -32536(GP)
9D014E6C  258EFFFC   ADDIU T6, T4, -4
9D014E70  AF8E80E8   SW T6, -32536(GP)
9D014E74  26683010   ADDIU T0, S3, 12304
9D014E78  8D180054   LW T8, 84(T0)
9D014E7C  27050004   ADDIU A1, T8, 4
9D014E88  0240A021   ADDU S4, S2, ZERO
9D014E8C  0B40565D   J .L95
9D014E90  0240A821   ADDU S5, S2, ZERO
9D014EC4  0240A021   ADDU S4, S2, ZERO
2333:                         OPCODE_END
9D014E80  1DC00004   BGTZ T6, 0x9D014E94
9D014E84  AD050054   SW A1, 84(T0)
9D014E94  26100003   ADDIU S0, S0, 3
9D014EB4  90990000   LBU T9, 0(A0)
9D014EB8  00193080   SLL A2, T9, 2
9D014EBC  00D61821   ADDU V1, A2, S6
9D014EC0  8C650000   LW A1, 0(V1)
9D014EC8  0B403272   J 0x9D00C9C8
9D014ECC  0240A821   ADDU S5, S2, ZERO
2334:                
2335:                      OPCODE_BEGIN(EE)  /* INC $nnnn */
2336:                         INC(6, ABSOLUTE, mem_writebyte, addr);
9D014ED0  0F4030A7   JAL bank_readword
9D014ED4  02002021   ADDU A0, S0, ZERO
9D014ED8  0040A821   ADDU S5, V0, ZERO
9D014EDC  26110002   ADDIU S1, S0, 2
9D014EE0  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D014EE4  00402021   ADDU A0, V0, ZERO
9D014EE8  24520001   ADDIU S2, V0, 1
9D014EEC  325200FF   ANDI S2, S2, 255
9D014EF0  02A02021   ADDU A0, S5, ZERO
9D014EF4  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D014EF8  02402821   ADDU A1, S2, ZERO
9D014EFC  8F8A80E8   LW T2, -32536(GP)
9D014F00  254DFFFA   ADDIU T5, T2, -6
9D014F04  AF8D80E8   SW T5, -32536(GP)
9D014F08  26673010   ADDIU A3, S3, 12304
9D014F0C  8CEC0054   LW T4, 84(A3)
9D014F10  258E0006   ADDIU T6, T4, 6
9D014F1C  0B40565D   J .L95
9D014F20  0240A821   ADDU S5, S2, ZERO
2337:                         OPCODE_END
9D014F14  1DA00003   BGTZ T5, 0x9D014F24
9D014F18  ACEE0054   SW T6, 84(A3)
9D014F24  26100003   ADDIU S0, S0, 3
9D014F44  91310000   LBU S1, 0(T1)
9D014F48  00117880   SLL T7, S1, 2
9D014F4C  01F62021   ADDU A0, T7, S6
9D014F50  8C850000   LW A1, 0(A0)
9D014F54  0B403272   J 0x9D00C9C8
9D014F58  0240A821   ADDU S5, S2, ZERO
2338:                
2339:                      OPCODE_BEGIN(EF)  /* ISB $nnnn */
2340:                         ISB(6, ABSOLUTE, mem_writebyte, addr);
9D014F5C  0F4030A7   JAL bank_readword
9D014F60  02002021   ADDU A0, S0, ZERO
9D014F64  00409021   ADDU S2, V0, ZERO
9D014F68  26110002   ADDIU S1, S0, 2
9D014F6C  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D014F70  00402021   ADDU A0, V0, ZERO
9D014F74  24590001   ADDIU T9, V0, 1
9D014F78  333500FF   ANDI S5, T9, 255
9D014F7C  02402021   ADDU A0, S2, ZERO
9D014F80  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D014F84  02A02821   ADDU A1, S5, ZERO
9D014F88  02953023   SUBU A2, S4, S5
9D014F8C  3AF70001   XORI S7, S7, 1
9D014F90  00D75023   SUBU T2, A2, S7
9D014F94  315200FF   ANDI S2, T2, 255
9D014F98  02B41826   XOR V1, S5, S4
9D014F9C  7C033004   INS V1, ZERO, 0, 7
9D014FA0  0254A026   XOR S4, S2, S4
9D014FA4  00746824   AND T5, V1, S4
9D014FA8  31A700FF   ANDI A3, T5, 255
9D014FAC  AFA70014   SW A3, 20(SP)
9D014FB0  394C0100   XORI T4, T2, 256
9D014FB4  7D970200   EXT S7, T4, 8, 1
9D014FB8  8F8E80E8   LW T6, -32536(GP)
9D014FBC  25C8FFFA   ADDIU T0, T6, -6
9D014FC0  AF8880E8   SW T0, -32536(GP)
9D014FC4  26783010   ADDIU T8, S3, 12304
9D014FC8  8F050054   LW A1, 84(T8)
9D014FCC  24AB0006   ADDIU T3, A1, 6
9D014FD8  0240A021   ADDU S4, S2, ZERO
9D014FDC  0B40565D   J .L95
9D014FE0  0240A821   ADDU S5, S2, ZERO
9D015014  0240A021   ADDU S4, S2, ZERO
2341:                         OPCODE_END
9D014FD0  1D000004   BGTZ T0, 0x9D014FE4
9D014FD4  AF0B0054   SW T3, 84(T8)
9D014FE4  26100003   ADDIU S0, S0, 3
9D015004  93350000   LBU S5, 0(T9)
9D015008  00153080   SLL A2, S5, 2
9D01500C  00D65021   ADDU T2, A2, S6
9D015010  8D450000   LW A1, 0(T2)
9D015018  0B403272   J 0x9D00C9C8
9D01501C  0240A821   ADDU S5, S2, ZERO
2342:                
2343:                      OPCODE_BEGIN(F0)  /* BEQ $nnnn */
2344:                         BEQ();
9D015020  16A0001F   BNE S5, ZERO, 0x9D0150A0
9D015024  26110001   ADDIU S1, S0, 1
9D015028  260E0001   ADDIU T6, S0, 1
9D015048  804F0000   LB T7, 0(V0)
9D01504C  31D100FF   ANDI S1, T6, 255
9D015050  01F12021   ADDU A0, T7, S1
9D015054  30990100   ANDI T9, A0, 256
9D015058  13200009   BEQ T9, ZERO, 0x9D015080
9D01505C  8F8780E8   LW A3, -32536(GP)
9D015060  8F8680E8   LW A2, -32536(GP)
9D015064  24CAFFFF   ADDIU T2, A2, -1
9D015068  AF8A80E8   SW T2, -32536(GP)
9D01506C  26703010   ADDIU S0, S3, 12304
9D015070  8E030054   LW V1, 84(S0)
9D015074  246D0001   ADDIU T5, V1, 1
9D015078  AE0D0054   SW T5, 84(S0)
9D01507C  8F8780E8   LW A3, -32536(GP)
9D015080  24ECFFFD   ADDIU T4, A3, -3
9D015084  AF8C80E8   SW T4, -32536(GP)
9D015088  26683010   ADDIU T0, S3, 12304
9D01508C  8D180054   LW T8, 84(T0)
9D015090  27050003   ADDIU A1, T8, 3
9D015094  AD050054   SW A1, 84(T0)
9D015098  0B40542F   J 0x9D0150BC
9D01509C  01EE8821   ADDU S1, T7, T6
9D0150A0  8F9080E8   LW S0, -32536(GP)
9D0150A4  2603FFFE   ADDIU V1, S0, -2
9D0150A8  AF8380E8   SW V1, -32536(GP)
9D0150AC  266D3010   ADDIU T5, S3, 12304
9D0150B0  8DA70054   LW A3, 84(T5)
9D0150B4  24EC0002   ADDIU T4, A3, 2
9D0150B8  ADAC0054   SW T4, 84(T5)
2345:                         OPCODE_END
9D0150BC  8F8E80E8   LW T6, -32536(GP)
9D0150C0  19C0022C   BLEZ T6, .L95
9D0150C4  26300001   ADDIU S0, S1, 1
9D0150E4  90990000   LBU T9, 0(A0)
9D0150E8  00193080   SLL A2, T9, 2
9D0150EC  00D65021   ADDU T2, A2, S6
9D0150F0  0B403272   J 0x9D00C9C8
9D0150F4  8D450000   LW A1, 0(T2)
2346:                
2347:                      OPCODE_BEGIN(F1)  /* SBC ($nn),Y */
2348:                         SBC(5, INDIR_Y_BYTE_READ);
9D015124  8FBF0010   LW RA, 16(SP)
9D015128  017F4821   ADDU T1, T3, RA
9D01512C  3124FFFF   ANDI A0, T1, -1
9D015130  308200FF   ANDI V0, A0, 255
9D015134  005F782B   SLTU T7, V0, RA
9D015138  11E00008   BEQ T7, ZERO, 0x9D01515C
9D01513C  26110001   ADDIU S1, S0, 1
9D015140  8F9980E8   LW T9, -32536(GP)
9D015144  2726FFFF   ADDIU A2, T9, -1
9D015148  AF8680E8   SW A2, -32536(GP)
9D01514C  266A3010   ADDIU T2, S3, 12304
9D015150  8D520054   LW S2, 84(T2)
9D015154  26550001   ADDIU S5, S2, 1
9D015158  AD550054   SW S5, 84(T2)
9D01515C  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D015160  3AF70001   XORI S7, S7, 1
9D015164  02822023   SUBU A0, S4, V0
9D015168  00971823   SUBU V1, A0, S7
9D01516C  307200FF   ANDI S2, V1, 255
9D015170  00546826   XOR T5, V0, S4
9D015174  7C0D3004   INS T5, ZERO, 0, 7
9D015178  0254A026   XOR S4, S2, S4
9D01517C  01B43824   AND A3, T5, S4
9D015180  30EC00FF   ANDI T4, A3, 255
9D015184  AFAC0014   SW T4, 20(SP)
9D015188  38680100   XORI T0, V1, 256
9D01518C  7D170200   EXT S7, T0, 8, 1
9D015190  8F9880E8   LW T8, -32536(GP)
9D015194  2705FFFB   ADDIU A1, T8, -5
9D015198  AF8580E8   SW A1, -32536(GP)
9D01519C  266E3010   ADDIU T6, S3, 12304
9D0151A0  8DCB0054   LW T3, 84(T6)
9D0151A4  25690005   ADDIU T1, T3, 5
9D0151B0  0240A021   ADDU S4, S2, ZERO
9D0151B4  0B40565D   J .L95
9D0151B8  0240A821   ADDU S5, S2, ZERO
9D0151EC  0240A021   ADDU S4, S2, ZERO
2349:                         OPCODE_END
9D0151A8  1CA00004   BGTZ A1, 0x9D0151BC
9D0151AC  ADC90054   SW T1, 84(T6)
9D0151BC  26100002   ADDIU S0, S0, 2
9D0151DC  91550000   LBU S5, 0(T2)
9D0151E0  00152080   SLL A0, S5, 2
9D0151E4  00961821   ADDU V1, A0, S6
9D0151E8  8C650000   LW A1, 0(V1)
9D0151F0  0B403272   J 0x9D00C9C8
9D0151F4  0240A821   ADDU S5, S2, ZERO
2350:                
2351:                      OPCODE_BEGIN(F3)  /* ISB ($nn),Y */
2352:                         ISB(8, INDIR_Y, mem_writebyte, addr);
9D0151F8  26110001   ADDIU S1, S0, 1
9D015228  8FBF0010   LW RA, 16(SP)
9D01522C  013F7821   ADDU T7, T1, RA
9D015230  31F2FFFF   ANDI S2, T7, -1
9D015234  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D015238  02402021   ADDU A0, S2, ZERO
9D01523C  24420001   ADDIU V0, V0, 1
9D015240  305900FF   ANDI T9, V0, 255
9D015244  AFB90014   SW T9, 20(SP)
9D015248  02402021   ADDU A0, S2, ZERO
9D01524C  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D015250  03202821   ADDU A1, T9, ZERO
9D015254  8FA60014   LW A2, 20(SP)
9D015258  02865023   SUBU T2, S4, A2
9D01525C  3AF70001   XORI S7, S7, 1
9D015260  01572023   SUBU A0, T2, S7
9D015264  309200FF   ANDI S2, A0, 255
9D015268  00D41826   XOR V1, A2, S4
9D01526C  7C033004   INS V1, ZERO, 0, 7
9D015270  0254A026   XOR S4, S2, S4
9D015274  00746824   AND T5, V1, S4
9D015278  31A700FF   ANDI A3, T5, 255
9D01527C  AFA70014   SW A3, 20(SP)
9D015280  388C0100   XORI T4, A0, 256
9D015284  7D970200   EXT S7, T4, 8, 1
9D015288  8F8880E8   LW T0, -32536(GP)
9D01528C  2518FFF8   ADDIU T8, T0, -8
9D015290  AF9880E8   SW T8, -32536(GP)
9D015294  8EA50054   LW A1, 84(S5)
9D015298  24AE0008   ADDIU T6, A1, 8
9D0152A4  0240A021   ADDU S4, S2, ZERO
9D0152A8  0B40565D   J .L95
9D0152AC  0240A821   ADDU S5, S2, ZERO
9D0152E0  0240A021   ADDU S4, S2, ZERO
2353:                         OPCODE_END
9D01529C  1F000004   BGTZ T8, 0x9D0152B0
9D0152A0  AEAE0054   SW T6, 84(S5)
9D0152B0  26100002   ADDIU S0, S0, 2
9D0152D0  90590000   LBU T9, 0(V0)
9D0152D4  00193080   SLL A2, T9, 2
9D0152D8  00D65021   ADDU T2, A2, S6
9D0152DC  8D450000   LW A1, 0(T2)
9D0152E4  0B403272   J 0x9D00C9C8
9D0152E8  0240A821   ADDU S5, S2, ZERO
2354:                
2355:                      OPCODE_BEGIN(F5)  /* SBC $nn,X */
2356:                         SBC(4, ZP_IND_X_BYTE);
9D0152EC  26110001   ADDIU S1, S0, 1
9D01530C  91180000   LBU T8, 0(T0)
9D015310  03D82821   ADDU A1, FP, T8
9D015314  30AE00FF   ANDI T6, A1, 255
9D015318  8F9580E4   LW S5, -32540(GP)
9D01531C  02AE5821   ADDU T3, S5, T6
9D015320  91690000   LBU T1, 0(T3)
9D015324  0289F823   SUBU RA, S4, T1
9D015328  3AF70001   XORI S7, S7, 1
9D01532C  03F77823   SUBU T7, RA, S7
9D015330  31F200FF   ANDI S2, T7, 255
9D015334  01341026   XOR V0, T1, S4
9D015338  7C023004   INS V0, ZERO, 0, 7
9D01533C  0254A026   XOR S4, S2, S4
9D015340  0054C824   AND T9, V0, S4
9D015344  332600FF   ANDI A2, T9, 255
9D015348  AFA60014   SW A2, 20(SP)
9D01534C  39EA0100   XORI T2, T7, 256
9D015350  7D570200   EXT S7, T2, 8, 1
9D015354  8F8480E8   LW A0, -32536(GP)
9D015358  2487FFFC   ADDIU A3, A0, -4
9D01535C  AF8780E8   SW A3, -32536(GP)
9D015360  8DA30054   LW V1, 84(T5)
9D015364  246C0004   ADDIU T4, V1, 4
9D015370  0240A021   ADDU S4, S2, ZERO
9D015374  0B40565D   J .L95
9D015378  0240A821   ADDU S5, S2, ZERO
9D0153AC  0240A021   ADDU S4, S2, ZERO
2357:                         OPCODE_END
9D015368  1CE00004   BGTZ A3, 0x9D01537C
9D01536C  ADAC0054   SW T4, 84(T5)
9D01537C  26100002   ADDIU S0, S0, 2
9D01539C  92AB0000   LBU T3, 0(S5)
9D0153A0  000B4880   SLL T1, T3, 2
9D0153A4  0136F821   ADDU RA, T1, S6
9D0153A8  8FE50000   LW A1, 0(RA)
9D0153B0  0B403272   J 0x9D00C9C8
9D0153B4  0240A821   ADDU S5, S2, ZERO
2358:                
2359:                      OPCODE_BEGIN(F6)  /* INC $nn,X */
2360:                         INC(6, ZP_IND_X, ZP_WRITEBYTE, baddr);
9D0153B8  26110001   ADDIU S1, S0, 1
9D0153D8  90870000   LBU A3, 0(A0)
9D0153DC  03C71821   ADDU V1, FP, A3
9D0153E0  306C00FF   ANDI T4, V1, 255
9D0153E4  8F8D80E4   LW T5, -32540(GP)
9D0153E8  01AC4021   ADDU T0, T5, T4
9D0153EC  91180000   LBU T8, 0(T0)
9D0153F0  27050001   ADDIU A1, T8, 1
9D0153F4  30B200FF   ANDI S2, A1, 255
9D0153F8  A1120000   SB S2, 0(T0)
9D0153FC  8F8E80E8   LW T6, -32536(GP)
9D015400  25D5FFFA   ADDIU S5, T6, -6
9D015404  AF9580E8   SW S5, -32536(GP)
9D015408  8C4B0054   LW T3, 84(V0)
9D01540C  25690006   ADDIU T1, T3, 6
9D015418  0B40565D   J .L95
9D01541C  0240A821   ADDU S5, S2, ZERO
2361:                         OPCODE_END
9D015410  1EA00003   BGTZ S5, 0x9D015420
9D015414  AC490054   SW T1, 84(V0)
9D015420  26100002   ADDIU S0, S0, 2
9D015440  91440000   LBU A0, 0(T2)
9D015444  00043880   SLL A3, A0, 2
9D015448  00F61821   ADDU V1, A3, S6
9D01544C  8C650000   LW A1, 0(V1)
9D015450  0B403272   J 0x9D00C9C8
9D015454  0240A821   ADDU S5, S2, ZERO
2362:                
2363:                      OPCODE_BEGIN(F7)  /* ISB $nn,X */
2364:                         ISB(6, ZP_IND_X, ZP_WRITEBYTE, baddr);
9D015458  26110001   ADDIU S1, S0, 1
9D015478  91D50000   LBU S5, 0(T6)
9D01547C  03D55821   ADDU T3, FP, S5
9D015480  316900FF   ANDI T1, T3, 255
9D015484  8F9F80E4   LW RA, -32540(GP)
9D015488  03E97821   ADDU T7, RA, T1
9D01548C  91E20000   LBU V0, 0(T7)
9D015490  24590001   ADDIU T9, V0, 1
9D015494  332600FF   ANDI A2, T9, 255
9D015498  A1E60000   SB A2, 0(T7)
9D01549C  02865023   SUBU T2, S4, A2
9D0154A0  3AF70001   XORI S7, S7, 1
9D0154A4  01572023   SUBU A0, T2, S7
9D0154A8  309200FF   ANDI S2, A0, 255
9D0154AC  00D43826   XOR A3, A2, S4
9D0154B0  7C073004   INS A3, ZERO, 0, 7
9D0154B4  0254A026   XOR S4, S2, S4
9D0154B8  00F41824   AND V1, A3, S4
9D0154BC  306C00FF   ANDI T4, V1, 255
9D0154C0  AFAC0014   SW T4, 20(SP)
9D0154C4  38880100   XORI T0, A0, 256
9D0154C8  7D170200   EXT S7, T0, 8, 1
9D0154CC  8F9880E8   LW T8, -32536(GP)
9D0154D0  2705FFFA   ADDIU A1, T8, -6
9D0154D4  AF8580E8   SW A1, -32536(GP)
9D0154D8  8DAE0054   LW T6, 84(T5)
9D0154DC  25D50006   ADDIU S5, T6, 6
9D0154E8  0240A021   ADDU S4, S2, ZERO
9D0154EC  0B40565D   J .L95
9D0154F0  0240A821   ADDU S5, S2, ZERO
9D015524  0240A021   ADDU S4, S2, ZERO
2365:                         OPCODE_END
9D0154E0  1CA00004   BGTZ A1, 0x9D0154F4
9D0154E4  ADB50054   SW S5, 84(T5)
9D0154F4  26100002   ADDIU S0, S0, 2
9D015514  90590000   LBU T9, 0(V0)
9D015518  00193080   SLL A2, T9, 2
9D01551C  00D65021   ADDU T2, A2, S6
9D015520  8D450000   LW A1, 0(T2)
9D015528  0B403272   J 0x9D00C9C8
9D01552C  0240A821   ADDU S5, S2, ZERO
2366:                
2367:                      OPCODE_BEGIN(F8)  /* SED */
2368:                         SED();
9D015530  8F8480E8   LW A0, -32536(GP)
9D015534  2487FFFE   ADDIU A3, A0, -2
9D015538  AF8780E8   SW A3, -32536(GP)
9D01553C  26633010   ADDIU V1, S3, 12304
9D015540  8C6C0054   LW T4, 84(V1)
9D015544  25880002   ADDIU T0, T4, 2
9D015554  24160001   ADDIU S6, ZERO, 1
9D015558  0B40565D   J .L95
9D01555C  AFB60020   SW S6, 32(SP)
9D015590  24190001   ADDIU T9, ZERO, 1
2369:                         OPCODE_END
9D015548  1CE00005   BGTZ A3, .LBB1502
9D01554C  AC680054   SW T0, 84(V1)
9D015550  02008821   ADDU S1, S0, ZERO
9D01557C  93F10000   LBU S1, 0(RA)
9D015580  00117880   SLL T7, S1, 2
9D015584  01F61021   ADDU V0, T7, S6
9D015588  8C450000   LW A1, 0(V0)
9D01558C  26100001   ADDIU S0, S0, 1
9D015594  0B403272   J 0x9D00C9C8
9D015598  AFB90020   SW T9, 32(SP)
2370:                
2371:                      OPCODE_BEGIN(F9)  /* SBC $nnnn,Y */
2372:                         SBC(4, ABS_IND_Y_BYTE_READ);
9D01559C  0F4030A7   JAL bank_readword
9D0155A0  02002021   ADDU A0, S0, ZERO
9D0155A4  8FB20010   LW S2, 16(SP)
9D0155A8  0052A821   ADDU S5, V0, S2
9D0155AC  32A4FFFF   ANDI A0, S5, -1
9D0155B0  308600FF   ANDI A2, A0, 255
9D0155B4  00D2502B   SLTU T2, A2, S2
9D0155B8  11400008   BEQ T2, ZERO, 0x9D0155DC
9D0155BC  26110002   ADDIU S1, S0, 2
9D0155C0  8F8780E8   LW A3, -32536(GP)
9D0155C4  24E3FFFF   ADDIU V1, A3, -1
9D0155C8  AF8380E8   SW V1, -32536(GP)
9D0155CC  266C3010   ADDIU T4, S3, 12304
9D0155D0  8D880054   LW T0, 84(T4)
9D0155D4  25180001   ADDIU T8, T0, 1
9D0155D8  AD980054   SW T8, 84(T4)
9D0155DC  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0155E0  3AF70001   XORI S7, S7, 1
9D0155E4  02822023   SUBU A0, S4, V0
9D0155E8  00972823   SUBU A1, A0, S7
9D0155EC  30B200FF   ANDI S2, A1, 255
9D0155F0  00547026   XOR T6, V0, S4
9D0155F4  7C0E3004   INS T6, ZERO, 0, 7
9D0155F8  0254A026   XOR S4, S2, S4
9D0155FC  01D46824   AND T5, T6, S4
9D015600  31AB00FF   ANDI T3, T5, 255
9D015604  AFAB0014   SW T3, 20(SP)
9D015608  38A90100   XORI T1, A1, 256
9D01560C  7D370200   EXT S7, T1, 8, 1
9D015610  8F8F80E8   LW T7, -32536(GP)
9D015614  25E2FFFC   ADDIU V0, T7, -4
9D015618  AF8280E8   SW V0, -32536(GP)
9D01561C  26793010   ADDIU T9, S3, 12304
9D015620  8F350054   LW S5, 84(T9)
9D015624  26A60004   ADDIU A2, S5, 4
9D015630  0240A021   ADDU S4, S2, ZERO
9D015634  0B40565D   J .L95
9D015638  0240A821   ADDU S5, S2, ZERO
9D01566C  0240A021   ADDU S4, S2, ZERO
2373:                         OPCODE_END
9D015628  1C400004   BGTZ V0, 0x9D01563C
9D01562C  AF260054   SW A2, 84(T9)
9D01563C  26100003   ADDIU S0, S0, 3
9D01565C  91180000   LBU T8, 0(T0)
9D015660  00182080   SLL A0, T8, 2
9D015664  00962821   ADDU A1, A0, S6
9D015668  8CA50000   LW A1, 0(A1)
9D015670  0B403272   J 0x9D00C9C8
9D015674  0240A821   ADDU S5, S2, ZERO
2374:                
2375:                      OPCODE_BEGIN(FB)  /* ISB $nnnn,Y */
2376:                         ISB(7, ABS_IND_Y, mem_writebyte, addr);
9D015678  0F4030A7   JAL bank_readword
9D01567C  02002021   ADDU A0, S0, ZERO
9D015680  26110002   ADDIU S1, S0, 2
9D015684  8FB20010   LW S2, 16(SP)
9D015688  00527021   ADDU T6, V0, S2
9D01568C  31D2FFFF   ANDI S2, T6, -1
9D015690  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D015694  02402021   ADDU A0, S2, ZERO
9D015698  244D0001   ADDIU T5, V0, 1
9D01569C  31B500FF   ANDI S5, T5, 255
9D0156A0  02402021   ADDU A0, S2, ZERO
9D0156A4  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D0156A8  02A02821   ADDU A1, S5, ZERO
9D0156AC  02955823   SUBU T3, S4, S5
9D0156B0  3AF70001   XORI S7, S7, 1
9D0156B4  01774823   SUBU T1, T3, S7
9D0156B8  313200FF   ANDI S2, T1, 255
9D0156BC  02B47826   XOR T7, S5, S4
9D0156C0  7C0F3004   INS T7, ZERO, 0, 7
9D0156C4  0254A026   XOR S4, S2, S4
9D0156C8  01F41024   AND V0, T7, S4
9D0156CC  305900FF   ANDI T9, V0, 255
9D0156D0  AFB90014   SW T9, 20(SP)
9D0156D4  39260100   XORI A2, T1, 256
9D0156D8  7CD70200   EXT S7, A2, 8, 1
9D0156DC  8F8A80E8   LW T2, -32536(GP)
9D0156E0  2547FFF9   ADDIU A3, T2, -7
9D0156E4  AF8780E8   SW A3, -32536(GP)
9D0156E8  26633010   ADDIU V1, S3, 12304
9D0156EC  8C6C0054   LW T4, 84(V1)
9D0156F0  25880007   ADDIU T0, T4, 7
9D0156FC  0240A021   ADDU S4, S2, ZERO
9D015700  0B40565D   J .L95
9D015704  0240A821   ADDU S5, S2, ZERO
9D015738  0240A021   ADDU S4, S2, ZERO
2377:                         OPCODE_END
9D0156F4  1CE00004   BGTZ A3, 0x9D015708
9D0156F8  AC680054   SW T0, 84(V1)
9D015708  26100003   ADDIU S0, S0, 3
9D015728  91B50000   LBU S5, 0(T5)
9D01572C  00155880   SLL T3, S5, 2
9D015730  01764821   ADDU T1, T3, S6
9D015734  8D250000   LW A1, 0(T1)
9D01573C  0B403272   J 0x9D00C9C8
9D015740  0240A821   ADDU S5, S2, ZERO
2378:                
2379:                      OPCODE_BEGIN(FD)  /* SBC $nnnn,X */
2380:                         SBC(4, ABS_IND_X_BYTE_READ);
9D015744  0F4030A7   JAL bank_readword
9D015748  02002021   ADDU A0, S0, ZERO
9D01574C  005E9021   ADDU S2, V0, FP
9D015750  3244FFFF   ANDI A0, S2, -1
9D015754  308F00FF   ANDI T7, A0, 255
9D015758  01FE102B   SLTU V0, T7, FP
9D01575C  10400008   BEQ V0, ZERO, 0x9D015780
9D015760  26110002   ADDIU S1, S0, 2
9D015764  8F9980E8   LW T9, -32536(GP)
9D015768  2726FFFF   ADDIU A2, T9, -1
9D01576C  AF8680E8   SW A2, -32536(GP)
9D015770  266A3010   ADDIU T2, S3, 12304
9D015774  8D470054   LW A3, 84(T2)
9D015778  24E30001   ADDIU V1, A3, 1
9D01577C  AD430054   SW V1, 84(T2)
9D015780  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D015784  3AF70001   XORI S7, S7, 1
9D015788  02826023   SUBU T4, S4, V0
9D01578C  01974023   SUBU T0, T4, S7
9D015790  311200FF   ANDI S2, T0, 255
9D015794  0054C026   XOR T8, V0, S4
9D015798  7C183004   INS T8, ZERO, 0, 7
9D01579C  0254A026   XOR S4, S2, S4
9D0157A0  03142024   AND A0, T8, S4
9D0157A4  308500FF   ANDI A1, A0, 255
9D0157A8  AFA50014   SW A1, 20(SP)
9D0157AC  390E0100   XORI T6, T0, 256
9D0157B0  7DD70200   EXT S7, T6, 8, 1
9D0157B4  8F8D80E8   LW T5, -32536(GP)
9D0157B8  25B5FFFC   ADDIU S5, T5, -4
9D0157BC  AF9580E8   SW S5, -32536(GP)
9D0157C0  266B3010   ADDIU T3, S3, 12304
9D0157C4  8D690054   LW T1, 84(T3)
9D0157C8  252F0004   ADDIU T7, T1, 4
9D0157D4  0240A021   ADDU S4, S2, ZERO
9D0157D8  0B40565D   J .L95
9D0157DC  0240A821   ADDU S5, S2, ZERO
9D015810  0240A021   ADDU S4, S2, ZERO
2381:                         OPCODE_END
9D0157CC  1EA00004   BGTZ S5, 0x9D0157E0
9D0157D0  AD6F0054   SW T7, 84(T3)
9D0157E0  26100003   ADDIU S0, S0, 3
9D015800  90E30000   LBU V1, 0(A3)
9D015804  00036080   SLL T4, V1, 2
9D015808  01964021   ADDU T0, T4, S6
9D01580C  8D050000   LW A1, 0(T0)
9D015814  0B403272   J 0x9D00C9C8
9D015818  0240A821   ADDU S5, S2, ZERO
2382:                
2383:                      OPCODE_BEGIN(FE)  /* INC $nnnn,X */
2384:                         INC(7, ABS_IND_X, mem_writebyte, addr);
9D01581C  0F4030A7   JAL bank_readword
9D015820  02002021   ADDU A0, S0, ZERO
9D015824  26110002   ADDIU S1, S0, 2
9D015828  005E9021   ADDU S2, V0, FP
9D01582C  3255FFFF   ANDI S5, S2, -1
9D015830  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D015834  02A02021   ADDU A0, S5, ZERO
9D015838  24580001   ADDIU T8, V0, 1
9D01583C  331200FF   ANDI S2, T8, 255
9D015840  02A02021   ADDU A0, S5, ZERO
9D015844  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D015848  02402821   ADDU A1, S2, ZERO
9D01584C  8F8480E8   LW A0, -32536(GP)
9D015850  2485FFF9   ADDIU A1, A0, -7
9D015854  AF8580E8   SW A1, -32536(GP)
9D015858  266E3010   ADDIU T6, S3, 12304
9D01585C  8DCD0054   LW T5, 84(T6)
9D015860  25AB0007   ADDIU T3, T5, 7
9D01586C  0B40565D   J .L95
9D015870  0240A821   ADDU S5, S2, ZERO
2385:                         OPCODE_END
9D015864  1CA00003   BGTZ A1, 0x9D015874
9D015868  ADCB0054   SW T3, 84(T6)
9D015874  26100003   ADDIU S0, S0, 3
9D015894  922A0000   LBU T2, 0(S1)
9D015898  000A3880   SLL A3, T2, 2
9D01589C  00F61821   ADDU V1, A3, S6
9D0158A0  8C650000   LW A1, 0(V1)
9D0158A4  0B403272   J 0x9D00C9C8
9D0158A8  0240A821   ADDU S5, S2, ZERO
2386:                
2387:                      OPCODE_BEGIN(FF)  /* ISB $nnnn,X */
2388:                         ISB(7, ABS_IND_X, mem_writebyte, addr);
9D00C9BC  3C13A001   LUI S3, -24575
9D0158AC  0F4030A7   JAL bank_readword
9D0158B0  02002021   ADDU A0, S0, ZERO
9D0158B4  26110002   ADDIU S1, S0, 2
9D0158B8  005E6021   ADDU T4, V0, FP
9D0158BC  3192FFFF   ANDI S2, T4, -1
9D0158C0  0F403048   JAL .LFB4, mem_readbyte, .Ltext0
9D0158C4  02402021   ADDU A0, S2, ZERO
9D0158C8  24480001   ADDIU T0, V0, 1
9D0158CC  311500FF   ANDI S5, T0, 255
9D0158D0  02402021   ADDU A0, S2, ZERO
9D0158D4  0F40307E   JAL .LFB5, mem_writebyte, .LFE4
9D0158D8  02A02821   ADDU A1, S5, ZERO
9D0158DC  0295C023   SUBU T8, S4, S5
9D0158E0  3AF70001   XORI S7, S7, 1
9D0158E4  03172023   SUBU A0, T8, S7
9D0158E8  309200FF   ANDI S2, A0, 255
9D0158EC  02B42826   XOR A1, S5, S4
9D0158F0  7C053004   INS A1, ZERO, 0, 7
9D0158F4  0254A026   XOR S4, S2, S4
9D0158F8  00B47024   AND T6, A1, S4
9D0158FC  31CD00FF   ANDI T5, T6, 255
9D015900  AFAD0014   SW T5, 20(SP)
9D015904  388B0100   XORI T3, A0, 256
9D015908  7D770200   EXT S7, T3, 8, 1
9D01590C  8F8980E8   LW T1, -32536(GP)
9D015910  252FFFF9   ADDIU T7, T1, -7
9D015914  AF8F80E8   SW T7, -32536(GP)
9D015918  26793010   ADDIU T9, S3, 12304
9D01591C  8F260054   LW A2, 84(T9)
9D015920  24C20007   ADDIU V0, A2, 7
9D01592C  0240A021   ADDU S4, S2, ZERO
9D015930  0B40565D   J .L95
9D015934  0240A821   ADDU S5, S2, ZERO
9D015968  0240A021   ADDU S4, S2, ZERO
2389:                         OPCODE_END
9D00C9C0  3C0F9D03   LUI T7, -25341
9D00C9C4  25F65CD4   ADDIU S6, T7, 23764
9D00C9C8  00A00008   JR A1
9D00C9CC  00000000   NOP
9D015924  1DE00004   BGTZ T7, 0x9D015938
9D015928  AF220054   SW V0, 84(T9)
9D015938  26100003   ADDIU S0, S0, 3
9D015958  91150000   LBU S5, 0(T0)
9D01595C  0015C080   SLL T8, S5, 2
9D015960  03162021   ADDU A0, T8, S6
9D015964  8C850000   LW A1, 0(A0)
9D01596C  0B403272   J 0x9D00C9C8
9D015970  0240A821   ADDU S5, S2, ZERO
2390:                
2391:                #ifdef NES6502_JUMPTABLE
2392:                end_execute:
2393:                
2394:                #else /* !NES6502_JUMPTABLE */
2395:                      }
2396:                   }
2397:                #endif /* !NES6502_JUMPTABLE */
2398:                
2399:                   /* store local copy of regs */
2400:                   STORE_LOCAL_REGS();
9D015974  3C13A001   LUI S3, -24575
9D015978  26703010   ADDIU S0, S3, 12304
9D01597C  AE110048   SW S1, 72(S0)
9D015980  A214004C   SB S4, 76(S0)
9D015984  A21E004E   SB FP, 78(S0)
9D015988  8FBE0010   LW FP, 16(SP)
9D01598C  A21E004F   SB FP, 79(S0)
9D015990  7C123004   INS S2, ZERO, 0, 7
9D015994  7C12B420   SEB S6, S2
9D015998  24120040   ADDIU S2, ZERO, 64
9D01599C  8FB40014   LW S4, 20(SP)
9D0159A0  0014900A   MOVZ S2, ZERO, S4
9D0159A4  240E0010   ADDIU T6, ZERO, 16
9D0159A8  8FAD0028   LW T5, 40(SP)
9D0159AC  000D700A   MOVZ T6, ZERO, T5
9D0159B0  240B0008   ADDIU T3, ZERO, 8
9D0159B4  8FA90020   LW T1, 32(SP)
9D0159B8  0009580A   MOVZ T3, ZERO, T1
9D0159BC  240F0004   ADDIU T7, ZERO, 4
9D0159C0  8FB9001C   LW T9, 28(SP)
9D0159C4  0019780A   MOVZ T7, ZERO, T9
9D0159C8  24060002   ADDIU A2, ZERO, 2
9D0159CC  0015300B   MOVN A2, ZERO, S5
9D0159D0  3C02A001   LUI V0, -24575
9D0159D4  244A3010   ADDIU T2, V0, 12304
9D0159D8  36F70020   ORI S7, S7, 32
9D0159DC  02D73825   OR A3, S6, S7
9D0159E0  02471825   OR V1, S2, A3
9D0159E4  01C38825   OR S1, T6, V1
9D0159E8  01716025   OR T4, T3, S1
9D0159EC  01EC4025   OR T0, T7, T4
9D0159F0  00C8A825   OR S5, A2, T0
9D0159F4  A155004D   SB S5, 77(T2)
9D0159F8  8FB80018   LW T8, 24(SP)
9D0159FC  A1580050   SB T8, 80(T2)
2401:                
2402:                   /* Return our actual amount of executed cycles */
2403:                   return (cpu.total_cycles - old_cycles);
9D015A00  8D450054   LW A1, 84(T2)
2404:                }
9D015A04  8FA40024   LW A0, 36(SP)
9D015A08  00A41023   SUBU V0, A1, A0
9D015A0C  8FBF005C   LW RA, 92(SP)
9D015A10  8FBE0058   LW FP, 88(SP)
9D015A14  8FB70054   LW S7, 84(SP)
9D015A18  8FB60050   LW S6, 80(SP)
9D015A1C  8FB5004C   LW S5, 76(SP)
9D015A20  8FB40048   LW S4, 72(SP)
9D015A24  8FB30044   LW S3, 68(SP)
9D015A28  8FB20040   LW S2, 64(SP)
9D015A2C  8FB1003C   LW S1, 60(SP)
9D015A30  8FB00038   LW S0, 56(SP)
9D015A34  03E00008   JR RA
9D015A38  27BD0060   ADDIU SP, SP, 96
2405:                
2406:                /* Issue a CPU Reset */
2407:                void nes6502_reset(void)
2408:                {
9D015A3C  27BDFFE8   ADDIU SP, SP, -24
9D015A40  AFBF0014   SW RA, 20(SP)
9D015A44  AFB00010   SW S0, 16(SP)
2409:                   cpu.p_reg = Z_FLAG | R_FLAG | I_FLAG;     /* Reserved bit always 1 */
9D015A48  3C10A001   LUI S0, -24575
9D015A4C  26103010   ADDIU S0, S0, 12304
9D015A50  24020026   ADDIU V0, ZERO, 38
9D015A54  A202004D   SB V0, 77(S0)
2410:                   cpu.int_pending = 0;                      /* No pending interrupts */
9D015A58  A2000052   SB ZERO, 82(S0)
2411:                   cpu.int_latency = 0;                      /* No latent interrupts */
9D015A5C  A2000053   SB ZERO, 83(S0)
2412:                   cpu.pc_reg = bank_readword(RESET_VECTOR); /* Fetch reset vector */
9D015A60  0F4030A7   JAL bank_readword
9D015A64  3404FFFC   ORI A0, ZERO, -4
9D015A68  AE020048   SW V0, 72(S0)
2413:                   cpu.burn_cycles = RESET_CYCLES;
9D015A6C  24030006   ADDIU V1, ZERO, 6
9D015A70  AE030058   SW V1, 88(S0)
2414:                   cpu.jammed = false;
9D015A74  A2000051   SB ZERO, 81(S0)
2415:                }
9D015A78  8FBF0014   LW RA, 20(SP)
9D015A7C  8FB00010   LW S0, 16(SP)
9D015A80  03E00008   JR RA
9D015A84  27BD0018   ADDIU SP, SP, 24
2416:                
2417:                /* following macro is used for below 2 functions */
2418:                #define  DECLARE_LOCAL_REGS \
2419:                   uint32 PC; \
2420:                   uint8 A, X, Y, S; \
2421:                   uint8 n_flag, v_flag, b_flag; \
2422:                   uint8 d_flag, i_flag, z_flag, c_flag;
2423:                
2424:                /* Non-maskable interrupt */
2425:                void nes6502_nmi(void)
2426:                {
9D015A98  27BDFFD0   ADDIU SP, SP, -48
9D015A9C  AFBF002C   SW RA, 44(SP)
9D015AA0  AFB50028   SW S5, 40(SP)
9D015AA4  AFB40024   SW S4, 36(SP)
9D015AA8  AFB30020   SW S3, 32(SP)
9D015AAC  AFB2001C   SW S2, 28(SP)
9D015AB0  AFB10018   SW S1, 24(SP)
9D015AB4  AFB00014   SW S0, 20(SP)
2427:                   DECLARE_LOCAL_REGS
2428:                
2429:                   if (false == cpu.jammed)
9D015A88  3C02A001   LUI V0, -24575
9D015A8C  90433061   LBU V1, 12385(V0)
9D015A90  14600049   BNE V1, ZERO, 0x9D015BB8
9D015A94  00000000   NOP
2430:                   {
2431:                      GET_GLOBAL_REGS();
9D015AB8  3C04A001   LUI A0, -24575
9D015ABC  24863010   ADDIU A2, A0, 12304
9D015AC0  8CC50048   LW A1, 72(A2)
9D015AC4  90C8004D   LBU T0, 77(A2)
9D015AC8  31110040   ANDI S1, T0, 64
9D015ACC  323100FF   ANDI S1, S1, 255
9D015AD0  31100008   ANDI S0, T0, 8
9D015AD4  321000FF   ANDI S0, S0, 255
9D015AD8  39130002   XORI S3, T0, 2
9D015ADC  7E730040   EXT S3, S3, 1, 1
9D015AE0  90C90050   LBU T1, 80(A2)
2432:                      NMI_PROC();
9D015AE4  8F8A80E0   LW T2, -32544(GP)
9D015AE8  01495821   ADDU T3, T2, T1
9D015AEC  00053A02   SRL A3, A1, 8
9D015AF0  A1670000   SB A3, 0(T3)
9D015AF4  252CFFFF   ADDIU T4, T1, -1
9D015AF8  318D00FF   ANDI T5, T4, 255
9D015AFC  014D7021   ADDU T6, T2, T5
9D015B00  A1C50000   SB A1, 0(T6)
9D015B04  2534FFFD   ADDIU S4, T1, -3
9D015B08  329400FF   ANDI S4, S4, 255
9D015B0C  252FFFFE   ADDIU T7, T1, -2
9D015B10  31F200FF   ANDI S2, T7, 255
9D015B14  0152C021   ADDU T8, T2, S2
9D015B18  31150080   ANDI S5, T0, 128
9D015B1C  7C159420   SEB S2, S5
9D015B20  31190004   ANDI T9, T0, 4
9D015B24  241F0002   ADDIU RA, ZERO, 2
9D015B28  0013F80B   MOVN RA, ZERO, S3
9D015B2C  31150001   ANDI S5, T0, 1
9D015B30  36A20020   ORI V0, S5, 32
9D015B34  02421825   OR V1, S2, V0
9D015B38  02232025   OR A0, S1, V1
9D015B3C  02043025   OR A2, S0, A0
9D015B40  03262825   OR A1, T9, A2
9D015B44  03E54025   OR T0, RA, A1
9D015B48  A3080000   SB T0, 0(T8)
9D015B4C  0F4030A7   JAL bank_readword
9D015B50  3404FFFA   ORI A0, ZERO, -6
2433:                      cpu.burn_cycles += INT_CYCLES;
9D015B54  3C09A001   LUI T1, -24575
9D015B58  252A3010   ADDIU T2, T1, 12304
9D015B5C  8D4B0058   LW T3, 88(T2)
9D015B60  25670007   ADDIU A3, T3, 7
9D015B64  AD470058   SW A3, 88(T2)
2434:                      STORE_LOCAL_REGS();
9D015B68  AD420048   SW V0, 72(T2)
9D015B6C  240C0002   ADDIU T4, ZERO, 2
9D015B70  0013600B   MOVN T4, ZERO, S3
9D015B74  3C0DA001   LUI T5, -24575
9D015B78  25AE3010   ADDIU T6, T5, 12304
9D015B7C  36AF0024   ORI T7, S5, 36
9D015B80  024FC025   OR T8, S2, T7
9D015B84  02388825   OR S1, S1, T8
9D015B88  02118025   OR S0, S0, S1
9D015B8C  01909025   OR S2, T4, S0
9D015B90  A1D2004D   SB S2, 77(T6)
9D015B94  A1D40050   SB S4, 80(T6)
2435:                   }
2436:                }
9D015B98  8FBF002C   LW RA, 44(SP)
9D015B9C  8FB50028   LW S5, 40(SP)
9D015BA0  8FB40024   LW S4, 36(SP)
9D015BA4  8FB30020   LW S3, 32(SP)
9D015BA8  8FB2001C   LW S2, 28(SP)
9D015BAC  8FB10018   LW S1, 24(SP)
9D015BB0  8FB00014   LW S0, 20(SP)
9D015BB4  27BD0030   ADDIU SP, SP, 48
9D015BB8  03E00008   JR RA
9D015BBC  00000000   NOP
2437:                
2438:                /* Interrupt request */
2439:                void nes6502_irq(void)
2440:                {
9D015BD0  27BDFFC8   ADDIU SP, SP, -56
9D015BD4  AFBF0034   SW RA, 52(SP)
9D015BD8  AFBE0030   SW FP, 48(SP)
9D015BDC  AFB7002C   SW S7, 44(SP)
9D015BE0  AFB60028   SW S6, 40(SP)
9D015BE4  AFB50024   SW S5, 36(SP)
9D015BE8  AFB40020   SW S4, 32(SP)
9D015BEC  AFB3001C   SW S3, 28(SP)
9D015BF0  AFB20018   SW S2, 24(SP)
9D015BF4  AFB10014   SW S1, 20(SP)
9D015BF8  AFB00010   SW S0, 16(SP)
2441:                   DECLARE_LOCAL_REGS
2442:                
2443:                   if (false == cpu.jammed)
9D015BC0  3C02A001   LUI V0, -24575
9D015BC4  90433061   LBU V1, 12385(V0)
9D015BC8  14600065   BNE V1, ZERO, 0x9D015D60
9D015BCC  3C04A001   LUI A0, -24575
2444:                   {
2445:                      GET_GLOBAL_REGS();
9D015BFC  24863010   ADDIU A2, A0, 12304
9D015C00  8CC20048   LW V0, 72(A2)
9D015C04  90DE004C   LBU FP, 76(A2)
9D015C08  90D7004E   LBU S7, 78(A2)
9D015C0C  90D6004F   LBU S6, 79(A2)
9D015C10  90C7004D   LBU A3, 77(A2)
9D015C14  30F50080   ANDI S5, A3, 128
9D015C18  30F20040   ANDI S2, A3, 64
9D015C1C  325200FF   ANDI S2, S2, 255
9D015C20  30F10008   ANDI S1, A3, 8
9D015C24  323100FF   ANDI S1, S1, 255
9D015C28  30E50004   ANDI A1, A3, 4
9D015C2C  30A800FF   ANDI T0, A1, 255
9D015C30  38F40002   XORI S4, A3, 2
9D015C34  7E940040   EXT S4, S4, 1, 1
9D015C38  30F30001   ANDI S3, A3, 1
9D015CCC  30E90010   ANDI T1, A3, 16
9D015CD0  312A00FF   ANDI T2, T1, 255
2446:                      if (0 == i_flag)
9D015C3C  15000023   BNE T0, ZERO, 0x9D015CCC
9D015C40  90D00050   LBU S0, 80(A2)
2447:                      {
2448:                         IRQ_PROC();
9D015C44  8F8D80E0   LW T5, -32544(GP)
9D015C48  01B07021   ADDU T6, T5, S0
9D015C4C  00027A02   SRL T7, V0, 8
9D015C50  A1CF0000   SB T7, 0(T6)
9D015C54  2618FFFE   ADDIU T8, S0, -2
9D015C58  331900FF   ANDI T9, T8, 255
9D015C5C  261FFFFF   ADDIU RA, S0, -1
9D015C60  33E300FF   ANDI V1, RA, 255
9D015C64  01A32021   ADDU A0, T5, V1
9D015C68  A0820000   SB V0, 0(A0)
9D015C6C  2602FFFD   ADDIU V0, S0, -3
9D015C70  305000FF   ANDI S0, V0, 255
9D015C74  01B93021   ADDU A2, T5, T9
9D015C78  2407FF80   ADDIU A3, ZERO, -128
9D015C7C  02A72824   AND A1, S5, A3
9D015C80  7C054420   SEB T0, A1
9D015C84  24090002   ADDIU T1, ZERO, 2
9D015C88  0014480B   MOVN T1, ZERO, S4
9D015C8C  366A0020   ORI T2, S3, 32
9D015C90  010A5825   OR T3, T0, T2
9D015C94  024B6025   OR T4, S2, T3
9D015C98  022C6825   OR T5, S1, T4
9D015C9C  012D7025   OR T6, T1, T5
9D015CA0  A0CE0000   SB T6, 0(A2)
9D015CA4  0F4030A7   JAL bank_readword
9D015CA8  3404FFFE   ORI A0, ZERO, -2
9D015CC0  24080001   ADDIU T0, ZERO, 1
9D015CC4  0B405738   J 0x9D015CE0
9D015CC8  00005021   ADDU T2, ZERO, ZERO
2449:                         cpu.burn_cycles += INT_CYCLES;
9D015CAC  3C0FA001   LUI T7, -24575
9D015CB0  25F83010   ADDIU T8, T7, 12304
9D015CB4  8F190058   LW T9, 88(T8)
9D015CB8  27230007   ADDIU V1, T9, 7
9D015CBC  AF030058   SW V1, 88(T8)
2450:                      }
2451:                      else
2452:                      {
2453:                         cpu.int_pending = 1;
9D015CD4  240B0001   ADDIU T3, ZERO, 1
9D015CD8  3C0CA001   LUI T4, -24575
9D015CDC  A18B3062   SB T3, 12386(T4)
2454:                      }
2455:                      STORE_LOCAL_REGS();
9D015CE0  3C1FA001   LUI RA, -24575
9D015CE4  27E43010   ADDIU A0, RA, 12304
9D015CE8  AC820048   SW V0, 72(A0)
9D015CEC  A09E004C   SB FP, 76(A0)
9D015CF0  A097004E   SB S7, 78(A0)
9D015CF4  A096004F   SB S6, 79(A0)
9D015CF8  7C153004   INS S5, ZERO, 0, 7
9D015CFC  7C15F420   SEB FP, S5
9D015D00  24170004   ADDIU S7, ZERO, 4
9D015D04  0008B80A   MOVZ S7, ZERO, T0
9D015D08  24150002   ADDIU S5, ZERO, 2
9D015D0C  0014A80B   MOVN S5, ZERO, S4
9D015D10  36730020   ORI S3, S3, 32
9D015D14  03D33025   OR A2, FP, S3
9D015D18  02469025   OR S2, S2, A2
9D015D1C  01523825   OR A3, T2, S2
9D015D20  02278825   OR S1, S1, A3
9D015D24  02F12825   OR A1, S7, S1
9D015D28  02A54025   OR T0, S5, A1
9D015D2C  A088004D   SB T0, 77(A0)
9D015D30  A0900050   SB S0, 80(A0)
2456:                   }
2457:                }
9D015D34  8FBF0034   LW RA, 52(SP)
9D015D38  8FBE0030   LW FP, 48(SP)
9D015D3C  8FB7002C   LW S7, 44(SP)
9D015D40  8FB60028   LW S6, 40(SP)
9D015D44  8FB50024   LW S5, 36(SP)
9D015D48  8FB40020   LW S4, 32(SP)
9D015D4C  8FB3001C   LW S3, 28(SP)
9D015D50  8FB20018   LW S2, 24(SP)
9D015D54  8FB10014   LW S1, 20(SP)
9D015D58  8FB00010   LW S0, 16(SP)
9D015D5C  27BD0038   ADDIU SP, SP, 56
9D015D60  03E00008   JR RA
9D015D64  00000000   NOP
2458:                
2459:                /* Set dead cycle period */
2460:                void nes6502_burn(int cycles)
2461:                {
2462:                   cpu.burn_cycles += cycles;
9D015D68  3C02A001   LUI V0, -24575
9D015D6C  24453010   ADDIU A1, V0, 12304
9D015D70  8CA30058   LW V1, 88(A1)
9D015D74  00642021   ADDU A0, V1, A0
9D015D78  03E00008   JR RA
9D015D7C  ACA40058   SW A0, 88(A1)
2463:                }
2464:                
2465:                /* Release our timeslice */
2466:                void nes6502_release(void)
2467:                {
2468:                   remaining_cycles = 0;
9D015D80  03E00008   JR RA
2469:                }
2470:                
2471:                /*
2472:                ** $Log: nes6502.c,v $
2473:                ** Revision 1.2  2001/04/27 14:37:11  neil
2474:                ** wheeee
2475:                **
2476:                ** Revision 1.1  2001/04/27 12:54:39  neil
2477:                ** blah
2478:                **
2479:                ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
2480:                ** initial
2481:                **
2482:                ** Revision 1.34  2000/11/27 19:33:07  matt
2483:                ** concise interrupts
2484:                **
2485:                ** Revision 1.33  2000/11/26 15:39:54  matt
2486:                ** timing fixes
2487:                **
2488:                ** Revision 1.32  2000/11/20 13:22:51  matt
2489:                ** added note about word fetches across page boundaries
2490:                **
2491:                ** Revision 1.31  2000/11/13 00:57:39  matt
2492:                ** trying to add 1-instruction interrupt latency... and failing.
2493:                **
2494:                ** Revision 1.30  2000/10/10 13:58:14  matt
2495:                ** stroustrup squeezing his way in the door
2496:                **
2497:                ** Revision 1.29  2000/10/10 13:05:05  matt
2498:                ** Mr. Clean makes a guest appearance
2499:                **
2500:                ** Revision 1.28  2000/10/08 17:55:41  matt
2501:                ** check burn cycles before ints
2502:                **
2503:                ** Revision 1.27  2000/09/15 03:42:32  matt
2504:                ** nes6502_release to release current timeslice
2505:                **
2506:                ** Revision 1.26  2000/09/15 03:16:17  matt
2507:                ** optimized C flag handling, and ADC/SBC/ROL/ROR macros
2508:                **
2509:                ** Revision 1.25  2000/09/14 02:12:03  matt
2510:                ** disassembling now works with goto table, and removed memcpy from context get/set
2511:                **
2512:                ** Revision 1.24  2000/09/11 03:55:57  matt
2513:                ** cosmetics
2514:                **
2515:                ** Revision 1.23  2000/09/11 01:45:45  matt
2516:                ** flag optimizations.  this thing is fast!
2517:                **
2518:                ** Revision 1.22  2000/09/08 13:29:25  matt
2519:                ** added switch()-less execution for gcc
2520:                **
2521:                ** Revision 1.21  2000/09/08 11:54:48  matt
2522:                ** optimize
2523:                **
2524:                ** Revision 1.20  2000/09/07 21:58:18  matt
2525:                ** api change for nes6502_burn, optimized core
2526:                **
2527:                ** Revision 1.19  2000/09/07 13:39:01  matt
2528:                ** resolved a few conflicts
2529:                **
2530:                ** Revision 1.18  2000/09/07 01:34:55  matt
2531:                ** nes6502_init deprecated, moved flag regs to separate vars
2532:                **
2533:                ** Revision 1.17  2000/08/31 13:26:35  matt
2534:                ** added DISASM flag, to sync with asm version
2535:                **
2536:                ** Revision 1.16  2000/08/29 05:38:00  matt
2537:                ** removed faulty failure note
2538:                **
2539:                ** Revision 1.15  2000/08/28 12:53:44  matt
2540:                ** fixes for disassembler
2541:                **
2542:                ** Revision 1.14  2000/08/28 04:32:28  matt
2543:                ** naming convention changes
2544:                **
2545:                ** Revision 1.13  2000/08/28 01:46:15  matt
2546:                ** moved some of them defines around, cleaned up jamming code
2547:                **
2548:                ** Revision 1.12  2000/08/16 04:56:37  matt
2549:                ** accurate CPU jamming, added dead page emulation
2550:                **
2551:                ** Revision 1.11  2000/07/30 04:32:00  matt
2552:                ** now emulates the NES frame IRQ
2553:                **
2554:                ** Revision 1.10  2000/07/17 01:52:28  matt
2555:                ** made sure last line of all source files is a newline
2556:                **
2557:                ** Revision 1.9  2000/07/11 04:27:18  matt
2558:                ** new disassembler calling convention
2559:                **
2560:                ** Revision 1.8  2000/07/10 05:26:38  matt
2561:                ** cosmetic
2562:                **
2563:                ** Revision 1.7  2000/07/06 17:10:51  matt
2564:                ** minor (er, spelling) error fixed
2565:                **
2566:                ** Revision 1.6  2000/07/04 04:50:07  matt
2567:                ** minor change to includes
2568:                **
2569:                ** Revision 1.5  2000/07/03 02:18:16  matt
2570:                ** added a few notes about potential failure cases
2571:                **
2572:                ** Revision 1.4  2000/06/09 15:12:25  matt
2573:                ** initial revision
2574:                **
2575:                */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/config.c  ----------------------------------
1:                   /* Nofrendo Configuration Braindead Sample Implementation
2:                   **
3:                   ** $Id: config.c,v 1.2 2001/04/27 14:37:11 neil Exp $
4:                   */
5:                   
6:                   #include <ctype.h>
7:                   #include <string.h>
8:                   #include <stdlib.h>
9:                   #include <stdio.h>
10:                  
11:                  #include <noftypes.h>
12:                  #include <log.h>
13:                  #include <osd.h>
14:                  #include <nofconfig.h>
15:                  #include <version.h>
16:                  
17:                  typedef struct myvar_s
18:                  {
19:                     struct myvar_s *less, *greater;
20:                     char *group, *key, *value;
21:                  } myvar_t;
22:                  
23:                  static myvar_t *myVars = NULL;
24:                  static bool mySaveNeeded = false;
25:                  
26:                  
27:                  static void my_destroy(myvar_t **var)
28:                  {
9D02FE44  27BDFFE8   ADDIU SP, SP, -24
9D02FE48  AFBF0014   SW RA, 20(SP)
9D02FE4C  AFB00010   SW S0, 16(SP)
9D02FE50  00808021   ADDU S0, A0, ZERO
29:                     ASSERT(*var);
30:                  
31:                     if ((*var)->group) 
9D02FE54  8C840000   LW A0, 0(A0)
9D02FE58  8C820008   LW V0, 8(A0)
9D02FE5C  50400004   BEQL V0, ZERO, 0x9D02FE70
9D02FE60  8E030000   LW V1, 0(S0)
32:                        free((*var)->group);
9D02FE64  0F40F31D   JAL _my_free
9D02FE68  24840008   ADDIU A0, A0, 8
33:                     if ((*var)->key)
9D02FE6C  8E030000   LW V1, 0(S0)
9D02FE70  8C65000C   LW A1, 12(V1)
9D02FE74  50A00004   BEQL A1, ZERO, 0x9D02FE88
9D02FE78  8E060000   LW A2, 0(S0)
34:                        free((*var)->key);
9D02FE7C  0F40F31D   JAL _my_free
9D02FE80  2464000C   ADDIU A0, V1, 12
35:                     if ((*var)->value)
9D02FE84  8E060000   LW A2, 0(S0)
9D02FE88  8CC70010   LW A3, 16(A2)
9D02FE8C  10E00003   BEQ A3, ZERO, .LVL4
9D02FE90  00000000   NOP
36:                        free((*var)->value);
9D02FE94  0F40F31D   JAL _my_free
9D02FE98  24C40010   ADDIU A0, A2, 16
37:                     free(*var);
9D02FE9C  0F40F31D   JAL _my_free
9D02FEA0  02002021   ADDU A0, S0, ZERO
38:                  }
9D02FEA4  8FBF0014   LW RA, 20(SP)
9D02FEA8  8FB00010   LW S0, 16(SP)
9D02FEAC  03E00008   JR RA
9D02FEB0  27BD0018   ADDIU SP, SP, 24
39:                  
40:                  static myvar_t *my_create(const char *group, const char *key, const char *value)
41:                  {
9D02FEB4  27BDFFD0   ADDIU SP, SP, -48
9D02FEB8  AFBF002C   SW RA, 44(SP)
9D02FEBC  AFB30028   SW S3, 40(SP)
9D02FEC0  AFB20024   SW S2, 36(SP)
9D02FEC4  AFB10020   SW S1, 32(SP)
9D02FEC8  AFB0001C   SW S0, 28(SP)
9D02FECC  00808821   ADDU S1, A0, ZERO
9D02FED0  00A09021   ADDU S2, A1, ZERO
9D02FED4  00C09821   ADDU S3, A2, ZERO
42:                     myvar_t *var;
43:                  
44:                     var = malloc(sizeof(*var));
9D02FED8  0F40F30A   JAL _my_malloc
9D02FEDC  24040014   ADDIU A0, ZERO, 20
45:                     if (NULL == var)
9D02FEE0  1040002D   BEQ V0, ZERO, 0x9D02FF98
9D02FEE4  AFA20010   SW V0, 16(SP)
46:                     {
47:                        return 0;
9D02FF98  00001021   ADDU V0, ZERO, ZERO
48:                     }
49:                  
50:                     var->less = var->greater = NULL;
9D02FEE8  AC400004   SW ZERO, 4(V0)
9D02FEEC  AC400000   SW ZERO, 0(V0)
51:                     var->group = var->key = var->value = NULL;
9D02FEF0  8FB00010   LW S0, 16(SP)
9D02FEF4  AE000010   SW ZERO, 16(S0)
9D02FEF8  AE00000C   SW ZERO, 12(S0)
9D02FEFC  AE000008   SW ZERO, 8(S0)
52:                  
53:                     if ((var->group = malloc(strlen(group) + 1))
9D02FF00  0F40F2B0   JAL strlen
9D02FF04  02202021   ADDU A0, S1, ZERO
9D02FF08  0F40F30A   JAL _my_malloc
9D02FF0C  24440001   ADDIU A0, V0, 1
9D02FF10  1040001D   BEQ V0, ZERO, 0x9D02FF88
9D02FF14  AE020008   SW V0, 8(S0)
54:                         && (var->key = malloc(strlen(key) + 1))
9D02FF18  8FB00010   LW S0, 16(SP)
9D02FF1C  0F40F2B0   JAL strlen
9D02FF20  02402021   ADDU A0, S2, ZERO
9D02FF24  0F40F30A   JAL _my_malloc
9D02FF28  24440001   ADDIU A0, V0, 1
9D02FF2C  10400016   BEQ V0, ZERO, 0x9D02FF88
9D02FF30  AE02000C   SW V0, 12(S0)
55:                         && (var->value = malloc(strlen(value) + 1)))
9D02FF34  8FB00010   LW S0, 16(SP)
9D02FF38  0F40F2B0   JAL strlen
9D02FF3C  02602021   ADDU A0, S3, ZERO
9D02FF40  0F40F30A   JAL _my_malloc
9D02FF44  24440001   ADDIU A0, V0, 1
9D02FF48  1040000F   BEQ V0, ZERO, 0x9D02FF88
9D02FF4C  AE020010   SW V0, 16(S0)
56:                     {
57:                        strcpy(var->group, group);
9D02FF50  8FA20010   LW V0, 16(SP)
9D02FF54  8C440008   LW A0, 8(V0)
9D02FF58  0F40EFF7   JAL .LFE23, strcpy
9D02FF5C  02202821   ADDU A1, S1, ZERO
58:                        strcpy(var->key, key);
9D02FF60  8FA30010   LW V1, 16(SP)
9D02FF64  8C64000C   LW A0, 12(V1)
9D02FF68  0F40EFF7   JAL .LFE23, strcpy
9D02FF6C  02402821   ADDU A1, S2, ZERO
59:                        strcpy(var->value, value);
9D02FF70  8FA40010   LW A0, 16(SP)
9D02FF74  8C840010   LW A0, 16(A0)
9D02FF78  0F40EFF7   JAL .LFE23, strcpy
9D02FF7C  02602821   ADDU A1, S3, ZERO
60:                        return var;
9D02FF80  0B40BFE7   J 0x9D02FF9C
9D02FF84  8FA20010   LW V0, 16(SP)
61:                     }
62:                  
63:                     my_destroy(&var);
9D02FF88  0F40BF91   JAL .LFB8, my_destroy, .Ltext0
9D02FF8C  27A40010   ADDIU A0, SP, 16
64:                     return NULL;
9D02FF90  0B40BFE7   J 0x9D02FF9C
9D02FF94  00001021   ADDU V0, ZERO, ZERO
65:                  }
9D02FF9C  8FBF002C   LW RA, 44(SP)
9D02FFA0  8FB30028   LW S3, 40(SP)
9D02FFA4  8FB20024   LW S2, 36(SP)
9D02FFA8  8FB10020   LW S1, 32(SP)
9D02FFAC  8FB0001C   LW S0, 28(SP)
9D02FFB0  03E00008   JR RA
9D02FFB4  27BD0030   ADDIU SP, SP, 48
66:                  
67:                  static myvar_t *my_lookup(const char *group, const char *key) 
68:                  {
9D0300D8  27BDFFE0   ADDIU SP, SP, -32
9D0300DC  AFBF001C   SW RA, 28(SP)
9D0300E0  AFB20018   SW S2, 24(SP)
9D0300E4  AFB10014   SW S1, 20(SP)
9D0300E8  AFB00010   SW S0, 16(SP)
9D0300EC  00808821   ADDU S1, A0, ZERO
69:                     int cmp;
70:                     myvar_t *current = myVars;
9D0300F0  8F9080FC   LW S0, -32516(GP)
71:                  
72:                     while (current
9D0300F4  16000008   BNE S0, ZERO, 0x9D030118
9D0300F8  00A09021   ADDU S2, A1, ZERO
9D030110  1200000B   BEQ S0, ZERO, 0x9D030140
9D030114  02001021   ADDU V0, S0, ZERO
73:                            && ((cmp = stricmp(group, current->group))
9D030118  02202021   ADDU A0, S1, ZERO
9D03011C  0F41075A   JAL .LFE5, strcasecmp
9D030120  8E050008   LW A1, 8(S0)
9D030124  1440FFF7   BNE V0, ZERO, 0x9D030104
9D030128  02402021   ADDU A0, S2, ZERO
74:                                || (cmp = stricmp(key, current->key))))
9D03012C  0F41075A   JAL .LFE5, strcasecmp
9D030130  8E05000C   LW A1, 12(S0)
9D030134  1440FFF3   BNE V0, ZERO, 0x9D030104
9D030138  00000000   NOP
75:                     {
76:                        if (cmp < 0)
9D030104  04430002   BGEZL V0, 0x9D030110
9D030108  8E100004   LW S0, 4(S0)
9D03010C  8E100000   LW S0, 0(S0)
77:                           current = current->less;
78:                        else
79:                           current = current->greater;
80:                     }
81:                  
82:                     return current;
83:                  }
9D0300FC  0B40C050   J 0x9D030140
9D030100  02001021   ADDU V0, S0, ZERO
9D03013C  02001021   ADDU V0, S0, ZERO
9D030140  8FBF001C   LW RA, 28(SP)
9D030144  8FB20018   LW S2, 24(SP)
9D030148  8FB10014   LW S1, 20(SP)
9D03014C  8FB00010   LW S0, 16(SP)
9D030150  03E00008   JR RA
9D030154  27BD0020   ADDIU SP, SP, 32
84:                  
85:                  static void my_insert(myvar_t *var)
86:                  {
9D02FFF0  27BDFFE0   ADDIU SP, SP, -32
9D02FFF4  AFBF001C   SW RA, 28(SP)
9D02FFF8  AFB20018   SW S2, 24(SP)
9D02FFFC  AFB10014   SW S1, 20(SP)
9D030000  AFB00010   SW S0, 16(SP)
9D030004  00809021   ADDU S2, A0, ZERO
87:                     int cmp;
88:                     myvar_t **current = &myVars;
89:                  
90:                     while (*current
9D030008  0B40C007   J 0x9D03001C
9D03000C  279180FC   ADDIU S1, GP, -32516
9D03001C  8E300000   LW S0, 0(S1)
9D030020  52000014   BEQL S0, ZERO, 0x9D030074
9D030024  AE400004   SW ZERO, 4(S2)
91:                            && ((cmp = stricmp(var->group, (*current)->group))
9D030028  8E440008   LW A0, 8(S2)
9D03002C  0F41075A   JAL .LFE5, strcasecmp
9D030030  8E050008   LW A1, 8(S0)
9D030034  1440FFF6   BNE V0, ZERO, 0x9D030010
9D030038  26050004   ADDIU A1, S0, 4
92:                                || (cmp = stricmp(var->key, (*current)->key))))
9D03003C  8E44000C   LW A0, 12(S2)
9D030040  0F41075A   JAL .LFE5, strcasecmp
9D030044  8E05000C   LW A1, 12(S0)
9D030048  1440FFF1   BNE V0, ZERO, 0x9D030010
9D03004C  26050004   ADDIU A1, S0, 4
93:                     {
94:                        current = (cmp < 0) ? &(*current)->less : &(*current)->greater;
9D030010  28460000   SLTI A2, V0, 0
9D030014  00A08821   ADDU S1, A1, ZERO
9D030018  0206880B   MOVN S1, S0, A2
95:                     }
96:                  
97:                     if (*current)
98:                     {
99:                        var->less = (*current)->less;
9D030050  8E020000   LW V0, 0(S0)
9D030054  AE420000   SW V0, 0(S2)
100:                       var->greater = (*current)->greater;
9D030058  8E230000   LW V1, 0(S1)
9D03005C  8C640004   LW A0, 4(V1)
9D030060  AE440004   SW A0, 4(S2)
101:                       my_destroy(current);
9D030064  0F40BF91   JAL .LFB8, my_destroy, .Ltext0
9D030068  02202021   ADDU A0, S1, ZERO
9D03006C  0B40C01F   J 0x9D03007C
9D030070  AE320000   SW S2, 0(S1)
102:                    }
103:                    else
104:                    {
105:                       var->less = var->greater = NULL;
9D030074  AE400000   SW ZERO, 0(S2)
106:                    }
107:                 
108:                    *current = var;
9D030078  AE320000   SW S2, 0(S1)
109:                 }
9D03007C  8FBF001C   LW RA, 28(SP)
9D030080  8FB20018   LW S2, 24(SP)
9D030084  8FB10014   LW S1, 20(SP)
9D030088  8FB00010   LW S0, 16(SP)
9D03008C  03E00008   JR RA
9D030090  27BD0020   ADDIU SP, SP, 32
110:                 
111:                 static void my_save(FILE *stream, myvar_t *var, char **group)
112:                 {
9D03029C  27BDFFD8   ADDIU SP, SP, -40
9D0302A0  AFBF0024   SW RA, 36(SP)
9D0302A4  AFB30020   SW S3, 32(SP)
9D0302A8  AFB2001C   SW S2, 28(SP)
9D0302AC  AFB10018   SW S1, 24(SP)
9D0302B0  AFB00014   SW S0, 20(SP)
113:                    if (NULL == var)
9D0302B4  10A0001B   BEQ A1, ZERO, .LVL84
9D0302B8  00A08021   ADDU S0, A1, ZERO
9D0302BC  00809021   ADDU S2, A0, ZERO
9D0302C0  00C08821   ADDU S1, A2, ZERO
114:                       return;
115:                 
116:                    my_save(stream, var->less, group);
9D0302C4  0F40C0A7   JAL .LFB12, my_save, .LFE20
9D0302C8  8CA50000   LW A1, 0(A1)
117:                    
118:                    if (stricmp(*group, var->group))
9D0302CC  8E130008   LW S3, 8(S0)
9D0302D0  8E240000   LW A0, 0(S1)
9D0302D4  0F41075A   JAL .LFE5, strcasecmp
9D0302D8  02602821   ADDU A1, S3, ZERO
9D0302DC  10400008   BEQ V0, ZERO, 0x9D030300
9D0302E0  02402021   ADDU A0, S2, ZERO
119:                    {
120:                       fprintf(stream, "\n[%s]\n", var->group);
9D0302E4  3C059D04   LUI A1, -25340
9D0302E8  24A5DEF4   ADDIU A1, A1, -8460
9D0302EC  0F410870   JAL _fprintf_s, _fprintf_0
9D0302F0  02603021   ADDU A2, S3, ZERO
121:                       *group = var->group;
9D0302F4  8E020008   LW V0, 8(S0)
9D0302F8  AE220000   SW V0, 0(S1)
122:                    }
123:                    
124:                    fprintf(stream, "%s=%s\n", var->key, var->value);
9D0302FC  02402021   ADDU A0, S2, ZERO
9D030300  3C039D04   LUI V1, -25340
9D030304  2465DEFC   ADDIU A1, V1, -8452
9D030308  8E06000C   LW A2, 12(S0)
9D03030C  0F410870   JAL _fprintf_s, _fprintf_0
9D030310  8E070010   LW A3, 16(S0)
125:                    
126:                    my_save(stream, var->greater, group);
9D030314  02402021   ADDU A0, S2, ZERO
9D030318  8E050004   LW A1, 4(S0)
9D03031C  0F40C0A7   JAL .LFB12, my_save, .LFE20
9D030320  02203021   ADDU A2, S1, ZERO
127:                 }
9D030324  8FBF0024   LW RA, 36(SP)
9D030328  8FB30020   LW S3, 32(SP)
9D03032C  8FB2001C   LW S2, 28(SP)
9D030330  8FB10018   LW S1, 24(SP)
9D030334  8FB00014   LW S0, 20(SP)
9D030338  03E00008   JR RA
9D03033C  27BD0028   ADDIU SP, SP, 40
128:                 
129:                 static void my_cleanup(myvar_t *var)
130:                 {
9D02FFB8  27BDFFE8   ADDIU SP, SP, -24
9D02FFBC  AFBF0014   SW RA, 20(SP)
131:                    if (NULL == var)
9D02FFC0  10800008   BEQ A0, ZERO, .LVL27
9D02FFC4  AFA40018   SW A0, 24(SP)
132:                       return;
133:                 
134:                    my_cleanup(var->less);
9D02FFC8  0F40BFEE   JAL .LFB13, my_cleanup, .LFE9
9D02FFCC  8C840000   LW A0, 0(A0)
135:                    my_cleanup(var->greater);
9D02FFD0  8FA20018   LW V0, 24(SP)
9D02FFD4  0F40BFEE   JAL .LFB13, my_cleanup, .LFE9
9D02FFD8  8C440004   LW A0, 4(V0)
136:                    my_destroy(&var);
9D02FFDC  0F40BF91   JAL .LFB8, my_destroy, .Ltext0
9D02FFE0  27A40018   ADDIU A0, SP, 24
137:                 }
9D02FFE4  8FBF0014   LW RA, 20(SP)
9D02FFE8  03E00008   JR RA
9D02FFEC  27BD0018   ADDIU SP, SP, 24
138:                 
139:                 static char *my_getline(FILE *stream)
140:                 {
9D0303F4  27BDFBD8   ADDIU SP, SP, -1064
9D0303F8  AFBF0424   SW RA, 1060(SP)
9D0303FC  AFB20420   SW S2, 1056(SP)
9D030400  AFB1041C   SW S1, 1052(SP)
9D030404  AFB00418   SW S0, 1048(SP)
9D030408  00808821   ADDU S1, A0, ZERO
141:                    char buf[1024];
142:                    char *dynamic = NULL;
9D03040C  AFA00410   SW ZERO, 1040(SP)
143:                 
144:                    do
145:                    {
146:                       if (NULL == (fgets(buf, sizeof(buf), stream)))
9D030414  27A40010   ADDIU A0, SP, 16
9D030418  24050400   ADDIU A1, ZERO, 1024
9D03041C  0F40FCED   JAL fgets
9D030420  02203021   ADDU A2, S1, ZERO
9D030424  14400008   BNE V0, ZERO, 0x9D030448
9D030428  00408021   ADDU S0, V0, ZERO
147:                       {
148:                          if (dynamic)
9D03042C  8FA80410   LW T0, 1040(SP)
9D030430  51000039   BEQL T0, ZERO, 0x9D030518
9D030434  02001021   ADDU V0, S0, ZERO
149:                             free(dynamic);
9D030438  0F40F31D   JAL _my_free
9D03043C  27A40410   ADDIU A0, SP, 1040
150:                          return 0;
151:                       }
152:                 
153:                       if (NULL == dynamic)
9D030448  8FA40410   LW A0, 1040(SP)
9D03044C  1480000C   BNE A0, ZERO, 0x9D030480
9D030450  00000000   NOP
154:                       {
155:                          dynamic = malloc(strlen(buf) + 1);
9D030454  0F40F2B0   JAL strlen
9D030458  27A40010   ADDIU A0, SP, 16
9D03045C  0F40F30A   JAL _my_malloc
9D030460  24440001   ADDIU A0, V0, 1
156:                          if (NULL == dynamic)
9D030464  10400028   BEQ V0, ZERO, 0x9D030508
9D030468  AFA20410   SW V0, 1040(SP)
157:                          {
158:                             return 0;
9D030508  0B40C145   J 0x9D030514
9D03050C  00008021   ADDU S0, ZERO, ZERO
159:                          }
160:                          strcpy(dynamic, buf);
9D03046C  00402021   ADDU A0, V0, ZERO
9D030470  0F40EFF7   JAL .LFE23, strcpy
9D030474  27A50010   ADDIU A1, SP, 16
9D030478  0B40C134   J 0x9D0304D0
9D03047C  96230010   LHU V1, 16(S1)
161:                       }
162:                       else
163:                       {
164:                          /* a mini-version of realloc that works with our memory manager */
165:                          char *temp = NULL;
166:                          temp = malloc(strlen(dynamic) + strlen(buf) + 1);
9D030480  0F40F2B0   JAL strlen
9D030484  00000000   NOP
9D030488  00408021   ADDU S0, V0, ZERO
9D03048C  0F40F2B0   JAL strlen
9D030490  27A40010   ADDIU A0, SP, 16
9D030494  02021021   ADDU V0, S0, V0
9D030498  0F40F30A   JAL _my_malloc
9D03049C  24440001   ADDIU A0, V0, 1
167:                          if (NULL == temp)
9D0304A0  1040001B   BEQ V0, ZERO, 0x9D030510
9D0304A4  00408021   ADDU S0, V0, ZERO
168:                             return 0;
9D030510  00008021   ADDU S0, ZERO, ZERO
169:                 
170:                          strcpy(temp, dynamic);
9D0304A8  00402021   ADDU A0, V0, ZERO
9D0304AC  0F40EFF7   JAL .LFE23, strcpy
9D0304B0  8FA50410   LW A1, 1040(SP)
171:                          free(dynamic);
9D0304B4  0F40F31D   JAL _my_free
9D0304B8  27A40410   ADDIU A0, SP, 1040
172:                          dynamic = temp;
9D0304BC  AFB00410   SW S0, 1040(SP)
173:                 
174:                          strcat(dynamic, buf);
9D0304C0  02002021   ADDU A0, S0, ZERO
9D0304C4  0F410181   JAL strcat
9D0304C8  27A50010   ADDIU A1, SP, 16
175:                       }
176:                 
177:                       if (feof(stream))
9D0304CC  96230010   LHU V1, 16(S1)
9D0304D0  30640020   ANDI A0, V1, 32
9D0304D4  3085FFFF   ANDI A1, A0, -1
9D0304D8  10A00003   BEQ A1, ZERO, 0x9D0304E8
9D0304DC  8FB00410   LW S0, 1040(SP)
178:                       {
179:                          return dynamic;
9D0304E0  0B40C146   J 0x9D030518
9D0304E4  02001021   ADDU V0, S0, ZERO
180:                       }
181:                    } 
182:                    while (dynamic[strlen(dynamic) - 1] != '\n');
9D030410  2412000A   ADDIU S2, ZERO, 10
9D0304E8  0F40F2B0   JAL strlen
9D0304EC  02002021   ADDU A0, S0, ZERO
9D0304F0  02023021   ADDU A2, S0, V0
9D0304F4  80C7FFFF   LB A3, -1(A2)
9D0304F8  54F2FFC7   BNEL A3, S2, 0x9D030418
9D0304FC  27A40010   ADDIU A0, SP, 16
9D030500  0B40C146   J 0x9D030518
9D030504  02001021   ADDU V0, S0, ZERO
183:                 
184:                    return dynamic;
185:                 }
9D030440  0B40C146   J 0x9D030518
9D030444  02001021   ADDU V0, S0, ZERO
9D030514  02001021   ADDU V0, S0, ZERO
9D030518  8FBF0424   LW RA, 1060(SP)
9D03051C  8FB20420   LW S2, 1056(SP)
9D030520  8FB1041C   LW S1, 1052(SP)
9D030524  8FB00418   LW S0, 1048(SP)
9D030528  03E00008   JR RA
9D03052C  27BD0428   ADDIU SP, SP, 1064
186:                 
187:                 /* load_config loads from the disk the saved configuration. */
188:                 static int load_config(char *filename)
189:                 {
190:                    FILE *config_file;
191:                 
192:                    if ((config_file = fopen(filename, "r")))
9D030558  3C02A001   LUI V0, -24575
9D03055C  8C445888   LW A0, 22664(V0)
9D030560  3C059D04   LUI A1, -25340
9D030564  0F40F363   JAL .Letext0, .LFE12, fopen
9D030568  24A5DF5C   ADDIU A1, A1, -8356
9D03056C  104000A9   BEQ V0, ZERO, 0x9D030814
9D030570  0040A821   ADDU S5, V0, ZERO
193:                    {
194:                       char *line;
195:                       char *group = NULL, *key = NULL, *value = NULL;
9D030574  AFA00010   SW ZERO, 16(SP)
196:                 
197:                       mySaveNeeded = true;
9D030578  24030001   ADDIU V1, ZERO, 1
9D03057C  AF8380F8   SW V1, -32520(GP)
198:                       while ((line = my_getline(config_file)))
9D0307DC  0F40C0FD   JAL .LFB14, my_getline, .LFE18
9D0307E0  02A02021   ADDU A0, S5, ZERO
9D0307E4  00408021   ADDU S0, V0, ZERO
9D0307E8  1440FF6D   BNE V0, ZERO, 0x9D0305A0
9D0307EC  AFA20014   SW V0, 20(SP)
199:                       {
200:                          char *s;
201:                          
202:                          if ('\n' == line[strlen(line) - 1])
9D0305A0  0F40F2B0   JAL strlen
9D0305A4  02002021   ADDU A0, S0, ZERO
9D0305A8  2446FFFF   ADDIU A2, V0, -1
9D0305AC  02063821   ADDU A3, S0, A2
9D0305B0  80E80000   LB T0, 0(A3)
9D0305B4  2409000A   ADDIU T1, ZERO, 10
9D0305B8  51090001   BEQL T0, T1, 0x9D0305C0
9D0305BC  A0E00000   SB ZERO, 0(A3)
203:                             line[strlen(line) - 1] = '\0';
204:                          
205:                          s = line;
9D0305C0  8FB10014   LW S1, 20(SP)
9D0305C4  24130023   ADDIU S3, ZERO, 35
206:                 
207:                          do 
208:                          {
209:                             /* eat up whitespace */
210:                             while (isspace(*s))
9D030580  3C129D04   LUI S2, -25340
9D030584  2652E52D   ADDIU S2, S2, -6867
9D0305C8  822A0000   LB T2, 0(S1)
9D0305CC  01525821   ADDU T3, T2, S2
9D0305D0  816C0000   LB T4, 0(T3)
9D0305D4  318D0088   ANDI T5, T4, 136
9D0305D8  55A0FFFB   BNEL T5, ZERO, 0x9D0305C8
9D0305DC  26310001   ADDIU S1, S1, 1
211:                                s++;
212:                 
213:                             switch (*s) 
9D0305E0  1153000D   BEQ T2, S3, 0x9D030618
9D0305E4  294E0024   SLTI T6, T2, 36
9D0305E8  11C00005   BEQ T6, ZERO, 0x9D030600
9D0305EC  240F003B   ADDIU T7, ZERO, 59
9D0305F0  15400028   BNE T2, ZERO, 0x9D030694
9D0305F4  02202021   ADDU A0, S1, ZERO
9D030600  114F0005   BEQ T2, T7, 0x9D030618
9D030604  2418005B   ADDIU T8, ZERO, 91
9D030608  11580005   BEQ T2, T8, 0x9D030620
9D03060C  8FA90010   LW T1, 16(SP)
214:                             {
215:                             case ';':
216:                             case '#':
217:                             case '\0':
218:                                *s = '\0';
9D0305F8  0B40C1F5   J 0x9D0307D4
9D0305FC  A2200000   SB ZERO, 0(S1)
9D030618  0B40C1F5   J 0x9D0307D4
9D03061C  A2200000   SB ZERO, 0(S1)
219:                                break;
220:                 
221:                             case '[':
222:                                if (group)
9D030620  11200004   BEQ T1, ZERO, 0x9D030634
9D030624  26240001   ADDIU A0, S1, 1
223:                                   free(group);
9D030628  0F40F31D   JAL _my_free
9D03062C  27A40010   ADDIU A0, SP, 16
224:                 
225:                                group = ++s;
9D030630  26240001   ADDIU A0, S1, 1
9D030634  AFA40010   SW A0, 16(SP)
226:                 
227:                                s = strchr(s, ']');
9D030638  0F40FBCB   JAL strchr
9D03063C  2405005D   ADDIU A1, ZERO, 93
228:                                if (NULL == s)
9D030640  54400008   BNEL V0, ZERO, 0x9D030664
9D030644  24510001   ADDIU S1, V0, 1
229:                                {
230:                                   log_printf("load_config: missing ']' after group\n");
9D030594  3C169D04   LUI S6, -25340
9D030598  0B40C1F7   J .LVL147
9D03059C  26D6DF60   ADDIU S6, S6, -8352
9D030648  0F410817   JAL log_printf
9D03064C  02C02021   ADDU A0, S6, ZERO
231:                                   s = group + strlen(group);
9D030650  8FB00010   LW S0, 16(SP)
9D030654  0F40F2B0   JAL strlen
9D030658  02002021   ADDU A0, S0, ZERO
9D03065C  0B40C19A   J 0x9D030668
9D030660  02028821   ADDU S1, S0, V0
232:                                }
233:                                else
234:                                {
235:                                   *s++ = '\0';
9D030664  A0400000   SB ZERO, 0(V0)
236:                                }
237:                 
238:                                if ((value = malloc(strlen(group) + 1)))
9D030668  0F40F2B0   JAL strlen
9D03066C  8FA40010   LW A0, 16(SP)
9D030670  0F40F30A   JAL _my_malloc
9D030674  24440001   ADDIU A0, V0, 1
9D030678  10400004   BEQ V0, ZERO, .LVL128
9D03067C  00408021   ADDU S0, V0, ZERO
239:                                {
240:                                   strcpy(value, group);
9D030680  00402021   ADDU A0, V0, ZERO
9D030684  0F40EFF7   JAL .LFE23, strcpy
9D030688  8FA50010   LW A1, 16(SP)
241:                                }
242:                                group = value;
9D03068C  0B40C1F2   J 0x9D0307C8
9D030690  AFB00010   SW S0, 16(SP)
243:                                break;
244:                 
245:                             default:
246:                                key = s;
247:                                s = strchr(s, '=');
9D030610  0B40C1A5   J 0x9D030694
9D030614  02202021   ADDU A0, S1, ZERO
9D030694  0F40FBCB   JAL strchr
9D030698  2405003D   ADDIU A1, ZERO, 61
248:                                if (NULL == s)
9D03069C  1440000B   BNE V0, ZERO, 0x9D0306CC
9D0306A0  24500001   ADDIU S0, V0, 1
249:                                {
250:                                   log_printf("load_config: missing '=' after key\n");
9D03058C  3C179D04   LUI S7, -25340
9D030590  26F7DF88   ADDIU S7, S7, -8312
9D0306A4  0F410817   JAL log_printf
9D0306A8  02E02021   ADDU A0, S7, ZERO
251:                                   s = key + strlen(key);
9D0306AC  0F40F2B0   JAL strlen
9D0306B0  02202021   ADDU A0, S1, ZERO
9D0306B4  02228021   ADDU S0, S1, V0
252:                                }
253:                                else
254:                                {
255:                                   *s++ = '\0';
9D0306CC  0B40C1AE   J 0x9D0306B8
9D0306D0  A0400000   SB ZERO, 0(V0)
256:                                }
257:                 
258:                                while (strlen(key) && isspace(key[strlen(key) - 1])) 
9D0306B8  82390000   LB T9, 0(S1)
9D0306BC  53200013   BEQL T9, ZERO, 0x9D03070C
9D0306C0  82080000   LB T0, 0(S0)
9D0306C4  0B40C1B8   J 0x9D0306E0
9D0306C8  00000000   NOP
9D0306D4  823F0000   LB RA, 0(S1)
9D0306D8  53E0000C   BEQL RA, ZERO, 0x9D03070C
9D0306DC  82080000   LB T0, 0(S0)
9D0306E0  0F40F2B0   JAL strlen
9D0306E4  02202021   ADDU A0, S1, ZERO
9D0306E8  2442FFFF   ADDIU V0, V0, -1
9D0306EC  02222821   ADDU A1, S1, V0
9D0306F0  80A30000   LB V1, 0(A1)
9D0306F4  00722021   ADDU A0, V1, S2
9D0306F8  80860000   LB A2, 0(A0)
9D0306FC  30C70088   ANDI A3, A2, 136
9D030700  54E0FFF4   BNEL A3, ZERO, 0x9D0306D4
9D030704  A0A00000   SB ZERO, 0(A1)
259:                                   key[strlen(key) - 1] = '\0';
260:                 
261:                                while (isspace(*s)) 
9D030708  82080000   LB T0, 0(S0)
9D03070C  01124821   ADDU T1, T0, S2
9D030710  812A0000   LB T2, 0(T1)
9D030714  314B0088   ANDI T3, T2, 136
9D030718  51600009   BEQL T3, ZERO, 0x9D030740
9D03071C  82180000   LB T8, 0(S0)
9D030724  820C0000   LB T4, 0(S0)
9D030728  01926821   ADDU T5, T4, S2
9D03072C  81AE0000   LB T6, 0(T5)
9D030730  31CF0088   ANDI T7, T6, 136
9D030734  55E0FFFB   BNEL T7, ZERO, 0x9D030724
9D030738  26100001   ADDIU S0, S0, 1
262:                                   s++;
9D030720  26100001   ADDIU S0, S0, 1
263:                                
264:                                while (strlen(s) && isspace(s[strlen(s) - 1])) 
9D03073C  82180000   LB T8, 0(S0)
9D030740  13000011   BEQ T8, ZERO, 0x9D030788
9D030744  8FBF0010   LW RA, 16(SP)
9D030748  0B40C1D7   J 0x9D03075C
9D03074C  00000000   NOP
9D030750  82070000   LB A3, 0(S0)
9D030754  10E0000C   BEQ A3, ZERO, 0x9D030788
9D030758  8FBF0010   LW RA, 16(SP)
9D03075C  0F40F2B0   JAL strlen
9D030760  02002021   ADDU A0, S0, ZERO
9D030764  2459FFFF   ADDIU T9, V0, -1
9D030768  02192821   ADDU A1, S0, T9
9D03076C  80A20000   LB V0, 0(A1)
9D030770  00521821   ADDU V1, V0, S2
9D030774  80640000   LB A0, 0(V1)
9D030778  30860088   ANDI A2, A0, 136
9D03077C  54C0FFF4   BNEL A2, ZERO, 0x9D030750
9D030780  A0A00000   SB ZERO, 0(A1)
265:                                   s[strlen(s) - 1]='\0';
266:                 
267:                                {
268:                                   myvar_t *var = my_create(group ? group : "", key, s);
9D030588  3C149D04   LUI S4, -25340
9D030784  8FBF0010   LW RA, 16(SP)
9D030788  2684DF04   ADDIU A0, S4, -8444
9D03078C  03FF200B   MOVN A0, RA, RA
9D030790  02202821   ADDU A1, S1, ZERO
9D030794  0F40BFAD   JAL .LFB9, my_create, .LFE8
9D030798  02003021   ADDU A2, S0, ZERO
269:                                   if (NULL == var)
9D03079C  14400005   BNE V0, ZERO, 0x9D0307B4
9D0307A0  3C089D04   LUI T0, -25340
270:                                   {
271:                                      log_printf("load_config: my_create failed\n");
9D0307A4  0F410817   JAL log_printf
9D0307A8  2504DFAC   ADDIU A0, T0, -8276
272:                                      return -1;
9D0307AC  0B40C206   J 0x9D030818
9D0307B0  2402FFFF   ADDIU V0, ZERO, -1
273:                                   }
274:                 
275:                                   my_insert(var);
9D0307B4  0F40BFFC   JAL .LFB11, my_insert, .LFE13
9D0307B8  00402021   ADDU A0, V0, ZERO
276:                                }
277:                                s += strlen(s);
9D0307BC  0F40F2B0   JAL strlen
9D0307C0  02002021   ADDU A0, S0, ZERO
9D0307C4  02028821   ADDU S1, S0, V0
278:                             }
279:                          } while (*s);
9D0307C8  822A0000   LB T2, 0(S1)
9D0307CC  1540FF80   BNE T2, ZERO, 0x9D0305D0
9D0307D0  01525821   ADDU T3, T2, S2
280:                 
281:                          free(line);
9D0307D4  0F40F31D   JAL _my_free
9D0307D8  27A40014   ADDIU A0, SP, 20
282:                       }
283:                 
284:                       if (group) 
9D0307F0  8FA40010   LW A0, 16(SP)
9D0307F4  10800003   BEQ A0, ZERO, .LVL149
9D0307F8  00000000   NOP
285:                          free(group);
9D0307FC  0F40F31D   JAL _my_free
9D030800  27A40010   ADDIU A0, SP, 16
286:                 
287:                       fclose(config_file);
9D030804  0F4102B5   JAL .Letext0, .LFE1, fclose
9D030808  02A02021   ADDU A0, S5, ZERO
288:                    }
289:                 
290:                    return 0;
9D03080C  0B40C206   J 0x9D030818
9D030810  00001021   ADDU V0, ZERO, ZERO
9D030814  00001021   ADDU V0, ZERO, ZERO
291:                 }
292:                 
293:                 /* save_config saves the current configuration to disk.*/
294:                 static int save_config(char *filename)
295:                 {
296:                    FILE *config_file;
297:                    char *group = "";
9D030360  3C059D04   LUI A1, -25340
298:                 
299:                    config_file = fopen(filename, "w");
9D03036C  3C079D04   LUI A3, -25340
300:                    if (NULL == config_file)
9D030378  14400006   BNE V0, ZERO, 0x9D030394
301:                    {
302:                       log_printf("save_config failed\n");
9D030380  3C0A9D04   LUI T2, -25340
303:                       return -1;
304:                    }
305:                 
306:                    fprintf(config_file, ";; " APP_STRING " " APP_VERSION "\n");
9D030394  3C089D04   LUI T0, -25340
307:                    fprintf(config_file, ";; NOTE: comments are not preserved.\n");
9D0303AC  3C099D04   LUI T1, -25340
308:                    my_save(config_file, myVars, &group);
9D0303C4  02002021   ADDU A0, S0, ZERO
309:                    fclose(config_file);
9D0303D4  0F4102B5   JAL .Letext0, .LFE1, fclose
9D0303D8  02002021   ADDU A0, S0, ZERO
310:                 
311:                    return 0;
312:                 }
313:                 
314:                 static bool open_config(void)
315:                 {
9D030530  27BDFFC0   ADDIU SP, SP, -64
9D030534  AFBF003C   SW RA, 60(SP)
9D030538  AFB70038   SW S7, 56(SP)
9D03053C  AFB60034   SW S6, 52(SP)
9D030540  AFB50030   SW S5, 48(SP)
9D030544  AFB4002C   SW S4, 44(SP)
9D030548  AFB30028   SW S3, 40(SP)
9D03054C  AFB20024   SW S2, 36(SP)
9D030550  AFB10020   SW S1, 32(SP)
9D030554  AFB0001C   SW S0, 28(SP)
316:                    return load_config(config.filename);
317:                 }
9D030818  8FBF003C   LW RA, 60(SP)
9D03081C  8FB70038   LW S7, 56(SP)
9D030820  8FB60034   LW S6, 52(SP)
9D030824  8FB50030   LW S5, 48(SP)
9D030828  8FB4002C   LW S4, 44(SP)
9D03082C  8FB30028   LW S3, 40(SP)
9D030830  8FB20024   LW S2, 36(SP)
9D030834  8FB10020   LW S1, 32(SP)
9D030838  8FB0001C   LW S0, 28(SP)
9D03083C  03E00008   JR RA
9D030840  27BD0040   ADDIU SP, SP, 64
318:                 
319:                 static void close_config(void)
320:                 {
9D030340  27BDFFE0   ADDIU SP, SP, -32
9D030344  AFBF001C   SW RA, 28(SP)
9D030348  AFB00018   SW S0, 24(SP)
321:                    if (true == mySaveNeeded) 
9D03034C  24020001   ADDIU V0, ZERO, 1
9D030350  8F8380F8   LW V1, -32520(GP)
9D030354  14620021   BNE V1, V0, .LVL93, .LBE5, .LBE4
9D030358  3C04A001   LUI A0, -24575
322:                    {
323:                       save_config(config.filename);
9D03035C  8C845888   LW A0, 22664(A0)
324:                    }
325:                 
326:                    my_cleanup(myVars);
9D0303DC  0F40BFEE   JAL .LFB13, my_cleanup, .LFE9
9D0303E0  8F8480FC   LW A0, -32516(GP)
327:                 }
9D0303E4  8FBF001C   LW RA, 28(SP)
9D0303E8  8FB00018   LW S0, 24(SP)
9D0303EC  03E00008   JR RA
9D0303F0  27BD0020   ADDIU SP, SP, 32
328:                 
329:                 static void write_int(const char *group, const char *key, int value)
330:                 {
9D0301BC  27BDFFC8   ADDIU SP, SP, -56
9D0301C0  AFBF0034   SW RA, 52(SP)
9D0301C4  AFB10030   SW S1, 48(SP)
9D0301C8  AFB0002C   SW S0, 44(SP)
9D0301CC  00808821   ADDU S1, A0, ZERO
9D0301D0  00A08021   ADDU S0, A1, ZERO
331:                    char buf[24];
332:                    static myvar_t *var;
333:                 
334:                    sprintf(buf, "%d", value);
9D0301D4  27A40010   ADDIU A0, SP, 16
9D0301D8  3C059D04   LUI A1, -25340
9D0301DC  0F4104E0   JAL _sprintf_cdnopuxX, _sprintf_cdnopsuxX
9D0301E0  24A5DEDC   ADDIU A1, A1, -8484
335:                    buf[sizeof(buf) - 1] = '\0';
9D0301E4  A3A00027   SB ZERO, 39(SP)
336:                 
337:                    var = my_create(group, key, buf);
9D0301E8  02202021   ADDU A0, S1, ZERO
9D0301EC  02002821   ADDU A1, S0, ZERO
9D0301F0  0F40BFAD   JAL .LFB9, my_create, .LFE8
9D0301F4  27A60010   ADDIU A2, SP, 16
338:                    if (NULL == var)
9D0301F8  14400005   BNE V0, ZERO, 0x9D030210
9D0301FC  3C049D04   LUI A0, -25340
339:                    {
340:                       log_printf("write_int failed\n");
9D030200  0F410817   JAL log_printf
9D030204  2484DEE0   ADDIU A0, A0, -8480
341:                       return;
342:                    }
343:                 
344:                    my_insert(var);
9D030210  0F40BFFC   JAL .LFB11, my_insert, .LFE13
9D030214  00402021   ADDU A0, V0, ZERO
345:                    mySaveNeeded = true;
9D030218  24020001   ADDIU V0, ZERO, 1
9D03021C  AF8280F8   SW V0, -32520(GP)
346:                 }
9D030208  0B40C089   J 0x9D030224
9D03020C  8FBF0034   LW RA, 52(SP)
9D030220  8FBF0034   LW RA, 52(SP)
9D030224  8FB10030   LW S1, 48(SP)
9D030228  8FB0002C   LW S0, 44(SP)
9D03022C  03E00008   JR RA
9D030230  27BD0038   ADDIU SP, SP, 56
347:                 
348:                 /* read_int loads an integer from the configuration into "value"
349:                 **
350:                 ** If the specified "key" does not exist, the "def"ault is returned
351:                 */
352:                 static int read_int(const char *group, const char *key, int def)
353:                 {
9D030234  27BDFFE0   ADDIU SP, SP, -32
9D030238  AFBF001C   SW RA, 28(SP)
9D03023C  AFB20018   SW S2, 24(SP)
9D030240  AFB10014   SW S1, 20(SP)
9D030244  AFB00010   SW S0, 16(SP)
9D030248  00809021   ADDU S2, A0, ZERO
9D03024C  00A08821   ADDU S1, A1, ZERO
354:                    static myvar_t *var;
355:                 
356:                    var = my_lookup(group, key);
9D030250  0F40C036   JAL .LFB10, my_lookup, .LFE21
9D030254  00C08021   ADDU S0, A2, ZERO
357:                    if (NULL == var)
9D030258  54400007   BNEL V0, ZERO, 0x9D030278
9D03025C  8C440010   LW A0, 16(V0)
358:                    {
359:                       write_int(group, key, def);
9D030260  02402021   ADDU A0, S2, ZERO
9D030264  02202821   ADDU A1, S1, ZERO
9D030268  0F40C06F   JAL .LFB19, write_int, .LFE22
9D03026C  02003021   ADDU A2, S0, ZERO
360:                       
361:                       return def;
9D030270  0B40C0A1   J .LVL74
9D030274  02001021   ADDU V0, S0, ZERO
362:                    }
363:                 
364:                    return strtoul(var->value, 0, 0);
9D030278  00002821   ADDU A1, ZERO, ZERO
9D03027C  0F40E872   JAL strtoul
9D030280  00003021   ADDU A2, ZERO, ZERO
365:                 }
9D030284  8FBF001C   LW RA, 28(SP)
9D030288  8FB20018   LW S2, 24(SP)
9D03028C  8FB10014   LW S1, 20(SP)
9D030290  8FB00010   LW S0, 16(SP)
9D030294  03E00008   JR RA
9D030298  27BD0020   ADDIU SP, SP, 32
366:                 
367:                 static void write_string(const char *group, const char *key, const char *value)
368:                 {
9D030094  27BDFFE8   ADDIU SP, SP, -24
9D030098  AFBF0014   SW RA, 20(SP)
369:                    static myvar_t *var;
370:                 
371:                    var = my_create(group, key, value);
9D03009C  0F40BFAD   JAL .LFB9, my_create, .LFE8
9D0300A0  00000000   NOP
372:                    if (NULL == var)
9D0300A4  14400005   BNE V0, ZERO, 0x9D0300BC
9D0300A8  3C049D04   LUI A0, -25340
373:                    {
374:                       log_printf("write_string failed\n");
9D0300AC  0F410817   JAL log_printf
9D0300B0  2484DEC4   ADDIU A0, A0, -8508
375:                       return;
9D0300B4  0B40C034   J 0x9D0300D0
9D0300B8  8FBF0014   LW RA, 20(SP)
376:                    }
377:                 
378:                    my_insert(var);
9D0300BC  0F40BFFC   JAL .LFB11, my_insert, .LFE13
9D0300C0  00402021   ADDU A0, V0, ZERO
379:                    mySaveNeeded = true;
9D0300C4  24020001   ADDIU V0, ZERO, 1
9D0300C8  AF8280F8   SW V0, -32520(GP)
380:                 }
9D0300CC  8FBF0014   LW RA, 20(SP)
9D0300D0  03E00008   JR RA
9D0300D4  27BD0018   ADDIU SP, SP, 24
381:                 
382:                 /* read_string copies a string from the configuration into "value"
383:                 **
384:                 ** If the specified "key" does not exist, the "def"ault is returned
385:                 */
386:                 static const char *read_string(const char *group, const char *key, const char *def)
387:                 {
9D030158  27BDFFE0   ADDIU SP, SP, -32
9D03015C  AFBF001C   SW RA, 28(SP)
9D030160  AFB20018   SW S2, 24(SP)
9D030164  AFB10014   SW S1, 20(SP)
9D030168  AFB00010   SW S0, 16(SP)
9D03016C  00809021   ADDU S2, A0, ZERO
9D030170  00A08821   ADDU S1, A1, ZERO
388:                    static myvar_t *var;
389:                 
390:                    var = my_lookup(group, key);
9D030174  0F40C036   JAL .LFB10, my_lookup, .LFE21
9D030178  00C08021   ADDU S0, A2, ZERO
391:                    if (NULL == var)
9D03017C  54400009   BNEL V0, ZERO, 0x9D0301A4
9D030180  8C420010   LW V0, 16(V0)
392:                    {
393:                       if (def != NULL)
9D030184  12000006   BEQ S0, ZERO, 0x9D0301A0
9D030188  02402021   ADDU A0, S2, ZERO
394:                          write_string(group, key, def);
9D03018C  02202821   ADDU A1, S1, ZERO
9D030190  0F40C025   JAL .LFB21, write_string, .LFE11
9D030194  02003021   ADDU A2, S0, ZERO
395:                 
396:                       return def;
9D030198  0B40C069   J 0x9D0301A4
9D03019C  02001021   ADDU V0, S0, ZERO
9D0301A0  02001021   ADDU V0, S0, ZERO
397:                    }
398:                 
399:                    return var->value;
400:                 }
9D0301A4  8FBF001C   LW RA, 28(SP)
9D0301A8  8FB20018   LW S2, 24(SP)
9D0301AC  8FB10014   LW S1, 20(SP)
9D0301B0  8FB00010   LW S0, 16(SP)
9D0301B4  03E00008   JR RA
9D0301B8  27BD0020   ADDIU SP, SP, 32
401:                 
402:                 /* interface */
403:                 config_t config =
404:                 {
405:                    open_config,
406:                    close_config,
407:                    read_int,
408:                    read_string,
409:                    write_int,
410:                    write_string,
411:                    CONFIG_FILE
412:                 };
413:                 
414:                 /*
415:                 ** $Log: config.c,v $
416:                 ** Revision 1.2  2001/04/27 14:37:11  neil
417:                 ** wheeee
418:                 **
419:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
420:                 ** initial
421:                 **
422:                 ** Revision 1.14  2000/11/05 06:23:10  matt
423:                 ** realloc was incompatible with memguard
424:                 **
425:                 ** Revision 1.13  2000/10/10 13:58:13  matt
426:                 ** stroustrup squeezing his way in the door
427:                 **
428:                 ** Revision 1.12  2000/09/20 01:13:28  matt
429:                 ** damn tabs
430:                 **
431:                 ** Revision 1.11  2000/08/04 12:41:04  neil
432:                 ** current not a bug
433:                 **
434:                 ** Revision 1.10  2000/07/31 04:28:46  matt
435:                 ** one million cleanups
436:                 **
437:                 ** Revision 1.9  2000/07/24 04:30:42  matt
438:                 ** slight cleanup
439:                 **
440:                 ** Revision 1.8  2000/07/23 15:16:08  matt
441:                 ** changed strcasecmp to stricmp
442:                 **
443:                 ** Revision 1.7  2000/07/19 15:58:55  neil
444:                 ** config file now configurable (ha)
445:                 **
446:                 ** Revision 1.6  2000/07/18 03:28:32  matt
447:                 ** help me!  I'm a complete mess!
448:                 **
449:                 ** Revision 1.5  2000/07/12 11:03:08  neil
450:                 ** Always write a config, even if no defaults are changed
451:                 **
452:                 ** Revision 1.4  2000/07/11 15:09:30  matt
453:                 ** suppressed all warnings
454:                 **
455:                 ** Revision 1.3  2000/07/11 14:59:27  matt
456:                 ** minor cosmetics.. =)
457:                 **
458:                 ** Revision 1.2  2000/07/11 13:35:38  bsittler
459:                 ** Changed the config API, implemented config file "nofrendo.cfg". The
460:                 ** GGI drivers use the group [GGI]. Visual= and Mode= keys are understood.
461:                 **
462:                 ** Revision 1.1  2000/07/11 09:21:10  bsittler
463:                 ** This is a skeletal configuration system.
464:                 **
465:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/nofrendo/bitmap.c  ----------------------------------
1:                   /*
2:                   ** Nofrendo (c) 1998-2000 Matthew Conte (matt@conte.com)
3:                   **
4:                   **
5:                   ** This program is free software; you can redistribute it and/or
6:                   ** modify it under the terms of version 2 of the GNU Library General 
7:                   ** Public License as published by the Free Software Foundation.
8:                   **
9:                   ** This program is distributed in the hope that it will be useful, 
10:                  ** but WITHOUT ANY WARRANTY; without even the implied warranty of
11:                  ** MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU 
12:                  ** Library General Public License for more details.  To obtain a 
13:                  ** copy of the GNU Library General Public License, write to the Free 
14:                  ** Software Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.
15:                  **
16:                  ** Any permitted reproduction of these routines, in whole or in part,
17:                  ** must bear this legend.
18:                  **
19:                  **
20:                  ** bitmap.c
21:                  **
22:                  ** Bitmap object manipulation routines
23:                  ** $Id: bitmap.c,v 1.2 2001/04/27 14:37:11 neil Exp $
24:                  */
25:                  
26:                  #include <stdio.h>
27:                  #include <string.h>
28:                  #include <noftypes.h>
29:                  #include <bitmap.h>
30:                  
31:                  void bmp_clear(const bitmap_t *bitmap, uint8 color)
32:                  {
9D0383EC  27BDFFE8   ADDIU SP, SP, -24
9D0383F0  AFBF0014   SW RA, 20(SP)
33:                     memset(bitmap->data, color, bitmap->pitch * bitmap->height);
9D0383F4  8C860008   LW A2, 8(A0)
9D0383F8  8C820004   LW V0, 4(A0)
9D0383FC  8C840010   LW A0, 16(A0)
9D038400  0F4100B4   JAL .Letext0, .LFE0, memset
9D038404  70C23002   MUL A2, A2, V0
34:                  }
9D038408  8FBF0014   LW RA, 20(SP)
9D03840C  03E00008   JR RA
9D038410  27BD0018   ADDIU SP, SP, 24
35:                  
36:                  static bitmap_t *_make_bitmap(uint8 *data_addr, bool hw, int width, 
37:                                                int height, int pitch, int overdraw)
38:                  {
9D0381D0  27BDFFD8   ADDIU SP, SP, -40
9D0381D4  AFBF0024   SW RA, 36(SP)
9D0381D8  AFB40020   SW S4, 32(SP)
9D0381DC  AFB3001C   SW S3, 28(SP)
9D0381E0  AFB20018   SW S2, 24(SP)
9D0381E4  AFB10014   SW S1, 20(SP)
9D0381E8  AFB00010   SW S0, 16(SP)
9D0381EC  00808821   ADDU S1, A0, ZERO
39:                     bitmap_t *bitmap;
40:                     int i;
41:                  
42:                     /* quick safety check */
43:                     if (NULL == data_addr)
9D0381F0  1080003F   BEQ A0, ZERO, 0x9D0382F0
9D0381F4  8FB2003C   LW S2, 60(SP)
9D0381F8  00A09821   ADDU S3, A1, ZERO
9D0381FC  00C0A021   ADDU S4, A2, ZERO
9D038200  00E08021   ADDU S0, A3, ZERO
44:                        return NULL;
9D0382F0  0B40E0BF   J 0x9D0382FC
9D0382F4  00001021   ADDU V0, ZERO, ZERO
45:                  
46:                     /* Make sure to add in space for line pointers */
47:                     bitmap = malloc(sizeof(bitmap_t) + (sizeof(uint8 *) * height));
9D038204  24E40005   ADDIU A0, A3, 5
9D038208  0F40F30A   JAL _my_malloc
9D03820C  00042080   SLL A0, A0, 2
48:                     if (NULL == bitmap)
9D038210  10400039   BEQ V0, ZERO, 0x9D0382F8
9D038214  00122840   SLL A1, S2, 1
49:                        return NULL;
9D0382F8  00001021   ADDU V0, ZERO, ZERO
50:                  
51:                     bitmap->hardware = hw;
9D038218  AC53000C   SW S3, 12(V0)
52:                     bitmap->height = height;
9D03821C  AC500004   SW S0, 4(V0)
53:                     bitmap->width = width;
9D038220  AC540000   SW S4, 0(V0)
54:                     bitmap->data = data_addr;
9D038224  AC510010   SW S1, 16(V0)
55:                     bitmap->pitch = pitch + (overdraw * 2);
9D038228  8FA30038   LW V1, 56(SP)
9D03822C  00A33021   ADDU A2, A1, V1
56:                  
57:                     /* Set up line pointers */
58:                     /* we want to make some 32-bit aligned adjustment
59:                     ** if we haven't been given a hardware bitmap
60:                     */
61:                     if (false == bitmap->hardware)
9D038230  16600009   BNE S3, ZERO, 0x9D038258
9D038234  AC460008   SW A2, 8(V0)
62:                     {
63:                        bitmap->pitch = (bitmap->pitch + 3) & ~3;
9D038238  24C80003   ADDIU T0, A2, 3
9D03823C  7C080804   INS T0, ZERO, 0, 2
9D038240  AC480008   SW T0, 8(V0)
64:                        bitmap->line[0] = (uint8 *) (((uint32) bitmap->data + overdraw + 3) & ~3);
9D038244  26490003   ADDIU T1, S2, 3
9D038248  02295021   ADDU T2, S1, T1
9D03824C  7C0A0804   INS T2, ZERO, 0, 2
9D038250  0B40E098   J 0x9D038260
9D038254  AC4A0014   SW T2, 20(V0)
65:                     }
66:                     else
67:                     { 
68:                        bitmap->line[0] = bitmap->data + overdraw;
9D038258  02323821   ADDU A3, S1, S2
9D03825C  AC470014   SW A3, 20(V0)
69:                     }
70:                  
71:                     for (i = 1; i < height; i++)
9D038260  2A0B0002   SLTI T3, S0, 2
9D038264  15600025   BNE T3, ZERO, 0x9D0382FC
9D038268  260EFFFE   ADDIU T6, S0, -2
9D038280  24040002   ADDIU A0, ZERO, 2
9D038284  14900025   BNE A0, S0, 0x9D03831C
9D038288  24430004   ADDIU V1, V0, 4
9D0382DC  24840008   ADDIU A0, A0, 8
9D0382E0  1490FFEC   BNE A0, S0, 0x9D038294
9D0382E4  24630020   ADDIU V1, V1, 32
9D038360  24840001   ADDIU A0, A0, 1
9D038364  24630004   ADDIU V1, V1, 4
9D038374  24840001   ADDIU A0, A0, 1
9D038378  24630004   ADDIU V1, V1, 4
9D038388  24840001   ADDIU A0, A0, 1
9D03838C  24630004   ADDIU V1, V1, 4
9D03839C  24840001   ADDIU A0, A0, 1
9D0383A0  24630004   ADDIU V1, V1, 4
9D0383B0  24840001   ADDIU A0, A0, 1
9D0383B4  24630004   ADDIU V1, V1, 4
9D0383C4  24840001   ADDIU A0, A0, 1
9D0383C8  24630004   ADDIU V1, V1, 4
9D0383D8  24840001   ADDIU A0, A0, 1
9D0383DC  1490FFAD   BNE A0, S0, 0x9D038294
9D0383E0  24630004   ADDIU V1, V1, 4
72:                        bitmap->line[i] = bitmap->line[i - 1] + bitmap->pitch;
9D03826C  8C4C0008   LW T4, 8(V0)
9D038270  31CF0007   ANDI T7, T6, 7
9D038274  8C580014   LW T8, 20(V0)
9D038278  030CC821   ADDU T9, T8, T4
9D03827C  AC590018   SW T9, 24(V0)
9D038294  8C730014   LW S3, 20(V1)
9D038298  026CA021   ADDU S4, S3, T4
9D03829C  AC740018   SW S4, 24(V1)
9D0382A0  028C2821   ADDU A1, S4, T4
9D0382A4  AC65001C   SW A1, 28(V1)
9D0382A8  8C66001C   LW A2, 28(V1)
9D0382AC  00CC3821   ADDU A3, A2, T4
9D0382B0  AC670020   SW A3, 32(V1)
9D0382B4  00EC4021   ADDU T0, A3, T4
9D0382B8  AC680024   SW T0, 36(V1)
9D0382BC  010C4821   ADDU T1, T0, T4
9D0382C0  AC690028   SW T1, 40(V1)
9D0382C4  012C5021   ADDU T2, T1, T4
9D0382C8  AC6A002C   SW T2, 44(V1)
9D0382CC  014C5821   ADDU T3, T2, T4
9D0382D0  AC6B0030   SW T3, 48(V1)
9D0382D4  016C6821   ADDU T5, T3, T4
9D0382D8  AC6D0034   SW T5, 52(V1)
9D03834C  51E50007   BEQL T7, A1, 0x9D03836C
9D038350  8C680014   LW T0, 20(V1)
9D038354  8C660014   LW A2, 20(V1)
9D038358  00CC3821   ADDU A3, A2, T4
9D03835C  AC670018   SW A3, 24(V1)
9D038368  8C680014   LW T0, 20(V1)
9D03836C  010C4821   ADDU T1, T0, T4
9D038370  AC690018   SW T1, 24(V1)
9D03837C  8C6A0014   LW T2, 20(V1)
9D038380  014C5821   ADDU T3, T2, T4
9D038384  AC6B0018   SW T3, 24(V1)
9D038390  8C6D0014   LW T5, 20(V1)
9D038394  01AC7021   ADDU T6, T5, T4
9D038398  AC6E0018   SW T6, 24(V1)
9D0383A4  8C6F0014   LW T7, 20(V1)
9D0383A8  01ECC021   ADDU T8, T7, T4
9D0383AC  AC780018   SW T8, 24(V1)
9D0383B8  8C790014   LW T9, 20(V1)
9D0383BC  032CF821   ADDU RA, T9, T4
9D0383C0  AC7F0018   SW RA, 24(V1)
9D0383CC  8C710014   LW S1, 20(V1)
9D0383D0  022C9021   ADDU S2, S1, T4
9D0383D4  AC720018   SW S2, 24(V1)
73:                  
74:                     return bitmap;
75:                  }
9D03828C  0B40E0C0   J 0x9D038300
9D038290  8FBF0024   LW RA, 36(SP)
9D0382E8  0B40E0C0   J 0x9D038300
9D0382EC  8FBF0024   LW RA, 36(SP)
9D0382FC  8FBF0024   LW RA, 36(SP)
9D038300  8FB40020   LW S4, 32(SP)
9D038304  8FB3001C   LW S3, 28(SP)
9D038308  8FB20018   LW S2, 24(SP)
9D03830C  8FB10014   LW S1, 20(SP)
9D038310  8FB00010   LW S0, 16(SP)
9D038314  03E00008   JR RA
9D038318  27BD0028   ADDIU SP, SP, 40
9D03831C  11E0FFDD   BEQ T7, ZERO, 0x9D038294
9D038320  241F0001   ADDIU RA, ZERO, 1
9D038324  11FF0029   BEQ T7, RA, 0x9D0383CC
9D038328  24110002   ADDIU S1, ZERO, 2
9D03832C  11F10022   BEQ T7, S1, 0x9D0383B8
9D038330  24120003   ADDIU S2, ZERO, 3
9D038334  11F2001B   BEQ T7, S2, 0x9D0383A4
9D038338  24130004   ADDIU S3, ZERO, 4
9D03833C  11F30014   BEQ T7, S3, 0x9D038390
9D038340  24140005   ADDIU S4, ZERO, 5
9D038344  11F4000D   BEQ T7, S4, 0x9D03837C
9D038348  24050006   ADDIU A1, ZERO, 6
9D0383E4  0B40E0C0   J 0x9D038300
9D0383E8  8FBF0024   LW RA, 36(SP)
76:                  
77:                  /* Allocate and initialize a bitmap structure */
78:                  bitmap_t *bmp_create(int width, int height, int overdraw)
79:                  {
9D038414  27BDFFD8   ADDIU SP, SP, -40
9D038418  AFBF0024   SW RA, 36(SP)
9D03841C  AFB20020   SW S2, 32(SP)
9D038420  AFB1001C   SW S1, 28(SP)
9D038424  AFB00018   SW S0, 24(SP)
9D038428  00808021   ADDU S0, A0, ZERO
9D03842C  00A08821   ADDU S1, A1, ZERO
9D038430  00C09021   ADDU S2, A2, ZERO
80:                     uint8 *addr;
81:                     int pitch;
82:                  
83:                     pitch = width + (overdraw * 2); /* left and right */
9D038434  00062040   SLL A0, A2, 1
9D038438  00901021   ADDU V0, A0, S0
84:                     addr = malloc((pitch * height) + 3); /* add max 32-bit aligned adjustment */
9D03843C  70451802   MUL V1, V0, A1
9D038440  0F40F30A   JAL _my_malloc
9D038444  24640003   ADDIU A0, V1, 3
85:                     if (NULL == addr)
9D038448  10400009   BEQ V0, ZERO, 0x9D038470
9D03844C  00402021   ADDU A0, V0, ZERO
86:                        return NULL;
9D038470  00001021   ADDU V0, ZERO, ZERO
87:                  
88:                     return _make_bitmap(addr, false, width, height, width, overdraw);
9D038450  AFB00010   SW S0, 16(SP)
9D038454  AFB20014   SW S2, 20(SP)
9D038458  00002821   ADDU A1, ZERO, ZERO
9D03845C  02003021   ADDU A2, S0, ZERO
9D038460  0F40E074   JAL .LFB6, _make_bitmap, .Ltext0, .LFE23
9D038464  02203821   ADDU A3, S1, ZERO
9D038468  0B40E11E   J 0x9D038478
9D03846C  8FBF0024   LW RA, 36(SP)
89:                  }
9D038474  8FBF0024   LW RA, 36(SP)
9D038478  8FB20020   LW S2, 32(SP)
9D03847C  8FB1001C   LW S1, 28(SP)
9D038480  8FB00018   LW S0, 24(SP)
9D038484  03E00008   JR RA
9D038488  27BD0028   ADDIU SP, SP, 40
90:                  
91:                  /* allocate and initialize a hardware bitmap */
92:                  bitmap_t *bmp_createhw(uint8 *addr, int width, int height, int pitch)
93:                  {
9D03848C  27BDFFE0   ADDIU SP, SP, -32
9D038490  AFBF001C   SW RA, 28(SP)
9D038494  00A01821   ADDU V1, A1, ZERO
9D038498  00C01021   ADDU V0, A2, ZERO
94:                     return _make_bitmap(addr, true, width, height, pitch, 0); /* zero overdraw */
9D03849C  AFA70010   SW A3, 16(SP)
9D0384A0  AFA00014   SW ZERO, 20(SP)
9D0384A4  24050001   ADDIU A1, ZERO, 1
9D0384A8  00603021   ADDU A2, V1, ZERO
9D0384AC  0F40E074   JAL .LFB6, _make_bitmap, .Ltext0, .LFE23
9D0384B0  00403821   ADDU A3, V0, ZERO
95:                  }
9D0384B4  8FBF001C   LW RA, 28(SP)
9D0384B8  03E00008   JR RA
9D0384BC  27BD0020   ADDIU SP, SP, 32
96:                  
97:                  /* Deallocate space for a bitmap structure */
98:                  void bmp_destroy(bitmap_t **bitmap)
99:                  {
9D0384C0  27BDFFE8   ADDIU SP, SP, -24
9D0384C4  AFBF0014   SW RA, 20(SP)
9D0384C8  AFB00010   SW S0, 16(SP)
9D0384CC  00808021   ADDU S0, A0, ZERO
100:                    if (*bitmap)
9D0384D0  8C840000   LW A0, 0(A0)
9D0384D4  5080000D   BEQL A0, ZERO, 0x9D03850C
9D0384D8  8FBF0014   LW RA, 20(SP)
101:                    {
102:                       if ((*bitmap)->data && false == (*bitmap)->hardware)
9D0384DC  8C830010   LW V1, 16(A0)
9D0384E0  10600006   BEQ V1, ZERO, .LVL35
9D0384E4  00000000   NOP
9D0384E8  8C82000C   LW V0, 12(A0)
9D0384EC  14400003   BNE V0, ZERO, .LVL35
9D0384F0  00000000   NOP
103:                          free((*bitmap)->data);
9D0384F4  0F40F31D   JAL _my_free
9D0384F8  24840010   ADDIU A0, A0, 16
104:                       free(*bitmap);
9D0384FC  0F40F31D   JAL _my_free
9D038500  02002021   ADDU A0, S0, ZERO
105:                       *bitmap = NULL;
9D038504  AE000000   SW ZERO, 0(S0)
106:                    }
107:                 }
9D038508  8FBF0014   LW RA, 20(SP)
9D03850C  8FB00010   LW S0, 16(SP)
9D038510  03E00008   JR RA
9D038514  27BD0018   ADDIU SP, SP, 24
108:                 
109:                 /*
110:                 ** $Log: bitmap.c,v $
111:                 ** Revision 1.2  2001/04/27 14:37:11  neil
112:                 ** wheeee
113:                 **
114:                 ** Revision 1.1.1.1  2001/04/27 07:03:54  neil
115:                 ** initial
116:                 **
117:                 ** Revision 1.16  2000/11/05 16:37:18  matt
118:                 ** rolled rgb.h into bitmap.h
119:                 **
120:                 ** Revision 1.15  2000/10/10 13:58:13  matt
121:                 ** stroustrup squeezing his way in the door
122:                 **
123:                 ** Revision 1.14  2000/09/18 02:06:48  matt
124:                 ** -pedantic is your friend
125:                 **
126:                 ** Revision 1.13  2000/08/13 13:16:30  matt
127:                 ** bugfix for alignment adjustment
128:                 **
129:                 ** Revision 1.12  2000/07/24 04:31:43  matt
130:                 ** pitch/data area on non-hw bitmaps get padded to 32-bit boundaries
131:                 **
132:                 ** Revision 1.11  2000/07/17 01:52:27  matt
133:                 ** made sure last line of all source files is a newline
134:                 **
135:                 ** Revision 1.10  2000/07/09 14:43:01  matt
136:                 ** pitch is now configurable for bmp_createhw()
137:                 **
138:                 ** Revision 1.9  2000/07/06 17:55:57  matt
139:                 ** two big bugs fixed
140:                 **
141:                 ** Revision 1.8  2000/07/06 17:38:11  matt
142:                 ** replaced missing string.h include
143:                 **
144:                 ** Revision 1.7  2000/07/06 16:46:57  matt
145:                 ** added bmp_clear() routine
146:                 **
147:                 ** Revision 1.6  2000/06/26 04:56:24  matt
148:                 ** minor cleanup
149:                 **
150:                 ** Revision 1.5  2000/06/09 15:12:25  matt
151:                 ** initial revision
152:                 **
153:                 */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/main.c  ---------------------------------------------
1:                   #include <xc.h>
2:                   #include "badge_settings.h"
3:                   #include "badge.h"
4:                   #include "hw.h"
5:                   #include "post.h"
6:                   #include "nofrendo/nofrendo.h"
7:                   
8:                   int16_t main(void)
9:                   {
9D041230  27BDFFE0   ADDIU SP, SP, -32
9D041234  AFBF001C   SW RA, 28(SP)
10:                      int i;
11:                  	hw_init();
9D041238  0F409CFC   JAL hw_init
9D04123C  AFB00018   SW S0, 24(SP)
12:                  	badge_init();
9D041240  0F407311   JAL badge_init
9D041244  3C1000FF   LUI S0, 255
13:                      nofrendo_main(0, NULL);
9D041248  00002021   ADDU A0, ZERO, ZERO
9D04124C  0F40E71A   JAL nofrendo_main
9D041250  00002821   ADDU A1, ZERO, ZERO
14:                  	//if (KEY_BRK==0) post();
15:                  	//if ((SHOW_SPLASH)&(K_SHIFTR==1)) boot_animation();
16:                  	//badge_menu();
17:                  	while (1)
18:                      {
19:                          tft_fill_area(0,0,320,240,CIPHER_BACKGROUND);
9D041258  AFA00010   SW ZERO, 16(SP)
9D04125C  00002021   ADDU A0, ZERO, ZERO
9D041260  00002821   ADDU A1, ZERO, ZERO
9D041264  24060140   ADDIU A2, ZERO, 320
9D041268  0F406203   JAL tft_fill_area
9D04126C  240700F0   ADDIU A3, ZERO, 240
9D041298  0B410497   J 0x9D04125C
20:                          wait_ms(1000);
9D041270  0F409FC8   JAL wait_ms
9D041274  240403E8   ADDIU A0, ZERO, 1000
21:                          tft_fill_area(0,0,320,240,CIPHER_CURSOR);
9D041254  3610FFFF   ORI S0, S0, -1
9D041278  AFB00010   SW S0, 16(SP)
9D04127C  00002021   ADDU A0, ZERO, ZERO
9D041280  00002821   ADDU A1, ZERO, ZERO
9D041284  24060140   ADDIU A2, ZERO, 320
9D041288  0F406203   JAL tft_fill_area
9D04128C  240700F0   ADDIU A3, ZERO, 240
22:                          wait_ms(1000);
9D041290  0F409FC8   JAL wait_ms
9D041294  240403E8   ADDIU A0, ZERO, 1000
9D041298  0B410497   J 0x9D04125C
9D04129C  AFA00010   SW ZERO, 16(SP)
23:                      }
24:                  }
25:                  
26:                  
27:                  
28:                  
29:                  
30:                  /*
31:                   * Interesting places to take look at, in MPLABX use CtrlCtrl+Shift+F to search in all files
32:                   * for those "bookmarks"
33:                   * 
34:                   * ----------------badge stuff----------------
35:                   * After reset, badge checks whether BRK key is pressed. In case it is, test routine starts, see
36:                   * B_BDG001
37:                   * If not, B_BDG002 is the place to jump. Welcome screen is painstakingly drawn via lot of setxy
38:                   * and print commands. Then it waits for user input. All interaction with user is done mainly via
39:                   * stdio functions, that can be redirected either to local screen or serial port, available on pins
40:                   * C13 and C14 of expansion port. There is also stdio buffer that can be written from software, 
41:                   * for specific purposes
42:                   * The four stdio functions are under B_BDG003
43:                   *
44:                   * For this badge, I opted to refresh display from interrupt handler linked to timer5, set to fire
45:                   * every 12ms - B_BDG003. This is heartbeat of badge, where both partial display refresh (two 
46:                   * lines at once) and keyboard scanning tasks do take place. Notice, one can disable refreshing 
47:                   * the display if needed via function B_BDG004 or manipulating the variable handle_display 
48:                   * directly. Timer 1 runs with 1ms period, and increments variable ticks, available via function
49:                   * millis().
50:                   * 
51:                   * User can write its own programs to be incorporated within "big firmware" of badge, see B_BDG006
52:                   * and B_BDG007 and B_BDG008. Badge can be turned on or off via power button. This erases display.
53:                   * Since badge doesn't have graphic framebuffer (it has terminal text buffer though), the user should 
54:                   * refresh the display in appropriate function, set up via function pointer, see B_BDG005 and B_BDG009
55:                   * Currently, there is about 16kB of RAM and 45kB of FLASH free to use for user
56:                   * If some CP/M features are disabled, see B_BDG010, user can gain additional quarter of megabyte of 
57:                   * FLASH space and about 22kB of RAM.
58:                   * 
59:                   * Other than that, simple firmware skeleton will be provided too, so user doesn't need to use
60:                   * software infrastructure of badge firmware, with all its dependencies; uncovering full hardware 
61:                   * potential of badge.
62:                   * 
63:                   * 
64:                   * ----------------BASIC interpreter----------------
65:                   * 
66:                   * B_BAS001: This is where BASIC tokens are defined, have you want to add your word, add one
67:                   * into this list, then go to B_BAS002 to define appropriate action. Of course, don't forget
68:                   * to add the token number into list in B_BAS003
69:                   * This way you can make words like LED, invoked as LED 2,1
70:                   * If you want to add word returning value like RND in form of LET A = RND 10, take a look how it's
71:                   * made in B_BAS004
72:                   * 
73:                   * A lot of things around BASIC happens outside the interpreter itself. After invoking BASIC, the first
74:                   * function to be called is B_BAS005 where everything is set to run BASIC loop in B_BAS006
75:                   * It basically (no pun intended) collects users input and once buffer si full, it is sent to decide what 
76:                   * it is - B_BAS007
77:                   * If it appears to be valid line of BASIC program, including line number, it goes to be added to
78:                   * current program B_BAS008
79:                   * If not, program flows through series of comparisons to determine whether the thing that user wrote is 
80:                   * something from a few commands that command interpreter can execute. One of them is RUN that sets up 
81:                   * interpreter in B_BAS009 and runs main loop in B_BAS010.
82:                   * Program buffer is set to 16kB, so you can't have programs longer than that. You may redefine buffer 
83:                   * length (see badge_settings.h), you may want to check save/load routines, see B_BAS011
84:                   * 
85:                   * 
86:                   * 
87:                   * ----------------CP/M machine----------------
88:                   * 
89:                   * This one runs on Z80 interpreter, written by Udo Munk. It is directory /Z80, along with two other files,
90:                   * defining memory and hardware configuration of this virtual machine, files hwz.c and iosim.c
91:                   * 
92:                   * iosim.c defines the memory map. I wrote the BIOS for CP/M machine to be extremely simple, with more 
93:                   * automation and intelligence on software side, not achievable with classic hardware means. For example,
94:                   * writing to address 0xFF triggers CP/M system reload. so BIOS hook can be as simple as writing single byte 
95:                   * into this address. Classic BIOS needed a lot of more Z80 instructions to achieve th same.
96:                   * On address 0x68 (+0x6D) is implemented simple UART, linked to UART3 of badge (available on C13 and C14 of
97:                   * expansion port). This UART is utilized in XMODEM program (available at drive B:), so user can transfer 
98:                   * CP/M binaries from PC via any compatible Xmodem terminal. I used moserial and cutecom in linux, or teraterm
99:                   * in windows.
100:                  * CP/M machine is setup to use six different drives:
101:                  * A: - 22kB in size, RAM disk. Fast, no wearout, ideal for temporary storage. Trashed on reboot.
102:                  * B: - 128kB ROM disk, contains a lot of goodies. You could pack a lot of software into 128kB then.
103:                  * C: - 128kB ROM dosk, contains Zork and Sargon. You know, games.
104:                  * D: - 512kB FLASH disk, free for your use
105:                  * hwz.c contains all stuff to access disks and devices of CP/M machine, like disk byte read and write
106:                  * functions, called directly by BIOS via addresses 0x07 and 0x08, with 0x05 and 0x06 setting track and
107:                  * sector of drive selected via 0x04.
108:                  *
109:                  * CP/M defines some standard IO devices - reader, puncher for your punch cards and list device to print 
110:                  * out your program listings. Those are not implemented in badge hardware iosim.c, see B_CPM001 and B_CPM002
111:                  * If defined, you can - for example - list files directly from CP/M via virtual printer, or make virtual
112:                  * punch card reader/puncher to EEPROM, thumb drive, PC, FTP server via ESP32 or anything you can connect 
113:                  * to bitbanged interface on badge expansion port.
114:                  * 
115:                  */
---  /Users/nitro/basic-badge/firmware/badge1.X/src/hw.c  -----------------------------------------------
1:                   #include <xc.h>
2:                   #include "hw.h"
3:                   #include "Z80/hwz.h"
4:                   #include <plib.h>
5:                   #include <peripheral/pps.h>
6:                   #include <stdint.h>
7:                   
8:                   // DEVCFG3
9:                   // USERID = No Setting
10:                  #pragma config FSRSSEL = PRIORITY_7     // Shadow Register Set Priority Select (SRS Priority 7)
11:                  #pragma config PMDL1WAY = OFF           // Peripheral Module Disable Configuration (Allow multiple reconfigurations)
12:                  #pragma config IOL1WAY = OFF            // Peripheral Pin Select Configuration (Allow multiple reconfigurations)
13:                  
14:                  // DEVCFG2
15:                  #pragma config FPLLIDIV = DIV_1//DIV_2         // PLL Input Divider (2x Divider)
16:                  #pragma config FPLLMUL = MUL_15//MUL_24         // PLL Multiplier (24x Multiplier)
17:                  #pragma config FPLLODIV = DIV_1//DIV_2         // System PLL Output Clock Divider (PLL Divide by 2)
18:                  
19:                  // DEVCFG1
20:                  #pragma config FNOSC = FRCPLL           // Oscillator Selection Bits (Fast RC Osc with PLL)
21:                  #pragma config FSOSCEN = OFF            // Secondary Oscillator Enable (Disabled)
22:                  #pragma config IESO = ON                // Internal/External Switch Over (Enabled)
23:                  #pragma config POSCMOD = OFF            // Primary Oscillator Configuration (Primary osc disabled)
24:                  #pragma config OSCIOFNC = OFF           // CLKO Output Signal Active on the OSCO Pin (Disabled)
25:                  #pragma config FPBDIV = DIV_1           // Peripheral Clock Divisor (Pb_Clk is Sys_Clk/1)
26:                  #pragma config FCKSM = CSDCMD           // Clock Switching and Monitor Selection (Clock Switch Disable, FSCM Disabled)
27:                  #pragma config WDTPS = PS1048576        // Watchdog Timer Postscaler (1:1048576)
28:                  #pragma config WINDIS = OFF             // Watchdog Timer Window Enable (Watchdog Timer is in Non-Window Mode)
29:                  #pragma config FWDTEN = OFF             // Watchdog Timer Enable (WDT Disabled (SWDTEN Bit Controls))
30:                  #pragma config FWDTWINSZ = WINSZ_25     // Watchdog Timer Window Size (Window Size is 25%)
31:                  
32:                  // DEVCFG0
33:                  #pragma config DEBUG = OFF              // Background Debugger Enable (Debugger is Disabled)
34:                  #pragma config JTAGEN = OFF             // JTAG Enable (JTAG Disabled)
35:                  #pragma config ICESEL = ICS_PGx1        // ICE/ICD Comm Channel Select (Communicate on PGEC1/PGED1)
36:                  #pragma config PWP = OFF                // Program Flash Write Protect (Disable)
37:                  #pragma config BWP = OFF                // Boot Flash Write Protect bit (Protection Disabled)
38:                  #pragma config CP = OFF                 // Code Protect (Protection Disabled)
39:                  
40:                  uint8_t key_state=0,key_last,key,led_state=0;
41:                  uint16_t rnd_var1,rnd_var2,rnd_var3;
42:                  
43:                  const int8_t keys_normal[50] = 
44:                  	{
45:                  	'3','4','2','5','1','9','6','7','0','8',
46:                  	'e','r','w','t','q','o','y','u','p','i',
47:                  	's','d','a','f','/','k','g','h','l','j',
48:                  	'x','c','z','v',' ',0x2c,'b','n','.','m',
49:                  	K_DN,K_RT,K_LT,';',K_UP,K_DEL,'=',K_ENT,BACKSPACE,'-',
50:                  	};
51:                  
52:                  const int8_t keys_shift_l[50] = 
53:                  	{
54:                  	'#','$','@','%','!','(',' ','&',')','*',
55:                  	'E','R','W','T','Q','O','Y','U','P','I',
56:                  	'S','D','A','F','?','K','G','H','L','J',
57:                  	'X','C','Z','V',' ','<','B','N','>','M',
58:                  	K_DN,K_RT,K_LT,':',K_UP,K_DEL,'+',K_ECR,BACKSPACE,'"',
59:                  	};
60:                  const int8_t keys_shift_r[50] = 
61:                  	{
62:                  	'#','$','@','%','!','(',' ','&',')','*',
63:                  	'E','R','W','T','Q','O','Y','U','P','I',
64:                  	'S','D','A','F','?','K','G','H','L','J',
65:                  	'X','C','Z','V',' ','<','B','N','>','M',
66:                  	K_DN,K_RT,K_LT,':',K_UP,K_DEL,'+',K_ECR,BACKSPACE,'_',
67:                  	};
68:                  
69:                  int8_t key_char;
70:                  
71:                  
72:                  const uint16_t tone_pr_table[128] = 
73:                  	{
74:                  	0, //No Note
75:                  	/* Sacrifice this for 0 to be 'no note' 366927, // 0 | C-1 | 8.176Hz */
76:                  	/* Lowest notes have timer values too big for uint16_t so setting to 0 as workaround*/
77:                  	0, //346340, // 1 | C?/D?-1 | 8.662Hz
78:                  	0, //326904, // 2 | D-1 | 9.177Hz
79:                  	0, //308546, // 3 | E?/D?-1 | 9.723Hz
80:                  	0, //291233, // 4 | E-1 | 10.301Hz
81:                  	0, //274876, // 5 | F-1 | 10.914Hz
82:                  	0, //259448, // 6 | F?/G?-1 | 11.563Hz
83:                  	0, //244897, // 7 | G-1 | 12.25Hz
84:                  	0, //231142, // 8 | A?/G?-1 | 12.979Hz
85:                  	0, //218181, // 9 | A-1 | 13.75Hz
86:                  	0, //205930, // 10 | B?/A?-1 | 14.568Hz
87:                  	0, //194376, // 11 | B-1 | 15.434Hz
88:                  	0, //183463, // 12 | C0 | 16.352Hz
89:                  	0, //173170, // 13 | C?/D?0 | 17.324Hz
90:                  	0, //163452, // 14 | D0 | 18.354Hz
91:                  	0, //154281, // 15 | E?/D?0 | 19.445Hz
92:                  	0, //145616, // 16 | E0 | 20.602Hz
93:                  	0, //137444, // 17 | F0 | 21.827Hz
94:                  	0, //129729, // 18 | F?/G?0 | 23.125Hz
95:                  	0, //122448, // 19 | G0 | 24.5Hz
96:                  	0, //115575, // 20 | A?/G?0 | 25.957Hz
97:                  	0, //109090, // 21 | A0 | 27.5Hz
98:                  	0, //102968, // 22 | B?/A?0 | 29.135Hz
99:                  	0, //97188, // 23 | B0 | 30.868Hz
100:                 	0, //91734, // 24 | C1 | 32.703Hz
101:                 	0, //86585, // 25 | C?/D?1 | 34.648Hz
102:                 	0, //81726, // 26 | D1 | 36.708Hz
103:                 	0, //77138, // 27 | E?/D?1 | 38.891Hz
104:                 	0, //72810, // 28 | E1 | 41.203Hz
105:                 	0, //68722, // 29 | F1 | 43.654Hz
106:                 	64866, // 30 | F?/G?1 | 46.249Hz
107:                 	61225, // 31 | G1 | 48.999Hz
108:                 	57788, // 32 | A?/G?1 | 51.913Hz
109:                 	54545, // 33 | A1 | 55.0Hz
110:                 	51484, // 34 | B?/A?1 | 58.27Hz
111:                 	48594, // 35 | B1 | 61.735Hz
112:                 	45867, // 36 | C2 | 65.406Hz
113:                 	43292, // 37 | C?/D?2 | 69.296Hz
114:                 	40863, // 38 | D2 | 73.416Hz
115:                 	38569, // 39 | E?/D?2 | 77.782Hz
116:                 	36404, // 40 | E2 | 82.407Hz
117:                 	34361, // 41 | F2 | 87.307Hz
118:                 	32432, // 42 | F?/G?2 | 92.499Hz
119:                 	30612, // 43 | G2 | 97.999Hz
120:                 	28893, // 44 | A?/G?2 | 103.83Hz
121:                 	27272, // 45 | A2 | 110.0Hz
122:                 	25742, // 46 | B?/A?2 | 116.54Hz
123:                 	24297, // 47 | B2 | 123.47Hz
124:                 	22934, // 48 | C3 | 130.81Hz
125:                 	21646, // 49 | C?/D?3 | 138.59Hz
126:                 	20431, // 50 | D3 | 146.83Hz
127:                 	19285, // 51 | E?/D?3 | 155.56Hz
128:                 	18202, // 52 | E3 | 164.81Hz
129:                 	17181, // 53 | F3 | 174.61Hz
130:                 	16216, // 54 | F?/G?3 | 185.0Hz
131:                 	15306, // 55 | G3 | 196.0Hz
132:                 	14447, // 56 | A?/G?3 | 207.65Hz
133:                 	13636, // 57 | A3 | 220.0Hz
134:                 	12871, // 58 | B?/A?3 | 233.08Hz
135:                 	12148, // 59 | B3 | 246.94Hz
136:                 	11466, // 60 | C4 | 261.63Hz
137:                 	10823, // 61 | C?/D?4 | 277.18Hz
138:                 	10215, // 62 | D4 | 293.66Hz
139:                 	9642, // 63 | E?/D?4 | 311.13Hz
140:                 	9101, // 64 | E4 | 329.63Hz
141:                 	8590, // 65 | F4 | 349.23Hz
142:                 	8108, // 66 | F?/G?4 | 369.99Hz
143:                 	7653, // 67 | G4 | 392.0Hz
144:                 	7223, // 68 | A?/G?4 | 415.3Hz
145:                 	6818, // 69 | A4 | 440.0Hz
146:                 	6435, // 70 | B?/A?4 | 466.16Hz
147:                 	6074, // 71 | B4 | 493.88Hz
148:                 	5733, // 72 | C5 | 523.25Hz
149:                 	5411, // 73 | C?/D?5 | 554.37Hz
150:                 	5107, // 74 | D5 | 587.33Hz
151:                 	4821, // 75 | E?/D?5 | 622.25Hz
152:                 	4550, // 76 | E5 | 659.26Hz
153:                 	4295, // 77 | F5 | 698.46Hz
154:                 	4054, // 78 | F?/G?5 | 739.99Hz
155:                 	3826, // 79 | G5 | 783.99Hz
156:                 	3611, // 80 | A?/G?5 | 830.61Hz
157:                 	3409, // 81 | A5 | 880.0Hz
158:                 	3217, // 82 | B?/A?5 | 932.33Hz
159:                 	3037, // 83 | B5 | 987.77Hz
160:                 	2866, // 84 | C6 | 1046.5Hz
161:                 	2705, // 85 | C?/D?6 | 1108.7Hz
162:                 	2553, // 86 | D6 | 1174.7Hz
163:                 	2410, // 87 | E?/D?6 | 1244.5Hz
164:                 	2275, // 88 | E6 | 1318.5Hz
165:                 	2147, // 89 | F6 | 1396.9Hz
166:                 	2027, // 90 | F?/G?6 | 1480.0Hz
167:                 	1913, // 91 | G6 | 1568.0Hz
168:                 	1805, // 92 | A?/G?6 | 1661.2Hz
169:                 	1704, // 93 | A6 | 1760.0Hz
170:                 	1608, // 94 | B?/A?6 | 1864.7Hz
171:                 	1518, // 95 | B6 | 1975.5Hz
172:                 	1433, // 96 | C7 | 2093.0Hz
173:                 	1352, // 97 | C?/D?7 | 2217.5Hz
174:                 	1276, // 98 | D7 | 2349.3Hz
175:                 	1205, // 99 | E?/D?7 | 2489.0Hz
176:                 	1137, // 100 | E7 | 2637.0Hz
177:                 	1073, // 101 | F7 | 2793.8Hz
178:                 	1013, // 102 | F?/G?7 | 2960.0Hz
179:                 	956, // 103 | G7 | 3136.0Hz
180:                 	902, // 104 | A?/G?7 | 3322.4Hz
181:                 	852, // 105 | A7 | 3520.0Hz
182:                 	804, // 106 | B?/A?7 | 3729.3Hz
183:                 	759, // 107 | B7 | 3951.1Hz
184:                 	716, // 108 | C8 | 4186.0Hz
185:                 	676, // 109 | C?/D?8 | 4434.9Hz
186:                 	638, // 110 | D8 | 4698.6Hz
187:                 	602, // 111 | E?/D?8 | 4978.0Hz
188:                 	568, // 112 | E8 | 5274.0Hz
189:                 	536, // 113 | F8 | 5587.7Hz
190:                 	506, // 114 | F?/G?8 | 5919.9Hz
191:                 	478, // 115 | G8 | 6271.9Hz
192:                 	451, // 116 | A?/G?8 | 6644.9Hz
193:                 	426, // 117 | A8 | 7040.0Hz
194:                 	402, // 118 | B?/A?8 | 7458.6Hz
195:                 	379, // 119 | B8 | 7902.1Hz
196:                 	358, // 120 | C9 | 8372.0Hz
197:                 	338, // 121 | C?/D?9 | 8869.8Hz
198:                 	319, // 122 | D9 | 9397.3Hz
199:                 	301, // 123 | E?/D?9 | 9956.1Hz
200:                 	284, // 124 | E9 | 10548.1Hz
201:                 	268, // 125 | F9 | 11175.3Hz
202:                 	253, // 126 | F?/G?9 | 11839.8Hz
203:                 	239, // 127 | G9 | 12543.9Hz
204:                 	};
205:                 
206:                 uint8_t get_led_word(void)
207:                 	{
208:                 	uint8_t retval = 0;
9D027160  7C620180   EXT V0, V1, 6, 1
209:                 	if (LED_R) retval = retval | 0x01;
9D027158  3C02BF88   LUI V0, -16504
9D02715C  8C436330   LW V1, 25392(V0)
210:                 	if (LED_G) retval = retval | 0x02;
9D027164  3C04BF88   LUI A0, -16504
9D027168  8C856530   LW A1, 25904(A0)
9D02716C  30A60002   ANDI A2, A1, 2
9D027170  10C00003   BEQ A2, ZERO, 0x9D027180
9D027174  3C08BF88   LUI T0, -16504
9D027178  34470002   ORI A3, V0, 2
9D02717C  30E200FF   ANDI V0, A3, 255
211:                 	if (LED_B) retval = retval | 0x04;
9D027180  8D096330   LW T1, 25392(T0)
9D027184  312A0080   ANDI T2, T1, 128
9D027188  344B0004   ORI T3, V0, 4
212:                 	return retval;
213:                 	}
9D02718C  03E00008   JR RA
9D027190  016A100B   MOVN V0, T3, T2
214:                 
215:                 void set_led_word (uint8_t val)
216:                 	{
217:                 	if (val&0x01) LED_R = 1;
9D027194  30820001   ANDI V0, A0, 1
9D027198  10400008   BEQ V0, ZERO, 0x9D0271BC
9D02719C  3C05BF88   LUI A1, -16504
9D0271A0  3C06BF88   LUI A2, -16504
9D0271A4  94C76330   LHU A3, 25392(A2)
9D0271A8  24080001   ADDIU T0, ZERO, 1
9D0271AC  7D073184   INS A3, T0, 6, 1
9D0271B0  A4C76330   SH A3, 25392(A2)
9D0271B4  0B409C73   J 0x9D0271CC
9D0271B8  30890002   ANDI T1, A0, 2
218:                 		else LED_R = 0;
9D0271BC  94A36330   LHU V1, 25392(A1)
9D0271C0  7C033184   INS V1, ZERO, 6, 1
9D0271C4  A4A36330   SH V1, 25392(A1)
219:                 	if (val&0x02) LED_G = 1;
9D0271C8  30890002   ANDI T1, A0, 2
9D0271CC  312A00FF   ANDI T2, T1, 255
9D0271D0  11400008   BEQ T2, ZERO, 0x9D0271F4
9D0271D4  3C0BBF88   LUI T3, -16504
9D0271D8  3C0DBF88   LUI T5, -16504
9D0271DC  91AE6530   LBU T6, 25904(T5)
9D0271E0  240F0001   ADDIU T7, ZERO, 1
9D0271E4  7DEE0844   INS T6, T7, 1, 1
9D0271E8  A1AE6530   SB T6, 25904(T5)
9D0271EC  0B409C81   J 0x9D027204
9D0271F0  30840004   ANDI A0, A0, 4
220:                 		else LED_G = 0;
9D0271F4  916C6530   LBU T4, 25904(T3)
9D0271F8  7C0C0844   INS T4, ZERO, 1, 1
9D0271FC  A16C6530   SB T4, 25904(T3)
221:                 	if (val&0x04) LED_B = 1;
9D027200  30840004   ANDI A0, A0, 4
9D027204  309800FF   ANDI T8, A0, 255
9D027208  13000008   BEQ T8, ZERO, 0x9D02722C
9D02720C  3C19BF88   LUI T9, -16504
9D027210  3C05BF88   LUI A1, -16504
9D027214  94A36330   LHU V1, 25392(A1)
9D027218  24060001   ADDIU A2, ZERO, 1
9D02721C  7CC339C4   INS V1, A2, 7, 1
9D027220  A4A36330   SH V1, 25392(A1)
9D027224  03E00008   JR RA
9D027228  00000000   NOP
222:                 		else LED_B = 0;
9D02722C  97226330   LHU V0, 25392(T9)
9D027230  7C0239C4   INS V0, ZERO, 7, 1
9D027234  A7226330   SH V0, 25392(T9)
9D027238  03E00008   JR RA
9D02723C  00000000   NOP
223:                 	}
224:                 
225:                 void set_led (uint8_t led_n, uint8_t led_v)
226:                 	{
227:                 	if (led_n==0)
9D027240  14800007   BNE A0, ZERO, 0x9D027260
9D027244  24020001   ADDIU V0, ZERO, 1
228:                 		LED_R = led_v;
9D027248  3C09BF88   LUI T1, -16504
9D02724C  952A6330   LHU T2, 25392(T1)
9D027250  7CAA3184   INS T2, A1, 6, 1
9D027254  A52A6330   SH T2, 25392(T1)
9D027258  03E00008   JR RA
9D02725C  00000000   NOP
229:                 	if (led_n==1)
9D027260  14820006   BNE A0, V0, 0x9D02727C
9D027264  3C07BF88   LUI A3, -16504
230:                 		LED_G = led_v;	
9D027268  90E86530   LBU T0, 25904(A3)
9D02726C  7CA80844   INS T0, A1, 1, 1
9D027270  A0E86530   SB T0, 25904(A3)
9D027274  03E00008   JR RA
9D027278  00000000   NOP
231:                 	if (led_n==2)
9D02727C  24030002   ADDIU V1, ZERO, 2
9D027280  1483FFF5   BNE A0, V1, 0x9D027258
9D027284  3C04BF88   LUI A0, -16504
232:                 		LED_B = led_v;	
9D027288  94866330   LHU A2, 25392(A0)
9D02728C  7CA639C4   INS A2, A1, 7, 1
9D027290  A4866330   SH A2, 25392(A0)
9D027294  03E00008   JR RA
9D027298  00000000   NOP
233:                 	}
234:                 
235:                 void sound_play_notes (uint8_t note1, uint8_t note2, uint8_t note3, uint16_t wait)
236:                 	{
9D027F64  27BDFFD8   ADDIU SP, SP, -40
9D027F68  AFBF0024   SW RA, 36(SP)
9D027F6C  AFB30020   SW S3, 32(SP)
9D027F70  AFB2001C   SW S2, 28(SP)
9D027F74  AFB10018   SW S1, 24(SP)
9D027F78  AFB00014   SW S0, 20(SP)
9D027F7C  00A09821   ADDU S3, A1, ZERO
9D027F80  00C09021   ADDU S2, A2, ZERO
9D027F84  00E08821   ADDU S1, A3, ZERO
237:                 	IEC0bits.T5IE = 0;		//sound is a bit shaky without this
9D027F88  3C10BF88   LUI S0, -16504
9D027F8C  8E021060   LW V0, 4192(S0)
9D027F90  7C02C604   INS V0, ZERO, 24, 1
9D027F94  AE021060   SW V0, 4192(S0)
238:                 							//quick hack, needs more debugging
239:                 	sound_set_note(note1,0);
9D027F98  0F409CF1   JAL sound_set_note
9D027F9C  00002821   ADDU A1, ZERO, ZERO
240:                 	sound_set_note(note2,1);
9D027FA0  02602021   ADDU A0, S3, ZERO
9D027FA4  0F409CF1   JAL sound_set_note
9D027FA8  24050001   ADDIU A1, ZERO, 1
241:                 	sound_set_note(note3,2);
9D027FAC  02402021   ADDU A0, S2, ZERO
9D027FB0  0F409CF1   JAL sound_set_note
9D027FB4  24050002   ADDIU A1, ZERO, 2
242:                 	wait_ms(wait);
9D027FB8  0F409FC8   JAL wait_ms
9D027FBC  02202021   ADDU A0, S1, ZERO
243:                 	sound_set_note(0,0);
9D027FC0  00002021   ADDU A0, ZERO, ZERO
9D027FC4  0F409CF1   JAL sound_set_note
9D027FC8  00002821   ADDU A1, ZERO, ZERO
244:                 	sound_set_note(0,1);
9D027FCC  00002021   ADDU A0, ZERO, ZERO
9D027FD0  0F409CF1   JAL sound_set_note
9D027FD4  24050001   ADDIU A1, ZERO, 1
245:                 	sound_set_note(0,2);
9D027FD8  00002021   ADDU A0, ZERO, ZERO
9D027FDC  0F409CF1   JAL sound_set_note
9D027FE0  24050002   ADDIU A1, ZERO, 2
246:                 	IEC0bits.T5IE = 1;
9D027FE4  8E041060   LW A0, 4192(S0)
9D027FE8  24030001   ADDIU V1, ZERO, 1
9D027FEC  7C64C604   INS A0, V1, 24, 1
9D027FF0  AE041060   SW A0, 4192(S0)
247:                 	}
9D027FF4  8FBF0024   LW RA, 36(SP)
9D027FF8  8FB30020   LW S3, 32(SP)
9D027FFC  8FB2001C   LW S2, 28(SP)
9D028000  8FB10018   LW S1, 24(SP)
9D028004  8FB00014   LW S0, 20(SP)
9D028008  03E00008   JR RA
9D02800C  27BD0028   ADDIU SP, SP, 40
248:                 
249:                 void sound_set_note (uint8_t note, uint8_t generator)
250:                 	{
9D0273C4  27BDFFE8   ADDIU SP, SP, -24
9D0273C8  AFBF0014   SW RA, 20(SP)
251:                 	sound_set_generator(tone_pr_table[note],generator);
9D0273CC  00042040   SLL A0, A0, 1
9D0273D0  3C029D04   LUI V0, -25340
9D0273D4  2443C17C   ADDIU V1, V0, -16004
9D0273D8  00833021   ADDU A2, A0, V1
9D0273DC  0F409CA7   JAL sound_set_generator
9D0273E0  94C40000   LHU A0, 0(A2)
252:                 	}
9D0273E4  8FBF0014   LW RA, 20(SP)
9D0273E8  03E00008   JR RA
9D0273EC  27BD0018   ADDIU SP, SP, 24
253:                 
254:                 void sound_set_generator (uint16_t period, uint8_t generator)
255:                 	{
256:                 	if (generator==0)
9D02729C  14A00018   BNE A1, ZERO, 0x9D027300
9D0272A0  24020001   ADDIU V0, ZERO, 1
257:                 		{
258:                 		T2CONbits.TON = 0;
9D0272A4  3C07BF80   LUI A3, -16512
9D0272A8  94E80800   LHU T0, 2048(A3)
9D0272AC  7C087BC4   INS T0, ZERO, 15, 1
9D0272B0  A4E80800   SH T0, 2048(A3)
259:                 		PR2 = period;
9D0272B4  3C09BF80   LUI T1, -16512
9D0272B8  AD240820   SW A0, 2080(T1)
260:                 		T2CONbits.TCKPS = 0b011;
9D0272BC  94EA0800   LHU T2, 2048(A3)
9D0272C0  240B0003   ADDIU T3, ZERO, 3
9D0272C4  7D6A3104   INS T2, T3, 4, 3
9D0272C8  A4EA0800   SH T2, 2048(A3)
261:                 		if (period!=0)
9D0272CC  50800007   BEQL A0, ZERO, 0x9D0272EC
9D0272D0  3C04BF88   LUI A0, -16504
262:                 			T2CONbits.TON = 1;
9D0272D4  94ED0800   LHU T5, 2048(A3)
9D0272D8  240E0001   ADDIU T6, ZERO, 1
9D0272DC  7DCD7BC4   INS T5, T6, 15, 1
9D0272E0  A4ED0800   SH T5, 2048(A3)
9D0272E4  03E00008   JR RA
9D0272E8  00000000   NOP
263:                 		else
264:                 			GEN_0_PIN = 0;
9D0272EC  948C6330   LHU T4, 25392(A0)
9D0272F0  7C0C0844   INS T4, ZERO, 1, 1
9D0272F4  A48C6330   SH T4, 25392(A0)
9D0272F8  03E00008   JR RA
9D0272FC  00000000   NOP
265:                 		}
266:                 	if (generator==1)
9D027300  14A20017   BNE A1, V0, 0x9D027360
9D027304  3C0DBF80   LUI T5, -16512
267:                 		{
268:                 		T3CONbits.TON = 0;
9D027308  95AE0A00   LHU T6, 2560(T5)
9D02730C  7C0E7BC4   INS T6, ZERO, 15, 1
9D027310  A5AE0A00   SH T6, 2560(T5)
269:                 		PR3 = period;
9D027314  3C0FBF80   LUI T7, -16512
9D027318  ADE40A20   SW A0, 2592(T7)
270:                 		T3CONbits.TCKPS = 0b011;
9D02731C  95B80A00   LHU T8, 2560(T5)
9D027320  24190003   ADDIU T9, ZERO, 3
9D027324  7F383104   INS T8, T9, 4, 3
9D027328  A5B80A00   SH T8, 2560(T5)
271:                 		if (period!=0)
9D02732C  50800007   BEQL A0, ZERO, 0x9D02734C
9D027330  3C02BF88   LUI V0, -16504
272:                 			T3CONbits.TON = 1;
9D027334  95A60A00   LHU A2, 2560(T5)
9D027338  24050001   ADDIU A1, ZERO, 1
9D02733C  7CA67BC4   INS A2, A1, 15, 1
9D027340  A5A60A00   SH A2, 2560(T5)
9D027344  03E00008   JR RA
9D027348  00000000   NOP
273:                 		else
274:                 			GEN_1_PIN = 0;
9D02734C  94436330   LHU V1, 25392(V0)
9D027350  7C031084   INS V1, ZERO, 2, 1
9D027354  A4436330   SH V1, 25392(V0)
9D027358  03E00008   JR RA
9D02735C  00000000   NOP
275:                 		}
276:                 	if (generator==2)
9D027360  24030002   ADDIU V1, ZERO, 2
9D027364  14A3FFDF   BNE A1, V1, 0x9D0272E4
9D027368  3C06BF80   LUI A2, -16512
277:                 		{
278:                 		T4CONbits.TON = 0;
9D02736C  94C50C00   LHU A1, 3072(A2)
9D027370  7C057BC4   INS A1, ZERO, 15, 1
9D027374  A4C50C00   SH A1, 3072(A2)
279:                 		PR4 = period;
9D027378  3C07BF80   LUI A3, -16512
9D02737C  ACE40C20   SW A0, 3104(A3)
280:                 		T4CONbits.TCKPS = 0b011;
9D027380  94C80C00   LHU T0, 3072(A2)
9D027384  24090003   ADDIU T1, ZERO, 3
9D027388  7D283104   INS T0, T1, 4, 3
9D02738C  A4C80C00   SH T0, 3072(A2)
281:                 		if (period!=0)
9D027390  50800007   BEQL A0, ZERO, 0x9D0273B0
9D027394  3C04BF88   LUI A0, -16504
282:                 			T4CONbits.TON = 1;
9D027398  94CB0C00   LHU T3, 3072(A2)
9D02739C  240C0001   ADDIU T4, ZERO, 1
9D0273A0  7D8B7BC4   INS T3, T4, 15, 1
9D0273A4  A4CB0C00   SH T3, 3072(A2)
9D0273A8  03E00008   JR RA
9D0273AC  00000000   NOP
283:                 		else
284:                 			GEN_2_PIN = 0;
9D0273B0  948A6330   LHU T2, 25392(A0)
9D0273B4  7C0A18C4   INS T2, ZERO, 3, 1
9D0273B8  A48A6330   SH T2, 25392(A0)
9D0273BC  03E00008   JR RA
9D0273C0  00000000   NOP
285:                 		}
286:                 	}
287:                 
288:                 void hw_sleep (void)
289:                 	{
9D027904  27BDFFE8   ADDIU SP, SP, -24
9D027908  AFBF0014   SW RA, 20(SP)
290:                 	led_state = get_led_word();
9D02790C  0F409C56   JAL get_led_word
9D027910  00000000   NOP
9D027914  A382805C   SB V0, -32676(GP)
291:                 	set_led_word(0);
9D027918  0F409C65   JAL set_led_word
9D02791C  00002021   ADDU A0, ZERO, ZERO
292:                 	T1CONbits.TON = 0;
9D027920  3C02BF80   LUI V0, -16512
9D027924  94430600   LHU V1, 1536(V0)
9D027928  7C037BC4   INS V1, ZERO, 15, 1
9D02792C  A4430600   SH V1, 1536(V0)
293:                 	T2CONbits.TON = 0;
9D027930  3C04BF80   LUI A0, -16512
9D027934  94850800   LHU A1, 2048(A0)
9D027938  7C057BC4   INS A1, ZERO, 15, 1
9D02793C  A4850800   SH A1, 2048(A0)
294:                 	T3CONbits.TON = 0;
9D027940  3C06BF80   LUI A2, -16512
9D027944  94C70A00   LHU A3, 2560(A2)
9D027948  7C077BC4   INS A3, ZERO, 15, 1
9D02794C  A4C70A00   SH A3, 2560(A2)
295:                 	T4CONbits.TON = 0;
9D027950  3C08BF80   LUI T0, -16512
9D027954  95090C00   LHU T1, 3072(T0)
9D027958  7C097BC4   INS T1, ZERO, 15, 1
9D02795C  A5090C00   SH T1, 3072(T0)
296:                 	T5CONbits.TON = 0;
9D027960  3C0ABF80   LUI T2, -16512
9D027964  954B0E00   LHU T3, 3584(T2)
9D027968  7C0B7BC4   INS T3, ZERO, 15, 1
9D02796C  A54B0E00   SH T3, 3584(T2)
297:                 	SPI1CONbits.ON = 0;
9D027970  3C0CBF80   LUI T4, -16512
9D027974  8D8D5800   LW T5, 22528(T4)
9D027978  7C0D7BC4   INS T5, ZERO, 15, 1
9D02797C  AD8D5800   SW T5, 22528(T4)
298:                 	U3MODEbits.ON = 0;
9D027980  3C0EBF80   LUI T6, -16512
9D027984  95CF6400   LHU T7, 25600(T6)
9D027988  7C0F7BC4   INS T7, ZERO, 15, 1
9D02798C  A5CF6400   SH T7, 25600(T6)
299:                 	LCD_PWR = 1;
9D027990  3C18BF88   LUI T8, -16504
9D027994  97196230   LHU T9, 25136(T8)
9D027998  24020001   ADDIU V0, ZERO, 1
9D02799C  7C597BC4   INS T9, V0, 15, 1
9D0279A0  A7196230   SH T9, 25136(T8)
300:                 	LCD_BKLT = 1;
9D0279A4  3C04BF88   LUI A0, -16504
9D0279A8  90836530   LBU V1, 25904(A0)
9D0279AC  7C430004   INS V1, V0, 0, 1
9D0279B0  A0836530   SB V1, 25904(A0)
301:                 	LCD_PORT = 0;
9D0279B4  3C06BF88   LUI A2, -16504
9D0279B8  ACC06430   SW ZERO, 25648(A2)
302:                 	LCD_DC = 0;
9D0279BC  3C05BF88   LUI A1, -16504
9D0279C0  94A76630   LHU A3, 26160(A1)
9D0279C4  7C074204   INS A3, ZERO, 8, 1
9D0279C8  A4A76630   SH A3, 26160(A1)
303:                 	LCD_RD = 0;
9D0279CC  3C08BF88   LUI T0, -16504
9D0279D0  95096330   LHU T1, 25392(T0)
9D0279D4  7C092944   INS T1, ZERO, 5, 1
9D0279D8  A5096330   SH T1, 25392(T0)
304:                 	LCD_RES = 0;
9D0279DC  94AA6630   LHU T2, 26160(A1)
9D0279E0  7C0A39C4   INS T2, ZERO, 7, 1
9D0279E4  A4AA6630   SH T2, 26160(A1)
305:                 	LCD_WR = 0;
9D0279E8  950B6330   LHU T3, 25392(T0)
9D0279EC  7C0B2104   INS T3, ZERO, 4, 1
9D0279F0  A50B6330   SH T3, 25392(T0)
306:                 	GEN_0_PIN = 0;
9D0279F4  950C6330   LHU T4, 25392(T0)
9D0279F8  7C0C0844   INS T4, ZERO, 1, 1
9D0279FC  A50C6330   SH T4, 25392(T0)
307:                 	GEN_1_PIN = 0;
9D027A00  950D6330   LHU T5, 25392(T0)
9D027A04  7C0D1084   INS T5, ZERO, 2, 1
9D027A08  A50D6330   SH T5, 25392(T0)
308:                 	GEN_2_PIN = 0;
9D027A0C  950E6330   LHU T6, 25392(T0)
9D027A10  7C0E18C4   INS T6, ZERO, 3, 1
9D027A14  A50E6330   SH T6, 25392(T0)
309:                 	TRISBbits.TRISB0 = 0;
9D027A18  3C0FBF88   LUI T7, -16504
9D027A1C  95F86110   LHU T8, 24848(T7)
9D027A20  7C180004   INS T8, ZERO, 0, 1
9D027A24  A5F86110   SH T8, 24848(T7)
310:                 	TRISBbits.TRISB1 = 0;
9D027A28  95F96110   LHU T9, 24848(T7)
9D027A2C  7C190844   INS T9, ZERO, 1, 1
9D027A30  A5F96110   SH T9, 24848(T7)
311:                 	TRISG = 0;
9D027A34  3C03BF88   LUI V1, -16504
9D027A38  AC606610   SW ZERO, 26128(V1)
312:                 	TRISGbits.TRISG9 = 1;
9D027A3C  3C07BF88   LUI A3, -16504
9D027A40  94E56610   LHU A1, 26128(A3)
9D027A44  7C454A44   INS A1, V0, 9, 1
9D027A48  A4E56610   SH A1, 26128(A3)
313:                 	TRISGbits.TRISG6 = 1;
9D027A4C  94E86610   LHU T0, 26128(A3)
9D027A50  7C483184   INS T0, V0, 6, 1
9D027A54  A4E86610   SH T0, 26128(A3)
314:                 	TRISC = 0;
9D027A58  3C09BF88   LUI T1, -16504
9D027A5C  AD206210   SW ZERO, 25104(T1)
315:                 	LATC = 0x8000;
9D027A60  340A8000   ORI T2, ZERO, -32768
9D027A64  3C0BBF88   LUI T3, -16504
9D027A68  AD6A6230   SW T2, 25136(T3)
316:                 	TRISD = 0X0;
9D027A6C  3C0CBF88   LUI T4, -16504
9D027A70  AD806310   SW ZERO, 25360(T4)
317:                 	LATD = 0;
9D027A74  3C0DBF88   LUI T5, -16504
9D027A78  ADA06330   SW ZERO, 25392(T5)
318:                 	TRISDbits.TRISD9 = 1;
9D027A7C  3C0EBF88   LUI T6, -16504
9D027A80  95CF6310   LHU T7, 25360(T6)
9D027A84  7C4F4A44   INS T7, V0, 9, 1
9D027A88  A5CF6310   SH T7, 25360(T6)
319:                 	TRISDbits.TRISD10 = 1;
9D027A8C  95D86310   LHU T8, 25360(T6)
9D027A90  7C585284   INS T8, V0, 10, 1
9D027A94  A5D86310   SH T8, 25360(T6)
320:                     CNPUDbits.CNPUD10 = 1;
9D027A98  3C19BF88   LUI T9, -16504
9D027A9C  97236350   LHU V1, 25424(T9)
9D027AA0  7C435284   INS V1, V0, 10, 1
9D027AA4  A7236350   SH V1, 25424(T9)
321:                     CNPUDbits.CNPUD9 = 1;
9D027AA8  97276350   LHU A3, 25424(T9)
9D027AAC  7C474A44   INS A3, V0, 9, 1
9D027AB0  A7276350   SH A3, 25424(T9)
322:                 	TRISE = 0;
9D027AB4  3C05BF88   LUI A1, -16504
9D027AB8  ACA06410   SW ZERO, 25616(A1)
323:                 	LATE = 0;	
9D027ABC  ACC06430   SW ZERO, 25648(A2)
324:                 	TRISF = 0;
9D027AC0  3C06BF88   LUI A2, -16504
9D027AC4  ACC06510   SW ZERO, 25872(A2)
325:                 	K_R1 = 1;
9D027AC8  3C08BF88   LUI T0, -16504
9D027ACC  95096130   LHU T1, 24880(T0)
9D027AD0  7C496304   INS T1, V0, 12, 1
9D027AD4  A5096130   SH T1, 24880(T0)
326:                 	K_R2 = 1;
9D027AD8  950A6130   LHU T2, 24880(T0)
9D027ADC  7C4A6B44   INS T2, V0, 13, 1
9D027AE0  A50A6130   SH T2, 24880(T0)
327:                 	K_R3 = 1;
9D027AE4  950B6130   LHU T3, 24880(T0)
9D027AE8  7C4B7384   INS T3, V0, 14, 1
9D027AEC  A50B6130   SH T3, 24880(T0)
328:                 	K_R4 = 1;
9D027AF0  950C6130   LHU T4, 24880(T0)
9D027AF4  7C4C7BC4   INS T4, V0, 15, 1
9D027AF8  A50C6130   SH T4, 24880(T0)
329:                 	K_R5 = 1;
9D027AFC  908D6530   LBU T5, 25904(A0)
9D027B00  7C4D2104   INS T5, V0, 4, 1
9D027B04  A08D6530   SB T5, 25904(A0)
330:                 	PMD1 = 0xFFFFFFFF;
9D027B08  3C0EBF81   LUI T6, -16511
9D027B0C  240FFFFF   ADDIU T7, ZERO, -1
9D027B10  ADCFF240   SW T7, -3520(T6)
331:                 	PMD2 = 0xFFFFFFFF;
9D027B14  3C18BF81   LUI T8, -16511
9D027B18  AF0FF250   SW T7, -3504(T8)
332:                 	PMD3 = 0xFFFFFFFF;
9D027B1C  3C19BF81   LUI T9, -16511
9D027B20  AF2FF260   SW T7, -3488(T9)
333:                 	PMD4 = 0xFFFFFFFF;
9D027B24  3C07BF81   LUI A3, -16511
9D027B28  ACEFF270   SW T7, -3472(A3)
334:                 	PMD5 = 0xFFFFFFFF;
9D027B2C  3C05BF81   LUI A1, -16511
9D027B30  ACAFF280   SW T7, -3456(A1)
335:                 	PMD6 = 0xFFFFFFFF;
9D027B34  3C04BF81   LUI A0, -16511
9D027B38  AC8FF290   SW T7, -3440(A0)
336:                 	SYSKEY = 0x0;            // Write invalid key to force lock
9D027B3C  3C03BF81   LUI V1, -16511
9D027B40  AC60F230   SW ZERO, -3536(V1)
337:                 	SYSKEY = 0xAA996655;     // Write Key1 to SYSKEY
9D027B44  3C06AA99   LUI A2, -21863
9D027B48  24C86655   ADDIU T0, A2, 26197
9D027B4C  AC68F230   SW T0, -3536(V1)
338:                 	SYSKEY = 0x556699AA;     // Write Key2 to SYSKEY
9D027B50  3C095566   LUI T1, 21862
9D027B54  352A99AA   ORI T2, T1, -26198
9D027B58  AC6AF230   SW T2, -3536(V1)
339:                 	OSCCONSET = 0x10; // set Power-Saving mode to Slee
9D027B5C  240B0010   ADDIU T3, ZERO, 16
9D027B60  3C0CBF81   LUI T4, -16511
9D027B64  AD8BF008   SW T3, -4088(T4)
340:                 	SYSKEY = 0x0; // Write invalid key to force lock
9D027B68  AC60F230   SW ZERO, -3536(V1)
341:                 
342:                 	IFS0bits.INT2IF = 0;
9D027B6C  3C0DBF88   LUI T5, -16504
9D027B70  8DAF1030   LW T7, 4144(T5)
9D027B74  7C0F6B44   INS T7, ZERO, 13, 1
9D027B78  ADAF1030   SW T7, 4144(T5)
343:                 	IEC0bits.INT2IE = 1;
9D027B7C  3C03BF88   LUI V1, -16504
9D027B80  8C661060   LW A2, 4192(V1)
9D027B84  7C466B44   INS A2, V0, 13, 1
9D027B88  AC661060   SW A2, 4192(V1)
344:                 	IPC2bits.INT2IP = 4;
9D027B8C  3C02BF88   LUI V0, -16504
9D027B90  8C4810B0   LW T0, 4272(V0)
9D027B94  24090004   ADDIU T1, ZERO, 4
9D027B98  7D28E684   INS T0, T1, 26, 3
9D027B9C  AC4810B0   SW T0, 4272(V0)
345:                 	//asm volatile("wait"); 
346:                 	IEC0bits.INT2IE = 0;
9D027BA0  8C6A1060   LW T2, 4192(V1)
9D027BA4  7C0A6B44   INS T2, ZERO, 13, 1
9D027BA8  AC6A1060   SW T2, 4192(V1)
347:                 	PMD1 = 0;
9D027BAC  ADC0F240   SW ZERO, -3520(T6)
348:                 	PMD2 = 0;
9D027BB0  AF00F250   SW ZERO, -3504(T8)
349:                 	PMD3 = 0;
9D027BB4  AF20F260   SW ZERO, -3488(T9)
350:                 	PMD4 = 0;
9D027BB8  ACE0F270   SW ZERO, -3472(A3)
351:                 	PMD5 = 0;
9D027BBC  ACA0F280   SW ZERO, -3456(A1)
352:                 	PMD6 = 0;
9D027BC0  AC80F290   SW ZERO, -3440(A0)
353:                 	hw_init();
9D027BC4  0F409CFC   JAL hw_init
9D027BC8  00000000   NOP
354:                 	start_after_wake();
9D027BCC  8F8E81A4   LW T6, -32348(GP)
9D027BD0  01C0F809   JALR T6
9D027BD4  00000000   NOP
355:                 	}
9D027BD8  8FBF0014   LW RA, 20(SP)
9D027BDC  03E00008   JR RA
9D027BE0  27BD0018   ADDIU SP, SP, 24
356:                 
357:                 
358:                 
359:                 void hw_init (void)
360:                 	{
9D0273F0  27BDFFE0   ADDIU SP, SP, -32
9D0273F4  AFBF001C   SW RA, 28(SP)
9D0273F8  AFB20018   SW S2, 24(SP)
9D0273FC  AFB10014   SW S1, 20(SP)
361:                     SYSTEMConfigPerformance(SYS_CLK);
362:                     OSCCONbits.FRCDIV = 0b000;
9D0274B0  3C05BF81   LUI A1, -16511
9D0274B4  8CA6F000   LW A2, -4096(A1)
9D0274B8  7C06D604   INS A2, ZERO, 24, 3
9D0274BC  ACA6F000   SW A2, -4096(A1)
363:                 	ANSELB = 0;
9D0274C0  3C07BF88   LUI A3, -16504
9D0274C4  ACE06100   SW ZERO, 24832(A3)
364:                 	ANSELC = 0;
9D0274C8  3C08BF88   LUI T0, -16504
9D0274CC  AD006200   SW ZERO, 25088(T0)
365:                 	ANSELD = 0;
9D0274D0  3C09BF88   LUI T1, -16504
9D0274D4  AD206300   SW ZERO, 25344(T1)
366:                 	ANSELE = 0;
9D0274D8  3C0ABF88   LUI T2, -16504
9D0274DC  AD406400   SW ZERO, 25600(T2)
367:                 	ANSELF = 0;
9D0274E0  3C0BBF88   LUI T3, -16504
9D0274E4  AD606500   SW ZERO, 25856(T3)
368:                 	ANSELG = 0;
9D0274E8  3C0CBF88   LUI T4, -16504
9D0274EC  AD806600   SW ZERO, 26112(T4)
369:                 	TRISD = 0;
9D0274F0  3C0DBF88   LUI T5, -16504
9D0274F4  ADA06310   SW ZERO, 25360(T5)
370:                 	TRISDbits.TRISD9 = 1;
9D0274F8  3C0EBF88   LUI T6, -16504
9D0274FC  95CF6310   LHU T7, 25360(T6)
9D027500  7E0F4A44   INS T7, S0, 9, 1
9D027504  A5CF6310   SH T7, 25360(T6)
371:                 	TRISDbits.TRISD10 = 1;
9D027508  95D86310   LHU T8, 25360(T6)
9D02750C  7E185284   INS T8, S0, 10, 1
9D027510  A5D86310   SH T8, 25360(T6)
372:                     TRISE = 0;
9D027514  3C11BF88   LUI S1, -16504
9D027518  AE206410   SW ZERO, 25616(S1)
373:                     TRISG = 0;
9D02751C  3C12BF88   LUI S2, -16504
9D027520  AE406610   SW ZERO, 26128(S2)
374:                 	TRISGbits.TRISG6 = 1;
9D027524  3C19BF88   LUI T9, -16504
9D027528  97226610   LHU V0, 26128(T9)
9D02752C  7E023184   INS V0, S0, 6, 1
9D027530  A7226610   SH V0, 26128(T9)
375:                 	TRISGbits.TRISG9 = 1;
9D027534  97236610   LHU V1, 26128(T9)
9D027538  7E034A44   INS V1, S0, 9, 1
9D02753C  A7236610   SH V1, 26128(T9)
376:                     TRISF = 0;
9D027540  3C04BF88   LUI A0, -16504
9D027544  AC806510   SW ZERO, 25872(A0)
377:                 	TRISFbits.TRISF5 = 1;
9D027548  3C05BF88   LUI A1, -16504
9D02754C  90A66510   LBU A2, 25872(A1)
9D027550  7E062944   INS A2, S0, 5, 1
9D027554  A0A66510   SB A2, 25872(A1)
378:                     TRISB = 0x0FFF; 
9D027558  24070FFF   ADDIU A3, ZERO, 4095
9D02755C  3C08BF88   LUI T0, -16504
9D027560  AD076110   SW A3, 24848(T0)
379:                     CNPUB = 0x0FFF;
9D027564  3C09BF88   LUI T1, -16504
9D027568  AD276150   SW A3, 24912(T1)
380:                     CNPUDbits.CNPUD10 = 1;
9D02756C  3C0ABF88   LUI T2, -16504
9D027570  954B6350   LHU T3, 25424(T2)
9D027574  7E0B5284   INS T3, S0, 10, 1
9D027578  A54B6350   SH T3, 25424(T2)
381:                     CNPUDbits.CNPUD9 = 1;
9D02757C  954C6350   LHU T4, 25424(T2)
9D027580  7E0C4A44   INS T4, S0, 9, 1
9D027584  A54C6350   SH T4, 25424(T2)
382:                 	TRISCbits.TRISC12 = 0;
9D027588  3C0DBF88   LUI T5, -16504
9D02758C  95AF6210   LHU T7, 25104(T5)
9D027590  7C0F6304   INS T7, ZERO, 12, 1
9D027594  A5AF6210   SH T7, 25104(T5)
383:                 	TRISDbits.TRISD8 = 0;
9D027598  95D86310   LHU T8, 25360(T6)
9D02759C  7C184204   INS T8, ZERO, 8, 1
9D0275A0  A5D86310   SH T8, 25360(T6)
384:                 	FLASH_WP = 1;
9D0275A4  3C11BF88   LUI S1, -16504
9D0275A8  962E6330   LHU T6, 25392(S1)
9D0275AC  7E0E4204   INS T6, S0, 8, 1
9D0275B0  A62E6330   SH T6, 25392(S1)
385:                 	FLASH_HOLD = 1;
9D0275B4  3C12BF88   LUI S2, -16504
9D0275B8  96596230   LHU T9, 25136(S2)
9D0275BC  7E196304   INS T9, S0, 12, 1
9D0275C0  A6596230   SH T9, 25136(S2)
386:                 	CS_FLASH = 1;
9D0275C4  3C03BF88   LUI V1, -16504
9D0275C8  90626530   LBU V0, 25904(V1)
9D0275CC  7E021084   INS V0, S0, 2, 1
9D0275D0  A0626530   SB V0, 25904(V1)
387:                     /*
388:                     MOSI	F3	
389:                     MISO	F5	
390:                     SCK		F6	
391:                 			C13	
392:                 			C14	
393:                      */
394:                     PPSUnLock;
395:                     PPSOutput(4, RPF3, SDO1);	//MOSI for FLASH
9D0275D4  3C04BF81   LUI A0, -16511
9D0275D8  9085FC4C   LBU A1, -948(A0)
9D0275DC  24060008   ADDIU A2, ZERO, 8
9D0275E0  7CC51804   INS A1, A2, 0, 4
9D0275E4  A085FC4C   SB A1, -948(A0)
396:                 	PPSInput(1, SDI1, RPF5);	//MISO for FLASH
9D0275E8  3C08BF81   LUI T0, -16511
9D0275EC  9107FA84   LBU A3, -1404(T0)
9D0275F0  24090002   ADDIU T1, ZERO, 2
9D0275F4  7D271804   INS A3, T1, 0, 4
9D0275F8  A107FA84   SB A3, -1404(T0)
397:                 								//SCK is fixed
398:                 	PPSInput(1, U3RX, RPC13);	//RX pin
9D0275FC  3C0ABF81   LUI T2, -16511
9D027600  914BFA60   LBU T3, -1440(T2)
9D027604  240C0007   ADDIU T4, ZERO, 7
9D027608  7D8B1804   INS T3, T4, 0, 4
9D02760C  A14BFA60   SB T3, -1440(T2)
399:                 	PPSOutput(1, RPC14, U3TX);	//TX pin
9D027610  3C0FBF81   LUI T7, -16511
9D027614  91F8FBB8   LBU T8, -1096(T7)
9D027618  7E181804   INS T8, S0, 0, 4
9D02761C  A1F8FBB8   SB T8, -1096(T7)
400:                 	PPSInput(3, INT2, RPG6);	//power on/off, tie to external interrupt2
9D027620  3C0EBF81   LUI T6, -16511
9D027624  91D9FA08   LBU T9, -1528(T6)
9D027628  7E191804   INS T9, S0, 0, 4
9D02762C  A1D9FA08   SB T9, -1528(T6)
401:                     PPSLock;
402:                 
403:                 	U3MODEbits.ON = 1;
9D027630  3C02BF80   LUI V0, -16512
9D027634  94446400   LHU A0, 25600(V0)
9D027638  7E047BC4   INS A0, S0, 15, 1
9D02763C  A4446400   SH A0, 25600(V0)
404:                 //	U1MODEbits.STSEL = 1;
405:                     U3STAbits.URXEN = 1;
9D027640  3C05BF80   LUI A1, -16512
9D027644  8CA66410   LW A2, 25616(A1)
9D027648  7E066304   INS A2, S0, 12, 1
9D02764C  ACA66410   SW A2, 25616(A1)
406:                     U3STAbits.UTXEN = 1;
9D027650  8CA86410   LW T0, 25616(A1)
9D027654  7E085284   INS T0, S0, 10, 1
9D027658  ACA86410   SW T0, 25616(A1)
407:                     U3BRG = ((PB_CLK)/(16*19200)) - 1;
9D02765C  240A009B   ADDIU T2, ZERO, 155
9D027660  3C07BF80   LUI A3, -16512
9D027664  ACEA6440   SW T2, 25664(A3)
408:                 //    INTEnable(INT_SOURCE_UART_RX(UART3), INT_ENABLED);
409:                 //    IPC7bits.U3IP = 6;
410:                     U3STAbits.OERR=0;
9D027668  8CAB6410   LW T3, 25616(A1)
9D02766C  7C0B0844   INS T3, ZERO, 1, 1
9D027670  ACAB6410   SW T3, 25616(A1)
411:                 
412:                 	SPI1CONbits.MSTEN = 1;
9D027674  3C0CBF80   LUI T4, -16512
9D027678  8D8F5800   LW T7, 22528(T4)
9D02767C  7E0F2944   INS T7, S0, 5, 1
9D027680  AD8F5800   SW T7, 22528(T4)
413:                     SPI1CONbits.CKP = 0;
9D027684  8D985800   LW T8, 22528(T4)
9D027688  7C183184   INS T8, ZERO, 6, 1
9D02768C  AD985800   SW T8, 22528(T4)
414:                     SPI1CONbits.SMP = 0;
9D027690  8D8E5800   LW T6, 22528(T4)
9D027694  7C0E4A44   INS T6, ZERO, 9, 1
9D027698  AD8E5800   SW T6, 22528(T4)
415:                     SPI1CONbits.CKE = 1;
9D02769C  8D995800   LW T9, 22528(T4)
9D0276A0  7E194204   INS T9, S0, 8, 1
9D0276A4  AD995800   SW T9, 22528(T4)
416:                     SPI1BRG = 1;
9D0276A8  3C02BF80   LUI V0, -16512
9D0276AC  AC505830   SW S0, 22576(V0)
417:                     SPI1CONbits.ON = 1;
9D0276B0  8D845800   LW A0, 22528(T4)
9D0276B4  7E047BC4   INS A0, S0, 15, 1
9D0276B8  AD845800   SW A0, 22528(T4)
418:                     
419:                 //    TRISBbits.TRISB13 = 0;
420:                     LCD_BKLT = 1;
9D0276BC  90656530   LBU A1, 25904(V1)
9D0276C0  7E050004   INS A1, S0, 0, 1
9D0276C4  A0656530   SB A1, 25904(V1)
421:                     LCD_PWR = 0;
9D0276C8  96436230   LHU V1, 25136(S2)
9D0276CC  7C037BC4   INS V1, ZERO, 15, 1
9D0276D0  A6436230   SH V1, 25136(S2)
422:                 	TRISCbits.TRISC15 = 0;
9D0276D4  95B26210   LHU S2, 25104(T5)
9D0276D8  7C127BC4   INS S2, ZERO, 15, 1
9D0276DC  A5B26210   SH S2, 25104(T5)
423:                 	
424:                     PR5 = 12 *(FPB / 64 / 1000);
9D0276E0  240D2328   ADDIU T5, ZERO, 9000
9D0276E4  3C06BF80   LUI A2, -16512
9D0276E8  ACCD0E20   SW T5, 3616(A2)
425:                     T5CONbits.TCKPS = 0b110;
9D0276EC  3C08BF80   LUI T0, -16512
9D0276F0  950A0E00   LHU T2, 3584(T0)
9D0276F4  240B0006   ADDIU T3, ZERO, 6
9D0276F8  7D6A3104   INS T2, T3, 4, 3
9D0276FC  A50A0E00   SH T2, 3584(T0)
426:                     T5CONbits.TON = 1;
9D027700  95070E00   LHU A3, 3584(T0)
9D027704  7E077BC4   INS A3, S0, 15, 1
9D027708  A5070E00   SH A3, 3584(T0)
427:                     IEC0bits.T5IE = 1;	
9D02770C  3C0CBF88   LUI T4, -16504
9D027710  8D8F1060   LW T7, 4192(T4)
9D027714  7E0FC604   INS T7, S0, 24, 1
9D027718  AD8F1060   SW T7, 4192(T4)
428:                     IPC5bits.T5IP = 3;
9D02771C  3C18BF88   LUI T8, -16504
9D027720  8F0E10E0   LW T6, 4320(T8)
9D027724  24190003   ADDIU T9, ZERO, 3
9D027728  7F2E2084   INS T6, T9, 2, 3
9D02772C  AF0E10E0   SW T6, 4320(T8)
429:                 
430:                     IEC0bits.T2IE = 1;	
9D027730  8D821060   LW V0, 4192(T4)
9D027734  7E024A44   INS V0, S0, 9, 1
9D027738  AD821060   SW V0, 4192(T4)
431:                     IPC2bits.T2IP = 6;
9D02773C  3C04BF88   LUI A0, -16504
9D027740  8C8510B0   LW A1, 4272(A0)
9D027744  7D652084   INS A1, T3, 2, 3
9D027748  AC8510B0   SW A1, 4272(A0)
432:                     IEC0bits.T3IE = 1;	
9D02774C  8D831060   LW V1, 4192(T4)
9D027750  7E037384   INS V1, S0, 14, 1
9D027754  AD831060   SW V1, 4192(T4)
433:                     IPC3bits.T3IP = 6;
9D027758  3C12BF88   LUI S2, -16504
9D02775C  8E4D10C0   LW T5, 4288(S2)
9D027760  7D6D2084   INS T5, T3, 2, 3
9D027764  AE4D10C0   SW T5, 4288(S2)
434:                     IEC0bits.T4IE = 1;	
9D027768  8D861060   LW A2, 4192(T4)
9D02776C  7E069CC4   INS A2, S0, 19, 1
9D027770  AD861060   SW A2, 4192(T4)
435:                     IPC4bits.T4IP = 6;
9D027774  3C08BF88   LUI T0, -16504
9D027778  8D0A10D0   LW T2, 4304(T0)
9D02777C  7D6A2084   INS T2, T3, 2, 3
9D027780  AD0A10D0   SW T2, 4304(T0)
436:                 
437:                     PR1 = (1*(FPB / 64 / 1000)) - 1;
9D027784  240B02ED   ADDIU T3, ZERO, 749
9D027788  3C07BF80   LUI A3, -16512
9D02778C  ACEB0620   SW T3, 1568(A3)
438:                     T1CONbits.TCKPS = 0b10;	//Prescale 64 makes 1ms = 750 ticks at 48 MHz
9D027790  3C0FBF80   LUI T7, -16512
9D027794  95F80600   LHU T8, 1536(T7)
9D027798  7D382904   INS T8, T1, 4, 2
9D02779C  A5F80600   SH T8, 1536(T7)
439:                     T1CONbits.TON = 1;
9D0277A0  95E90600   LHU T1, 1536(T7)
9D0277A4  7E097BC4   INS T1, S0, 15, 1
9D0277A8  A5E90600   SH T1, 1536(T7)
440:                     IEC0bits.T1IE = 1;
9D0277AC  8D8E1060   LW T6, 4192(T4)
9D0277B0  7E0E2104   INS T6, S0, 4, 1
9D0277B4  AD8E1060   SW T6, 4192(T4)
441:                     IPC1bits.T1IP = 4;
9D0277B8  3C0CBF88   LUI T4, -16504
9D0277BC  8D9910A0   LW T9, 4256(T4)
9D0277C0  24020004   ADDIU V0, ZERO, 4
9D0277C4  7C592084   INS T9, V0, 2, 3
9D0277C8  AD9910A0   SW T9, 4256(T4)
442:                 
443:                 	sound_set_generator(0,0);
9D0277CC  00002021   ADDU A0, ZERO, ZERO
9D0277D0  0F409CA7   JAL sound_set_generator
9D0277D4  00002821   ADDU A1, ZERO, ZERO
444:                 	sound_set_generator(0,1);
9D0277D8  00002021   ADDU A0, ZERO, ZERO
9D0277DC  0F409CA7   JAL sound_set_generator
9D0277E0  24050001   ADDIU A1, ZERO, 1
445:                 	sound_set_generator(0,2);
9D0277E4  00002021   ADDU A0, ZERO, ZERO
9D0277E8  0F409CA7   JAL sound_set_generator
9D0277EC  24050002   ADDIU A1, ZERO, 2
446:                 	GEN_ENABLE = 1;
9D0277F0  96246330   LHU A0, 25392(S1)
9D0277F4  7E045AC4   INS A0, S0, 11, 1
9D0277F8  A6246330   SH A0, 25392(S1)
447:                     INTEnableSystemMultiVectoredInt();
9D0277FC  0F41083D   JAL INTEnableSystemMultiVectoredInt
9D027800  3C10BF81   LUI S0, -16511
448:                 	
449:                 	//wait_ms(50);
450:                     //TFT_24_7789_Init();
451:                 	//tft_fill_area(0,0,320,240,0);	//fill with black color
452:                 	//wait_ms(80);					//wait a moment to avoid flicker
453:                 	//LCD_BKLT = 0;					//turn backlight on
454:                 	//fl_rst_pb();
455:                 
456:                 	//if reset is after POR or manual reset, forget LED state
457:                 	if ((RCONbits.BOR)|(RCONbits.EXTR)|(RCONbits.POR))
9D027804  8E11F600   LW S1, -2560(S0)
9D027808  7E320040   EXT S2, S1, 1, 1
9D02780C  8E05F600   LW A1, -2560(S0)
9D027810  7CAD01C0   EXT T5, A1, 7, 1
9D027814  8E03F600   LW V1, -2560(S0)
9D027818  30660001   ANDI A2, V1, 1
9D02781C  01B24025   OR T0, T5, S2
9D027820  00C85025   OR T2, A2, T0
9D027824  11400004   BEQ T2, ZERO, 0x9D027838
9D027828  00000000   NOP
458:                 		{
459:                 		RCON = 0;
9D02782C  3C1FBF81   LUI RA, -16511
9D027830  AFE0F600   SW ZERO, -2560(RA)
460:                 		led_state = 0;
9D027834  A380805C   SB ZERO, -32676(GP)
461:                 		}
462:                 	set_led_word(led_state);	
9D027838  0F409C65   JAL set_led_word
9D02783C  9384805C   LBU A0, -32676(GP)
463:                 	
464:                   	}
9D027840  0B409E3C   J 0x9D0278F0
9D027844  8FBF001C   LW RA, 28(SP)
9D0278F0  8FB20018   LW S2, 24(SP)
9D0278F4  8FB10014   LW S1, 20(SP)
9D0278F8  8FB00010   LW S0, 16(SP)
9D0278FC  03E00008   JR RA
9D027900  27BD0020   ADDIU SP, SP, 32
465:                 
466:                 
467:                 uint8_t keyb_tasks (void)
468:                 	{
9D027BE4  27BDFFE8   ADDIU SP, SP, -24
9D027BE8  AFBF0014   SW RA, 20(SP)
469:                 	static int8_t shift=0;
470:                 	uint8_t retval = 0;
9D027D80  00001021   ADDU V0, ZERO, ZERO
9D027F10  00001021   ADDU V0, ZERO, ZERO
471:                 	rnd_var3 = rnd_var3 + 12345;
9D027BEC  978281B2   LHU V0, -32334(GP)
9D027BF0  24433039   ADDIU V1, V0, 12345
472:                 	rnd_var2 = rnd_var2 + millis();
9D027BF4  0F4073D7   JAL millis
9D027BF8  A78381B2   SH V1, -32334(GP)
9D027BFC  978481AE   LHU A0, -32338(GP)
9D027C00  00442821   ADDU A1, V0, A0
9D027C04  A78581AE   SH A1, -32338(GP)
473:                 	K_R1 = 1;
9D027C08  3C06BF88   LUI A2, -16504
9D027C0C  94C76130   LHU A3, 24880(A2)
9D027C10  24080001   ADDIU T0, ZERO, 1
9D027C14  7D076304   INS A3, T0, 12, 1
9D027C18  A4C76130   SH A3, 24880(A2)
474:                 	K_R2 = 1;
9D027C1C  94C96130   LHU T1, 24880(A2)
9D027C20  7D096B44   INS T1, T0, 13, 1
9D027C24  A4C96130   SH T1, 24880(A2)
475:                 	K_R3 = 1;
9D027C28  94CA6130   LHU T2, 24880(A2)
9D027C2C  7D0A7384   INS T2, T0, 14, 1
9D027C30  A4CA6130   SH T2, 24880(A2)
476:                 	K_R4 = 1;
9D027C34  94CB6130   LHU T3, 24880(A2)
9D027C38  7D0B7BC4   INS T3, T0, 15, 1
9D027C3C  A4CB6130   SH T3, 24880(A2)
477:                 	K_R5 = 1;
9D027C40  3C0CBF88   LUI T4, -16504
9D027C44  918D6530   LBU T5, 25904(T4)
9D027C48  7D0D2104   INS T5, T0, 4, 1
9D027C4C  A18D6530   SB T5, 25904(T4)
478:                 	if (key_state==0) key = 255;
9D027C50  938E805D   LBU T6, -32675(GP)
9D027C54  15C00009   BNE T6, ZERO, 0x9D027C7C
9D027C58  240F0001   ADDIU T7, ZERO, 1
9D027C5C  2404FFFF   ADDIU A0, ZERO, -1
9D027C60  A38481B1   SB A0, -32335(GP)
479:                 	
480:                 	if (key_state==0) K_R1 = 0;
9D027C64  3C05BF88   LUI A1, -16504
9D027C68  94A66130   LHU A2, 24880(A1)
9D027C6C  7C066304   INS A2, ZERO, 12, 1
9D027C70  A4A66130   SH A2, 24880(A1)
481:                 	if (key_state==1) K_R2 = 0;
9D027C7C  15CF0006   BNE T6, T7, 0x9D027C98
9D027C80  3C02BF88   LUI V0, -16504
9D027C84  94436130   LHU V1, 24880(V0)
9D027C88  7C036B44   INS V1, ZERO, 13, 1
9D027C8C  A4436130   SH V1, 24880(V0)
482:                 	if (key_state==2) K_R3 = 0;
9D027C98  24180002   ADDIU T8, ZERO, 2
9D027C9C  15D80006   BNE T6, T8, 0x9D027CB8
9D027CA0  3C19BF88   LUI T9, -16504
9D027CA4  973F6130   LHU RA, 24880(T9)
9D027CA8  7C1F7384   INS RA, ZERO, 14, 1
9D027CAC  A73F6130   SH RA, 24880(T9)
483:                 	if (key_state==3) K_R4 = 0;
9D027C74  0B409F2F   J 0x9D027CBC
9D027C78  24070003   ADDIU A3, ZERO, 3
9D027CB8  24070003   ADDIU A3, ZERO, 3
9D027CBC  15C70006   BNE T6, A3, 0x9D027CD8
9D027CC0  3C18BF88   LUI T8, -16504
9D027CC4  97196130   LHU T9, 24880(T8)
9D027CC8  7C197BC4   INS T9, ZERO, 15, 1
9D027CCC  A7196130   SH T9, 24880(T8)
484:                 	if (key_state==4) K_R5 = 0;
9D027C90  0B409F37   J 0x9D027CDC
9D027C94  24080004   ADDIU T0, ZERO, 4
9D027CD8  24080004   ADDIU T0, ZERO, 4
9D027CDC  15C80006   BNE T6, T0, 0x9D027CF8
9D027CE0  3C0ABF88   LUI T2, -16504
9D027CE4  914F6530   LBU T7, 25904(T2)
9D027CE8  7C0F2104   INS T7, ZERO, 4, 1
9D027CEC  A14F6530   SB T7, 25904(T2)
485:                 
486:                 	if (key_state==5)
9D027CB0  0B409F3F   J 0x9D027CFC
9D027CB4  24090005   ADDIU T1, ZERO, 5
9D027CF8  24090005   ADDIU T1, ZERO, 5
9D027CFC  15C90024   BNE T6, T1, 0x9D027D90
9D027D00  938A81B1   LBU T2, -32335(GP)
487:                 		{
488:                 		if ((key<255)&(key_last!=key))
9D027D04  938B81B6   LBU T3, -32330(GP)
9D027D08  116A001D   BEQ T3, T2, 0x9D027D80
9D027D0C  394C00FF   XORI T4, T2, 255
9D027D10  1180001B   BEQ T4, ZERO, 0x9D027D80
9D027D14  3C0DBF88   LUI T5, -16504
489:                 			{
490:                 			if (K_SHIFTL==0) key_char = keys_shift_l[key];
9D027D18  8DAE6320   LW T6, 25376(T5)
9D027D1C  31CF0400   ANDI T7, T6, 1024
9D027D20  15E00007   BNE T7, ZERO, 0x9D027D40
9D027D24  3C18BF88   LUI T8, -16504
9D027D28  3C0B9D04   LUI T3, -25340
9D027D2C  256CC2B0   ADDIU T4, T3, -15696
9D027D30  014C6821   ADDU T5, T2, T4
9D027D34  91AE0000   LBU T6, 0(T5)
9D027D38  0B409F5E   J 0x9D027D78
9D027D3C  A38E81B0   SB T6, -32336(GP)
491:                 			else if (K_SHIFTR==0) key_char = keys_shift_r[key];
9D027D40  8F196320   LW T9, 25376(T8)
9D027D44  333F0200   ANDI RA, T9, 512
9D027D48  57E00007   BNEL RA, ZERO, 0x9D027D68
9D027D4C  3C029D04   LUI V0, -25340
9D027D50  3C069D04   LUI A2, -25340
9D027D54  24C7C27C   ADDIU A3, A2, -15748
9D027D58  01474021   ADDU T0, T2, A3
9D027D5C  91090000   LBU T1, 0(T0)
9D027D60  0B409F5E   J 0x9D027D78
9D027D64  A38981B0   SB T1, -32336(GP)
492:                 			else key_char = keys_normal[key];
9D027D68  2443C2E4   ADDIU V1, V0, -15644
9D027D6C  01432021   ADDU A0, T2, V1
9D027D70  90850000   LBU A1, 0(A0)
9D027D74  A38581B0   SB A1, -32336(GP)
493:                 			retval = key_char;
9D027D78  0B409F61   J 0x9D027D84
9D027D7C  938281B0   LBU V0, -32336(GP)
494:                 			}
495:                 		key_last = key;
9D027D84  A38A81B6   SB T2, -32330(GP)
9D027D88  0B409FC5   J 0x9D027F14
9D027D8C  A380805D   SB ZERO, -32675(GP)
496:                 		key_state = 0;
497:                 		}
498:                 	else
499:                 		{
500:                 		if (K_C1==0)	key = 0 + (key_state*10);
9D027CD0  0B409F65   J 0x9D027D94
9D027CD4  3C1FBF88   LUI RA, -16504
9D027CF0  0B409F65   J 0x9D027D94
9D027CF4  3C1FBF88   LUI RA, -16504
9D027D90  3C1FBF88   LUI RA, -16504
9D027D94  8FE26120   LW V0, 24864(RA)
9D027D98  30430800   ANDI V1, V0, 2048
9D027D9C  14600005   BNE V1, ZERO, 0x9D027DB4
9D027DA0  3C07BF88   LUI A3, -16504
9D027DA4  000E2840   SLL A1, T6, 1
9D027DA8  00052080   SLL A0, A1, 2
9D027DAC  00A43021   ADDU A2, A1, A0
9D027DB0  A38681B1   SB A2, -32335(GP)
501:                 		if (K_C2==0)	key = 1 + (key_state*10);
9D027DB4  8CE86120   LW T0, 24864(A3)
9D027DB8  31090400   ANDI T1, T0, 1024
9D027DBC  15200006   BNE T1, ZERO, 0x9D027DD8
9D027DC0  3C0FBF88   LUI T7, -16504
9D027DC4  000E5840   SLL T3, T6, 1
9D027DC8  000B6080   SLL T4, T3, 2
9D027DCC  016C6821   ADDU T5, T3, T4
9D027DD0  25AA0001   ADDIU T2, T5, 1
9D027DD4  A38A81B1   SB T2, -32335(GP)
502:                 		if (K_C3==0)	key = 2 + (key_state*10);
9D027DD8  8DF86120   LW T8, 24864(T7)
9D027DDC  33190200   ANDI T9, T8, 512
9D027DE0  17200006   BNE T9, ZERO, 0x9D027DFC
9D027DE4  3C04BF88   LUI A0, -16504
9D027DE8  000EF840   SLL RA, T6, 1
9D027DEC  001F1080   SLL V0, RA, 2
9D027DF0  03E21821   ADDU V1, RA, V0
9D027DF4  24650002   ADDIU A1, V1, 2
9D027DF8  A38581B1   SB A1, -32335(GP)
503:                 		if (K_C4==0)	key = 3 + (key_state*10);
9D027DFC  8C866120   LW A2, 24864(A0)
9D027E00  30C70100   ANDI A3, A2, 256
9D027E04  14E00006   BNE A3, ZERO, 0x9D027E20
9D027E08  3C0DBF88   LUI T5, -16504
9D027E0C  000E4040   SLL T0, T6, 1
9D027E10  00084880   SLL T1, T0, 2
9D027E14  01095821   ADDU T3, T0, T1
9D027E18  256C0003   ADDIU T4, T3, 3
9D027E1C  A38C81B1   SB T4, -32335(GP)
504:                 		if (K_C5==0)	key = 4 + (key_state*10);
9D027E20  8DAA6120   LW T2, 24864(T5)
9D027E24  314F0080   ANDI T7, T2, 128
9D027E28  15E00006   BNE T7, ZERO, 0x9D027E44
9D027E2C  3C03BF88   LUI V1, -16504
9D027E30  000EC040   SLL T8, T6, 1
9D027E34  0018C880   SLL T9, T8, 2
9D027E38  0319F821   ADDU RA, T8, T9
9D027E3C  27E20004   ADDIU V0, RA, 4
9D027E40  A38281B1   SB V0, -32335(GP)
505:                 		if (K_C6==0)	key = 5 + (key_state*10);
9D027E44  8C656120   LW A1, 24864(V1)
9D027E48  30A40040   ANDI A0, A1, 64
9D027E4C  14800006   BNE A0, ZERO, 0x9D027E68
9D027E50  3C0BBF88   LUI T3, -16504
9D027E54  000E3040   SLL A2, T6, 1
9D027E58  00063880   SLL A3, A2, 2
9D027E5C  00C74021   ADDU T0, A2, A3
9D027E60  25090005   ADDIU T1, T0, 5
9D027E64  A38981B1   SB T1, -32335(GP)
506:                 		if (K_C7==0)	key = 6 + (key_state*10);
9D027E68  8D6C6120   LW T4, 24864(T3)
9D027E6C  318D0020   ANDI T5, T4, 32
9D027E70  15A00006   BNE T5, ZERO, 0x9D027E8C
9D027E74  3C1FBF88   LUI RA, -16504
9D027E78  000E5040   SLL T2, T6, 1
9D027E7C  000A7880   SLL T7, T2, 2
9D027E80  014FC021   ADDU T8, T2, T7
9D027E84  27190006   ADDIU T9, T8, 6
9D027E88  A39981B1   SB T9, -32335(GP)
507:                 		if (K_C8==0)	key = 7 + (key_state*10);
9D027E8C  8FE26120   LW V0, 24864(RA)
9D027E90  30430010   ANDI V1, V0, 16
9D027E94  14600006   BNE V1, ZERO, 0x9D027EB0
9D027E98  3C08BF88   LUI T0, -16504
9D027E9C  000E2840   SLL A1, T6, 1
9D027EA0  00052080   SLL A0, A1, 2
9D027EA4  00A43021   ADDU A2, A1, A0
9D027EA8  24C70007   ADDIU A3, A2, 7
9D027EAC  A38781B1   SB A3, -32335(GP)
508:                 		if (K_C9==0)	key = 8 + (key_state*10);
9D027EB0  8D096120   LW T1, 24864(T0)
9D027EB4  312B0008   ANDI T3, T1, 8
9D027EB8  15600006   BNE T3, ZERO, 0x9D027ED4
9D027EBC  3C18BF88   LUI T8, -16504
9D027EC0  000E6040   SLL T4, T6, 1
9D027EC4  000C6880   SLL T5, T4, 2
9D027EC8  018D5021   ADDU T2, T4, T5
9D027ECC  254F0008   ADDIU T7, T2, 8
9D027ED0  A38F81B1   SB T7, -32335(GP)
509:                 		if (K_C10==0)	key = 9 + (key_state*10);
9D027ED4  8F196120   LW T9, 24864(T8)
9D027ED8  333F0004   ANDI RA, T9, 4
9D027EDC  17E00007   BNE RA, ZERO, 0x9D027EFC
9D027EE0  938681B1   LBU A2, -32335(GP)
9D027EE4  000E1040   SLL V0, T6, 1
9D027EE8  00021880   SLL V1, V0, 2
9D027EEC  00432821   ADDU A1, V0, V1
9D027EF0  24A40009   ADDIU A0, A1, 9
9D027EF4  A38481B1   SB A0, -32335(GP)
510:                 		rnd_var1 = rnd_var1  + key;
9D027EF8  938681B1   LBU A2, -32335(GP)
9D027EFC  978781B4   LHU A3, -32332(GP)
9D027F00  00C74021   ADDU T0, A2, A3
9D027F04  A78881B4   SH T0, -32332(GP)
511:                 		key_state++;
9D027F08  25CE0001   ADDIU T6, T6, 1
9D027F0C  A38E805D   SB T6, -32675(GP)
512:                 		}
513:                 	return retval;
514:                 	}
9D027F14  8FBF0014   LW RA, 20(SP)
9D027F18  03E00008   JR RA
9D027F1C  27BD0018   ADDIU SP, SP, 24
515:                 
516:                 
517:                 
518:                 void wait_ms (uint32_t count)
519:                 	{
9D027F20  27BDFFE8   ADDIU SP, SP, -24
9D027F24  AFBF0014   SW RA, 20(SP)
9D027F28  AFB00010   SW S0, 16(SP)
520:                 	uint32_t ticks_wait;
521:                 	ticks_wait = millis() + count;
9D027F2C  0F4073D7   JAL millis
9D027F30  00808021   ADDU S0, A0, ZERO
9D027F34  00508021   ADDU S0, V0, S0
522:                 	rnd_var2 = rnd_var2  + ticks_wait;
9D027F38  978281AE   LHU V0, -32338(GP)
9D027F3C  02021821   ADDU V1, S0, V0
9D027F40  A78381AE   SH V1, -32338(GP)
523:                 	while (millis()<= ticks_wait);
9D027F44  0F4073D7   JAL millis
9D027F48  00000000   NOP
9D027F4C  0202202B   SLTU A0, S0, V0
9D027F50  1080FFFC   BEQ A0, ZERO, 0x9D027F44
9D027F54  8FBF0014   LW RA, 20(SP)
524:                 	}
9D027F58  8FB00010   LW S0, 16(SP)
9D027F5C  03E00008   JR RA
9D027F60  27BD0018   ADDIU SP, SP, 24
525:                 
526:                 unsigned char	SPI_dat (uint8_t data)
527:                 	{
528:                 	SPI1BUF = data;
9D028010  3C02BF80   LUI V0, -16512
9D028014  AC445820   SW A0, 22560(V0)
529:                 	while (SPI1STATbits.SPIRBF==0);
9D028018  3C03BF80   LUI V1, -16512
9D02801C  8C645810   LW A0, 22544(V1)
9D028020  30850001   ANDI A1, A0, 1
9D028024  10A0FFFD   BEQ A1, ZERO, 0x9D02801C
9D028028  3C06BF80   LUI A2, -16512
530:                 	return (SPI1BUF);
9D02802C  8CC75820   LW A3, 22560(A2)
531:                 	}
9D028030  03E00008   JR RA
9D028034  30E200FF   ANDI V0, A3, 255
532:                 
533:                 
534:                 uint16_t get_rnd (void)
535:                 	{
536:                 	uint32_t  var;
537:                 	static uint32_t  var_prev;
538:                 	var = rnd_var1 + rnd_var2 + rnd_var3 + (var_prev*1103515245) + 12345;
9D028038  3C0341C6   LUI V1, 16838
9D02803C  24644E6D   ADDIU A0, V1, 20077
9D028040  8F828058   LW V0, -32680(GP)
9D028044  70442802   MUL A1, V0, A0
9D028048  24A63039   ADDIU A2, A1, 12345
9D02804C  978781B4   LHU A3, -32332(GP)
9D028050  978881AE   LHU T0, -32338(GP)
9D028054  00E84821   ADDU T1, A3, T0
9D028058  978A81B2   LHU T2, -32334(GP)
9D02805C  012A5821   ADDU T3, T1, T2
9D028060  00CB6021   ADDU T4, A2, T3
539:                 	var = var & 0xFFFF;
9D028064  3182FFFF   ANDI V0, T4, -1
540:                 	var_prev = var;
541:                 	return var;
542:                 	}
9D028068  03E00008   JR RA
9D02806C  AF828058   SW V0, -32680(GP)
543:                 
544:                 void __ISR(_TIMER_2_VECTOR, IPL6AUTO) Timer2Handler(void)
545:                 //void __ISR(_TIMER_2_VECTOR, ipl6) Timer2Handler(void)
546:                 	{
9D028070  415DE800   RDPGPR SP, SP
9D028074  401B7000   MFC0 K1, EPC
9D028078  401A6002   MFC0 K0, SRSCtl
9D02807C  27BDFFE0   ADDIU SP, SP, -32
9D028080  AFBB001C   SW K1, 28(SP)
9D028084  401B6000   MFC0 K1, Status
9D028088  AFBA0014   SW K0, 20(SP)
9D02808C  AFBB0018   SW K1, 24(SP)
9D028090  7C1B7844   INS K1, ZERO, 1, 15
9D028094  377B1800   ORI K1, K1, 6144
9D028098  409B6000   MTC0 K1, Status
9D02809C  AFA30008   SW V1, 8(SP)
9D0280A0  AFA20004   SW V0, 4(SP)
9D0280A4  AFA4000C   SW A0, 12(SP)
547:                     IFS0bits.T2IF = 0;
9D0280A8  3C02BF88   LUI V0, -16504
9D0280AC  8C431030   LW V1, 4144(V0)
9D0280B0  7C034A44   INS V1, ZERO, 9, 1
9D0280B4  AC431030   SW V1, 4144(V0)
548:                 	GEN_0_PIN = ~ GEN_0_PIN;
9D0280B8  3C02BF88   LUI V0, -16504
9D0280BC  8C446330   LW A0, 25392(V0)
9D0280C0  7C840040   EXT A0, A0, 1, 1
9D0280C4  38840001   XORI A0, A0, 1
9D0280C8  94436330   LHU V1, 25392(V0)
9D0280CC  7C830844   INS V1, A0, 1, 1
9D0280D0  A4436330   SH V1, 25392(V0)
549:                 	rnd_var3++;
9D0280D4  978281B2   LHU V0, -32334(GP)
9D0280D8  24420001   ADDIU V0, V0, 1
9D0280DC  A78281B2   SH V0, -32334(GP)
550:                 	}
9D0280E0  8FA20014   LW V0, 20(SP)
9D0280E4  3042000F   ANDI V0, V0, 15
9D0280E8  14400004   BNE V0, ZERO, 0x9D0280FC
9D0280EC  00000000   NOP
9D0280F0  8FA4000C   LW A0, 12(SP)
9D0280F4  8FA30008   LW V1, 8(SP)
9D0280F8  8FA20004   LW V0, 4(SP)
9D0280FC  41606000   DI ZERO
9D028100  000000C0   EHB
9D028104  8FBA001C   LW K0, 28(SP)
9D028108  8FBB0018   LW K1, 24(SP)
9D02810C  409A7000   MTC0 K0, EPC
9D028110  8FBA0014   LW K0, 20(SP)
9D028114  27BD0020   ADDIU SP, SP, 32
9D028118  409A6002   MTC0 K0, SRSCtl
9D02811C  41DDE800   WRPGPR SP, SP
9D028120  409B6000   MTC0 K1, Status
9D028124  42000018   ERET
551:                 void __ISR(_TIMER_3_VECTOR, IPL6AUTO) Timer3Handler(void)
552:                 //void __ISR(_TIMER_3_VECTOR, ipl6) Timer3Handler(void)
553:                 	{
9D028128  415DE800   RDPGPR SP, SP
9D02812C  401B7000   MFC0 K1, EPC
9D028130  401A6002   MFC0 K0, SRSCtl
9D028134  27BDFFE0   ADDIU SP, SP, -32
9D028138  AFBB001C   SW K1, 28(SP)
9D02813C  401B6000   MFC0 K1, Status
9D028140  AFBA0014   SW K0, 20(SP)
9D028144  AFBB0018   SW K1, 24(SP)
9D028148  7C1B7844   INS K1, ZERO, 1, 15
9D02814C  377B1800   ORI K1, K1, 6144
9D028150  409B6000   MTC0 K1, Status
9D028154  AFA30008   SW V1, 8(SP)
9D028158  AFA20004   SW V0, 4(SP)
9D02815C  AFA4000C   SW A0, 12(SP)
554:                     IFS0bits.T3IF = 0;
9D028160  3C02BF88   LUI V0, -16504
9D028164  8C431030   LW V1, 4144(V0)
9D028168  7C037384   INS V1, ZERO, 14, 1
9D02816C  AC431030   SW V1, 4144(V0)
555:                 	GEN_1_PIN = ~ GEN_1_PIN;
9D028170  3C02BF88   LUI V0, -16504
9D028174  8C446330   LW A0, 25392(V0)
9D028178  7C840080   EXT A0, A0, 2, 1
9D02817C  38840001   XORI A0, A0, 1
9D028180  94436330   LHU V1, 25392(V0)
9D028184  7C831084   INS V1, A0, 2, 1
9D028188  A4436330   SH V1, 25392(V0)
556:                 	rnd_var3++;
9D02818C  978281B2   LHU V0, -32334(GP)
9D028190  24420001   ADDIU V0, V0, 1
9D028194  A78281B2   SH V0, -32334(GP)
557:                 	}
9D028198  8FA20014   LW V0, 20(SP)
9D02819C  3042000F   ANDI V0, V0, 15
9D0281A0  14400004   BNE V0, ZERO, 0x9D0281B4
9D0281A4  00000000   NOP
9D0281A8  8FA4000C   LW A0, 12(SP)
9D0281AC  8FA30008   LW V1, 8(SP)
9D0281B0  8FA20004   LW V0, 4(SP)
9D0281B4  41606000   DI ZERO
9D0281B8  000000C0   EHB
9D0281BC  8FBA001C   LW K0, 28(SP)
9D0281C0  8FBB0018   LW K1, 24(SP)
9D0281C4  409A7000   MTC0 K0, EPC
9D0281C8  8FBA0014   LW K0, 20(SP)
9D0281CC  27BD0020   ADDIU SP, SP, 32
9D0281D0  409A6002   MTC0 K0, SRSCtl
9D0281D4  41DDE800   WRPGPR SP, SP
9D0281D8  409B6000   MTC0 K1, Status
9D0281DC  42000018   ERET
558:                 void __ISR(_TIMER_4_VECTOR, IPL6AUTO) Timer4Handler(void)
559:                 //void __ISR(_TIMER_4_VECTOR, ipl6) Timer4Handler(void)
560:                 	{
9D0281E0  415DE800   RDPGPR SP, SP
9D0281E4  401B7000   MFC0 K1, EPC
9D0281E8  401A6002   MFC0 K0, SRSCtl
9D0281EC  27BDFFE0   ADDIU SP, SP, -32
9D0281F0  AFBB001C   SW K1, 28(SP)
9D0281F4  401B6000   MFC0 K1, Status
9D0281F8  AFBA0014   SW K0, 20(SP)
9D0281FC  AFBB0018   SW K1, 24(SP)
9D028200  7C1B7844   INS K1, ZERO, 1, 15
9D028204  377B1800   ORI K1, K1, 6144
9D028208  409B6000   MTC0 K1, Status
9D02820C  AFA30008   SW V1, 8(SP)
9D028210  AFA20004   SW V0, 4(SP)
9D028214  AFA4000C   SW A0, 12(SP)
561:                     IFS0bits.T4IF = 0;
9D028218  3C02BF88   LUI V0, -16504
9D02821C  8C431030   LW V1, 4144(V0)
9D028220  7C039CC4   INS V1, ZERO, 19, 1
9D028224  AC431030   SW V1, 4144(V0)
562:                 	GEN_2_PIN = ~ GEN_2_PIN;
9D028228  3C02BF88   LUI V0, -16504
9D02822C  8C446330   LW A0, 25392(V0)
9D028230  7C8400C0   EXT A0, A0, 3, 1
9D028234  38840001   XORI A0, A0, 1
9D028238  94436330   LHU V1, 25392(V0)
9D02823C  7C8318C4   INS V1, A0, 3, 1
9D028240  A4436330   SH V1, 25392(V0)
563:                 	rnd_var3++;
9D028244  978281B2   LHU V0, -32334(GP)
9D028248  24420001   ADDIU V0, V0, 1
9D02824C  A78281B2   SH V0, -32334(GP)
564:                 	}
9D028250  8FA20014   LW V0, 20(SP)
9D028254  3042000F   ANDI V0, V0, 15
9D028258  14400004   BNE V0, ZERO, 0x9D02826C
9D02825C  00000000   NOP
9D028260  8FA4000C   LW A0, 12(SP)
9D028264  8FA30008   LW V1, 8(SP)
9D028268  8FA20004   LW V0, 4(SP)
9D02826C  41606000   DI ZERO
9D028270  000000C0   EHB
9D028274  8FBA001C   LW K0, 28(SP)
9D028278  8FBB0018   LW K1, 24(SP)
9D02827C  409A7000   MTC0 K0, EPC
9D028280  8FBA0014   LW K0, 20(SP)
9D028284  27BD0020   ADDIU SP, SP, 32
9D028288  409A6002   MTC0 K0, SRSCtl
9D02828C  41DDE800   WRPGPR SP, SP
9D028290  409B6000   MTC0 K1, Status
9D028294  42000018   ERET
565:                 
566:                 void exp_set(uint8_t pos, uint8_t val)
567:                 	{
568:                 	if (pos==0) EXP_0_OUT = val;
9D028298  14800007   BNE A0, ZERO, 0x9D0282B8
9D02829C  24020001   ADDIU V0, ZERO, 1
9D0282A0  3C08BF88   LUI T0, -16504
9D0282A4  95036630   LHU V1, 26160(T0)
9D0282A8  7CA31084   INS V1, A1, 2, 1
9D0282AC  A5036630   SH V1, 26160(T0)
569:                 	if (pos==1) EXP_1_OUT = val;
9D0282B8  14820006   BNE A0, V0, 0x9D0282D4
9D0282BC  3C07BF88   LUI A3, -16504
9D0282C0  94E36630   LHU V1, 26160(A3)
9D0282C4  7CA318C4   INS V1, A1, 3, 1
9D0282C8  A4E36630   SH V1, 26160(A3)
9D0282CC  03E00008   JR RA
9D0282D0  00000000   NOP
570:                 	if (pos==2) EXP_2_OUT = val;
9D0282D4  24060002   ADDIU A2, ZERO, 2
9D0282D8  14860007   BNE A0, A2, 0x9D0282F8
9D0282DC  24090003   ADDIU T1, ZERO, 3
9D0282E0  3C04BF88   LUI A0, -16504
9D0282E4  94836130   LHU V1, 24880(A0)
9D0282E8  7CA30004   INS V1, A1, 0, 1
9D0282EC  A4836130   SH V1, 24880(A0)
9D0282F0  03E00008   JR RA
9D0282F4  00000000   NOP
571:                 	if (pos==3) EXP_3_OUT = val;
9D0282B0  0B40A0BE   J 0x9D0282F8
9D0282B4  24090003   ADDIU T1, ZERO, 3
9D0282F8  14890005   BNE A0, T1, 0x9D028310
9D0282FC  00000000   NOP
9D028300  3C0ABF88   LUI T2, -16504
9D028304  95436130   LHU V1, 24880(T2)
9D028308  7CA30844   INS V1, A1, 1, 1
9D02830C  A5436130   SH V1, 24880(T2)
9D028310  03E00008   JR RA
9D028314  00000000   NOP
572:                 	}
573:                 
574:                 void exp_ddr(uint8_t pos, uint8_t val)
575:                 	{
576:                 	if (pos==0) EXP_0_T = val;
9D028318  14800007   BNE A0, ZERO, 0x9D028338
9D02831C  24020001   ADDIU V0, ZERO, 1
9D028320  3C08BF88   LUI T0, -16504
9D028324  95036610   LHU V1, 26128(T0)
9D028328  7CA31084   INS V1, A1, 2, 1
9D02832C  A5036610   SH V1, 26128(T0)
577:                 	if (pos==1) EXP_1_T = val;
9D028338  14820006   BNE A0, V0, 0x9D028354
9D02833C  3C07BF88   LUI A3, -16504
9D028340  94E36610   LHU V1, 26128(A3)
9D028344  7CA318C4   INS V1, A1, 3, 1
9D028348  A4E36610   SH V1, 26128(A3)
9D02834C  03E00008   JR RA
9D028350  00000000   NOP
578:                 	if (pos==2) EXP_2_T = val;
9D028354  24060002   ADDIU A2, ZERO, 2
9D028358  14860007   BNE A0, A2, 0x9D028378
9D02835C  24090003   ADDIU T1, ZERO, 3
9D028360  3C04BF88   LUI A0, -16504
9D028364  94836110   LHU V1, 24848(A0)
9D028368  7CA30004   INS V1, A1, 0, 1
9D02836C  A4836110   SH V1, 24848(A0)
9D028370  03E00008   JR RA
9D028374  00000000   NOP
579:                 	if (pos==3) EXP_3_T = val;
9D028330  0B40A0DE   J 0x9D028378
9D028334  24090003   ADDIU T1, ZERO, 3
9D028378  14890005   BNE A0, T1, 0x9D028390
9D02837C  00000000   NOP
9D028380  3C0ABF88   LUI T2, -16504
9D028384  95436110   LHU V1, 24848(T2)
9D028388  7CA30844   INS V1, A1, 1, 1
9D02838C  A5436110   SH V1, 24848(T2)
9D028390  03E00008   JR RA
9D028394  00000000   NOP
580:                 	}
581:                 
582:                 uint8_t exp_get (uint8_t pos)
583:                 	{
584:                 	if (pos==0) return EXP_0_IN;
9D028398  54800005   BNEL A0, ZERO, 0x9D0283B0
9D02839C  24020001   ADDIU V0, ZERO, 1
9D0283A0  3C0BBF88   LUI T3, -16504
9D0283A4  8D6C6620   LW T4, 26144(T3)
9D0283A8  03E00008   JR RA
9D0283AC  7D820080   EXT V0, T4, 2, 1
585:                 	if (pos==1) return EXP_1_IN;
9D0283B0  14820005   BNE A0, V0, 0x9D0283C8
9D0283B4  24050002   ADDIU A1, ZERO, 2
9D0283B8  3C09BF88   LUI T1, -16504
9D0283BC  8D2A6620   LW T2, 26144(T1)
9D0283C0  03E00008   JR RA
9D0283C4  7D4200C0   EXT V0, T2, 3, 1
586:                 	if (pos==2) return EXP_2_IN;
9D0283C8  14850005   BNE A0, A1, 0x9D0283E0
9D0283CC  24030003   ADDIU V1, ZERO, 3
9D0283D0  3C07BF88   LUI A3, -16504
9D0283D4  8CE86120   LW T0, 24864(A3)
9D0283D8  03E00008   JR RA
9D0283DC  31020001   ANDI V0, T0, 1
587:                 	if (pos==3) return EXP_3_IN;
9D0283E0  14830004   BNE A0, V1, 0x9D0283F4
9D0283E4  00001021   ADDU V0, ZERO, ZERO
9D0283E8  3C04BF88   LUI A0, -16504
9D0283EC  8C866120   LW A2, 24864(A0)
9D0283F0  7CC20040   EXT V0, A2, 1, 1
588:                 	return 0;
589:                 	}
9D0283F4  03E00008   JR RA
9D0283F8  00000000   NOP
590:                 
591:                 void serial_flush (void)
592:                 	{
9D028414  27BDFFE8   ADDIU SP, SP, -24
9D028418  AFBF0014   SW RA, 20(SP)
9D02841C  AFB00010   SW S0, 16(SP)
593:                 	while (rx_sta()) rx_read();
9D028420  0B40A10B   J .LBE87, .LBE86
9D028424  3C10BF80   LUI S0, -16512
9D02842C  0F40A0FF   JAL rx_sta
9D028430  00000000   NOP
9D028434  1440FFFC   BNE V0, ZERO, .LBB86, .LBB87
9D028438  3C02BF80   LUI V0, -16512
594:                 	if (U3STAbits.OERR) U3STAbits.OERR = 0;
9D02843C  8C446410   LW A0, 25616(V0)
9D028440  30850002   ANDI A1, A0, 2
9D028444  50A00008   BEQL A1, ZERO, .LBE89, .LBE88
9D028448  3C10BF80   LUI S0, -16512
9D02844C  3C06BF80   LUI A2, -16512
9D028450  8CC36410   LW V1, 25616(A2)
9D028454  7C030844   INS V1, ZERO, 1, 1
9D028458  ACC36410   SW V1, 25616(A2)
595:                 	while (rx_sta()) rx_read();
9D028468  0F40A0FF   JAL rx_sta
9D02846C  00000000   NOP
9D028470  1440FFFC   BNE V0, ZERO, .LBB88, .LBB89
9D028474  8FBF0014   LW RA, 20(SP)
596:                 	}
9D028478  8FB00010   LW S0, 16(SP)
9D02847C  03E00008   JR RA
9D028480  27BD0018   ADDIU SP, SP, 24
597:                 
598:                 uint8_t rx_sta (void)
599:                 	{
600:                 	if (U3STAbits.URXDA==1) return 0xFF;
9D0283FC  3C02BF80   LUI V0, -16512
9D028400  8C446410   LW A0, 25616(V0)
9D028404  30850001   ANDI A1, A0, 1
9D028408  00053023   SUBU A2, ZERO, A1
601:                 	else return 0x00;
602:                 	}
9D02840C  03E00008   JR RA
9D028410  30C200FF   ANDI V0, A2, 255
603:                 
604:                 uint8_t rx_read (void)
605:                 	{
606:                 	uint8_t data;
607:                 	data = U3RXREG;
9D028428  8E026430   LW V0, 25648(S0)
9D02845C  0B40A11A   J .LBE89, .LBE88
9D028460  3C10BF80   LUI S0, -16512
9D028464  8E026430   LW V0, 25648(S0)
9D028484  3C02BF80   LUI V0, -16512
9D028488  8C446430   LW A0, 25648(V0)
608:                 	return data;
609:                 	}
9D02848C  03E00008   JR RA
9D028490  308200FF   ANDI V0, A0, 255
610:                 void tx_write (uint8_t data)
611:                 	{   
612:                 	U3TXREG = data;
9D028494  3C02BF80   LUI V0, -16512
9D028498  AC446420   SW A0, 25632(V0)
613:                 	while (U3STAbits.UTXBF==1); 
9D02849C  3C03BF80   LUI V1, -16512
9D0284A0  8C646410   LW A0, 25616(V1)
9D0284A4  30850200   ANDI A1, A0, 512
9D0284A8  14A0FFFD   BNE A1, ZERO, 0x9D0284A0
9D0284AC  00000000   NOP
614:                 	}
9D0284B0  03E00008   JR RA
9D0284B4  00000000   NOP
615:                 
---  /Users/nitro/basic-badge/firmware/badge1.X/src/disp.c  ---------------------------------------------
1:                   #include <xc.h>
2:                   #include "hw.h"
3:                   #include "disp.h"
4:                   #include "vt100.h"
5:                   #include <stdint.h>
6:                   
7:                   
8:                   const int8_t font[(96+128)*12] = 
9:                   {
10:                  0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000,   
11:                  0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0000000, 0b0001000, 0b0000000, 0b0000000,   
12:                  0b0101000, 0b0101000, 0b0101000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000,   
13:                  0b0010100, 0b0010100, 0b0010100, 0b1111111, 0b0010100, 0b0010100, 0b1111111, 0b0010100, 0b0010100, 0b0010100, 0b0000000, 0b0000000,   
14:                  0b0010100, 0b0111110, 0b1010101, 0b1010100, 0b0111110, 0b0010101, 0b0010101, 0b1010101, 0b0111110, 0b0010100, 0b0000000, 0b0000000,   
15:                  0b0000000, 0b1110000, 0b1010001, 0b1110010, 0b0000100, 0b0001000, 0b0010000, 0b0100111, 0b1000101, 0b0000111, 0b0000000, 0b0000000,   
16:                  0b0111000, 0b1000100, 0b1000100, 0b1001000, 0b0110000, 0b0110000, 0b1001000, 0b1000101, 0b1000010, 0b0111101, 0b0000000, 0b0000000,   
17:                  0b0011000, 0b0011000, 0b0010000, 0b0100000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000,   
18:                  0b0000010, 0b0000100, 0b0001000, 0b0010000, 0b0010000, 0b0010000, 0b0010000, 0b0001000, 0b0000100, 0b0000010, 0b0000000, 0b0000000,   
19:                  0b0100000, 0b0010000, 0b0001000, 0b0000100, 0b0000100, 0b0000100, 0b0000100, 0b0001000, 0b0010000, 0b0100000, 0b0000000, 0b0000000,   
20:                  0b0000000, 0b0001000, 0b1001001, 0b0101010, 0b0011100, 0b1111111, 0b0011100, 0b0101010, 0b1001001, 0b0001000, 0b0000000, 0b0000000,   
21:                  0b0000000, 0b0000000, 0b0001000, 0b0001000, 0b0001000, 0b1111111, 0b0001000, 0b0001000, 0b0001000, 0b0000000, 0b0000000, 0b0000000,   
22:                  0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0011000, 0b0011000, 0b0010000, 0b0100000, 0b0000000, 0b0000000,   
23:                  0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b1111111, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000,   
24:                  0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0110000, 0b0110000, 0b0000000, 0b0000000,   
25:                  0b0000000, 0b0000000, 0b0000001, 0b0000010, 0b0000100, 0b0001000, 0b0010000, 0b0100000, 0b1000000, 0b0000000, 0b0000000, 0b0000000,   
26:                  0b0011100, 0b0100010, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0100010, 0b0011100, 0b0000000, 0b0000000,   
27:                  0b0001000, 0b0011000, 0b0101000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0111110, 0b0000000, 0b0000000,   
28:                  0b0111110, 0b1000001, 0b1000001, 0b0000001, 0b0000010, 0b0000100, 0b0001000, 0b0010000, 0b0100000, 0b1111111, 0b0000000, 0b0000000,   
29:                  0b0111110, 0b1000001, 0b0000001, 0b0000010, 0b0001100, 0b0000010, 0b0000001, 0b0000001, 0b1000001, 0b0111110, 0b0000000, 0b0000000,   
30:                  0b0000010, 0b0000110, 0b0001010, 0b0010010, 0b0100010, 0b1000010, 0b1000010, 0b1111111, 0b0000010, 0b0000010, 0b0000000, 0b0000000,   
31:                  0b1111111, 0b1000000, 0b1000000, 0b1111100, 0b0000010, 0b0000001, 0b0000001, 0b0000001, 0b1000010, 0b0111100, 0b0000000, 0b0000000,   
32:                  0b0001110, 0b0010000, 0b0100000, 0b1000000, 0b1111110, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0111110, 0b0000000, 0b0000000,   
33:                  0b1111111, 0b0000001, 0b0000001, 0b0000010, 0b0000100, 0b0001000, 0b0010000, 0b0100000, 0b0100000, 0b0100000, 0b0000000, 0b0000000,   
34:                  0b0111110, 0b1000001, 0b1000001, 0b0100010, 0b0011100, 0b0100010, 0b1000001, 0b1000001, 0b1000001, 0b0111110, 0b0000000, 0b0000000,   
35:                  0b0111110, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0111111, 0b0000001, 0b0000010, 0b0000100, 0b0111000, 0b0000000, 0b0000000,   
36:                  0b0000000, 0b0011000, 0b0011000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0011000, 0b0011000, 0b0000000, 0b0000000, 0b0000000,   
37:                  0b0000000, 0b0011000, 0b0011000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0011000, 0b0011000, 0b0010000, 0b0000000, 0b0000000,   
38:                  0b0000000, 0b0000010, 0b0000100, 0b0001000, 0b0010000, 0b0100000, 0b0010000, 0b0001000, 0b0000100, 0b0000010, 0b0000000, 0b0000000,   
39:                  0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b1111111, 0b0000000, 0b1111111, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000,   
40:                  0b0000000, 0b0100000, 0b0010000, 0b0001000, 0b0000100, 0b0000010, 0b0000100, 0b0001000, 0b0010000, 0b0100000, 0b0000000, 0b0000000,   
41:                  0b0111110, 0b1000001, 0b0000001, 0b0000010, 0b0000100, 0b0001000, 0b0010000, 0b0010000, 0b0000000, 0b0010000, 0b0000000, 0b0000000,   
42:                  0b0011100, 0b0100010, 0b1000001, 0b1001001, 0b1010101, 0b1010110, 0b1001000, 0b1000000, 0b0100001, 0b0011110, 0b0000000, 0b0000000,   
43:                  0b0001000, 0b0010100, 0b0100010, 0b1000001, 0b1000001, 0b1000001, 0b1111111, 0b1000001, 0b1000001, 0b1000001, 0b0000000, 0b0000000,   
44:                  0b1111110, 0b1000001, 0b1000001, 0b1000010, 0b1111100, 0b1000010, 0b1000001, 0b1000001, 0b1000001, 0b1111110, 0b0000000, 0b0000000,   
45:                  0b0111110, 0b1000001, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b1000001, 0b0111110, 0b0000000, 0b0000000,   
46:                  0b1111100, 0b1000010, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000010, 0b1111100, 0b0000000, 0b0000000,  
47:                  0b1111111, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b1111110, 0b1000000, 0b1000000, 0b1000000, 0b1111111, 0b0000000, 0b0000000,   
48:                  0b1111111, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b1111110, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b0000000, 0b0000000,   
49:                  0b0111110, 0b1000001, 0b1000000, 0b1000000, 0b1000000, 0b1001111, 0b1000001, 0b1000001, 0b1000001, 0b0111110, 0b0000000, 0b0000000,   
50:                  0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1111111, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0000000, 0b0000000,   
51:                  0b0011100, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0011100, 0b0000000, 0b0000000,   
52:                  0b0000001, 0b0000001, 0b0000001, 0b0000001, 0b0000001, 0b0000001, 0b1000001, 0b1000001, 0b0100010, 0b0011100, 0b0000000, 0b0000000,   
53:                  0b1000001, 0b1000010, 0b1000100, 0b1001000, 0b1110000, 0b1010000, 0b1001000, 0b1000100, 0b1000010, 0b1000001, 0b0000000, 0b0000000,   
54:                  0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b1111111, 0b0000000, 0b0000000,   
55:                  0b1000001, 0b1100011, 0b1010101, 0b1001001, 0b1001001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0000000, 0b0000000,   
56:                  0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1100001, 0b1010001, 0b1001001, 0b1000101, 0b1000011, 0b1000001, 0b0000000, 0b0000000,   
57:                  0b0111110, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0111110, 0b0000000, 0b0000000,   
58:                  0b1111110, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1111110, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b0000000, 0b0000000,   
59:                  0b0111110, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000101, 0b1000010, 0b0111101, 0b0000000, 0b0000000,   
60:                  0b1111110, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1111110, 0b1001000, 0b1000100, 0b1000010, 0b1000001, 0b0000000, 0b0000000,   
61:                  0b0111110, 0b1000001, 0b1000000, 0b0100000, 0b0011100, 0b0000010, 0b0000001, 0b0000001, 0b1000001, 0b0111110, 0b0000000, 0b0000000,   
62:                  0b1111111, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0000000, 0b0000000,   
63:                  0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0111110, 0b0000000, 0b0000000,   
64:                  0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0100010, 0b0010100, 0b0001000, 0b0000000, 0b0000000,   
65:                  0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1001001, 0b1010101, 0b1100011, 0b1000001, 0b0000000, 0b0000000,   
66:                  0b1000001, 0b1000001, 0b1000001, 0b0100010, 0b0010100, 0b0001000, 0b0010100, 0b0100010, 0b1000001, 0b1000001, 0b0000000, 0b0000000,   
67:                  0b1000001, 0b1000001, 0b1000001, 0b0100010, 0b0010100, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0000000, 0b0000000,   
68:                  0b1111111, 0b0000001, 0b0000001, 0b0000010, 0b0000100, 0b0001000, 0b0010000, 0b0100000, 0b1000000, 0b1111111, 0b0000000, 0b0000000,   
69:                  0b0011100, 0b0010000, 0b0010000, 0b0010000, 0b0010000, 0b0010000, 0b0010000, 0b0010000, 0b0010000, 0b0011100, 0b0000000, 0b0000000,   
70:                  0b0000000, 0b0000000, 0b1000000, 0b0100000, 0b0010000, 0b0001000, 0b0000100, 0b0000010, 0b0000001, 0b0000000, 0b0000000, 0b0000000,   
71:                  0b0011100, 0b0000100, 0b0000100, 0b0000100, 0b0000100, 0b0000100, 0b0000100, 0b0000100, 0b0000100, 0b0011100, 0b0000000, 0b0000000,   
72:                  0b0001000, 0b0010100, 0b0100010, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000,   
73:                  0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b1111111, 0b0000000, 0b0000000,   
74:                  0b0010000, 0b0001000, 0b0000100, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000,   
75:                  0b0000000, 0b0000000, 0b0000000, 0b0111100, 0b0000010, 0b0000001, 0b0111111, 0b1000001, 0b1000011, 0b0111101, 0b0000000, 0b0000000,   
76:                  0b1000000, 0b1000000, 0b1000000, 0b1111100, 0b1000010, 0b1000001, 0b1000001, 0b1000001, 0b1000010, 0b1111100, 0b0000000, 0b0000000,   
77:                  0b0000000, 0b0000000, 0b0000000, 0b0011111, 0b0100000, 0b1000000, 0b1000000, 0b1000000, 0b0100000, 0b0011111, 0b0000000, 0b0000000,   
78:                  0b0000001, 0b0000001, 0b0000001, 0b0011111, 0b0100001, 0b1000001, 0b1000001, 0b1000001, 0b0100001, 0b0011111, 0b0000000, 0b0000000,   
79:                  0b0000000, 0b0000000, 0b0000000, 0b0111110, 0b1000001, 0b1000001, 0b1111111, 0b1000000, 0b1000000, 0b0111111, 0b0000000, 0b0000000,   
80:                  0b0000110, 0b0001000, 0b0001000, 0b0001000, 0b0011110, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0011100, 0b0000000, 0b0000000,   
81:                  0b0000000, 0b0000000, 0b0000000, 0b0011100, 0b0100010, 0b1000001, 0b1000001, 0b0100001, 0b0011111, 0b0000001, 0b0000001, 0b0011110,   
82:                  0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b1011100, 0b1100010, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0000000, 0b0000000,   
83:                  0b0000000, 0b0001000, 0b0000000, 0b0011000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0011100, 0b0000000, 0b0000000,   
84:                  0b0000000, 0b0000100, 0b0000000, 0b0001100, 0b0000100, 0b0000100, 0b0000100, 0b0000100, 0b0000100, 0b0000100, 0b0100100, 0b0011000,   
85:                  0b1000000, 0b1000000, 0b1000000, 0b1000011, 0b1000100, 0b1001000, 0b1011000, 0b1100100, 0b1000010, 0b1000001, 0b0000000, 0b0000000,   
86:                  0b0011000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0011100, 0b0000000, 0b0000000,   
87:                  0b0000000, 0b0000000, 0b0000000, 0b1010110, 0b1101001, 0b1001001, 0b1001001, 0b1001001, 0b1001001, 0b1001001, 0b0000000, 0b0000000,   
88:                  0b0000000, 0b0000000, 0b0000000, 0b1011100, 0b1100010, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0000000, 0b0000000,   
89:                  0b0000000, 0b0000000, 0b0000000, 0b0011100, 0b0100010, 0b1000001, 0b1000001, 0b1000001, 0b0100010, 0b0011100, 0b0000000, 0b0000000,   
90:                  0b0000000, 0b0000000, 0b0000000, 0b1111100, 0b1000010, 0b1000001, 0b1000001, 0b1000010, 0b1111100, 0b1000000, 0b1000000, 0b1000000,   
91:                  0b0000000, 0b0000000, 0b0000000, 0b0011111, 0b0100001, 0b1000001, 0b1000001, 0b0100001, 0b0011111, 0b0000001, 0b0000001, 0b0000001,   
92:                  0b0000000, 0b0000000, 0b0000000, 0b1011110, 0b1100001, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b0000000, 0b0000000,   
93:                  0b0000000, 0b0000000, 0b0000000, 0b0111111, 0b1000000, 0b1000000, 0b0111110, 0b0000001, 0b0000001, 0b1111110, 0b0000000, 0b0000000,   
94:                  0b0010000, 0b0010000, 0b0010000, 0b0111100, 0b0010000, 0b0010000, 0b0010000, 0b0010000, 0b0010010, 0b0001100, 0b0000000, 0b0000000,   
95:                  0b0000000, 0b0000000, 0b0000000, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000011, 0b0111101, 0b0000000, 0b0000000,   
96:                  0b0000000, 0b0000000, 0b0000000, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0100010, 0b0010100, 0b0001000, 0b0000000, 0b0000000,   
97:                  0b0000000, 0b0000000, 0b0000000, 0b1000001, 0b1000001, 0b1000001, 0b1001001, 0b1010101, 0b1100011, 0b1000001, 0b0000000, 0b0000000,   
98:                  0b0000000, 0b0000000, 0b0000000, 0b1000001, 0b0100010, 0b0010100, 0b0001000, 0b0010100, 0b0100010, 0b1000001, 0b0000000, 0b0000000,   
99:                  0b0000000, 0b0000000, 0b0000000, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0100001, 0b0011111, 0b0000001, 0b0000010, 0b0111100,   
100:                 0b0000000, 0b0000000, 0b0000000, 0b1111111, 0b0000010, 0b0000100, 0b0001000, 0b0010000, 0b0100000, 0b1111111, 0b0000000, 0b0000000,   
101:                 0b0000110, 0b0001000, 0b0001000, 0b0001000, 0b0010000, 0b0100000, 0b0010000, 0b0001000, 0b0001000, 0b0001000, 0b0000110, 0b0000000,   
102:                 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0000000, 0b0000000,   
103:                 0b0110000, 0b0001000, 0b0001000, 0b0001000, 0b0000100, 0b0000010, 0b0000100, 0b0001000, 0b0001000, 0b0001000, 0b0110000, 0b0000000,   
104:                 0b0000000, 0b0000000, 0b0000000, 0b0110000, 0b1001000, 0b0001001, 0b0000110, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000,   
105:                 0b1111111, 0b1111111, 0b1111111, 0b1111111, 0b1111111, 0b1111111, 0b1111111, 0b1111111, 0b1111111, 0b1111111, 0b0000000, 0b0000000,
106:                 
107:                 0b0011100, 0b0100010, 0b1000001, 0b1000000, 0b1000000, 0b1000000, 0b1000000, 0b1000001, 0b0100010, 0b0011100, 0b0001000, 0b0111000, 
108:                 0b0000000, 0b0100010, 0b0000000, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000011, 0b0111101, 0b0000000, 0b0000000, 
109:                 0b0000100, 0b0001000, 0b0000000, 0b0111110, 0b1000001, 0b1000001, 0b1111111, 0b1000000, 0b1000000, 0b0111111, 0b0000000, 0b0000000, 
110:                 0b0001000, 0b0010100, 0b0000000, 0b0111100, 0b0000010, 0b0000001, 0b0111111, 0b1000001, 0b1000011, 0b0111101, 0b0000000, 0b0000000, 
111:                 0b0000000, 0b0100010, 0b0000000, 0b0111100, 0b0000010, 0b0000001, 0b0111111, 0b1000001, 0b1000011, 0b0111101, 0b0000000, 0b0000000, 
112:                 0b0010000, 0b0001000, 0b0000000, 0b0111100, 0b0000010, 0b0000001, 0b0111111, 0b1000001, 0b1000011, 0b0111101, 0b0000000, 0b0000000, 
113:                 0b0001000, 0b0010100, 0b0001000, 0b0111100, 0b0000010, 0b0000001, 0b0111111, 0b1000001, 0b1000011, 0b0111101, 0b0000000, 0b0000000, 
114:                 0b0000000, 0b0000000, 0b0000000, 0b0011111, 0b0100000, 0b1000000, 0b1000000, 0b1000000, 0b0100000, 0b0011111, 0b0000100, 0b0011100, 
115:                 0b0001000, 0b0010100, 0b0000000, 0b0111110, 0b1000001, 0b1000001, 0b1111111, 0b1000000, 0b1000000, 0b0111111, 0b0000000, 0b0000000, 
116:                 0b0000000, 0b0100010, 0b0000000, 0b0111110, 0b1000001, 0b1000001, 0b1111111, 0b1000000, 0b1000000, 0b0111111, 0b0000000, 0b0000000, 
117:                 0b0001000, 0b0000100, 0b0000000, 0b0111110, 0b1000001, 0b1000001, 0b1111111, 0b1000000, 0b1000000, 0b0111111, 0b0000000, 0b0000000, 
118:                 0b0000000, 0b0100100, 0b0000000, 0b0011000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0011100, 0b0000000, 0b0000000, 
119:                 0b0001000, 0b0010100, 0b0000000, 0b0011000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0011100, 0b0000000, 0b0000000, 
120:                 0b0001000, 0b0000100, 0b0000000, 0b0011000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0011100, 0b0000000, 0b0000000, 
121:                 0b0100010, 0b0001000, 0b0010100, 0b0100010, 0b1000001, 0b1000001, 0b1111111, 0b1000001, 0b1000001, 0b1000001, 0b0000000, 0b0000000, 
122:                 0b0001000, 0b0010100, 0b0001000, 0b0010100, 0b0100010, 0b1000001, 0b1000001, 0b1111111, 0b1000001, 0b1000001, 0b0000000, 0b0000000, 
123:                 0b0001000, 0b0010000, 0b1111111, 0b1000000, 0b1000000, 0b1000000, 0b1111110, 0b1000000, 0b1000000, 0b1111111, 0b0000000, 0b0000000, 
124:                 0b0000000, 0b0000000, 0b0000000, 0b0110110, 0b0001001, 0b0001001, 0b0111111, 0b1001000, 0b1001000, 0b0111111, 0b0000000, 0b0000000, 
125:                 0b0011111, 0b0101000, 0b1001000, 0b1001000, 0b1001111, 0b1111000, 0b1001000, 0b1001000, 0b1001000, 0b1001111, 0b0000000, 0b0000000, 
126:                 0b0001000, 0b0010100, 0b0000000, 0b0011100, 0b0100010, 0b1000001, 0b1000001, 0b1000001, 0b0100010, 0b0011100, 0b0000000, 0b0000000, 
127:                 0b0000000, 0b0100010, 0b0000000, 0b0011100, 0b0100010, 0b1000001, 0b1000001, 0b1000001, 0b0100010, 0b0011100, 0b0000000, 0b0000000, 
128:                 0b0010000, 0b0001000, 0b0000000, 0b0011100, 0b0100010, 0b1000001, 0b1000001, 0b1000001, 0b0100010, 0b0011100, 0b0000000, 0b0000000, 
129:                 0b0001000, 0b0010100, 0b0000000, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000011, 0b0111101, 0b0000000, 0b0000000, 
130:                 0b0010000, 0b0001000, 0b0000000, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000011, 0b0111101, 0b0000000, 0b0000000, 
131:                 0b0000000, 0b0100010, 0b0000000, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0100001, 0b0011111, 0b0000001, 0b0000010, 0b0111100, 
132:                 0b0100010, 0b0000000, 0b0111110, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0111110, 0b0000000, 0b0000000, 
133:                 0b0100010, 0b0000000, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0111110, 0b0000000, 0b0000000, 
134:                 0b0000000, 0b0000100, 0b0000100, 0b0011111, 0b0100100, 0b1000100, 0b1000100, 0b1000100, 0b0100100, 0b0011111, 0b0000100, 0b0000100, 
135:                 0b0111100, 0b1000010, 0b1000001, 0b0100000, 0b0100000, 0b1111000, 0b0100000, 0b0100000, 0b1000000, 0b1111111, 0b0000000, 0b0000000, 
136:                 0b1000001, 0b1000001, 0b0100010, 0b0010100, 0b0001000, 0b0001000, 0b0111110, 0b0001000, 0b0111110, 0b0001000, 0b0000000, 0b0000000, 
137:                 0b1111100, 0b1000010, 0b1000001, 0b1000010, 0b1111100, 0b1000011, 0b1010010, 0b1111101, 0b1010001, 0b1011011, 0b0000000, 0b0000000, 
138:                 0b0000000, 0b0000000, 0b0000011, 0b0000100, 0b0001000, 0b0111110, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0010000, 0b1100000, 
139:                 0b0000100, 0b0001000, 0b0000000, 0b0111100, 0b0000010, 0b0000001, 0b0111111, 0b1000001, 0b1000011, 0b0111101, 0b0000000, 0b0000000, 
140:                 0b0000100, 0b0001000, 0b0000000, 0b0011000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0011100, 0b0000000, 0b0000000, 
141:                 0b0000100, 0b0001000, 0b0000000, 0b0011100, 0b0100010, 0b1000001, 0b1000001, 0b1000001, 0b0100010, 0b0011100, 0b0000000, 0b0000000, 
142:                 0b0000100, 0b0001000, 0b0000000, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000011, 0b0111101, 0b0000000, 0b0000000, 
143:                 0b0010000, 0b0101010, 0b0000100, 0b1011100, 0b1100010, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0000000, 0b0000000, 
144:                 0b0010000, 0b0101010, 0b0000100, 0b1000001, 0b1100001, 0b1010001, 0b1001001, 0b1000101, 0b1000011, 0b1000001, 0b0000000, 0b0000000, 
145:                 0b0011100, 0b0000010, 0b0011110, 0b0100010, 0b0011110, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 
146:                 0b0011000, 0b0100100, 0b0100100, 0b0011000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 
147:                 0b0000000, 0b0001000, 0b0000000, 0b0001000, 0b0001000, 0b0010000, 0b0100000, 0b1000000, 0b1000001, 0b0100010, 0b0011100, 0b0000000, 
148:                 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b1111111, 0b1000000, 0b1000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 
149:                 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b1111111, 0b0000001, 0b0000001, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 
150:                 0b0000000, 0b0000000, 0b0100000, 0b0100001, 0b0100010, 0b0000100, 0b0001000, 0b0010111, 0b0100001, 0b1000111, 0b0000100, 0b0000111, 
151:                 0b0000000, 0b0100000, 0b0100000, 0b0100001, 0b0000010, 0b0000100, 0b0001000, 0b0010101, 0b0100101, 0b1000111, 0b0000001, 0b0000001, 
152:                 0b0000000, 0b0001000, 0b0000000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0001000, 0b0000000, 0b0000000, 
153:                 0b0000000, 0b0000000, 0b0001001, 0b0010010, 0b0100100, 0b1001000, 0b0100100, 0b0010010, 0b0001001, 0b0000000, 0b0000000, 0b0000000, 
154:                 0b0000000, 0b0000000, 0b1001000, 0b0100100, 0b0010010, 0b0001001, 0b0010010, 0b0100100, 0b1001000, 0b0000000, 0b0000000, 0b0000000, 
155:                 0b10001000, 0b00100010, 0b10001000, 0b00100010, 0b10001000, 0b00100010, 0b10001000, 0b00100010, 0b10001000, 0b00100010, 0b10001000, 
156:                 0b00100010, 0b10101010, 0b01010101, 0b10101010, 0b01010101, 0b10101010, 0b01010101, 0b10101010, 0b01010101, 0b10101010, 0b01010101, 
157:                 0b10101010, 0b01010101, 0b01110111, 0b11011101, 0b01110111, 0b11011101, 0b01110111, 0b11011101, 0b01110111, 0b11011101, 0b01110111, 
158:                 0b11011101, 0b01110111, 0b11011101, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 
159:                 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b11111000, 0b00001000, 
160:                 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b11111000, 0b00001000, 
161:                 0b00001000, 0b11111000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 
162:                 0b11100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
163:                 0b00000000, 0b11111100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00000000, 0b00000000, 0b00000000, 
164:                 0b00000000, 0b11111000, 0b00001000, 0b00001000, 0b11111000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00100100, 0b00100100, 
165:                 0b00100100, 0b00100100, 0b11100100, 0b00000100, 0b00000100, 0b11100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 
166:                 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 
167:                 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11111100, 0b00000100, 0b00000100, 0b11100100, 0b00100100, 0b00100100, 0b00100100, 
168:                 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b11100100, 0b00000100, 0b00000100, 0b11111100, 0b00000000, 0b00000000, 
169:                 0b00000000, 0b00000000, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b11111100, 0b00000000, 0b00000000, 0b00000000, 
170:                 0b00000000, 0b00000000, 0b00000000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b11111000, 0b00001000, 0b00001000, 0b11111000, 
171:                 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11111000, 0b00001000, 
172:                 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001111, 
173:                 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 
174:                 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
175:                 0b00000000, 0b11111111, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 
176:                 0b00001000, 0b00001000, 0b00001111, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00000000, 0b00000000, 
177:                 0b00000000, 0b00000000, 0b00000000, 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00001000, 
178:                 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b11111111, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 
179:                 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001111, 0b00001000, 0b00001000, 0b00001111, 0b00001000, 0b00001000, 0b00001000, 
180:                 0b00001000, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100111, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 
181:                 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100111, 0b00100000, 0b00100000, 0b00111111, 0b00000000, 
182:                 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00111111, 0b00100000, 0b00100000, 0b00100111, 
183:                 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b11100111, 0b00000000, 0b00000000, 
184:                 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11111111, 0b00000000, 
185:                 0b00000000, 0b11100111, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100111, 
186:                 0b00100000, 0b00100000, 0b00100111, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
187:                 0b11111111, 0b00000000, 0b00000000, 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00100100, 0b00100100, 0b00100100, 
188:                 0b00100100, 0b11100111, 0b00000000, 0b00000000, 0b11100111, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00001000, 0b00001000, 
189:                 0b00001000, 0b00001000, 0b11111111, 0b00000000, 0b00000000, 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00100100, 
190:                 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b11111111, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
191:                 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11111111, 0b00000000, 0b00000000, 0b11111111, 0b00001000, 0b00001000, 0b00001000, 
192:                 0b00001000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11111111, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 
193:                 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00111111, 0b00000000, 0b00000000, 0b00000000, 
194:                 0b00000000, 0b00000000, 0b00000000, 0b00010000, 0b00010000, 0b00010000, 0b00010000, 0b00011111, 0b00010000, 0b00010000, 0b00011111, 
195:                 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00011111, 0b00010000, 0b00010000, 
196:                 0b00011111, 0b00010000, 0b00010000, 0b00010000, 0b00010000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00111111, 
197:                 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 
198:                 0b11111111, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00100100, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 
199:                 0b11111111, 0b00001000, 0b00001000, 0b11111111, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 
200:                 0b00001000, 0b00001000, 0b11111000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 
201:                 0b00000000, 0b00000000, 0b00000000, 0b00001111, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b00001000, 0b11111111, 
202:                 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 
203:                 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 
204:                 0b11111111, 0b11110000, 0b11110000, 0b11110000, 0b11110000, 0b11110000, 0b11110000, 0b11110000, 0b11110000, 0b11110000, 0b11110000, 
205:                 0b11110000, 0b11110000, 0b00001111, 0b00001111, 0b00001111, 0b00001111, 0b00001111, 0b00001111, 0b00001111, 0b00001111, 0b00001111, 
206:                 0b00001111, 0b00001111, 0b00001111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b11111111, 0b00000000, 0b00000000, 
207:                 0b00000000, 0b00000000, 0b00000000, 0b00000000, 0b0000000, 0b0000000, 0b0000000, 0b0111001, 0b1000110, 0b1000010, 0b1000010, 
208:                 0b1000010, 0b1000110, 0b0111001, 0b0000000, 0b0000000, 0b0001110, 0b0010001, 0b0100001, 0b0100010, 0b0111100, 0b0100010, 
209:                 0b0100001, 0b0100001, 0b0110001, 0b0101110, 0b1000000, 0b0000000, 0b0111111, 0b0100001, 0b0100000, 0b0100000, 0b0100000, 
210:                 0b0100000, 0b0100000, 0b0100000, 0b0100000, 0b0100000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b1111111, 
211:                 0b0100010, 0b0100010, 0b0100010, 0b0100010, 0b0100010, 0b0100010, 0b0000000, 0b0000000, 0b1111111, 0b1000001, 0b0100000, 
212:                 0b0010000, 0b0001000, 0b0010000, 0b0100000, 0b1000000, 0b1000001, 0b1111111, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 
213:                 0b0000000, 0b0111111, 0b1000100, 0b1000010, 0b1000001, 0b1000001, 0b1000001, 0b0111110, 0b0000000, 0b0000000, 0b0000000, 
214:                 0b0000000, 0b0000000, 0b1000010, 0b1000010, 0b1000010, 0b1000010, 0b1000010, 0b1100010, 0b1011101, 0b1000000, 0b1000000, 
215:                 0b0000000, 0b0000000, 0b0000000, 0b1111111, 0b0010000, 0b0010000, 0b0010000, 0b0010000, 0b0010000, 0b0001110, 0b0000000, 
216:                 0b0000000, 0b0011100, 0b0001000, 0b0111110, 0b1001001, 0b1001001, 0b1001001, 0b1001001, 0b0111110, 0b0001000, 0b0011100, 
217:                 0b0000000, 0b0000000, 0b0011100, 0b0100010, 0b1000001, 0b1000001, 0b1011101, 0b1000001, 0b1000001, 0b1000001, 0b0100010, 
218:                 0b0011100, 0b0000000, 0b0000000, 0b0111110, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0100010, 
219:                 0b0100010, 0b1100011, 0b0000000, 0b0000000, 0b0000000, 0b1111111, 0b0100000, 0b0010000, 0b0011000, 0b0100100, 0b1000010, 
220:                 0b1000001, 0b1000001, 0b0111110, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0100000, 0b1010110, 0b1001001, 
221:                 0b0110101, 0b0000010, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0100000, 0b1000110, 0b1001001, 0b1001001, 
222:                 0b1001001, 0b0111110, 0b0001000, 0b0001000, 0b0001000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0111111, 
223:                 0b1000000, 0b1000000, 0b0111000, 0b1000000, 0b1000001, 0b0111110, 0b0000000, 0b0000000, 0b0011100, 0b0100010, 0b1000001, 
224:                 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b1000001, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 
225:                 0b0000000, 0b1111111, 0b0000000, 0b1111111, 0b0000000, 0b1111111, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0001000, 
226:                 0b0001000, 0b0001000, 0b1111111, 0b0001000, 0b0001000, 0b0001000, 0b0000000, 0b1111111, 0b0000000, 0b0000000, 0b0000000, 
227:                 0b0000000, 0b1000000, 0b0110000, 0b0001100, 0b0000011, 0b0001100, 0b0110000, 0b1000000, 0b0000000, 0b1111111, 0b0000000, 
228:                 0b0000000, 0b0000000, 0b0000001, 0b0000110, 0b0011000, 0b1100000, 0b0011000, 0b0000110, 0b0000001, 0b0000000, 0b1111111, 
229:                 0b0000000, 0b0000000, 0b0001100, 0b0010000, 0b0010000, 0b0010000, 0b0010000, 0b0010000, 0b0010000, 0b0010000, 0b0010000, 
230:                 0b0010000, 0b0010000, 0b0010000, 0b0000100, 0b0000100, 0b0000100, 0b0000100, 0b0000100, 0b0000100, 0b0000100, 0b0000100, 
231:                 0b0000100, 0b0000100, 0b0000100, 0b0011000, 0b0000000, 0b0000000, 0b0000000, 0b0001000, 0b0000000, 0b1111111, 0b0000000, 
232:                 0b0001000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0110000, 0b1001001, 0b0000110, 0b0000000, 
233:                 0b0110000, 0b1001001, 0b0000110, 0b0000000, 0b0000000, 0b0000000, 0b0011000, 0b0100100, 0b0100100, 0b0011000, 0b0000000, 
234:                 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 
235:                 0b0011000, 0b0111100, 0b0111100, 0b0011000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 
236:                 0b0000000, 0b0000000, 0b0001000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000111, 0b0000100, 
237:                 0b1100100, 0b0100100, 0b0100100, 0b0100100, 0b0100100, 0b0100100, 0b0010100, 0b0001000, 0b0000000, 0b0000000, 0b0101100, 
238:                 0b0110010, 0b0100010, 0b0100010, 0b0100010, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 
239:                 0b0111000, 0b0000100, 0b0011000, 0b0100000, 0b0111100, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 
240:                 0b0000000, 0b0000000, 0b0000000, 0b1111111, 0b1111111, 0b1111111, 0b1111111, 0b1111111, 0b1111111, 0b1111111, 0b0000000, 
241:                 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 0b0000000, 
242:                 0b0000000, 0b0000000, 0b0000000,
243:                 
244:                 
245:                 	};
246:                 
247:                 
248:                 uint32_t color_table[16] = {
249:                 	0x000000,	//0
250:                 	0x0000AA,	//1
251:                 	0x00AA00,	//2
252:                 	0x00AAAA,	//3
253:                 	0xAA0000,	//4
254:                 	0xAA00AA,	//5
255:                 	0xAA5500,	//6
256:                 	0xAAAAAA,	//7
257:                 	0x555555,	//8
258:                 	0x5555FF,	//9
259:                 	0x55FF55,	//10
260:                 	0x55FFFF,	//11
261:                 	0xFF5555,	//12
262:                 	0xFF55FF,	//13
263:                 	0xFFFF55,	//14
264:                 	0xFFFFFF,	//15	
265:                 	
266:                 	};
267:                 
268:                 uint16_t cursor_blink_cnt;
269:                 uint8_t cursor_blink_state, cursor_visible;
270:                 
271:                 
272:                 void set_cursor_state (uint8_t state)
273:                 	{
274:                 	if (state==0)
9D018658  14800003   BNE A0, ZERO, 0x9D018668
9D01865C  24020001   ADDIU V0, ZERO, 1
9D018660  03E00008   JR RA
9D018664  A38081AC   SB ZERO, -32340(GP)
275:                 		cursor_visible = 0;
276:                 	else
277:                 		cursor_visible = 1;
9D018668  03E00008   JR RA
9D01866C  A38281AC   SB V0, -32340(GP)
278:                 	}
279:                 
280:                 void disp_tasks (void)
281:                 	{
282:                 	cursor_blink_cnt++;
9D018670  978281AA   LHU V0, -32342(GP)
9D018674  24430001   ADDIU V1, V0, 1
9D018678  3064FFFF   ANDI A0, V1, -1
9D018688  03E00008   JR RA
9D01868C  A78481AA   SH A0, -32342(GP)
283:                 	if (cursor_blink_cnt> 40)
9D01867C  2C850029   SLTIU A1, A0, 41
9D018680  50A00003   BEQL A1, ZERO, 0x9D018690
9D018684  A78081AA   SH ZERO, -32342(GP)
284:                 		{
285:                 		cursor_blink_cnt = 0;
286:                 		if (cursor_blink_state)
9D018690  938681AD   LBU A2, -32339(GP)
9D018694  10C00003   BEQ A2, ZERO, 0x9D0186A4
9D018698  24070001   ADDIU A3, ZERO, 1
9D01869C  03E00008   JR RA
9D0186A0  A38081AD   SB ZERO, -32339(GP)
287:                 			cursor_blink_state = 0;
288:                 		else
289:                 			cursor_blink_state = 1;
9D0186A4  03E00008   JR RA
9D0186A8  A38781AD   SB A3, -32339(GP)
290:                 		}
291:                 	}
292:                 
293:                 void tft_disp_buffer_refresh(uint8_t * buff, uint8_t * color_buff)
294:                 	{
9D019C24  27BDFF88   ADDIU SP, SP, -120
9D019C28  AFBF0074   SW RA, 116(SP)
9D019C2C  AFBE0070   SW FP, 112(SP)
9D019C30  AFB7006C   SW S7, 108(SP)
9D019C34  AFB60068   SW S6, 104(SP)
9D019C38  AFB50064   SW S5, 100(SP)
9D019C3C  AFB40060   SW S4, 96(SP)
9D019C40  AFB3005C   SW S3, 92(SP)
9D019C44  AFB20058   SW S2, 88(SP)
9D019C48  AFB10054   SW S1, 84(SP)
9D019C4C  AFB00050   SW S0, 80(SP)
9D019C50  AFA40078   SW A0, 120(SP)
295:                 	uint16_t i,j,ad,col,back,cur_x,cur_y;
296:                 	cur_x = video_getx();
9D019C54  0F406DAB   JAL video_getx
9D019C58  AFA5007C   SW A1, 124(SP)
9D019C5C  3042FFFF   ANDI V0, V0, -1
297:                 	cur_y = video_gety();
9D019C60  0F406DAD   JAL .LFB47, .LFE46, video_gety
9D019C64  AFA20038   SW V0, 56(SP)
9D019C68  3043FFFF   ANDI V1, V0, -1
9D019C6C  AFA3004C   SW V1, 76(SP)
9D019C70  AFA00020   SW ZERO, 32(SP)
9D019C74  2404000B   ADDIU A0, ZERO, 11
9D019C78  AFA40044   SW A0, 68(SP)
298:                 	for (i=0;i<20;i++)
9D019C7C  AFA00048   SW ZERO, 72(SP)
9D01A6A8  8FAC0048   LW T4, 72(SP)
9D01A6AC  25980001   ADDIU T8, T4, 1
9D01A6B0  3313FFFF   ANDI S3, T8, -1
9D01A6B4  AFB30048   SW S3, 72(SP)
9D01A6B8  8FB90044   LW T9, 68(SP)
9D01A6BC  2722000C   ADDIU V0, T9, 12
9D01A6C0  AFA20044   SW V0, 68(SP)
9D01A6C4  8FA70020   LW A3, 32(SP)
9D01A6C8  24E80028   ADDIU T0, A3, 40
9D01A6CC  AFA80020   SW T0, 32(SP)
9D01A6D0  24060014   ADDIU A2, ZERO, 20
9D01A6D4  8FA90048   LW T1, 72(SP)
9D01A6D8  11260016   BEQ T1, A2, 0x9D01A734
9D01A6DC  8FBF0074   LW RA, 116(SP)
9D01A6E0  8FAA0044   LW T2, 68(SP)
9D01A6E4  314BFFFF   ANDI T3, T2, -1
9D01A6E8  256CFFF5   ADDIU T4, T3, -11
9D01A6EC  318DFFFF   ANDI T5, T4, -1
299:                 		for (j=0;j<40;j++)	
9D01A69C  240B0028   ADDIU T3, ZERO, 40
9D01A6A0  160BFD83   BNE S0, T3, 0x9D019CB0
9D01A6A4  AFAA0014   SW T2, 20(SP)
300:                 			{
301:                 			col = color_buff[j+(i*40)]&0xF;
9D019CC4  90870000   LBU A3, 0(A0)
302:                 			back = (color_buff[j+(i*40)]>>4)&0xF;
9D019CC8  00072902   SRL A1, A3, 4
303:                 			if ((cur_x==j)&(cur_y==i)&(cursor_blink_state==1)&(cursor_visible!=0))
9D019CCC  938681AC   LBU A2, -32340(GP)
9D019CD0  0006482B   SLTU T1, ZERO, A2
9D019CD4  938A81AD   LBU T2, -32339(GP)
9D019CD8  394B0001   XORI T3, T2, 1
9D019CDC  2D6C0001   SLTIU T4, T3, 1
9D019CE0  012C6824   AND T5, T1, T4
9D019CE4  8FAE0024   LW T6, 36(SP)
9D019CE8  01CD7824   AND T7, T6, T5
9D019CEC  11E00106   BEQ T7, ZERO, 0x9D01A108
9D019CF0  3068FFFF   ANDI T0, V1, -1
9D019CF4  8FB00038   LW S0, 56(SP)
9D019CF8  16080104   BNE S0, T0, 0x9D01A10C
9D019CFC  8FB30078   LW S3, 120(SP)
9D019D00  000888C0   SLL S1, T0, 3
9D019D04  3232FFFF   ANDI S2, S1, -1
9D019D08  AFB20018   SW S2, 24(SP)
9D01A71C  8FB3004C   LW S3, 76(SP)
9D01A720  8FB40048   LW S4, 72(SP)
9D01A724  0274A826   XOR S5, S3, S4
9D01A728  2EB80001   SLTIU T8, S5, 1
9D01A72C  0B40672C   J 0x9D019CB0
9D01A730  AFB80024   SW T8, 36(SP)
304:                 				tft_print_char(219,j*8,i*12,color_table[15],color_table[back]);
9D019D0C  8FB3001C   LW S3, 28(SP)
9D019D10  8E74003C   LW S4, 60(S3)
9D019D14  0005A880   SLL S5, A1, 2
9D019D18  02B3C021   ADDU T8, S5, S3
9D019D1C  8F190000   LW T9, 0(T8)
305:                 			else
306:                 				tft_print_char(buff[j+(i*40)],j*8,i*12,color_table[col],color_table[back]);
9D019C80  3C05A001   LUI A1, -24575
9D019C84  24A64E50   ADDIU A2, A1, 20048
9D019C88  AFA6001C   SW A2, 28(SP)
9D01A11C  92950000   LBU S5, 0(S4)
9D01A120  AFB50018   SW S5, 24(SP)
9D01A124  0008C0C0   SLL T8, T0, 3
9D01A128  3313FFFF   ANDI S3, T8, -1
9D01A12C  30F9000F   ANDI T9, A3, 15
9D01A130  00191080   SLL V0, T9, 2
9D01A134  8FA7001C   LW A3, 28(SP)
9D01A138  00474021   ADDU T0, V0, A3
9D01A13C  8D150000   LW S5, 0(T0)
9D01A140  00052880   SLL A1, A1, 2
9D01A144  00A73021   ADDU A2, A1, A3
9D01A148  8CC90000   LW T1, 0(A2)
307:                 			}
308:                 	}
9D01A734  8FBE0070   LW FP, 112(SP)
9D01A738  8FB7006C   LW S7, 108(SP)
9D01A73C  8FB60068   LW S6, 104(SP)
9D01A740  8FB50064   LW S5, 100(SP)
9D01A744  8FB40060   LW S4, 96(SP)
9D01A748  8FB3005C   LW S3, 92(SP)
9D01A74C  8FB20058   LW S2, 88(SP)
9D01A750  8FB10054   LW S1, 84(SP)
9D01A754  8FB00050   LW S0, 80(SP)
9D01A758  03E00008   JR RA
9D01A75C  27BD0078   ADDIU SP, SP, 120
309:                 
310:                 void tft_disp_buffer_refresh_part(uint8_t * buff, uint8_t * color_buff)
311:                 	{
9D0190AC  27BDFF90   ADDIU SP, SP, -112
9D0190B0  AFBF006C   SW RA, 108(SP)
9D0190B4  AFBE0068   SW FP, 104(SP)
9D0190B8  AFB70064   SW S7, 100(SP)
9D0190BC  AFB60060   SW S6, 96(SP)
9D0190C0  AFB5005C   SW S5, 92(SP)
9D0190C4  AFB40058   SW S4, 88(SP)
9D0190C8  AFB30054   SW S3, 84(SP)
9D0190CC  AFB20050   SW S2, 80(SP)
9D0190D0  AFB1004C   SW S1, 76(SP)
9D0190D4  AFB00048   SW S0, 72(SP)
9D0190D8  AFA40070   SW A0, 112(SP)
312:                     static uint8_t dr_cnt=0,col,back,cur_x,cur_y;
313:                 	uint16_t i,j,ad;
314:                 	cur_x = video_getx();
9D0190DC  0F406DAB   JAL video_getx
9D0190E0  AFA50074   SW A1, 116(SP)
315:                 	cur_y = video_gety();
9D0190E4  0F406DAD   JAL .LFB47, .LFE46, video_gety
9D0190E8  A3828056   SB V0, -32682(GP)
9D0190EC  A3828055   SB V0, -32683(GP)
316:                 	for (i=(dr_cnt);i<(dr_cnt+2);i++)
9D0190F0  93958054   LBU S5, -32684(GP)
9D0190F4  26A40002   ADDIU A0, S5, 2
9D0190F8  02A4182A   SLT V1, S5, A0
9D0190FC  106002B7   BEQ V1, ZERO, 0x9D019BDC
9D019100  AFB50024   SW S5, 36(SP)
9D019104  02A0C821   ADDU T9, S5, ZERO
9D019108  00151080   SLL V0, S5, 2
9D01910C  00022880   SLL A1, V0, 2
9D019110  00A23023   SUBU A2, A1, V0
9D019114  30C7FFFF   ANDI A3, A2, -1
9D019118  AFA70044   SW A3, 68(SP)
9D019B4C  8FB30024   LW S3, 36(SP)
9D019B50  26670001   ADDIU A3, S3, 1
9D019B54  30E8FFFF   ANDI T0, A3, -1
9D019B58  AFA80024   SW T0, 36(SP)
9D019B5C  0100C821   ADDU T9, T0, ZERO
9D019B60  93958054   LBU S5, -32684(GP)
9D019B64  8FAA0044   LW T2, 68(SP)
9D019B68  2549000C   ADDIU T1, T2, 12
9D019B6C  312BFFFF   ANDI T3, T1, -1
9D019B70  26B20002   ADDIU S2, S5, 2
9D019B74  0112782A   SLT T7, T0, S2
9D019B78  11E00018   BEQ T7, ZERO, 0x9D019BDC
9D019B7C  AFAB0044   SW T3, 68(SP)
317:                 		for (j=0;j<40;j++)	
9D019B40  24020028   ADDIU V0, ZERO, 40
9D019B44  1602FD81   BNE S0, V0, 0x9D01914C
9D019B48  AFAE0014   SW T6, 20(SP)
318:                 			{
319:                 			col = color_buff[j+(i*40)]&0xF;
9D019154  8FA50018   LW A1, 24(SP)
9D019158  90A80000   LBU T0, 0(A1)
9D019BB0  0019A8C0   SLL S5, T9, 3
9D019BB4  0019C140   SLL T8, T9, 5
9D019BB8  02B8C821   ADDU T9, S5, T8
9D019BBC  AFB90038   SW T9, 56(SP)
9D019BC0  8FBF0074   LW RA, 116(SP)
9D019BC4  03F92021   ADDU A0, RA, T9
9D019BC8  AFA40018   SW A0, 24(SP)
320:                 			back = (color_buff[j+(i*40)]>>4)&0xF;
321:                 			if ((cur_x==j)&(cur_y==i)&(cursor_blink_state==1)&(cursor_visible!=0))
9D01915C  938681AC   LBU A2, -32340(GP)
9D019160  0006502B   SLTU T2, ZERO, A2
9D019164  938B81AD   LBU T3, -32339(GP)
9D019168  396C0001   XORI T4, T3, 1
9D01916C  2D8D0001   SLTIU T5, T4, 1
9D019170  014D7024   AND T6, T2, T5
9D019174  938F8055   LBU T7, -32683(GP)
9D019178  8FB00024   LW S0, 36(SP)
9D01917C  01F08826   XOR S1, T7, S0
9D019180  2E320001   SLTIU S2, S1, 1
9D019184  024E9824   AND S3, S2, T6
9D019188  12600105   BEQ S3, ZERO, 0x9D0195A0
9D01918C  00084902   SRL T1, T0, 4
9D019190  93948056   LBU S4, -32682(GP)
9D019194  16870103   BNE S4, A3, 0x9D0195A4
9D019198  8FB30070   LW S3, 112(SP)
9D01919C  0007A8C0   SLL S5, A3, 3
9D0191A0  32B8FFFF   ANDI T8, S5, -1
9D0191A4  AFB8001C   SW T8, 28(SP)
322:                 				tft_print_char(219,j*8,i*12,color_table[15],color_table[back]);
9D0191A8  8FB90020   LW T9, 32(SP)
9D0191AC  8F3F003C   LW RA, 60(T9)
9D0191B0  00092080   SLL A0, T1, 2
9D0191B4  00991821   ADDU V1, A0, T9
9D0191B8  8C620000   LW V0, 0(V1)
323:                 			else
324:                 				tft_print_char(buff[j+(i*40)],j*8,i*12,color_table[col],color_table[back]);
9D01911C  3C08A001   LUI T0, -24575
9D019120  25094E50   ADDIU T1, T0, 20048
9D019124  AFA90020   SW T1, 32(SP)
9D0195B4  92950000   LBU S5, 0(S4)
9D0195B8  AFB5001C   SW S5, 28(SP)
9D0195BC  000710C0   SLL V0, A3, 3
9D0195C0  3053FFFF   ANDI S3, V0, -1
9D0195C4  3107000F   ANDI A3, T0, 15
9D0195C8  00072880   SLL A1, A3, 2
9D0195CC  8FA80020   LW T0, 32(SP)
9D0195D0  00A83021   ADDU A2, A1, T0
9D0195D4  8CD50000   LW S5, 0(A2)
9D0195D8  00094880   SLL T1, T1, 2
9D0195DC  01285021   ADDU T2, T1, T0
9D0195E0  8D4B0000   LW T3, 0(T2)
325:                 			}
326:                     dr_cnt = dr_cnt + 2;
9D019BDC  26B60002   ADDIU S6, S5, 2
9D019BE0  32D700FF   ANDI S7, S6, 255
327:                     if (dr_cnt == 20)
9D019BE4  241E0014   ADDIU FP, ZERO, 20
9D019BE8  52FE0002   BEQL S7, FP, 0x9D019BF4
9D019BEC  A3808054   SB ZERO, -32684(GP)
9D019BF0  A3978054   SB S7, -32684(GP)
328:                         dr_cnt = 0;
329:                 
330:                     }
9D019BF4  8FBF006C   LW RA, 108(SP)
9D019BF8  8FBE0068   LW FP, 104(SP)
9D019BFC  8FB70064   LW S7, 100(SP)
9D019C00  8FB60060   LW S6, 96(SP)
9D019C04  8FB5005C   LW S5, 92(SP)
9D019C08  8FB40058   LW S4, 88(SP)
9D019C0C  8FB30054   LW S3, 84(SP)
9D019C10  8FB20050   LW S2, 80(SP)
9D019C14  8FB1004C   LW S1, 76(SP)
9D019C18  8FB00048   LW S0, 72(SP)
9D019C1C  03E00008   JR RA
9D019C20  27BD0070   ADDIU SP, SP, 112
331:                 
332:                 
333:                 
334:                 inline void tft_print_char (uint8_t val, uint16_t x, uint16_t y, uint32_t col, uint32_t back)
335:                 	{
9D018AD4  27BDFFC8   ADDIU SP, SP, -56
9D018AD8  AFBF0034   SW RA, 52(SP)
9D018ADC  AFBE0030   SW FP, 48(SP)
9D018AE0  AFB7002C   SW S7, 44(SP)
9D018AE4  AFB60028   SW S6, 40(SP)
9D018AE8  AFB50024   SW S5, 36(SP)
9D018AEC  AFB40020   SW S4, 32(SP)
9D018AF0  AFB3001C   SW S3, 28(SP)
9D018AF4  AFB20018   SW S2, 24(SP)
9D018AF8  AFB10014   SW S1, 20(SP)
9D018AFC  AFB00010   SW S0, 16(SP)
9D018B00  AFA40038   SW A0, 56(SP)
9D018B04  00A0F021   ADDU FP, A1, ZERO
9D018B08  00C0B821   ADDU S7, A2, ZERO
9D018B0C  AFA70044   SW A3, 68(SP)
9D018B10  8FB20048   LW S2, 72(SP)
336:                 	uint16_t fl,i,j;
337:                 	uint16_t c1,c2,c3,b1,b2,b3;
338:                 	c1 = (col>>16)&0xFF;
9D018D28  7DCF3C00   EXT T7, T6, 16, 8
9D0191BC  7FF33C00   EXT S3, RA, 16, 8
9D019D20  7E933C00   EXT S3, S4, 16, 8
339:                 	c2 = (col>>8)&0xFF;
9D018D2C  7DD83A00   EXT T8, T6, 8, 8
9D0191C0  7FF23A00   EXT S2, RA, 8, 8
9D0197E0  7EA53A00   EXT A1, S5, 8, 8
9D019D24  7E923A00   EXT S2, S4, 8, 8
9D01A348  7EA53A00   EXT A1, S5, 8, 8
340:                 	c3 = (col>>0)&0xFF;
9D018D30  31D900FF   ANDI T9, T6, 255
9D0191C4  33F100FF   ANDI S1, RA, 255
9D0197E4  32A600FF   ANDI A2, S5, 255
9D019D28  329100FF   ANDI S1, S4, 255
9D01A34C  32B500FF   ANDI S5, S5, 255
341:                 	b1 = (back>>16)&0xFF;
9D018B14  7E503C00   EXT S0, S2, 16, 8
9D0191C8  7C503C00   EXT S0, V0, 16, 8
9D0195E4  7D743C00   EXT S4, T3, 16, 8
9D019D2C  7F303C00   EXT S0, T9, 16, 8
9D01A14C  7D343C00   EXT S4, T1, 16, 8
342:                 	b2 = (back>>8)&0xFF;
9D018B18  7E513A00   EXT S1, S2, 8, 8
9D0191CC  7C543A00   EXT S4, V0, 8, 8
9D0195E8  7D703A00   EXT S0, T3, 8, 8
9D019D30  7F343A00   EXT S4, T9, 8, 8
9D01A150  7D303A00   EXT S0, T1, 8, 8
343:                 	b3 = (back>>0)&0xFF;
9D018B1C  325200FF   ANDI S2, S2, 255
9D0191D0  305500FF   ANDI S5, V0, 255
9D0195EC  317100FF   ANDI S1, T3, 255
9D019D34  333500FF   ANDI S5, T9, 255
9D01A154  313100FF   ANDI S1, T1, 255
344:                 	tft_set_write_area(x,y,7,11);
345:                 	TFT_24_7789_Write_Command(0x2C);
9D018BC8  0F4061AB   JAL TFT_24_7789_Write_Command
9D018BCC  2404002C   ADDIU A0, ZERO, 44
9D019274  0F4061AB   JAL TFT_24_7789_Write_Command
9D019278  2404002C   ADDIU A0, ZERO, 44
9D01927C  3C199D03   LUI T9, -25341
9D019280  2724DD3C   ADDIU A0, T9, -8900
9D019688  0F4061AB   JAL TFT_24_7789_Write_Command
9D01968C  2404002C   ADDIU A0, ZERO, 44
9D019DDC  0F4061AB   JAL TFT_24_7789_Write_Command
9D019DE0  2404002C   ADDIU A0, ZERO, 44
9D019DE4  3C0F9D03   LUI T7, -25341
9D019DE8  25E4DD3C   ADDIU A0, T7, -8900
9D01A1F0  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A1F4  2404002C   ADDIU A0, ZERO, 44
346:                 	if (val<' ')
9D018BD0  8FAC0038   LW T4, 56(SP)
9D018BD4  2D8D0020   SLTIU T5, T4, 32
9D018BD8  11A00053   BEQ T5, ZERO, 0x9D018D28
9D018BDC  8FAE0044   LW T6, 68(SP)
9D018BE0  2408000C   ADDIU T0, ZERO, 12
9D019690  8FB3001C   LW S3, 28(SP)
9D019694  2E670020   SLTIU A3, S3, 32
9D019698  10E00051   BEQ A3, ZERO, 0x9D0197E0
9D01969C  7EBF3C00   EXT RA, S5, 16, 8
9D0196A0  2406000C   ADDIU A2, ZERO, 12
9D01A1F8  8FB30018   LW S3, 24(SP)
9D01A1FC  2E790020   SLTIU T9, S3, 32
9D01A200  13200051   BEQ T9, ZERO, 0x9D01A348
9D01A204  7EBF3C00   EXT RA, S5, 16, 8
9D01A208  2415000C   ADDIU S5, ZERO, 12
347:                 		{
348:                 		for (i=0;i<12;i++)
9D018D18  1500FFB5   BNE T0, ZERO, 0x9D018BF0
9D018D1C  8FBF0034   LW RA, 52(SP)
9D018D20  0B406421   J 0x9D019084
9D018D24  8FBE0030   LW FP, 48(SP)
9D0197D0  14C0FFB5   BNE A2, ZERO, 0x9D0196A8
9D0197D4  00000000   NOP
9D0197D8  0B4066C9   J 0x9D019B24
9D0197DC  8FB40010   LW S4, 16(SP)
9D01A338  16A0FFB5   BNE S5, ZERO, 0x9D01A210
9D01A33C  00000000   NOP
9D01A340  0B4069A3   J 0x9D01A68C
9D01A344  8FB40010   LW S4, 16(SP)
349:                 			{
350:                 			TFT_24_7789_Write_Data3(b1,b2,b3);
351:                 			TFT_24_7789_Write_Data3(b1,b2,b3);
352:                 			TFT_24_7789_Write_Data3(b1,b2,b3);
353:                 			TFT_24_7789_Write_Data3(b1,b2,b3);
354:                 			TFT_24_7789_Write_Data3(b1,b2,b3);
355:                 			TFT_24_7789_Write_Data3(b1,b2,b3);
356:                 			TFT_24_7789_Write_Data3(b1,b2,b3);
357:                 			TFT_24_7789_Write_Data3(b1,b2,b3);
358:                 			}
359:                 				
360:                 		}
361:                 	else
362:                 		{
363:                 		for (i=0;i<12;i++)
9D018D68  2409000C   ADDIU T1, ZERO, 12
9D018D6C  02873021   ADDU A2, S4, A3
9D019074  14E9FF3E   BNE A3, T1, 0x9D018D70
9D019078  02873021   ADDU A2, S4, A3
9D019590  5487FF3F   BNEL A0, A3, 0x9D019290
9D019594  809F0000   LB RA, 0(A0)
9D019598  0B4066C9   J 0x9D019B24
9D01959C  8FB40010   LW S4, 16(SP)
9D0195A0  8FB30070   LW S3, 112(SP)
9D0195A4  8FB20038   LW S2, 56(SP)
9D0195A8  02728821   ADDU S1, S3, S2
9D0195AC  8FB00010   LW S0, 16(SP)
9D0195B0  0230A021   ADDU S4, S1, S0
9D01980C  240E000C   ADDIU T6, ZERO, 12
9D019810  01847821   ADDU T7, T4, A0
9D019B18  148EFF3E   BNE A0, T6, 0x9D019814
9D019B1C  01847821   ADDU T7, T4, A0
9D019B20  8FB40010   LW S4, 16(SP)
9D019B24  26900001   ADDIU S0, S4, 1
9D019B28  AFB00010   SW S0, 16(SP)
9D019B2C  8FB10018   LW S1, 24(SP)
9D019B30  262C0001   ADDIU T4, S1, 1
9D019B34  AFAC0018   SW T4, 24(SP)
9D019B38  8FAD0014   LW T5, 20(SP)
9D019B3C  25AE0008   ADDIU T6, T5, 8
9D01A0F8  5499FF3F   BNEL A0, T9, 0x9D019DF8
9D01A0FC  809F0000   LB RA, 0(A0)
9D01A100  0B4069A3   J 0x9D01A68C
9D01A104  8FB40010   LW S4, 16(SP)
9D01A108  8FB30078   LW S3, 120(SP)
9D01A10C  8FB20020   LW S2, 32(SP)
9D01A110  02728821   ADDU S1, S3, S2
9D01A114  8FB00010   LW S0, 16(SP)
9D01A118  0230A021   ADDU S4, S1, S0
9D01A374  240C000C   ADDIU T4, ZERO, 12
9D01A378  01446821   ADDU T5, T2, A0
9D01A680  148CFF3E   BNE A0, T4, 0x9D01A37C
9D01A684  01446821   ADDU T5, T2, A0
9D01A688  8FB40010   LW S4, 16(SP)
9D01A68C  26900001   ADDIU S0, S4, 1
9D01A690  AFB00010   SW S0, 16(SP)
9D01A694  8FB10014   LW S1, 20(SP)
9D01A698  262A0008   ADDIU T2, S1, 8
364:                 			{
365:                 			fl = font[i+12*(val-' ')];
9D018D34  8FBF0038   LW RA, 56(SP)
9D018D38  27FEFFE0   ADDIU FP, RA, -32
9D018D3C  001EB880   SLL S7, FP, 2
9D018D40  001EB100   SLL S6, FP, 4
9D018D44  02D79823   SUBU S3, S6, S7
9D018D48  00003821   ADDU A3, ZERO, ZERO
9D018D4C  3C029D03   LUI V0, -25341
9D018D50  2455D478   ADDIU S5, V0, -11144
9D018D54  02B3A021   ADDU S4, S5, S3
9D018D70  80CA0000   LB T2, 0(A2)
9D01928C  809F0000   LB RA, 0(A0)
9D0197E8  8FA8001C   LW T0, 28(SP)
9D0197EC  2515FFE0   ADDIU S5, T0, -32
9D0197F0  00155080   SLL T2, S5, 2
9D0197F4  00154900   SLL T1, S5, 4
9D0197F8  012A5823   SUBU T3, T1, T2
9D0197FC  00002021   ADDU A0, ZERO, ZERO
9D019800  8FB20040   LW S2, 64(SP)
9D019804  024B6021   ADDU T4, S2, T3
9D019814  81F80000   LB T8, 0(T7)
9D019DF4  809F0000   LB RA, 0(A0)
9D01A350  8FA20018   LW V0, 24(SP)
9D01A354  2447FFE0   ADDIU A3, V0, -32
9D01A358  00074080   SLL T0, A3, 2
9D01A35C  00073100   SLL A2, A3, 4
9D01A360  00C84823   SUBU T1, A2, T0
9D01A364  00002021   ADDU A0, ZERO, ZERO
9D01A368  8FB20040   LW S2, 64(SP)
9D01A36C  02495021   ADDU T2, S2, T1
9D01A37C  81AE0000   LB T6, 0(T5)
366:                 			if (fl&0x80)
9D018D74  314B0080   ANDI T3, T2, 128
9D018D78  316CFFFF   ANDI T4, T3, -1
9D018D7C  1180000C   BEQ T4, ZERO, 0x9D018DB0
9D018D80  00000000   NOP
9D019290  33E30080   ANDI V1, RA, 128
9D019294  3065FFFF   ANDI A1, V1, -1
9D019298  10A0000C   BEQ A1, ZERO, 0x9D0192CC
9D01929C  00000000   NOP
9D019818  33190080   ANDI T9, T8, 128
9D01981C  3323FFFF   ANDI V1, T9, -1
9D019820  1060000C   BEQ V1, ZERO, 0x9D019854
9D019824  00000000   NOP
9D019DF8  33E30080   ANDI V1, RA, 128
9D019DFC  3062FFFF   ANDI V0, V1, -1
9D019E00  1040000C   BEQ V0, ZERO, 0x9D019E34
9D019E04  00000000   NOP
9D01A380  31CF0080   ANDI T7, T6, 128
9D01A384  31E3FFFF   ANDI V1, T7, -1
9D01A388  1060000C   BEQ V1, ZERO, 0x9D01A3BC
9D01A38C  00000000   NOP
367:                 				TFT_24_7789_Write_Data3(c1,c2,c3);
368:                 			else
369:                 				TFT_24_7789_Write_Data3(b1,b2,b3);
370:                 			if (fl&0x40)
9D018DA8  0B406376   J 0x9D018DD8
9D018DAC  314D0040   ANDI T5, T2, 64
9D018DD4  314D0040   ANDI T5, T2, 64
9D018DD8  7C0D7420   SEB T6, T5
9D018DDC  11C0000C   BEQ T6, ZERO, .LBB422
9D018DE0  00000000   NOP
9D0192C4  0B4064BD   J 0x9D0192F4
9D0192C8  33E80040   ANDI T0, RA, 64
9D0192F0  33E80040   ANDI T0, RA, 64
9D0192F4  7C084C20   SEB T1, T0
9D0192F8  1120000C   BEQ T1, ZERO, .LBB706
9D0192FC  00000000   NOP
9D01984C  0B40661F   J 0x9D01987C
9D019850  33020040   ANDI V0, T8, 64
9D019878  33020040   ANDI V0, T8, 64
9D01987C  7C029C20   SEB S3, V0
9D019880  1260000C   BEQ S3, ZERO, .LBB632
9D019884  00000000   NOP
9D019E2C  0B406797   J 0x9D019E5C
9D019E30  33E70040   ANDI A3, RA, 64
9D019E58  33E70040   ANDI A3, RA, 64
9D019E5C  7C072C20   SEB A1, A3
9D019E60  10A0000C   BEQ A1, ZERO, .LBB1015
9D019E64  00000000   NOP
9D01A3B4  0B4068F9   J 0x9D01A3E4
9D01A3B8  31D80040   ANDI T8, T6, 64
9D01A3E0  31D80040   ANDI T8, T6, 64
9D01A3E4  7C189C20   SEB S3, T8
9D01A3E8  1260000C   BEQ S3, ZERO, .LBB944
9D01A3EC  00000000   NOP
371:                 				TFT_24_7789_Write_Data3(c1,c2,c3);
372:                 			else
373:                 				TFT_24_7789_Write_Data3(b1,b2,b3);
374:                 			if (fl&0x20)
9D018E08  0B40638E   J 0x9D018E38
9D018E0C  315F0020   ANDI RA, T2, 32
9D018E34  315F0020   ANDI RA, T2, 32
9D018E38  7C1FF420   SEB FP, RA
9D018E3C  13C0000C   BEQ FP, ZERO, .LBB426
9D018E40  00000000   NOP
9D019324  0B4064D5   J 0x9D019354
9D019328  33E60020   ANDI A2, RA, 32
9D019350  33E60020   ANDI A2, RA, 32
9D019354  7C065420   SEB T2, A2
9D019358  1140000C   BEQ T2, ZERO, .LBB710
9D01935C  00000000   NOP
9D0198AC  0B406637   J 0x9D0198DC
9D0198B0  33070020   ANDI A3, T8, 32
9D0198D8  33070020   ANDI A3, T8, 32
9D0198DC  7C074420   SEB T0, A3
9D0198E0  1100000C   BEQ T0, ZERO, .LBB636
9D0198E4  00000000   NOP
9D019E8C  0B4067AF   J 0x9D019EBC
9D019E90  33E80020   ANDI T0, RA, 32
9D019EB8  33E80020   ANDI T0, RA, 32
9D019EBC  7C083420   SEB A2, T0
9D019EC0  10C0000C   BEQ A2, ZERO, .LBB1019
9D019EC4  00000000   NOP
9D01A414  0B406911   J 0x9D01A444
9D01A418  31D90020   ANDI T9, T6, 32
9D01A440  31D90020   ANDI T9, T6, 32
9D01A444  7C191420   SEB V0, T9
9D01A448  1040000C   BEQ V0, ZERO, .LBB948
9D01A44C  00000000   NOP
375:                 				TFT_24_7789_Write_Data3(c1,c2,c3);
376:                 			else
377:                 				TFT_24_7789_Write_Data3(b1,b2,b3);
378:                 			if (fl&0x10)
9D018E68  0B4063A6   J 0x9D018E98
9D018E6C  31570010   ANDI S7, T2, 16
9D018E94  31570010   ANDI S7, T2, 16
9D018E98  7C17B420   SEB S6, S7
9D018E9C  12C0000C   BEQ S6, ZERO, .LBB430
9D018EA0  00000000   NOP
9D019384  0B4064ED   J 0x9D0193B4
9D019388  33EB0010   ANDI T3, RA, 16
9D0193B0  33EB0010   ANDI T3, RA, 16
9D0193B4  7C0B6420   SEB T4, T3
9D0193B8  1180000C   BEQ T4, ZERO, .LBB714
9D0193BC  00000000   NOP
9D01990C  0B40664F   J 0x9D01993C
9D019910  33150010   ANDI S5, T8, 16
9D019938  33150010   ANDI S5, T8, 16
9D01993C  7C155420   SEB T2, S5
9D019940  1140000C   BEQ T2, ZERO, .LBB640
9D019944  00000000   NOP
9D019EEC  0B4067C7   J 0x9D019F1C
9D019EF0  33E90010   ANDI T1, RA, 16
9D019F18  33E90010   ANDI T1, RA, 16
9D019F1C  7C095420   SEB T2, T1
9D019F20  1140000C   BEQ T2, ZERO, .LBB1023
9D019F24  00000000   NOP
9D01A474  0B406929   J 0x9D01A4A4
9D01A478  31C70010   ANDI A3, T6, 16
9D01A4A0  31C70010   ANDI A3, T6, 16
9D01A4A4  7C074420   SEB T0, A3
9D01A4A8  1100000C   BEQ T0, ZERO, .LBB952
9D01A4AC  00000000   NOP
379:                 				TFT_24_7789_Write_Data3(c1,c2,c3);
380:                 			else
381:                 				TFT_24_7789_Write_Data3(b1,b2,b3);
382:                 			if (fl&0x08)
9D018EC8  0B4063BE   J 0x9D018EF8
9D018ECC  31530008   ANDI S3, T2, 8
9D018EF4  31530008   ANDI S3, T2, 8
9D018EF8  7C131420   SEB V0, S3
9D018EFC  1040000C   BEQ V0, ZERO, .LBB434
9D018F00  00000000   NOP
9D0193E4  0B406505   J 0x9D019414
9D0193E8  33ED0008   ANDI T5, RA, 8
9D019410  33ED0008   ANDI T5, RA, 8
9D019414  7C0D7420   SEB T6, T5
9D019418  11C0000C   BEQ T6, ZERO, .LBB718
9D01941C  00000000   NOP
9D01996C  0B406667   J 0x9D01999C
9D019970  33090008   ANDI T1, T8, 8
9D019998  33090008   ANDI T1, T8, 8
9D01999C  7C095C20   SEB T3, T1
9D0199A0  1160000C   BEQ T3, ZERO, .LBB644
9D0199A4  00000000   NOP
9D019F4C  0B4067DF   J 0x9D019F7C
9D019F50  33EB0008   ANDI T3, RA, 8
9D019F78  33EB0008   ANDI T3, RA, 8
9D019F7C  7C0B6420   SEB T4, T3
9D019F80  1180000C   BEQ T4, ZERO, .LBB1027
9D019F84  00000000   NOP
9D01A4D4  0B406941   J 0x9D01A504
9D01A4D8  31C60008   ANDI A2, T6, 8
9D01A500  31C60008   ANDI A2, T6, 8
9D01A504  7C064C20   SEB T1, A2
9D01A508  1120000C   BEQ T1, ZERO, .LBB956
9D01A50C  00000000   NOP
383:                 				TFT_24_7789_Write_Data3(c1,c2,c3);
384:                 			else
385:                 				TFT_24_7789_Write_Data3(b1,b2,b3);
386:                 			if (fl&0x04)
9D018F28  0B4063D6   J 0x9D018F58
9D018F2C  31550004   ANDI S5, T2, 4
9D018F54  31550004   ANDI S5, T2, 4
9D018F58  7C153420   SEB A2, S5
9D018F5C  10C0000C   BEQ A2, ZERO, .LBB438
9D018F60  00000000   NOP
9D019444  0B40651D   J 0x9D019474
9D019448  33EF0004   ANDI T7, RA, 4
9D019470  33EF0004   ANDI T7, RA, 4
9D019474  7C0FC420   SEB T8, T7
9D019478  1300000C   BEQ T8, ZERO, .LBB722
9D01947C  00000000   NOP
9D0199CC  0B40667F   J 0x9D0199FC
9D0199D0  33120004   ANDI S2, T8, 4
9D0199F8  33120004   ANDI S2, T8, 4
9D0199FC  7C127C20   SEB T7, S2
9D019A00  11E0000C   BEQ T7, ZERO, .LBB648
9D019A04  00000000   NOP
9D019FAC  0B4067F7   J 0x9D019FDC
9D019FB0  33ED0004   ANDI T5, RA, 4
9D019FD8  33ED0004   ANDI T5, RA, 4
9D019FDC  7C0D7420   SEB T6, T5
9D019FE0  11C0000C   BEQ T6, ZERO, .LBB1031
9D019FE4  00000000   NOP
9D01A534  0B406959   J 0x9D01A564
9D01A538  31D20004   ANDI S2, T6, 4
9D01A560  31D20004   ANDI S2, T6, 4
9D01A564  7C126C20   SEB T5, S2
9D01A568  11A0000C   BEQ T5, ZERO, .LBB960
9D01A56C  00000000   NOP
387:                 				TFT_24_7789_Write_Data3(c1,c2,c3);
388:                 			else
389:                 				TFT_24_7789_Write_Data3(b1,b2,b3);				
390:                 			if (fl&0x02)
9D018F88  0B4063EE   J 0x9D018FB8
9D018F8C  314B0002   ANDI T3, T2, 2
9D018FB4  314B0002   ANDI T3, T2, 2
9D018FB8  7C0B6420   SEB T4, T3
9D018FBC  1180000C   BEQ T4, ZERO, .LBB442
9D018FC0  00000000   NOP
9D0194A4  0B406535   J 0x9D0194D4
9D0194A8  33F90002   ANDI T9, RA, 2
9D0194D0  33F90002   ANDI T9, RA, 2
9D0194D4  7C191C20   SEB V1, T9
9D0194D8  1060000C   BEQ V1, ZERO, .LBB726
9D0194DC  00000000   NOP
9D019A2C  0B406697   J 0x9D019A5C
9D019A30  33190002   ANDI T9, T8, 2
9D019A58  33190002   ANDI T9, T8, 2
9D019A5C  7C191C20   SEB V1, T9
9D019A60  1060000C   BEQ V1, ZERO, .LBB652
9D019A64  00000000   NOP
9D01A00C  0B40680F   J 0x9D01A03C
9D01A010  33EF0002   ANDI T7, RA, 2
9D01A038  33EF0002   ANDI T7, RA, 2
9D01A03C  7C0F1C20   SEB V1, T7
9D01A040  1060000C   BEQ V1, ZERO, .LBB1035
9D01A044  00000000   NOP
9D01A594  0B406971   J 0x9D01A5C4
9D01A598  31CF0002   ANDI T7, T6, 2
9D01A5C0  31CF0002   ANDI T7, T6, 2
9D01A5C4  7C0F1C20   SEB V1, T7
9D01A5C8  1060000C   BEQ V1, ZERO, .LBB964
9D01A5CC  00000000   NOP
391:                 				TFT_24_7789_Write_Data3(c1,c2,c3);
392:                 			else
393:                 				TFT_24_7789_Write_Data3(b1,b2,b3);
394:                 			if (fl&0x01)
9D018FE8  0B406406   J 0x9D019018
9D018FEC  314A0001   ANDI T2, T2, 1
9D019014  314A0001   ANDI T2, T2, 1
9D019018  1140000C   BEQ T2, ZERO, .LBE444, .LBB446
9D01901C  00000000   NOP
9D019504  0B40654D   J 0x9D019534
9D019508  33FF0001   ANDI RA, RA, 1
9D019530  33FF0001   ANDI RA, RA, 1
9D019534  13E0000C   BEQ RA, ZERO, .LBE728, .LBB730
9D019538  00000000   NOP
9D019A8C  0B4066AF   J 0x9D019ABC
9D019A90  33180001   ANDI T8, T8, 1
9D019AB8  33180001   ANDI T8, T8, 1
9D019ABC  1300000C   BEQ T8, ZERO, .LBE654, .LBB656
9D019AC0  00000000   NOP
9D01A06C  0B406827   J 0x9D01A09C
9D01A070  33FF0001   ANDI RA, RA, 1
9D01A098  33FF0001   ANDI RA, RA, 1
9D01A09C  13E0000C   BEQ RA, ZERO, .LBE1037, .LBB1039
9D01A0A0  00000000   NOP
9D01A5F4  0B406989   J 0x9D01A624
9D01A5F8  31CE0001   ANDI T6, T6, 1
9D01A620  31CE0001   ANDI T6, T6, 1
9D01A624  11C0000C   BEQ T6, ZERO, .LBE966, .LBB968
9D01A628  00000000   NOP
395:                 				TFT_24_7789_Write_Data3(c1,c2,c3);
396:                 			else
397:                 				TFT_24_7789_Write_Data3(b1,b2,b3);	
398:                 			}
399:                 		}
400:                 	}
9D01907C  8FBF0034   LW RA, 52(SP)
9D019080  8FBE0030   LW FP, 48(SP)
9D019084  8FB7002C   LW S7, 44(SP)
9D019088  8FB60028   LW S6, 40(SP)
9D01908C  8FB50024   LW S5, 36(SP)
9D019090  8FB40020   LW S4, 32(SP)
9D019094  8FB3001C   LW S3, 28(SP)
9D019098  8FB20018   LW S2, 24(SP)
9D01909C  8FB10014   LW S1, 20(SP)
9D0190A0  8FB00010   LW S0, 16(SP)
9D0190A4  03E00008   JR RA
9D0190A8  27BD0038   ADDIU SP, SP, 56
401:                 
402:                 
403:                 void tft_fill_area (uint16_t x, uint16_t y, uint16_t xlen, uint16_t ylen, uint32_t back)
404:                 {
9D01880C  27BDFFC8   ADDIU SP, SP, -56
9D018810  AFBF0034   SW RA, 52(SP)
9D018814  AFBE0030   SW FP, 48(SP)
9D018818  AFB7002C   SW S7, 44(SP)
9D01881C  AFB60028   SW S6, 40(SP)
9D018820  AFB50024   SW S5, 36(SP)
9D018824  AFB40020   SW S4, 32(SP)
9D018828  AFB3001C   SW S3, 28(SP)
9D01882C  AFB20018   SW S2, 24(SP)
9D018830  AFB10014   SW S1, 20(SP)
9D018834  AFB00010   SW S0, 16(SP)
9D018838  0080B021   ADDU S6, A0, ZERO
9D01883C  00A0A821   ADDU S5, A1, ZERO
9D018840  00C0F021   ADDU FP, A2, ZERO
9D018844  00E0B821   ADDU S7, A3, ZERO
9D018848  8FB20048   LW S2, 72(SP)
405:                     uint32_t i,j;
406:                     tft_set_write_area(x,y,xlen,ylen);
407:                     TFT_24_7789_Write_Command(0x2C);
9D0188F4  0F4061AB   JAL TFT_24_7789_Write_Command
9D0188F8  2404002C   ADDIU A0, ZERO, 44
408:                     //FIXME: Why do I need these +1 adjustments. Off-by-one in tft_set_write_area?
409:                     for (i=0; i<((xlen+1)*(ylen+1)); i++)
9D0188FC  27CC0001   ADDIU T4, FP, 1
9D018900  26ED0001   ADDIU T5, S7, 1
9D018904  718D7002   MUL T6, T4, T5
9D018908  11C0003E   BEQ T6, ZERO, 0x9D018A04
9D01890C  241F0010   ADDIU RA, ZERO, 16
9D018954  24020001   ADDIU V0, ZERO, 1
9D018958  144E0036   BNE V0, T6, 0x9D018A34
9D01895C  00000000   NOP
9D0189F8  24420004   ADDIU V0, V0, 4
9D0189FC  144EFFDA   BNE V0, T6, 0x9D018968
9D018A00  00000000   NOP
9D018A70  24420001   ADDIU V0, V0, 1
9D018A98  24420001   ADDIU V0, V0, 1
9D018AC0  24420001   ADDIU V0, V0, 1
9D018AC4  144EFFA8   BNE V0, T6, 0x9D018968
9D018AC8  00000000   NOP
410:                     {
411:                 	TFT_24_7789_Write_Data3((back>>16)&0xFF,(back>>8)&0xFF,(back>>0)&0xFF);
412:                     }
413:                 }
9D018960  0B406282   J 0x9D018A08
9D018964  8FBF0034   LW RA, 52(SP)
9D018A04  8FBF0034   LW RA, 52(SP)
9D018A08  8FBE0030   LW FP, 48(SP)
9D018A0C  8FB7002C   LW S7, 44(SP)
9D018A10  8FB60028   LW S6, 40(SP)
9D018A14  8FB50024   LW S5, 36(SP)
9D018A18  8FB40020   LW S4, 32(SP)
9D018A1C  8FB3001C   LW S3, 28(SP)
9D018A20  8FB20018   LW S2, 24(SP)
9D018A24  8FB10014   LW S1, 20(SP)
9D018A28  8FB00010   LW S0, 16(SP)
9D018A2C  03E00008   JR RA
9D018A30  27BD0038   ADDIU SP, SP, 56
9D018A34  1240FFCC   BEQ S2, ZERO, 0x9D018968
9D018A38  24140001   ADDIU S4, ZERO, 1
9D018A3C  12540017   BEQ S2, S4, 0x9D018A9C
9D018A40  24100002   ADDIU S0, ZERO, 2
9D018A44  1250000B   BEQ S2, S0, 0x9D018A74
9D018A48  00000000   NOP
9D018ACC  0B406282   J 0x9D018A08
9D018AD0  8FBF0034   LW RA, 52(SP)
414:                 
415:                 inline void tft_set_write_area (uint16_t x, uint16_t y, uint16_t xlen, uint16_t ylen)
416:                 	{
9D018700  27BDFFC8   ADDIU SP, SP, -56
9D018704  AFBF0034   SW RA, 52(SP)
9D018708  AFB70030   SW S7, 48(SP)
9D01870C  AFB6002C   SW S6, 44(SP)
9D018710  AFB50028   SW S5, 40(SP)
9D018714  AFB40024   SW S4, 36(SP)
9D018718  AFB30020   SW S3, 32(SP)
9D01871C  AFB2001C   SW S2, 28(SP)
9D018720  AFB10018   SW S1, 24(SP)
9D018724  AFB00014   SW S0, 20(SP)
9D018728  0080A821   ADDU S5, A0, ZERO
9D01872C  00A0A021   ADDU S4, A1, ZERO
9D018730  00C0B821   ADDU S7, A2, ZERO
9D018734  00E0B021   ADDU S6, A3, ZERO
417:                 	TFT_24_7789_Write_Command(0x002A);
9D018738  0F4061AB   JAL TFT_24_7789_Write_Command
9D01873C  2404002A   ADDIU A0, ZERO, 42
9D01884C  0F4061AB   JAL TFT_24_7789_Write_Command
9D018B20  0F4061AB   JAL TFT_24_7789_Write_Command
9D0191D4  0F4061AB   JAL TFT_24_7789_Write_Command
9D0191D8  2404002A   ADDIU A0, ZERO, 42
9D0195F0  0F4061AB   JAL TFT_24_7789_Write_Command
9D0195F4  2404002A   ADDIU A0, ZERO, 42
9D019D38  0F4061AB   JAL TFT_24_7789_Write_Command
9D019D3C  2404002A   ADDIU A0, ZERO, 42
9D01A158  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A15C  2404002A   ADDIU A0, ZERO, 42
418:                 	TFT_24_7789_Write_Data((x>>8)&0xFF);
419:                 	TFT_24_7789_Write_Data((x>>0)&0xFF);
420:                 	TFT_24_7789_Write_Data(((x+xlen)>>8)&0xFF);
9D018774  02B72021   ADDU A0, S5, S7
9D018888  02DE2021   ADDU A0, S6, FP
9D018B5C  27C40007   ADDIU A0, FP, 7
421:                 	TFT_24_7789_Write_Data(((x+xlen)>>0)&0xFF);
422:                 	TFT_24_7789_Write_Command(0x2B);
9D018794  0F4061AB   JAL TFT_24_7789_Write_Command
9D018798  2404002B   ADDIU A0, ZERO, 43
9D0188A8  0F4061AB   JAL TFT_24_7789_Write_Command
9D018B7C  0F4061AB   JAL TFT_24_7789_Write_Command
9D019228  0F4061AB   JAL TFT_24_7789_Write_Command
9D01922C  2404002B   ADDIU A0, ZERO, 43
9D019640  0F4061AB   JAL TFT_24_7789_Write_Command
9D019644  2404002B   ADDIU A0, ZERO, 43
9D019D8C  0F4061AB   JAL TFT_24_7789_Write_Command
9D019D90  2404002B   ADDIU A0, ZERO, 43
9D01A1A8  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A1AC  2404002B   ADDIU A0, ZERO, 43
423:                 	TFT_24_7789_Write_Data((y>>8)&0xFF);
424:                 	TFT_24_7789_Write_Data((y>>0)&0xFF);
425:                 	TFT_24_7789_Write_Data(((y+ylen)>>8)&0xFF);
9D0187C0  02964821   ADDU T1, S4, S6
9D0188D4  02B74821   ADDU T1, S5, S7
9D018BA8  26E9000B   ADDIU T1, S7, 11
9D019B98  8FB10044   LW S1, 68(SP)
9D019B9C  2632000B   ADDIU S2, S1, 11
426:                 	TFT_24_7789_Write_Data(((y+ylen)>>0)&0xFF);
427:                 	}
9D0187E0  8FBF0034   LW RA, 52(SP)
9D0187E4  8FB70030   LW S7, 48(SP)
9D0187E8  8FB6002C   LW S6, 44(SP)
9D0187EC  8FB50028   LW S5, 40(SP)
9D0187F0  8FB40024   LW S4, 36(SP)
9D0187F4  8FB30020   LW S3, 32(SP)
9D0187F8  8FB2001C   LW S2, 28(SP)
9D0187FC  8FB10018   LW S1, 24(SP)
9D018800  8FB00014   LW S0, 20(SP)
9D018804  03E00008   JR RA
9D018808  27BD0038   ADDIU SP, SP, 56
428:                 
429:                 
430:                 
431:                 /*******************************************************************************/
432:                 void TFT_24_7789_Write_Command(uint16_t command)
433:                 	{
434:                 	LCD_RD = 1;
9D0186AC  3C02BF88   LUI V0, -16504
9D0186B0  94436330   LHU V1, 25392(V0)
9D0186B4  24050001   ADDIU A1, ZERO, 1
9D0186B8  7CA32944   INS V1, A1, 5, 1
9D0186BC  A4436330   SH V1, 25392(V0)
435:                 	LCD_DC = 0;
9D0186C0  3C07BF88   LUI A3, -16504
9D0186C4  94E66630   LHU A2, 26160(A3)
9D0186C8  7C064204   INS A2, ZERO, 8, 1
9D0186CC  A4E66630   SH A2, 26160(A3)
436:                 	LCD_WR_CLR;
9D0186D0  24080010   ADDIU T0, ZERO, 16
9D0186D4  3C09BF88   LUI T1, -16504
9D0186D8  AD286324   SW T0, 25380(T1)
437:                 	LCD_PORT = command;
9D0186DC  3C0ABF88   LUI T2, -16504
9D0186E0  AD446430   SW A0, 25648(T2)
438:                 	LCD_WR_SET;
9D0186E4  3C04BF88   LUI A0, -16504
9D0186E8  AC886328   SW T0, 25384(A0)
439:                 	LCD_DC = 1;
9D0186EC  94EB6630   LHU T3, 26160(A3)
9D0186F0  7CAB4204   INS T3, A1, 8, 1
9D0186F4  A4EB6630   SH T3, 26160(A3)
9D0186F8  03E00008   JR RA
9D0186FC  00000000   NOP
440:                 	}
441:                 /*******************************************************************************/
442:                 inline void TFT_24_7789_Write_Data(uint16_t data1)
443:                 	{
444:                 	LCD_WR_CLR;
9D018740  3C13BF88   LUI S3, -16504
9D018760  AE706324   SW S0, 25380(S3)
9D018770  AE706324   SW S0, 25380(S3)
9D018784  AE706324   SW S0, 25380(S3)
9D01879C  AE706324   SW S0, 25380(S3)
9D0187AC  AE706324   SW S0, 25380(S3)
9D0187BC  AE706324   SW S0, 25380(S3)
9D0187D0  AE706324   SW S0, 25380(S3)
9D018854  3C14BF88   LUI S4, -16504
9D018874  AE906324   SW S0, 25380(S4)
9D018884  AE906324   SW S0, 25380(S4)
9D018898  AE906324   SW S0, 25380(S4)
9D0188B0  AE906324   SW S0, 25380(S4)
9D0188C0  AE906324   SW S0, 25380(S4)
9D0188D0  AE906324   SW S0, 25380(S4)
9D0188E4  AE906324   SW S0, 25380(S4)
9D018B28  3C16BF88   LUI S6, -16504
9D018B48  AED36324   SW S3, 25380(S6)
9D018B58  AED36324   SW S3, 25380(S6)
9D018B6C  AED36324   SW S3, 25380(S6)
9D018B84  AED36324   SW S3, 25380(S6)
9D018B94  AED36324   SW S3, 25380(S6)
9D018BA4  AED36324   SW S3, 25380(S6)
9D018BB8  AED36324   SW S3, 25380(S6)
9D019128  3C16BF88   LUI S6, -16504
9D0191DC  24070010   ADDIU A3, ZERO, 16
9D0191E0  AEC76324   SW A3, 25380(S6)
9D0191F4  AEC76324   SW A3, 25380(S6)
9D019204  AEC76324   SW A3, 25380(S6)
9D019218  AEC76324   SW A3, 25380(S6)
9D019230  240C0010   ADDIU T4, ZERO, 16
9D019234  AECC6324   SW T4, 25380(S6)
9D019244  AECC6324   SW T4, 25380(S6)
9D019254  AECC6324   SW T4, 25380(S6)
9D019264  AECC6324   SW T4, 25380(S6)
9D0195F8  24120010   ADDIU S2, ZERO, 16
9D0195FC  AED26324   SW S2, 25380(S6)
9D01960C  AED26324   SW S2, 25380(S6)
9D01961C  AED26324   SW S2, 25380(S6)
9D019630  AED26324   SW S2, 25380(S6)
9D019648  AED26324   SW S2, 25380(S6)
9D019658  AED26324   SW S2, 25380(S6)
9D019668  AED26324   SW S2, 25380(S6)
9D019678  AED26324   SW S2, 25380(S6)
9D019C8C  3C16BF88   LUI S6, -16504
9D019D40  24030010   ADDIU V1, ZERO, 16
9D019D44  AEC36324   SW V1, 25380(S6)
9D019D58  AEC36324   SW V1, 25380(S6)
9D019D68  AEC36324   SW V1, 25380(S6)
9D019D7C  AEC36324   SW V1, 25380(S6)
9D019D94  24090010   ADDIU T1, ZERO, 16
9D019D98  AEC96324   SW T1, 25380(S6)
9D019DA8  AEC96324   SW T1, 25380(S6)
9D019DB8  AEC96324   SW T1, 25380(S6)
9D019DC8  AEC96324   SW T1, 25380(S6)
9D01A160  24120010   ADDIU S2, ZERO, 16
9D01A164  AED26324   SW S2, 25380(S6)
9D01A174  AED26324   SW S2, 25380(S6)
9D01A184  AED26324   SW S2, 25380(S6)
9D01A198  AED26324   SW S2, 25380(S6)
9D01A1B0  AED26324   SW S2, 25380(S6)
9D01A1C0  AED26324   SW S2, 25380(S6)
9D01A1D0  AED26324   SW S2, 25380(S6)
9D01A1E0  AED26324   SW S2, 25380(S6)
9D01A760  24020010   ADDIU V0, ZERO, 16
9D01A764  3C03BF88   LUI V1, -16504
9D01A768  AC626324   SW V0, 25380(V1)
9D01A848  3C13BF88   LUI S3, -16504
9D01A870  AE706324   SW S0, 25380(S3)
9D01A888  AE706324   SW S0, 25380(S3)
9D01A898  AE706324   SW S0, 25380(S3)
9D01A8A4  AE706324   SW S0, 25380(S3)
9D01A8B0  AE706324   SW S0, 25380(S3)
9D01A8C0  AE706324   SW S0, 25380(S3)
9D01A8D4  AE706324   SW S0, 25380(S3)
9D01A8EC  AE706324   SW S0, 25380(S3)
9D01A904  AE706324   SW S0, 25380(S3)
9D01A91C  AE706324   SW S0, 25380(S3)
9D01A928  AE706324   SW S0, 25380(S3)
9D01A940  AE706324   SW S0, 25380(S3)
9D01A958  AE706324   SW S0, 25380(S3)
9D01A970  AE706324   SW S0, 25380(S3)
9D01A988  AE706324   SW S0, 25380(S3)
9D01A998  AE706324   SW S0, 25380(S3)
9D01A9B0  AE706324   SW S0, 25380(S3)
9D01A9C0  AE706324   SW S0, 25380(S3)
9D01A9CC  AE706324   SW S0, 25380(S3)
9D01A9DC  AE706324   SW S0, 25380(S3)
9D01A9EC  AE706324   SW S0, 25380(S3)
9D01A9FC  AE706324   SW S0, 25380(S3)
9D01AA0C  AE706324   SW S0, 25380(S3)
9D01AA1C  AE706324   SW S0, 25380(S3)
9D01AA2C  AE706324   SW S0, 25380(S3)
9D01AA3C  AE706324   SW S0, 25380(S3)
9D01AA4C  AE706324   SW S0, 25380(S3)
9D01AA58  AE706324   SW S0, 25380(S3)
9D01AA68  AE706324   SW S0, 25380(S3)
9D01AA78  AE706324   SW S0, 25380(S3)
9D01AA90  AE706324   SW S0, 25380(S3)
9D01AA9C  AE706324   SW S0, 25380(S3)
9D01AAA8  AE706324   SW S0, 25380(S3)
9D01AAB4  AE706324   SW S0, 25380(S3)
9D01AAC0  AE706324   SW S0, 25380(S3)
9D01AACC  AE706324   SW S0, 25380(S3)
9D01AADC  AE706324   SW S0, 25380(S3)
9D01AAEC  AE706324   SW S0, 25380(S3)
9D01AAFC  AE706324   SW S0, 25380(S3)
9D01AB0C  AE706324   SW S0, 25380(S3)
9D01AB1C  AE706324   SW S0, 25380(S3)
9D01AB2C  AE706324   SW S0, 25380(S3)
9D01AB3C  AE706324   SW S0, 25380(S3)
9D01AB4C  AE706324   SW S0, 25380(S3)
9D01AB64  AE706324   SW S0, 25380(S3)
9D01AB70  AE706324   SW S0, 25380(S3)
9D01AB7C  AE706324   SW S0, 25380(S3)
9D01AB88  AE706324   SW S0, 25380(S3)
9D01ABA0  AE706324   SW S0, 25380(S3)
9D01ABAC  AE706324   SW S0, 25380(S3)
9D01ABB8  AE706324   SW S0, 25380(S3)
9D01ABC4  AE706324   SW S0, 25380(S3)
445:                 	LCD_PORT = data1;
9D01874C  00151202   SRL V0, S5, 8
9D018764  32A300FF   ANDI V1, S5, 255
9D018778  7C853A00   EXT A1, A0, 8, 8
9D01877C  AE456430   SW A1, 25648(S2)
9D018788  308600FF   ANDI A2, A0, 255
9D0187A0  00143A02   SRL A3, S4, 8
9D0187B0  328800FF   ANDI T0, S4, 255
9D0187C4  7D2A3A00   EXT T2, T1, 8, 8
9D0187C8  AE4A6430   SW T2, 25648(S2)
9D0187D4  312B00FF   ANDI T3, T1, 255
9D018860  00161202   SRL V0, S6, 8
9D018878  32C300FF   ANDI V1, S6, 255
9D01888C  7C853A00   EXT A1, A0, 8, 8
9D01889C  308600FF   ANDI A2, A0, 255
9D0188B4  00153A02   SRL A3, S5, 8
9D0188C4  32A800FF   ANDI T0, S5, 255
9D0188D8  7D2A3A00   EXT T2, T1, 8, 8
9D0188E8  312B00FF   ANDI T3, T1, 255
9D018B34  001E1202   SRL V0, FP, 8
9D018B4C  33C300FF   ANDI V1, FP, 255
9D018B60  7C853A00   EXT A1, A0, 8, 8
9D018B70  308600FF   ANDI A2, A0, 255
9D018B88  00173A02   SRL A3, S7, 8
9D018B98  32E800FF   ANDI T0, S7, 255
9D018BAC  7D2A3A00   EXT T2, T1, 8, 8
9D018BBC  312B00FF   ANDI T3, T1, 255
9D01912C  3C1EBF88   LUI FP, -16504
9D0191E4  8FA5001C   LW A1, 28(SP)
9D0191E8  00054202   SRL T0, A1, 8
9D0191EC  AFC86430   SW T0, 25648(FP)
9D0191F8  30A900F8   ANDI T1, A1, 248
9D0191FC  AFC96430   SW T1, 25648(FP)
9D019208  8FA60014   LW A2, 20(SP)
9D01920C  7CCA3A00   EXT T2, A2, 8, 8
9D019210  AFCA6430   SW T2, 25648(FP)
9D01921C  30CB00FF   ANDI T3, A2, 255
9D019220  AFCB6430   SW T3, 25648(FP)
9D019238  8FAD0028   LW T5, 40(SP)
9D01923C  AFCD6430   SW T5, 25648(FP)
9D019248  8FAE002C   LW T6, 44(SP)
9D01924C  AFCE6430   SW T6, 25648(FP)
9D019258  8FAF0030   LW T7, 48(SP)
9D01925C  AFCF6430   SW T7, 25648(FP)
9D019268  8FB80034   LW T8, 52(SP)
9D01926C  AFD86430   SW T8, 25648(FP)
9D019600  00136202   SRL T4, S3, 8
9D019604  AFCC6430   SW T4, 25648(FP)
9D019610  326D00F8   ANDI T5, S3, 248
9D019620  8FAE0014   LW T6, 20(SP)
9D019634  31D800FF   ANDI T8, T6, 255
9D01964C  8FB90028   LW T9, 40(SP)
9D01965C  8FA3002C   LW V1, 44(SP)
9D01966C  8FA40030   LW A0, 48(SP)
9D01967C  8FA20034   LW V0, 52(SP)
9D019680  AFC26430   SW V0, 25648(FP)
9D019B80  8FAD0044   LW T5, 68(SP)
9D019B84  000D7202   SRL T6, T5, 8
9D019B88  AFAE0028   SW T6, 40(SP)
9D019B8C  8FAF0044   LW T7, 68(SP)
9D019B90  31F000FF   ANDI S0, T7, 255
9D019B94  AFB0002C   SW S0, 44(SP)
9D019BA0  7E533A00   EXT S3, S2, 8, 8
9D019BA4  AFB30030   SW S3, 48(SP)
9D019BA8  325400FF   ANDI S4, S2, 255
9D019BAC  AFB40034   SW S4, 52(SP)
9D019BCC  24030007   ADDIU V1, ZERO, 7
9D019BD0  AFA30014   SW V1, 20(SP)
9D019BD4  0B406453   J 0x9D01914C
9D019BD8  AFA00010   SW ZERO, 16(SP)
9D019C90  3C17BF88   LUI S7, -16504
9D019C94  3C079D03   LUI A3, -25341
9D019C98  24E8D478   ADDIU T0, A3, -11144
9D019C9C  AFA80040   SW T0, 64(SP)
9D019CA0  250908D0   ADDIU T1, T0, 2256
9D019CA4  AFA9003C   SW T1, 60(SP)
9D019D48  8FA40018   LW A0, 24(SP)
9D019D4C  00041202   SRL V0, A0, 8
9D019D50  AEE26430   SW V0, 25648(S7)
9D019D5C  308700F8   ANDI A3, A0, 248
9D019D60  AEE76430   SW A3, 25648(S7)
9D019D6C  8FA50014   LW A1, 20(SP)
9D019D70  7CA83A00   EXT T0, A1, 8, 8
9D019D74  AEE86430   SW T0, 25648(S7)
9D019D80  30A600FF   ANDI A2, A1, 255
9D019D84  AEE66430   SW A2, 25648(S7)
9D019D9C  8FAA0028   LW T2, 40(SP)
9D019DA0  AEEA6430   SW T2, 25648(S7)
9D019DAC  8FAB002C   LW T3, 44(SP)
9D019DB0  AEEB6430   SW T3, 25648(S7)
9D019DBC  8FAC0030   LW T4, 48(SP)
9D019DC0  AEEC6430   SW T4, 25648(S7)
9D019DCC  8FAD0034   LW T5, 52(SP)
9D019DD0  AEED6430   SW T5, 25648(S7)
9D01A168  00135202   SRL T2, S3, 8
9D01A16C  AEEA6430   SW T2, 25648(S7)
9D01A178  326B00F8   ANDI T3, S3, 248
9D01A188  8FAC0014   LW T4, 20(SP)
9D01A19C  318E00FF   ANDI T6, T4, 255
9D01A1B4  8FAF0028   LW T7, 40(SP)
9D01A1C4  8FA3002C   LW V1, 44(SP)
9D01A1D4  8FA40030   LW A0, 48(SP)
9D01A1E4  8FB80034   LW T8, 52(SP)
9D01A1E8  AEF86430   SW T8, 25648(S7)
9D01A6F0  000D7202   SRL T6, T5, 8
9D01A6F4  AFAE0028   SW T6, 40(SP)
9D01A6F8  31AF00FF   ANDI T7, T5, 255
9D01A6FC  AFAF002C   SW T7, 44(SP)
9D01A700  7D503A00   EXT S0, T2, 8, 8
9D01A704  AFB00030   SW S0, 48(SP)
9D01A708  317100FF   ANDI S1, T3, 255
9D01A70C  AFB10034   SW S1, 52(SP)
9D01A710  24120007   ADDIU S2, ZERO, 7
9D01A714  AFB20014   SW S2, 20(SP)
9D01A718  AFA00010   SW ZERO, 16(SP)
9D01A76C  3C05BF88   LUI A1, -16504
9D01A770  ACA46430   SW A0, 25648(A1)
9D01A854  3C12BF88   LUI S2, -16504
9D01A874  24090066   ADDIU T1, ZERO, 102
9D01A88C  2415000C   ADDIU S5, ZERO, 12
9D01A89C  AE556430   SW S5, 25648(S2)
9D01A8A8  AE406430   SW ZERO, 25648(S2)
9D01A8B4  240A0033   ADDIU T2, ZERO, 51
9D01A8C4  AE4A6430   SW T2, 25648(S2)
9D01A8D8  240B0035   ADDIU T3, ZERO, 53
9D01A8DC  AE4B6430   SW T3, 25648(S2)
9D01A8F0  240C002B   ADDIU T4, ZERO, 43
9D01A8F4  AE4C6430   SW T4, 25648(S2)
9D01A908  240D002C   ADDIU T5, ZERO, 44
9D01A90C  AE4D6430   SW T5, 25648(S2)
9D01A920  AE546430   SW S4, 25648(S2)
9D01A92C  240E00FF   ADDIU T6, ZERO, 255
9D01A930  AE4E6430   SW T6, 25648(S2)
9D01A944  240F0011   ADDIU T7, ZERO, 17
9D01A948  AE4F6430   SW T7, 25648(S2)
9D01A95C  24160020   ADDIU S6, ZERO, 32
9D01A960  AE566430   SW S6, 25648(S2)
9D01A974  2417000F   ADDIU S7, ZERO, 15
9D01A978  AE576430   SW S7, 25648(S2)
9D01A98C  241800A4   ADDIU T8, ZERO, 164
9D01A990  AE586430   SW T8, 25648(S2)
9D01A99C  241900A1   ADDIU T9, ZERO, 161
9D01A9A0  AE596430   SW T9, 25648(S2)
9D01A9B4  241E00D0   ADDIU FP, ZERO, 208
9D01A9B8  AE5E6430   SW FP, 25648(S2)
9D01A9C4  AE406430   SW ZERO, 25648(S2)
9D01A9D0  24170005   ADDIU S7, ZERO, 5
9D01A9D4  AE576430   SW S7, 25648(S2)
9D01A9E0  2402000E   ADDIU V0, ZERO, 14
9D01A9E4  AE426430   SW V0, 25648(S2)
9D01A9F0  24050015   ADDIU A1, ZERO, 21
9D01A9F4  AE456430   SW A1, 25648(S2)
9D01AA00  2416000D   ADDIU S6, ZERO, 13
9D01AA04  AE566430   SW S6, 25648(S2)
9D01AA10  24030037   ADDIU V1, ZERO, 55
9D01AA14  AE436430   SW V1, 25648(S2)
9D01AA20  24040043   ADDIU A0, ZERO, 67
9D01AA24  AE446430   SW A0, 25648(S2)
9D01AA30  24060047   ADDIU A2, ZERO, 71
9D01AA34  AE466430   SW A2, 25648(S2)
9D01AA40  24070009   ADDIU A3, ZERO, 9
9D01AA44  AE476430   SW A3, 25648(S2)
9D01AA50  AE456430   SW A1, 25648(S2)
9D01AA5C  24080012   ADDIU T0, ZERO, 18
9D01AA60  AE486430   SW T0, 25648(S2)
9D01AA6C  24090016   ADDIU T1, ZERO, 22
9D01AA70  AE496430   SW T1, 25648(S2)
9D01AA7C  240A0019   ADDIU T2, ZERO, 25
9D01AA80  AE4A6430   SW T2, 25648(S2)
9D01AA94  AE5E6430   SW FP, 25648(S2)
9D01AAA0  AE406430   SW ZERO, 25648(S2)
9D01AAAC  AE576430   SW S7, 25648(S2)
9D01AAB8  AE566430   SW S6, 25648(S2)
9D01AAC4  AE556430   SW S5, 25648(S2)
9D01AAD0  24150006   ADDIU S5, ZERO, 6
9D01AAD4  AE556430   SW S5, 25648(S2)
9D01AAE0  240B002D   ADDIU T3, ZERO, 45
9D01AAE4  AE4B6430   SW T3, 25648(S2)
9D01AAF0  240C0044   ADDIU T4, ZERO, 68
9D01AAF4  AE4C6430   SW T4, 25648(S2)
9D01AB00  240D0040   ADDIU T5, ZERO, 64
9D01AB04  AE4D6430   SW T5, 25648(S2)
9D01AB10  240E000E   ADDIU T6, ZERO, 14
9D01AB14  AE4E6430   SW T6, 25648(S2)
9D01AB20  240F001C   ADDIU T7, ZERO, 28
9D01AB24  AE4F6430   SW T7, 25648(S2)
9D01AB30  24180018   ADDIU T8, ZERO, 24
9D01AB34  AE586430   SW T8, 25648(S2)
9D01AB40  24190016   ADDIU T9, ZERO, 22
9D01AB44  AE596430   SW T9, 25648(S2)
9D01AB50  241E0019   ADDIU FP, ZERO, 25
9D01AB54  AE5E6430   SW FP, 25648(S2)
9D01AB68  AE406430   SW ZERO, 25648(S2)
9D01AB74  AE406430   SW ZERO, 25648(S2)
9D01AB80  AE546430   SW S4, 25648(S2)
9D01AB8C  2414003F   ADDIU S4, ZERO, 63
9D01AB90  AE546430   SW S4, 25648(S2)
9D01ABA4  AE406430   SW ZERO, 25648(S2)
9D01ABB0  AE406430   SW ZERO, 25648(S2)
9D01ABBC  AE406430   SW ZERO, 25648(S2)
9D01ABC8  241300EF   ADDIU S3, ZERO, 239
9D01ABCC  AE536430   SW S3, 25648(S2)
446:                 	LCD_WR_SET;
9D018758  3C11BF88   LUI S1, -16504
9D01876C  AE306328   SW S0, 25384(S1)
9D018780  AE306328   SW S0, 25384(S1)
9D018790  AE306328   SW S0, 25384(S1)
9D0187A8  AE306328   SW S0, 25384(S1)
9D0187B8  AE306328   SW S0, 25384(S1)
9D0187CC  AE306328   SW S0, 25384(S1)
9D0187DC  AE306328   SW S0, 25384(S1)
9D01886C  3C11BF88   LUI S1, -16504
9D018880  AE306328   SW S0, 25384(S1)
9D018894  AE306328   SW S0, 25384(S1)
9D0188A4  AE306328   SW S0, 25384(S1)
9D0188BC  AE306328   SW S0, 25384(S1)
9D0188CC  AE306328   SW S0, 25384(S1)
9D0188E0  AE306328   SW S0, 25384(S1)
9D0188F0  AE306328   SW S0, 25384(S1)
9D018B40  3C14BF88   LUI S4, -16504
9D018B54  AE936328   SW S3, 25384(S4)
9D018B68  AE936328   SW S3, 25384(S4)
9D018B78  AE936328   SW S3, 25384(S4)
9D018B90  AE936328   SW S3, 25384(S4)
9D018BA0  AE936328   SW S3, 25384(S4)
9D018BB4  AE936328   SW S3, 25384(S4)
9D018BC4  AE936328   SW S3, 25384(S4)
9D019130  3C17BF88   LUI S7, -16504
9D019134  3C0A9D03   LUI T2, -25341
9D019138  254BD478   ADDIU T3, T2, -11144
9D01913C  AFAB0040   SW T3, 64(SP)
9D019140  256C08D0   ADDIU T4, T3, 2256
9D019144  0B4066E0   J 0x9D019B80
9D019148  AFAC003C   SW T4, 60(SP)
9D01914C  8FA20010   LW V0, 16(SP)
9D019150  3047FFFF   ANDI A3, V0, -1
9D0191F0  AEE76328   SW A3, 25384(S7)
9D019200  AEE76328   SW A3, 25384(S7)
9D019214  AEE76328   SW A3, 25384(S7)
9D019224  AEE76328   SW A3, 25384(S7)
9D019240  AEEC6328   SW T4, 25384(S7)
9D019250  AEEC6328   SW T4, 25384(S7)
9D019260  AEEC6328   SW T4, 25384(S7)
9D019270  AEEC6328   SW T4, 25384(S7)
9D019608  AEF26328   SW S2, 25384(S7)
9D019618  AEF26328   SW S2, 25384(S7)
9D01962C  AEF26328   SW S2, 25384(S7)
9D01963C  AEF26328   SW S2, 25384(S7)
9D019654  AEF26328   SW S2, 25384(S7)
9D019664  AEF26328   SW S2, 25384(S7)
9D019674  AEF26328   SW S2, 25384(S7)
9D019684  AEF26328   SW S2, 25384(S7)
9D019CA8  0B4069B8   J 0x9D01A6E0
9D019CAC  3C1EBF88   LUI FP, -16504
9D019CB0  8FB9007C   LW T9, 124(SP)
9D019CB4  8FBF0020   LW RA, 32(SP)
9D019CB8  033F1021   ADDU V0, T9, RA
9D019CBC  8FA30010   LW V1, 16(SP)
9D019CC0  00432021   ADDU A0, V0, V1
9D019D54  AFC36328   SW V1, 25384(FP)
9D019D64  AFC36328   SW V1, 25384(FP)
9D019D78  AFC36328   SW V1, 25384(FP)
9D019D88  AFC36328   SW V1, 25384(FP)
9D019DA4  AFC96328   SW T1, 25384(FP)
9D019DB4  AFC96328   SW T1, 25384(FP)
9D019DC4  AFC96328   SW T1, 25384(FP)
9D019DD4  240E0010   ADDIU T6, ZERO, 16
9D019DD8  AFCE6328   SW T6, 25384(FP)
9D01A170  AFD26328   SW S2, 25384(FP)
9D01A180  AFD26328   SW S2, 25384(FP)
9D01A194  AFD26328   SW S2, 25384(FP)
9D01A1A4  AFD26328   SW S2, 25384(FP)
9D01A1BC  AFD26328   SW S2, 25384(FP)
9D01A1CC  AFD26328   SW S2, 25384(FP)
9D01A1DC  AFD26328   SW S2, 25384(FP)
9D01A1EC  AFD26328   SW S2, 25384(FP)
9D01A774  3C04BF88   LUI A0, -16504
9D01A778  AC826328   SW V0, 25384(A0)
9D01A77C  03E00008   JR RA
9D01A780  00000000   NOP
9D01A860  3C11BF88   LUI S1, -16504
9D01A87C  AE306328   SW S0, 25384(S1)
9D01A894  AE306328   SW S0, 25384(S1)
9D01A8A0  AE306328   SW S0, 25384(S1)
9D01A8AC  AE306328   SW S0, 25384(S1)
9D01A8BC  AE306328   SW S0, 25384(S1)
9D01A8C8  AE306328   SW S0, 25384(S1)
9D01A8E0  AE306328   SW S0, 25384(S1)
9D01A8F8  AE306328   SW S0, 25384(S1)
9D01A910  AE306328   SW S0, 25384(S1)
9D01A924  AE306328   SW S0, 25384(S1)
9D01A934  AE306328   SW S0, 25384(S1)
9D01A94C  AE306328   SW S0, 25384(S1)
9D01A964  AE306328   SW S0, 25384(S1)
9D01A97C  AE306328   SW S0, 25384(S1)
9D01A994  AE306328   SW S0, 25384(S1)
9D01A9A4  AE306328   SW S0, 25384(S1)
9D01A9BC  AE306328   SW S0, 25384(S1)
9D01A9C8  AE306328   SW S0, 25384(S1)
9D01A9D8  AE306328   SW S0, 25384(S1)
9D01A9E8  AE306328   SW S0, 25384(S1)
9D01A9F8  AE306328   SW S0, 25384(S1)
9D01AA08  AE306328   SW S0, 25384(S1)
9D01AA18  AE306328   SW S0, 25384(S1)
9D01AA28  AE306328   SW S0, 25384(S1)
9D01AA38  AE306328   SW S0, 25384(S1)
9D01AA48  AE306328   SW S0, 25384(S1)
9D01AA54  AE306328   SW S0, 25384(S1)
9D01AA64  AE306328   SW S0, 25384(S1)
9D01AA74  AE306328   SW S0, 25384(S1)
9D01AA84  AE306328   SW S0, 25384(S1)
9D01AA98  AE306328   SW S0, 25384(S1)
9D01AAA4  AE306328   SW S0, 25384(S1)
9D01AAB0  AE306328   SW S0, 25384(S1)
9D01AABC  AE306328   SW S0, 25384(S1)
9D01AAC8  AE306328   SW S0, 25384(S1)
9D01AAD8  AE306328   SW S0, 25384(S1)
9D01AAE8  AE306328   SW S0, 25384(S1)
9D01AAF8  AE306328   SW S0, 25384(S1)
9D01AB08  AE306328   SW S0, 25384(S1)
9D01AB18  AE306328   SW S0, 25384(S1)
9D01AB28  AE306328   SW S0, 25384(S1)
9D01AB38  AE306328   SW S0, 25384(S1)
9D01AB48  AE306328   SW S0, 25384(S1)
9D01AB58  AE306328   SW S0, 25384(S1)
9D01AB6C  AE306328   SW S0, 25384(S1)
9D01AB78  AE306328   SW S0, 25384(S1)
9D01AB84  AE306328   SW S0, 25384(S1)
9D01AB94  AE306328   SW S0, 25384(S1)
9D01ABA8  AE306328   SW S0, 25384(S1)
9D01ABB4  AE306328   SW S0, 25384(S1)
9D01ABC0  AE306328   SW S0, 25384(S1)
9D01ABD0  AE306328   SW S0, 25384(S1)
447:                 	}
448:                 
449:                 inline void TFT_24_7789_Write_Data3(uint16_t data1,uint16_t data2, uint16_t data3)
450:                 	{
451:                 	LCD_WR_CLR;
9D018918  0280C821   ADDU T9, S4, ZERO
9D018930  AE9F6324   SW RA, 25380(S4)
9D018968  AF3F6324   SW RA, 25380(T9)
9D01898C  AF3F6324   SW RA, 25380(T9)
9D0189B0  AF3F6324   SW RA, 25380(T9)
9D0189D4  AF3F6324   SW RA, 25380(T9)
9D018A4C  AF3F6324   SW RA, 25380(T9)
9D018A74  AF3F6324   SW RA, 25380(T9)
9D018A9C  AF3F6324   SW RA, 25380(T9)
9D018BE4  02C07821   ADDU T7, S6, ZERO
9D018BE8  24180010   ADDIU T8, ZERO, 16
9D018BF0  ADF86324   SW T8, 25380(T7)
9D018C14  ADF86324   SW T8, 25380(T7)
9D018C38  ADF86324   SW T8, 25380(T7)
9D018C5C  ADF86324   SW T8, 25380(T7)
9D018C80  ADF86324   SW T8, 25380(T7)
9D018CA4  ADF86324   SW T8, 25380(T7)
9D018CC8  ADF86324   SW T8, 25380(T7)
9D018CEC  ADF86324   SW T8, 25380(T7)
9D018D58  3C05BF88   LUI A1, -16504
9D018D5C  24080010   ADDIU T0, ZERO, 16
9D018D84  ACA86324   SW T0, 25380(A1)
9D018DB0  ACA86324   SW T0, 25380(A1)
9D018DE4  ACA86324   SW T0, 25380(A1)
9D018E10  ACA86324   SW T0, 25380(A1)
9D018E44  ACA86324   SW T0, 25380(A1)
9D018E70  ACA86324   SW T0, 25380(A1)
9D018EA4  ACA86324   SW T0, 25380(A1)
9D018ED0  ACA86324   SW T0, 25380(A1)
9D018F04  ACA86324   SW T0, 25380(A1)
9D018F30  ACA86324   SW T0, 25380(A1)
9D018F64  ACA86324   SW T0, 25380(A1)
9D018F90  ACA86324   SW T0, 25380(A1)
9D018FC4  ACA86324   SW T0, 25380(A1)
9D018FF0  ACA86324   SW T0, 25380(A1)
9D019020  ACA86324   SW T0, 25380(A1)
9D01904C  ACA86324   SW T0, 25380(A1)
9D019284  24020010   ADDIU V0, ZERO, 16
9D019288  8FA7003C   LW A3, 60(SP)
9D0192A0  AEC26324   SW V0, 25380(S6)
9D0192CC  AEC26324   SW V0, 25380(S6)
9D019300  AEC26324   SW V0, 25380(S6)
9D01932C  AEC26324   SW V0, 25380(S6)
9D019360  AEC26324   SW V0, 25380(S6)
9D01938C  AEC26324   SW V0, 25380(S6)
9D0193C0  AEC26324   SW V0, 25380(S6)
9D0193EC  AEC26324   SW V0, 25380(S6)
9D019420  AEC26324   SW V0, 25380(S6)
9D01944C  AEC26324   SW V0, 25380(S6)
9D019480  AEC26324   SW V0, 25380(S6)
9D0194AC  AEC26324   SW V0, 25380(S6)
9D0194E0  AEC26324   SW V0, 25380(S6)
9D01950C  AEC26324   SW V0, 25380(S6)
9D01953C  AEC26324   SW V0, 25380(S6)
9D019568  AEC26324   SW V0, 25380(S6)
9D0196A4  241F0010   ADDIU RA, ZERO, 16
9D0196A8  AEDF6324   SW RA, 25380(S6)
9D0196CC  AEDF6324   SW RA, 25380(S6)
9D0196F0  AEDF6324   SW RA, 25380(S6)
9D019714  AEDF6324   SW RA, 25380(S6)
9D019738  AEDF6324   SW RA, 25380(S6)
9D01975C  AEDF6324   SW RA, 25380(S6)
9D019780  AEDF6324   SW RA, 25380(S6)
9D0197A4  AEDF6324   SW RA, 25380(S6)
9D019808  240D0010   ADDIU T5, ZERO, 16
9D019828  AECD6324   SW T5, 25380(S6)
9D019854  AECD6324   SW T5, 25380(S6)
9D019888  AECD6324   SW T5, 25380(S6)
9D0198B4  AECD6324   SW T5, 25380(S6)
9D0198E8  AECD6324   SW T5, 25380(S6)
9D019914  AECD6324   SW T5, 25380(S6)
9D019948  AECD6324   SW T5, 25380(S6)
9D019974  AECD6324   SW T5, 25380(S6)
9D0199A8  AECD6324   SW T5, 25380(S6)
9D0199D4  AECD6324   SW T5, 25380(S6)
9D019A08  AECD6324   SW T5, 25380(S6)
9D019A34  AECD6324   SW T5, 25380(S6)
9D019A68  AECD6324   SW T5, 25380(S6)
9D019A94  AECD6324   SW T5, 25380(S6)
9D019AC4  AECD6324   SW T5, 25380(S6)
9D019AF0  AECD6324   SW T5, 25380(S6)
9D019DEC  24180010   ADDIU T8, ZERO, 16
9D019DF0  8FB9003C   LW T9, 60(SP)
9D019E08  AED86324   SW T8, 25380(S6)
9D019E34  AED86324   SW T8, 25380(S6)
9D019E68  AED86324   SW T8, 25380(S6)
9D019E94  AED86324   SW T8, 25380(S6)
9D019EC8  AED86324   SW T8, 25380(S6)
9D019EF4  AED86324   SW T8, 25380(S6)
9D019F28  AED86324   SW T8, 25380(S6)
9D019F54  AED86324   SW T8, 25380(S6)
9D019F88  AED86324   SW T8, 25380(S6)
9D019FB4  AED86324   SW T8, 25380(S6)
9D019FE8  AED86324   SW T8, 25380(S6)
9D01A014  AED86324   SW T8, 25380(S6)
9D01A048  AED86324   SW T8, 25380(S6)
9D01A074  AED86324   SW T8, 25380(S6)
9D01A0A4  AED86324   SW T8, 25380(S6)
9D01A0D0  AED86324   SW T8, 25380(S6)
9D01A20C  241F0010   ADDIU RA, ZERO, 16
9D01A210  AEDF6324   SW RA, 25380(S6)
9D01A234  AEDF6324   SW RA, 25380(S6)
9D01A258  AEDF6324   SW RA, 25380(S6)
9D01A27C  AEDF6324   SW RA, 25380(S6)
9D01A2A0  AEDF6324   SW RA, 25380(S6)
9D01A2C4  AEDF6324   SW RA, 25380(S6)
9D01A2E8  AEDF6324   SW RA, 25380(S6)
9D01A30C  AEDF6324   SW RA, 25380(S6)
9D01A370  240B0010   ADDIU T3, ZERO, 16
9D01A390  AECB6324   SW T3, 25380(S6)
9D01A3BC  AECB6324   SW T3, 25380(S6)
9D01A3F0  AECB6324   SW T3, 25380(S6)
9D01A41C  AECB6324   SW T3, 25380(S6)
9D01A450  AECB6324   SW T3, 25380(S6)
9D01A47C  AECB6324   SW T3, 25380(S6)
9D01A4B0  AECB6324   SW T3, 25380(S6)
9D01A4DC  AECB6324   SW T3, 25380(S6)
9D01A510  AECB6324   SW T3, 25380(S6)
9D01A53C  AECB6324   SW T3, 25380(S6)
9D01A570  AECB6324   SW T3, 25380(S6)
9D01A59C  AECB6324   SW T3, 25380(S6)
9D01A5D0  AECB6324   SW T3, 25380(S6)
9D01A5FC  AECB6324   SW T3, 25380(S6)
9D01A62C  AECB6324   SW T3, 25380(S6)
9D01A658  AECB6324   SW T3, 25380(S6)
9D01A784  3C08BF88   LUI T0, -16504
9D01A788  24020010   ADDIU V0, ZERO, 16
9D01A78C  AD026324   SW V0, 25380(T0)
452:                 	LCD_PORT = data1;
9D018910  7E4F3C00   EXT T7, S2, 16, 8
9D01891C  0260B021   ADDU S6, S3, ZERO
9D018934  AE6F6430   SW T7, 25648(S3)
9D01896C  AECF6430   SW T7, 25648(S6)
9D018990  AECF6430   SW T7, 25648(S6)
9D0189B4  AECF6430   SW T7, 25648(S6)
9D0189D8  AECF6430   SW T7, 25648(S6)
9D018A50  AE6F6430   SW T7, 25648(S3)
9D018A78  AECF6430   SW T7, 25648(S6)
9D018AA0  AECF6430   SW T7, 25648(S6)
9D018BEC  02A0C821   ADDU T9, S5, ZERO
9D018BF4  AF306430   SW S0, 25648(T9)
9D018C18  AF306430   SW S0, 25648(T9)
9D018C3C  AF306430   SW S0, 25648(T9)
9D018C60  AF306430   SW S0, 25648(T9)
9D018C84  AF306430   SW S0, 25648(T9)
9D018CA8  AF306430   SW S0, 25648(T9)
9D018CCC  AF306430   SW S0, 25648(T9)
9D018CF0  AF306430   SW S0, 25648(T9)
9D018D60  3C04BF88   LUI A0, -16504
9D018D88  AC8F6430   SW T7, 25648(A0)
9D018DB4  AC906430   SW S0, 25648(A0)
9D018DE8  AC8F6430   SW T7, 25648(A0)
9D018E14  AC906430   SW S0, 25648(A0)
9D018E48  AC8F6430   SW T7, 25648(A0)
9D018E74  AC906430   SW S0, 25648(A0)
9D018EA8  AC8F6430   SW T7, 25648(A0)
9D018ED4  AC906430   SW S0, 25648(A0)
9D018F08  AC8F6430   SW T7, 25648(A0)
9D018F34  AC906430   SW S0, 25648(A0)
9D018F68  AC8F6430   SW T7, 25648(A0)
9D018F94  AC906430   SW S0, 25648(A0)
9D018FC8  AC8F6430   SW T7, 25648(A0)
9D018FF4  AC906430   SW S0, 25648(A0)
9D019024  AC8F6430   SW T7, 25648(A0)
9D019050  AC906430   SW S0, 25648(A0)
9D0192A4  AFD36430   SW S3, 25648(FP)
9D0192D0  AFD06430   SW S0, 25648(FP)
9D019304  AFD36430   SW S3, 25648(FP)
9D019330  AFD06430   SW S0, 25648(FP)
9D019364  AFD36430   SW S3, 25648(FP)
9D019390  AFD06430   SW S0, 25648(FP)
9D0193C4  AFD36430   SW S3, 25648(FP)
9D0193F0  AFD06430   SW S0, 25648(FP)
9D019424  AFD36430   SW S3, 25648(FP)
9D019450  AFD06430   SW S0, 25648(FP)
9D019484  AFD36430   SW S3, 25648(FP)
9D0194B0  AFD06430   SW S0, 25648(FP)
9D0194E4  AFD36430   SW S3, 25648(FP)
9D019510  AFD06430   SW S0, 25648(FP)
9D019540  AFD36430   SW S3, 25648(FP)
9D01956C  AFD06430   SW S0, 25648(FP)
9D0196AC  AFD46430   SW S4, 25648(FP)
9D0196D0  AFD46430   SW S4, 25648(FP)
9D0196F4  AFD46430   SW S4, 25648(FP)
9D019718  AFD46430   SW S4, 25648(FP)
9D01973C  AFD46430   SW S4, 25648(FP)
9D019760  AFD46430   SW S4, 25648(FP)
9D019784  AFD46430   SW S4, 25648(FP)
9D0197A8  AFD46430   SW S4, 25648(FP)
9D01982C  AFDF6430   SW RA, 25648(FP)
9D019858  AFD46430   SW S4, 25648(FP)
9D01988C  AFDF6430   SW RA, 25648(FP)
9D0198B8  AFD46430   SW S4, 25648(FP)
9D0198EC  AFDF6430   SW RA, 25648(FP)
9D019918  AFD46430   SW S4, 25648(FP)
9D01994C  AFDF6430   SW RA, 25648(FP)
9D019978  AFD46430   SW S4, 25648(FP)
9D0199AC  AFDF6430   SW RA, 25648(FP)
9D0199D8  AFD46430   SW S4, 25648(FP)
9D019A0C  AFDF6430   SW RA, 25648(FP)
9D019A38  AFD46430   SW S4, 25648(FP)
9D019A6C  AFDF6430   SW RA, 25648(FP)
9D019A98  AFD46430   SW S4, 25648(FP)
9D019AC8  AFDF6430   SW RA, 25648(FP)
9D019AF4  AFD46430   SW S4, 25648(FP)
9D019E0C  AEF36430   SW S3, 25648(S7)
9D019E38  AEF06430   SW S0, 25648(S7)
9D019E6C  AEF36430   SW S3, 25648(S7)
9D019E98  AEF06430   SW S0, 25648(S7)
9D019ECC  AEF36430   SW S3, 25648(S7)
9D019EF8  AEF06430   SW S0, 25648(S7)
9D019F2C  AEF36430   SW S3, 25648(S7)
9D019F58  AEF06430   SW S0, 25648(S7)
9D019F8C  AEF36430   SW S3, 25648(S7)
9D019FB8  AEF06430   SW S0, 25648(S7)
9D019FEC  AEF36430   SW S3, 25648(S7)
9D01A018  AEF06430   SW S0, 25648(S7)
9D01A04C  AEF36430   SW S3, 25648(S7)
9D01A078  AEF06430   SW S0, 25648(S7)
9D01A0A8  AEF36430   SW S3, 25648(S7)
9D01A0D4  AEF06430   SW S0, 25648(S7)
9D01A214  AEF46430   SW S4, 25648(S7)
9D01A238  AEF46430   SW S4, 25648(S7)
9D01A25C  AEF46430   SW S4, 25648(S7)
9D01A280  AEF46430   SW S4, 25648(S7)
9D01A2A4  AEF46430   SW S4, 25648(S7)
9D01A2C8  AEF46430   SW S4, 25648(S7)
9D01A2EC  AEF46430   SW S4, 25648(S7)
9D01A310  AEF46430   SW S4, 25648(S7)
9D01A394  AEFF6430   SW RA, 25648(S7)
9D01A3C0  AEF46430   SW S4, 25648(S7)
9D01A3F4  AEFF6430   SW RA, 25648(S7)
9D01A420  AEF46430   SW S4, 25648(S7)
9D01A454  AEFF6430   SW RA, 25648(S7)
9D01A480  AEF46430   SW S4, 25648(S7)
9D01A4B4  AEFF6430   SW RA, 25648(S7)
9D01A4E0  AEF46430   SW S4, 25648(S7)
9D01A514  AEFF6430   SW RA, 25648(S7)
9D01A540  AEF46430   SW S4, 25648(S7)
9D01A574  AEFF6430   SW RA, 25648(S7)
9D01A5A0  AEF46430   SW S4, 25648(S7)
9D01A5D4  AEFF6430   SW RA, 25648(S7)
9D01A600  AEF46430   SW S4, 25648(S7)
9D01A630  AEFF6430   SW RA, 25648(S7)
9D01A65C  AEF46430   SW S4, 25648(S7)
9D01A790  3C07BF88   LUI A3, -16504
9D01A794  ACE46430   SW A0, 25648(A3)
453:                 	LCD_WR_SET;
9D018920  0220A821   ADDU S5, S1, ZERO
9D018938  AE3F6328   SW RA, 25384(S1)
9D018970  AEBF6328   SW RA, 25384(S5)
9D018994  AEBF6328   SW RA, 25384(S5)
9D0189B8  AEBF6328   SW RA, 25384(S5)
9D0189DC  AEBF6328   SW RA, 25384(S5)
9D018A54  AE3F6328   SW RA, 25384(S1)
9D018A7C  AEBF6328   SW RA, 25384(S5)
9D018AA4  AEBF6328   SW RA, 25384(S5)
9D018BF8  AE986328   SW T8, 25384(S4)
9D018C1C  AE986328   SW T8, 25384(S4)
9D018C40  AE986328   SW T8, 25384(S4)
9D018C64  AE986328   SW T8, 25384(S4)
9D018C88  AE986328   SW T8, 25384(S4)
9D018CAC  AE986328   SW T8, 25384(S4)
9D018CD0  AE986328   SW T8, 25384(S4)
9D018CF4  AE986328   SW T8, 25384(S4)
9D018D64  3C03BF88   LUI V1, -16504
9D018D8C  AC686328   SW T0, 25384(V1)
9D018DB8  AC686328   SW T0, 25384(V1)
9D018DEC  AC686328   SW T0, 25384(V1)
9D018E18  AC686328   SW T0, 25384(V1)
9D018E4C  AC686328   SW T0, 25384(V1)
9D018E78  AC686328   SW T0, 25384(V1)
9D018EAC  AC686328   SW T0, 25384(V1)
9D018ED8  AC686328   SW T0, 25384(V1)
9D018F0C  AC686328   SW T0, 25384(V1)
9D018F38  AC686328   SW T0, 25384(V1)
9D018F6C  AC686328   SW T0, 25384(V1)
9D018F98  AC686328   SW T0, 25384(V1)
9D018FCC  AC686328   SW T0, 25384(V1)
9D018FF8  AC686328   SW T0, 25384(V1)
9D019028  AC686328   SW T0, 25384(V1)
9D019054  AC686328   SW T0, 25384(V1)
9D0192A8  AEE26328   SW V0, 25384(S7)
9D0192D4  AEE26328   SW V0, 25384(S7)
9D019308  AEE26328   SW V0, 25384(S7)
9D019334  AEE26328   SW V0, 25384(S7)
9D019368  AEE26328   SW V0, 25384(S7)
9D019394  AEE26328   SW V0, 25384(S7)
9D0193C8  AEE26328   SW V0, 25384(S7)
9D0193F4  AEE26328   SW V0, 25384(S7)
9D019428  AEE26328   SW V0, 25384(S7)
9D019454  AEE26328   SW V0, 25384(S7)
9D019488  AEE26328   SW V0, 25384(S7)
9D0194B4  AEE26328   SW V0, 25384(S7)
9D0194E8  AEE26328   SW V0, 25384(S7)
9D019514  AEE26328   SW V0, 25384(S7)
9D019544  AEE26328   SW V0, 25384(S7)
9D019570  AEE26328   SW V0, 25384(S7)
9D0196B0  AEFF6328   SW RA, 25384(S7)
9D0196D4  AEFF6328   SW RA, 25384(S7)
9D0196F8  AEFF6328   SW RA, 25384(S7)
9D01971C  AEFF6328   SW RA, 25384(S7)
9D019740  AEFF6328   SW RA, 25384(S7)
9D019764  AEFF6328   SW RA, 25384(S7)
9D019788  AEFF6328   SW RA, 25384(S7)
9D0197AC  AEFF6328   SW RA, 25384(S7)
9D019830  AEED6328   SW T5, 25384(S7)
9D01985C  AEED6328   SW T5, 25384(S7)
9D019890  AEED6328   SW T5, 25384(S7)
9D0198BC  AEED6328   SW T5, 25384(S7)
9D0198F0  AEED6328   SW T5, 25384(S7)
9D01991C  AEED6328   SW T5, 25384(S7)
9D019950  AEED6328   SW T5, 25384(S7)
9D01997C  AEED6328   SW T5, 25384(S7)
9D0199B0  AEED6328   SW T5, 25384(S7)
9D0199DC  AEED6328   SW T5, 25384(S7)
9D019A10  AEED6328   SW T5, 25384(S7)
9D019A3C  AEED6328   SW T5, 25384(S7)
9D019A70  AEED6328   SW T5, 25384(S7)
9D019A9C  AEED6328   SW T5, 25384(S7)
9D019ACC  AEED6328   SW T5, 25384(S7)
9D019AF8  AEED6328   SW T5, 25384(S7)
9D019E10  AFD86328   SW T8, 25384(FP)
9D019E3C  AFD86328   SW T8, 25384(FP)
9D019E70  AFD86328   SW T8, 25384(FP)
9D019E9C  AFD86328   SW T8, 25384(FP)
9D019ED0  AFD86328   SW T8, 25384(FP)
9D019EFC  AFD86328   SW T8, 25384(FP)
9D019F30  AFD86328   SW T8, 25384(FP)
9D019F5C  AFD86328   SW T8, 25384(FP)
9D019F90  AFD86328   SW T8, 25384(FP)
9D019FBC  AFD86328   SW T8, 25384(FP)
9D019FF0  AFD86328   SW T8, 25384(FP)
9D01A01C  AFD86328   SW T8, 25384(FP)
9D01A050  AFD86328   SW T8, 25384(FP)
9D01A07C  AFD86328   SW T8, 25384(FP)
9D01A0AC  AFD86328   SW T8, 25384(FP)
9D01A0D8  AFD86328   SW T8, 25384(FP)
9D01A218  AFDF6328   SW RA, 25384(FP)
9D01A23C  AFDF6328   SW RA, 25384(FP)
9D01A260  AFDF6328   SW RA, 25384(FP)
9D01A284  AFDF6328   SW RA, 25384(FP)
9D01A2A8  AFDF6328   SW RA, 25384(FP)
9D01A2CC  AFDF6328   SW RA, 25384(FP)
9D01A2F0  AFDF6328   SW RA, 25384(FP)
9D01A314  AFDF6328   SW RA, 25384(FP)
9D01A398  AFCB6328   SW T3, 25384(FP)
9D01A3C4  AFCB6328   SW T3, 25384(FP)
9D01A3F8  AFCB6328   SW T3, 25384(FP)
9D01A424  AFCB6328   SW T3, 25384(FP)
9D01A458  AFCB6328   SW T3, 25384(FP)
9D01A484  AFCB6328   SW T3, 25384(FP)
9D01A4B8  AFCB6328   SW T3, 25384(FP)
9D01A4E4  AFCB6328   SW T3, 25384(FP)
9D01A518  AFCB6328   SW T3, 25384(FP)
9D01A544  AFCB6328   SW T3, 25384(FP)
9D01A578  AFCB6328   SW T3, 25384(FP)
9D01A5A4  AFCB6328   SW T3, 25384(FP)
9D01A5D8  AFCB6328   SW T3, 25384(FP)
9D01A604  AFCB6328   SW T3, 25384(FP)
9D01A634  AFCB6328   SW T3, 25384(FP)
9D01A660  AFCB6328   SW T3, 25384(FP)
9D01A798  3C03BF88   LUI V1, -16504
9D01A79C  AC626328   SW V0, 25384(V1)
454:                 	LCD_WR_CLR;
9D01893C  AE9F6324   SW RA, 25380(S4)
9D018974  AF3F6324   SW RA, 25380(T9)
9D018998  AF3F6324   SW RA, 25380(T9)
9D0189BC  AF3F6324   SW RA, 25380(T9)
9D0189E0  AF3F6324   SW RA, 25380(T9)
9D018A58  AF3F6324   SW RA, 25380(T9)
9D018A80  AF3F6324   SW RA, 25380(T9)
9D018AA8  AF3F6324   SW RA, 25380(T9)
9D018BFC  ADF86324   SW T8, 25380(T7)
9D018C20  ADF86324   SW T8, 25380(T7)
9D018C44  ADF86324   SW T8, 25380(T7)
9D018C68  ADF86324   SW T8, 25380(T7)
9D018C8C  ADF86324   SW T8, 25380(T7)
9D018CB0  ADF86324   SW T8, 25380(T7)
9D018CD4  ADF86324   SW T8, 25380(T7)
9D018CF8  ADF86324   SW T8, 25380(T7)
9D018D90  ACA86324   SW T0, 25380(A1)
9D018DBC  ACA86324   SW T0, 25380(A1)
9D018DF0  ACA86324   SW T0, 25380(A1)
9D018E1C  ACA86324   SW T0, 25380(A1)
9D018E50  ACA86324   SW T0, 25380(A1)
9D018E7C  ACA86324   SW T0, 25380(A1)
9D018EB0  ACA86324   SW T0, 25380(A1)
9D018EDC  ACA86324   SW T0, 25380(A1)
9D018F10  ACA86324   SW T0, 25380(A1)
9D018F3C  ACA86324   SW T0, 25380(A1)
9D018F70  ACA86324   SW T0, 25380(A1)
9D018F9C  ACA86324   SW T0, 25380(A1)
9D018FD0  ACA86324   SW T0, 25380(A1)
9D018FFC  ACA86324   SW T0, 25380(A1)
9D01902C  ACA86324   SW T0, 25380(A1)
9D019058  ACA86324   SW T0, 25380(A1)
9D0192AC  AEC26324   SW V0, 25380(S6)
9D0192D8  AEC26324   SW V0, 25380(S6)
9D01930C  AEC26324   SW V0, 25380(S6)
9D019338  AEC26324   SW V0, 25380(S6)
9D01936C  AEC26324   SW V0, 25380(S6)
9D019398  AEC26324   SW V0, 25380(S6)
9D0193CC  AEC26324   SW V0, 25380(S6)
9D0193F8  AEC26324   SW V0, 25380(S6)
9D01942C  AEC26324   SW V0, 25380(S6)
9D019458  AEC26324   SW V0, 25380(S6)
9D01948C  AEC26324   SW V0, 25380(S6)
9D0194B8  AEC26324   SW V0, 25380(S6)
9D0194EC  AEC26324   SW V0, 25380(S6)
9D019518  AEC26324   SW V0, 25380(S6)
9D019548  AEC26324   SW V0, 25380(S6)
9D019574  AEC26324   SW V0, 25380(S6)
9D0196B4  AEDF6324   SW RA, 25380(S6)
9D0196D8  AEDF6324   SW RA, 25380(S6)
9D0196FC  AEDF6324   SW RA, 25380(S6)
9D019720  AEDF6324   SW RA, 25380(S6)
9D019744  AEDF6324   SW RA, 25380(S6)
9D019768  AEDF6324   SW RA, 25380(S6)
9D01978C  AEDF6324   SW RA, 25380(S6)
9D0197B0  AEDF6324   SW RA, 25380(S6)
9D019834  AECD6324   SW T5, 25380(S6)
9D019860  AECD6324   SW T5, 25380(S6)
9D019894  AECD6324   SW T5, 25380(S6)
9D0198C0  AECD6324   SW T5, 25380(S6)
9D0198F4  AECD6324   SW T5, 25380(S6)
9D019920  AECD6324   SW T5, 25380(S6)
9D019954  AECD6324   SW T5, 25380(S6)
9D019980  AECD6324   SW T5, 25380(S6)
9D0199B4  AECD6324   SW T5, 25380(S6)
9D0199E0  AECD6324   SW T5, 25380(S6)
9D019A14  AECD6324   SW T5, 25380(S6)
9D019A40  AECD6324   SW T5, 25380(S6)
9D019A74  AECD6324   SW T5, 25380(S6)
9D019AA0  AECD6324   SW T5, 25380(S6)
9D019AD0  AECD6324   SW T5, 25380(S6)
9D019AFC  AECD6324   SW T5, 25380(S6)
9D019E14  AED86324   SW T8, 25380(S6)
9D019E40  AED86324   SW T8, 25380(S6)
9D019E74  AED86324   SW T8, 25380(S6)
9D019EA0  AED86324   SW T8, 25380(S6)
9D019ED4  AED86324   SW T8, 25380(S6)
9D019F00  AED86324   SW T8, 25380(S6)
9D019F34  AED86324   SW T8, 25380(S6)
9D019F60  AED86324   SW T8, 25380(S6)
9D019F94  AED86324   SW T8, 25380(S6)
9D019FC0  AED86324   SW T8, 25380(S6)
9D019FF4  AED86324   SW T8, 25380(S6)
9D01A020  AED86324   SW T8, 25380(S6)
9D01A054  AED86324   SW T8, 25380(S6)
9D01A080  AED86324   SW T8, 25380(S6)
9D01A0B0  AED86324   SW T8, 25380(S6)
9D01A0DC  AED86324   SW T8, 25380(S6)
9D01A21C  AEDF6324   SW RA, 25380(S6)
9D01A240  AEDF6324   SW RA, 25380(S6)
9D01A264  AEDF6324   SW RA, 25380(S6)
9D01A288  AEDF6324   SW RA, 25380(S6)
9D01A2AC  AEDF6324   SW RA, 25380(S6)
9D01A2D0  AEDF6324   SW RA, 25380(S6)
9D01A2F4  AEDF6324   SW RA, 25380(S6)
9D01A318  AEDF6324   SW RA, 25380(S6)
9D01A39C  AECB6324   SW T3, 25380(S6)
9D01A3C8  AECB6324   SW T3, 25380(S6)
9D01A3FC  AECB6324   SW T3, 25380(S6)
9D01A428  AECB6324   SW T3, 25380(S6)
9D01A45C  AECB6324   SW T3, 25380(S6)
9D01A488  AECB6324   SW T3, 25380(S6)
9D01A4BC  AECB6324   SW T3, 25380(S6)
9D01A4E8  AECB6324   SW T3, 25380(S6)
9D01A51C  AECB6324   SW T3, 25380(S6)
9D01A548  AECB6324   SW T3, 25380(S6)
9D01A57C  AECB6324   SW T3, 25380(S6)
9D01A5A8  AECB6324   SW T3, 25380(S6)
9D01A5DC  AECB6324   SW T3, 25380(S6)
9D01A608  AECB6324   SW T3, 25380(S6)
9D01A638  AECB6324   SW T3, 25380(S6)
9D01A664  AECB6324   SW T3, 25380(S6)
9D01A7A0  AD026324   SW V0, 25380(T0)
455:                 	LCD_PORT = data2;
9D018914  7E583A00   EXT T8, S2, 8, 8
9D018940  AE786430   SW T8, 25648(S3)
9D018978  AED86430   SW T8, 25648(S6)
9D01899C  AED86430   SW T8, 25648(S6)
9D0189C0  AED86430   SW T8, 25648(S6)
9D0189E4  AED86430   SW T8, 25648(S6)
9D018A5C  AE786430   SW T8, 25648(S3)
9D018A84  AED86430   SW T8, 25648(S6)
9D018AAC  AED86430   SW T8, 25648(S6)
9D018C00  AF316430   SW S1, 25648(T9)
9D018C24  AF316430   SW S1, 25648(T9)
9D018C48  AF316430   SW S1, 25648(T9)
9D018C6C  AF316430   SW S1, 25648(T9)
9D018C90  AF316430   SW S1, 25648(T9)
9D018CB4  AF316430   SW S1, 25648(T9)
9D018CD8  AF316430   SW S1, 25648(T9)
9D018CFC  AF316430   SW S1, 25648(T9)
9D018D94  AC986430   SW T8, 25648(A0)
9D018DC0  AC916430   SW S1, 25648(A0)
9D018DF4  AC986430   SW T8, 25648(A0)
9D018E20  AC916430   SW S1, 25648(A0)
9D018E54  AC986430   SW T8, 25648(A0)
9D018E80  AC916430   SW S1, 25648(A0)
9D018EB4  AC986430   SW T8, 25648(A0)
9D018EE0  AC916430   SW S1, 25648(A0)
9D018F14  AC986430   SW T8, 25648(A0)
9D018F40  AC916430   SW S1, 25648(A0)
9D018F74  AC986430   SW T8, 25648(A0)
9D018FA0  AC916430   SW S1, 25648(A0)
9D018FD4  AC986430   SW T8, 25648(A0)
9D019000  AC916430   SW S1, 25648(A0)
9D019030  AC986430   SW T8, 25648(A0)
9D01905C  AC916430   SW S1, 25648(A0)
9D0192B0  AFD26430   SW S2, 25648(FP)
9D0192DC  AFD46430   SW S4, 25648(FP)
9D019310  AFD26430   SW S2, 25648(FP)
9D01933C  AFD46430   SW S4, 25648(FP)
9D019370  AFD26430   SW S2, 25648(FP)
9D01939C  AFD46430   SW S4, 25648(FP)
9D0193D0  AFD26430   SW S2, 25648(FP)
9D0193FC  AFD46430   SW S4, 25648(FP)
9D019430  AFD26430   SW S2, 25648(FP)
9D01945C  AFD46430   SW S4, 25648(FP)
9D019490  AFD26430   SW S2, 25648(FP)
9D0194BC  AFD46430   SW S4, 25648(FP)
9D0194F0  AFD26430   SW S2, 25648(FP)
9D01951C  AFD46430   SW S4, 25648(FP)
9D01954C  AFD26430   SW S2, 25648(FP)
9D019578  AFD46430   SW S4, 25648(FP)
9D0196B8  AFD06430   SW S0, 25648(FP)
9D0196DC  AFD06430   SW S0, 25648(FP)
9D019700  AFD06430   SW S0, 25648(FP)
9D019724  AFD06430   SW S0, 25648(FP)
9D019748  AFD06430   SW S0, 25648(FP)
9D01976C  AFD06430   SW S0, 25648(FP)
9D019790  AFD06430   SW S0, 25648(FP)
9D0197B4  AFD06430   SW S0, 25648(FP)
9D019838  AFC56430   SW A1, 25648(FP)
9D019864  AFD06430   SW S0, 25648(FP)
9D019898  AFC56430   SW A1, 25648(FP)
9D0198C4  AFD06430   SW S0, 25648(FP)
9D0198F8  AFC56430   SW A1, 25648(FP)
9D019924  AFD06430   SW S0, 25648(FP)
9D019958  AFC56430   SW A1, 25648(FP)
9D019984  AFD06430   SW S0, 25648(FP)
9D0199B8  AFC56430   SW A1, 25648(FP)
9D0199E4  AFD06430   SW S0, 25648(FP)
9D019A18  AFC56430   SW A1, 25648(FP)
9D019A44  AFD06430   SW S0, 25648(FP)
9D019A78  AFC56430   SW A1, 25648(FP)
9D019AA4  AFD06430   SW S0, 25648(FP)
9D019AD4  AFC56430   SW A1, 25648(FP)
9D019B00  AFD06430   SW S0, 25648(FP)
9D019E18  AEF26430   SW S2, 25648(S7)
9D019E44  AEF46430   SW S4, 25648(S7)
9D019E78  AEF26430   SW S2, 25648(S7)
9D019EA4  AEF46430   SW S4, 25648(S7)
9D019ED8  AEF26430   SW S2, 25648(S7)
9D019F04  AEF46430   SW S4, 25648(S7)
9D019F38  AEF26430   SW S2, 25648(S7)
9D019F64  AEF46430   SW S4, 25648(S7)
9D019F98  AEF26430   SW S2, 25648(S7)
9D019FC4  AEF46430   SW S4, 25648(S7)
9D019FF8  AEF26430   SW S2, 25648(S7)
9D01A024  AEF46430   SW S4, 25648(S7)
9D01A058  AEF26430   SW S2, 25648(S7)
9D01A084  AEF46430   SW S4, 25648(S7)
9D01A0B4  AEF26430   SW S2, 25648(S7)
9D01A0E0  AEF46430   SW S4, 25648(S7)
9D01A220  AEF06430   SW S0, 25648(S7)
9D01A244  AEF06430   SW S0, 25648(S7)
9D01A268  AEF06430   SW S0, 25648(S7)
9D01A28C  AEF06430   SW S0, 25648(S7)
9D01A2B0  AEF06430   SW S0, 25648(S7)
9D01A2D4  AEF06430   SW S0, 25648(S7)
9D01A2F8  AEF06430   SW S0, 25648(S7)
9D01A31C  AEF06430   SW S0, 25648(S7)
9D01A3A0  AEE56430   SW A1, 25648(S7)
9D01A3CC  AEF06430   SW S0, 25648(S7)
9D01A400  AEE56430   SW A1, 25648(S7)
9D01A42C  AEF06430   SW S0, 25648(S7)
9D01A460  AEE56430   SW A1, 25648(S7)
9D01A48C  AEF06430   SW S0, 25648(S7)
9D01A4C0  AEE56430   SW A1, 25648(S7)
9D01A4EC  AEF06430   SW S0, 25648(S7)
9D01A520  AEE56430   SW A1, 25648(S7)
9D01A54C  AEF06430   SW S0, 25648(S7)
9D01A580  AEE56430   SW A1, 25648(S7)
9D01A5AC  AEF06430   SW S0, 25648(S7)
9D01A5E0  AEE56430   SW A1, 25648(S7)
9D01A60C  AEF06430   SW S0, 25648(S7)
9D01A63C  AEE56430   SW A1, 25648(S7)
9D01A668  AEF06430   SW S0, 25648(S7)
9D01A7A4  ACE56430   SW A1, 25648(A3)
456:                 	LCD_WR_SET;
9D018944  AE3F6328   SW RA, 25384(S1)
9D01897C  AEBF6328   SW RA, 25384(S5)
9D0189A0  AEBF6328   SW RA, 25384(S5)
9D0189C4  AEBF6328   SW RA, 25384(S5)
9D0189E8  AEBF6328   SW RA, 25384(S5)
9D018A60  AE3F6328   SW RA, 25384(S1)
9D018A88  AEBF6328   SW RA, 25384(S5)
9D018AB0  AEBF6328   SW RA, 25384(S5)
9D018C04  AE986328   SW T8, 25384(S4)
9D018C28  AE986328   SW T8, 25384(S4)
9D018C4C  AE986328   SW T8, 25384(S4)
9D018C70  AE986328   SW T8, 25384(S4)
9D018C94  AE986328   SW T8, 25384(S4)
9D018CB8  AE986328   SW T8, 25384(S4)
9D018CDC  AE986328   SW T8, 25384(S4)
9D018D00  AE986328   SW T8, 25384(S4)
9D018D98  AC686328   SW T0, 25384(V1)
9D018DC4  AC686328   SW T0, 25384(V1)
9D018DF8  AC686328   SW T0, 25384(V1)
9D018E24  AC686328   SW T0, 25384(V1)
9D018E58  AC686328   SW T0, 25384(V1)
9D018E84  AC686328   SW T0, 25384(V1)
9D018EB8  AC686328   SW T0, 25384(V1)
9D018EE4  AC686328   SW T0, 25384(V1)
9D018F18  AC686328   SW T0, 25384(V1)
9D018F44  AC686328   SW T0, 25384(V1)
9D018F78  AC686328   SW T0, 25384(V1)
9D018FA4  AC686328   SW T0, 25384(V1)
9D018FD8  AC686328   SW T0, 25384(V1)
9D019004  AC686328   SW T0, 25384(V1)
9D019034  AC686328   SW T0, 25384(V1)
9D019060  AC686328   SW T0, 25384(V1)
9D0192B4  AEE26328   SW V0, 25384(S7)
9D0192E0  AEE26328   SW V0, 25384(S7)
9D019314  AEE26328   SW V0, 25384(S7)
9D019340  AEE26328   SW V0, 25384(S7)
9D019374  AEE26328   SW V0, 25384(S7)
9D0193A0  AEE26328   SW V0, 25384(S7)
9D0193D4  AEE26328   SW V0, 25384(S7)
9D019400  AEE26328   SW V0, 25384(S7)
9D019434  AEE26328   SW V0, 25384(S7)
9D019460  AEE26328   SW V0, 25384(S7)
9D019494  AEE26328   SW V0, 25384(S7)
9D0194C0  AEE26328   SW V0, 25384(S7)
9D0194F4  AEE26328   SW V0, 25384(S7)
9D019520  AEE26328   SW V0, 25384(S7)
9D019550  AEE26328   SW V0, 25384(S7)
9D01957C  AEE26328   SW V0, 25384(S7)
9D0196BC  AEFF6328   SW RA, 25384(S7)
9D0196E0  AEFF6328   SW RA, 25384(S7)
9D019704  AEFF6328   SW RA, 25384(S7)
9D019728  AEFF6328   SW RA, 25384(S7)
9D01974C  AEFF6328   SW RA, 25384(S7)
9D019770  AEFF6328   SW RA, 25384(S7)
9D019794  AEFF6328   SW RA, 25384(S7)
9D0197B8  AEFF6328   SW RA, 25384(S7)
9D01983C  AEED6328   SW T5, 25384(S7)
9D019868  AEED6328   SW T5, 25384(S7)
9D01989C  AEED6328   SW T5, 25384(S7)
9D0198C8  AEED6328   SW T5, 25384(S7)
9D0198FC  AEED6328   SW T5, 25384(S7)
9D019928  AEED6328   SW T5, 25384(S7)
9D01995C  AEED6328   SW T5, 25384(S7)
9D019988  AEED6328   SW T5, 25384(S7)
9D0199BC  AEED6328   SW T5, 25384(S7)
9D0199E8  AEED6328   SW T5, 25384(S7)
9D019A1C  AEED6328   SW T5, 25384(S7)
9D019A48  AEED6328   SW T5, 25384(S7)
9D019A7C  AEED6328   SW T5, 25384(S7)
9D019AA8  AEED6328   SW T5, 25384(S7)
9D019AD8  AEED6328   SW T5, 25384(S7)
9D019B04  AEED6328   SW T5, 25384(S7)
9D019E1C  AFD86328   SW T8, 25384(FP)
9D019E48  AFD86328   SW T8, 25384(FP)
9D019E7C  AFD86328   SW T8, 25384(FP)
9D019EA8  AFD86328   SW T8, 25384(FP)
9D019EDC  AFD86328   SW T8, 25384(FP)
9D019F08  AFD86328   SW T8, 25384(FP)
9D019F3C  AFD86328   SW T8, 25384(FP)
9D019F68  AFD86328   SW T8, 25384(FP)
9D019F9C  AFD86328   SW T8, 25384(FP)
9D019FC8  AFD86328   SW T8, 25384(FP)
9D019FFC  AFD86328   SW T8, 25384(FP)
9D01A028  AFD86328   SW T8, 25384(FP)
9D01A05C  AFD86328   SW T8, 25384(FP)
9D01A088  AFD86328   SW T8, 25384(FP)
9D01A0B8  AFD86328   SW T8, 25384(FP)
9D01A0E4  AFD86328   SW T8, 25384(FP)
9D01A224  AFDF6328   SW RA, 25384(FP)
9D01A248  AFDF6328   SW RA, 25384(FP)
9D01A26C  AFDF6328   SW RA, 25384(FP)
9D01A290  AFDF6328   SW RA, 25384(FP)
9D01A2B4  AFDF6328   SW RA, 25384(FP)
9D01A2D8  AFDF6328   SW RA, 25384(FP)
9D01A2FC  AFDF6328   SW RA, 25384(FP)
9D01A320  AFDF6328   SW RA, 25384(FP)
9D01A3A4  AFCB6328   SW T3, 25384(FP)
9D01A3D0  AFCB6328   SW T3, 25384(FP)
9D01A404  AFCB6328   SW T3, 25384(FP)
9D01A430  AFCB6328   SW T3, 25384(FP)
9D01A464  AFCB6328   SW T3, 25384(FP)
9D01A490  AFCB6328   SW T3, 25384(FP)
9D01A4C4  AFCB6328   SW T3, 25384(FP)
9D01A4F0  AFCB6328   SW T3, 25384(FP)
9D01A524  AFCB6328   SW T3, 25384(FP)
9D01A550  AFCB6328   SW T3, 25384(FP)
9D01A584  AFCB6328   SW T3, 25384(FP)
9D01A5B0  AFCB6328   SW T3, 25384(FP)
9D01A5E4  AFCB6328   SW T3, 25384(FP)
9D01A610  AFCB6328   SW T3, 25384(FP)
9D01A640  AFCB6328   SW T3, 25384(FP)
9D01A66C  AFCB6328   SW T3, 25384(FP)
9D01A7A8  AC626328   SW V0, 25384(V1)
457:                 	LCD_WR_CLR;
9D018948  AE9F6324   SW RA, 25380(S4)
9D018980  AF3F6324   SW RA, 25380(T9)
9D0189A4  AF3F6324   SW RA, 25380(T9)
9D0189C8  AF3F6324   SW RA, 25380(T9)
9D0189EC  AF3F6324   SW RA, 25380(T9)
9D018A64  AF3F6324   SW RA, 25380(T9)
9D018A8C  AF3F6324   SW RA, 25380(T9)
9D018AB4  AF3F6324   SW RA, 25380(T9)
9D018C08  ADF86324   SW T8, 25380(T7)
9D018C2C  ADF86324   SW T8, 25380(T7)
9D018C50  ADF86324   SW T8, 25380(T7)
9D018C74  ADF86324   SW T8, 25380(T7)
9D018C98  ADF86324   SW T8, 25380(T7)
9D018CBC  ADF86324   SW T8, 25380(T7)
9D018CE0  ADF86324   SW T8, 25380(T7)
9D018D04  ADF86324   SW T8, 25380(T7)
9D018D9C  ACA86324   SW T0, 25380(A1)
9D018DC8  ACA86324   SW T0, 25380(A1)
9D018DFC  ACA86324   SW T0, 25380(A1)
9D018E28  ACA86324   SW T0, 25380(A1)
9D018E5C  ACA86324   SW T0, 25380(A1)
9D018E88  ACA86324   SW T0, 25380(A1)
9D018EBC  ACA86324   SW T0, 25380(A1)
9D018EE8  ACA86324   SW T0, 25380(A1)
9D018F1C  ACA86324   SW T0, 25380(A1)
9D018F48  ACA86324   SW T0, 25380(A1)
9D018F7C  ACA86324   SW T0, 25380(A1)
9D018FA8  ACA86324   SW T0, 25380(A1)
9D018FDC  ACA86324   SW T0, 25380(A1)
9D019008  ACA86324   SW T0, 25380(A1)
9D019038  ACA86324   SW T0, 25380(A1)
9D019064  ACA86324   SW T0, 25380(A1)
9D0192B8  AEC26324   SW V0, 25380(S6)
9D0192E4  AEC26324   SW V0, 25380(S6)
9D019318  AEC26324   SW V0, 25380(S6)
9D019344  AEC26324   SW V0, 25380(S6)
9D019378  AEC26324   SW V0, 25380(S6)
9D0193A4  AEC26324   SW V0, 25380(S6)
9D0193D8  AEC26324   SW V0, 25380(S6)
9D019404  AEC26324   SW V0, 25380(S6)
9D019438  AEC26324   SW V0, 25380(S6)
9D019464  AEC26324   SW V0, 25380(S6)
9D019498  AEC26324   SW V0, 25380(S6)
9D0194C4  AEC26324   SW V0, 25380(S6)
9D0194F8  AEC26324   SW V0, 25380(S6)
9D019524  AEC26324   SW V0, 25380(S6)
9D019554  AEC26324   SW V0, 25380(S6)
9D019580  AEC26324   SW V0, 25380(S6)
9D0196C0  AEDF6324   SW RA, 25380(S6)
9D0196E4  AEDF6324   SW RA, 25380(S6)
9D019708  AEDF6324   SW RA, 25380(S6)
9D01972C  AEDF6324   SW RA, 25380(S6)
9D019750  AEDF6324   SW RA, 25380(S6)
9D019774  AEDF6324   SW RA, 25380(S6)
9D019798  AEDF6324   SW RA, 25380(S6)
9D0197BC  AEDF6324   SW RA, 25380(S6)
9D019840  AECD6324   SW T5, 25380(S6)
9D01986C  AECD6324   SW T5, 25380(S6)
9D0198A0  AECD6324   SW T5, 25380(S6)
9D0198CC  AECD6324   SW T5, 25380(S6)
9D019900  AECD6324   SW T5, 25380(S6)
9D01992C  AECD6324   SW T5, 25380(S6)
9D019960  AECD6324   SW T5, 25380(S6)
9D01998C  AECD6324   SW T5, 25380(S6)
9D0199C0  AECD6324   SW T5, 25380(S6)
9D0199EC  AECD6324   SW T5, 25380(S6)
9D019A20  AECD6324   SW T5, 25380(S6)
9D019A4C  AECD6324   SW T5, 25380(S6)
9D019A80  AECD6324   SW T5, 25380(S6)
9D019AAC  AECD6324   SW T5, 25380(S6)
9D019ADC  AECD6324   SW T5, 25380(S6)
9D019B08  AECD6324   SW T5, 25380(S6)
9D019E20  AED86324   SW T8, 25380(S6)
9D019E4C  AED86324   SW T8, 25380(S6)
9D019E80  AED86324   SW T8, 25380(S6)
9D019EAC  AED86324   SW T8, 25380(S6)
9D019EE0  AED86324   SW T8, 25380(S6)
9D019F0C  AED86324   SW T8, 25380(S6)
9D019F40  AED86324   SW T8, 25380(S6)
9D019F6C  AED86324   SW T8, 25380(S6)
9D019FA0  AED86324   SW T8, 25380(S6)
9D019FCC  AED86324   SW T8, 25380(S6)
9D01A000  AED86324   SW T8, 25380(S6)
9D01A02C  AED86324   SW T8, 25380(S6)
9D01A060  AED86324   SW T8, 25380(S6)
9D01A08C  AED86324   SW T8, 25380(S6)
9D01A0BC  AED86324   SW T8, 25380(S6)
9D01A0E8  AED86324   SW T8, 25380(S6)
9D01A228  AEDF6324   SW RA, 25380(S6)
9D01A24C  AEDF6324   SW RA, 25380(S6)
9D01A270  AEDF6324   SW RA, 25380(S6)
9D01A294  AEDF6324   SW RA, 25380(S6)
9D01A2B8  AEDF6324   SW RA, 25380(S6)
9D01A2DC  AEDF6324   SW RA, 25380(S6)
9D01A300  AEDF6324   SW RA, 25380(S6)
9D01A324  AEDF6324   SW RA, 25380(S6)
9D01A3A8  AECB6324   SW T3, 25380(S6)
9D01A3D4  AECB6324   SW T3, 25380(S6)
9D01A408  AECB6324   SW T3, 25380(S6)
9D01A434  AECB6324   SW T3, 25380(S6)
9D01A468  AECB6324   SW T3, 25380(S6)
9D01A494  AECB6324   SW T3, 25380(S6)
9D01A4C8  AECB6324   SW T3, 25380(S6)
9D01A4F4  AECB6324   SW T3, 25380(S6)
9D01A528  AECB6324   SW T3, 25380(S6)
9D01A554  AECB6324   SW T3, 25380(S6)
9D01A588  AECB6324   SW T3, 25380(S6)
9D01A5B4  AECB6324   SW T3, 25380(S6)
9D01A5E8  AECB6324   SW T3, 25380(S6)
9D01A614  AECB6324   SW T3, 25380(S6)
9D01A644  AECB6324   SW T3, 25380(S6)
9D01A670  AECB6324   SW T3, 25380(S6)
9D01A7AC  AD026324   SW V0, 25380(T0)
458:                 	LCD_PORT = data3;
9D018924  325E00FF   ANDI FP, S2, 255
9D018928  25D7FFFF   ADDIU S7, T6, -1
9D01892C  32F20003   ANDI S2, S7, 3
9D01894C  AE7E6430   SW FP, 25648(S3)
9D018984  AEDE6430   SW FP, 25648(S6)
9D0189A8  AEDE6430   SW FP, 25648(S6)
9D0189CC  AEDE6430   SW FP, 25648(S6)
9D0189F0  AEDE6430   SW FP, 25648(S6)
9D018A68  AE7E6430   SW FP, 25648(S3)
9D018A90  AEDE6430   SW FP, 25648(S6)
9D018AB8  AEDE6430   SW FP, 25648(S6)
9D018C0C  AF326430   SW S2, 25648(T9)
9D018C30  AF326430   SW S2, 25648(T9)
9D018C54  AF326430   SW S2, 25648(T9)
9D018C78  AF326430   SW S2, 25648(T9)
9D018C9C  AF326430   SW S2, 25648(T9)
9D018CC0  AF326430   SW S2, 25648(T9)
9D018CE4  AF326430   SW S2, 25648(T9)
9D018D08  AF326430   SW S2, 25648(T9)
9D018DA0  AC996430   SW T9, 25648(A0)
9D018DCC  AC926430   SW S2, 25648(A0)
9D018E00  AC996430   SW T9, 25648(A0)
9D018E2C  AC926430   SW S2, 25648(A0)
9D018E60  AC996430   SW T9, 25648(A0)
9D018E8C  AC926430   SW S2, 25648(A0)
9D018EC0  AC996430   SW T9, 25648(A0)
9D018EEC  AC926430   SW S2, 25648(A0)
9D018F20  AC996430   SW T9, 25648(A0)
9D018F4C  AC926430   SW S2, 25648(A0)
9D018F80  AC996430   SW T9, 25648(A0)
9D018FAC  AC926430   SW S2, 25648(A0)
9D018FE0  AC996430   SW T9, 25648(A0)
9D01900C  AC926430   SW S2, 25648(A0)
9D01903C  AC996430   SW T9, 25648(A0)
9D019068  AC926430   SW S2, 25648(A0)
9D0192BC  AFD16430   SW S1, 25648(FP)
9D0192E8  AFD56430   SW S5, 25648(FP)
9D01931C  AFD16430   SW S1, 25648(FP)
9D019348  AFD56430   SW S5, 25648(FP)
9D01937C  AFD16430   SW S1, 25648(FP)
9D0193A8  AFD56430   SW S5, 25648(FP)
9D0193DC  AFD16430   SW S1, 25648(FP)
9D019408  AFD56430   SW S5, 25648(FP)
9D01943C  AFD16430   SW S1, 25648(FP)
9D019468  AFD56430   SW S5, 25648(FP)
9D01949C  AFD16430   SW S1, 25648(FP)
9D0194C8  AFD56430   SW S5, 25648(FP)
9D0194FC  AFD16430   SW S1, 25648(FP)
9D019528  AFD56430   SW S5, 25648(FP)
9D019558  AFD16430   SW S1, 25648(FP)
9D019584  AFD56430   SW S5, 25648(FP)
9D0196C4  AFD16430   SW S1, 25648(FP)
9D0196E8  AFD16430   SW S1, 25648(FP)
9D01970C  AFD16430   SW S1, 25648(FP)
9D019730  AFD16430   SW S1, 25648(FP)
9D019754  AFD16430   SW S1, 25648(FP)
9D019778  AFD16430   SW S1, 25648(FP)
9D01979C  AFD16430   SW S1, 25648(FP)
9D0197C0  AFD16430   SW S1, 25648(FP)
9D019844  AFC66430   SW A2, 25648(FP)
9D019870  AFD16430   SW S1, 25648(FP)
9D0198A4  AFC66430   SW A2, 25648(FP)
9D0198D0  AFD16430   SW S1, 25648(FP)
9D019904  AFC66430   SW A2, 25648(FP)
9D019930  AFD16430   SW S1, 25648(FP)
9D019964  AFC66430   SW A2, 25648(FP)
9D019990  AFD16430   SW S1, 25648(FP)
9D0199C4  AFC66430   SW A2, 25648(FP)
9D0199F0  AFD16430   SW S1, 25648(FP)
9D019A24  AFC66430   SW A2, 25648(FP)
9D019A50  AFD16430   SW S1, 25648(FP)
9D019A84  AFC66430   SW A2, 25648(FP)
9D019AB0  AFD16430   SW S1, 25648(FP)
9D019AE0  AFC66430   SW A2, 25648(FP)
9D019B0C  AFD16430   SW S1, 25648(FP)
9D019E24  AEF16430   SW S1, 25648(S7)
9D019E50  AEF56430   SW S5, 25648(S7)
9D019E84  AEF16430   SW S1, 25648(S7)
9D019EB0  AEF56430   SW S5, 25648(S7)
9D019EE4  AEF16430   SW S1, 25648(S7)
9D019F10  AEF56430   SW S5, 25648(S7)
9D019F44  AEF16430   SW S1, 25648(S7)
9D019F70  AEF56430   SW S5, 25648(S7)
9D019FA4  AEF16430   SW S1, 25648(S7)
9D019FD0  AEF56430   SW S5, 25648(S7)
9D01A004  AEF16430   SW S1, 25648(S7)
9D01A030  AEF56430   SW S5, 25648(S7)
9D01A064  AEF16430   SW S1, 25648(S7)
9D01A090  AEF56430   SW S5, 25648(S7)
9D01A0C0  AEF16430   SW S1, 25648(S7)
9D01A0EC  AEF56430   SW S5, 25648(S7)
9D01A22C  AEF16430   SW S1, 25648(S7)
9D01A250  AEF16430   SW S1, 25648(S7)
9D01A274  AEF16430   SW S1, 25648(S7)
9D01A298  AEF16430   SW S1, 25648(S7)
9D01A2BC  AEF16430   SW S1, 25648(S7)
9D01A2E0  AEF16430   SW S1, 25648(S7)
9D01A304  AEF16430   SW S1, 25648(S7)
9D01A328  AEF16430   SW S1, 25648(S7)
9D01A3AC  AEF56430   SW S5, 25648(S7)
9D01A3D8  AEF16430   SW S1, 25648(S7)
9D01A40C  AEF56430   SW S5, 25648(S7)
9D01A438  AEF16430   SW S1, 25648(S7)
9D01A46C  AEF56430   SW S5, 25648(S7)
9D01A498  AEF16430   SW S1, 25648(S7)
9D01A4CC  AEF56430   SW S5, 25648(S7)
9D01A4F8  AEF16430   SW S1, 25648(S7)
9D01A52C  AEF56430   SW S5, 25648(S7)
9D01A558  AEF16430   SW S1, 25648(S7)
9D01A58C  AEF56430   SW S5, 25648(S7)
9D01A5B8  AEF16430   SW S1, 25648(S7)
9D01A5EC  AEF56430   SW S5, 25648(S7)
9D01A618  AEF16430   SW S1, 25648(S7)
9D01A648  AEF56430   SW S5, 25648(S7)
9D01A674  AEF16430   SW S1, 25648(S7)
9D01A7B0  ACE66430   SW A2, 25648(A3)
459:                 	LCD_WR_SET;
9D018950  AE3F6328   SW RA, 25384(S1)
9D018988  AEBF6328   SW RA, 25384(S5)
9D0189AC  AEBF6328   SW RA, 25384(S5)
9D0189D0  AEBF6328   SW RA, 25384(S5)
9D0189F4  AEBF6328   SW RA, 25384(S5)
9D018A6C  AE3F6328   SW RA, 25384(S1)
9D018A94  AEBF6328   SW RA, 25384(S5)
9D018ABC  AEBF6328   SW RA, 25384(S5)
9D018C10  AE986328   SW T8, 25384(S4)
9D018C34  AE986328   SW T8, 25384(S4)
9D018C58  AE986328   SW T8, 25384(S4)
9D018C7C  AE986328   SW T8, 25384(S4)
9D018CA0  AE986328   SW T8, 25384(S4)
9D018CC4  AE986328   SW T8, 25384(S4)
9D018CE8  AE986328   SW T8, 25384(S4)
9D018D0C  AE986328   SW T8, 25384(S4)
9D018D10  2505FFFF   ADDIU A1, T0, -1
9D018D14  30A8FFFF   ANDI T0, A1, -1
9D018DA4  AC686328   SW T0, 25384(V1)
9D018DD0  AC686328   SW T0, 25384(V1)
9D018E04  AC686328   SW T0, 25384(V1)
9D018E30  AC686328   SW T0, 25384(V1)
9D018E64  AC686328   SW T0, 25384(V1)
9D018E90  AC686328   SW T0, 25384(V1)
9D018EC4  AC686328   SW T0, 25384(V1)
9D018EF0  AC686328   SW T0, 25384(V1)
9D018F24  AC686328   SW T0, 25384(V1)
9D018F50  AC686328   SW T0, 25384(V1)
9D018F84  AC686328   SW T0, 25384(V1)
9D018FB0  AC686328   SW T0, 25384(V1)
9D018FE4  AC686328   SW T0, 25384(V1)
9D019010  AC686328   SW T0, 25384(V1)
9D019040  AC686328   SW T0, 25384(V1)
9D019044  0B40641D   J .LBE446
9D019048  24E70001   ADDIU A3, A3, 1
9D01906C  AC686328   SW T0, 25384(V1)
9D019070  24E70001   ADDIU A3, A3, 1
9D0192C0  AEE26328   SW V0, 25384(S7)
9D0192EC  AEE26328   SW V0, 25384(S7)
9D019320  AEE26328   SW V0, 25384(S7)
9D01934C  AEE26328   SW V0, 25384(S7)
9D019380  AEE26328   SW V0, 25384(S7)
9D0193AC  AEE26328   SW V0, 25384(S7)
9D0193E0  AEE26328   SW V0, 25384(S7)
9D01940C  AEE26328   SW V0, 25384(S7)
9D019440  AEE26328   SW V0, 25384(S7)
9D01946C  AEE26328   SW V0, 25384(S7)
9D0194A0  AEE26328   SW V0, 25384(S7)
9D0194CC  AEE26328   SW V0, 25384(S7)
9D019500  AEE26328   SW V0, 25384(S7)
9D01952C  AEE26328   SW V0, 25384(S7)
9D01955C  AEE26328   SW V0, 25384(S7)
9D019560  0B406564   J .LBE730
9D019564  24840001   ADDIU A0, A0, 1
9D019588  AEE26328   SW V0, 25384(S7)
9D01958C  24840001   ADDIU A0, A0, 1
9D0196C8  AEFF6328   SW RA, 25384(S7)
9D0196EC  AEFF6328   SW RA, 25384(S7)
9D019710  AEFF6328   SW RA, 25384(S7)
9D019734  AEFF6328   SW RA, 25384(S7)
9D019758  AEFF6328   SW RA, 25384(S7)
9D01977C  AEFF6328   SW RA, 25384(S7)
9D0197A0  AEFF6328   SW RA, 25384(S7)
9D0197C4  AEFF6328   SW RA, 25384(S7)
9D0197C8  24C5FFFF   ADDIU A1, A2, -1
9D0197CC  30A6FFFF   ANDI A2, A1, -1
9D019848  AEED6328   SW T5, 25384(S7)
9D019874  AEED6328   SW T5, 25384(S7)
9D0198A8  AEED6328   SW T5, 25384(S7)
9D0198D4  AEED6328   SW T5, 25384(S7)
9D019908  AEED6328   SW T5, 25384(S7)
9D019934  AEED6328   SW T5, 25384(S7)
9D019968  AEED6328   SW T5, 25384(S7)
9D019994  AEED6328   SW T5, 25384(S7)
9D0199C8  AEED6328   SW T5, 25384(S7)
9D0199F4  AEED6328   SW T5, 25384(S7)
9D019A28  AEED6328   SW T5, 25384(S7)
9D019A54  AEED6328   SW T5, 25384(S7)
9D019A88  AEED6328   SW T5, 25384(S7)
9D019AB4  AEED6328   SW T5, 25384(S7)
9D019AE4  AEED6328   SW T5, 25384(S7)
9D019AE8  0B4066C6   J .LBE656
9D019AEC  24840001   ADDIU A0, A0, 1
9D019B10  AEED6328   SW T5, 25384(S7)
9D019B14  24840001   ADDIU A0, A0, 1
9D019E28  AFD86328   SW T8, 25384(FP)
9D019E54  AFD86328   SW T8, 25384(FP)
9D019E88  AFD86328   SW T8, 25384(FP)
9D019EB4  AFD86328   SW T8, 25384(FP)
9D019EE8  AFD86328   SW T8, 25384(FP)
9D019F14  AFD86328   SW T8, 25384(FP)
9D019F48  AFD86328   SW T8, 25384(FP)
9D019F74  AFD86328   SW T8, 25384(FP)
9D019FA8  AFD86328   SW T8, 25384(FP)
9D019FD4  AFD86328   SW T8, 25384(FP)
9D01A008  AFD86328   SW T8, 25384(FP)
9D01A034  AFD86328   SW T8, 25384(FP)
9D01A068  AFD86328   SW T8, 25384(FP)
9D01A094  AFD86328   SW T8, 25384(FP)
9D01A0C4  AFD86328   SW T8, 25384(FP)
9D01A0C8  0B40683E   J .LBE1039
9D01A0CC  24840001   ADDIU A0, A0, 1
9D01A0F0  AFD86328   SW T8, 25384(FP)
9D01A0F4  24840001   ADDIU A0, A0, 1
9D01A230  AFDF6328   SW RA, 25384(FP)
9D01A254  AFDF6328   SW RA, 25384(FP)
9D01A278  AFDF6328   SW RA, 25384(FP)
9D01A29C  AFDF6328   SW RA, 25384(FP)
9D01A2C0  AFDF6328   SW RA, 25384(FP)
9D01A2E4  AFDF6328   SW RA, 25384(FP)
9D01A308  AFDF6328   SW RA, 25384(FP)
9D01A32C  AFDF6328   SW RA, 25384(FP)
9D01A330  26A5FFFF   ADDIU A1, S5, -1
9D01A334  30B5FFFF   ANDI S5, A1, -1
9D01A3B0  AFCB6328   SW T3, 25384(FP)
9D01A3DC  AFCB6328   SW T3, 25384(FP)
9D01A410  AFCB6328   SW T3, 25384(FP)
9D01A43C  AFCB6328   SW T3, 25384(FP)
9D01A470  AFCB6328   SW T3, 25384(FP)
9D01A49C  AFCB6328   SW T3, 25384(FP)
9D01A4D0  AFCB6328   SW T3, 25384(FP)
9D01A4FC  AFCB6328   SW T3, 25384(FP)
9D01A530  AFCB6328   SW T3, 25384(FP)
9D01A55C  AFCB6328   SW T3, 25384(FP)
9D01A590  AFCB6328   SW T3, 25384(FP)
9D01A5BC  AFCB6328   SW T3, 25384(FP)
9D01A5F0  AFCB6328   SW T3, 25384(FP)
9D01A61C  AFCB6328   SW T3, 25384(FP)
9D01A64C  AFCB6328   SW T3, 25384(FP)
9D01A650  0B4069A0   J .LBE968
9D01A654  24840001   ADDIU A0, A0, 1
9D01A678  AFCB6328   SW T3, 25384(FP)
9D01A67C  24840001   ADDIU A0, A0, 1
9D01A7B4  AC626328   SW V0, 25384(V1)
9D01A7B8  03E00008   JR RA
9D01A7BC  00000000   NOP
460:                 	}
461:                 
462:                 /*******************************************************************************/
463:                 void TFT_24_7789_Init(void)
464:                 	{
9D01A7C0  27BDFFC8   ADDIU SP, SP, -56
9D01A7C4  AFBF0034   SW RA, 52(SP)
9D01A7C8  AFBE0030   SW FP, 48(SP)
9D01A7CC  AFB7002C   SW S7, 44(SP)
9D01A7D0  AFB60028   SW S6, 40(SP)
9D01A7D4  AFB50024   SW S5, 36(SP)
9D01A7D8  AFB40020   SW S4, 32(SP)
9D01A7DC  AFB3001C   SW S3, 28(SP)
9D01A7E0  AFB20018   SW S2, 24(SP)
9D01A7E4  AFB10014   SW S1, 20(SP)
9D01A7E8  AFB00010   SW S0, 16(SP)
465:                 	LCD_RES = 0;
9D01A7EC  3C02BF88   LUI V0, -16504
9D01A7F0  94436630   LHU V1, 26160(V0)
9D01A7F4  7C0339C4   INS V1, ZERO, 7, 1
9D01A7F8  A4436630   SH V1, 26160(V0)
466:                 	LCD_RD = 1;
9D01A7FC  3C05BF88   LUI A1, -16504
9D01A800  94A46330   LHU A0, 25392(A1)
9D01A804  24140001   ADDIU S4, ZERO, 1
9D01A808  7E842944   INS A0, S4, 5, 1
9D01A80C  A4A46330   SH A0, 25392(A1)
467:                 	LCD_WR = 1;
9D01A810  94A66330   LHU A2, 25392(A1)
9D01A814  7E862104   INS A2, S4, 4, 1
9D01A818  A4A66330   SH A2, 25392(A1)
468:                 	//wait_ms(2);
469:                 	LCD_RES = 1;
9D01A81C  94476630   LHU A3, 26160(V0)
9D01A820  7E8739C4   INS A3, S4, 7, 1
9D01A824  A4476630   SH A3, 26160(V0)
470:                 	wait_ms(2);
9D01A828  0F409FC8   JAL wait_ms
9D01A82C  24040002   ADDIU A0, ZERO, 2
471:                 	TFT_24_7789_Write_Command(0x0029);//exit SLEEP mode
9D01A830  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A834  24040029   ADDIU A0, ZERO, 41
472:                 	wait_ms(2);
9D01A838  0F409FC8   JAL wait_ms
9D01A83C  24040002   ADDIU A0, ZERO, 2
473:                 	TFT_24_7789_Write_Command(0x0036);
9D01A840  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A844  24040036   ADDIU A0, ZERO, 54
474:                 	TFT_24_7789_Write_Data(0x70);//MADCTL: memory data access control
475:                 	TFT_24_7789_Write_Command(0x003A);
9D01A868  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A86C  2404003A   ADDIU A0, ZERO, 58
476:                 	TFT_24_7789_Write_Data(0x0066);//COLMOD: Interface Pixel format
477:                 	TFT_24_7789_Write_Command(0x00B2);
9D01A880  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A884  240400B2   ADDIU A0, ZERO, 178
478:                 	TFT_24_7789_Write_Data(0x0C);
479:                 	TFT_24_7789_Write_Data(0x0C);
480:                 	TFT_24_7789_Write_Data(0x00);
481:                 	TFT_24_7789_Write_Data(0x33);
482:                 	TFT_24_7789_Write_Data(0x33);//PORCTRK: Porch setting
483:                 	TFT_24_7789_Write_Command(0x00B7);
9D01A8CC  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A8D0  240400B7   ADDIU A0, ZERO, 183
484:                 	TFT_24_7789_Write_Data(0x0035);//GCTRL: Gate Control
485:                 	TFT_24_7789_Write_Command(0x00BB);
9D01A8E4  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A8E8  240400BB   ADDIU A0, ZERO, 187
486:                 	TFT_24_7789_Write_Data(0x002B);//VCOMS: VCOM setting
487:                 	TFT_24_7789_Write_Command(0x00C0);
9D01A8FC  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A900  240400C0   ADDIU A0, ZERO, 192
488:                 	TFT_24_7789_Write_Data(0x002C);//LCMCTRL: LCM Control
489:                 	TFT_24_7789_Write_Command(0x00C2);
9D01A914  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A918  240400C2   ADDIU A0, ZERO, 194
490:                 	TFT_24_7789_Write_Data(0x0001);
491:                 	TFT_24_7789_Write_Data(0xFF);//VDVVRHEN: VDV and VRH Command Enable
492:                 	TFT_24_7789_Write_Command(0x00C3);
9D01A938  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A93C  240400C3   ADDIU A0, ZERO, 195
493:                 	TFT_24_7789_Write_Data(0x0011);//VRHS: VRH Set
494:                 	TFT_24_7789_Write_Command(0x00C4);
9D01A950  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A954  240400C4   ADDIU A0, ZERO, 196
495:                 	TFT_24_7789_Write_Data(0x0020);//VDVS: VDV Set[10]
496:                 	TFT_24_7789_Write_Command(0x00C6);
9D01A968  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A96C  240400C6   ADDIU A0, ZERO, 198
497:                 	TFT_24_7789_Write_Data(0x000F);//FRCTRL2: Frame Rate control in normal mode
498:                 	TFT_24_7789_Write_Command(0x00D0);
9D01A980  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A984  240400D0   ADDIU A0, ZERO, 208
499:                 	TFT_24_7789_Write_Data(0x00A4);
500:                 	TFT_24_7789_Write_Data(0xA1);//PWCTRL1: Power Control 1
501:                 	TFT_24_7789_Write_Command(0x00E0);
9D01A9A8  0F4061AB   JAL TFT_24_7789_Write_Command
9D01A9AC  240400E0   ADDIU A0, ZERO, 224
502:                 	TFT_24_7789_Write_Data(0x00D0);
503:                 	TFT_24_7789_Write_Data(0x0000);
504:                 	TFT_24_7789_Write_Data(0x0005);
505:                 	TFT_24_7789_Write_Data(0x000E);
506:                 	TFT_24_7789_Write_Data(0x0015);
507:                 	TFT_24_7789_Write_Data(0x000D);
508:                 	TFT_24_7789_Write_Data(0x0037);
509:                 	TFT_24_7789_Write_Data(0x0043);
510:                 	TFT_24_7789_Write_Data(0x0047);
511:                 	TFT_24_7789_Write_Data(0x0009);
512:                 	TFT_24_7789_Write_Data(0x0015);
513:                 	TFT_24_7789_Write_Data(0x0012);
514:                 	TFT_24_7789_Write_Data(0x0016);
515:                 	TFT_24_7789_Write_Data(0x0019);//PVGAMCTRL: Positive Voltage Gamma control
516:                 	TFT_24_7789_Write_Command(0x00E1);
9D01AA88  0F4061AB   JAL TFT_24_7789_Write_Command
9D01AA8C  240400E1   ADDIU A0, ZERO, 225
517:                 	TFT_24_7789_Write_Data(0x00D0);
518:                 	TFT_24_7789_Write_Data(0x0000);
519:                 	TFT_24_7789_Write_Data(0x0005);
520:                 	TFT_24_7789_Write_Data(0x000D);
521:                 	TFT_24_7789_Write_Data(0x000C);
522:                 	TFT_24_7789_Write_Data(0x0006);
523:                 	TFT_24_7789_Write_Data(0x002D);
524:                 	TFT_24_7789_Write_Data(0x0044);
525:                 	TFT_24_7789_Write_Data(0x0040);
526:                 	TFT_24_7789_Write_Data(0x000E);
527:                 	TFT_24_7789_Write_Data(0x001C);
528:                 	TFT_24_7789_Write_Data(0x0018);
529:                 	TFT_24_7789_Write_Data(0x0016);
530:                 	TFT_24_7789_Write_Data(0x0019);//NVGAMCTRL: Negative Voltage Gamma control
531:                 	TFT_24_7789_Write_Command(0x002A);
9D01AB5C  0F4061AB   JAL TFT_24_7789_Write_Command
9D01AB60  2404002A   ADDIU A0, ZERO, 42
532:                 	TFT_24_7789_Write_Data(0x0000);
533:                 	TFT_24_7789_Write_Data(0x0000);
534:                 	TFT_24_7789_Write_Data(0x0001);
535:                 	TFT_24_7789_Write_Data(0x003F);//X address set
536:                 	TFT_24_7789_Write_Command(0x002B);
9D01AB98  0F4061AB   JAL TFT_24_7789_Write_Command
9D01AB9C  2404002B   ADDIU A0, ZERO, 43
537:                 	TFT_24_7789_Write_Data(0x0000);
538:                 	TFT_24_7789_Write_Data(0x0000);
539:                 	TFT_24_7789_Write_Data(0x0000);
540:                 	TFT_24_7789_Write_Data(0x00EF);//Y address set
541:                 	TFT_24_7789_Write_Command(0x11);
9D01ABD4  0F4061AB   JAL TFT_24_7789_Write_Command
9D01ABD8  24040011   ADDIU A0, ZERO, 17
542:                 	TFT_24_7789_Write_Command(0x38);
9D01ABDC  0F4061AB   JAL TFT_24_7789_Write_Command
9D01ABE0  24040038   ADDIU A0, ZERO, 56
543:                 	TFT_24_7789_Write_Command(0x13);
9D01ABE4  0F4061AB   JAL TFT_24_7789_Write_Command
9D01ABE8  24040013   ADDIU A0, ZERO, 19
544:                 
545:                 	}
9D01ABEC  8FBF0034   LW RA, 52(SP)
9D01ABF0  8FBE0030   LW FP, 48(SP)
9D01ABF4  8FB7002C   LW S7, 44(SP)
9D01ABF8  8FB60028   LW S6, 40(SP)
9D01ABFC  8FB50024   LW S5, 36(SP)
9D01AC00  8FB40020   LW S4, 32(SP)
9D01AC04  8FB3001C   LW S3, 28(SP)
9D01AC08  8FB20018   LW S2, 24(SP)
9D01AC0C  8FB10014   LW S1, 20(SP)
9D01AC10  8FB00010   LW S0, 16(SP)
9D01AC14  03E00008   JR RA
9D01AC18  27BD0038   ADDIU SP, SP, 56
546:                 /*******************************************************************************/
547:                 
---  /Users/nitro/basic-badge/firmware/badge1.X/src/box_game.c  -----------------------------------------
1:                   #include "box_game.h"
2:                   #include "hw.h"
3:                   #include <stdint.h>
4:                   
5:                   /*
6:                   Program flow:
7:                     -Initialize
8:                     -Spawn piece
9:                       -load from reference
10:                      -calculate y_loc
11:                      -draw piece
12:                    -Wait for game input
13:                  */
14:                  
15:                  /**BOX_location[] Array********************
16:                  * Used to track where boxes are in the    *
17:                  * playing area.  One byte per column with *
18:                  * byte0 as the left column.  One bit per  *
19:                  * row with the LSB at the top.  If there  *
20:                  * are more than 8 rows, the array will be *
21:                  * Increased by BOX_board_right+1 bytes to *
22:                  * accomodate 8 more rows as needed.       *
23:                  *******************************************/
24:                  
25:                  /*****************************************
26:                  * BOX_piece[] is a 4x4 representation of *
27:                  * the currently selected playing piece.  *
28:                  * When a piece spawns its shape is       *
29:                  * written to this array in the least     *
30:                  * significant nibble of each byte:       *
31:                  * Byte0= left, Byte3= right		         *
32:                  * The LSB of each nibble is the top of   *
33:                  * the display area.                      *
34:                  ******************************************/
35:                  
36:                  //Total rows-1 (max row-number, zero indexed)
37:                  #define BOX_BOARD_BOTTOM	19
38:                  //Total columns-1 (max column-number, zero indexed)
39:                  #define BOX_BOARD_RIGHT		9
40:                  //Pixel size of each box
41:                  #define BOX_MULTIPLIER          11
42:                  //Pixel offsets from left and top of screen
43:                  #define BOX_XOFFSET	44
44:                  #define BOX_YOFFSET 0
45:                  //Values for frame around grid
46:                  #define BOX_FRAMEX				40
47:                  #define BOX_FRAMEY				0
48:                  #define BOX_FRAME_THICKNESS		4
49:                  #define BOX_FRAMECOLOR			0xFFFFFF
50:                  //Values for frame around score
51:                  #define BOX_GAMETITLE_Y			30
52:                  #define BOX_GAMEOVER_Y			98
53:                  #define BOX_SCOREBOX_X			178
54:                  #define BOX_SCOREBOX_Y			64
55:                  #define BOX_SCOREBOX_WIDTH		110
56:                  #define BOX_SCOREBOX_HEIGHT		22
57:                  
58:                  #define ARRAY_SIZE (((BOX_BOARD_BOTTOM+8)/8) * (BOX_BOARD_RIGHT + 1))
59:                  
60:                  #define DEFAULT_FG_COLOR	0xFF0000
61:                  #define DEFAULT_BG_COLOR	0x000000
62:                  #define DEFAULT_STONE_COLOR	0x00FF00
63:                  
64:                  #define DEFAULT_DROP_DELAY	400
65:                  
66:                  static uint8_t cursor_x, cursor_y;
67:                  
68:                  volatile uint8_t random_piece = 0;	//Used to select a piece "randomly" (but not really)
69:                  
70:                  uint8_t BOX_piece[4];
71:                  
72:                  const uint8_t BOX_reference[7][4][4] = {
73:                  		//T
74:                  		{
75:                  				{
76:                  						0b00000010,
77:                  						0b00000011,
78:                  						0b00000010,
79:                  						0b00000000
80:                  				},
81:                  
82:                  				{
83:                  						0b00000000,
84:                  						0b00000111,
85:                  						0b00000010,
86:                  						0b00000000
87:                  				},
88:                  
89:                  				{
90:                  						0b00000001,
91:                  						0b00000011,
92:                  						0b00000001,
93:                  						0b00000000
94:                  				},
95:                  
96:                  				{
97:                  						0b00000010,
98:                  						0b00000111,
99:                  						0b00000000,
100:                 						0b00000000
101:                 				}
102:                 		},
103:                 
104:                 		// S
105:                 		{
106:                 				{
107:                 						0b00000010,
108:                 						0b00000011,
109:                 						0b00000001,
110:                 						0b00000000
111:                 				},
112:                 
113:                 				{
114:                 						0b00000011,
115:                 						0b00000110,
116:                 						0b00000000,
117:                 						0b00000000
118:                 				},
119:                 
120:                 				{
121:                 						0b00000010,
122:                 						0b00000011,
123:                 						0b00000001,
124:                 						0b00000000
125:                 				},
126:                 
127:                 				{
128:                 						0b00000011,
129:                 						0b00000110,
130:                 						0b00000000,
131:                 						0b00000000
132:                 				}
133:                 		},
134:                 
135:                 		// Z
136:                 		{
137:                 				{
138:                 						0b00000001,
139:                 						0b00000011,
140:                 						0b00000010,
141:                 						0b00000000
142:                 				},
143:                 
144:                 				{
145:                 						0b00000110,
146:                 						0b00000011,
147:                 						0b00000000,
148:                 						0b00000000
149:                 				},
150:                 
151:                 				{
152:                 						0b00000001,
153:                 						0b00000011,
154:                 						0b00000010,
155:                 						0b00000000
156:                 				},
157:                 
158:                 				{
159:                 						0b00000110,
160:                 						0b00000011,
161:                 						0b00000000,
162:                 						0b00000000
163:                 				}
164:                 		},
165:                 
166:                 		// L
167:                 		{
168:                 				{
169:                 						0b00000011,
170:                 						0b00000001,
171:                 						0b00000001,
172:                 						0b00000000
173:                 				},
174:                 
175:                 				{
176:                 						0b00000000,
177:                 						0b00000001,
178:                 						0b00000111,
179:                 						0b00000000
180:                 				},
181:                 
182:                 				{
183:                 						0b00000010,
184:                 						0b00000010,
185:                 						0b00000011,
186:                 						0b00000000
187:                 				},
188:                 
189:                 				{
190:                 						0b00000000,
191:                 						0b00000111,
192:                 						0b00000100,
193:                 						0b00000000
194:                 				}
195:                 		},
196:                 
197:                 		// J
198:                 		{
199:                 				{
200:                 						0b00000001,
201:                 						0b00000001,
202:                 						0b00000011,
203:                 						0b00000000
204:                 				},
205:                 
206:                 				{
207:                 						0b00000000,
208:                 						0b00000100,
209:                 						0b00000111,
210:                 						0b00000000
211:                 				},
212:                 
213:                 				{
214:                 						0b00000011,
215:                 						0b00000010,
216:                 						0b00000010,
217:                 						0b00000000
218:                 				},
219:                 
220:                 				{
221:                 						0b00000000,
222:                 						0b00000111,
223:                 						0b00000001,
224:                 						0b00000000
225:                 				}
226:                 		},
227:                 
228:                 		// Box
229:                 		{
230:                 				{
231:                 						0b00000011,
232:                 						0b00000011,
233:                 						0b00000000,
234:                 						0b00000000,
235:                 				},
236:                 
237:                 				{
238:                 						0b00000011,
239:                 						0b00000011,
240:                 						0b00000000,
241:                 						0b00000000,
242:                 				},
243:                 
244:                 				{
245:                 						0b00000011,
246:                 						0b00000011,
247:                 						0b00000000,
248:                 						0b00000000,
249:                 				},
250:                 
251:                 				{
252:                 						0b00000011,
253:                 						0b00000011,
254:                 						0b00000000,
255:                 						0b00000000,
256:                 				}
257:                 		},
258:                 
259:                 		// Line
260:                 		{
261:                 				{
262:                 						0b00000010,
263:                 						0b00000010,
264:                 						0b00000010,
265:                 						0b00000010
266:                 				},
267:                 
268:                 				{
269:                 						0b00000000,
270:                 						0b00001111,
271:                 						0b00000000,
272:                 						0b00000000
273:                 				},
274:                 
275:                 				{
276:                 						0b00000010,
277:                 						0b00000010,
278:                 						0b00000010,
279:                 						0b00000010
280:                 				},
281:                 
282:                 				{
283:                 						0b00000000,
284:                 						0b00001111,
285:                 						0b00000000,
286:                 						0b00000000
287:                 				}
288:                 		}
289:                 };
290:                 
291:                 //Variables
292:                 uint8_t BOX_location[ARRAY_SIZE];
293:                 uint8_t x_loc, y_loc;     //Bottom left index of each piece
294:                 uint8_t cur_piece = 0;	//Index for BOX_reference
295:                 uint8_t rotate = 0;		//Index for piece rotation
296:                 static uint8_t score = 0;		//Track the number of rows completed
297:                 static uint8_t game_over = 0;
298:                 
299:                 //Messages
300:                 const uint8_t message1[] = { "Badgetris!" };
301:                 const uint8_t message2[] = { "click to start" };
302:                 const uint8_t message3[] = { "Game Over" };
303:                 const uint8_t message4[] = { "Lines:" };
304:                 
305:                 //Functions
306:                 
307:                 /*******************************
308:                  * Display specific functions: *
309:                  *   Change these to suit      *
310:                  *   whatever display will     *
311:                  *   be used.                  *
312:                  *******************************/
313:                 
314:                 void BOX_seed_random(uint8_t seed)
315:                 	{
316:                 	if (seed > 6) random_piece = 0;
9D0247F4  2C820007   SLTIU V0, A0, 7
9D0247F8  14400004   BNE V0, ZERO, 0x9D02480C
9D0247FC  00000000   NOP
9D024800  A380807C   SB ZERO, -32644(GP)
9D024804  03E00008   JR RA
9D024808  00000000   NOP
317:                 	else random_piece = seed;
9D02480C  A384807C   SB A0, -32644(GP)
9D024810  03E00008   JR RA
9D024814  00000000   NOP
318:                 	}
319:                 void BOX_inc_random(void)
320:                 	{
321:                 	if (++random_piece > 6) random_piece = 0;
9D024818  9382807C   LBU V0, -32644(GP)
9D02481C  24430001   ADDIU V1, V0, 1
9D024820  306400FF   ANDI A0, V1, 255
9D024824  A384807C   SB A0, -32644(GP)
9D024828  2C850007   SLTIU A1, A0, 7
9D02482C  50A00001   BEQL A1, ZERO, 0x9D024834
9D024830  A380807C   SB ZERO, -32644(GP)
9D024834  03E00008   JR RA
9D024838  00000000   NOP
322:                 	}
323:                 
324:                 uint8_t BOX_get_score(void)
325:                 	{
326:                 	return score;
327:                 	}
9D02483C  03E00008   JR RA
9D024840  93828079   LBU V0, -32647(GP)
328:                 
329:                 uint16_t BOX_get_delay(void)
330:                 	{
331:                 	if (BOX_get_score)
332:                 		{
333:                 		uint8_t level = BOX_get_score()/4;
9D024844  93838079   LBU V1, -32647(GP)
9D024848  00031082   SRL V0, V1, 2
334:                 		uint16_t dropdelay = DEFAULT_DROP_DELAY;
9D024898  03E00008   JR RA
9D02489C  24020190   ADDIU V0, ZERO, 400
335:                 		while(level)
9D02484C  10400012   BEQ V0, ZERO, 0x9D024898
9D024850  2444FFFF   ADDIU A0, V0, -1
9D024888  1560FFF7   BNE T3, ZERO, 0x9D024868
9D02488C  00460019   MULTU 0, V0, A2
9D024890  03E00008   JR RA
9D024894  00000000   NOP
336:                 			{
337:                 			dropdelay -= (dropdelay/5);
9D024858  24020140   ADDIU V0, ZERO, 320
9D02485C  3C05CCCC   LUI A1, -13108
9D024860  0B409222   J 0x9D024888
9D024864  34A6CCCD   ORI A2, A1, -13107
9D024868  00003810   MFHI A3
9D02486C  00074082   SRL T0, A3, 2
9D024870  00484823   SUBU T1, V0, T0
9D024874  3122FFFF   ANDI V0, T1, -1
338:                 			--level;
9D024854  308B00FF   ANDI T3, A0, 255
9D024878  256AFFFF   ADDIU T2, T3, -1
339:                 			if (dropdelay<200) return 200;	//Keep speed from becoming insane
9D02487C  2C4C00C8   SLTIU T4, V0, 200
9D024880  15800007   BNE T4, ZERO, 0x9D0248A0
9D024884  314B00FF   ANDI T3, T2, 255
340:                 			}
341:                 		return dropdelay;
342:                 		}
343:                 	return DEFAULT_DROP_DELAY;
344:                 	}
9D0248A0  03E00008   JR RA
9D0248A4  240200C8   ADDIU V0, ZERO, 200
345:                 
346:                 void BOX_clearscreen(void)
347:                 	{
9D0248A8  27BDFFE0   ADDIU SP, SP, -32
9D0248AC  AFBF001C   SW RA, 28(SP)
348:                 	//Draw black on the display
349:                 	tft_fill_area(0, 0, 319, 239, 0x000000);
9D0248B0  AFA00010   SW ZERO, 16(SP)
9D0248B4  00002021   ADDU A0, ZERO, ZERO
9D0248B8  00002821   ADDU A1, ZERO, ZERO
9D0248BC  2406013F   ADDIU A2, ZERO, 319
9D0248C0  0F406203   JAL tft_fill_area
9D0248C4  240700EF   ADDIU A3, ZERO, 239
350:                 	}
9D0248C8  8FBF001C   LW RA, 28(SP)
9D0248CC  03E00008   JR RA
9D0248D0  27BD0020   ADDIU SP, SP, 32
351:                 
352:                 void BOX_draw(uint8_t X, uint8_t Y, uint32_t color)
353:                 	{
9D0248D4  27BDFFE0   ADDIU SP, SP, -32
9D0248D8  AFBF001C   SW RA, 28(SP)
354:                 	//Draw box
355:                 	uint8_t row = Y*BOX_MULTIPLIER;
9D0248F0  00054880   SLL T1, A1, 2
9D0248F4  00095080   SLL T2, T1, 2
9D0248F8  01495823   SUBU T3, T2, T1
9D0248FC  01652823   SUBU A1, T3, A1
356:                 	uint16_t col = X*BOX_MULTIPLIER;
9D0248DC  00041080   SLL V0, A0, 2
9D0248E0  00021880   SLL V1, V0, 2
9D0248E4  00623823   SUBU A3, V1, V0
9D0248E8  00E42023   SUBU A0, A3, A0
357:                 	
358:                 	tft_fill_area(col+BOX_XOFFSET, row+BOX_YOFFSET, BOX_MULTIPLIER-1, BOX_MULTIPLIER-1, color);
9D0248EC  3088FFFF   ANDI T0, A0, -1
9D024900  AFA60010   SW A2, 16(SP)
9D024904  2504002C   ADDIU A0, T0, 44
9D024908  30A500FF   ANDI A1, A1, 255
9D02490C  2406000A   ADDIU A2, ZERO, 10
9D024910  0F406203   JAL tft_fill_area
9D024914  2407000A   ADDIU A3, ZERO, 10
359:                 	}
9D024918  8FBF001C   LW RA, 28(SP)
9D02491C  03E00008   JR RA
9D024920  27BD0020   ADDIU SP, SP, 32
360:                 
361:                 void BOX_erase(uint8_t X, uint8_t Y)
362:                 	{
9D024924  27BDFFE0   ADDIU SP, SP, -32
9D024928  AFBF001C   SW RA, 28(SP)
363:                 	//Erase box
364:                 	uint8_t row = Y*BOX_MULTIPLIER;
9D024940  00054080   SLL T0, A1, 2
9D024944  00084880   SLL T1, T0, 2
9D024948  01285023   SUBU T2, T1, T0
9D02494C  01452823   SUBU A1, T2, A1
365:                 	uint16_t col = X*BOX_MULTIPLIER;
9D02492C  00041080   SLL V0, A0, 2
9D024930  00021880   SLL V1, V0, 2
9D024934  00623023   SUBU A2, V1, V0
9D024938  00C42023   SUBU A0, A2, A0
366:                 	
367:                 	tft_fill_area(col+BOX_XOFFSET, row+BOX_YOFFSET, BOX_MULTIPLIER-1, BOX_MULTIPLIER-1, DEFAULT_BG_COLOR);
9D02493C  3087FFFF   ANDI A3, A0, -1
9D024950  AFA00010   SW ZERO, 16(SP)
9D024954  24E4002C   ADDIU A0, A3, 44
9D024958  30A500FF   ANDI A1, A1, 255
9D02495C  2406000A   ADDIU A2, ZERO, 10
9D024960  0F406203   JAL tft_fill_area
9D024964  2407000A   ADDIU A3, ZERO, 10
368:                 	}
9D024968  8FBF001C   LW RA, 28(SP)
9D02496C  03E00008   JR RA
9D024970  27BD0020   ADDIU SP, SP, 32
369:                 
370:                 void BOX_pregame(void)
371:                 	{
9D0253DC  27BDFFD0   ADDIU SP, SP, -48
9D0253E0  AFBF002C   SW RA, 44(SP)
9D0253E4  AFB30028   SW S3, 40(SP)
9D0253E8  AFB20024   SW S2, 36(SP)
9D0253EC  AFB10020   SW S1, 32(SP)
9D0253F0  AFB0001C   SW S0, 28(SP)
9D0254F8  0B409508   J 0x9D025420
9D0254FC  00008821   ADDU S1, ZERO, ZERO
372:                 	//Draw fancy background
373:                 	tft_set_write_area(0,0,319,239);
9D0253F4  00002021   ADDU A0, ZERO, ZERO
9D0253F8  00002821   ADDU A1, ZERO, ZERO
9D0253FC  2406013F   ADDIU A2, ZERO, 319
9D025400  0F4061C0   JAL .LFB13, .LFE14, tft_set_write_area
9D025404  240700EF   ADDIU A3, ZERO, 239
374:                 	TFT_24_7789_Write_Command(0x2C);
9D025408  0F4061AB   JAL TFT_24_7789_Write_Command
9D02540C  2404002C   ADDIU A0, ZERO, 44
375:                 	uint16_t patternx, patterny, hue;
376:                 	for (patterny = 0; patterny<240; patterny++)
9D025410  00008021   ADDU S0, ZERO, ZERO
9D025418  0B40953E   J 0x9D0254F8
9D02541C  241300F0   ADDIU S3, ZERO, 240
9D0254E8  26100001   ADDIU S0, S0, 1
9D0254EC  3210FFFF   ANDI S0, S0, -1
9D0254F0  12130003   BEQ S0, S3, 0x9D025500
9D0254F4  3C0A00FF   LUI T2, 255
377:                 		{
378:                 		for (patternx = 0; patternx<320; patternx++)
9D025414  24120140   ADDIU S2, ZERO, 320
9D025430  26220001   ADDIU V0, S1, 1
9D025434  3051FFFF   ANDI S1, V0, -1
9D025448  26230001   ADDIU V1, S1, 1
9D02544C  3071FFFF   ANDI S1, V1, -1
9D025460  26240001   ADDIU A0, S1, 1
9D025464  3091FFFF   ANDI S1, A0, -1
9D025478  26250001   ADDIU A1, S1, 1
9D02547C  30B1FFFF   ANDI S1, A1, -1
9D025490  26260001   ADDIU A2, S1, 1
9D025494  30D1FFFF   ANDI S1, A2, -1
9D0254A8  26270001   ADDIU A3, S1, 1
9D0254AC  30F1FFFF   ANDI S1, A3, -1
9D0254C0  26280001   ADDIU T0, S1, 1
9D0254C4  3111FFFF   ANDI S1, T0, -1
9D0254D8  26290001   ADDIU T1, S1, 1
9D0254DC  3131FFFF   ANDI S1, T1, -1
9D0254E0  1632FFD0   BNE S1, S2, 0x9D025424
9D0254E4  02303026   XOR A2, S1, S0
379:                 			{
380:                 			hue = patternx ^ patterny;
381:                 			TFT_24_7789_Write_Data3(hue,40,hue);
9D025420  02303026   XOR A2, S1, S0
9D025424  00C02021   ADDU A0, A2, ZERO
9D025428  0F4069E1   JAL .LFB16, .LFE15, TFT_24_7789_Write_Data3
9D02542C  24050028   ADDIU A1, ZERO, 40
9D025438  02303026   XOR A2, S1, S0
9D02543C  00C02021   ADDU A0, A2, ZERO
9D025440  0F4069E1   JAL .LFB16, .LFE15, TFT_24_7789_Write_Data3
9D025444  24050028   ADDIU A1, ZERO, 40
9D025450  02303026   XOR A2, S1, S0
9D025454  00C02021   ADDU A0, A2, ZERO
9D025458  0F4069E1   JAL .LFB16, .LFE15, TFT_24_7789_Write_Data3
9D02545C  24050028   ADDIU A1, ZERO, 40
9D025468  02303026   XOR A2, S1, S0
9D02546C  00C02021   ADDU A0, A2, ZERO
9D025470  0F4069E1   JAL .LFB16, .LFE15, TFT_24_7789_Write_Data3
9D025474  24050028   ADDIU A1, ZERO, 40
9D025480  02303026   XOR A2, S1, S0
9D025484  00C02021   ADDU A0, A2, ZERO
9D025488  0F4069E1   JAL .LFB16, .LFE15, TFT_24_7789_Write_Data3
9D02548C  24050028   ADDIU A1, ZERO, 40
9D025498  02303026   XOR A2, S1, S0
9D02549C  00C02021   ADDU A0, A2, ZERO
9D0254A0  0F4069E1   JAL .LFB16, .LFE15, TFT_24_7789_Write_Data3
9D0254A4  24050028   ADDIU A1, ZERO, 40
9D0254B0  02303026   XOR A2, S1, S0
9D0254B4  00C02021   ADDU A0, A2, ZERO
9D0254B8  0F4069E1   JAL .LFB16, .LFE15, TFT_24_7789_Write_Data3
9D0254BC  24050028   ADDIU A1, ZERO, 40
9D0254C8  02303026   XOR A2, S1, S0
9D0254CC  00C02021   ADDU A0, A2, ZERO
9D0254D0  0F4069E1   JAL .LFB16, .LFE15, TFT_24_7789_Write_Data3
9D0254D4  24050028   ADDIU A1, ZERO, 40
382:                 			}
383:                 		}
384:                 	//Draw frame around grid
385:                 	tft_fill_area(BOX_FRAMEX, BOX_FRAMEY, BOX_FRAME_THICKNESS-1, BOX_MULTIPLIER*(BOX_BOARD_BOTTOM+1), BOX_FRAMECOLOR);
9D025500  3552FFFF   ORI S2, T2, -1
9D025504  AFB20010   SW S2, 16(SP)
9D025508  24040028   ADDIU A0, ZERO, 40
9D02550C  00002821   ADDU A1, ZERO, ZERO
9D025510  24060003   ADDIU A2, ZERO, 3
9D025514  0F406203   JAL tft_fill_area
9D025518  240700DC   ADDIU A3, ZERO, 220
386:                 	tft_fill_area(BOX_FRAMEX, BOX_FRAMEY+BOX_MULTIPLIER*(BOX_BOARD_BOTTOM+1), (BOX_MULTIPLIER*(BOX_BOARD_RIGHT + 1))+(BOX_FRAME_THICKNESS*2)-1, BOX_FRAME_THICKNESS-1, 0xFFFFFF);
9D02551C  AFB20010   SW S2, 16(SP)
9D025520  24040028   ADDIU A0, ZERO, 40
9D025524  240500DC   ADDIU A1, ZERO, 220
9D025528  24060075   ADDIU A2, ZERO, 117
9D02552C  0F406203   JAL tft_fill_area
9D025530  24070003   ADDIU A3, ZERO, 3
387:                 	tft_fill_area(BOX_FRAMEX+(BOX_MULTIPLIER*(BOX_BOARD_RIGHT+1))+BOX_FRAME_THICKNESS, BOX_FRAMEY, BOX_FRAME_THICKNESS-1, BOX_MULTIPLIER*(BOX_BOARD_BOTTOM+1), 0xFFFFFF);
9D025534  AFB20010   SW S2, 16(SP)
9D025538  2404009A   ADDIU A0, ZERO, 154
9D02553C  00002821   ADDU A1, ZERO, ZERO
9D025540  24060003   ADDIU A2, ZERO, 3
9D025544  0F406203   JAL tft_fill_area
9D025548  240700DC   ADDIU A3, ZERO, 220
388:                    
389:                 	//Show game title
390:                 	tft_fill_area(BOX_SCOREBOX_X, BOX_GAMETITLE_Y, BOX_SCOREBOX_WIDTH, BOX_SCOREBOX_HEIGHT, BOX_FRAMECOLOR);
9D02554C  AFB20010   SW S2, 16(SP)
9D025550  240400B2   ADDIU A0, ZERO, 178
9D025554  2405001E   ADDIU A1, ZERO, 30
9D025558  2406006E   ADDIU A2, ZERO, 110
9D02555C  0F406203   JAL tft_fill_area
9D025560  24070016   ADDIU A3, ZERO, 22
391:                 	tft_fill_area(BOX_SCOREBOX_X+BOX_FRAME_THICKNESS, BOX_GAMETITLE_Y+BOX_FRAME_THICKNESS, BOX_SCOREBOX_WIDTH-(2*BOX_FRAME_THICKNESS), BOX_SCOREBOX_HEIGHT-(2*BOX_FRAME_THICKNESS), DEFAULT_BG_COLOR);
9D025564  AFA00010   SW ZERO, 16(SP)
9D025568  240400B6   ADDIU A0, ZERO, 182
9D02556C  24050022   ADDIU A1, ZERO, 34
9D025570  24060066   ADDIU A2, ZERO, 102
9D025574  0F406203   JAL tft_fill_area
9D025578  2407000E   ADDIU A3, ZERO, 14
392:                 	BOX_print_string(message1,BOX_SCOREBOX_X+12,BOX_GAMETITLE_Y+BOX_FRAME_THICKNESS+2,0xFFFFFF,DEFAULT_BG_COLOR);
9D02557C  AFA00010   SW ZERO, 16(SP)
9D025580  3C0B9D04   LUI T3, -25340
9D025584  25640588   ADDIU A0, T3, 1416
9D025588  240500BE   ADDIU A1, ZERO, 190
9D02558C  24060024   ADDIU A2, ZERO, 36
9D025590  0F40925F   JAL BOX_print_string
9D025594  02403821   ADDU A3, S2, ZERO
393:                 	
394:                 	//Get score area ready
395:                 	tft_fill_area(BOX_SCOREBOX_X, BOX_SCOREBOX_Y, BOX_SCOREBOX_WIDTH, BOX_SCOREBOX_HEIGHT, BOX_FRAMECOLOR);
9D025598  AFB20010   SW S2, 16(SP)
9D02559C  240400B2   ADDIU A0, ZERO, 178
9D0255A0  24050040   ADDIU A1, ZERO, 64
9D0255A4  2406006E   ADDIU A2, ZERO, 110
9D0255A8  0F406203   JAL tft_fill_area
9D0255AC  24070016   ADDIU A3, ZERO, 22
396:                 	tft_fill_area(BOX_SCOREBOX_X+BOX_FRAME_THICKNESS, BOX_SCOREBOX_Y+BOX_FRAME_THICKNESS, BOX_SCOREBOX_WIDTH-(2*BOX_FRAME_THICKNESS), BOX_SCOREBOX_HEIGHT-(2*BOX_FRAME_THICKNESS), DEFAULT_BG_COLOR);
9D0255B0  AFA00010   SW ZERO, 16(SP)
9D0255B4  240400B6   ADDIU A0, ZERO, 182
9D0255B8  24050044   ADDIU A1, ZERO, 68
9D0255BC  24060066   ADDIU A2, ZERO, 102
9D0255C0  0F406203   JAL tft_fill_area
9D0255C4  2407000E   ADDIU A3, ZERO, 14
397:                 
398:                 	//Show game area
399:                 	BOX_rewrite_display(DEFAULT_FG_COLOR);
9D0255C8  0F40946B   JAL BOX_rewrite_display
9D0255CC  3C0400FF   LUI A0, 255
400:                 	
401:                 	BOX_update_score();
9D0255D0  0F4092A2   JAL BOX_update_score
9D0255D4  00000000   NOP
402:                 	}
9D0255D8  8FBF002C   LW RA, 44(SP)
9D0255DC  8FB30028   LW S3, 40(SP)
9D0255E0  8FB20024   LW S2, 36(SP)
9D0255E4  8FB10020   LW S1, 32(SP)
9D0255E8  8FB0001C   LW S0, 28(SP)
9D0255EC  03E00008   JR RA
9D0255F0  27BD0030   ADDIU SP, SP, 48
403:                 
404:                 void BOX_start_game(void)
405:                 	{
9D025908  27BDFFE8   ADDIU SP, SP, -24
9D02590C  AFBF0014   SW RA, 20(SP)
406:                 	score = 0; //Reset score
9D025910  A3808079   SB ZERO, -32647(GP)
407:                 	game_over = 0;
9D025914  A3808078   SB ZERO, -32648(GP)
9D025918  3C03A000   LUI V1, -24576
9D02591C  246514F0   ADDIU A1, V1, 5360
9D025920  24A4001E   ADDIU A0, A1, 30
408:                 	
409:                 	//Set up blank array
410:                 	uint16_t i;
411:                 	for (i=0; i<ARRAY_SIZE; i++) { BOX_location[i] = 0x00; }
9D025924  A0A00000   SB ZERO, 0(A1)
9D025928  A0A00001   SB ZERO, 1(A1)
9D02592C  A0A00002   SB ZERO, 2(A1)
9D025930  A0A00003   SB ZERO, 3(A1)
9D025934  A0A00004   SB ZERO, 4(A1)
9D025938  A0A00005   SB ZERO, 5(A1)
9D02593C  A0A00006   SB ZERO, 6(A1)
9D025940  A0A00007   SB ZERO, 7(A1)
9D025944  A0A00008   SB ZERO, 8(A1)
9D025948  A0A00009   SB ZERO, 9(A1)
9D02594C  24A5000A   ADDIU A1, A1, 10
9D025950  54A4FFF5   BNEL A1, A0, 0x9D025928
9D025954  A0A00000   SB ZERO, 0(A1)
412:                 	BOX_pregame();
9D025958  0F4094F7   JAL BOX_pregame
9D02595C  00000000   NOP
413:                 	BOX_spawn();
9D025960  0F409628   JAL BOX_spawn
9D025964  00000000   NOP
414:                 	}
9D025968  8FBF0014   LW RA, 20(SP)
9D02596C  03E00008   JR RA
9D025970  27BD0018   ADDIU SP, SP, 24
415:                 
416:                 void BOX_show_gameover(void)
417:                 	{
9D024A10  27BDFFD8   ADDIU SP, SP, -40
9D024A14  AFBF0024   SW RA, 36(SP)
9D024A18  AFB10020   SW S1, 32(SP)
9D024A1C  AFB0001C   SW S0, 28(SP)
418:                 	//Show game title
419:                 	tft_fill_area(BOX_SCOREBOX_X, BOX_GAMEOVER_Y, BOX_SCOREBOX_WIDTH, BOX_SCOREBOX_HEIGHT, BOX_FRAMECOLOR);
9D024A20  3C1000FF   LUI S0, 255
9D024A24  3611FFFF   ORI S1, S0, -1
9D024A28  AFB10010   SW S1, 16(SP)
9D024A2C  240400B2   ADDIU A0, ZERO, 178
9D024A30  24050062   ADDIU A1, ZERO, 98
9D024A34  2406006E   ADDIU A2, ZERO, 110
9D024A38  0F406203   JAL tft_fill_area
9D024A3C  24070016   ADDIU A3, ZERO, 22
420:                 	tft_fill_area(BOX_SCOREBOX_X+BOX_FRAME_THICKNESS, BOX_GAMEOVER_Y+BOX_FRAME_THICKNESS, BOX_SCOREBOX_WIDTH-(2*BOX_FRAME_THICKNESS), BOX_SCOREBOX_HEIGHT-(2*BOX_FRAME_THICKNESS), 0xFF0000);
9D024A40  AFB00010   SW S0, 16(SP)
9D024A44  240400B6   ADDIU A0, ZERO, 182
9D024A48  24050066   ADDIU A1, ZERO, 102
9D024A4C  24060066   ADDIU A2, ZERO, 102
9D024A50  0F406203   JAL tft_fill_area
9D024A54  2407000E   ADDIU A3, ZERO, 14
421:                 	BOX_print_string(message3,BOX_SCOREBOX_X+12,BOX_GAMEOVER_Y+BOX_FRAME_THICKNESS+2,0xFFFF00,0xFF0000);
9D024A58  AFB00010   SW S0, 16(SP)
9D024A5C  3C049D04   LUI A0, -25340
9D024A60  2484056C   ADDIU A0, A0, 1388
9D024A64  240500BE   ADDIU A1, ZERO, 190
9D024A68  24060068   ADDIU A2, ZERO, 104
9D024A6C  0F40925F   JAL BOX_print_string
9D024A70  2627FF01   ADDIU A3, S1, -255
422:                 	}
9D024A74  8FBF0024   LW RA, 36(SP)
9D024A78  8FB10020   LW S1, 32(SP)
9D024A7C  8FB0001C   LW S0, 28(SP)
9D024A80  03E00008   JR RA
9D024A84  27BD0028   ADDIU SP, SP, 40
423:                 
424:                 uint8_t BOX_end_game(void)
425:                 	{
426:                 	//FIXME: What happens when game ends?
427:                 	return game_over;
428:                 	}
9D024974  03E00008   JR RA
9D024978  93828078   LBU V0, -32648(GP)
429:                 
430:                 void BOX_update_score(void)
431:                 	{
9D024A88  27BDFFD8   ADDIU SP, SP, -40
9D024A8C  AFBF0024   SW RA, 36(SP)
432:                 	//Show score on screen
433:                 	//FIXME: Make locations and colors #define values
434:                 	BOX_print_string(message4,BOX_SCOREBOX_X+12,BOX_SCOREBOX_Y+BOX_FRAME_THICKNESS+2,0xFFFFFF,DEFAULT_BG_COLOR);
9D024A90  AFA00010   SW ZERO, 16(SP)
9D024A94  3C049D04   LUI A0, -25340
9D024A98  24840564   ADDIU A0, A0, 1380
9D024A9C  240500BE   ADDIU A1, ZERO, 190
9D024AA0  24060046   ADDIU A2, ZERO, 70
9D024AA4  3C0700FF   LUI A3, 255
9D024AA8  0F40925F   JAL BOX_print_string
9D024AAC  34E7FFFF   ORI A3, A3, -1
435:                 
436:                 	//This hack turns score numbers into a string
437:                 	int8_t mystring[4] = {'0',0,0,0};
9D024AB0  24020030   ADDIU V0, ZERO, 48
9D024AB4  A3A20018   SB V0, 24(SP)
9D024AB8  A3A00019   SB ZERO, 25(SP)
9D024ABC  A3A0001A   SB ZERO, 26(SP)
9D024AC0  A3A0001B   SB ZERO, 27(SP)
438:                 	uint8_t i = 0;
439:                 	uint8_t hundred, ten, one;
440:                 	hundred = score/100;
9D024AC4  93858079   LBU A1, -32647(GP)
9D024AC8  3C0351EB   LUI V1, 20971
9D024ACC  3466851F   ORI A2, V1, -31457
9D024AD0  00A60019   MULTU 0, A1, A2
9D024AD4  00004010   MFHI T0
9D024AD8  00084942   SRL T1, T0, 5
9D024ADC  312A00FF   ANDI T2, T1, 255
441:                 	ten = (score%100)/10;
9D024AE0  00095880   SLL T3, T1, 2
9D024AE4  00096100   SLL T4, T1, 4
9D024AE8  016C6821   ADDU T5, T3, T4
9D024AEC  000D7080   SLL T6, T5, 2
9D024AF0  01AE7821   ADDU T7, T5, T6
9D024AF4  00AFC023   SUBU T8, A1, T7
9D024AF8  331900FF   ANDI T9, T8, 255
9D024AFC  3C04CCCC   LUI A0, -13108
9D024B00  3487CCCD   ORI A3, A0, -13107
9D024B04  03270019   MULTU 0, T9, A3
9D024B08  00001010   MFHI V0
9D024B0C  000218C2   SRL V1, V0, 3
9D024B10  306500FF   ANDI A1, V1, 255
442:                 	one = (score%100)%10;
9D024B14  00033040   SLL A2, V1, 1
9D024B18  000340C0   SLL T0, V1, 3
9D024B1C  00C84821   ADDU T1, A2, T0
9D024B20  03295823   SUBU T3, T9, T1
9D024B24  316C00FF   ANDI T4, T3, 255
443:                 	if (hundred) mystring[i++] = hundred+'0';
9D024B28  11400004   BEQ T2, ZERO, 0x9D024B3C
9D024B2C  0000C021   ADDU T8, ZERO, ZERO
9D024B30  255F0030   ADDIU RA, T2, 48
9D024B34  A3BF0018   SB RA, 24(SP)
9D024B38  24180001   ADDIU T8, ZERO, 1
444:                 	if (hundred || ten) mystring[i++] = ten+'0';
9D024B3C  00AA5025   OR T2, A1, T2
9D024B40  11400006   BEQ T2, ZERO, 0x9D024B5C
9D024B44  014CC825   OR T9, T2, T4
9D024B48  270D0001   ADDIU T5, T8, 1
9D024B4C  03B87021   ADDU T6, SP, T8
9D024B50  24AF0030   ADDIU T7, A1, 48
9D024B54  A1CF0018   SB T7, 24(T6)
9D024B58  31B800FF   ANDI T8, T5, 255
445:                 	if (hundred || ten || one) mystring[i++] = one+'0';
9D024B5C  13200003   BEQ T9, ZERO, 0x9D024B6C
9D024B60  03B82021   ADDU A0, SP, T8
9D024B64  25870030   ADDIU A3, T4, 48
9D024B68  A0870018   SB A3, 24(A0)
446:                 	
447:                 	BOX_print_string(mystring, BOX_SCOREBOX_X+76,BOX_SCOREBOX_Y+BOX_FRAME_THICKNESS+2,0xFFFFFF,DEFAULT_BG_COLOR);
9D024B6C  AFA00010   SW ZERO, 16(SP)
9D024B70  27A40018   ADDIU A0, SP, 24
9D024B74  240500FE   ADDIU A1, ZERO, 254
9D024B78  24060046   ADDIU A2, ZERO, 70
9D024B7C  3C0200FF   LUI V0, 255
9D024B80  0F40925F   JAL BOX_print_string
9D024B84  3447FFFF   ORI A3, V0, -1
448:                 	}
9D024B88  8FBF0024   LW RA, 36(SP)
9D024B8C  03E00008   JR RA
9D024B90  27BD0028   ADDIU SP, SP, 40
449:                 
450:                 void BOX_print_string(const int8_t * buf, uint16_t x_pixel, uint8_t y_pixel, uint32_t fgcolor, uint32_t bgcolor)
451:                 	{
9D02497C  27BDFFC8   ADDIU SP, SP, -56
9D024980  AFBF0034   SW RA, 52(SP)
9D024984  AFB50030   SW S5, 48(SP)
9D024988  AFB4002C   SW S4, 44(SP)
9D02498C  AFB30028   SW S3, 40(SP)
9D024990  AFB20024   SW S2, 36(SP)
9D024994  AFB10020   SW S1, 32(SP)
9D024998  AFB0001C   SW S0, 28(SP)
9D02499C  00808821   ADDU S1, A0, ZERO
452:                 	uint8_t i=0;
9D0249B8  00008021   ADDU S0, ZERO, ZERO
453:                 	while (buf[i] != 0)
9D0249A0  80840000   LB A0, 0(A0)
9D0249A4  10800011   BEQ A0, ZERO, 0x9D0249EC
9D0249A8  8FB50048   LW S5, 72(SP)
9D0249AC  00A09021   ADDU S2, A1, ZERO
9D0249B0  00C09821   ADDU S3, A2, ZERO
9D0249B4  00E0A021   ADDU S4, A3, ZERO
9D0249DC  02301021   ADDU V0, S1, S0
9D0249E0  80440000   LB A0, 0(V0)
9D0249E4  1480FFF6   BNE A0, ZERO, 0x9D0249C0
9D0249E8  001028C0   SLL A1, S0, 3
454:                 		{
455:                 		tft_print_char(buf[i],x_pixel+(i*8),y_pixel,fgcolor,bgcolor);
9D0249BC  001028C0   SLL A1, S0, 3
9D0249C0  AFB50010   SW S5, 16(SP)
9D0249C4  02452821   ADDU A1, S2, A1
9D0249C8  02603021   ADDU A2, S3, ZERO
9D0249CC  0F4062B5   JAL .LFB11, .LFE12, tft_print_char
9D0249D0  02803821   ADDU A3, S4, ZERO
456:                 		++i;
9D0249D4  26100001   ADDIU S0, S0, 1
9D0249D8  321000FF   ANDI S0, S0, 255
457:                 		}
458:                 	}
9D0249EC  8FBF0034   LW RA, 52(SP)
9D0249F0  8FB50030   LW S5, 48(SP)
9D0249F4  8FB4002C   LW S4, 44(SP)
9D0249F8  8FB30028   LW S3, 40(SP)
9D0249FC  8FB20024   LW S2, 36(SP)
9D024A00  8FB10020   LW S1, 32(SP)
9D024A04  8FB0001C   LW S0, 28(SP)
9D024A08  03E00008   JR RA
9D024A0C  27BD0038   ADDIU SP, SP, 56
459:                 
460:                 /**********************************
461:                  * End Display specific functions *
462:                  **********************************/
463:                 
464:                 /**********************************************
465:                  * Functions that handle bits in BOX_location[]
466:                  * BOX_loc_return_bit
467:                  * BOX_loc_set_bit
468:                  * BOX_loc_clear_bit
469:                  ************************************************/
470:                 
471:                 uint8_t BOX_loc_return_bit(uint8_t X, uint8_t Y)
472:                 	{
473:                 	//Calculate array index and shift amount
474:                 	uint8_t array_index_offset = ((Y)/8)*(BOX_BOARD_RIGHT+1);
9D024B94  000510C2   SRL V0, A1, 3
9D024B98  00023040   SLL A2, V0, 1
9D024B9C  00061880   SLL V1, A2, 2
9D024BA0  00C33821   ADDU A3, A2, V1
475:                 	uint8_t shift_index = (Y)%8;		//How much to shift for our bit mask
476:                 
477:                 	if (BOX_location[X+array_index_offset] & 1<<shift_index) return 1;
9D024BA4  30E800FF   ANDI T0, A3, 255
9D024BA8  00882021   ADDU A0, A0, T0
9D024BAC  3C09A000   LUI T1, -24576
9D024BB0  252A14F0   ADDIU T2, T1, 5360
9D024BB4  008A5821   ADDU T3, A0, T2
9D024BB8  916C0000   LBU T4, 0(T3)
9D024BBC  30A50007   ANDI A1, A1, 7
9D024BC0  00AC6807   SRAV T5, T4, A1
478:                 	else return 0;
479:                 	}
9D024BC4  03E00008   JR RA
9D024BC8  31A20001   ANDI V0, T5, 1
480:                 
481:                 void BOX_loc_set_bit(uint8_t X, uint8_t Y)
482:                 	{
483:                 	//Calculate array index and shift amount
484:                 	uint8_t array_index_offset = ((Y)/8)*(BOX_BOARD_RIGHT+1);
9D024BCC  000510C2   SRL V0, A1, 3
9D024BD0  00023040   SLL A2, V0, 1
9D024BD4  00061880   SLL V1, A2, 2
9D024BD8  00C33821   ADDU A3, A2, V1
485:                 	uint8_t shift_index = (Y)%8;		//How much to shift for our bit mask
486:                 
487:                 	BOX_location[X+array_index_offset] |= 1<<shift_index;
9D024BDC  30E800FF   ANDI T0, A3, 255
9D024BE0  00882021   ADDU A0, A0, T0
9D024BE4  3C09A000   LUI T1, -24576
9D024BE8  252A14F0   ADDIU T2, T1, 5360
9D024BEC  008A5821   ADDU T3, A0, T2
9D024BF0  30A50007   ANDI A1, A1, 7
9D024BF4  240C0001   ADDIU T4, ZERO, 1
9D024BF8  00AC6804   SLLV T5, T4, A1
9D024BFC  916E0000   LBU T6, 0(T3)
9D024C00  01AE7825   OR T7, T5, T6
9D024C04  03E00008   JR RA
9D024C08  A16F0000   SB T7, 0(T3)
488:                 	}
489:                 
490:                 void BOX_loc_clear_bit(uint8_t X, uint8_t Y)
491:                 	{
492:                 	//Calculate array index and shift amount
493:                 	uint8_t array_index_offset = ((Y)/8)*(BOX_BOARD_RIGHT+1);
9D024C0C  000510C2   SRL V0, A1, 3
9D024C10  00023040   SLL A2, V0, 1
9D024C14  00061880   SLL V1, A2, 2
9D024C18  00C33821   ADDU A3, A2, V1
494:                 	uint8_t shift_index = (Y)%8;		//How much to shift for our bit mask
495:                 
496:                 	BOX_location[X+array_index_offset] &= ~(1<<shift_index);
9D024C1C  30E800FF   ANDI T0, A3, 255
9D024C20  00882021   ADDU A0, A0, T0
9D024C24  3C09A000   LUI T1, -24576
9D024C28  252A14F0   ADDIU T2, T1, 5360
9D024C2C  008A5821   ADDU T3, A0, T2
9D024C30  30A50007   ANDI A1, A1, 7
9D024C34  240C0001   ADDIU T4, ZERO, 1
9D024C38  00AC6804   SLLV T5, T4, A1
9D024C3C  000D7027   NOR T6, ZERO, T5
9D024C40  916F0000   LBU T7, 0(T3)
9D024C44  01CFC024   AND T8, T6, T7
9D024C48  03E00008   JR RA
9D024C4C  A1780000   SB T8, 0(T3)
497:                 	}
498:                 
499:                 /********************************
500:                  * Functions that handle bits in BOX_piece[]
501:                  * BOX_piece_return_bit()
502:                  * BOX_piece_set_bit()
503:                  * BOX_piece_clear_bit()
504:                  */
505:                 
506:                 void BOX_store_loc(void)
507:                 	{
9D024C50  27BDFFD8   ADDIU SP, SP, -40
9D024C54  AFBF0024   SW RA, 36(SP)
9D024C58  AFB30020   SW S3, 32(SP)
9D024C5C  AFB2001C   SW S2, 28(SP)
9D024C60  AFB10018   SW S1, 24(SP)
9D024C64  AFB00014   SW S0, 20(SP)
9D024C68  279281C8   ADDIU S2, GP, -32312
9D024C6C  26530004   ADDIU S3, S2, 4
9D024C70  02408021   ADDU S0, S2, ZERO
9D024C74  02128823   SUBU S1, S0, S2
9D024C78  323100FF   ANDI S1, S1, 255
508:                 	//Step through 4 columns
509:                 	uint8_t temp_col, temp_row;
510:                 	for (temp_col=0; temp_col<4; temp_col++)
9D024D88  1613FFBB   BNE S0, S3, 0x9D024C78
9D024D8C  02128823   SUBU S1, S0, S2
511:                 		{
512:                 		//Only if x_loc is not out of bounds
513:                 		 if ((unsigned char)(x_loc+temp_col) <= BOX_BOARD_RIGHT)
9D024C7C  938281C4   LBU V0, -32316(GP)
9D024C80  02221821   ADDU V1, S1, V0
9D024C84  306400FF   ANDI A0, V1, 255
9D024C88  2C85000A   SLTIU A1, A0, 10
9D024C8C  50A0003E   BEQL A1, ZERO, 0x9D024D88
9D024C90  26100001   ADDIU S0, S0, 1
514:                 			{
515:                 			//Step through 4 rows
516:                 			for (temp_row=0; temp_row<4; temp_row++)
517:                 				{
518:                 				//Only if y_loc is not out of bounds
519:                 				if (y_loc-temp_row <= BOX_BOARD_BOTTOM)
9D024C94  938581CC   LBU A1, -32308(GP)
9D024C98  28A60014   SLTI A2, A1, 20
9D024C9C  10C0000A   BEQ A2, ZERO, 0x9D024CC8
9D024CA0  938B81CC   LBU T3, -32308(GP)
9D024CC4  938B81CC   LBU T3, -32308(GP)
9D024CC8  256CFFFF   ADDIU T4, T3, -1
9D024CCC  298D0014   SLTI T5, T4, 20
9D024CD0  11A0000D   BEQ T5, ZERO, 0x9D024D08
9D024CD4  938581CC   LBU A1, -32308(GP)
9D024D04  938581CC   LBU A1, -32308(GP)
9D024D08  24A3FFFE   ADDIU V1, A1, -2
9D024D0C  28640014   SLTI A0, V1, 20
9D024D10  1080000D   BEQ A0, ZERO, 0x9D024D48
9D024D14  938C81CC   LBU T4, -32308(GP)
9D024D44  938C81CC   LBU T4, -32308(GP)
9D024D48  258DFFFD   ADDIU T5, T4, -3
9D024D4C  29AE0014   SLTI T6, T5, 20
9D024D50  51C0000D   BEQL T6, ZERO, 0x9D024D88
9D024D54  26100001   ADDIU S0, S0, 1
520:                 					{
521:                 					if (BOX_piece[temp_col] & 1<<(temp_row))	//Checks nibbles in Box_piece array
9D024CA4  92070000   LBU A3, 0(S0)
9D024CA8  30E80001   ANDI T0, A3, 1
9D024CAC  11000007   BEQ T0, ZERO, 0x9D024CCC
9D024CB0  256CFFFF   ADDIU T4, T3, -1
9D024CD8  920E0000   LBU T6, 0(S0)
9D024CDC  31CF0002   ANDI T7, T6, 2
9D024CE0  31F800FF   ANDI T8, T7, 255
9D024CE4  13000009   BEQ T8, ZERO, 0x9D024D0C
9D024CE8  24A3FFFE   ADDIU V1, A1, -2
9D024D18  92060000   LBU A2, 0(S0)
9D024D1C  30C70004   ANDI A3, A2, 4
9D024D20  30E800FF   ANDI T0, A3, 255
9D024D24  11000009   BEQ T0, ZERO, 0x9D024D4C
9D024D28  258DFFFD   ADDIU T5, T4, -3
9D024D58  920F0000   LBU T7, 0(S0)
9D024D5C  31F80008   ANDI T8, T7, 8
9D024D60  331900FF   ANDI T9, T8, 255
9D024D64  53200008   BEQL T9, ZERO, 0x9D024D88
9D024D68  26100001   ADDIU S0, S0, 1
522:                 						{
523:                 						BOX_loc_set_bit((unsigned char)(x_loc+temp_col),y_loc-temp_row);
9D024CB4  938981C4   LBU T1, -32316(GP)
9D024CB8  02295021   ADDU T2, S1, T1
9D024CBC  0F4092F3   JAL BOX_loc_set_bit
9D024CC0  314400FF   ANDI A0, T2, 255
9D024CEC  939981C4   LBU T9, -32316(GP)
9D024CF0  0239F821   ADDU RA, S1, T9
9D024CF4  2562FFFF   ADDIU V0, T3, -1
9D024CF8  33E400FF   ANDI A0, RA, 255
9D024CFC  0F4092F3   JAL BOX_loc_set_bit
9D024D00  304500FF   ANDI A1, V0, 255
9D024D2C  938981C4   LBU T1, -32316(GP)
9D024D30  02295021   ADDU T2, S1, T1
9D024D34  24ABFFFE   ADDIU T3, A1, -2
9D024D38  314400FF   ANDI A0, T2, 255
9D024D3C  0F4092F3   JAL BOX_loc_set_bit
9D024D40  316500FF   ANDI A1, T3, 255
9D024D6C  939F81C4   LBU RA, -32316(GP)
9D024D70  023F8821   ADDU S1, S1, RA
9D024D74  2582FFFD   ADDIU V0, T4, -3
9D024D78  322400FF   ANDI A0, S1, 255
9D024D7C  0F4092F3   JAL BOX_loc_set_bit
9D024D80  304500FF   ANDI A1, V0, 255
9D024D84  26100001   ADDIU S0, S0, 1
524:                 						}
525:                 					}
526:                 				}
527:                 			}
528:                 		}
529:                 	}
9D024D90  8FBF0024   LW RA, 36(SP)
9D024D94  8FB30020   LW S3, 32(SP)
9D024D98  8FB2001C   LW S2, 28(SP)
9D024D9C  8FB10018   LW S1, 24(SP)
9D024DA0  8FB00014   LW S0, 20(SP)
9D024DA4  03E00008   JR RA
9D024DA8  27BD0028   ADDIU SP, SP, 40
530:                 
531:                 void BOX_clear_loc(void)
532:                 	{
9D024DAC  27BDFFD8   ADDIU SP, SP, -40
9D024DB0  AFBF0024   SW RA, 36(SP)
9D024DB4  AFB30020   SW S3, 32(SP)
9D024DB8  AFB2001C   SW S2, 28(SP)
9D024DBC  AFB10018   SW S1, 24(SP)
9D024DC0  AFB00014   SW S0, 20(SP)
9D024DC4  279281C8   ADDIU S2, GP, -32312
9D024DC8  26530004   ADDIU S3, S2, 4
9D024DCC  02408021   ADDU S0, S2, ZERO
9D024DD0  02128823   SUBU S1, S0, S2
9D024DD4  323100FF   ANDI S1, S1, 255
533:                 	//Step through 4 columns
534:                 	uint8_t temp_col, temp_row;
535:                 	for (temp_col=0; temp_col<4; temp_col++)
9D024EE4  1613FFBB   BNE S0, S3, 0x9D024DD4
9D024EE8  02128823   SUBU S1, S0, S2
536:                 		{
537:                 		//Only if x_loc is not out of bounds
538:                 		if ((unsigned char)(x_loc+temp_col) <= BOX_BOARD_RIGHT)
9D024DD8  938281C4   LBU V0, -32316(GP)
9D024DDC  02221821   ADDU V1, S1, V0
9D024DE0  306400FF   ANDI A0, V1, 255
9D024DE4  2C85000A   SLTIU A1, A0, 10
9D024DE8  50A0003E   BEQL A1, ZERO, 0x9D024EE4
9D024DEC  26100001   ADDIU S0, S0, 1
539:                 			{
540:                 			//Step through 4 rows
541:                 			for (temp_row=0; temp_row<4; temp_row++)
542:                 				{
543:                 				//Only if y_loc is not out of bounds
544:                 				if (y_loc-temp_row <= BOX_BOARD_BOTTOM)
9D024DF0  938581CC   LBU A1, -32308(GP)
9D024DF4  28A60014   SLTI A2, A1, 20
9D024DF8  10C0000A   BEQ A2, ZERO, 0x9D024E24
9D024DFC  938B81CC   LBU T3, -32308(GP)
9D024E20  938B81CC   LBU T3, -32308(GP)
9D024E24  256CFFFF   ADDIU T4, T3, -1
9D024E28  298D0014   SLTI T5, T4, 20
9D024E2C  11A0000D   BEQ T5, ZERO, 0x9D024E64
9D024E30  938581CC   LBU A1, -32308(GP)
9D024E60  938581CC   LBU A1, -32308(GP)
9D024E64  24A3FFFE   ADDIU V1, A1, -2
9D024E68  28640014   SLTI A0, V1, 20
9D024E6C  1080000D   BEQ A0, ZERO, 0x9D024EA4
9D024E70  938C81CC   LBU T4, -32308(GP)
9D024EA0  938C81CC   LBU T4, -32308(GP)
9D024EA4  258DFFFD   ADDIU T5, T4, -3
9D024EA8  29AE0014   SLTI T6, T5, 20
9D024EAC  51C0000D   BEQL T6, ZERO, 0x9D024EE4
9D024EB0  26100001   ADDIU S0, S0, 1
545:                 					{
546:                 					if (BOX_piece[temp_col] & 1<<(temp_row))	//Checks nibbles in Box_piece array
9D024E00  92070000   LBU A3, 0(S0)
9D024E04  30E80001   ANDI T0, A3, 1
9D024E08  11000007   BEQ T0, ZERO, 0x9D024E28
9D024E0C  256CFFFF   ADDIU T4, T3, -1
9D024E34  920E0000   LBU T6, 0(S0)
9D024E38  31CF0002   ANDI T7, T6, 2
9D024E3C  31F800FF   ANDI T8, T7, 255
9D024E40  13000009   BEQ T8, ZERO, 0x9D024E68
9D024E44  24A3FFFE   ADDIU V1, A1, -2
9D024E74  92060000   LBU A2, 0(S0)
9D024E78  30C70004   ANDI A3, A2, 4
9D024E7C  30E800FF   ANDI T0, A3, 255
9D024E80  11000009   BEQ T0, ZERO, 0x9D024EA8
9D024E84  258DFFFD   ADDIU T5, T4, -3
9D024EB4  920F0000   LBU T7, 0(S0)
9D024EB8  31F80008   ANDI T8, T7, 8
9D024EBC  331900FF   ANDI T9, T8, 255
9D024EC0  53200008   BEQL T9, ZERO, 0x9D024EE4
9D024EC4  26100001   ADDIU S0, S0, 1
547:                 						{
548:                 						BOX_loc_clear_bit((unsigned char)(x_loc+temp_col),y_loc-temp_row);
9D024E10  938981C4   LBU T1, -32316(GP)
9D024E14  02295021   ADDU T2, S1, T1
9D024E18  0F409303   JAL BOX_loc_clear_bit
9D024E1C  314400FF   ANDI A0, T2, 255
9D024E48  939981C4   LBU T9, -32316(GP)
9D024E4C  0239F821   ADDU RA, S1, T9
9D024E50  2562FFFF   ADDIU V0, T3, -1
9D024E54  33E400FF   ANDI A0, RA, 255
9D024E58  0F409303   JAL BOX_loc_clear_bit
9D024E5C  304500FF   ANDI A1, V0, 255
9D024E88  938981C4   LBU T1, -32316(GP)
9D024E8C  02295021   ADDU T2, S1, T1
9D024E90  24ABFFFE   ADDIU T3, A1, -2
9D024E94  314400FF   ANDI A0, T2, 255
9D024E98  0F409303   JAL BOX_loc_clear_bit
9D024E9C  316500FF   ANDI A1, T3, 255
9D024EC8  939F81C4   LBU RA, -32316(GP)
9D024ECC  023F8821   ADDU S1, S1, RA
9D024ED0  2582FFFD   ADDIU V0, T4, -3
9D024ED4  322400FF   ANDI A0, S1, 255
9D024ED8  0F409303   JAL BOX_loc_clear_bit
9D024EDC  304500FF   ANDI A1, V0, 255
9D024EE0  26100001   ADDIU S0, S0, 1
549:                 						}
550:                 					}
551:                 				}
552:                 			}
553:                 		}
554:                 	}
9D024EEC  8FBF0024   LW RA, 36(SP)
9D024EF0  8FB30020   LW S3, 32(SP)
9D024EF4  8FB2001C   LW S2, 28(SP)
9D024EF8  8FB10018   LW S1, 24(SP)
9D024EFC  8FB00014   LW S0, 20(SP)
9D024F00  03E00008   JR RA
9D024F04  27BD0028   ADDIU SP, SP, 40
555:                 
556:                 void BOX_load_reference(uint8_t piece, uint8_t rotation)
557:                 	{
558:                 	BOX_piece[0] = BOX_reference[piece][rotation][0];
9D024F08  00042080   SLL A0, A0, 2
9D024F0C  00852821   ADDU A1, A0, A1
9D024F10  00051080   SLL V0, A1, 2
9D024F14  3C039D04   LUI V1, -25340
9D024F18  24660594   ADDIU A2, V1, 1428
9D024F1C  00463821   ADDU A3, V0, A2
9D024F20  90E80000   LBU T0, 0(A3)
9D024F24  A38881C8   SB T0, -32312(GP)
559:                 	BOX_piece[1] = BOX_reference[piece][rotation][1];
9D024F28  90E90001   LBU T1, 1(A3)
9D024F2C  A38981C9   SB T1, -32311(GP)
560:                 	BOX_piece[2] = BOX_reference[piece][rotation][2];
9D024F30  90EA0002   LBU T2, 2(A3)
9D024F34  A38A81CA   SB T2, -32310(GP)
561:                 	BOX_piece[3] = BOX_reference[piece][rotation][3];
9D024F38  90EB0003   LBU T3, 3(A3)
9D024F3C  03E00008   JR RA
9D024F40  A38B81CB   SB T3, -32309(GP)
562:                 	}
563:                 
564:                 void BOX_rotate(uint8_t direction)
565:                 	{
9D025804  27BDFFE8   ADDIU SP, SP, -24
9D025808  AFBF0014   SW RA, 20(SP)
566:                 	//TODO: Allow for adjustments if rotation is prevented due to proximity
567:                 
568:                 	BOX_clear_loc(); //Clear current location so we don't have false compares
9D02580C  0F40936B   JAL BOX_clear_loc
9D025810  AFB00010   SW S0, 16(SP)
569:                 
570:                 	//Load in the candidate rotation
571:                 	uint8_t new_rotate = rotate;
9D025814  9390807A   LBU S0, -32646(GP)
572:                 	if (++new_rotate > 3) new_rotate = 0;
9D025818  26020001   ADDIU V0, S0, 1
9D02581C  305000FF   ANDI S0, V0, 255
9D025820  2E030004   SLTIU V1, S0, 4
9D025824  0003800A   MOVZ S0, ZERO, V1
573:                 	BOX_load_reference(cur_piece,new_rotate);
9D025828  9384807B   LBU A0, -32645(GP)
9D02582C  0F4093C2   JAL BOX_load_reference
9D025830  02002821   ADDU A1, S0, ZERO
574:                 
575:                 	//Check for overlaps
576:                 	if (BOX_check(0, 0))
9D025834  00002021   ADDU A0, ZERO, ZERO
9D025838  0F40957F   JAL BOX_check
9D02583C  00002821   ADDU A1, ZERO, ZERO
9D025840  10400007   BEQ V0, ZERO, 0x9D025860
9D025844  9384807B   LBU A0, -32645(GP)
577:                 		{
578:                 		//Overlap will be caused, restore piece settings and return
579:                 		BOX_load_reference(cur_piece, rotate);
9D025848  0F4093C2   JAL BOX_load_reference
9D02584C  9385807A   LBU A1, -32646(GP)
580:                 		BOX_store_loc();
9D025850  0F409314   JAL BOX_store_loc
9D025854  00000000   NOP
581:                 		return;
9D025858  0B409625   J 0x9D025894
9D02585C  8FBF0014   LW RA, 20(SP)
582:                 		}
583:                 	//No overlap found, allow new rotation
584:                 	else
585:                 		{
586:                 		//Load the current rotation back in and clear the piece from display
587:                 		BOX_load_reference(cur_piece, rotate);
9D025860  0F4093C2   JAL BOX_load_reference
9D025864  9385807A   LBU A1, -32646(GP)
588:                 		BOX_clear_piece();
9D025868  0F409420   JAL BOX_clear_piece
9D02586C  00000000   NOP
589:                 
590:                 		//Load new rotation, display, and save its location
591:                 		rotate = new_rotate;
9D025870  A390807A   SB S0, -32646(GP)
592:                 		BOX_load_reference(cur_piece, rotate);
9D025874  9384807B   LBU A0, -32645(GP)
9D025878  0F4093C2   JAL BOX_load_reference
9D02587C  02002821   ADDU A1, S0, ZERO
593:                 
594:                 		BOX_store_loc();
9D025880  0F409314   JAL BOX_store_loc
9D025884  00000000   NOP
595:                 		BOX_write_piece();
9D025888  0F4093D1   JAL BOX_write_piece
9D02588C  00000000   NOP
596:                 		}
597:                 	BOX_update_screen;
598:                 	}
9D025890  8FBF0014   LW RA, 20(SP)
9D025894  8FB00010   LW S0, 16(SP)
9D025898  03E00008   JR RA
9D02589C  27BD0018   ADDIU SP, SP, 24
599:                 
600:                 
601:                 
602:                 void BOX_write_piece(void)  //Writes piece to display
603:                 	{
9D024F44  27BDFFD8   ADDIU SP, SP, -40
9D024F48  AFBF0024   SW RA, 36(SP)
9D024F4C  AFB30020   SW S3, 32(SP)
9D024F50  AFB2001C   SW S2, 28(SP)
9D024F54  AFB10018   SW S1, 24(SP)
9D024F58  AFB00014   SW S0, 20(SP)
9D024F5C  279281C8   ADDIU S2, GP, -32312
9D024F60  26530004   ADDIU S3, S2, 4
9D024F64  0B4093E9   J 0x9D024FA4
9D024F68  02408021   ADDU S0, S2, ZERO
9D024F6C  30E80008   ANDI T0, A3, 8
604:                 	uint8_t i, j;
605:                 	for (i=0; i<4; i++)  //Step through each of 4 columns
9D024F9C  12130032   BEQ S0, S3, 0x9D025068
9D024FA0  8FBF0024   LW RA, 36(SP)
9D024FA4  02128823   SUBU S1, S0, S2
9D024FA8  323100FF   ANDI S1, S1, 255
606:                 		{
607:                 		for (j=0; j<4; j++) //Step through each of 4 rows
608:                 			{
609:                 			//prevent invalid indices from being written
610:                 			if ((y_loc-j) >= 0)
9D024FD0  938581CC   LBU A1, -32308(GP)
9D024FD4  24A7FFFF   ADDIU A3, A1, -1
9D024FD8  04E0000E   BLTZ A3, 0x9D025014
9D024FDC  938E81CC   LBU T6, -32308(GP)
9D025010  938E81CC   LBU T6, -32308(GP)
9D025014  25CFFFFE   ADDIU T7, T6, -2
9D025018  05E0000E   BLTZ T7, 0x9D025054
9D02501C  938581CC   LBU A1, -32308(GP)
9D025050  938581CC   LBU A1, -32308(GP)
9D025054  24A4FFFD   ADDIU A0, A1, -3
9D025058  0483FFC4   BGEZL A0, 0x9D024F6C
9D02505C  92070000   LBU A3, 0(S0)
9D025060  0B4093E7   J 0x9D024F9C
9D025064  26100001   ADDIU S0, S0, 1
611:                 				{
612:                 				if (BOX_piece[i] & 1<<j)
9D024F70  310900FF   ANDI T1, T0, 255
9D024F74  51200009   BEQL T1, ZERO, 0x9D024F9C
9D024F78  26100001   ADDIU S0, S0, 1
9D024FAC  92020000   LBU V0, 0(S0)
9D024FB0  30430001   ANDI V1, V0, 1
9D024FB4  10600006   BEQ V1, ZERO, .LVL90
9D024FB8  938581CC   LBU A1, -32308(GP)
9D024FE0  92080000   LBU T0, 0(S0)
9D024FE4  31090002   ANDI T1, T0, 2
9D024FE8  312A00FF   ANDI T2, T1, 255
9D024FEC  1140000A   BEQ T2, ZERO, 0x9D025018
9D024FF0  25CFFFFE   ADDIU T7, T6, -2
9D025020  92180000   LBU T8, 0(S0)
9D025024  33190004   ANDI T9, T8, 4
9D025028  333F00FF   ANDI RA, T9, 255
9D02502C  13E0000A   BEQ RA, ZERO, 0x9D025058
9D025030  24A4FFFD   ADDIU A0, A1, -3
613:                 					{
614:                 					//TODO: change this for different colored playing pieces
615:                 					BOX_draw(x_loc+i, y_loc-j, DEFAULT_FG_COLOR);
9D024F7C  938A81C4   LBU T2, -32316(GP)
9D024F80  022A8821   ADDU S1, S1, T2
9D024F84  24ABFFFD   ADDIU T3, A1, -3
9D024F88  322400FF   ANDI A0, S1, 255
9D024F8C  316500FF   ANDI A1, T3, 255
9D024F90  0F409235   JAL BOX_draw
9D024F94  3C0600FF   LUI A2, 255
9D024F98  26100001   ADDIU S0, S0, 1
9D024FBC  938481C4   LBU A0, -32316(GP)
9D024FC0  02243021   ADDU A2, S1, A0
9D024FC4  30C400FF   ANDI A0, A2, 255
9D024FC8  0F409235   JAL BOX_draw
9D024FCC  3C0600FF   LUI A2, 255
9D024FF4  938B81C4   LBU T3, -32316(GP)
9D024FF8  022B6021   ADDU T4, S1, T3
9D024FFC  24ADFFFF   ADDIU T5, A1, -1
9D025000  318400FF   ANDI A0, T4, 255
9D025004  31A500FF   ANDI A1, T5, 255
9D025008  0F409235   JAL BOX_draw
9D02500C  3C0600FF   LUI A2, 255
9D025034  938281C4   LBU V0, -32316(GP)
9D025038  02221821   ADDU V1, S1, V0
9D02503C  25C6FFFE   ADDIU A2, T6, -2
9D025040  306400FF   ANDI A0, V1, 255
9D025044  30C500FF   ANDI A1, A2, 255
9D025048  0F409235   JAL BOX_draw
9D02504C  3C0600FF   LUI A2, 255
616:                 					}
617:                 				}
618:                 			}
619:                 		}
620:                 	}
9D025068  8FB30020   LW S3, 32(SP)
9D02506C  8FB2001C   LW S2, 28(SP)
9D025070  8FB10018   LW S1, 24(SP)
9D025074  8FB00014   LW S0, 20(SP)
9D025078  03E00008   JR RA
9D02507C  27BD0028   ADDIU SP, SP, 40
621:                 
622:                 void BOX_clear_piece(void)  //Clears piece from display
623:                 	{
9D025080  27BDFFD8   ADDIU SP, SP, -40
9D025084  AFBF0024   SW RA, 36(SP)
9D025088  AFB30020   SW S3, 32(SP)
9D02508C  AFB2001C   SW S2, 28(SP)
9D025090  AFB10018   SW S1, 24(SP)
9D025094  AFB00014   SW S0, 20(SP)
9D025098  279281C8   ADDIU S2, GP, -32312
9D02509C  26530004   ADDIU S3, S2, 4
9D0250A0  0B409437   J 0x9D0250DC
9D0250A4  02408021   ADDU S0, S2, ZERO
9D0250A8  30E80008   ANDI T0, A3, 8
624:                 	uint8_t i, j;
625:                 	for (i=0; i<4; i++)  //Step through each of 4 columns
9D0250D4  1213002F   BEQ S0, S3, 0x9D025194
9D0250D8  8FBF0024   LW RA, 36(SP)
9D0250DC  02128823   SUBU S1, S0, S2
9D0250E0  323100FF   ANDI S1, S1, 255
626:                 		{
627:                 		for (j=0; j<4; j++) //Step through each of 4 rows
628:                 			{
629:                 			//prevent invalid indices from being written
630:                 			if ((y_loc-j) >= 0)
9D025104  938581CC   LBU A1, -32308(GP)
9D025108  24A7FFFF   ADDIU A3, A1, -1
9D02510C  04E0000D   BLTZ A3, 0x9D025144
9D025110  938E81CC   LBU T6, -32308(GP)
9D025140  938E81CC   LBU T6, -32308(GP)
9D025144  25CFFFFE   ADDIU T7, T6, -2
9D025148  05E0000D   BLTZ T7, 0x9D025180
9D02514C  938581CC   LBU A1, -32308(GP)
9D02517C  938581CC   LBU A1, -32308(GP)
9D025180  24A4FFFD   ADDIU A0, A1, -3
9D025184  0483FFC8   BGEZL A0, 0x9D0250A8
9D025188  92070000   LBU A3, 0(S0)
9D02518C  0B409435   J 0x9D0250D4
9D025190  26100001   ADDIU S0, S0, 1
631:                 				{
632:                 				if (BOX_piece[i] & 1<<j)
9D0250AC  310900FF   ANDI T1, T0, 255
9D0250B0  51200008   BEQL T1, ZERO, 0x9D0250D4
9D0250B4  26100001   ADDIU S0, S0, 1
9D0250E4  92020000   LBU V0, 0(S0)
9D0250E8  30430001   ANDI V1, V0, 1
9D0250EC  10600005   BEQ V1, ZERO, .LVL102
9D0250F0  938581CC   LBU A1, -32308(GP)
9D025114  92080000   LBU T0, 0(S0)
9D025118  31090002   ANDI T1, T0, 2
9D02511C  312A00FF   ANDI T2, T1, 255
9D025120  11400009   BEQ T2, ZERO, 0x9D025148
9D025124  25CFFFFE   ADDIU T7, T6, -2
9D025150  92180000   LBU T8, 0(S0)
9D025154  33190004   ANDI T9, T8, 4
9D025158  333F00FF   ANDI RA, T9, 255
9D02515C  13E00009   BEQ RA, ZERO, 0x9D025184
9D025160  24A4FFFD   ADDIU A0, A1, -3
633:                 					{
634:                 					//TODO: change this for different colored playing pieces
635:                 					BOX_erase(x_loc+i, y_loc-j);
9D0250B8  938A81C4   LBU T2, -32316(GP)
9D0250BC  022A8821   ADDU S1, S1, T2
9D0250C0  24ABFFFD   ADDIU T3, A1, -3
9D0250C4  322400FF   ANDI A0, S1, 255
9D0250C8  0F409249   JAL BOX_erase
9D0250CC  316500FF   ANDI A1, T3, 255
9D0250D0  26100001   ADDIU S0, S0, 1
9D0250F4  938481C4   LBU A0, -32316(GP)
9D0250F8  02243021   ADDU A2, S1, A0
9D0250FC  0F409249   JAL BOX_erase
9D025100  30C400FF   ANDI A0, A2, 255
9D025128  938B81C4   LBU T3, -32316(GP)
9D02512C  022B6021   ADDU T4, S1, T3
9D025130  24ADFFFF   ADDIU T5, A1, -1
9D025134  318400FF   ANDI A0, T4, 255
9D025138  0F409249   JAL BOX_erase
9D02513C  31A500FF   ANDI A1, T5, 255
9D025164  938281C4   LBU V0, -32316(GP)
9D025168  02221821   ADDU V1, S1, V0
9D02516C  25C6FFFE   ADDIU A2, T6, -2
9D025170  306400FF   ANDI A0, V1, 255
9D025174  0F409249   JAL BOX_erase
9D025178  30C500FF   ANDI A1, A2, 255
636:                 					}
637:                 				}
638:                 			}
639:                 		}
640:                 	}
9D025194  8FB30020   LW S3, 32(SP)
9D025198  8FB2001C   LW S2, 28(SP)
9D02519C  8FB10018   LW S1, 24(SP)
9D0251A0  8FB00014   LW S0, 20(SP)
9D0251A4  03E00008   JR RA
9D0251A8  27BD0028   ADDIU SP, SP, 40
641:                 
642:                 void BOX_rewrite_display(uint32_t fgcolor)	//Rewrites entire playing area
643:                 	{
9D0251AC  27BDFFD8   ADDIU SP, SP, -40
9D0251B0  AFBF0024   SW RA, 36(SP)
9D0251B4  AFB40020   SW S4, 32(SP)
9D0251B8  AFB3001C   SW S3, 28(SP)
9D0251BC  AFB20018   SW S2, 24(SP)
9D0251C0  AFB10014   SW S1, 20(SP)
9D0251C4  AFB00010   SW S0, 16(SP)
9D0251C8  00809021   ADDU S2, A0, ZERO
9D02523C  00008821   ADDU S1, ZERO, ZERO
644:                 	//printf(cls);
645:                 	
646:                 	uint8_t cols, rows;
647:                 	for (cols=0; cols<=BOX_BOARD_RIGHT; cols++)
9D0251CC  00008021   ADDU S0, ZERO, ZERO
9D0251D4  0B40948F   J 0x9D02523C
9D0251D8  2414000A   ADDIU S4, ZERO, 10
9D025230  321000FF   ANDI S0, S0, 255
9D025234  12140009   BEQ S0, S4, 0x9D02525C
9D025238  8FBF0024   LW RA, 36(SP)
9D0253D4  0B40948C   J 0x9D025230
9D0253D8  26100001   ADDIU S0, S0, 1
648:                 		{
649:                 		for (rows=0; rows<=BOX_BOARD_BOTTOM; rows++)
9D0251D0  24130014   ADDIU S3, ZERO, 20
9D02520C  26220001   ADDIU V0, S1, 1
9D025210  305100FF   ANDI S1, V0, 255
9D025280  0B4094A5   J 0x9D025294
9D025284  24110001   ADDIU S1, ZERO, 1
9D025290  24110001   ADDIU S1, ZERO, 1
9D0252B0  0B409477   J 0x9D0251DC
9D0252B4  26310001   ADDIU S1, S1, 1
9D0252C4  0B409477   J 0x9D0251DC
9D0252C8  26310001   ADDIU S1, S1, 1
9D0252D4  0B4094BA   J 0x9D0252E8
9D0252D8  26230001   ADDIU V1, S1, 1
9D0252E4  26230001   ADDIU V1, S1, 1
9D0252E8  307100FF   ANDI S1, V1, 255
9D025308  0B4094C8   J 0x9D025320
9D02530C  26240001   ADDIU A0, S1, 1
9D02531C  26240001   ADDIU A0, S1, 1
9D025320  309100FF   ANDI S1, A0, 255
9D025340  0B4094D6   J 0x9D025358
9D025344  26250001   ADDIU A1, S1, 1
9D025354  26250001   ADDIU A1, S1, 1
9D025358  30B100FF   ANDI S1, A1, 255
9D025378  0B4094E4   J 0x9D025390
9D02537C  26260001   ADDIU A2, S1, 1
9D02538C  26260001   ADDIU A2, S1, 1
9D025390  30D100FF   ANDI S1, A2, 255
9D0253B0  0B4094F2   J 0x9D0253C8
9D0253B4  26270001   ADDIU A3, S1, 1
9D0253C4  26270001   ADDIU A3, S1, 1
9D0253C8  30F100FF   ANDI S1, A3, 255
9D0253CC  1633FF84   BNE S1, S3, 0x9D0251E0
9D0253D0  02002021   ADDU A0, S0, ZERO
650:                 			{
651:                 			if(BOX_loc_return_bit(cols,rows)) BOX_draw(cols,rows,fgcolor);
9D0251DC  02002021   ADDU A0, S0, ZERO
9D0251E0  0F4092E5   JAL BOX_loc_return_bit
9D0251E4  02202821   ADDU A1, S1, ZERO
9D0251E8  10400006   BEQ V0, ZERO, 0x9D025204
9D0251EC  02002021   ADDU A0, S0, ZERO
9D0251F0  02202821   ADDU A1, S1, ZERO
9D0251F4  0F409235   JAL BOX_draw
9D0251F8  02403021   ADDU A2, S2, ZERO
9D0251FC  0B409484   J 0x9D025210
9D025200  26220001   ADDIU V0, S1, 1
9D025214  02002021   ADDU A0, S0, ZERO
9D025218  0F4092E5   JAL BOX_loc_return_bit
9D02521C  02202821   ADDU A1, S1, ZERO
9D025220  1040002A   BEQ V0, ZERO, 0x9D0252CC
9D025224  02002021   ADDU A0, S0, ZERO
9D025228  0B4094B7   J 0x9D0252DC
9D02522C  02202821   ADDU A1, S1, ZERO
9D025240  02002021   ADDU A0, S0, ZERO
9D025244  0F4092E5   JAL BOX_loc_return_bit
9D025248  02202821   ADDU A1, S1, ZERO
9D02524C  1040000A   BEQ V0, ZERO, 0x9D025278
9D025250  02002021   ADDU A0, S0, ZERO
9D025254  0B4094A2   J 0x9D025288
9D025258  02202821   ADDU A1, S1, ZERO
9D025288  0F409235   JAL BOX_draw
9D02528C  02403021   ADDU A2, S2, ZERO
9D025294  02002021   ADDU A0, S0, ZERO
9D025298  0F4092E5   JAL BOX_loc_return_bit
9D02529C  02202821   ADDU A1, S1, ZERO
9D0252A0  14400005   BNE V0, ZERO, 0x9D0252B8
9D0252A4  02002021   ADDU A0, S0, ZERO
9D0252B8  02202821   ADDU A1, S1, ZERO
9D0252BC  0F409235   JAL BOX_draw
9D0252C0  02403021   ADDU A2, S2, ZERO
9D0252DC  0F409235   JAL BOX_draw
9D0252E0  02403021   ADDU A2, S2, ZERO
9D0252EC  02002021   ADDU A0, S0, ZERO
9D0252F0  0F4092E5   JAL BOX_loc_return_bit
9D0252F4  02202821   ADDU A1, S1, ZERO
9D0252F8  14400005   BNE V0, ZERO, 0x9D025310
9D0252FC  02002021   ADDU A0, S0, ZERO
9D025310  02202821   ADDU A1, S1, ZERO
9D025314  0F409235   JAL BOX_draw
9D025318  02403021   ADDU A2, S2, ZERO
9D025324  02002021   ADDU A0, S0, ZERO
9D025328  0F4092E5   JAL BOX_loc_return_bit
9D02532C  02202821   ADDU A1, S1, ZERO
9D025330  14400005   BNE V0, ZERO, 0x9D025348
9D025334  02002021   ADDU A0, S0, ZERO
9D025348  02202821   ADDU A1, S1, ZERO
9D02534C  0F409235   JAL BOX_draw
9D025350  02403021   ADDU A2, S2, ZERO
9D02535C  02002021   ADDU A0, S0, ZERO
9D025360  0F4092E5   JAL BOX_loc_return_bit
9D025364  02202821   ADDU A1, S1, ZERO
9D025368  14400005   BNE V0, ZERO, 0x9D025380
9D02536C  02002021   ADDU A0, S0, ZERO
9D025380  02202821   ADDU A1, S1, ZERO
9D025384  0F409235   JAL BOX_draw
9D025388  02403021   ADDU A2, S2, ZERO
9D025394  02002021   ADDU A0, S0, ZERO
9D025398  0F4092E5   JAL BOX_loc_return_bit
9D02539C  02202821   ADDU A1, S1, ZERO
9D0253A0  14400005   BNE V0, ZERO, 0x9D0253B8
9D0253A4  02002021   ADDU A0, S0, ZERO
9D0253B8  02202821   ADDU A1, S1, ZERO
9D0253BC  0F409235   JAL BOX_draw
9D0253C0  02403021   ADDU A2, S2, ZERO
652:                 			else BOX_erase(cols,rows);
9D025204  0F409249   JAL BOX_erase
9D025208  02202821   ADDU A1, S1, ZERO
9D025278  0F409249   JAL BOX_erase
9D02527C  02202821   ADDU A1, S1, ZERO
9D0252A8  0F409249   JAL BOX_erase
9D0252AC  02202821   ADDU A1, S1, ZERO
9D0252CC  0F409249   JAL BOX_erase
9D0252D0  02202821   ADDU A1, S1, ZERO
9D025300  0F409249   JAL BOX_erase
9D025304  02202821   ADDU A1, S1, ZERO
9D025338  0F409249   JAL BOX_erase
9D02533C  02202821   ADDU A1, S1, ZERO
9D025370  0F409249   JAL BOX_erase
9D025374  02202821   ADDU A1, S1, ZERO
9D0253A8  0F409249   JAL BOX_erase
9D0253AC  02202821   ADDU A1, S1, ZERO
653:                 			}
654:                 		}
655:                 	}
9D02525C  8FB40020   LW S4, 32(SP)
9D025260  8FB3001C   LW S3, 28(SP)
9D025264  8FB20018   LW S2, 24(SP)
9D025268  8FB10014   LW S1, 20(SP)
9D02526C  8FB00010   LW S0, 16(SP)
9D025270  03E00008   JR RA
9D025274  27BD0028   ADDIU SP, SP, 40
9D025278  0F409249   JAL BOX_erase
9D02527C  02202821   ADDU A1, S1, ZERO
9D025280  0B4094A5   J 0x9D025294
9D025284  24110001   ADDIU S1, ZERO, 1
9D025288  0F409235   JAL BOX_draw
9D02528C  02403021   ADDU A2, S2, ZERO
9D025290  24110001   ADDIU S1, ZERO, 1
9D025294  02002021   ADDU A0, S0, ZERO
9D025298  0F4092E5   JAL BOX_loc_return_bit
9D02529C  02202821   ADDU A1, S1, ZERO
9D0252A0  14400005   BNE V0, ZERO, 0x9D0252B8
9D0252A4  02002021   ADDU A0, S0, ZERO
9D0252A8  0F409249   JAL BOX_erase
9D0252AC  02202821   ADDU A1, S1, ZERO
9D0252B0  0B409477   J 0x9D0251DC
9D0252B4  26310001   ADDIU S1, S1, 1
9D0252B8  02202821   ADDU A1, S1, ZERO
9D0252BC  0F409235   JAL BOX_draw
9D0252C0  02403021   ADDU A2, S2, ZERO
9D0252C4  0B409477   J 0x9D0251DC
9D0252C8  26310001   ADDIU S1, S1, 1
9D0252CC  0F409249   JAL BOX_erase
9D0252D0  02202821   ADDU A1, S1, ZERO
9D0252D4  0B4094BA   J 0x9D0252E8
9D0252D8  26230001   ADDIU V1, S1, 1
9D0252DC  0F409235   JAL BOX_draw
9D0252E0  02403021   ADDU A2, S2, ZERO
9D0252E4  26230001   ADDIU V1, S1, 1
9D0252E8  307100FF   ANDI S1, V1, 255
9D0252EC  02002021   ADDU A0, S0, ZERO
9D0252F0  0F4092E5   JAL BOX_loc_return_bit
9D0252F4  02202821   ADDU A1, S1, ZERO
9D0252F8  14400005   BNE V0, ZERO, 0x9D025310
9D0252FC  02002021   ADDU A0, S0, ZERO
9D025300  0F409249   JAL BOX_erase
9D025304  02202821   ADDU A1, S1, ZERO
9D025308  0B4094C8   J 0x9D025320
9D02530C  26240001   ADDIU A0, S1, 1
9D025310  02202821   ADDU A1, S1, ZERO
9D025314  0F409235   JAL BOX_draw
9D025318  02403021   ADDU A2, S2, ZERO
9D02531C  26240001   ADDIU A0, S1, 1
9D025320  309100FF   ANDI S1, A0, 255
9D025324  02002021   ADDU A0, S0, ZERO
9D025328  0F4092E5   JAL BOX_loc_return_bit
9D02532C  02202821   ADDU A1, S1, ZERO
9D025330  14400005   BNE V0, ZERO, 0x9D025348
9D025334  02002021   ADDU A0, S0, ZERO
9D025338  0F409249   JAL BOX_erase
9D02533C  02202821   ADDU A1, S1, ZERO
9D025340  0B4094D6   J 0x9D025358
9D025344  26250001   ADDIU A1, S1, 1
9D025348  02202821   ADDU A1, S1, ZERO
9D02534C  0F409235   JAL BOX_draw
9D025350  02403021   ADDU A2, S2, ZERO
9D025354  26250001   ADDIU A1, S1, 1
9D025358  30B100FF   ANDI S1, A1, 255
9D02535C  02002021   ADDU A0, S0, ZERO
9D025360  0F4092E5   JAL BOX_loc_return_bit
9D025364  02202821   ADDU A1, S1, ZERO
9D025368  14400005   BNE V0, ZERO, 0x9D025380
9D02536C  02002021   ADDU A0, S0, ZERO
9D025370  0F409249   JAL BOX_erase
9D025374  02202821   ADDU A1, S1, ZERO
9D025378  0B4094E4   J 0x9D025390
9D02537C  26260001   ADDIU A2, S1, 1
9D025380  02202821   ADDU A1, S1, ZERO
9D025384  0F409235   JAL BOX_draw
9D025388  02403021   ADDU A2, S2, ZERO
9D02538C  26260001   ADDIU A2, S1, 1
9D025390  30D100FF   ANDI S1, A2, 255
9D025394  02002021   ADDU A0, S0, ZERO
9D025398  0F4092E5   JAL BOX_loc_return_bit
9D02539C  02202821   ADDU A1, S1, ZERO
9D0253A0  14400005   BNE V0, ZERO, 0x9D0253B8
9D0253A4  02002021   ADDU A0, S0, ZERO
9D0253A8  0F409249   JAL BOX_erase
9D0253AC  02202821   ADDU A1, S1, ZERO
9D0253B0  0B4094F2   J 0x9D0253C8
9D0253B4  26270001   ADDIU A3, S1, 1
9D0253B8  02202821   ADDU A1, S1, ZERO
9D0253BC  0F409235   JAL BOX_draw
9D0253C0  02403021   ADDU A2, S2, ZERO
9D0253C4  26270001   ADDIU A3, S1, 1
9D0253C8  30F100FF   ANDI S1, A3, 255
9D0253CC  1633FF84   BNE S1, S3, 0x9D0251E0
9D0253D0  02002021   ADDU A0, S0, ZERO
9D0253D4  0B40948C   J 0x9D025230
9D0253D8  26100001   ADDIU S0, S0, 1
656:                 
657:                 void BOX_update_screen(void)
658:                 	{
9D0255F4  03E00008   JR RA
9D0255F8  00000000   NOP
659:                 	//This function call is not needed when a screen buffer isn't used
660:                 	//BOX_rewrite_display(default_fg_color, default_bg_color);
661:                 	}
662:                 
663:                 void BOX_spawn(void)
664:                 	{
9D0258A0  27BDFFE8   ADDIU SP, SP, -24
9D0258A4  AFBF0014   SW RA, 20(SP)
665:                 	x_loc = 4;
9D0258A8  24020004   ADDIU V0, ZERO, 4
9D0258AC  A38281C4   SB V0, -32316(GP)
666:                 	y_loc = 1;
9D0258B0  24030001   ADDIU V1, ZERO, 1
9D0258B4  A38381CC   SB V1, -32308(GP)
667:                 	cur_piece = random_piece;
9D0258B8  9384807C   LBU A0, -32644(GP)
9D0258BC  308400FF   ANDI A0, A0, 255
9D0258C0  A384807B   SB A0, -32645(GP)
668:                 	rotate = 0;
9D0258C4  A380807A   SB ZERO, -32646(GP)
669:                 
670:                 	BOX_load_reference(cur_piece, rotate);  //load from reference
9D0258C8  0F4093C2   JAL BOX_load_reference
9D0258CC  00002821   ADDU A1, ZERO, ZERO
671:                 
672:                 
673:                 
674:                 	//Check to see if we've filled the screen
675:                 	if (BOX_check(0,0))
9D0258D0  00002021   ADDU A0, ZERO, ZERO
9D0258D4  0F40957F   JAL BOX_check
9D0258D8  00002821   ADDU A1, ZERO, ZERO
9D0258DC  10400003   BEQ V0, ZERO, 0x9D0258EC
9D0258E0  93858078   LBU A1, -32648(GP)
676:                 		{
677:                 		//BOX_end_game();
678:                 		++game_over;
9D0258E4  24A60001   ADDIU A2, A1, 1
9D0258E8  A3868078   SB A2, -32648(GP)
679:                 		}
680:                 
681:                 	BOX_store_loc(); //Store new location
9D0258EC  0F409314   JAL BOX_store_loc
9D0258F0  00000000   NOP
682:                 	BOX_write_piece(); //draw piece
9D0258F4  0F4093D1   JAL BOX_write_piece
9D0258F8  00000000   NOP
683:                 	BOX_update_screen();
684:                 	}
9D0258FC  8FBF0014   LW RA, 20(SP)
9D025900  03E00008   JR RA
9D025904  27BD0018   ADDIU SP, SP, 24
685:                 
686:                 uint8_t BOX_check(int8_t X_offset, int8_t Y_offset)
687:                 	{
9D0255FC  27BDFFB0   ADDIU SP, SP, -80
9D025600  AFBF004C   SW RA, 76(SP)
9D025604  AFBE0048   SW FP, 72(SP)
9D025608  AFB70044   SW S7, 68(SP)
9D02560C  AFB60040   SW S6, 64(SP)
9D025610  AFB5003C   SW S5, 60(SP)
9D025614  AFB40038   SW S4, 56(SP)
9D025618  AFB30034   SW S3, 52(SP)
9D02561C  AFB20030   SW S2, 48(SP)
9D025620  AFB1002C   SW S1, 44(SP)
9D025624  AFB00028   SW S0, 40(SP)
9D025628  00808821   ADDU S1, A0, ZERO
9D02562C  00A08021   ADDU S0, A1, ZERO
688:                 	uint8_t temp_area[4] = { 0x00, 0x00, 0x00, 0x00 };
9D025630  A3A00010   SB ZERO, 16(SP)
9D025634  A3A00011   SB ZERO, 17(SP)
9D025638  A3A00012   SB ZERO, 18(SP)
689:                 	uint8_t i;
690:                 	//Build compare mask in temp_area[]
691:                 
692:                 	//Clear the current piece from BOX_location[] so we don't have a false overlap
693:                 	//Do this only if X_offset and Y_offset aren't both 0 (used for BOX_spawn)
694:                 	if (X_offset || Y_offset) BOX_clear_loc();
9D02563C  0085F025   OR FP, A0, A1
9D025640  13C0004E   BEQ FP, ZERO, 0x9D02577C
9D025644  A3A00013   SB ZERO, 19(SP)
9D025648  0F40936B   JAL BOX_clear_loc
9D02564C  00000000   NOP
695:                 	//mask will be 4 sets of nibbles (2 bytes)
696:                 	for (i=0; i<4; i++)
9D02571C  1613FFCE   BNE S0, S3, 0x9D025658
9D025720  309100FF   ANDI S1, A0, 255
697:                 		{
698:                 		//if out of bounds on the x axis
699:                 		if ((unsigned char)(x_loc+X_offset+i) > BOX_BOARD_RIGHT) temp_area[i] = 0x0F;
9D025650  0B4095E0   J 0x9D025780
9D025654  938281C4   LBU V0, -32316(GP)
9D025658  2E29000A   SLTIU T1, S1, 10
9D02565C  15200003   BNE T1, ZERO, 0x9D02566C
9D025660  2403000F   ADDIU V1, ZERO, 15
9D025664  0B4095C5   J 0x9D025714
9D025668  A2030000   SB V1, 0(S0)
9D02577C  938281C4   LBU V0, -32316(GP)
9D025780  02221821   ADDU V1, S1, V0
700:                 		else
701:                 			{
702:                 			uint8_t j;
703:                 			for (j=0; j<4; j++)
704:                 				{
705:                 				//if we're out of bounds on the y axis
706:                 				if (((unsigned char)(y_loc+Y_offset-j) > BOX_BOARD_BOTTOM) ||
9D02566C  16E00005   BNE S7, ZERO, 0x9D025684
9D025670  02202021   ADDU A0, S1, ZERO
9D02568C  5440FFFA   BNEL V0, ZERO, 0x9D025678
9D025690  920A0000   LBU T2, 0(S0)
9D025694  16A00005   BNE S5, ZERO, 0x9D0256AC
9D025698  02202021   ADDU A0, S1, ZERO
9D0256B4  5440FFFA   BNEL V0, ZERO, 0x9D0256A0
9D0256B8  920C0000   LBU T4, 0(S0)
9D0256BC  8FAE0018   LW T6, 24(SP)
9D0256C0  15C00005   BNE T6, ZERO, 0x9D0256D8
9D0256C4  02202021   ADDU A0, S1, ZERO
9D0256E0  5440FFFA   BNEL V0, ZERO, 0x9D0256CC
9D0256E4  920F0000   LBU T7, 0(S0)
9D0256E8  8FB90020   LW T9, 32(SP)
9D0256EC  53200007   BEQL T9, ZERO, 0x9D02570C
9D0256F0  921F0000   LBU RA, 0(S0)
9D025700  10400005   BEQ V0, ZERO, 0x9D025718
9D025704  26240001   ADDIU A0, S1, 1
9D025784  939281CC   LBU S2, -32308(GP)
9D025788  02122021   ADDU A0, S0, S2
9D02578C  309200FF   ANDI S2, A0, 255
9D025790  27B00010   ADDIU S0, SP, 16
9D025794  27B30014   ADDIU S3, SP, 20
9D025798  307100FF   ANDI S1, V1, 255
9D02579C  2E570014   SLTIU S7, S2, 20
9D0257A0  2656FFFF   ADDIU S6, S2, -1
9D0257A4  32D600FF   ANDI S6, S6, 255
9D0257A8  2ED50014   SLTIU S5, S6, 20
9D0257AC  2654FFFE   ADDIU S4, S2, -2
9D0257B0  329400FF   ANDI S4, S4, 255
9D0257B4  2E850014   SLTIU A1, S4, 20
9D0257B8  AFA50018   SW A1, 24(SP)
9D0257BC  2646FFFD   ADDIU A2, S2, -3
9D0257C0  30C700FF   ANDI A3, A2, 255
9D0257C4  AFA7001C   SW A3, 28(SP)
9D0257C8  2CE80014   SLTIU T0, A3, 20
9D0257CC  0B409596   J 0x9D025658
9D0257D0  AFA80020   SW T0, 32(SP)
707:                 					(BOX_loc_return_bit((unsigned char)(x_loc+X_offset+i),(unsigned char)(y_loc+Y_offset-j))))
9D025684  0F4092E5   JAL BOX_loc_return_bit
9D025688  02402821   ADDU A1, S2, ZERO
9D0256AC  0F4092E5   JAL BOX_loc_return_bit
9D0256B0  02C02821   ADDU A1, S6, ZERO
9D0256D8  0F4092E5   JAL BOX_loc_return_bit
9D0256DC  02802821   ADDU A1, S4, ZERO
9D0256F4  02202021   ADDU A0, S1, ZERO
9D0256F8  0F4092E5   JAL BOX_loc_return_bit
9D0256FC  8FA5001C   LW A1, 28(SP)
708:                 					{
709:                 					temp_area[i] |= 1<<j;
9D025674  920A0000   LBU T2, 0(S0)
9D025678  354B0001   ORI T3, T2, 1
9D02567C  0B4095A5   J 0x9D025694
9D025680  A20B0000   SB T3, 0(S0)
9D02569C  920C0000   LBU T4, 0(S0)
9D0256A0  358D0002   ORI T5, T4, 2
9D0256A4  0B4095AF   J 0x9D0256BC
9D0256A8  A20D0000   SB T5, 0(S0)
9D0256C8  920F0000   LBU T7, 0(S0)
9D0256CC  35F80004   ORI T8, T7, 4
9D0256D0  0B4095BA   J 0x9D0256E8
9D0256D4  A2180000   SB T8, 0(S0)
9D025708  921F0000   LBU RA, 0(S0)
9D02570C  37E20008   ORI V0, RA, 8
9D025710  A2020000   SB V0, 0(S0)
9D025714  26240001   ADDIU A0, S1, 1
9D025718  26100001   ADDIU S0, S0, 1
710:                 					}
711:                 				}
712:                 			}
713:                 		}
714:                 	if (X_offset || Y_offset) BOX_store_loc(); //Restore the location we cleared earlier
9D025724  13C00004   BEQ FP, ZERO, 0x9D025738
9D025728  939E81C9   LBU FP, -32311(GP)
9D02572C  0F409314   JAL BOX_store_loc
9D025730  00000000   NOP
715:                 
716:                 	if ((temp_area[0] & BOX_piece[0]) | (temp_area[1] & BOX_piece[1]) | (temp_area[2] & BOX_piece[2]) | (temp_area[3] & BOX_piece[3]))
9D025734  939E81C9   LBU FP, -32311(GP)
9D025738  93B20011   LBU S2, 17(SP)
9D02573C  03D28024   AND S0, FP, S2
9D025740  939381C8   LBU S3, -32312(GP)
9D025744  93B10010   LBU S1, 16(SP)
9D025748  0271B824   AND S7, S3, S1
9D02574C  0217B025   OR S6, S0, S7
9D025750  939581CA   LBU S5, -32310(GP)
9D025754  93B40012   LBU S4, 18(SP)
9D025758  02B42824   AND A1, S5, S4
9D02575C  02C53025   OR A2, S6, A1
9D025760  938781CB   LBU A3, -32309(GP)
9D025764  93A80013   LBU T0, 19(SP)
9D025768  00E84824   AND T1, A3, T0
9D02576C  00C95025   OR T2, A2, T1
9D025770  314B00FF   ANDI T3, T2, 255
717:                 		{
718:                 		//Conflict has been found
719:                 		return 1;
9D025774  0B4095F5   J 0x9D0257D4
9D025778  000B102B   SLTU V0, ZERO, T3
720:                 		}
721:                 	else return 0;
722:                 	}
9D0257D4  8FBF004C   LW RA, 76(SP)
9D0257D8  8FBE0048   LW FP, 72(SP)
9D0257DC  8FB70044   LW S7, 68(SP)
9D0257E0  8FB60040   LW S6, 64(SP)
9D0257E4  8FB5003C   LW S5, 60(SP)
9D0257E8  8FB40038   LW S4, 56(SP)
9D0257EC  8FB30034   LW S3, 52(SP)
9D0257F0  8FB20030   LW S2, 48(SP)
9D0257F4  8FB1002C   LW S1, 44(SP)
9D0257F8  8FB00028   LW S0, 40(SP)
9D0257FC  03E00008   JR RA
9D025800  27BD0050   ADDIU SP, SP, 80
723:                 
724:                 void BOX_line_check(void)
725:                 	{
9D025974  27BDFFC0   ADDIU SP, SP, -64
9D025978  AFBF003C   SW RA, 60(SP)
9D02597C  AFB70038   SW S7, 56(SP)
9D025980  AFB60034   SW S6, 52(SP)
9D025984  AFB50030   SW S5, 48(SP)
9D025988  AFB4002C   SW S4, 44(SP)
9D02598C  AFB30028   SW S3, 40(SP)
9D025990  AFB20024   SW S2, 36(SP)
9D025994  AFB10020   SW S1, 32(SP)
9D025998  AFB0001C   SW S0, 28(SP)
726:                 	//TODO: Tweak this to enable scoring
727:                 
728:                 	//Check every line on the playing area for complete rows and record them in an array
729:                 	uint8_t complete_lines[4];	//There will never be more than 4 complete rows
730:                 	uint8_t temp_index = 0;		//Index for complete_lines[]
9D0259A0  00009021   ADDU S2, ZERO, ZERO
731:                   
732:                 	uint8_t board_rows;
733:                 	for (board_rows=0; board_rows<=BOX_BOARD_BOTTOM; board_rows++)
9D02599C  00009821   ADDU S3, ZERO, ZERO
9D0259A4  0B409678   J 0x9D0259E0
9D0259A8  24110014   ADDIU S1, ZERO, 20
9D0259D0  26700001   ADDIU S0, S3, 1
9D0259D4  321300FF   ANDI S3, S0, 255
9D0259D8  12710028   BEQ S3, S1, 0x9D025A7C
9D0259DC  00000000   NOP
9D025A74  0B409675   J 0x9D0259D4
9D025A78  26700001   ADDIU S0, S3, 1
734:                 		{
735:                 		uint8_t board_cols=0;
736:                 		while ((board_cols<=BOX_BOARD_RIGHT) && (BOX_loc_return_bit(board_cols,board_rows)))
9D0259C0  0F4092E5   JAL BOX_loc_return_bit
9D0259C4  02602821   ADDU A1, S3, ZERO
9D0259C8  1440FFF8   BNE V0, ZERO, 0x9D0259AC
9D0259CC  26420001   ADDIU V0, S2, 1
9D0259E0  00002021   ADDU A0, ZERO, ZERO
9D0259E4  0F4092E5   JAL BOX_loc_return_bit
9D0259E8  02602821   ADDU A1, S3, ZERO
9D0259EC  1040FFF8   BEQ V0, ZERO, 0x9D0259D0
9D0259F0  24040001   ADDIU A0, ZERO, 1
9D0259F4  0F4092E5   JAL BOX_loc_return_bit
9D0259F8  02602821   ADDU A1, S3, ZERO
9D0259FC  1040FFF4   BEQ V0, ZERO, 0x9D0259D0
9D025A00  24040002   ADDIU A0, ZERO, 2
9D025A04  0F4092E5   JAL BOX_loc_return_bit
9D025A08  02602821   ADDU A1, S3, ZERO
9D025A0C  1040FFF0   BEQ V0, ZERO, 0x9D0259D0
9D025A10  24040003   ADDIU A0, ZERO, 3
9D025A14  0F4092E5   JAL BOX_loc_return_bit
9D025A18  02602821   ADDU A1, S3, ZERO
9D025A1C  1040FFEC   BEQ V0, ZERO, 0x9D0259D0
9D025A20  24040004   ADDIU A0, ZERO, 4
9D025A24  0F4092E5   JAL BOX_loc_return_bit
9D025A28  02602821   ADDU A1, S3, ZERO
9D025A2C  1040FFE8   BEQ V0, ZERO, 0x9D0259D0
9D025A30  24040005   ADDIU A0, ZERO, 5
9D025A34  0F4092E5   JAL BOX_loc_return_bit
9D025A38  02602821   ADDU A1, S3, ZERO
9D025A3C  1040FFE4   BEQ V0, ZERO, 0x9D0259D0
9D025A40  24040006   ADDIU A0, ZERO, 6
9D025A44  0F4092E5   JAL BOX_loc_return_bit
9D025A48  02602821   ADDU A1, S3, ZERO
9D025A4C  1040FFE0   BEQ V0, ZERO, 0x9D0259D0
9D025A50  24040007   ADDIU A0, ZERO, 7
9D025A54  0F4092E5   JAL BOX_loc_return_bit
9D025A58  02602821   ADDU A1, S3, ZERO
9D025A5C  1040FFDC   BEQ V0, ZERO, 0x9D0259D0
9D025A60  24040008   ADDIU A0, ZERO, 8
9D025A64  0F4092E5   JAL BOX_loc_return_bit
9D025A68  02602821   ADDU A1, S3, ZERO
9D025A6C  1440FFD4   BNE V0, ZERO, 0x9D0259C0
9D025A70  24040009   ADDIU A0, ZERO, 9
737:                 			{
738:                 			//Complete row found, record in complete_lines[]
739:                 			if (board_cols == BOX_BOARD_RIGHT) complete_lines[temp_index++] = board_rows;
9D0259AC  27A30010   ADDIU V1, SP, 16
9D0259B0  00722021   ADDU A0, V1, S2
9D0259B4  A0930000   SB S3, 0(A0)
9D0259B8  0B409674   J 0x9D0259D0
9D0259BC  305200FF   ANDI S2, V0, 255
740:                 			++board_cols;
741:                 			}
742:                 		}
743:                 	if (temp_index == 0) return;  //No complete lines found, return
9D025A7C  12400040   BEQ S2, ZERO, 0x9D025B80
9D025A80  8FBF003C   LW RA, 60(SP)
744:                 
745:                 
746:                 	//If there are complete rows
747:                 		//TODO: Disable interrupts to pause game flow
748:                 		//TODO: Add an arbitrary delay, perhaps make complete lines flash?
749:                 
750:                 	score += temp_index; //Add the completed rows to our score
9D025A84  93858079   LBU A1, -32647(GP)
9D025A88  02453021   ADDU A2, S2, A1
9D025A8C  A3868079   SB A2, -32647(GP)
751:                 
752:                 	--temp_index;	//This was incremented one too many times earlier, get it back to the proper index.
9D025A90  2647FFFF   ADDIU A3, S2, -1
9D025A94  30F600FF   ANDI S6, A3, 255
753:                 
754:                 	//Rewrite BOX_location[] data without completed lines
755:                 	uint8_t read_from_row = BOX_BOARD_BOTTOM;
9D025AA4  24120013   ADDIU S2, ZERO, 19
756:                 	uint8_t write_to_row = BOX_BOARD_BOTTOM;
9D025AA0  24110013   ADDIU S1, ZERO, 19
757:                 
758:                 	//When we have read from all rows, this will be set to 0 and
759:                 	//remaining bits cleared from BOX_location[]
760:                 	uint8_t rows_left_to_read = 1;
9D025A9C  24130001   ADDIU S3, ZERO, 1
761:                 
762:                 	//Use variable i to iterate through every row of the board
763:                 	uint8_t i=0;
9D025A98  0000A821   ADDU S5, ZERO, ZERO
764:                 	while (i <= BOX_BOARD_BOTTOM)
9D025B60  2EAF0014   SLTIU T7, S5, 20
9D025B64  15E0FFD3   BNE T7, ZERO, 0x9D025AB4
9D025B68  27A80010   ADDIU T0, SP, 16
765:                 		{
766:                 		//If the current row is a complete line
767:                 		if (read_from_row == complete_lines[temp_index])
9D025AB0  27A80010   ADDIU T0, SP, 16
9D025AB4  01164821   ADDU T1, T0, S6
9D025AB8  912A0000   LBU T2, 0(T1)
9D025ABC  1552000C   BNE T2, S2, 0x9D025AF0
9D025AC0  00008021   ADDU S0, ZERO, ZERO
768:                 			{
769:                 			//Decrement indexes
770:                 			if (read_from_row == 0)
9D025AC4  15400005   BNE T2, ZERO, 0x9D025ADC
9D025AC8  254EFFFF   ADDIU T6, T2, -1
771:                 				{
772:                 				rows_left_to_read = 0;
9D025AD0  00009821   ADDU S3, ZERO, ZERO
9D025AD4  0B4096D8   J 0x9D025B60
9D025AD8  00009021   ADDU S2, ZERO, ZERO
773:                 
774:                 				//Change complete_lines[0] so we don't do this again
775:                 				complete_lines[0] = BOX_BOARD_BOTTOM;
9D025AAC  24170013   ADDIU S7, ZERO, 19
9D025ACC  A3B70010   SB S7, 16(SP)
776:                 				}
777:                 			else
778:                 				{
779:                 				--read_from_row;
780:                 				if (temp_index) --temp_index;
9D025ADC  12C00020   BEQ S6, ZERO, 0x9D025B60
9D025AE0  31D200FF   ANDI S2, T6, 255
9D025AE4  26D6FFFF   ADDIU S6, S6, -1
9D025AE8  0B4096D8   J 0x9D025B60
9D025AEC  32D600FF   ANDI S6, S6, 255
781:                 				}
782:                 			}
783:                 
784:                 		else
785:                 			{
786:                 			//Write data to all columns of current row
787:                 			uint8_t col;
788:                 			for (col=0; col<=BOX_BOARD_RIGHT; col++)
9D025AA8  2414000A   ADDIU S4, ZERO, 10
9D025B20  0B4096CD   J 0x9D025B34
9D025B24  260B0001   ADDIU T3, S0, 1
9D025B30  260B0001   ADDIU T3, S0, 1
9D025B34  317000FF   ANDI S0, T3, 255
9D025B38  1614FFED   BNE S0, S4, 0x9D025AF0
9D025B3C  00000000   NOP
789:                 				{
790:                 				//If there are rows left to read from, do so.
791:                 				if (rows_left_to_read)
9D025AF0  1260000D   BEQ S3, ZERO, 0x9D025B28
9D025AF4  02002021   ADDU A0, S0, ZERO
792:                 					{
793:                 					if (BOX_loc_return_bit(col,read_from_row)) BOX_loc_set_bit(col, write_to_row);
9D025AF8  0F4092E5   JAL BOX_loc_return_bit
9D025AFC  02402821   ADDU A1, S2, ZERO
9D025B00  10400005   BEQ V0, ZERO, 0x9D025B18
9D025B04  02002021   ADDU A0, S0, ZERO
9D025B08  0F4092F3   JAL BOX_loc_set_bit
9D025B0C  02202821   ADDU A1, S1, ZERO
9D025B10  0B4096CD   J 0x9D025B34
9D025B14  260B0001   ADDIU T3, S0, 1
794:                 					else BOX_loc_clear_bit(col, write_to_row);
9D025B18  0F409303   JAL BOX_loc_clear_bit
9D025B1C  02202821   ADDU A1, S1, ZERO
795:                 					}
796:                 				//There are no rows left to read from, fill with 0
797:                 				else
798:                 					{
799:                 					BOX_loc_clear_bit(col, write_to_row);
9D025B28  0F409303   JAL BOX_loc_clear_bit
9D025B2C  02202821   ADDU A1, S1, ZERO
800:                 					}
801:                 				}
802:                 
803:                 			//A row has now been read from, decrement the counter
804:                 			if (read_from_row) --read_from_row;
9D025B40  52400003   BEQL S2, ZERO, 0x9D025B50
9D025B44  00009821   ADDU S3, ZERO, ZERO
9D025B48  264CFFFF   ADDIU T4, S2, -1
9D025B4C  319200FF   ANDI S2, T4, 255
805:                 			else rows_left_to_read = 0;
806:                 
807:                 			//A row has now been written to, increment the counter, decrement the tracker
808:                 			++i;
9D025B50  26B50001   ADDIU S5, S5, 1
9D025B54  32B500FF   ANDI S5, S5, 255
809:                 			--write_to_row;
9D025B58  262DFFFF   ADDIU T5, S1, -1
9D025B5C  31B100FF   ANDI S1, T5, 255
810:                 			}
811:                 		}
812:                 
813:                 	BOX_rewrite_display(DEFAULT_STONE_COLOR);
9D025B6C  0F40946B   JAL BOX_rewrite_display
9D025B70  3404FF00   ORI A0, ZERO, -256
814:                 	BOX_update_score();
9D025B74  0F4092A2   JAL BOX_update_score
9D025B78  00000000   NOP
815:                 	}
9D025B7C  8FBF003C   LW RA, 60(SP)
9D025B80  8FB70038   LW S7, 56(SP)
9D025B84  8FB60034   LW S6, 52(SP)
9D025B88  8FB50030   LW S5, 48(SP)
9D025B8C  8FB4002C   LW S4, 44(SP)
9D025B90  8FB30028   LW S3, 40(SP)
9D025B94  8FB20024   LW S2, 36(SP)
9D025B98  8FB10020   LW S1, 32(SP)
9D025B9C  8FB0001C   LW S0, 28(SP)
9D025BA0  03E00008   JR RA
9D025BA4  27BD0040   ADDIU SP, SP, 64
816:                 
817:                 
818:                 void BOX_up(void)
819:                 	{
9D025BA8  27BDFFE8   ADDIU SP, SP, -24
9D025BAC  AFBF0014   SW RA, 20(SP)
820:                 	BOX_clear_loc();
9D025BB0  0F40936B   JAL BOX_clear_loc
9D025BB4  00000000   NOP
821:                 	BOX_clear_piece();
9D025BB8  0F409420   JAL BOX_clear_piece
9D025BBC  00000000   NOP
822:                 
823:                 	if (++cur_piece > 6) cur_piece = 0;
9D025BC0  9382807B   LBU V0, -32645(GP)
9D025BC4  24430001   ADDIU V1, V0, 1
9D025BC8  306400FF   ANDI A0, V1, 255
9D025BCC  2C850007   SLTIU A1, A0, 7
9D025BD0  50A00002   BEQL A1, ZERO, 0x9D025BDC
9D025BD4  A380807B   SB ZERO, -32645(GP)
9D025BD8  A384807B   SB A0, -32645(GP)
824:                 	x_loc = 4;
9D025BDC  24060004   ADDIU A2, ZERO, 4
9D025BE0  A38681C4   SB A2, -32316(GP)
825:                 	y_loc = 0;
826:                 
827:                 	BOX_spawn();
9D025BE4  0F409628   JAL BOX_spawn
9D025BE8  A38081CC   SB ZERO, -32308(GP)
828:                 	}
9D025BEC  8FBF0014   LW RA, 20(SP)
9D025BF0  03E00008   JR RA
9D025BF4  27BD0018   ADDIU SP, SP, 24
829:                 
830:                 void BOX_dn(void)
831:                 	{
9D025BF8  27BDFFE8   ADDIU SP, SP, -24
9D025BFC  AFBF0014   SW RA, 20(SP)
832:                 	if (BOX_check(0, 1))
9D025C00  00002021   ADDU A0, ZERO, ZERO
9D025C04  0F40957F   JAL BOX_check
9D025C08  24050001   ADDIU A1, ZERO, 1
9D025C0C  1040000B   BEQ V0, ZERO, 0x9D025C3C
9D025C10  00000000   NOP
833:                 		{
834:                 		//Set piece here and spawn a new one
835:                 		BOX_rewrite_display(DEFAULT_STONE_COLOR);
9D025C14  0F40946B   JAL BOX_rewrite_display
9D025C18  3404FF00   ORI A0, ZERO, -256
836:                 		BOX_line_check();
9D025C1C  0F40965D   JAL BOX_line_check
9D025C20  00000000   NOP
837:                 		BOX_spawn();
9D025C24  0F409628   JAL BOX_spawn
9D025C28  00000000   NOP
838:                 		BOX_update_score();
9D025C2C  0F4092A2   JAL BOX_update_score
9D025C30  00000000   NOP
839:                 		return;
9D025C34  0B40971A   J 0x9D025C68
9D025C38  8FBF0014   LW RA, 20(SP)
840:                 		}
841:                 
842:                 	BOX_clear_loc();
9D025C3C  0F40936B   JAL BOX_clear_loc
9D025C40  00000000   NOP
843:                 	BOX_clear_piece();
9D025C44  0F409420   JAL BOX_clear_piece
9D025C48  00000000   NOP
844:                 	++y_loc;
9D025C4C  938281CC   LBU V0, -32308(GP)
9D025C50  24430001   ADDIU V1, V0, 1
845:                 
846:                 	BOX_store_loc();
9D025C54  0F409314   JAL BOX_store_loc
9D025C58  A38381CC   SB V1, -32308(GP)
847:                 	BOX_write_piece();
9D025C5C  0F4093D1   JAL BOX_write_piece
9D025C60  00000000   NOP
848:                 	BOX_update_screen();
849:                 	}
9D025C64  8FBF0014   LW RA, 20(SP)
9D025C68  03E00008   JR RA
9D025C6C  27BD0018   ADDIU SP, SP, 24
850:                 
851:                 void BOX_lt(void)
852:                 	{
9D025C70  27BDFFE8   ADDIU SP, SP, -24
9D025C74  AFBF0014   SW RA, 20(SP)
853:                 	if (BOX_check(-1, 0)) return; //Do nothing if moving causes an overlap
9D025C78  2404FFFF   ADDIU A0, ZERO, -1
9D025C7C  0F40957F   JAL BOX_check
9D025C80  00002821   ADDU A1, ZERO, ZERO
9D025C84  1440000C   BNE V0, ZERO, 0x9D025CB8
9D025C88  8FBF0014   LW RA, 20(SP)
854:                 	BOX_clear_loc();
9D025C8C  0F40936B   JAL BOX_clear_loc
9D025C90  00000000   NOP
855:                 	BOX_clear_piece();
9D025C94  0F409420   JAL BOX_clear_piece
9D025C98  00000000   NOP
856:                 	x_loc--;
9D025C9C  938281C4   LBU V0, -32316(GP)
9D025CA0  2443FFFF   ADDIU V1, V0, -1
857:                 
858:                 	BOX_store_loc();
9D025CA4  0F409314   JAL BOX_store_loc
9D025CA8  A38381C4   SB V1, -32316(GP)
859:                 	BOX_write_piece();
9D025CAC  0F4093D1   JAL BOX_write_piece
9D025CB0  00000000   NOP
860:                 	BOX_update_screen();
861:                 	}
9D025CB4  8FBF0014   LW RA, 20(SP)
9D025CB8  03E00008   JR RA
9D025CBC  27BD0018   ADDIU SP, SP, 24
862:                 
863:                 void BOX_rt(void)
864:                 	{
9D025CC0  27BDFFE8   ADDIU SP, SP, -24
9D025CC4  AFBF0014   SW RA, 20(SP)
865:                 	if (BOX_check(1, 0)) return; //Do nothing if moving causes an overlap
9D025CC8  24040001   ADDIU A0, ZERO, 1
9D025CCC  0F40957F   JAL BOX_check
9D025CD0  00002821   ADDU A1, ZERO, ZERO
9D025CD4  1440000C   BNE V0, ZERO, 0x9D025D08
9D025CD8  8FBF0014   LW RA, 20(SP)
866:                 	BOX_clear_loc();
9D025CDC  0F40936B   JAL BOX_clear_loc
9D025CE0  00000000   NOP
867:                 	BOX_clear_piece();
9D025CE4  0F409420   JAL BOX_clear_piece
9D025CE8  00000000   NOP
868:                 	++x_loc;
9D025CEC  938281C4   LBU V0, -32316(GP)
9D025CF0  24430001   ADDIU V1, V0, 1
869:                 
870:                 	BOX_store_loc();
9D025CF4  0F409314   JAL BOX_store_loc
9D025CF8  A38381C4   SB V1, -32316(GP)
871:                 	BOX_write_piece();
9D025CFC  0F4093D1   JAL BOX_write_piece
9D025D00  00000000   NOP
872:                 	BOX_update_screen();
873:                 	}
9D025D04  8FBF0014   LW RA, 20(SP)
9D025D08  03E00008   JR RA
9D025D0C  27BD0018   ADDIU SP, SP, 24
---  /Users/nitro/basic-badge/firmware/badge1.X/src/badge.c  --------------------------------------------
1:                   #include <xc.h>
2:                   #include "badge.h"
3:                   #include "basic/ubasic.h"
4:                   #include "basic/tokenizer.h"
5:                   #include <plib.h>
6:                   #include <stdlib.h>
7:                   #include <string.h>
8:                   #include <stdio.h>
9:                   #include <ctype.h>
10:                  #include <stdint.h>
11:                  #include <setjmp.h>
12:                  #include "Z80/sim.h"
13:                  #include "Z80/simglb.h"
14:                  
15:                  
16:                  
17:                  uint16_t basic_loads (int8_t * data, uint16_t maxlen);
18:                  uint16_t basic_saves (int8_t * data, uint16_t maxlen);
19:                  void init_z80_cpm (void);
20:                  void init_basic (void);
21:                  void init_userprog(void);
22:                  void loop_z80_cpm (void);
23:                  void loop_basic (void);
24:                  void loop_userprog(void);
25:                  void boot_animation(void);
26:                  void init_8080_basic (void);
27:                  void loop_8080_basic (void);
28:                  uint8_t cmd_exec (int8_t * cmd);
29:                  uint8_t basic_save_program (uint8_t * data, uint8_t slot);
30:                  uint8_t basic_load_program (uint8_t * data, uint8_t slot);
31:                  uint16_t get_free_mem(uint8_t * prog, uint16_t max_mem);
32:                  uint8_t add_prog_line (int8_t * line, int8_t * prog, int16_t linenum);
33:                  void list_more (void);
34:                  void menu(void);
35:                  void show_help(void);
36:                  uint32_t hash(int8_t *);
37:                  uint8_t get_command_index(uint32_t );
38:                  uint8_t wisecrack(int8_t *, uint16_t , unsigned char, uint8_t);
39:                  void clear_crack(void);
40:                  uint8_t random_crack(void);
41:                  void showmenu(void);
42:                  void show_version(void);
43:                  void fancyframe(void);
44:                  void clear_prompt(void);
45:                  void show_wrencher(void);
46:                  uint8_t playriff(unsigned char);
47:                  
48:                  /************ Defines ****************************/
49:                  #define STDIO_LOCAL_BUFF_SIZE	25
50:                  
51:                  //Prompt handling defines
52:                  #define COMMAND_MAX 32
53:                  #define TEXT_LEFT	4
54:                  #define PROMPT_Y	15
55:                  #define CRACK_Y		17
56:                  #define VERSION_X	33
57:                  #define VERSION_Y	18
58:                  #define CRACK_TIMEOUT 4000
59:                  //Menu color values
60:                  #define MENU_FRAME_FG	12
61:                  #define MENU_FRAME_BG	0
62:                  #define MENU_BANNER_FG	0
63:                  #define MENU_BANNER_BG	15
64:                  #define MENU_HEADER_FG	15
65:                  #define MENU_HEADER_BG	8
66:                  #define MENU_ENTRY_FG	15
67:                  #define MENU_ENTRY_BG	9
68:                  #define MENU_DEFAULT_FG 15
69:                  #define MENU_DEFAULT_BG 0
70:                  #define MENU_VERSION_FG	8
71:                  #define MENU_SECRET_COLOR 10
72:                  #define MENU_CRACK_COLOR 14
73:                  /********** End Defines **************************/
74:                  
75:                  /************* Function Prototypes ***************/
76:                  /*** End Function Prototypes **********************88*/
77:                  
78:                  int8_t bprog[BPROG_LEN+1];
79:                  int8_t bprog_init[700] =
80:                  "10 c = 1 + rnd 4\n\
81:                  20 color c,c+8\n\
82:                  30 for i=1 to 800\n\
83:                  40 chr 200 + (rnd 6)\n\
84:                  50 next i\n\
85:                  60 wait 100\n\
86:                  70 tune 60,64,67,800\n\
87:                  80 tune 57,62,66,800\n\
88:                  90 tune 59,64,47,800\n\
89:                  100 tune 59,62,67,800\n\
90:                  110 for i=60 to 72\n\
91:                  120 led (rnd 2),1\n\
92:                  130 led (rnd 2),0\n\
93:                  140 tune 0,0,i,20\n\
94:                  150 next i\n\
95:                  160 tune 67,71,74,1600\n\
96:                  170 for i=0 to 2\n\
97:                  180 led i,0\n\
98:                  190 next i\n\
99:                  200 color 15,0\n\
100:                 210 println \"Type more to see code\"\n\
101:                 220 println \" \"\n\
102:                 230 println \"Find documentation: hac.io/Mz3r \" \n";
103:                 
104:                 //a lot of magic numbers here, should be done properly
105:                 int8_t tprog[100],stdio_buff[50],key_buffer[10],char_out, stdio_local_buff[STDIO_LOCAL_BUFF_SIZE];
106:                 
107:                 uint8_t get_stat,key_buffer_ptr =0,cmd_line_buff[30], cmd_line_pointer,cmd_line_key_stat_old,prompt;
108:                 uint8_t stdio_local_len=0;
109:                 uint16_t term_pointer,vertical_shift;
110:                 int16_t prog_ptr;
111:                 int32_t i,j,len;
112:                 jmp_buf jbuf;
113:                 volatile uint8_t handle_display = 1;
114:                 volatile int8_t brk_key,stdio_src;
115:                 extern volatile uint16_t bufsize;
116:                 volatile uint32_t ticks;			// millisecond timer incremented in ISR
117:                 
118:                 extern const uint8_t ram_image[65536];
119:                 extern const uint8_t b2_rom[2048];
120:                 extern const uint8_t ram_init [30];
121:                 extern uint8_t ram_disk[RAMDISK_SIZE];
122:                 
123:                 
124:                 int8_t disp_buffer[DISP_BUFFER_HIGH+1][DISP_BUFFER_WIDE];
125:                 int8_t color_buffer[DISP_BUFFER_HIGH+1][DISP_BUFFER_WIDE];
126:                 
127:                 #define HASH_TABLE_LENGTH	13
128:                 const uint32_t  hashtable[HASH_TABLE_LENGTH] =
129:                 	{
130:                 	0,				//0
131:                 	0,				//1
132:                 	4080429,		//2
133:                 	3914880981u,	//3
134:                 	1670,			//4
135:                 	121730,			//5
136:                 	4108351,		//6
137:                 	138097304,		//7
138:                 	110149,			//8
139:                 	3174374908u,	//9
140:                 	132593272,		//10
141:                 	2802956003u,	//11
142:                 	3638929			//12
143:                 	};
144:                 
145:                 const uint8_t wrencher[18][41] = {
146:                 "    +mmy/                      /ymm+    ",
147:                 "      sMMh                    hMMs      ",
148:                 "h/  .hMMMM.                  -MMMMh.  /h",
149:                 "sMmyMMMMMMNo`              `oNMMMMMMymMs",
150:                 " :hNMMMMMMMMMo`:shmNNmhs:`oMMMMMMMMMNh: ",
151:                 "       :hMMN+sNMMMMMMMMMMNo+NMMh:       ",
152:                 "         -s:mMMMMMMMMMMMMMMm:s.         ",
153:                 "          `mMMMMMMMMMMMMMMMMm`          ",
154:                 "          +MMh.  -mMMd-  .hMM/          ",
155:                 "          oMM.  -+NMMN+-  .MMo          ",
156:                 "          -MMd/NMMMmmMMMN/dMM-          ",
157:                 "         -/sMMMMMMM::MMMMMMMs/-         ",
158:                 "       /dMMsoMMMMMMNNMMMMMNosMMd/       ",
159:                 " :hNMMMMMMMMd-hMMMMMMMMMMh-dMMMMMMMMNy: ",
160:                 "sMmyMMMMMMm+` /mNsoNm+sNm/ `omMMMMMNymMo",
161:                 "h:  .yMMMM.                  .MMMMy.  :h",
162:                 "      sMMh                    hMMs      ",
163:                 "   `ommh/                      /hmm+    "};
164:                 
165:                 const uint8_t rand_crack00[] = "Have you been into Branko's rakija?";
166:                 const uint8_t rand_crack01[] = "Prove you're human: 0b101010";
167:                 const uint8_t rand_crack02[] = "I don't think that mean what you think it means.";
168:                 const uint8_t rand_crack03[] = "Want to play a game?";
169:                 const uint8_t rand_crack04[] = "How do I get 30 extra live?";
170:                 const uint8_t rand_crack05[] = "Maybe you should RTFM: https://hac.io/Mz3r";
171:                 const uint8_t rand_crack06[] = "Erm... It's supposed to do that";
172:                 const uint8_t rand_crack07[] = "Too many errors on one line (make fewer)";
173:                 const uint8_t rand_crack08[] = "You are in a maze of twisty compiler features, all different";
174:                 const uint8_t rand_crack09[] = "Parse error: unexpected idoiot at the keyboard";
175:                 const uint8_t rand_crack10[] = "Program Lost -- Sorry.";
176:                 const uint8_t rand_crack11[] = "I find your lack of faith disturbing";
177:                 const uint8_t rand_crack12[] = "There are people who know what they're doing, then there's you";
178:                 const uint8_t rand_crack13[] = "My brain just exploded.";
179:                 const uint8_t rand_crack14[] = "You can't just start making up commands";
180:                 const uint8_t rand_crack15[] = "Try restarting shockwave";
181:                 const uint8_t rand_crack16[] = "That really grinds my ALU";
182:                 const uint8_t rand_crack17[] = "Erq ureevat";
183:                 const uint8_t rand_crack18[] = "I'm drawing a blank";
184:                 const uint8_t blanks[] = "                                      ";
185:                 
186:                 #define CRACKCOUNT 19
187:                 const uint8_t * cracks[CRACKCOUNT] =
188:                 	{
189:                 	rand_crack00,
190:                 	rand_crack01,
191:                 	rand_crack02,
192:                 	rand_crack03,
193:                 	rand_crack04,
194:                 	rand_crack05,
195:                 	rand_crack06,
196:                 	rand_crack07,
197:                 	rand_crack08,
198:                 	rand_crack09,
199:                 	rand_crack10,
200:                 	rand_crack11,
201:                 	rand_crack12,
202:                 	rand_crack13,
203:                 	rand_crack14,
204:                 	rand_crack15,
205:                 	rand_crack16,
206:                 	rand_crack17,
207:                 	rand_crack18
208:                 	};
209:                 
210:                 void show_help(void)
211:                 	{
9D01D538  27BDFFE8   ADDIU SP, SP, -24
9D01D53C  AFBF0014   SW RA, 20(SP)
212:                 	clr_buffer();
9D01D540  0F4073DA   JAL clr_buffer
9D01D544  00000000   NOP
213:                 	set_cursor_state(0);
9D01D548  0F406196   JAL set_cursor_state
9D01D54C  00002021   ADDU A0, ZERO, ZERO
214:                 	video_gotoxy(0,0);
9D01D550  00002021   ADDU A0, ZERO, ZERO
9D01D554  0F406D09   JAL video_gotoxy
9D01D558  00002821   ADDU A1, ZERO, ZERO
215:                 	video_set_color(3,1);
9D01D55C  24040003   ADDIU A0, ZERO, 3
9D01D560  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01D564  24050001   ADDIU A1, ZERO, 1
216:                 	stdio_write("Badge keyboard shortcuts:\n");
9D01D568  3C049D03   LUI A0, -25341
9D01D56C  0F40751F   JAL stdio_write
9D01D570  2484F3FC   ADDIU A0, A0, -3076
217:                 	video_set_color(15,0);
9D01D574  2404000F   ADDIU A0, ZERO, 15
9D01D578  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01D57C  00002821   ADDU A1, ZERO, ZERO
218:                 	stdio_write("  Reset badge : shift-RESET\n");
9D01D580  3C029D03   LUI V0, -25341
9D01D584  0F40751F   JAL stdio_write
9D01D588  2444F418   ADDIU A0, V0, -3048
219:                 	stdio_write("  Type underscore: Rshift-dash\n");
9D01D58C  3C039D03   LUI V1, -25341
9D01D590  0F40751F   JAL stdio_write
9D01D594  2464F438   ADDIU A0, V1, -3016
220:                 	stdio_write("  Fast reset: Lshift-Rshift-RESET\n");
9D01D598  3C059D03   LUI A1, -25341
9D01D59C  0F40751F   JAL stdio_write
9D01D5A0  24A4F458   ADDIU A0, A1, -2984
221:                 	stdio_write("  Serial console: Lshift-Rshift-BRK\n");
9D01D5A4  3C069D03   LUI A2, -25341
9D01D5A8  0F40751F   JAL stdio_write
9D01D5AC  24C4F47C   ADDIU A0, A2, -2948
222:                 	video_set_color(1,11);
9D01D5B0  24040001   ADDIU A0, ZERO, 1
9D01D5B4  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01D5B8  2405000B   ADDIU A1, ZERO, 11
223:                 	stdio_write("Badge Documentation:\n");
9D01D5BC  3C079D03   LUI A3, -25341
9D01D5C0  0F40751F   JAL stdio_write
9D01D5C4  24E4F4A4   ADDIU A0, A3, -2908
224:                 	video_set_color(15,0);
9D01D5C8  2404000F   ADDIU A0, ZERO, 15
9D01D5CC  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01D5D0  00002821   ADDU A1, ZERO, ZERO
225:                 	stdio_write("  hac.io/Mz3r");
9D01D5D4  3C089D03   LUI T0, -25341
9D01D5D8  0F40751F   JAL stdio_write
9D01D5DC  2504F4BC   ADDIU A0, T0, -2884
226:                 	}
9D01D5E0  8FBF0014   LW RA, 20(SP)
9D01D5E4  03E00008   JR RA
9D01D5E8  27BD0018   ADDIU SP, SP, 24
227:                 
228:                 //B_BDG005
229:                 void wake_return(void)
230:                 	{
9D01CC3C  03E00008   JR RA
9D01CC40  00000000   NOP
231:                 	//By default, this will be called after waking from sleep. It should do
232:                 	//noting. This is a placeholder for user programs to set the function pointer.
233:                 	return;
234:                 	}
235:                 
236:                 void badge_init (void)
237:                 	{
238:                 	//B_BDG009
239:                 //	start_after_wake = &wake_return; //Function pointer for waking from sleep
240:                 	ticks = 0;
9D01CC44  AF8081E8   SW ZERO, -32280(GP)
241:                 	stdio_src = STDIO_LOCAL;
9D01CC48  A38081D9   SB ZERO, -32295(GP)
242:                 //	stdio_src = STDIO_TTY1;
243:                 //	term_init();
244:                 //	strcpy(bprog,bprog_init);
245:                 //	set_cursor_state(1);
246:                     handle_display = 0;
9D01CC4C  A3808014   SB ZERO, -32748(GP)
9D01CC50  03E00008   JR RA
9D01CC54  00000000   NOP
247:                 	}
248:                 
249:                 ////B_BDG002
250:                 //void badge_menu(void)
251:                 //	{
252:                 //	showmenu();
253:                 //	
254:                 //	int8_t char_out;
255:                 //	uint8_t menu_buff[COMMAND_MAX], menu_pointer;
256:                 //	menu_pointer=0;
257:                 //	int16_t len, i;
258:                 //	uint8_t clear_flag = 0;
259:                 //	uint32_t  wait_to_clear = 0;
260:                 //	
261:                 //	uint8_t random_has_been_seeded = 0;
262:                 //	
263:                 //	while (1)
264:                 //		{
265:                 //		if (clear_flag)
266:                 //			{
267:                 //			if (millis() > wait_to_clear)
268:                 //				{
269:                 //				clear_flag = 0;
270:                 //				clear_crack();
271:                 //				}
272:                 //			}
273:                 //		uint8_t get_stat = stdio_get(&char_out);
274:                 //		if (get_stat!=0)
275:                 //			{
276:                 //			
277:                 //			//Seed random number if we haven't already
278:                 //			if (random_has_been_seeded == 0)
279:                 //				{
280:                 //				//Pull seed directly from TIMER1 register
281:                 //				srand(*(char*)0xBF800610);
282:                 //				++random_has_been_seeded;
283:                 //				}
284:                 //			if (char_out==K_UP) char_out='U';
285:                 //			if (char_out==K_DN) char_out='D';
286:                 //			if (char_out==K_LT) char_out='L';
287:                 //			if (char_out==K_RT) char_out='R';
288:                 //			stdio_c(char_out);
289:                 //			if (char_out==BACKSPACE)
290:                 //				{
291:                 //				if (menu_pointer)
292:                 //					{
293:                 //					//We only need to do this if we're not at position 0
294:                 //					--menu_pointer;
295:                 //					menu_buff[menu_pointer] = 0;
296:                 //					int16_t cursorx, cursory;
297:                 //					cursorx = video_getx();
298:                 //					cursory = video_gety();
299:                 //					stdio_write(" ");
300:                 //					video_gotoxy(cursorx, cursory);
301:                 //					}
302:                 //				else
303:                 //					{
304:                 //					//Don't let backspace key move left of input position
305:                 //					video_gotoxy(TEXT_LEFT+2,PROMPT_Y);
306:                 //					}
307:                 //				}
308:                 //			else if (char_out==NEWLINE)
309:                 //				{
310:                 //				//Erase where the funny messages are written
311:                 //				clear_crack();
312:                 //							
313:                 //				menu_buff[menu_pointer] = 0;	//add zero terminator
314:                 //				//Check entry and react
315:                 //				
316:                 //				if (menu_buff[0] == 0)
317:                 //					{
318:                 //					//No characters were input, this stops user from just
319:                 //					//hitting enter to display all funny messages
320:                 //					clear_prompt();
321:                 //					menu_pointer = 0;
322:                 //					continue;
323:                 //					}
324:                 //				if (strcmp(menu_buff,"1")==0)
325:                 //					{
326:                 //					video_clrscr();
327:                 //					init_basic();
328:                 //					while (1) loop_basic();
329:                 //					}
330:                 //				else if (strcmp(menu_buff,"2")==0)
331:                 //					{
332:                 //					video_clrscr();
333:                 //					init_z80_cpm();
334:                 //					while (1) loop_z80_cpm();
335:                 //					}			
336:                 //				else if (strcmp(menu_buff,"3")==0)
337:                 //					{
338:                 //					init_8080_basic();
339:                 //					while (1) loop_8080_basic();
340:                 //					}
341:                 //				else if (strcmp(menu_buff,"4")==0)
342:                 //					{
343:                 //					enable_display_scanning(0); //Shut off auto-scanning of character buffer
344:                 //					tetrapuzz();
345:                 //					}
346:                 //				//B_BDG006		
347:                 //				else if (strcmp(menu_buff,"5")==0)
348:                 //					{
349:                 //					stdio_local_buffer_puts("c:\nzork1\n");
350:                 //					video_clrscr();
351:                 //					video_set_color(0,14);
352:                 //					stdio_write("\n\n\n\n\n\nPROTIP:\n\tUse Shift-Enter when playing ZORK!\n\n");
353:                 //					video_set_color(15,0);
354:                 //					wait_ms(2000);
355:                 //					init_z80_cpm();
356:                 //					while (1) loop_z80_cpm();
357:                 //					}
358:                 //				else if (strcmp(menu_buff,"6")==0)
359:                 //					{
360:                 //					init_userprog();
361:                 //					while (1) loop_userprog();
362:                 //					}	
363:                 //				else
364:                 //					{
365:                 //					switch (get_command_index(hash(menu_buff)))
366:                 //						{
367:                 //						//case 0: break;
368:                 //						case 2: clear_flag = wisecrack("Make your own sandwich",TEXT_LEFT,CRACK_Y, 0); break;
369:                 //						case 3: clear_flag = wisecrack("Existence itself is not a hack", TEXT_LEFT,CRACK_Y, 0); break;
370:                 //						case 4: clear_flag = wisecrack("101010 *IS* the answer", TEXT_LEFT,CRACK_Y, 0); break;
371:                 //						case 5: clear_flag = wisecrack("Hackers don't need manuals", TEXT_LEFT,CRACK_Y, 0); break;
372:                 //						case 6: clear_flag = wisecrack("Han shot first", TEXT_LEFT,CRACK_Y, 0); break;
373:                 //						case 7: clear_flag = wisecrack("You're in a room filled with hackers", TEXT_LEFT,CRACK_Y, 0); break;
374:                 //						case 8: clear_flag = wisecrack("I am afraid I can't do that Dave", TEXT_LEFT,CRACK_Y, 0); break;
375:                 //						case 9: show_wrencher(); break;
376:                 //						case 10: play_mario_tune(); break;
377:                 //						case 11: 
378:                 //							handle_display = 0;
379:                 //							play_snake();
380:                 //							break;
381:                 //						case 12: show_help(); while(1) { ;; };
382:                 //						default: clear_flag = random_crack(); break;
383:                 //						}
384:                 //					}
385:                 //
386:                 //				
387:                 //				clear_prompt();
388:                 //				menu_pointer = 0;
389:                 //				menu_buff[menu_pointer] = 0;
390:                 //				}
391:                 //				
392:                 //			else
393:                 //				{
394:                 //				menu_buff[menu_pointer++] = char_out;
395:                 //				if (menu_pointer >= COMMAND_MAX-1) 
396:                 //					{
397:                 //					menu_pointer = 0;
398:                 //					menu_buff[menu_pointer] = 0;
399:                 //					clear_flag = wisecrack("Boo, too big.",TEXT_LEFT,CRACK_Y,1);
400:                 //					clear_prompt();
401:                 //					}
402:                 //				}
403:                 //			if (clear_flag)
404:                 //				{
405:                 //				wait_to_clear = millis() + CRACK_TIMEOUT;
406:                 //				}
407:                 //			}
408:                 //		}
409:                 //	}
410:                 
411:                 uint32_t  hash(int8_t *command)
412:                 	{
9D01CC58  24860066   ADDIU A2, A0, 102
413:                 	uint32_t  hash = 0;
414:                 	uint8_t infinite_loop_breaker = 0;
415:                 	uint8_t c;
416:                 	while (c = *command++)
9D01CC5C  24830001   ADDIU V1, A0, 1
9D01CC60  9064FFFF   LBU A0, -1(V1)
9D01CC64  1480000F   BNE A0, ZERO, 0x9D01CCA4
9D01CC68  00001021   ADDU V0, ZERO, ZERO
9D01CC6C  03E00008   JR RA
9D01CC70  00000000   NOP
9D01CC78  914E0000   LBU T6, 0(T2)
9D01CC7C  15C00013   BNE T6, ZERO, 0x9D01CCCC
9D01CC80  01AB1026   XOR V0, T5, T3
9D01CC84  03E00008   JR RA
9D01CC88  00000000   NOP
9D01CC8C  254A0001   ADDIU T2, T2, 1
9D01CC90  914BFFFF   LBU T3, -1(T2)
9D01CC94  1560FFF7   BNE T3, ZERO, 0x9D01CC74
9D01CC98  00026140   SLL T4, V0, 5
9D01CC9C  03E00008   JR RA
9D01CCA0  00000000   NOP
9D01CCAC  246A0001   ADDIU T2, V1, 1
9D01CCB0  9147FFFF   LBU A3, -1(T2)
9D01CCB4  10E0FFED   BEQ A3, ZERO, 0x9D01CC6C
9D01CCB8  00441026   XOR V0, V0, A0
9D01CCD4  91590001   LBU T9, 1(T2)
9D01CCD8  1320FFE4   BEQ T9, ZERO, 0x9D01CC6C
9D01CCDC  030E1026   XOR V0, T8, T6
9D01CCE8  91470002   LBU A3, 2(T2)
9D01CCEC  10E0FFDF   BEQ A3, ZERO, 0x9D01CC6C
9D01CCF0  00991026   XOR V0, A0, T9
9D01CCFC  91480003   LBU T0, 3(T2)
9D01CD00  1100FFDA   BEQ T0, ZERO, 0x9D01CC6C
9D01CD04  00471026   XOR V0, V0, A3
9D01CD10  914C0004   LBU T4, 4(T2)
9D01CD14  1180FFD5   BEQ T4, ZERO, 0x9D01CC6C
9D01CD18  01681026   XOR V0, T3, T0
9D01CD24  914F0005   LBU T7, 5(T2)
9D01CD28  11E0FFD0   BEQ T7, ZERO, 0x9D01CC6C
9D01CD2C  01CC1026   XOR V0, T6, T4
9D01CD38  91430006   LBU V1, 6(T2)
9D01CD3C  1060FFCB   BEQ V1, ZERO, 0x9D01CC6C
9D01CD40  032F1026   XOR V0, T9, T7
9D01CD4C  91480007   LBU T0, 7(T2)
9D01CD50  1100FFC6   BEQ T0, ZERO, 0x9D01CC6C
9D01CD54  00E31026   XOR V0, A3, V1
9D01CD60  254A0009   ADDIU T2, T2, 9
9D01CD64  9149FFFF   LBU T1, -1(T2)
9D01CD68  1120FFC0   BEQ T1, ZERO, 0x9D01CC6C
9D01CD6C  00481026   XOR V0, V0, T0
417:                 		{
418:                 		hash = (hash*33)^c;
9D01CC74  01826821   ADDU T5, T4, V0
9D01CCA4  00022940   SLL A1, V0, 5
9D01CCA8  00A21021   ADDU V0, A1, V0
9D01CCBC  00024140   SLL T0, V0, 5
9D01CCC0  01024821   ADDU T1, T0, V0
9D01CCC4  0B407323   J 0x9D01CC8C
9D01CCC8  01271026   XOR V0, T1, A3
9D01CCCC  00027940   SLL T7, V0, 5
9D01CCD0  01E2C021   ADDU T8, T7, V0
9D01CCE0  00021940   SLL V1, V0, 5
9D01CCE4  00622021   ADDU A0, V1, V0
9D01CCF4  00022940   SLL A1, V0, 5
9D01CCF8  00A21021   ADDU V0, A1, V0
9D01CD08  00024940   SLL T1, V0, 5
9D01CD0C  01225821   ADDU T3, T1, V0
9D01CD1C  00026940   SLL T5, V0, 5
9D01CD20  01A27021   ADDU T6, T5, V0
9D01CD30  0002C140   SLL T8, V0, 5
9D01CD34  0302C821   ADDU T9, T8, V0
9D01CD44  00022140   SLL A0, V0, 5
9D01CD48  00823821   ADDU A3, A0, V0
9D01CD58  00022940   SLL A1, V0, 5
9D01CD5C  00A21021   ADDU V0, A1, V0
9D01CD70  00025940   SLL T3, V0, 5
9D01CD74  01626021   ADDU T4, T3, V0
419:                 		if (infinite_loop_breaker++ > 100) return 0;	//In case we get stuck
9D01CD78  1546FFC4   BNE T2, A2, 0x9D01CC8C
9D01CD7C  01891026   XOR V0, T4, T1
9D01CD80  03E00008   JR RA
9D01CD84  00001021   ADDU V0, ZERO, ZERO
420:                 		}
421:                 	//sprintf(stdio_buff, "has %d\n", hash);
422:                 	return hash;
423:                 	}
424:                 
425:                 uint8_t get_command_index(uint32_t  hash_value)
426:                 	{
427:                 	uint8_t i;
428:                 	for (i=0; i<HASH_TABLE_LENGTH; i++)
9D01CE20  03E00008   JR RA
9D01CE24  24020002   ADDIU V0, ZERO, 2
9D01CE28  03E00008   JR RA
9D01CE2C  24020003   ADDIU V0, ZERO, 3
9D01CE30  03E00008   JR RA
9D01CE34  24020004   ADDIU V0, ZERO, 4
9D01CE38  03E00008   JR RA
9D01CE3C  24020005   ADDIU V0, ZERO, 5
9D01CE40  03E00008   JR RA
9D01CE44  24020006   ADDIU V0, ZERO, 6
9D01CE48  03E00008   JR RA
9D01CE4C  24020007   ADDIU V0, ZERO, 7
9D01CE50  03E00008   JR RA
9D01CE54  24020008   ADDIU V0, ZERO, 8
9D01CE58  03E00008   JR RA
9D01CE5C  24020009   ADDIU V0, ZERO, 9
9D01CE60  03E00008   JR RA
9D01CE64  2402000A   ADDIU V0, ZERO, 10
9D01CE68  03E00008   JR RA
9D01CE6C  2402000B   ADDIU V0, ZERO, 11
429:                 		{
430:                 		if (hashtable[i] == hash_value) return i;
9D01CD88  10800039   BEQ A0, ZERO, 0x9D01CE70
9D01CD8C  00001021   ADDU V0, ZERO, ZERO
9D01CD90  3C02003E   LUI V0, 62
9D01CD94  2443432D   ADDIU V1, V0, 17197
9D01CD98  10830021   BEQ A0, V1, 0x9D01CE20
9D01CD9C  3C05E958   LUI A1, -5800
9D01CDA0  24A657D5   ADDIU A2, A1, 22485
9D01CDA4  10860020   BEQ A0, A2, 0x9D01CE28
9D01CDA8  24070686   ADDIU A3, ZERO, 1670
9D01CDAC  10870020   BEQ A0, A3, 0x9D01CE30
9D01CDB0  3C080001   LUI T0, 1
9D01CDB4  3509DB82   ORI T1, T0, -9342
9D01CDB8  1089001F   BEQ A0, T1, 0x9D01CE38
9D01CDBC  3C0A003E   LUI T2, 62
9D01CDC0  354BB03F   ORI T3, T2, -20417
9D01CDC4  108B001E   BEQ A0, T3, 0x9D01CE40
9D01CDC8  3C0C083B   LUI T4, 2107
9D01CDCC  258D3298   ADDIU T5, T4, 12952
9D01CDD0  108D001D   BEQ A0, T5, 0x9D01CE48
9D01CDD4  3C0E0001   LUI T6, 1
9D01CDD8  35CFAE45   ORI T7, T6, -20923
9D01CDDC  108F001C   BEQ A0, T7, 0x9D01CE50
9D01CDE0  3C18BD35   LUI T8, -17099
9D01CDE4  27191DFC   ADDIU T9, T8, 7676
9D01CDE8  1099001B   BEQ A0, T9, 0x9D01CE58
9D01CDEC  00000000   NOP
9D01CDF0  3C0207E7   LUI V0, 2023
9D01CDF4  24433678   ADDIU V1, V0, 13944
9D01CDF8  10830019   BEQ A0, V1, 0x9D01CE60
9D01CDFC  3C05A711   LUI A1, -22767
9D01CE00  34A6B6E3   ORI A2, A1, -18717
9D01CE04  10860018   BEQ A0, A2, 0x9D01CE68
9D01CE08  3C070037   LUI A3, 55
9D01CE0C  34E88691   ORI T0, A3, -31087
9D01CE10  14880017   BNE A0, T0, 0x9D01CE70
9D01CE14  00001021   ADDU V0, ZERO, ZERO
9D01CE18  03E00008   JR RA
9D01CE1C  2402000C   ADDIU V0, ZERO, 12
431:                 		}
432:                 	return 0;
433:                 	}
9D01CE70  03E00008   JR RA
9D01CE74  00000000   NOP
434:                 
435:                 uint8_t random_crack(void)
436:                 	{
9D01D950  27BDFFE8   ADDIU SP, SP, -24
9D01D954  AFBF0014   SW RA, 20(SP)
437:                 	uint8_t i = (uint8_t)rand()%CRACKCOUNT;
9D01D958  0F410684   JAL .Letext0, .LFE0, rand
9D01D95C  00000000   NOP
9D01D960  304200FF   ANDI V0, V0, 255
9D01D964  3C04AF28   LUI A0, -20696
9D01D968  24836BCB   ADDIU V1, A0, 27595
9D01D96C  00430019   MULTU 0, V0, V1
9D01D970  00002810   MFHI A1
9D01D974  00453023   SUBU A2, V0, A1
9D01D978  00063842   SRL A3, A2, 1
9D01D97C  00A74021   ADDU T0, A1, A3
9D01D980  00084902   SRL T1, T0, 4
9D01D984  00095080   SLL T2, T1, 2
9D01D988  00095900   SLL T3, T1, 4
9D01D98C  014B6021   ADDU T4, T2, T3
9D01D990  01896823   SUBU T5, T4, T1
9D01D994  004D7023   SUBU T6, V0, T5
438:                 	return wisecrack((uint8_t *)cracks[i],TEXT_LEFT, CRACK_Y,1);
9D01D998  31CF00FF   ANDI T7, T6, 255
9D01D99C  000FC080   SLL T8, T7, 2
9D01D9A0  3C19A001   LUI T9, -24575
9D01D9A4  27223BDC   ADDIU V0, T9, 15324
9D01D9A8  03022021   ADDU A0, T8, V0
9D01D9AC  8C840000   LW A0, 0(A0)
9D01D9B0  24050004   ADDIU A1, ZERO, 4
9D01D9B4  24060011   ADDIU A2, ZERO, 17
9D01D9B8  0F40757B   JAL wisecrack
9D01D9BC  24070001   ADDIU A3, ZERO, 1
439:                 	}
9D01D9C0  8FBF0014   LW RA, 20(SP)
9D01D9C4  03E00008   JR RA
9D01D9C8  27BD0018   ADDIU SP, SP, 24
440:                 
441:                 uint8_t wisecrack(int8_t * quip, uint16_t x, uint8_t y, uint8_t type)
442:                 	{
9D01D5EC  27BDFF98   ADDIU SP, SP, -104
9D01D5F0  AFBF0064   SW RA, 100(SP)
9D01D5F4  AFB10060   SW S1, 96(SP)
9D01D5F8  AFB0005C   SW S0, 92(SP)
9D01D5FC  00A08821   ADDU S1, A1, ZERO
9D01D600  00C08021   ADDU S0, A2, ZERO
443:                 	uint8_t index, line1index, line2index;
444:                 	uint8_t line1[33];
445:                 	uint8_t line2[33];
446:                 	index = 0;
447:                 	line1index = 0;
9D01D60C  00001021   ADDU V0, ZERO, ZERO
448:                 	line2index = 0;
9D01D608  00004021   ADDU T0, ZERO, ZERO
449:                 	while (quip[index] != 0)
9D01D604  00001821   ADDU V1, ZERO, ZERO
9D01D610  0B40759D   J 0x9D01D674
9D01D614  240A0040   ADDIU T2, ZERO, 64
9D01D660  83E50000   LB A1, 0(RA)
9D01D664  14A00027   BNE A1, ZERO, 0x9D01D704
9D01D668  306900FF   ANDI T1, V1, 255
9D01D678  80A90000   LB T1, 0(A1)
9D01D67C  1520FFE6   BNE T1, ZERO, 0x9D01D618
9D01D680  306B00FF   ANDI T3, V1, 255
9D01D74C  83EB0000   LB T3, 0(RA)
9D01D750  1160FFCC   BEQ T3, ZERO, 0x9D01D684
9D01D754  332500FF   ANDI A1, T9, 255
9D01D7A0  83EB0000   LB T3, 0(RA)
9D01D7A4  1160FFB7   BEQ T3, ZERO, 0x9D01D684
9D01D7A8  332500FF   ANDI A1, T9, 255
9D01D7F4  833F0000   LB RA, 0(T9)
9D01D7F8  13E0FFA2   BEQ RA, ZERO, 0x9D01D684
9D01D7FC  330B00FF   ANDI T3, T8, 255
9D01D848  833F0000   LB RA, 0(T9)
9D01D84C  13E0FF8D   BEQ RA, ZERO, 0x9D01D684
9D01D850  330B00FF   ANDI T3, T8, 255
9D01D89C  833F0000   LB RA, 0(T9)
9D01D8A0  13E0FF78   BEQ RA, ZERO, 0x9D01D684
9D01D8A4  330B00FF   ANDI T3, T8, 255
9D01D8F0  83190000   LB T9, 0(T8)
9D01D8F4  1320FF63   BEQ T9, ZERO, 0x9D01D684
9D01D8F8  31FF00FF   ANDI RA, T7, 255
450:                 		{
451:                 		if (index < 32)
9D01D618  2D660020   SLTIU A2, T3, 32
9D01D61C  10C00007   BEQ A2, ZERO, 0x9D01D63C
9D01D620  2D6C0040   SLTIU T4, T3, 64
9D01D704  2D2B0020   SLTIU T3, T1, 32
9D01D708  1560000A   BNE T3, ZERO, 0x9D01D734
9D01D70C  244F0001   ADDIU T7, V0, 1
9D01D758  2CA90020   SLTIU T1, A1, 32
9D01D75C  1520000A   BNE T1, ZERO, 0x9D01D788
9D01D760  244E0001   ADDIU T6, V0, 1
9D01D7AC  2CA90020   SLTIU T1, A1, 32
9D01D7B0  1520000A   BNE T1, ZERO, 0x9D01D7DC
9D01D7B4  244E0001   ADDIU T6, V0, 1
9D01D800  2D650020   SLTIU A1, T3, 32
9D01D804  14A0000A   BNE A1, ZERO, 0x9D01D830
9D01D808  244E0001   ADDIU T6, V0, 1
9D01D854  2D650020   SLTIU A1, T3, 32
9D01D858  14A0000A   BNE A1, ZERO, 0x9D01D884
9D01D85C  244D0001   ADDIU T5, V0, 1
9D01D8A8  2D650020   SLTIU A1, T3, 32
9D01D8AC  14A0000A   BNE A1, ZERO, 0x9D01D8D8
9D01D8B0  244D0001   ADDIU T5, V0, 1
9D01D8FC  2FEB0020   SLTIU T3, RA, 32
9D01D900  1560000A   BNE T3, ZERO, 0x9D01D92C
9D01D904  244D0001   ADDIU T5, V0, 1
452:                 			{
453:                 			line1[line1index++] = quip[index];
9D01D624  244F0001   ADDIU T7, V0, 1
9D01D628  27B80010   ADDIU T8, SP, 16
9D01D62C  03021021   ADDU V0, T8, V0
9D01D630  A0490000   SB T1, 0(V0)
9D01D634  0B407596   J 0x9D01D658
9D01D638  31E200FF   ANDI V0, T7, 255
9D01D734  27B80010   ADDIU T8, SP, 16
9D01D738  03021021   ADDU V0, T8, V0
9D01D73C  A0450000   SB A1, 0(V0)
9D01D740  31E200FF   ANDI V0, T7, 255
9D01D744  24790001   ADDIU T9, V1, 1
9D01D748  0099F821   ADDU RA, A0, T9
9D01D788  27AF0010   ADDIU T7, SP, 16
9D01D78C  01E2C021   ADDU T8, T7, V0
9D01D790  A30B0000   SB T3, 0(T8)
9D01D794  31C200FF   ANDI V0, T6, 255
9D01D798  24790002   ADDIU T9, V1, 2
9D01D79C  0099F821   ADDU RA, A0, T9
9D01D7DC  27AF0010   ADDIU T7, SP, 16
9D01D7E0  01E21021   ADDU V0, T7, V0
9D01D7E4  A04B0000   SB T3, 0(V0)
9D01D7E8  31C200FF   ANDI V0, T6, 255
9D01D7EC  24780003   ADDIU T8, V1, 3
9D01D7F0  0098C821   ADDU T9, A0, T8
9D01D830  27AF0010   ADDIU T7, SP, 16
9D01D834  01E21021   ADDU V0, T7, V0
9D01D838  A05F0000   SB RA, 0(V0)
9D01D83C  31C200FF   ANDI V0, T6, 255
9D01D840  24780004   ADDIU T8, V1, 4
9D01D844  0098C821   ADDU T9, A0, T8
9D01D884  27AE0010   ADDIU T6, SP, 16
9D01D888  01C27821   ADDU T7, T6, V0
9D01D88C  A1FF0000   SB RA, 0(T7)
9D01D890  31A200FF   ANDI V0, T5, 255
9D01D894  24780005   ADDIU T8, V1, 5
9D01D898  0098C821   ADDU T9, A0, T8
9D01D8D8  27AE0010   ADDIU T6, SP, 16
9D01D8DC  01C21021   ADDU V0, T6, V0
9D01D8E0  A05F0000   SB RA, 0(V0)
9D01D8E4  31A200FF   ANDI V0, T5, 255
9D01D8E8  246F0006   ADDIU T7, V1, 6
9D01D8EC  008FC021   ADDU T8, A0, T7
9D01D92C  27AE0010   ADDIU T6, SP, 16
9D01D930  01C21021   ADDU V0, T6, V0
9D01D934  A0590000   SB T9, 0(V0)
9D01D938  31A200FF   ANDI V0, T5, 255
9D01D93C  24630007   ADDIU V1, V1, 7
454:                 			}
455:                 		else if (index < 64)
9D01D63C  51800007   BEQL T4, ZERO, 0x9D01D65C
9D01D640  24630001   ADDIU V1, V1, 1
9D01D710  2D260040   SLTIU A2, T1, 64
9D01D714  10C0000C   BEQ A2, ZERO, 0x9D01D748
9D01D718  24790001   ADDIU T9, V1, 1
9D01D764  2CA60040   SLTIU A2, A1, 64
9D01D768  10C0000C   BEQ A2, ZERO, 0x9D01D79C
9D01D76C  24790002   ADDIU T9, V1, 2
9D01D7B8  2CA60040   SLTIU A2, A1, 64
9D01D7BC  10C0000C   BEQ A2, ZERO, 0x9D01D7F0
9D01D7C0  24780003   ADDIU T8, V1, 3
9D01D80C  2D690040   SLTIU T1, T3, 64
9D01D810  1120000C   BEQ T1, ZERO, 0x9D01D844
9D01D814  24780004   ADDIU T8, V1, 4
9D01D860  2D690040   SLTIU T1, T3, 64
9D01D864  1120000C   BEQ T1, ZERO, 0x9D01D898
9D01D868  24780005   ADDIU T8, V1, 5
9D01D8B4  2D690040   SLTIU T1, T3, 64
9D01D8B8  1120000C   BEQ T1, ZERO, 0x9D01D8EC
9D01D8BC  246F0006   ADDIU T7, V1, 6
9D01D908  2FE50040   SLTIU A1, RA, 64
9D01D90C  50A0000C   BEQL A1, ZERO, 0x9D01D940
9D01D910  24630007   ADDIU V1, V1, 7
456:                 			{
457:                 			line2[line2index++] = quip[index];
9D01D644  250D0001   ADDIU T5, T0, 1
9D01D648  27AE0010   ADDIU T6, SP, 16
9D01D64C  01C84021   ADDU T0, T6, T0
9D01D650  A1090024   SB T1, 36(T0)
9D01D654  31A800FF   ANDI T0, T5, 255
9D01D658  24630001   ADDIU V1, V1, 1
9D01D65C  0083F821   ADDU RA, A0, V1
9D01D71C  250C0001   ADDIU T4, T0, 1
9D01D720  27AD0010   ADDIU T5, SP, 16
9D01D724  01A87021   ADDU T6, T5, T0
9D01D728  A1C50024   SB A1, 36(T6)
9D01D72C  0B4075D2   J 0x9D01D748
9D01D730  318800FF   ANDI T0, T4, 255
9D01D770  250C0001   ADDIU T4, T0, 1
9D01D774  27AD0010   ADDIU T5, SP, 16
9D01D778  01A84021   ADDU T0, T5, T0
9D01D77C  A10B0024   SB T3, 36(T0)
9D01D780  0B4075E7   J 0x9D01D79C
9D01D784  318800FF   ANDI T0, T4, 255
9D01D7C4  250C0001   ADDIU T4, T0, 1
9D01D7C8  27AD0010   ADDIU T5, SP, 16
9D01D7CC  01A84021   ADDU T0, T5, T0
9D01D7D0  A10B0024   SB T3, 36(T0)
9D01D7D4  0B4075FC   J 0x9D01D7F0
9D01D7D8  318800FF   ANDI T0, T4, 255
9D01D818  25060001   ADDIU A2, T0, 1
9D01D81C  27AC0010   ADDIU T4, SP, 16
9D01D820  01886821   ADDU T5, T4, T0
9D01D824  A1BF0024   SB RA, 36(T5)
9D01D828  0B407611   J 0x9D01D844
9D01D82C  30C800FF   ANDI T0, A2, 255
9D01D86C  25060001   ADDIU A2, T0, 1
9D01D870  27AC0010   ADDIU T4, SP, 16
9D01D874  01884021   ADDU T0, T4, T0
9D01D878  A11F0024   SB RA, 36(T0)
9D01D87C  0B407626   J 0x9D01D898
9D01D880  30C800FF   ANDI T0, A2, 255
9D01D8C0  25060001   ADDIU A2, T0, 1
9D01D8C4  27AC0010   ADDIU T4, SP, 16
9D01D8C8  01884021   ADDU T0, T4, T0
9D01D8CC  A11F0024   SB RA, 36(T0)
9D01D8D0  0B40763B   J 0x9D01D8EC
9D01D8D4  30C800FF   ANDI T0, A2, 255
9D01D914  25060001   ADDIU A2, T0, 1
9D01D918  27A90010   ADDIU T1, SP, 16
9D01D91C  01286021   ADDU T4, T1, T0
9D01D920  A1990024   SB T9, 36(T4)
9D01D924  0B40764F   J 0x9D01D93C
9D01D928  30C800FF   ANDI T0, A2, 255
458:                 			}
459:                 		if (++index >= 64) break;
9D01D940  146AFF4D   BNE V1, T2, 0x9D01D678
9D01D944  00832821   ADDU A1, A0, V1
460:                 		}
461:                 	line1[line1index] = 0;
9D01D66C  0B4075A2   J 0x9D01D688
9D01D670  27A40010   ADDIU A0, SP, 16
9D01D674  00832821   ADDU A1, A0, V1
9D01D684  27A40010   ADDIU A0, SP, 16
9D01D688  00825021   ADDU T2, A0, V0
9D01D68C  A1400000   SB ZERO, 0(T2)
9D01D948  0B4075A2   J 0x9D01D688
9D01D94C  27A40010   ADDIU A0, SP, 16
462:                 	line2[line2index] = 0;
9D01D690  00887821   ADDU T7, A0, T0
463:                 	
464:                 	if (type == 0)
9D01D694  14E00006   BNE A3, ZERO, 0x9D01D6B0
9D01D698  A1E00024   SB ZERO, 36(T7)
465:                 		{
466:                 		video_set_color(MENU_SECRET_COLOR, MENU_DEFAULT_BG);
9D01D69C  2404000A   ADDIU A0, ZERO, 10
9D01D6A0  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01D6A4  00002821   ADDU A1, ZERO, ZERO
9D01D6A8  0B4075B0   J 0x9D01D6C0
9D01D6AC  7C118C20   SEB S1, S1
467:                 		}
468:                 	else video_set_color(MENU_CRACK_COLOR, MENU_DEFAULT_BG);
9D01D6B0  2404000E   ADDIU A0, ZERO, 14
9D01D6B4  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01D6B8  00002821   ADDU A1, ZERO, ZERO
469:                 	video_gotoxy(x,y);
9D01D6BC  7C118C20   SEB S1, S1
9D01D6C0  02202021   ADDU A0, S1, ZERO
9D01D6C4  0F406D09   JAL video_gotoxy
9D01D6C8  7C102C20   SEB A1, S0
470:                 	stdio_write(line1);
9D01D6CC  0F40751F   JAL stdio_write
9D01D6D0  27A40010   ADDIU A0, SP, 16
471:                 	video_gotoxy(x,y+1);
9D01D6D4  26070001   ADDIU A3, S0, 1
9D01D6D8  02202021   ADDU A0, S1, ZERO
9D01D6DC  0F406D09   JAL video_gotoxy
9D01D6E0  7C072C20   SEB A1, A3
472:                 	stdio_write(line2);
9D01D6E4  0F40751F   JAL stdio_write
9D01D6E8  27A40034   ADDIU A0, SP, 52
473:                 	return 1;
474:                 	}
9D01D6EC  24020001   ADDIU V0, ZERO, 1
9D01D6F0  8FBF0064   LW RA, 100(SP)
9D01D6F4  8FB10060   LW S1, 96(SP)
9D01D6F8  8FB0005C   LW S0, 92(SP)
9D01D6FC  03E00008   JR RA
9D01D700  27BD0068   ADDIU SP, SP, 104
9D01D704  2D2B0020   SLTIU T3, T1, 32
9D01D708  1560000A   BNE T3, ZERO, 0x9D01D734
9D01D70C  244F0001   ADDIU T7, V0, 1
9D01D710  2D260040   SLTIU A2, T1, 64
9D01D714  10C0000C   BEQ A2, ZERO, 0x9D01D748
9D01D718  24790001   ADDIU T9, V1, 1
9D01D71C  250C0001   ADDIU T4, T0, 1
9D01D720  27AD0010   ADDIU T5, SP, 16
9D01D724  01A87021   ADDU T6, T5, T0
9D01D728  A1C50024   SB A1, 36(T6)
9D01D72C  0B4075D2   J 0x9D01D748
9D01D730  318800FF   ANDI T0, T4, 255
9D01D734  27B80010   ADDIU T8, SP, 16
9D01D738  03021021   ADDU V0, T8, V0
9D01D73C  A0450000   SB A1, 0(V0)
9D01D740  31E200FF   ANDI V0, T7, 255
9D01D744  24790001   ADDIU T9, V1, 1
9D01D748  0099F821   ADDU RA, A0, T9
9D01D74C  83EB0000   LB T3, 0(RA)
9D01D750  1160FFCC   BEQ T3, ZERO, 0x9D01D684
9D01D754  332500FF   ANDI A1, T9, 255
9D01D758  2CA90020   SLTIU T1, A1, 32
9D01D75C  1520000A   BNE T1, ZERO, 0x9D01D788
9D01D760  244E0001   ADDIU T6, V0, 1
9D01D764  2CA60040   SLTIU A2, A1, 64
9D01D768  10C0000C   BEQ A2, ZERO, 0x9D01D79C
9D01D76C  24790002   ADDIU T9, V1, 2
9D01D770  250C0001   ADDIU T4, T0, 1
9D01D774  27AD0010   ADDIU T5, SP, 16
9D01D778  01A84021   ADDU T0, T5, T0
9D01D77C  A10B0024   SB T3, 36(T0)
9D01D780  0B4075E7   J 0x9D01D79C
9D01D784  318800FF   ANDI T0, T4, 255
9D01D788  27AF0010   ADDIU T7, SP, 16
9D01D78C  01E2C021   ADDU T8, T7, V0
9D01D790  A30B0000   SB T3, 0(T8)
9D01D794  31C200FF   ANDI V0, T6, 255
9D01D798  24790002   ADDIU T9, V1, 2
9D01D79C  0099F821   ADDU RA, A0, T9
9D01D7A0  83EB0000   LB T3, 0(RA)
9D01D7A4  1160FFB7   BEQ T3, ZERO, 0x9D01D684
9D01D7A8  332500FF   ANDI A1, T9, 255
9D01D7AC  2CA90020   SLTIU T1, A1, 32
9D01D7B0  1520000A   BNE T1, ZERO, 0x9D01D7DC
9D01D7B4  244E0001   ADDIU T6, V0, 1
9D01D7B8  2CA60040   SLTIU A2, A1, 64
9D01D7BC  10C0000C   BEQ A2, ZERO, 0x9D01D7F0
9D01D7C0  24780003   ADDIU T8, V1, 3
9D01D7C4  250C0001   ADDIU T4, T0, 1
9D01D7C8  27AD0010   ADDIU T5, SP, 16
9D01D7CC  01A84021   ADDU T0, T5, T0
9D01D7D0  A10B0024   SB T3, 36(T0)
9D01D7D4  0B4075FC   J 0x9D01D7F0
9D01D7D8  318800FF   ANDI T0, T4, 255
9D01D7DC  27AF0010   ADDIU T7, SP, 16
9D01D7E0  01E21021   ADDU V0, T7, V0
9D01D7E4  A04B0000   SB T3, 0(V0)
9D01D7E8  31C200FF   ANDI V0, T6, 255
9D01D7EC  24780003   ADDIU T8, V1, 3
9D01D7F0  0098C821   ADDU T9, A0, T8
9D01D7F4  833F0000   LB RA, 0(T9)
9D01D7F8  13E0FFA2   BEQ RA, ZERO, 0x9D01D684
9D01D7FC  330B00FF   ANDI T3, T8, 255
9D01D800  2D650020   SLTIU A1, T3, 32
9D01D804  14A0000A   BNE A1, ZERO, 0x9D01D830
9D01D808  244E0001   ADDIU T6, V0, 1
9D01D80C  2D690040   SLTIU T1, T3, 64
9D01D810  1120000C   BEQ T1, ZERO, 0x9D01D844
9D01D814  24780004   ADDIU T8, V1, 4
9D01D818  25060001   ADDIU A2, T0, 1
9D01D81C  27AC0010   ADDIU T4, SP, 16
9D01D820  01886821   ADDU T5, T4, T0
9D01D824  A1BF0024   SB RA, 36(T5)
9D01D828  0B407611   J 0x9D01D844
9D01D82C  30C800FF   ANDI T0, A2, 255
9D01D830  27AF0010   ADDIU T7, SP, 16
9D01D834  01E21021   ADDU V0, T7, V0
9D01D838  A05F0000   SB RA, 0(V0)
9D01D83C  31C200FF   ANDI V0, T6, 255
9D01D840  24780004   ADDIU T8, V1, 4
9D01D844  0098C821   ADDU T9, A0, T8
9D01D848  833F0000   LB RA, 0(T9)
9D01D84C  13E0FF8D   BEQ RA, ZERO, 0x9D01D684
9D01D850  330B00FF   ANDI T3, T8, 255
9D01D854  2D650020   SLTIU A1, T3, 32
9D01D858  14A0000A   BNE A1, ZERO, 0x9D01D884
9D01D85C  244D0001   ADDIU T5, V0, 1
9D01D860  2D690040   SLTIU T1, T3, 64
9D01D864  1120000C   BEQ T1, ZERO, 0x9D01D898
9D01D868  24780005   ADDIU T8, V1, 5
9D01D86C  25060001   ADDIU A2, T0, 1
9D01D870  27AC0010   ADDIU T4, SP, 16
9D01D874  01884021   ADDU T0, T4, T0
9D01D878  A11F0024   SB RA, 36(T0)
9D01D87C  0B407626   J 0x9D01D898
9D01D880  30C800FF   ANDI T0, A2, 255
9D01D884  27AE0010   ADDIU T6, SP, 16
9D01D888  01C27821   ADDU T7, T6, V0
9D01D88C  A1FF0000   SB RA, 0(T7)
9D01D890  31A200FF   ANDI V0, T5, 255
9D01D894  24780005   ADDIU T8, V1, 5
9D01D898  0098C821   ADDU T9, A0, T8
9D01D89C  833F0000   LB RA, 0(T9)
9D01D8A0  13E0FF78   BEQ RA, ZERO, 0x9D01D684
9D01D8A4  330B00FF   ANDI T3, T8, 255
9D01D8A8  2D650020   SLTIU A1, T3, 32
9D01D8AC  14A0000A   BNE A1, ZERO, 0x9D01D8D8
9D01D8B0  244D0001   ADDIU T5, V0, 1
9D01D8B4  2D690040   SLTIU T1, T3, 64
9D01D8B8  1120000C   BEQ T1, ZERO, 0x9D01D8EC
9D01D8BC  246F0006   ADDIU T7, V1, 6
9D01D8C0  25060001   ADDIU A2, T0, 1
9D01D8C4  27AC0010   ADDIU T4, SP, 16
9D01D8C8  01884021   ADDU T0, T4, T0
9D01D8CC  A11F0024   SB RA, 36(T0)
9D01D8D0  0B40763B   J 0x9D01D8EC
9D01D8D4  30C800FF   ANDI T0, A2, 255
9D01D8D8  27AE0010   ADDIU T6, SP, 16
9D01D8DC  01C21021   ADDU V0, T6, V0
9D01D8E0  A05F0000   SB RA, 0(V0)
9D01D8E4  31A200FF   ANDI V0, T5, 255
9D01D8E8  246F0006   ADDIU T7, V1, 6
9D01D8EC  008FC021   ADDU T8, A0, T7
9D01D8F0  83190000   LB T9, 0(T8)
9D01D8F4  1320FF63   BEQ T9, ZERO, 0x9D01D684
9D01D8F8  31FF00FF   ANDI RA, T7, 255
9D01D8FC  2FEB0020   SLTIU T3, RA, 32
9D01D900  1560000A   BNE T3, ZERO, 0x9D01D92C
9D01D904  244D0001   ADDIU T5, V0, 1
9D01D908  2FE50040   SLTIU A1, RA, 64
9D01D90C  50A0000C   BEQL A1, ZERO, 0x9D01D940
9D01D910  24630007   ADDIU V1, V1, 7
9D01D914  25060001   ADDIU A2, T0, 1
9D01D918  27A90010   ADDIU T1, SP, 16
9D01D91C  01286021   ADDU T4, T1, T0
9D01D920  A1990024   SB T9, 36(T4)
9D01D924  0B40764F   J 0x9D01D93C
9D01D928  30C800FF   ANDI T0, A2, 255
9D01D92C  27AE0010   ADDIU T6, SP, 16
9D01D930  01C21021   ADDU V0, T6, V0
9D01D934  A0590000   SB T9, 0(V0)
9D01D938  31A200FF   ANDI V0, T5, 255
9D01D93C  24630007   ADDIU V1, V1, 7
9D01D940  146AFF4D   BNE V1, T2, 0x9D01D678
9D01D944  00832821   ADDU A1, A0, V1
9D01D948  0B4075A2   J 0x9D01D688
9D01D94C  27A40010   ADDIU A0, SP, 16
475:                 
476:                 void clear_crack(void)
477:                 	{
9D01D9CC  27BDFFE0   ADDIU SP, SP, -32
9D01D9D0  AFBF001C   SW RA, 28(SP)
9D01D9D4  AFB20018   SW S2, 24(SP)
9D01D9D8  AFB10014   SW S1, 20(SP)
478:                 	int16_t cursorx, cursory;
479:                 	cursorx = video_getx();
9D01D9DC  0F406DAB   JAL video_getx
9D01D9E0  AFB00010   SW S0, 16(SP)
480:                 	cursory = video_gety();
9D01D9E4  0F406DAD   JAL .LFB47, .LFE46, video_gety
9D01D9E8  00409021   ADDU S2, V0, ZERO
9D01D9EC  00408821   ADDU S1, V0, ZERO
481:                 	video_gotoxy(1,CRACK_Y);
9D01D9F0  24040001   ADDIU A0, ZERO, 1
9D01D9F4  0F406D09   JAL video_gotoxy
9D01D9F8  24050011   ADDIU A1, ZERO, 17
482:                 	stdio_write((uint8_t *)blanks);
9D01D9FC  3C109D03   LUI S0, -25341
9D01DA00  0F40751F   JAL stdio_write
9D01DA04  2604F628   ADDIU A0, S0, -2520
483:                 	video_gotoxy(1,CRACK_Y+1);
9D01DA08  24040001   ADDIU A0, ZERO, 1
9D01DA0C  0F406D09   JAL video_gotoxy
9D01DA10  24050012   ADDIU A1, ZERO, 18
484:                 	stdio_write((uint8_t *)blanks);
9D01DA14  0F40751F   JAL stdio_write
9D01DA18  2604F628   ADDIU A0, S0, -2520
485:                 	video_gotoxy(cursorx,cursory);
9D01DA1C  02402021   ADDU A0, S2, ZERO
9D01DA20  0F406D09   JAL video_gotoxy
9D01DA24  02202821   ADDU A1, S1, ZERO
486:                 	}
9D01DA28  8FBF001C   LW RA, 28(SP)
9D01DA2C  8FB20018   LW S2, 24(SP)
9D01DA30  8FB10014   LW S1, 20(SP)
9D01DA34  8FB00010   LW S0, 16(SP)
9D01DA38  03E00008   JR RA
9D01DA3C  27BD0020   ADDIU SP, SP, 32
487:                 
488:                 void showmenu(void)
489:                 	{
9D01DF08  27BDFFE8   ADDIU SP, SP, -24
9D01DF0C  AFBF0014   SW RA, 20(SP)
490:                 	//Set some background boxes
491:                 	video_clrscr();
9D01DF10  0F406DBA   JAL video_clrscr
9D01DF14  AFB00010   SW S0, 16(SP)
492:                 	video_set_color(MENU_BANNER_FG,MENU_BANNER_BG);
9D01DF18  00002021   ADDU A0, ZERO, ZERO
9D01DF1C  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01DF20  2405000F   ADDIU A1, ZERO, 15
493:                 	video_gotoxy(1,1);
9D01DF24  24040001   ADDIU A0, ZERO, 1
9D01DF28  0F406D09   JAL video_gotoxy
9D01DF2C  24050001   ADDIU A1, ZERO, 1
494:                 	stdio_write((uint8_t *)blanks);
9D01DF30  3C109D03   LUI S0, -25341
9D01DF34  0F40751F   JAL stdio_write
9D01DF38  2604F628   ADDIU A0, S0, -2520
495:                 	video_gotoxy(1,2);
9D01DF3C  24040001   ADDIU A0, ZERO, 1
9D01DF40  0F406D09   JAL video_gotoxy
9D01DF44  24050002   ADDIU A1, ZERO, 2
496:                 	stdio_write((uint8_t *)blanks);
9D01DF48  0F40751F   JAL stdio_write
9D01DF4C  2604F628   ADDIU A0, S0, -2520
497:                 	video_gotoxy(1,3);
9D01DF50  24040001   ADDIU A0, ZERO, 1
9D01DF54  0F406D09   JAL video_gotoxy
9D01DF58  24050003   ADDIU A1, ZERO, 3
498:                 	stdio_write((uint8_t *)blanks);
9D01DF5C  0F40751F   JAL stdio_write
9D01DF60  2604F628   ADDIU A0, S0, -2520
499:                 	
500:                 	video_set_color(MENU_HEADER_FG,MENU_HEADER_BG);
9D01DF64  2404000F   ADDIU A0, ZERO, 15
9D01DF68  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01DF6C  24050008   ADDIU A1, ZERO, 8
501:                 	video_gotoxy(3,5);
9D01DF70  24040003   ADDIU A0, ZERO, 3
9D01DF74  0F406D09   JAL video_gotoxy
9D01DF78  24050005   ADDIU A1, ZERO, 5
502:                 	stdio_write("                                  ");
9D01DF7C  3C109D03   LUI S0, -25341
9D01DF80  0F40751F   JAL stdio_write
9D01DF84  2604F4D8   ADDIU A0, S0, -2856
503:                 	video_set_color(MENU_ENTRY_FG,MENU_ENTRY_BG);
9D01DF88  2404000F   ADDIU A0, ZERO, 15
9D01DF8C  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01DF90  24050009   ADDIU A1, ZERO, 9
504:                 	video_gotoxy(3,6);
9D01DF94  24040003   ADDIU A0, ZERO, 3
9D01DF98  0F406D09   JAL video_gotoxy
9D01DF9C  24050006   ADDIU A1, ZERO, 6
505:                 	stdio_write("                                  ");
9D01DFA0  0F40751F   JAL stdio_write
9D01DFA4  2604F4D8   ADDIU A0, S0, -2856
506:                 	video_gotoxy(3,7);
9D01DFA8  24040003   ADDIU A0, ZERO, 3
9D01DFAC  0F406D09   JAL video_gotoxy
9D01DFB0  24050007   ADDIU A1, ZERO, 7
507:                 	stdio_write("                                  ");
9D01DFB4  0F40751F   JAL stdio_write
9D01DFB8  2604F4D8   ADDIU A0, S0, -2856
508:                 	video_gotoxy(3,8);
9D01DFBC  24040003   ADDIU A0, ZERO, 3
9D01DFC0  0F406D09   JAL video_gotoxy
9D01DFC4  24050008   ADDIU A1, ZERO, 8
509:                 	stdio_write("                                  ");
9D01DFC8  0F40751F   JAL stdio_write
9D01DFCC  2604F4D8   ADDIU A0, S0, -2856
510:                 	video_gotoxy(3,9);
9D01DFD0  24040003   ADDIU A0, ZERO, 3
9D01DFD4  0F406D09   JAL video_gotoxy
9D01DFD8  24050009   ADDIU A1, ZERO, 9
511:                 	stdio_write("                                  ");
9D01DFDC  0F40751F   JAL stdio_write
9D01DFE0  2604F4D8   ADDIU A0, S0, -2856
512:                 	video_gotoxy(3,10);
9D01DFE4  24040003   ADDIU A0, ZERO, 3
9D01DFE8  0F406D09   JAL video_gotoxy
9D01DFEC  2405000A   ADDIU A1, ZERO, 10
513:                 	stdio_write("                                  ");
9D01DFF0  0F40751F   JAL stdio_write
9D01DFF4  2604F4D8   ADDIU A0, S0, -2856
514:                 	video_gotoxy(3,11);
9D01DFF8  24040003   ADDIU A0, ZERO, 3
9D01DFFC  0F406D09   JAL video_gotoxy
9D01E000  2405000B   ADDIU A1, ZERO, 11
515:                 	stdio_write("                                  ");
9D01E004  0F40751F   JAL stdio_write
9D01E008  2604F4D8   ADDIU A0, S0, -2856
516:                 	
517:                 	//Draw frame
518:                 	video_set_color(MENU_FRAME_FG,MENU_FRAME_BG);
9D01E00C  2404000C   ADDIU A0, ZERO, 12
9D01E010  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01E014  00002821   ADDU A1, ZERO, ZERO
519:                 	fancyframe();
9D01E018  0F407701   JAL fancyframe
9D01E01C  00000000   NOP
520:                 	
521:                 	//Print menu text
522:                 	video_set_color(MENU_BANNER_FG,MENU_BANNER_BG);
9D01E020  00002021   ADDU A0, ZERO, ZERO
9D01E024  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01E028  2405000F   ADDIU A1, ZERO, 15
523:                 	video_gotoxy(TEXT_LEFT,2);
9D01E02C  24040004   ADDIU A0, ZERO, 4
9D01E030  0F406D09   JAL video_gotoxy
9D01E034  24050002   ADDIU A1, ZERO, 2
524:                 	stdio_write("Hackaday Belgrade Conference");
9D01E038  3C049D03   LUI A0, -25341
9D01E03C  0F40751F   JAL stdio_write
9D01E040  2484F4FC   ADDIU A0, A0, -2820
525:                 	video_gotoxy(TEXT_LEFT,5);
9D01E044  24040004   ADDIU A0, ZERO, 4
9D01E048  0F406D09   JAL video_gotoxy
9D01E04C  24050005   ADDIU A1, ZERO, 5
526:                 	video_set_color(MENU_HEADER_FG,MENU_HEADER_BG);
9D01E050  2404000F   ADDIU A0, ZERO, 15
9D01E054  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01E058  24050008   ADDIU A1, ZERO, 8
527:                 	stdio_write("Type a command and hit ENTER");
9D01E05C  3C029D03   LUI V0, -25341
9D01E060  0F40751F   JAL stdio_write
9D01E064  2444F51C   ADDIU A0, V0, -2788
528:                 	video_gotoxy(TEXT_LEFT,6);
9D01E068  24040004   ADDIU A0, ZERO, 4
9D01E06C  0F406D09   JAL video_gotoxy
9D01E070  24050006   ADDIU A1, ZERO, 6
529:                 	video_set_color(MENU_ENTRY_FG,MENU_ENTRY_BG);
9D01E074  2404000F   ADDIU A0, ZERO, 15
9D01E078  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01E07C  24050009   ADDIU A1, ZERO, 9
530:                 	stdio_write("1 - Hackaday BASIC");
9D01E080  3C039D03   LUI V1, -25341
9D01E084  0F40751F   JAL stdio_write
9D01E088  2464F53C   ADDIU A0, V1, -2756
531:                 	video_gotoxy(TEXT_LEFT,7);
9D01E08C  24040004   ADDIU A0, ZERO, 4
9D01E090  0F406D09   JAL video_gotoxy
9D01E094  24050007   ADDIU A1, ZERO, 7
532:                 	stdio_write("2 - CP/M @ Z80");
9D01E098  3C059D03   LUI A1, -25341
9D01E09C  0F40751F   JAL stdio_write
9D01E0A0  24A4F550   ADDIU A0, A1, -2736
533:                 	video_gotoxy(TEXT_LEFT,8);
9D01E0A4  24040004   ADDIU A0, ZERO, 4
9D01E0A8  0F406D09   JAL video_gotoxy
9D01E0AC  24050008   ADDIU A1, ZERO, 8
534:                 	stdio_write("3 - Tiny Basic @ 8080");
9D01E0B0  3C069D03   LUI A2, -25341
9D01E0B4  0F40751F   JAL stdio_write
9D01E0B8  24C4F560   ADDIU A0, A2, -2720
535:                 	video_gotoxy(TEXT_LEFT,9);
9D01E0BC  24040004   ADDIU A0, ZERO, 4
9D01E0C0  0F406D09   JAL video_gotoxy
9D01E0C4  24050009   ADDIU A1, ZERO, 9
536:                 	stdio_write("4 - Play Badgetris!");
9D01E0C8  3C079D03   LUI A3, -25341
9D01E0CC  0F40751F   JAL stdio_write
9D01E0D0  24E4F578   ADDIU A0, A3, -2696
537:                 	video_gotoxy(TEXT_LEFT,10);
9D01E0D4  24040004   ADDIU A0, ZERO, 4
9D01E0D8  0F406D09   JAL video_gotoxy
9D01E0DC  2405000A   ADDIU A1, ZERO, 10
538:                 	stdio_write("5 - Zork @ CP/M @ Z80");
9D01E0E0  3C089D03   LUI T0, -25341
9D01E0E4  0F40751F   JAL stdio_write
9D01E0E8  2504F58C   ADDIU A0, T0, -2676
539:                 	video_gotoxy(TEXT_LEFT,11);
9D01E0EC  24040004   ADDIU A0, ZERO, 4
9D01E0F0  0F406D09   JAL video_gotoxy
9D01E0F4  2405000B   ADDIU A1, ZERO, 11
540:                 	stdio_write("6 - User Program");
9D01E0F8  3C099D03   LUI T1, -25341
9D01E0FC  0F40751F   JAL stdio_write
9D01E100  2524F5A4   ADDIU A0, T1, -2652
541:                 	
542:                 	show_version();
9D01E104  0F407690   JAL show_version
9D01E108  00000000   NOP
543:                 	clear_prompt();
9D01E10C  0F4076A1   JAL clear_prompt
9D01E110  00000000   NOP
544:                 	}
9D01E114  8FBF0014   LW RA, 20(SP)
9D01E118  8FB00010   LW S0, 16(SP)
9D01E11C  03E00008   JR RA
9D01E120  27BD0018   ADDIU SP, SP, 24
545:                 
546:                 void show_version(void)
547:                 	{
9D01DA40  27BDFFE8   ADDIU SP, SP, -24
9D01DA44  AFBF0014   SW RA, 20(SP)
548:                 	video_set_color(MENU_VERSION_FG,MENU_DEFAULT_BG);
9D01DA48  24040008   ADDIU A0, ZERO, 8
9D01DA4C  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01DA50  00002821   ADDU A1, ZERO, ZERO
549:                 	video_gotoxy(VERSION_X,VERSION_Y);
9D01DA54  24040021   ADDIU A0, ZERO, 33
9D01DA58  0F406D09   JAL video_gotoxy
9D01DA5C  24050012   ADDIU A1, ZERO, 18
550:                 	stdio_write("v");
9D01DA60  3C049D03   LUI A0, -25341
9D01DA64  0F40751F   JAL stdio_write
9D01DA68  2484F4CC   ADDIU A0, A0, -2868
551:                 	stdio_write((int8_t *)get_firmware_string());
9D01DA6C  3C029D03   LUI V0, -25341
9D01DA70  0F40751F   JAL stdio_write
9D01DA74  2444F3E0   ADDIU A0, V0, -3104
552:                 	}
9D01DA78  8FBF0014   LW RA, 20(SP)
9D01DA7C  03E00008   JR RA
9D01DA80  27BD0018   ADDIU SP, SP, 24
553:                 
554:                 void fancyframe(void)
555:                 	{
9D01DC04  27BDFFE0   ADDIU SP, SP, -32
9D01DC08  AFBF001C   SW RA, 28(SP)
9D01DC0C  AFB20018   SW S2, 24(SP)
9D01DC10  AFB10014   SW S1, 20(SP)
9D01DC14  AFB00010   SW S0, 16(SP)
556:                 	uint16_t i;
557:                 	video_gotoxy(0,0);
9D01DC18  00002021   ADDU A0, ZERO, ZERO
9D01DC1C  0F406D09   JAL video_gotoxy
9D01DC20  00002821   ADDU A1, ZERO, ZERO
558:                 	stdio_c(201);
9D01DC24  0F4076E1   JAL stdio_c
9D01DC28  240400C9   ADDIU A0, ZERO, 201
559:                 	for (i=0; i<38; i++) stdio_c(205);
9D01DC2C  0F4076E1   JAL stdio_c
9D01DC30  240400CD   ADDIU A0, ZERO, 205
9D01DC34  0F4076E1   JAL stdio_c
9D01DC38  240400CD   ADDIU A0, ZERO, 205
9D01DC3C  24100024   ADDIU S0, ZERO, 36
9D01DC40  0F4076E1   JAL stdio_c
9D01DC44  240400CD   ADDIU A0, ZERO, 205
9D01DC48  2610FFFF   ADDIU S0, S0, -1
9D01DC4C  3211FFFF   ANDI S1, S0, -1
9D01DC50  0F4076E1   JAL stdio_c
9D01DC54  240400CD   ADDIU A0, ZERO, 205
9D01DC58  2622FFFF   ADDIU V0, S1, -1
9D01DC5C  3052FFFF   ANDI S2, V0, -1
9D01DC60  0F4076E1   JAL stdio_c
9D01DC64  240400CD   ADDIU A0, ZERO, 205
9D01DC68  2643FFFF   ADDIU V1, S2, -1
9D01DC6C  3070FFFF   ANDI S0, V1, -1
9D01DC70  0F4076E1   JAL stdio_c
9D01DC74  240400CD   ADDIU A0, ZERO, 205
9D01DC78  2604FFFF   ADDIU A0, S0, -1
9D01DC7C  3091FFFF   ANDI S1, A0, -1
9D01DC80  0F4076E1   JAL stdio_c
9D01DC84  240400CD   ADDIU A0, ZERO, 205
9D01DC88  2625FFFF   ADDIU A1, S1, -1
9D01DC8C  30B2FFFF   ANDI S2, A1, -1
9D01DC90  0F4076E1   JAL stdio_c
9D01DC94  240400CD   ADDIU A0, ZERO, 205
9D01DC98  2646FFFF   ADDIU A2, S2, -1
9D01DC9C  30D0FFFF   ANDI S0, A2, -1
9D01DCA0  0F4076E1   JAL stdio_c
9D01DCA4  240400CD   ADDIU A0, ZERO, 205
9D01DCA8  2607FFFF   ADDIU A3, S0, -1
9D01DCAC  30F1FFFF   ANDI S1, A3, -1
9D01DCB0  0F4076E1   JAL stdio_c
9D01DCB4  240400CD   ADDIU A0, ZERO, 205
9D01DCB8  2628FFFF   ADDIU T0, S1, -1
9D01DCBC  3112FFFF   ANDI S2, T0, -1
9D01DCC0  0F4076E1   JAL stdio_c
9D01DCC4  240400CD   ADDIU A0, ZERO, 205
9D01DCC8  2649FFFF   ADDIU T1, S2, -1
9D01DCCC  3130FFFF   ANDI S0, T1, -1
9D01DCD0  1600FFDB   BNE S0, ZERO, 0x9D01DC40
9D01DCD4  00000000   NOP
560:                 	stdio_c(187);
9D01DCD8  0F4076E1   JAL stdio_c
9D01DCDC  240400BB   ADDIU A0, ZERO, 187
561:                 	video_gotoxy(0,39);
9D01DCE0  00002021   ADDU A0, ZERO, ZERO
9D01DCE4  0F406D09   JAL video_gotoxy
9D01DCE8  24050027   ADDIU A1, ZERO, 39
562:                 	stdio_c(200);
9D01DCEC  0F4076E1   JAL stdio_c
9D01DCF0  240400C8   ADDIU A0, ZERO, 200
563:                 	for (i=0; i<38; i++) stdio_c(205);
9D01DCF4  0F4076E1   JAL stdio_c
9D01DCF8  240400CD   ADDIU A0, ZERO, 205
9D01DCFC  0F4076E1   JAL stdio_c
9D01DD00  240400CD   ADDIU A0, ZERO, 205
9D01DD04  24100024   ADDIU S0, ZERO, 36
9D01DD08  0F4076E1   JAL stdio_c
9D01DD0C  240400CD   ADDIU A0, ZERO, 205
9D01DD10  260AFFFF   ADDIU T2, S0, -1
9D01DD14  3151FFFF   ANDI S1, T2, -1
9D01DD18  0F4076E1   JAL stdio_c
9D01DD1C  240400CD   ADDIU A0, ZERO, 205
9D01DD20  262BFFFF   ADDIU T3, S1, -1
9D01DD24  3172FFFF   ANDI S2, T3, -1
9D01DD28  0F4076E1   JAL stdio_c
9D01DD2C  240400CD   ADDIU A0, ZERO, 205
9D01DD30  264CFFFF   ADDIU T4, S2, -1
9D01DD34  3190FFFF   ANDI S0, T4, -1
9D01DD38  0F4076E1   JAL stdio_c
9D01DD3C  240400CD   ADDIU A0, ZERO, 205
9D01DD40  260DFFFF   ADDIU T5, S0, -1
9D01DD44  31B1FFFF   ANDI S1, T5, -1
9D01DD48  0F4076E1   JAL stdio_c
9D01DD4C  240400CD   ADDIU A0, ZERO, 205
9D01DD50  262EFFFF   ADDIU T6, S1, -1
9D01DD54  31D2FFFF   ANDI S2, T6, -1
9D01DD58  0F4076E1   JAL stdio_c
9D01DD5C  240400CD   ADDIU A0, ZERO, 205
9D01DD60  264FFFFF   ADDIU T7, S2, -1
9D01DD64  31F0FFFF   ANDI S0, T7, -1
9D01DD68  0F4076E1   JAL stdio_c
9D01DD6C  240400CD   ADDIU A0, ZERO, 205
9D01DD70  2618FFFF   ADDIU T8, S0, -1
9D01DD74  3311FFFF   ANDI S1, T8, -1
9D01DD78  0F4076E1   JAL stdio_c
9D01DD7C  240400CD   ADDIU A0, ZERO, 205
9D01DD80  2639FFFF   ADDIU T9, S1, -1
9D01DD84  3332FFFF   ANDI S2, T9, -1
9D01DD88  0F4076E1   JAL stdio_c
9D01DD8C  240400CD   ADDIU A0, ZERO, 205
9D01DD90  2642FFFF   ADDIU V0, S2, -1
9D01DD94  3050FFFF   ANDI S0, V0, -1
9D01DD98  1600FFDB   BNE S0, ZERO, 0x9D01DD08
9D01DD9C  00000000   NOP
564:                 	stdio_c(188);
9D01DDA0  0F4076E1   JAL stdio_c
9D01DDA4  240400BC   ADDIU A0, ZERO, 188
565:                 	for (i=1; i<19; i++)
9D01DDA8  24100001   ADDIU S0, ZERO, 1
9D01DDAC  24120013   ADDIU S2, ZERO, 19
9D01DDDC  26030001   ADDIU V1, S0, 1
9D01DDE0  3070FFFF   ANDI S0, V1, -1
9D01DE10  26040001   ADDIU A0, S0, 1
9D01DE14  3090FFFF   ANDI S0, A0, -1
9D01DE44  26050001   ADDIU A1, S0, 1
9D01DE48  30B0FFFF   ANDI S0, A1, -1
9D01DE78  26060001   ADDIU A2, S0, 1
9D01DE7C  30D0FFFF   ANDI S0, A2, -1
9D01DEAC  26070001   ADDIU A3, S0, 1
9D01DEB0  30F0FFFF   ANDI S0, A3, -1
9D01DEE0  26080001   ADDIU T0, S0, 1
9D01DEE4  3110FFFF   ANDI S0, T0, -1
9D01DEE8  1612FFB2   BNE S0, S2, 0x9D01DDB4
9D01DEEC  7C108C20   SEB S1, S0
566:                 		{
567:                 		video_gotoxy(0,i);
9D01DDB0  7C108C20   SEB S1, S0
9D01DDB4  00002021   ADDU A0, ZERO, ZERO
9D01DDB8  0F406D09   JAL video_gotoxy
9D01DDBC  02202821   ADDU A1, S1, ZERO
9D01DDE4  7C108C20   SEB S1, S0
9D01DDE8  00002021   ADDU A0, ZERO, ZERO
9D01DDEC  0F406D09   JAL video_gotoxy
9D01DDF0  02202821   ADDU A1, S1, ZERO
9D01DE18  7C108C20   SEB S1, S0
9D01DE1C  00002021   ADDU A0, ZERO, ZERO
9D01DE20  0F406D09   JAL video_gotoxy
9D01DE24  02202821   ADDU A1, S1, ZERO
9D01DE4C  7C108C20   SEB S1, S0
9D01DE50  00002021   ADDU A0, ZERO, ZERO
9D01DE54  0F406D09   JAL video_gotoxy
9D01DE58  02202821   ADDU A1, S1, ZERO
9D01DE80  7C108C20   SEB S1, S0
9D01DE84  00002021   ADDU A0, ZERO, ZERO
9D01DE88  0F406D09   JAL video_gotoxy
9D01DE8C  02202821   ADDU A1, S1, ZERO
9D01DEB4  7C108C20   SEB S1, S0
9D01DEB8  00002021   ADDU A0, ZERO, ZERO
9D01DEBC  0F406D09   JAL video_gotoxy
9D01DEC0  02202821   ADDU A1, S1, ZERO
568:                 		stdio_c(186);
9D01DDC0  0F4076E1   JAL stdio_c
9D01DDC4  240400BA   ADDIU A0, ZERO, 186
9D01DDF4  0F4076E1   JAL stdio_c
9D01DDF8  240400BA   ADDIU A0, ZERO, 186
9D01DE28  0F4076E1   JAL stdio_c
9D01DE2C  240400BA   ADDIU A0, ZERO, 186
9D01DE5C  0F4076E1   JAL stdio_c
9D01DE60  240400BA   ADDIU A0, ZERO, 186
9D01DE90  0F4076E1   JAL stdio_c
9D01DE94  240400BA   ADDIU A0, ZERO, 186
9D01DEC4  0F4076E1   JAL stdio_c
9D01DEC8  240400BA   ADDIU A0, ZERO, 186
569:                 		video_gotoxy(39,i);
9D01DDC8  24040027   ADDIU A0, ZERO, 39
9D01DDCC  0F406D09   JAL video_gotoxy
9D01DDD0  02202821   ADDU A1, S1, ZERO
9D01DDFC  24040027   ADDIU A0, ZERO, 39
9D01DE00  0F406D09   JAL video_gotoxy
9D01DE04  02202821   ADDU A1, S1, ZERO
9D01DE30  24040027   ADDIU A0, ZERO, 39
9D01DE34  0F406D09   JAL video_gotoxy
9D01DE38  02202821   ADDU A1, S1, ZERO
9D01DE64  24040027   ADDIU A0, ZERO, 39
9D01DE68  0F406D09   JAL video_gotoxy
9D01DE6C  02202821   ADDU A1, S1, ZERO
9D01DE98  24040027   ADDIU A0, ZERO, 39
9D01DE9C  0F406D09   JAL video_gotoxy
9D01DEA0  02202821   ADDU A1, S1, ZERO
9D01DECC  24040027   ADDIU A0, ZERO, 39
9D01DED0  0F406D09   JAL video_gotoxy
9D01DED4  02202821   ADDU A1, S1, ZERO
570:                 		stdio_c(186);
9D01DDD4  0F4076E1   JAL stdio_c
9D01DDD8  240400BA   ADDIU A0, ZERO, 186
9D01DE08  0F4076E1   JAL stdio_c
9D01DE0C  240400BA   ADDIU A0, ZERO, 186
9D01DE3C  0F4076E1   JAL stdio_c
9D01DE40  240400BA   ADDIU A0, ZERO, 186
9D01DE70  0F4076E1   JAL stdio_c
9D01DE74  240400BA   ADDIU A0, ZERO, 186
9D01DEA4  0F4076E1   JAL stdio_c
9D01DEA8  240400BA   ADDIU A0, ZERO, 186
9D01DED8  0F4076E1   JAL stdio_c
9D01DEDC  240400BA   ADDIU A0, ZERO, 186
571:                 		}
572:                 	}
9D01DEF0  8FBF001C   LW RA, 28(SP)
9D01DEF4  8FB20018   LW S2, 24(SP)
9D01DEF8  8FB10014   LW S1, 20(SP)
9D01DEFC  8FB00010   LW S0, 16(SP)
9D01DF00  03E00008   JR RA
9D01DF04  27BD0020   ADDIU SP, SP, 32
573:                 
574:                 void clear_prompt(void)
575:                 	{
9D01DA84  27BDFFE0   ADDIU SP, SP, -32
9D01DA88  AFBF001C   SW RA, 28(SP)
9D01DA8C  AFB10018   SW S1, 24(SP)
9D01DA90  AFB00014   SW S0, 20(SP)
576:                 	//Clear prompt area
577:                 	video_gotoxy(TEXT_LEFT,PROMPT_Y);
9D01DA94  24040004   ADDIU A0, ZERO, 4
9D01DA98  0F406D09   JAL video_gotoxy
9D01DA9C  2405000F   ADDIU A1, ZERO, 15
578:                 	int16_t i;
579:                 	for (i=TEXT_LEFT; i<39; i++) stdio_write(" ");
9D01DAA0  3C109D03   LUI S0, -25341
9D01DAA4  2610F4D0   ADDIU S0, S0, -2864
9D01DAA8  0F40751F   JAL stdio_write
9D01DAAC  02002021   ADDU A0, S0, ZERO
9D01DAB0  0F40751F   JAL stdio_write
9D01DAB4  02002021   ADDU A0, S0, ZERO
9D01DAB8  0F40751F   JAL stdio_write
9D01DABC  02002021   ADDU A0, S0, ZERO
9D01DAC0  24110020   ADDIU S1, ZERO, 32
9D01DAC4  0F40751F   JAL stdio_write
9D01DAC8  02002021   ADDU A0, S0, ZERO
9D01DACC  2631FFFF   ADDIU S1, S1, -1
9D01DAD0  3231FFFF   ANDI S1, S1, -1
9D01DAD4  0F40751F   JAL stdio_write
9D01DAD8  02002021   ADDU A0, S0, ZERO
9D01DADC  2622FFFF   ADDIU V0, S1, -1
9D01DAE0  3051FFFF   ANDI S1, V0, -1
9D01DAE4  0F40751F   JAL stdio_write
9D01DAE8  02002021   ADDU A0, S0, ZERO
9D01DAEC  2623FFFF   ADDIU V1, S1, -1
9D01DAF0  3071FFFF   ANDI S1, V1, -1
9D01DAF4  0F40751F   JAL stdio_write
9D01DAF8  02002021   ADDU A0, S0, ZERO
9D01DAFC  2624FFFF   ADDIU A0, S1, -1
9D01DB00  3091FFFF   ANDI S1, A0, -1
9D01DB04  0F40751F   JAL stdio_write
9D01DB08  02002021   ADDU A0, S0, ZERO
9D01DB0C  2625FFFF   ADDIU A1, S1, -1
9D01DB10  30B1FFFF   ANDI S1, A1, -1
9D01DB14  0F40751F   JAL stdio_write
9D01DB18  02002021   ADDU A0, S0, ZERO
9D01DB1C  2626FFFF   ADDIU A2, S1, -1
9D01DB20  30D1FFFF   ANDI S1, A2, -1
9D01DB24  0F40751F   JAL stdio_write
9D01DB28  02002021   ADDU A0, S0, ZERO
9D01DB2C  2627FFFF   ADDIU A3, S1, -1
9D01DB30  30F1FFFF   ANDI S1, A3, -1
9D01DB34  0F40751F   JAL stdio_write
9D01DB38  02002021   ADDU A0, S0, ZERO
9D01DB3C  2628FFFF   ADDIU T0, S1, -1
9D01DB40  3111FFFF   ANDI S1, T0, -1
9D01DB44  1620FFDF   BNE S1, ZERO, 0x9D01DAC4
9D01DB48  00000000   NOP
580:                 	
581:                 	video_set_color(MENU_DEFAULT_FG, MENU_DEFAULT_BG);
9D01DB4C  2404000F   ADDIU A0, ZERO, 15
9D01DB50  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01DB54  00002821   ADDU A1, ZERO, ZERO
582:                 	video_gotoxy(TEXT_LEFT,PROMPT_Y);
9D01DB58  24040004   ADDIU A0, ZERO, 4
9D01DB5C  0F406D09   JAL video_gotoxy
9D01DB60  2405000F   ADDIU A1, ZERO, 15
583:                 	stdio_write("> ");
9D01DB64  3C099D03   LUI T1, -25341
9D01DB68  0F40751F   JAL stdio_write
9D01DB6C  2524F4D4   ADDIU A0, T1, -2860
584:                 	}
9D01DB70  8FBF001C   LW RA, 28(SP)
9D01DB74  8FB10018   LW S1, 24(SP)
9D01DB78  8FB00014   LW S0, 20(SP)
9D01DB7C  03E00008   JR RA
9D01DB80  27BD0020   ADDIU SP, SP, 32
585:                 
586:                 void show_wrencher(void)
587:                 	{
9D01E4C4  27BDFFE0   ADDIU SP, SP, -32
9D01E4C8  AFBF001C   SW RA, 28(SP)
9D01E4CC  AFB10018   SW S1, 24(SP)
588:                 	int8_t i;
589:                 	video_clrscr();
9D01E4D0  0F406DBA   JAL video_clrscr
9D01E4D4  AFB00014   SW S0, 20(SP)
590:                 	video_set_color(2,0);
9D01E4D8  24040002   ADDIU A0, ZERO, 2
9D01E4DC  0F406C6C   JAL .LFB8, .LFE58, video_set_color
9D01E4E0  00002821   ADDU A1, ZERO, ZERO
591:                 	video_gotoxy(0,1);
9D01E4E4  00002021   ADDU A0, ZERO, ZERO
9D01E4E8  0F406D09   JAL video_gotoxy
9D01E4EC  24050001   ADDIU A1, ZERO, 1
9D01E4F0  3C109D03   LUI S0, -25341
9D01E4F4  2610F8FC   ADDIU S0, S0, -1796
9D01E4F8  261102E2   ADDIU S1, S0, 738
592:                 	for (i=0; i<18; i++)
9D01E54C  1611FFEB   BNE S0, S1, 0x9D01E4FC
9D01E550  00000000   NOP
593:                 		{
594:                 		stdio_write((int8_t *)wrencher[i]);
9D01E4FC  0F40751F   JAL stdio_write
9D01E500  02002021   ADDU A0, S0, ZERO
9D01E504  26100029   ADDIU S0, S0, 41
9D01E508  0F40751F   JAL stdio_write
9D01E50C  02002021   ADDU A0, S0, ZERO
9D01E510  0F40751F   JAL stdio_write
9D01E514  26040029   ADDIU A0, S0, 41
9D01E518  0F40751F   JAL stdio_write
9D01E51C  26040052   ADDIU A0, S0, 82
9D01E520  0F40751F   JAL stdio_write
9D01E524  2604007B   ADDIU A0, S0, 123
9D01E528  0F40751F   JAL stdio_write
9D01E52C  260400A4   ADDIU A0, S0, 164
9D01E530  0F40751F   JAL stdio_write
9D01E534  260400CD   ADDIU A0, S0, 205
9D01E538  0F40751F   JAL stdio_write
9D01E53C  260400F6   ADDIU A0, S0, 246
9D01E540  0F40751F   JAL stdio_write
9D01E544  2604011F   ADDIU A0, S0, 287
9D01E548  26100148   ADDIU S0, S0, 328
595:                 		}
596:                 	wait_ms(200);
9D01E554  0F409FC8   JAL wait_ms
9D01E558  240400C8   ADDIU A0, ZERO, 200
597:                 	i = 0;
9D01E55C  00001821   ADDU V1, ZERO, ZERO
598:                 	uint8_t loopbreak = 0;
599:                 	while(1)
600:                 		{
601:                 		loopbreak = playriff(i++);
9D01E560  24620001   ADDIU V0, V1, 1
9D01E564  7C028C20   SEB S1, V0
9D01E568  0F4078D3   JAL playriff
9D01E56C  306400FF   ANDI A0, V1, 255
9D01E578  0004880A   MOVZ S1, ZERO, A0
9D01E57C  0B407958   J 0x9D01E560
9D01E580  02201821   ADDU V1, S1, ZERO
602:                 		if (loopbreak) break;
9D01E570  14400004   BNE V0, ZERO, 0x9D01E584
9D01E574  2A240004   SLTI A0, S1, 4
603:                 		if (i > 3) i = 0;
604:                 		}
605:                 	showmenu();
9D01E584  0F4077C2   JAL showmenu
9D01E588  00000000   NOP
606:                 	}
9D01E58C  8FBF001C   LW RA, 28(SP)
9D01E590  8FB10018   LW S1, 24(SP)
9D01E594  8FB00014   LW S0, 20(SP)
9D01E598  03E00008   JR RA
9D01E59C  27BD0020   ADDIU SP, SP, 32
607:                 
608:                 uint8_t playriff(uint8_t raisetop)
609:                 	{
9D01E34C  27BDFFA0   ADDIU SP, SP, -96
9D01E350  AFBF005C   SW RA, 92(SP)
9D01E354  AFB00058   SW S0, 88(SP)
9D01E358  00808021   ADDU S0, A0, ZERO
610:                 	const uint16_t riffdelays[3] = {78,236,393};
9D01E35C  3C029D03   LUI V0, -25341
9D01E360  2443F5B8   ADDIU V1, V0, -2632
9D01E364  88640003   LWL A0, 3(V1)
9D01E368  9844F5B8   LWR A0, -2632(V0)
9D01E36C  AFA40010   SW A0, 16(SP)
9D01E370  94660004   LHU A2, 4(V1)
9D01E374  A7A60014   SH A2, 20(SP)
611:                 	const uint8_t riff[14][4] =
9D01E378  3C079D03   LUI A3, -25341
9D01E37C  24E8F5C0   ADDIU T0, A3, -2624
9D01E380  89090003   LWL T1, 3(T0)
9D01E384  99090000   LWR T1, 0(T0)
9D01E388  890A0007   LWL T2, 7(T0)
9D01E38C  990A0004   LWR T2, 4(T0)
9D01E390  890B000B   LWL T3, 11(T0)
9D01E394  990B0008   LWR T3, 8(T0)
9D01E398  890C000F   LWL T4, 15(T0)
9D01E39C  990C000C   LWR T4, 12(T0)
9D01E3A0  AFA90018   SW T1, 24(SP)
9D01E3A4  AFAA001C   SW T2, 28(SP)
9D01E3A8  AFAB0020   SW T3, 32(SP)
9D01E3AC  AFAC0024   SW T4, 36(SP)
9D01E3B0  250D0010   ADDIU T5, T0, 16
9D01E3B4  27AF0028   ADDIU T7, SP, 40
9D01E3B8  01E0C021   ADDU T8, T7, ZERO
9D01E3BC  89B90003   LWL T9, 3(T5)
9D01E3C0  99B90000   LWR T9, 0(T5)
9D01E3C4  89BF0007   LWL RA, 7(T5)
9D01E3C8  99BF0004   LWR RA, 4(T5)
9D01E3CC  89A2000B   LWL V0, 11(T5)
9D01E3D0  99A20008   LWR V0, 8(T5)
9D01E3D4  89A3000F   LWL V1, 15(T5)
9D01E3D8  99A3000C   LWR V1, 12(T5)
9D01E3DC  ADF90000   SW T9, 0(T7)
9D01E3E0  ADFF0004   SW RA, 4(T7)
9D01E3E4  ADE20008   SW V0, 8(T7)
9D01E3E8  AF03000C   SW V1, 12(T8)
9D01E3EC  25A50010   ADDIU A1, T5, 16
9D01E3F0  88A80003   LWL T0, 3(A1)
9D01E3F4  98A80000   LWR T0, 0(A1)
9D01E3F8  88A70007   LWL A3, 7(A1)
9D01E3FC  98A70004   LWR A3, 4(A1)
9D01E400  88A6000B   LWL A2, 11(A1)
9D01E404  98A60008   LWR A2, 8(A1)
9D01E408  88A9000F   LWL T1, 15(A1)
9D01E40C  98A9000C   LWR T1, 12(A1)
9D01E410  ADE80010   SW T0, 16(T7)
9D01E414  ADE70014   SW A3, 20(T7)
9D01E418  ADE60018   SW A2, 24(T7)
9D01E41C  ADE9001C   SW T1, 28(T7)
9D01E420  25AB0020   ADDIU T3, T5, 32
9D01E424  896C0003   LWL T4, 3(T3)
9D01E428  996C0000   LWR T4, 0(T3)
9D01E42C  896D0007   LWL T5, 7(T3)
9D01E430  996D0004   LWR T5, 4(T3)
9D01E434  ADEC0020   SW T4, 32(T7)
9D01E438  ADED0024   SW T5, 36(T7)
612:                 		{
613:                 			{0,62,69,0},
614:                 			{0,0,0,0},
615:                 			{0,62,69,0},
616:                 			{0,0,0,0},
617:                 			{0,62,69,1},
618:                 			{0,0,0,2},
619:                 			{0,62,69,0},
620:                 			{0,0,0,0},
621:                 			{0,62,69,0},
622:                 			{0,0,0,0},
623:                 			{0,62,69,1},
624:                 			{0,0,0,0},
625:                 			{50,0,0,1},
626:                 			{0,0,0,0}
627:                 		};
628:                 	uint8_t i;
629:                 	for (i=0; i<14; i++)
9D01E43C  A3A00050   SB ZERO, 80(SP)
9D01E440  00006021   ADDU T4, ZERO, ZERO
9D01E490  93A60050   LBU A2, 80(SP)
9D01E494  24CB0001   ADDIU T3, A2, 1
9D01E498  316C00FF   ANDI T4, T3, 255
9D01E49C  2D8D000E   SLTIU T5, T4, 14
9D01E4A0  15A0FFE8   BNE T5, ZERO, .LBB4
9D01E4A4  A3AC0050   SB T4, 80(SP)
630:                 		{
631:                 		uint8_t top = 0;
632:                 		if (riff[i][2] != 0)
9D01E444  01807821   ADDU T7, T4, ZERO
9D01E448  000CC080   SLL T8, T4, 2
9D01E44C  27B90010   ADDIU T9, SP, 16
9D01E450  0338F821   ADDU RA, T9, T8
9D01E454  93E2000A   LBU V0, 10(RA)
9D01E458  10400003   BEQ V0, ZERO, 0x9D01E468
9D01E45C  00003021   ADDU A2, ZERO, ZERO
633:                 			{
634:                 			top = riff[i][2] + raisetop;
9D01E460  02021821   ADDU V1, S0, V0
9D01E464  306600FF   ANDI A2, V1, 255
635:                 			}
636:                 		sound_play_notes(riff[i][0],riff[i][1],top,riffdelays[riff[i][3]]);	
9D01E468  000F2880   SLL A1, T7, 2
9D01E46C  27A40010   ADDIU A0, SP, 16
9D01E470  00854021   ADDU T0, A0, A1
9D01E474  9107000B   LBU A3, 11(T0)
9D01E478  00074840   SLL T1, A3, 1
9D01E47C  00895021   ADDU T2, A0, T1
9D01E480  91040008   LBU A0, 8(T0)
9D01E484  91050009   LBU A1, 9(T0)
9D01E488  0F409FD9   JAL sound_play_notes
9D01E48C  95470000   LHU A3, 0(T2)
637:                 		}
638:                 		if (stdio_get(&i) != 0) { return 1; }
9D01E4A8  0F4078AD   JAL stdio_get
9D01E4AC  27A40050   ADDIU A0, SP, 80
639:                 	return 0;
640:                 	}
9D01E4B0  0002102B   SLTU V0, ZERO, V0
9D01E4B4  8FBF005C   LW RA, 92(SP)
9D01E4B8  8FB00058   LW S0, 88(SP)
9D01E4BC  03E00008   JR RA
9D01E4C0  27BD0060   ADDIU SP, SP, 96
641:                 
642:                 
643:                 //housekeeping stuff. call this function often
644:                 void loop_badge(void)
645:                 	{
9D01CE78  27BDFFE0   ADDIU SP, SP, -32
9D01CE7C  AFBF001C   SW RA, 28(SP)
646:                 	volatile uint16_t dbg;
647:                 	static uint8_t brk_is_pressed;
648:                 	dbg = PORTD;
9D01CE80  3C02BF88   LUI V0, -16504
9D01CE84  8C436320   LW V1, 25376(V0)
9D01CE88  3064FFFF   ANDI A0, V1, -1
9D01CE8C  A7A40010   SH A0, 16(SP)
649:                 	if (K_PWR==0)
9D01CE90  3C05BF88   LUI A1, -16504
9D01CE94  8CA36620   LW V1, 26144(A1)
650:                 		{
651:                 		//while (K_PWR==0);
652:                 		//wait_ms(100);
653:                 		//hw_sleep();
654:                 		//wait_ms(30);
655:                 		//while (K_PWR==0);
656:                 		//wait_ms(300);
657:                 		}
658:                 	if (KEY_BRK==0)
9D01CE98  8CA66620   LW A2, 26144(A1)
9D01CE9C  30C70200   ANDI A3, A2, 512
9D01CEA0  54E00023   BNEL A3, ZERO, 0x9D01CF30
9D01CEA4  A380807D   SB ZERO, -32643(GP)
659:                 		{
660:                 		if ((K_SHIFTL==0)&(K_SHIFTR==0)&(brk_is_pressed==9))
9D01CEA8  3C08BF88   LUI T0, -16504
9D01CEAC  8D096320   LW T1, 25376(T0)
9D01CEB0  8D0A6320   LW T2, 25376(T0)
9D01CEB4  392B0400   XORI T3, T1, 1024
9D01CEB8  7D6C0280   EXT T4, T3, 10, 1
9D01CEBC  394D0200   XORI T5, T2, 512
9D01CEC0  7DAE0240   EXT T6, T5, 9, 1
9D01CEC4  018E7824   AND T7, T4, T6
9D01CEC8  11E00012   BEQ T7, ZERO, 0x9D01CF14
9D01CECC  24050001   ADDIU A1, ZERO, 1
9D01CED0  9398807D   LBU T8, -32643(GP)
9D01CED4  3B190009   XORI T9, T8, 9
9D01CED8  1720000E   BNE T9, ZERO, 0x9D01CF14
9D01CEDC  00000000   NOP
661:                 			{
662:                 			serial_flush();
9D01CEE0  0F40A105   JAL serial_flush
9D01CEE4  00000000   NOP
663:                 			if (stdio_src == STDIO_TTY1)
9D01CEE8  938281D9   LBU V0, -32295(GP)
9D01CEEC  7C021C20   SEB V1, V0
9D01CEF0  24040001   ADDIU A0, ZERO, 1
9D01CEF4  14640004   BNE V1, A0, 0x9D01CF08
9D01CEF8  241F0001   ADDIU RA, ZERO, 1
664:                 				stdio_src = STDIO_LOCAL;
9D01CEFC  A38081D9   SB ZERO, -32295(GP)
9D01CF00  0B4073C7   J 0x9D01CF1C
9D01CF04  9386807D   LBU A2, -32643(GP)
665:                 			else
666:                 				stdio_src = STDIO_TTY1;
9D01CF08  A39F81D9   SB RA, -32295(GP)
667:                 			}
668:                 		else
669:                 			brk_key = 1;
9D01CF14  A38581E5   SB A1, -32283(GP)
670:                 		if (brk_is_pressed<10) brk_is_pressed++;
9D01CF0C  0B4073C7   J 0x9D01CF1C
9D01CF10  9386807D   LBU A2, -32643(GP)
9D01CF18  9386807D   LBU A2, -32643(GP)
9D01CF1C  2CC7000A   SLTIU A3, A2, 10
9D01CF20  10E00004   BEQ A3, ZERO, 0x9D01CF34
9D01CF24  8FBF001C   LW RA, 28(SP)
9D01CF28  24C80001   ADDIU T0, A2, 1
9D01CF2C  A388807D   SB T0, -32643(GP)
671:                 		}
672:                 	else
673:                 		brk_is_pressed = 0;
674:                 	}
9D01CF30  8FBF001C   LW RA, 28(SP)
9D01CF34  03E00008   JR RA
9D01CF38  27BD0020   ADDIU SP, SP, 32
675:                 
676:                 //B_BDG004
677:                 void enable_display_scanning(uint8_t onoff)
678:                 	{
679:                 	//Turns vt100 scanning on or off
680:                 	if (onoff) handle_display = 1;
9D01CF3C  10800004   BEQ A0, ZERO, 0x9D01CF50
9D01CF40  24020001   ADDIU V0, ZERO, 1
9D01CF44  A3828014   SB V0, -32748(GP)
9D01CF48  03E00008   JR RA
9D01CF4C  00000000   NOP
681:                 	else handle_display = 0;
9D01CF50  A3808014   SB ZERO, -32748(GP)
9D01CF54  03E00008   JR RA
9D01CF58  00000000   NOP
682:                 	}
683:                 
684:                 uint32_t millis(void)
685:                 	{
686:                 	return ticks;
9D01CF5C  8F8281E8   LW V0, -32280(GP)
687:                 	}
9D01CF60  03E00008   JR RA
9D01CF64  00000000   NOP
688:                 
689:                 //void init_8080_basic (void)
690:                 //	{
691:                 //	video_set_color(15,0);
692:                 //	for (i=0;i<2048;i++) ram[i] = b2_rom[i];
693:                 //	for (i=0;i<30;i++) ram[i+0x1000] = ram_init[i];
694:                 //	wrk_ram	= PC = STACK = ram;
695:                 //	init_io(IO_BASIC_MODE);
696:                 //	}
697:                 //
698:                 //void loop_8080_basic (void)
699:                 //	{
700:                 //	cpu_error = NONE;
701:                 //	cpu();	
702:                 //	}
703:                 
704:                 //void init_z80_cpm (void)
705:                 //	{
706:                 //	video_set_color(15,0);
707:                 //#ifdef	USE_RAM_IMAGE	
708:                 //	for (i=0;i<65536;i++) ram[i] = ram_image[i];
709:                 //#endif	
710:                 //#ifdef	USE_RAMDISK
711:                 //	for (i=0;i<RAMDISK_SIZE;i++) ram_disk[i] = 0xE5;
712:                 //#endif
713:                 //	wrk_ram	= PC = STACK = ram;
714:                 //	init_io(IO_CPM_MODE);
715:                 //	}
716:                 
717:                 //void loop_z80_cpm (void)
718:                 //	{
719:                 //	cpu_error = NONE;
720:                 //	cpu();	
721:                 //	}
722:                 
723:                 //B_BAS005
724:                 //void init_basic (void)
725:                 //	{
726:                 //	stdio_write("BASIC interpreter\n");
727:                 //	prompt = 1;
728:                 //	brk_key = 0;
729:                 //	cmd_line_pointer=0;
730:                 //	cmd_line_buff[0] = 0;
731:                 //	video_set_color(15,0);
732:                 //	}
733:                 ////B_BAS006
734:                 //void loop_basic (void)
735:                 //	{
736:                 //	if (prompt==1)
737:                 //	    {
738:                 //	    stdio_write(">");	
739:                 //	    prompt = 0;
740:                 //	    }
741:                 //	get_stat = stdio_get(&char_out);
742:                 //	if (get_stat!=0)
743:                 //	    {
744:                 //	    stdio_c(char_out);	
745:                 //	    if (char_out==NEWLINE) 
746:                 //			{
747:                 //			cmd_line_buff[cmd_line_pointer] = 0;
748:                 //			cmd_exec (cmd_line_buff);
749:                 //			cmd_line_pointer=0;
750:                 //			cmd_line_buff[0] = 0;
751:                 //			prompt = 1;			
752:                 //			}
753:                 //	    else
754:                 //			{
755:                 //			if ((char_out>=' ')&(char_out<0x7F)) cmd_line_buff[cmd_line_pointer++] = char_out;
756:                 //			else if (char_out==BACKSPACE)
757:                 //				{
758:                 //				if (cmd_line_pointer>0) 
759:                 //					cmd_line_buff[--cmd_line_pointer]=0;
760:                 //				}
761:                 //
762:                 //			}
763:                 //	    }	
764:                 //	}
765:                 
766:                 ////B_BDG007
767:                 //void init_userprog (void)
768:                 //{
769:                 //	user_program_init();
770:                 //}
771:                 //
772:                 ////B_BDG008
773:                 //void loop_userprog (void)
774:                 //{
775:                 //	user_program_loop();
776:                 //}
777:                 
778:                 void clr_buffer (void)
779:                 	{
780:                 	for (i=0; i<DISP_BUFFER_HIGH+1; i++)
9D01CF68  00003821   ADDU A3, ZERO, ZERO
9D01CF6C  3C0BA000   LUI T3, -24576
9D01CF70  256D198C   ADDIU T5, T3, 6540
9D01CF74  3C0AA000   LUI T2, -24576
9D01CF78  254E1644   ADDIU T6, T2, 5700
9D01CF84  240C0348   ADDIU T4, ZERO, 840
9D01CF88  00001021   ADDU V0, ZERO, ZERO
9D01CF8C  01A72021   ADDU A0, T5, A3
9D01CF90  01C71821   ADDU V1, T6, A3
9D01CF94  00823021   ADDU A2, A0, V0
9D01D000  54ECFFE2   BNEL A3, T4, 0x9D01CF8C
9D01D004  00001021   ADDU V0, ZERO, ZERO
9D01D008  240D0028   ADDIU T5, ZERO, 40
9D01D00C  AF8D81D4   SW T5, -32300(GP)
9D01D010  240E0015   ADDIU T6, ZERO, 21
9D01D014  03E00008   JR RA
9D01D018  AF8E81E0   SW T6, -32288(GP)
781:                 		{
782:                 		for (j=0; j<DISP_BUFFER_WIDE; j++) 
9D01CF80  24090028   ADDIU T1, ZERO, 40
9D01CFF4  1449FFE7   BNE V0, T1, 0x9D01CF94
9D01CFF8  A1450000   SB A1, 0(T2)
9D01CFFC  24E70028   ADDIU A3, A3, 40
783:                 			{
784:                 			disp_buffer[i][j] = 0;		//Blank the buffer
9D01CF98  A0C00000   SB ZERO, 0(A2)
9D01CF9C  00624021   ADDU T0, V1, V0
9D01CFAC  A3000000   SB ZERO, 0(T8)
9D01CFB0  0062C821   ADDU T9, V1, V0
9D01CFC0  A1400000   SB ZERO, 0(T2)
9D01CFC4  006B3021   ADDU A2, V1, T3
9D01CFD4  A1000000   SB ZERO, 0(T0)
9D01CFD8  006FC021   ADDU T8, V1, T7
9D01CFE8  A1600000   SB ZERO, 0(T3)
9D01CFEC  00795021   ADDU T2, V1, T9
9D01CFF0  24420004   ADDIU V0, V0, 4
785:                 			color_buffer[i][j] = 0x0F;	//White text on black background
9D01CF7C  2405000F   ADDIU A1, ZERO, 15
9D01CFA0  A1050000   SB A1, 0(T0)
9D01CFA4  24420001   ADDIU V0, V0, 1
9D01CFA8  0082C021   ADDU T8, A0, V0
9D01CFB4  A3250000   SB A1, 0(T9)
9D01CFB8  244B0001   ADDIU T3, V0, 1
9D01CFBC  008B5021   ADDU T2, A0, T3
9D01CFC8  A0C50000   SB A1, 0(A2)
9D01CFCC  244F0002   ADDIU T7, V0, 2
9D01CFD0  008F4021   ADDU T0, A0, T7
9D01CFDC  A3050000   SB A1, 0(T8)
9D01CFE0  24590003   ADDIU T9, V0, 3
9D01CFE4  00995821   ADDU T3, A0, T9
9D01CFE8  A1600000   SB ZERO, 0(T3)
9D01CFEC  00795021   ADDU T2, V1, T9
9D01CFF0  24420004   ADDIU V0, V0, 4
9D01CFF4  1449FFE7   BNE V0, T1, 0x9D01CF94
9D01CFF8  A1450000   SB A1, 0(T2)
9D01CFFC  24E70028   ADDIU A3, A3, 40
9D01D000  54ECFFE2   BNEL A3, T4, 0x9D01CF8C
9D01D004  00001021   ADDU V0, ZERO, ZERO
9D01D008  240D0028   ADDIU T5, ZERO, 40
9D01D00C  AF8D81D4   SW T5, -32300(GP)
9D01D010  240E0015   ADDIU T6, ZERO, 21
9D01D014  03E00008   JR RA
9D01D018  AF8E81E0   SW T6, -32288(GP)
786:                 			}
787:                 		}
788:                 	}
789:                 
790:                 const char* get_firmware_string(void) {
791:                 	return FIRMWARE_VERSION;
792:                 	}
9D01D01C  3C029D03   LUI V0, -25341
9D01D020  03E00008   JR RA
9D01D024  2442F3E0   ADDIU V0, V0, -3104
793:                 
794:                 uint16_t get_free_mem(uint8_t * prog, uint16_t max_mem)
795:                 	{
9D01D028  27BDFFE8   ADDIU SP, SP, -24
9D01D02C  AFBF0014   SW RA, 20(SP)
9D01D030  AFB00010   SW S0, 16(SP)
796:                 	uint16_t prog_len;
797:                 	prog_len = strlen(prog);
9D01D034  0F40F2B0   JAL strlen
9D01D038  00A08021   ADDU S0, A1, ZERO
798:                 	return (max_mem-prog_len);
9D01D03C  02021023   SUBU V0, S0, V0
799:                 	}
9D01D040  3042FFFF   ANDI V0, V0, -1
9D01D044  8FBF0014   LW RA, 20(SP)
9D01D048  8FB00010   LW S0, 16(SP)
9D01D04C  03E00008   JR RA
9D01D050  27BD0018   ADDIU SP, SP, 24
800:                 
801:                 //B_BAS008
802:                 uint8_t add_prog_line (int8_t * line, int8_t * prog, int16_t linenum)
803:                     {
9D01D054  27BDFF58   ADDIU SP, SP, -168
9D01D058  AFBF00A4   SW RA, 164(SP)
9D01D05C  AFBE00A0   SW FP, 160(SP)
9D01D060  AFB7009C   SW S7, 156(SP)
9D01D064  AFB60098   SW S6, 152(SP)
9D01D068  AFB50094   SW S5, 148(SP)
9D01D06C  AFB40090   SW S4, 144(SP)
9D01D070  AFB3008C   SW S3, 140(SP)
9D01D074  AFB20088   SW S2, 136(SP)
9D01D078  AFB10084   SW S1, 132(SP)
9D01D07C  AFB00080   SW S0, 128(SP)
9D01D080  0080F021   ADDU FP, A0, ZERO
9D01D084  00A0B021   ADDU S6, A1, ZERO
9D01D088  00C0A821   ADDU S5, A2, ZERO
804:                     uint8_t * prog_ptr=prog, * prog_ptr_prev, * prog_ptr_dest;
805:                     int16_t linenum_now,linenum_prev=0,line_exp_len,cnt, prog_len;
806:                     int8_t line_rest[50],line_exp[50],ret;
807:                     sprintf(line_exp,"%d %s\n",linenum,line);
9D01D08C  27A40048   ADDIU A0, SP, 72
9D01D090  3C059D03   LUI A1, -25341
9D01D094  24A5F3E8   ADDIU A1, A1, -3096
9D01D098  0F4104E0   JAL _sprintf_cdnopuxX, _sprintf_cdnopsuxX
9D01D09C  03C03821   ADDU A3, FP, ZERO
808:                     line_exp_len = strlen(line_exp);
9D01D0A0  0F40F2B0   JAL strlen
9D01D0A4  27A40048   ADDIU A0, SP, 72
9D01D0A8  7C02BE20   SEH S7, V0
809:                 	prog_len = strlen(prog);
9D01D0AC  0F40F2B0   JAL strlen
9D01D0B0  02C02021   ADDU A0, S6, ZERO
810:                 	if ((prog_len + line_exp_len)>BPROG_LEN) return 1;
9D01D0B4  7C021620   SEH V0, V0
9D01D0B8  00571821   ADDU V1, V0, S7
9D01D0BC  28644001   SLTI A0, V1, 16385
9D01D0C0  1080004C   BEQ A0, ZERO, 0x9D01D1F4
9D01D0C4  24020001   ADDIU V0, ZERO, 1
9D01D0C8  02C08021   ADDU S0, S6, ZERO
9D01D0CC  00009821   ADDU S3, ZERO, ZERO
811:                     while (1)
812:                 	{
813:                 	ret = sscanf(prog_ptr,"%d %[^\n]s",&linenum_now,line_rest);
9D01D0D0  3C129D03   LUI S2, -25341
9D01D0D4  2652F3F0   ADDIU S2, S2, -3088
9D01D0E0  02002021   ADDU A0, S0, ZERO
9D01D0E4  02402821   ADDU A1, S2, ZERO
9D01D0E8  27A60010   ADDIU A2, SP, 16
9D01D0EC  0F41046F   JAL .Letext0, .LFE1, _sscanf_cdnopuxX
9D01D0F0  27A70014   ADDIU A3, SP, 20
9D01D0F4  7C023420   SEB A2, V0
814:                 	if (ret==2)
9D01D0D8  24110002   ADDIU S1, ZERO, 2
9D01D0F8  14D10032   BNE A2, S1, 0x9D01D1C4
9D01D0FC  87A70010   LH A3, 16(SP)
815:                 	    {
816:                 	    if ((linenum>linenum_prev)&(linenum<linenum_now))
9D01D100  02A7402A   SLT T0, S5, A3
9D01D104  11000010   BEQ T0, ZERO, 0x9D01D148
9D01D108  0275982A   SLT S3, S3, S5
9D01D10C  1260000E   BEQ S3, ZERO, 0x9D01D148
9D01D110  00000000   NOP
817:                 			{
818:                 			cnt = strlen(prog_ptr) +1;
9D01D114  0F40F2B0   JAL strlen
9D01D118  02002021   ADDU A0, S0, ZERO
9D01D11C  24490001   ADDIU T1, V0, 1
819:                 			prog_ptr_dest = prog_ptr + line_exp_len;
820:                 			memmove(prog_ptr_dest,prog_ptr,cnt);
9D01D120  02172021   ADDU A0, S0, S7
9D01D124  02002821   ADDU A1, S0, ZERO
9D01D128  0F410530   JAL .Letext0, .LFE0, memmove
9D01D12C  7C093620   SEH A2, T1
821:                 			memcpy(prog_ptr,line_exp,line_exp_len);
9D01D130  02002021   ADDU A0, S0, ZERO
9D01D134  27A50048   ADDIU A1, SP, 72
9D01D138  0F40F256   JAL .Letext0, .LFE1, memcpy
9D01D13C  02E03021   ADDU A2, S7, ZERO
822:                 			return 0;
9D01D140  0B40747D   J 0x9D01D1F4
9D01D144  00001021   ADDU V0, ZERO, ZERO
823:                 			}
824:                 	    if (linenum==linenum_now)
9D01D148  16A70025   BNE S5, A3, 0x9D01D1E0
9D01D14C  87B30010   LH S3, 16(SP)
825:                 			{
826:                 			prog_ptr_prev = prog_ptr;
827:                 			prog_ptr = strchr(prog_ptr,'\n')+1;
9D01D150  02002021   ADDU A0, S0, ZERO
9D01D154  0F40FBCB   JAL strchr
9D01D158  2405000A   ADDIU A1, ZERO, 10
9D01D15C  24560001   ADDIU S6, V0, 1
828:                 			cnt = strlen(prog_ptr)+1;
9D01D160  0F40F2B0   JAL strlen
9D01D164  02C02021   ADDU A0, S6, ZERO
9D01D168  244A0001   ADDIU T2, V0, 1
829:                 			memmove(prog_ptr_prev,prog_ptr,cnt);
9D01D16C  02002021   ADDU A0, S0, ZERO
9D01D170  02C02821   ADDU A1, S6, ZERO
9D01D174  0F410530   JAL .Letext0, .LFE0, memmove
9D01D178  7C0A3620   SEH A2, T2
830:                 			if (strlen(line)>1)
9D01D17C  0F40F2B0   JAL strlen
9D01D180  03C02021   ADDU A0, FP, ZERO
9D01D184  2C4B0002   SLTIU T3, V0, 2
9D01D188  1560001A   BNE T3, ZERO, 0x9D01D1F4
9D01D18C  00001021   ADDU V0, ZERO, ZERO
831:                 				{
832:                 				prog_ptr = prog_ptr_prev;
833:                 				cnt = strlen(prog_ptr);
9D01D190  0F40F2B0   JAL strlen
9D01D194  02002021   ADDU A0, S0, ZERO
834:                 				prog_ptr_dest = prog_ptr + line_exp_len;
835:                 				memmove(prog_ptr_dest,prog_ptr,cnt+1);
9D01D198  7C026620   SEH T4, V0
9D01D19C  02172021   ADDU A0, S0, S7
9D01D1A0  02002821   ADDU A1, S0, ZERO
9D01D1A4  0F410530   JAL .Letext0, .LFE0, memmove
9D01D1A8  25860001   ADDIU A2, T4, 1
836:                 				memcpy(prog_ptr,line_exp,line_exp_len);		
9D01D1AC  02002021   ADDU A0, S0, ZERO
9D01D1B0  27A50048   ADDIU A1, SP, 72
9D01D1B4  0F40F256   JAL .Letext0, .LFE1, memcpy
9D01D1B8  02E03021   ADDU A2, S7, ZERO
837:                 				}
838:                 			return 0;
9D01D1BC  0B40747D   J 0x9D01D1F4
9D01D1C0  00001021   ADDU V0, ZERO, ZERO
839:                 			}
840:                 	    }
841:                 	if (ret==-1)
9D01D0DC  2414FFFF   ADDIU S4, ZERO, -1
9D01D1C4  14D40006   BNE A2, S4, 0x9D01D1E0
9D01D1C8  87B30010   LH S3, 16(SP)
842:                 	    {
843:                 	    strcat(prog,line_exp);
9D01D1CC  02C02021   ADDU A0, S6, ZERO
9D01D1D0  0F410181   JAL strcat
9D01D1D4  27A50048   ADDIU A1, SP, 72
844:                 	    return 0;
9D01D1D8  0B40747D   J 0x9D01D1F4
9D01D1DC  00001021   ADDU V0, ZERO, ZERO
845:                 	    }
846:                 	linenum_prev = linenum_now;
847:                 	prog_ptr_prev = prog_ptr;
848:                 	prog_ptr = strchr(prog_ptr,'\n')+1;
9D01D1E0  02002021   ADDU A0, S0, ZERO
9D01D1E4  0F40FBCB   JAL strchr
9D01D1E8  2405000A   ADDIU A1, ZERO, 10
849:                 	}
9D01D1EC  0B407438   J 0x9D01D0E0
9D01D1F0  24500001   ADDIU S0, V0, 1
850:                     }
9D01D1F4  8FBF00A4   LW RA, 164(SP)
9D01D1F8  8FBE00A0   LW FP, 160(SP)
9D01D1FC  8FB7009C   LW S7, 156(SP)
9D01D200  8FB60098   LW S6, 152(SP)
9D01D204  8FB50094   LW S5, 148(SP)
9D01D208  8FB40090   LW S4, 144(SP)
9D01D20C  8FB3008C   LW S3, 140(SP)
9D01D210  8FB20088   LW S2, 136(SP)
9D01D214  8FB10084   LW S1, 132(SP)
9D01D218  8FB00080   LW S0, 128(SP)
9D01D21C  03E00008   JR RA
9D01D220  27BD00A8   ADDIU SP, SP, 168
851:                 
852:                 ////B_BAS007
853:                 //uint8_t cmd_exec (int8_t * cmd)
854:                 //    {
855:                 //    int8_t cmd_clean[25];
856:                 //    int32_t linenum,prognum;
857:                 //    if (isdigit(cmd[0]))
858:                 //		{
859:                 //		sscanf(cmd,"%d %[^\n]s",&linenum,cmd_clean);
860:                 //		add_prog_line (cmd_clean,bprog, linenum);
861:                 //		}
862:                 //    else
863:                 //		{
864:                 //		if (strcmp("list",cmd)==0) stdio_write(bprog);
865:                 //		else if (strcmp("memclr",cmd)==0) bprog[0]=0;
866:                 //		else if (strcmp("free",cmd)==0)
867:                 //			{
868:                 //			sprintf(stdio_buff,"%d B of memory free\n",get_free_mem(bprog,BPROG_LEN));
869:                 //			stdio_write(stdio_buff);
870:                 //			}	
871:                 //		else if (strcmp("more",cmd)==0) list_more();
872:                 //		else if (strcmp("help",cmd)==0) 
873:                 //			{
874:                 //			stdio_write("Basic BASIC help:\n");
875:                 //			stdio_write("Type more to list the program in buffer, ");
876:                 //			stdio_write("or run to run it.\n");
877:                 //			stdio_write(" For more documentation see hac.io/Mz3r\n");
878:                 //			}
879:                 //		else if (strncmp("load",cmd,4)==0)
880:                 //			{
881:                 //			sscanf (cmd+4,"%d",&prognum);
882:                 //			if ((prognum>=0)&(prognum<BASIC_SAVNUM))
883:                 //				{
884:                 //				stdio_write("loading...");
885:                 //				basic_load_program(bprog,prognum);
886:                 //				stdio_write("OK\n");
887:                 //				}
888:                 //			}
889:                 //		else if (strncmp("save",cmd,4)==0)
890:                 //			{
891:                 //			sscanf (cmd+4,"%d",&prognum);
892:                 //			if ((prognum>=0)&(prognum<BASIC_SAVNUM))
893:                 //				{
894:                 //				stdio_write("saving...");
895:                 //				basic_save_program(bprog,prognum);
896:                 //				stdio_write("OK\n");
897:                 //				}
898:                 //			}	
899:                 //		else if (strncmp("ssave",cmd,5)==0)
900:                 //			{
901:                 //			stdio_write("Transmitting via serial port...\n");
902:                 //			i = basic_saves(bprog,BPROG_LEN);
903:                 //			sprintf(stdio_buff,"\nOK, transmitted %d bytes.\n",i);
904:                 //			stdio_write(stdio_buff);
905:                 //			}	
906:                 //		else if (strncmp("sload",cmd,5)==0)
907:                 //			{
908:                 //			stdio_write("Loading new program from serial port\n");
909:                 //			stdio_write("Press BRK to exit...\n");
910:                 //			serial_flush();
911:                 //			handle_display = 0;
912:                 //			display_refresh_force();
913:                 //			i = basic_loads(bprog,BPROG_LEN);
914:                 //			handle_display = 1;
915:                 //			sprintf(stdio_buff,"\nOK, received %d bytes.\n",i);
916:                 //			stdio_write(stdio_buff);
917:                 //			}	
918:                 //		else if (strcmp("run",cmd)==0)
919:                 //			{
920:                 //			ubasic_init(bprog,0);
921:                 //			brk_key = 0;
922:                 //			do 
923:                 //				{
924:                 //				if (brk_key) 
925:                 //					{
926:                 //					brk_key = 0;
927:                 //					stdio_write("\nBRK pressed\n");
928:                 //					break;
929:                 //					}
930:                 //				if (!setjmp(jbuf)) ubasic_run();
931:                 //				else
932:                 //					{
933:                 //					stdio_write("\nBASIC error\n");
934:                 //					break;
935:                 //					}
936:                 //				} 	while(!ubasic_finished());
937:                 //			handle_display = 1;
938:                 //			stdio_write("\n");
939:                 //			}
940:                 //		else 
941:                 //			{
942:                 //			if (strlen(cmd)>0)
943:                 //				{
944:                 //				sprintf(tprog,"0 %s\n",cmd);
945:                 //				ubasic_init(tprog,1);
946:                 //				do 
947:                 //					{
948:                 //					if (!setjmp(jbuf)) ubasic_run();
949:                 //					else
950:                 //						{
951:                 //						stdio_write("BASIC error\n");
952:                 //						break;
953:                 //						}
954:                 //					} 	while(!ubasic_finished());	
955:                 //				}		
956:                 //			}
957:                 //		}
958:                 //    }
959:                 
960:                 
961:                 uint16_t basic_loads (int8_t * data, uint16_t maxlen)
962:                 	{
9D01D224  27BDFFE0   ADDIU SP, SP, -32
9D01D228  AFBF001C   SW RA, 28(SP)
9D01D22C  AFB20018   SW S2, 24(SP)
9D01D230  AFB10014   SW S1, 20(SP)
9D01D234  AFB00010   SW S0, 16(SP)
9D01D238  00809021   ADDU S2, A0, ZERO
9D01D23C  00A08821   ADDU S1, A1, ZERO
963:                 	uint8_t rx_char;
964:                 	uint16_t len=0;
9D01D240  00008021   ADDU S0, ZERO, ZERO
965:                 	while (1)
966:                 		{
967:                 		if (rx_sta())
9D01D244  0F40A0FF   JAL rx_sta
9D01D248  00000000   NOP
9D01D24C  10400012   BEQ V0, ZERO, 0x9D01D298
9D01D250  00000000   NOP
968:                 			{
969:                 			rx_char = rx_read();
9D01D254  0F40A121   JAL .LFB100, .LFE98, rx_read
9D01D258  00000000   NOP
970:                 			if ((rx_char>=' ')|(rx_char==NEWLINE)|(rx_char==0))
9D01D25C  2443FFFF   ADDIU V1, V0, -1
9D01D260  306400FF   ANDI A0, V1, 255
9D01D264  2C85001F   SLTIU A1, A0, 31
9D01D268  10A00004   BEQ A1, ZERO, 0x9D01D27C
9D01D26C  26070001   ADDIU A3, S0, 1
9D01D270  3846000A   XORI A2, V0, 10
9D01D274  14C00004   BNE A2, ZERO, 0x9D01D288
9D01D278  00000000   NOP
971:                 				data[len++] = rx_char;
9D01D27C  02508021   ADDU S0, S2, S0
9D01D280  A2020000   SB V0, 0(S0)
9D01D284  30F0FFFF   ANDI S0, A3, -1
972:                 			if (rx_char==0) return len;
9D01D288  1040000C   BEQ V0, ZERO, 0x9D01D2BC
9D01D28C  02001021   ADDU V0, S0, ZERO
973:                 			if (len==maxlen) return len;
9D01D290  1211000B   BEQ S0, S1, 0x9D01D2C0
9D01D294  8FBF001C   LW RA, 28(SP)
974:                 			}
975:                 		if (brk_key) 
9D01D298  938281E5   LBU V0, -32283(GP)
9D01D29C  7C024420   SEB T0, V0
9D01D2A0  1100FFE8   BEQ T0, ZERO, 0x9D01D244
9D01D2A4  00000000   NOP
976:                 			{
977:                 			if (len>0) data[len] = 0;
9D01D2A8  12000002   BEQ S0, ZERO, 0x9D01D2B4
9D01D2AC  02504821   ADDU T1, S2, S0
9D01D2B0  A1200000   SB ZERO, 0(T1)
978:                 			brk_key = 0;
9D01D2B4  A38081E5   SB ZERO, -32283(GP)
979:                 			return len;
980:                 			}
981:                 		}
982:                 	return 0;
983:                 	}
9D01D2B8  02001021   ADDU V0, S0, ZERO
9D01D2BC  8FBF001C   LW RA, 28(SP)
9D01D2C0  8FB20018   LW S2, 24(SP)
9D01D2C4  8FB10014   LW S1, 20(SP)
9D01D2C8  8FB00010   LW S0, 16(SP)
9D01D2CC  03E00008   JR RA
9D01D2D0  27BD0020   ADDIU SP, SP, 32
984:                 
985:                 uint16_t basic_saves (int8_t * data, uint16_t maxlen)
986:                 	{
9D01D2D4  27BDFFD8   ADDIU SP, SP, -40
9D01D2D8  AFBF0024   SW RA, 36(SP)
9D01D2DC  AFB30020   SW S3, 32(SP)
9D01D2E0  AFB2001C   SW S2, 28(SP)
9D01D2E4  AFB10018   SW S1, 24(SP)
9D01D2E8  AFB00014   SW S0, 20(SP)
9D01D2EC  00809021   ADDU S2, A0, ZERO
9D01D2F0  00A09821   ADDU S3, A1, ZERO
987:                 	uint16_t len=0;
9D01D2F4  00008021   ADDU S0, ZERO, ZERO
988:                 	while (1)
989:                 		{
990:                 		tx_write(data[len]);
9D01D2F8  02508821   ADDU S1, S2, S0
9D01D2FC  0F40A125   JAL tx_write
9D01D300  92240000   LBU A0, 0(S1)
991:                 		if (data[len]==0) return len;
9D01D304  82220000   LB V0, 0(S1)
9D01D308  10400006   BEQ V0, ZERO, 0x9D01D324
9D01D30C  02001021   ADDU V0, S0, ZERO
992:                 		if (len==maxlen) return len;
9D01D310  12130005   BEQ S0, S3, 0x9D01D328
9D01D314  8FBF0024   LW RA, 36(SP)
993:                 		len++;
9D01D318  26100001   ADDIU S0, S0, 1
994:                 		}
9D01D31C  0B4074BE   J 0x9D01D2F8
9D01D320  3210FFFF   ANDI S0, S0, -1
995:                 	return 0;
996:                 	}
9D01D324  8FBF0024   LW RA, 36(SP)
9D01D328  8FB30020   LW S3, 32(SP)
9D01D32C  8FB2001C   LW S2, 28(SP)
9D01D330  8FB10018   LW S1, 24(SP)
9D01D334  8FB00014   LW S0, 20(SP)
9D01D338  03E00008   JR RA
9D01D33C  27BD0028   ADDIU SP, SP, 40
997:                 
998:                 //B_BAS011
999:                 uint8_t basic_save_program (uint8_t * data, uint8_t slot)
1000:                	{
9D01D340  27BDFFD8   ADDIU SP, SP, -40
9D01D344  AFBF0024   SW RA, 36(SP)
9D01D348  AFB40020   SW S4, 32(SP)
9D01D34C  AFB3001C   SW S3, 28(SP)
9D01D350  AFB20018   SW S2, 24(SP)
9D01D354  AFB10014   SW S1, 20(SP)
9D01D358  AFB00010   SW S0, 16(SP)
9D01D35C  00808021   ADDU S0, A0, ZERO
1001:                	uint32_t  addr;
1002:                	uint16_t  cnt;
1003:                	addr = slot;
1004:                	addr = addr * BPROG_SECSIZ * BPROG_SECNUM;
9D01D360  00058B80   SLL S1, A1, 14
9D01D364  00009021   ADDU S2, ZERO, ZERO
9D01D368  02519821   ADDU S3, S2, S1
1005:                	addr = addr + BASIC_BASEADDR;
1006:                	for (cnt = 0;cnt<BPROG_SECNUM;cnt++)
1007:                		{
1008:                		fl_erase_4k(addr + cnt*BPROG_SECSIZ);
9D01D36C  0F40B8C3   JAL fl_erase_4k
9D01D370  02602021   ADDU A0, S3, ZERO
9D01D388  0F40B8C3   JAL fl_erase_4k
9D01D38C  02802021   ADDU A0, S4, ZERO
9D01D3A4  0F40B8C3   JAL fl_erase_4k
9D01D3A8  02802021   ADDU A0, S4, ZERO
9D01D3C0  0F40B8C3   JAL fl_erase_4k
9D01D3C4  02202021   ADDU A0, S1, ZERO
1009:                		fl_write_4k(addr + cnt*BPROG_SECSIZ,data + cnt*BPROG_SECSIZ);	
9D01D374  02602021   ADDU A0, S3, ZERO
9D01D378  0F40B916   JAL fl_write_4k
9D01D37C  02002821   ADDU A1, S0, ZERO
9D01D380  26521000   ADDIU S2, S2, 4096
9D01D384  0251A021   ADDU S4, S2, S1
9D01D390  02802021   ADDU A0, S4, ZERO
9D01D394  0F40B916   JAL fl_write_4k
9D01D398  02122821   ADDU A1, S0, S2
9D01D39C  26531000   ADDIU S3, S2, 4096
9D01D3A0  0271A021   ADDU S4, S3, S1
9D01D3AC  02802021   ADDU A0, S4, ZERO
9D01D3B0  0F40B916   JAL fl_write_4k
9D01D3B4  02132821   ADDU A1, S0, S3
9D01D3B8  26522000   ADDIU S2, S2, 8192
9D01D3BC  02518821   ADDU S1, S2, S1
9D01D3C8  02202021   ADDU A0, S1, ZERO
9D01D3CC  0F40B916   JAL fl_write_4k
9D01D3D0  02122821   ADDU A1, S0, S2
1010:                		}
1011:                	return 1;
1012:                	}
9D01D3D4  24020001   ADDIU V0, ZERO, 1
9D01D3D8  8FBF0024   LW RA, 36(SP)
9D01D3DC  8FB40020   LW S4, 32(SP)
9D01D3E0  8FB3001C   LW S3, 28(SP)
9D01D3E4  8FB20018   LW S2, 24(SP)
9D01D3E8  8FB10014   LW S1, 20(SP)
9D01D3EC  8FB00010   LW S0, 16(SP)
9D01D3F0  03E00008   JR RA
9D01D3F4  27BD0028   ADDIU SP, SP, 40
1013:                
1014:                
1015:                //B_BAS012
1016:                uint8_t basic_load_program (uint8_t * data, uint8_t slot)
1017:                	{
9D01D3F8  27BDFFE0   ADDIU SP, SP, -32
9D01D3FC  AFBF001C   SW RA, 28(SP)
9D01D400  AFB20018   SW S2, 24(SP)
9D01D404  AFB10014   SW S1, 20(SP)
9D01D408  AFB00010   SW S0, 16(SP)
9D01D40C  00808021   ADDU S0, A0, ZERO
1018:                	uint32_t  addr;
1019:                	uint16_t  cnt;
1020:                	addr = slot;
1021:                	addr = addr * BPROG_SECSIZ * BPROG_SECNUM;
9D01D410  00058B80   SLL S1, A1, 14
1022:                	addr = addr + BASIC_BASEADDR;
1023:                	for (cnt = 0;cnt<BPROG_SECNUM;cnt++)
1024:                		fl_read_4k(addr + cnt*BPROG_SECSIZ,data + cnt*BPROG_SECSIZ);	
9D01D414  02202021   ADDU A0, S1, ZERO
9D01D418  0F40B804   JAL fl_read_4k
9D01D41C  02002821   ADDU A1, S0, ZERO
9D01D420  24121000   ADDIU S2, ZERO, 4096
9D01D424  02512021   ADDU A0, S2, S1
9D01D428  0F40B804   JAL fl_read_4k
9D01D42C  02122821   ADDU A1, S0, S2
9D01D430  26421000   ADDIU V0, S2, 4096
9D01D434  00512021   ADDU A0, V0, S1
9D01D438  0F40B804   JAL fl_read_4k
9D01D43C  02022821   ADDU A1, S0, V0
9D01D440  26432000   ADDIU V1, S2, 8192
9D01D444  00712021   ADDU A0, V1, S1
9D01D448  0F40B804   JAL fl_read_4k
9D01D44C  02032821   ADDU A1, S0, V1
1025:                	if (data[0] == 0xFF) data[0] = 0;
9D01D450  92040000   LBU A0, 0(S0)
9D01D454  240600FF   ADDIU A2, ZERO, 255
9D01D458  50860001   BEQL A0, A2, 0x9D01D460
9D01D45C  A2000000   SB ZERO, 0(S0)
1026:                	return 1;
1027:                	}
9D01D460  24020001   ADDIU V0, ZERO, 1
9D01D464  8FBF001C   LW RA, 28(SP)
9D01D468  8FB20018   LW S2, 24(SP)
9D01D46C  8FB10014   LW S1, 20(SP)
9D01D470  8FB00010   LW S0, 16(SP)
9D01D474  03E00008   JR RA
9D01D478  27BD0020   ADDIU SP, SP, 32
1028:                
1029:                void list_more (void)
1030:                	{
9D01E5B0  27BDFFD0   ADDIU SP, SP, -48
9D01E5B4  AFBF002C   SW RA, 44(SP)
9D01E5B8  AFB40028   SW S4, 40(SP)
9D01E5BC  AFB30024   SW S3, 36(SP)
9D01E5C0  AFB20020   SW S2, 32(SP)
9D01E5C4  AFB1001C   SW S1, 28(SP)
9D01E5C8  AFB00018   SW S0, 24(SP)
1031:                	uint8_t retval;
1032:                	uint16_t list_cnt=0,list_nl_cnt=0;
9D01E5D0  00009821   ADDU S3, ZERO, ZERO
9D01E5D4  00008021   ADDU S0, ZERO, ZERO
1033:                	while (bprog[list_cnt]!=0)
9D01E5A0  3C02A000   LUI V0, -24576
9D01E5A4  80481D10   LB T0, 7440(V0)
9D01E5A8  11000036   BEQ T0, ZERO, 0x9D01E684
9D01E5AC  00000000   NOP
9D01E5CC  00009021   ADDU S2, ZERO, ZERO
9D01E658  02113821   ADDU A3, S0, S1
9D01E65C  80E80000   LB T0, 0(A3)
9D01E660  1500FFE1   BNE T0, ZERO, 0x9D01E5E8
9D01E664  02009021   ADDU S2, S0, ZERO
1034:                		{
1035:                		if (bprog[list_cnt]==NEWLINE)
9D01E5E8  2403000A   ADDIU V1, ZERO, 10
9D01E5EC  15030003   BNE T0, V1, 0x9D01E5FC
9D01E5F0  24040013   ADDIU A0, ZERO, 19
1036:                			list_nl_cnt++;
9D01E5F4  26730001   ADDIU S3, S3, 1
9D01E5F8  3273FFFF   ANDI S3, S3, -1
1037:                		if (list_nl_cnt==(DISP_BUFFER_HIGH-1))
9D01E5FC  56640012   BNEL S3, A0, 0x9D01E648
9D01E600  26100001   ADDIU S0, S0, 1
1038:                			{
1039:                			stdio_c(NEWLINE);
9D01E604  0F4076E1   JAL stdio_c
9D01E608  2404000A   ADDIU A0, ZERO, 10
1040:                			stdio_write("---hit any key for more, q to quit---");
9D01E5D8  3C149D03   LUI S4, -25341
9D01E5DC  2694F5F8   ADDIU S4, S4, -2568
9D01E60C  0F40751F   JAL stdio_write
9D01E610  02802021   ADDU A0, S4, ZERO
1041:                			while (stdio_get(&retval)==0);
9D01E614  0F4078AD   JAL stdio_get
9D01E618  27A40010   ADDIU A0, SP, 16
9D01E61C  1040FFFD   BEQ V0, ZERO, .LVL384
9D01E620  00000000   NOP
1042:                			stdio_c(NEWLINE);
9D01E624  0F4076E1   JAL stdio_c
9D01E628  2404000A   ADDIU A0, ZERO, 10
1043:                			if (retval == 'q') return;
9D01E62C  93A50010   LBU A1, 16(SP)
9D01E630  24060071   ADDIU A2, ZERO, 113
9D01E634  10A6000D   BEQ A1, A2, 0x9D01E66C
9D01E638  8FBF002C   LW RA, 44(SP)
1044:                			list_nl_cnt = 0;
1045:                			video_clrscr();
9D01E63C  0F406DBA   JAL video_clrscr
9D01E640  00009821   ADDU S3, ZERO, ZERO
1046:                			}
1047:                		stdio_c(bprog[list_cnt++]);
9D01E5E0  3C11A000   LUI S1, -24576
9D01E5E4  26311D10   ADDIU S1, S1, 7440
9D01E644  26100001   ADDIU S0, S0, 1
9D01E648  3210FFFF   ANDI S0, S0, -1
9D01E64C  02519021   ADDU S2, S2, S1
9D01E650  0F4076E1   JAL stdio_c
9D01E654  92440000   LBU A0, 0(S2)
1048:                		}	
1049:                	}
9D01E668  8FBF002C   LW RA, 44(SP)
9D01E66C  8FB40028   LW S4, 40(SP)
9D01E670  8FB30024   LW S3, 36(SP)
9D01E674  8FB20020   LW S2, 32(SP)
9D01E678  8FB1001C   LW S1, 28(SP)
9D01E67C  8FB00018   LW S0, 24(SP)
9D01E680  27BD0030   ADDIU SP, SP, 48
9D01E684  03E00008   JR RA
9D01E688  00000000   NOP
1050:                
1051:                //B_BDG003
1052:                
1053:                //write null-terminated string to standard output
1054:                uint8_t stdio_write (int8_t * data)
1055:                	{
9D01D47C  27BDFFE8   ADDIU SP, SP, -24
9D01D480  AFBF0014   SW RA, 20(SP)
9D01D484  AFB00010   SW S0, 16(SP)
9D01D488  00808021   ADDU S0, A0, ZERO
1056:                	if (stdio_src==STDIO_LOCAL)
9D01D48C  938281D9   LBU V0, -32295(GP)
9D01D490  7C021C20   SEB V1, V0
9D01D494  14600016   BNE V1, ZERO, 0x9D01D4F0
9D01D498  00000000   NOP
9D01D49C  0B407538   J 0x9D01D4E0
9D01D4A0  82080000   LB T0, 0(S0)
1057:                		{
1058:                		while (*data!=0x00)
9D01D4DC  82080000   LB T0, 0(S0)
9D01D4E0  1500FFF0   BNE T0, ZERO, 0x9D01D4A4
9D01D4E4  26100001   ADDIU S0, S0, 1
9D01D4E8  0B40754B   J 0x9D01D52C
9D01D4EC  8FBF0014   LW RA, 20(SP)
1059:                			{
1060:                			buf_enqueue (*data++);
9D01D4A4  0F406C71   JAL buf_enqueue
9D01D4A8  310400FF   ANDI A0, T0, 255
1061:                			while (bufsize)
9D01D4AC  978981B8   LHU T1, -32328(GP)
9D01D4B0  312AFFFF   ANDI T2, T1, -1
9D01D4B4  5140000A   BEQL T2, ZERO, 0x9D01D4E0
9D01D4B8  82080000   LB T0, 0(S0)
9D01D4CC  978B81B8   LHU T3, -32328(GP)
9D01D4D0  316CFFFF   ANDI T4, T3, -1
9D01D4D4  1580FFF9   BNE T4, ZERO, 0x9D01D4BC
9D01D4D8  00000000   NOP
1062:                				receive_char(buf_dequeue());	
9D01D4BC  0F406C89   JAL buf_dequeue
9D01D4C0  00000000   NOP
9D01D4C4  0F4071E6   JAL receive_char
9D01D4C8  00402021   ADDU A0, V0, ZERO
1063:                			}
1064:                		}
1065:                	else if (stdio_src==STDIO_TTY1)
9D01D4F0  938481D9   LBU A0, -32295(GP)
9D01D4F4  7C042C20   SEB A1, A0
9D01D4F8  24060001   ADDIU A2, ZERO, 1
9D01D4FC  14A6000B   BNE A1, A2, 0x9D01D52C
9D01D500  8FBF0014   LW RA, 20(SP)
1066:                		{
1067:                		while (*data!=0x00)
9D01D504  82070000   LB A3, 0(S0)
9D01D508  50E00009   BEQL A3, ZERO, 0x9D01D530
9D01D50C  8FB00010   LW S0, 16(SP)
9D01D51C  82070000   LB A3, 0(S0)
9D01D520  14E0FFFC   BNE A3, ZERO, 0x9D01D514
9D01D524  26100001   ADDIU S0, S0, 1
1068:                		tx_write(*data++);
9D01D510  26100001   ADDIU S0, S0, 1
9D01D514  0F40A125   JAL tx_write
9D01D518  30E400FF   ANDI A0, A3, 255
1069:                		}
1070:                	}
9D01D528  8FBF0014   LW RA, 20(SP)
9D01D52C  8FB00010   LW S0, 16(SP)
9D01D530  03E00008   JR RA
9D01D534  27BD0018   ADDIU SP, SP, 24
1071:                
1072:                //write one character to standard output
1073:                uint8_t stdio_c (uint8_t data)
1074:                	{
9D01DB84  27BDFFE8   ADDIU SP, SP, -24
9D01DB88  AFBF0014   SW RA, 20(SP)
1075:                	int8_t tmp[3];
1076:                	if (stdio_src==STDIO_LOCAL)
9D01DB8C  938281D9   LBU V0, -32295(GP)
9D01DB90  7C021C20   SEB V1, V0
9D01DB94  14600011   BNE V1, ZERO, 0x9D01DBDC
9D01DB98  00000000   NOP
1077:                		{
1078:                		tmp[0] = data;
1079:                		tmp[1] = 0;
1080:                		buf_enqueue (data);
9D01DB9C  0F406C71   JAL buf_enqueue
9D01DBA0  00000000   NOP
1081:                		while (bufsize)
9D01DBA4  978481B8   LHU A0, -32328(GP)
9D01DBA8  3088FFFF   ANDI T0, A0, -1
9D01DBAC  11000013   BEQ T0, ZERO, 0x9D01DBFC
9D01DBB0  8FBF0014   LW RA, 20(SP)
9D01DBC4  978981B8   LHU T1, -32328(GP)
9D01DBC8  312AFFFF   ANDI T2, T1, -1
9D01DBCC  1540FFF9   BNE T2, ZERO, 0x9D01DBB4
9D01DBD0  8FBF0014   LW RA, 20(SP)
9D01DBD4  0B4076FF   J 0x9D01DBFC
9D01DBD8  00000000   NOP
1082:                			receive_char(buf_dequeue());
9D01DBB4  0F406C89   JAL buf_dequeue
9D01DBB8  00000000   NOP
9D01DBBC  0F4071E6   JAL receive_char
9D01DBC0  00402021   ADDU A0, V0, ZERO
1083:                		}
1084:                	else if (stdio_src==STDIO_TTY1)
9D01DBDC  938581D9   LBU A1, -32295(GP)
9D01DBE0  7C053420   SEB A2, A1
9D01DBE4  24070001   ADDIU A3, ZERO, 1
9D01DBE8  14C70004   BNE A2, A3, 0x9D01DBFC
9D01DBEC  8FBF0014   LW RA, 20(SP)
1085:                		tx_write(data);
9D01DBF0  0F40A125   JAL tx_write
9D01DBF4  00000000   NOP
1086:                	}
9D01DBF8  8FBF0014   LW RA, 20(SP)
9D01DBFC  03E00008   JR RA
9D01DC00  27BD0018   ADDIU SP, SP, 24
1087:                
1088:                //check, whether is there something to read from standard input
1089:                //zero is returned when empty, nonzero when character is available
1090:                int8_t stdio_get_state (void)
1091:                	{
9D01E1C0  27BDFFE8   ADDIU SP, SP, -24
9D01E1C4  AFBF0014   SW RA, 20(SP)
1092:                	if (stdio_local_buffer_state()!=0)
9D01E1C8  0F40786D   JAL stdio_local_buffer_state
9D01E1CC  00000000   NOP
9D01E1D0  14400011   BNE V0, ZERO, 0x9D01E218
9D01E1D4  24020001   ADDIU V0, ZERO, 1
1093:                		return 1;
1094:                	if (stdio_src==STDIO_LOCAL)
9D01E1D8  938281D9   LBU V0, -32295(GP)
9D01E1DC  7C021C20   SEB V1, V0
9D01E1E0  14600005   BNE V1, ZERO, 0x9D01E1F8
9D01E1E4  00000000   NOP
1095:                		return term_k_stat();
9D01E1E8  0F407849   JAL term_k_stat
9D01E1EC  00000000   NOP
9D01E1F0  0B407887   J 0x9D01E21C
9D01E1F4  8FBF0014   LW RA, 20(SP)
1096:                	else if (stdio_src==STDIO_TTY1)
9D01E1F8  938481D9   LBU A0, -32295(GP)
9D01E1FC  7C042C20   SEB A1, A0
9D01E200  24060001   ADDIU A2, ZERO, 1
9D01E204  14A60005   BNE A1, A2, 0x9D01E21C
9D01E208  8FBF0014   LW RA, 20(SP)
1097:                		return rx_sta();
9D01E20C  0F40A0FF   JAL rx_sta
9D01E210  00000000   NOP
9D01E214  7C021420   SEB V0, V0
1098:                	}
9D01E218  8FBF0014   LW RA, 20(SP)
9D01E21C  03E00008   JR RA
9D01E220  27BD0018   ADDIU SP, SP, 24
1099:                //get character from stdio
1100:                //zero when there is nothing to read
1101:                int8_t stdio_get (int8_t * dat)
1102:                	{
9D01E2B4  27BDFFE8   ADDIU SP, SP, -24
9D01E2B8  AFBF0014   SW RA, 20(SP)
9D01E2BC  AFB00010   SW S0, 16(SP)
1103:                	if (stdio_local_buffer_state()!=0)
9D01E2C0  0F40786D   JAL stdio_local_buffer_state
9D01E2C4  00808021   ADDU S0, A0, ZERO
9D01E2C8  10400006   BEQ V0, ZERO, 0x9D01E2E4
9D01E2CC  00000000   NOP
1104:                		{
1105:                		*dat = stdio_local_buffer_get();
9D01E2D0  0F407889   JAL stdio_local_buffer_get
9D01E2D4  00000000   NOP
9D01E2D8  A2020000   SB V0, 0(S0)
1106:                		return 1;
9D01E2DC  0B4078CE   J 0x9D01E338
9D01E2E0  24070001   ADDIU A3, ZERO, 1
1107:                		}
1108:                	if (stdio_src==STDIO_LOCAL)
9D01E2E4  938281D9   LBU V0, -32295(GP)
9D01E2E8  7C021C20   SEB V1, V0
9D01E2EC  14600005   BNE V1, ZERO, 0x9D01E304
9D01E2F0  00000000   NOP
1109:                		{
1110:                		return term_k_char(dat);
9D01E2F4  0F407854   JAL term_k_char
9D01E2F8  02002021   ADDU A0, S0, ZERO
9D01E2FC  0B4078CE   J 0x9D01E338
9D01E300  00403821   ADDU A3, V0, ZERO
1111:                		}
1112:                	else if (stdio_src==STDIO_TTY1)
9D01E304  938481D9   LBU A0, -32295(GP)
9D01E308  7C042C20   SEB A1, A0
9D01E30C  24060001   ADDIU A2, ZERO, 1
9D01E310  14A60009   BNE A1, A2, 0x9D01E338
9D01E314  00003821   ADDU A3, ZERO, ZERO
1113:                		{
1114:                		if (rx_sta()!=0)
9D01E318  0F40A0FF   JAL rx_sta
9D01E31C  00000000   NOP
9D01E320  10400005   BEQ V0, ZERO, 0x9D01E338
9D01E324  00003821   ADDU A3, ZERO, ZERO
1115:                			{
1116:                			*dat=rx_read();
9D01E328  0F40A121   JAL .LFB100, .LFE98, rx_read
9D01E32C  00000000   NOP
9D01E330  A2020000   SB V0, 0(S0)
1117:                			return 1;
9D01E334  24070001   ADDIU A3, ZERO, 1
1118:                			}
1119:                		else
1120:                			return 0;
1121:                		}
1122:                	return 0;
1123:                	}
9D01E338  00E01021   ADDU V0, A3, ZERO
9D01E33C  8FBF0014   LW RA, 20(SP)
9D01E340  8FB00010   LW S0, 16(SP)
9D01E344  03E00008   JR RA
9D01E348  27BD0018   ADDIU SP, SP, 24
1124:                
1125:                
1126:                int8_t term_k_stat (void)
1127:                	{
1128:                	uint8_t key_len;
1129:                	IEC0bits.T2IE = 0;
9D01E124  3C03BF88   LUI V1, -16504
9D01E128  8C621060   LW V0, 4192(V1)
9D01E12C  7C024A44   INS V0, ZERO, 9, 1
9D01E130  AC621060   SW V0, 4192(V1)
1130:                	key_len = key_buffer_ptr;
9D01E134  9386807F   LBU A2, -32641(GP)
1131:                	IEC0bits.T2IE = 1;
9D01E138  8C641060   LW A0, 4192(V1)
9D01E13C  24050001   ADDIU A1, ZERO, 1
9D01E140  7CA44A44   INS A0, A1, 9, 1
9D01E144  AC641060   SW A0, 4192(V1)
1132:                	if (key_len == 0)
1133:                		return 0;
1134:                	else 
1135:                		return 1;
1136:                	}
9D01E148  03E00008   JR RA
9D01E14C  0006102B   SLTU V0, ZERO, A2
1137:                
1138:                int8_t term_k_char (int8_t * out)
1139:                	{
9D01E150  27BDFFE8   ADDIU SP, SP, -24
9D01E154  AFBF0014   SW RA, 20(SP)
9D01E158  AFB00010   SW S0, 16(SP)
1140:                	uint8_t retval;
1141:                	IEC0bits.T2IE = 0;
9D01E15C  3C02BF88   LUI V0, -16504
9D01E160  8C431060   LW V1, 4192(V0)
9D01E164  7C034A44   INS V1, ZERO, 9, 1
9D01E168  AC431060   SW V1, 4192(V0)
1142:                	retval = key_buffer_ptr;
9D01E16C  9390807F   LBU S0, -32641(GP)
1143:                	if (key_buffer_ptr>0)
9D01E170  12000007   BEQ S0, ZERO, 0x9D01E190
9D01E174  3C06BF88   LUI A2, -16504
1144:                		{
1145:                		strncpy(out,key_buffer,key_buffer_ptr);
9D01E178  3C05A000   LUI A1, -24576
9D01E17C  24A51510   ADDIU A1, A1, 5392
9D01E180  0F40FA4F   JAL .LFE23, strncpy
9D01E184  02003021   ADDU A2, S0, ZERO
1146:                		key_buffer_ptr = 0;
9D01E188  A380807F   SB ZERO, -32641(GP)
1147:                		}
1148:                	IEC0bits.T2IE = 1;
9D01E18C  3C06BF88   LUI A2, -16504
9D01E190  8CC71060   LW A3, 4192(A2)
9D01E194  24040001   ADDIU A0, ZERO, 1
9D01E198  7C874A44   INS A3, A0, 9, 1
9D01E19C  ACC71060   SW A3, 4192(A2)
1149:                	return retval;
1150:                	}
9D01E1A0  7C101420   SEB V0, S0
9D01E1A4  8FBF0014   LW RA, 20(SP)
9D01E1A8  8FB00010   LW S0, 16(SP)
9D01E1AC  03E00008   JR RA
9D01E1B0  27BD0018   ADDIU SP, SP, 24
1151:                
1152:                
1153:                //void boot_animation(void)
1154:                //	{
1155:                //	handle_display = 0; //Shut off auto-scanning of character buffer
1156:                //	animate_splash();
1157:                //	uint16_t waitfor = ticks+1000;	//Wait for 1 second
1158:                //	while (ticks<waitfor) { ;; }
1159:                //	tft_fill_area(0,0,320,240,0x000000);    //Make display black
1160:                //	handle_display = 1; //Go back to character display
1161:                //}
1162:                
1163:                uint8_t stdio_local_buffer_state (void)
1164:                	{
1165:                	if (stdio_local_len>0) return 1;
9D01E1B4  9382807E   LBU V0, -32642(GP)
1166:                	else return 0;
1167:                	}
9D01E1B8  03E00008   JR RA
9D01E1BC  0002102B   SLTU V0, ZERO, V0
1168:                
1169:                int8_t stdio_local_buffer_get (void)
1170:                	{
1171:                	int8_t retval=0;
1172:                	if (stdio_local_len>0)
9D01E224  9385807E   LBU A1, -32642(GP)
9D01E228  10A00020   BEQ A1, ZERO, 0x9D01E2AC
9D01E22C  00001021   ADDU V0, ZERO, ZERO
1173:                		{
1174:                		retval = stdio_local_buff[0];
9D01E230  3C03A000   LUI V1, -24576
9D01E234  80621CD4   LB V0, 7380(V1)
9D01E238  3C04A000   LUI A0, -24576
9D01E23C  24991CD5   ADDIU T9, A0, 7381
9D01E240  24661CD4   ADDIU A2, V1, 7380
9D01E244  24C70019   ADDIU A3, A2, 25
1175:                		for (i=1;i<STDIO_LOCAL_BUFF_SIZE;i++) stdio_local_buff[i-1] = stdio_local_buff[i];
9D01E248  93280000   LBU T0, 0(T9)
9D01E24C  A328FFFF   SB T0, -1(T9)
9D01E250  27290001   ADDIU T1, T9, 1
9D01E254  932A0001   LBU T2, 1(T9)
9D01E258  A12AFFFF   SB T2, -1(T1)
9D01E25C  912B0001   LBU T3, 1(T1)
9D01E260  A12B0000   SB T3, 0(T1)
9D01E264  912C0002   LBU T4, 2(T1)
9D01E268  A12C0001   SB T4, 1(T1)
9D01E26C  912D0003   LBU T5, 3(T1)
9D01E270  A12D0002   SB T5, 2(T1)
9D01E274  912E0004   LBU T6, 4(T1)
9D01E278  A12E0003   SB T6, 3(T1)
9D01E27C  912F0005   LBU T7, 5(T1)
9D01E280  A12F0004   SB T7, 4(T1)
9D01E284  91380006   LBU T8, 6(T1)
9D01E288  25390007   ADDIU T9, T1, 7
9D01E28C  1727FFEE   BNE T9, A3, 0x9D01E248
9D01E290  A1380005   SB T8, 5(T1)
9D01E294  24030019   ADDIU V1, ZERO, 25
9D01E298  AF8381E0   SW V1, -32288(GP)
1176:                		stdio_local_buff[STDIO_LOCAL_BUFF_SIZE-1]=0;
9D01E29C  3C04A000   LUI A0, -24576
9D01E2A0  A0801CEC   SB ZERO, 7404(A0)
1177:                		stdio_local_len--;
9D01E2A4  24A5FFFF   ADDIU A1, A1, -1
9D01E2A8  A385807E   SB A1, -32642(GP)
1178:                		}
1179:                	return retval;
1180:                	}
9D01E2AC  03E00008   JR RA
9D01E2B0  00000000   NOP
1181:                
1182:                void stdio_local_buffer_put (int8_t data)
1183:                	{
1184:                	if (stdio_local_len<(STDIO_LOCAL_BUFF_SIZE-1))
9D01E68C  9382807E   LBU V0, -32642(GP)
9D01E690  2C430018   SLTIU V1, V0, 24
9D01E694  10600006   BEQ V1, ZERO, 0x9D01E6B0
9D01E698  24450001   ADDIU A1, V0, 1
1185:                		stdio_local_buff[stdio_local_len++] = data;
9D01E69C  A385807E   SB A1, -32642(GP)
9D01E6A0  3C06A000   LUI A2, -24576
9D01E6A4  24C71CD4   ADDIU A3, A2, 7380
9D01E6A8  00474021   ADDU T0, V0, A3
9D01E6AC  A1040000   SB A0, 0(T0)
9D01E6B0  03E00008   JR RA
9D01E6B4  00000000   NOP
1186:                	}
1187:                
1188:                void stdio_local_buffer_puts (int8_t * data)
1189:                	{
9D01E6B8  27BDFFE8   ADDIU SP, SP, -24
9D01E6BC  AFBF0014   SW RA, 20(SP)
9D01E6C0  AFB00010   SW S0, 16(SP)
9D01E6C4  00808021   ADDU S0, A0, ZERO
1190:                	while (*data!=0) stdio_local_buffer_put(*data++);
9D01E6C8  80840000   LB A0, 0(A0)
9D01E6CC  10800006   BEQ A0, ZERO, 0x9D01E6E8
9D01E6D0  8FBF0014   LW RA, 20(SP)
9D01E6D4  0F4079A3   JAL stdio_local_buffer_put
9D01E6D8  26100001   ADDIU S0, S0, 1
9D01E6DC  82040000   LB A0, 0(S0)
9D01E6E0  1480FFFC   BNE A0, ZERO, 0x9D01E6D4
9D01E6E4  8FBF0014   LW RA, 20(SP)
1191:                	}
9D01E6E8  8FB00010   LW S0, 16(SP)
9D01E6EC  03E00008   JR RA
9D01E6F0  27BD0018   ADDIU SP, SP, 24
1192:                
1193:                //************************************************************************
1194:                //some hardware stuff
1195:                
1196:                
1197:                //B_BDG003
1198:                void __ISR(_TIMER_5_VECTOR, IPL3AUTO) Timer5Handler(void)
1199:                {
9D01E6F4  415DE800   RDPGPR SP, SP
9D01E6F8  401B7000   MFC0 K1, EPC
9D01E6FC  401A6002   MFC0 K0, SRSCtl
9D01E700  27BDFF90   ADDIU SP, SP, -112
9D01E704  AFBB006C   SW K1, 108(SP)
9D01E708  401B6000   MFC0 K1, Status
9D01E70C  AFBA0064   SW K0, 100(SP)
9D01E710  AFBB0068   SW K1, 104(SP)
9D01E714  7C1B7844   INS K1, ZERO, 1, 15
9D01E718  377B0C00   ORI K1, K1, 3072
9D01E71C  409B6000   MTC0 K1, Status
9D01E720  AFA30018   SW V1, 24(SP)
9D01E724  AFA20014   SW V0, 20(SP)
9D01E728  8FA30064   LW V1, 100(SP)
9D01E72C  3063000F   ANDI V1, V1, 15
9D01E730  14600011   BNE V1, ZERO, 0x9D01E778
9D01E734  00000000   NOP
9D01E738  AFBF0054   SW RA, 84(SP)
9D01E73C  AFB90050   SW T9, 80(SP)
9D01E740  AFB8004C   SW T8, 76(SP)
9D01E744  AFAF0048   SW T7, 72(SP)
9D01E748  AFAE0044   SW T6, 68(SP)
9D01E74C  AFAD0040   SW T5, 64(SP)
9D01E750  AFAC003C   SW T4, 60(SP)
9D01E754  AFAB0038   SW T3, 56(SP)
9D01E758  AFAA0034   SW T2, 52(SP)
9D01E75C  AFA90030   SW T1, 48(SP)
9D01E760  AFA8002C   SW T0, 44(SP)
9D01E764  AFA70028   SW A3, 40(SP)
9D01E768  AFA60024   SW A2, 36(SP)
9D01E76C  AFA50020   SW A1, 32(SP)
9D01E770  AFA4001C   SW A0, 28(SP)
9D01E774  AFA10010   SW AT, 16(SP)
9D01E778  00001012   MFLO V0
9D01E77C  AFA2005C   SW V0, 92(SP)
9D01E780  00001810   MFHI V1
9D01E784  AFA30058   SW V1, 88(SP)
1200:                    uint8_t key_temp;
1201:                    IFS0bits.T5IF = 0;
9D01E788  3C02BF88   LUI V0, -16504
9D01E78C  8C431030   LW V1, 4144(V0)
9D01E790  7C03C604   INS V1, ZERO, 24, 1
9D01E794  AC431030   SW V1, 4144(V0)
1202:                	disp_tasks();
9D01E798  0F40619C   JAL disp_tasks
9D01E79C  00000000   NOP
1203:                	loop_badge();
9D01E7A0  0F40739E   JAL loop_badge
9D01E7A4  00000000   NOP
1204:                    if (handle_display)
9D01E7A8  93828014   LBU V0, -32748(GP)
9D01E7AC  304200FF   ANDI V0, V0, 255
9D01E7B0  10400005   BEQ V0, ZERO, .LVL401
9D01E7B4  3C04A000   LUI A0, -24576
1205:                		tft_disp_buffer_refresh_part((uint8_t *)(disp_buffer),(uint8_t *)color_buffer);
9D01E7B8  2484198C   ADDIU A0, A0, 6540
9D01E7BC  3C05A000   LUI A1, -24576
9D01E7C0  0F40642B   JAL tft_disp_buffer_refresh_part
9D01E7C4  24A51644   ADDIU A1, A1, 5700
1206:                    key_temp = keyb_tasks();
9D01E7C8  0F409EF9   JAL keyb_tasks
9D01E7CC  00000000   NOP
1207:                    if (key_temp>0)
9D01E7D0  10400007   BEQ V0, ZERO, 0x9D01E7F0
9D01E7D4  9383807F   LBU V1, -32641(GP)
1208:                		key_buffer[key_buffer_ptr++] = key_temp;
9D01E7D8  24660001   ADDIU A2, V1, 1
9D01E7DC  A386807F   SB A2, -32641(GP)
9D01E7E0  3C07A000   LUI A3, -24576
9D01E7E4  24E81510   ADDIU T0, A3, 5392
9D01E7E8  00681821   ADDU V1, V1, T0
9D01E7EC  A0620000   SB V0, 0(V1)
1209:                }
9D01E7F0  8FA2005C   LW V0, 92(SP)
9D01E7F4  00400013   MTLO V0
9D01E7F8  8FA30058   LW V1, 88(SP)
9D01E7FC  00600011   MTHI V1
9D01E800  8FA20064   LW V0, 100(SP)
9D01E804  3042000F   ANDI V0, V0, 15
9D01E808  14400013   BNE V0, ZERO, 0x9D01E858
9D01E80C  00000000   NOP
9D01E810  8FBF0054   LW RA, 84(SP)
9D01E814  8FB90050   LW T9, 80(SP)
9D01E818  8FB8004C   LW T8, 76(SP)
9D01E81C  8FAF0048   LW T7, 72(SP)
9D01E820  8FAE0044   LW T6, 68(SP)
9D01E824  8FAD0040   LW T5, 64(SP)
9D01E828  8FAC003C   LW T4, 60(SP)
9D01E82C  8FAB0038   LW T3, 56(SP)
9D01E830  8FAA0034   LW T2, 52(SP)
9D01E834  8FA90030   LW T1, 48(SP)
9D01E838  8FA8002C   LW T0, 44(SP)
9D01E83C  8FA70028   LW A3, 40(SP)
9D01E840  8FA60024   LW A2, 36(SP)
9D01E844  8FA50020   LW A1, 32(SP)
9D01E848  8FA4001C   LW A0, 28(SP)
9D01E84C  8FA30018   LW V1, 24(SP)
9D01E850  8FA20014   LW V0, 20(SP)
9D01E854  8FA10010   LW AT, 16(SP)
9D01E858  41606000   DI ZERO
9D01E85C  000000C0   EHB
9D01E860  8FBA006C   LW K0, 108(SP)
9D01E864  8FBB0068   LW K1, 104(SP)
9D01E868  409A7000   MTC0 K0, EPC
9D01E86C  8FBA0064   LW K0, 100(SP)
9D01E870  27BD0070   ADDIU SP, SP, 112
9D01E874  409A6002   MTC0 K0, SRSCtl
9D01E878  41DDE800   WRPGPR SP, SP
9D01E87C  409B6000   MTC0 K1, Status
9D01E880  42000018   ERET
1210:                
1211:                extern volatile int nofrendo_ticks;
1212:                
1213:                void __ISR(_TIMER_1_VECTOR, IPL4AUTO) Timer1Handler(void)
1214:                	{
9D01E884  415DE800   RDPGPR SP, SP
9D01E888  401B7000   MFC0 K1, EPC
9D01E88C  401A6002   MFC0 K0, SRSCtl
9D01E890  27BDFFE8   ADDIU SP, SP, -24
9D01E894  AFBB0014   SW K1, 20(SP)
9D01E898  401B6000   MFC0 K1, Status
9D01E89C  AFBA000C   SW K0, 12(SP)
9D01E8A0  AFBB0010   SW K1, 16(SP)
9D01E8A4  7C1B7844   INS K1, ZERO, 1, 15
9D01E8A8  377B1000   ORI K1, K1, 4096
9D01E8AC  409B6000   MTC0 K1, Status
9D01E8B0  AFA30004   SW V1, 4(SP)
9D01E8B4  AFA20000   SW V0, 0(SP)
1215:                    IFS0bits.T1IF = 0;
9D01E8B8  3C02BF88   LUI V0, -16504
9D01E8BC  8C431030   LW V1, 4144(V0)
9D01E8C0  7C032104   INS V1, ZERO, 4, 1
9D01E8C4  AC431030   SW V1, 4144(V0)
1216:                    ++ticks;
9D01E8C8  8F8281E8   LW V0, -32280(GP)
9D01E8CC  24420001   ADDIU V0, V0, 1
9D01E8D0  AF8281E8   SW V0, -32280(GP)
1217:                    //if (ticks % 16 == 0)
1218:                        nofrendo_ticks++;
9D01E8D4  8F828194   LW V0, -32364(GP)
9D01E8D8  24420001   ADDIU V0, V0, 1
9D01E8DC  AF828194   SW V0, -32364(GP)
1219:                	}
9D01E8E0  8FA2000C   LW V0, 12(SP)
9D01E8E4  3042000F   ANDI V0, V0, 15
9D01E8E8  14400003   BNE V0, ZERO, 0x9D01E8F8
9D01E8EC  00000000   NOP
9D01E8F0  8FA30004   LW V1, 4(SP)
9D01E8F4  8FA20000   LW V0, 0(SP)
9D01E8F8  41606000   DI ZERO
9D01E8FC  000000C0   EHB
9D01E900  8FBA0014   LW K0, 20(SP)
9D01E904  8FBB0010   LW K1, 16(SP)
9D01E908  409A7000   MTC0 K0, EPC
9D01E90C  8FBA000C   LW K0, 12(SP)
9D01E910  27BD0018   ADDIU SP, SP, 24
9D01E914  409A6002   MTC0 K0, SRSCtl
9D01E918  41DDE800   WRPGPR SP, SP
9D01E91C  409B6000   MTC0 K1, Status
9D01E920  42000018   ERET
1220:                void __ISR(_EXTERNAL_2_VECTOR, IPL4AUTO) Int2Handler(void)
1221:                	{
9D01E924  415DE800   RDPGPR SP, SP
9D01E928  401B7000   MFC0 K1, EPC
9D01E92C  401A6002   MFC0 K0, SRSCtl
9D01E930  27BDFFE8   ADDIU SP, SP, -24
9D01E934  AFBB0014   SW K1, 20(SP)
9D01E938  401B6000   MFC0 K1, Status
9D01E93C  AFBA000C   SW K0, 12(SP)
9D01E940  AFBB0010   SW K1, 16(SP)
9D01E944  7C1B7844   INS K1, ZERO, 1, 15
9D01E948  377B1000   ORI K1, K1, 4096
9D01E94C  409B6000   MTC0 K1, Status
9D01E950  AFA30004   SW V1, 4(SP)
9D01E954  AFA20000   SW V0, 0(SP)
1222:                	IEC0bits.INT2IE = 0;
9D01E958  3C02BF88   LUI V0, -16504
9D01E95C  8C431060   LW V1, 4192(V0)
9D01E960  7C036B44   INS V1, ZERO, 13, 1
9D01E964  AC431060   SW V1, 4192(V0)
1223:                	}
9D01E968  8FA2000C   LW V0, 12(SP)
9D01E96C  3042000F   ANDI V0, V0, 15
9D01E970  14400003   BNE V0, ZERO, 0x9D01E980
9D01E974  00000000   NOP
9D01E978  8FA30004   LW V1, 4(SP)
9D01E97C  8FA20000   LW V0, 0(SP)
9D01E980  41606000   DI ZERO
9D01E984  000000C0   EHB
9D01E988  8FBA0014   LW K0, 20(SP)
9D01E98C  8FBB0010   LW K1, 16(SP)
9D01E990  409A7000   MTC0 K0, EPC
9D01E994  8FBA000C   LW K0, 12(SP)
9D01E998  27BD0018   ADDIU SP, SP, 24
9D01E99C  409A6002   MTC0 K0, SRSCtl
9D01E9A0  41DDE800   WRPGPR SP, SP
9D01E9A4  409B6000   MTC0 K1, Status
9D01E9A8  42000018   ERET
1224:                
1225:                uint16_t get_user_value (void)
1226:                	{
9D01E9AC  27BDFFC0   ADDIU SP, SP, -64
9D01E9B0  AFBF003C   SW RA, 60(SP)
9D01E9B4  AFB20038   SW S2, 56(SP)
9D01E9B8  AFB10034   SW S1, 52(SP)
9D01E9BC  AFB00030   SW S0, 48(SP)
1227:                	int8_t temp_arr[20];
1228:                	uint8_t temp_arr_p=0,char_val,stat;
9D01E9CC  00008821   ADDU S1, ZERO, ZERO
1229:                	uint32_t retval;
1230:                	stdio_write(" :");
9D01E9C0  3C049D03   LUI A0, -25341
9D01E9C4  0F40751F   JAL stdio_write
9D01E9C8  2484F620   ADDIU A0, A0, -2528
1231:                	while (1)
1232:                		{
1233:                		stat = stdio_get(&char_val);
9D01E9D4  0F4078AD   JAL stdio_get
9D01E9D8  27A40024   ADDIU A0, SP, 36
1234:                		if ((char_val!=NEWLINE)&(stat!=0))
9D01E9DC  0002802B   SLTU S0, ZERO, V0
9D01E9E0  12000017   BEQ S0, ZERO, 0x9D01EA40
9D01E9E4  93A40024   LBU A0, 36(SP)
9D01E9E8  3882000A   XORI V0, A0, 10
9D01E9EC  10400014   BEQ V0, ZERO, 0x9D01EA40
9D01E9F0  00000000   NOP
1235:                			{
1236:                			stdio_c(char_val);
9D01E9F4  0F4076E1   JAL stdio_c
9D01E9F8  00000000   NOP
1237:                			if (char_val>=' ') temp_arr[temp_arr_p++] = char_val;
9D01E9FC  93A20024   LBU V0, 36(SP)
9D01EA00  2C430020   SLTIU V1, V0, 32
9D01EA04  14600006   BNE V1, ZERO, 0x9D01EA20
9D01EA08  26230001   ADDIU V1, S1, 1
9D01EA0C  27A50010   ADDIU A1, SP, 16
9D01EA10  00B13021   ADDU A2, A1, S1
9D01EA14  A0C20000   SB V0, 0(A2)
9D01EA18  0B407A90   J 0x9D01EA40
9D01EA1C  307100FF   ANDI S1, V1, 255
1238:                			else if (char_val==BACKSPACE)
9D01E9D0  24120008   ADDIU S2, ZERO, 8
9D01EA20  14520007   BNE V0, S2, 0x9D01EA40
9D01EA24  00000000   NOP
1239:                				{
1240:                				if (temp_arr_p>0) temp_arr[--temp_arr_p]=0;
9D01EA28  12200014   BEQ S1, ZERO, 0x9D01EA7C
9D01EA2C  27A30010   ADDIU V1, SP, 16
9D01EA30  2631FFFF   ADDIU S1, S1, -1
9D01EA34  323100FF   ANDI S1, S1, 255
9D01EA38  00711021   ADDU V0, V1, S1
9D01EA3C  A0400000   SB ZERO, 0(V0)
1241:                				}
1242:                			}
1243:                	    if ((char_val==NEWLINE)&(stat!=0))
9D01EA40  1200000E   BEQ S0, ZERO, 0x9D01EA7C
9D01EA44  93A20024   LBU V0, 36(SP)
9D01EA48  3842000A   XORI V0, V0, 10
9D01EA4C  1440000B   BNE V0, ZERO, 0x9D01EA7C
9D01EA50  27A40010   ADDIU A0, SP, 16
1244:                			{
1245:                			temp_arr[temp_arr_p] = 0;
9D01EA54  00913821   ADDU A3, A0, S1
9D01EA58  A0E00000   SB ZERO, 0(A3)
1246:                			sscanf(temp_arr,"%d",&retval);
9D01EA5C  3C089D03   LUI T0, -25341
9D01EA60  2505F624   ADDIU A1, T0, -2524
9D01EA64  0F41046F   JAL .Letext0, .LFE1, _sscanf_cdnopuxX
9D01EA68  27A60028   ADDIU A2, SP, 40
1247:                			stdio_c('\n');
9D01EA6C  0F4076E1   JAL stdio_c
9D01EA70  2404000A   ADDIU A0, ZERO, 10
1248:                			return retval;
9D01EA74  0B407AA3   J 0x9D01EA8C
9D01EA78  97A20028   LHU V0, 40(SP)
1249:                			}
1250:                		if (brk_key) return 0;
9D01EA7C  938281E5   LBU V0, -32283(GP)
9D01EA80  7C021420   SEB V0, V0
9D01EA84  1040FFD3   BEQ V0, ZERO, 0x9D01E9D4
9D01EA88  00001021   ADDU V0, ZERO, ZERO
1251:                		}
1252:                	}
9D01EA8C  8FBF003C   LW RA, 60(SP)
9D01EA90  8FB20038   LW S2, 56(SP)
9D01EA94  8FB10034   LW S1, 52(SP)
9D01EA98  8FB00030   LW S0, 48(SP)
9D01EA9C  03E00008   JR RA
9D01EAA0  27BD0040   ADDIU SP, SP, 64
1253:                
1254:                
1255:                void display_refresh_force (void)
1256:                	{
9D01EAA4  27BDFFE8   ADDIU SP, SP, -24
9D01EAA8  AFBF0014   SW RA, 20(SP)
1257:                	tft_disp_buffer_refresh((uint8_t *)disp_buffer,(uint8_t *)color_buffer);
9D01EAAC  3C04A000   LUI A0, -24576
9D01EAB0  2484198C   ADDIU A0, A0, 6540
9D01EAB4  3C05A000   LUI A1, -24576
9D01EAB8  0F406709   JAL tft_disp_buffer_refresh
9D01EABC  24A51644   ADDIU A1, A1, 5700
1258:                	}
9D01EAC0  8FBF0014   LW RA, 20(SP)
9D01EAC4  03E00008   JR RA
9D01EAC8  27BD0018   ADDIU SP, SP, 24
---  /Users/nitro/basic-badge/firmware/badge1.X/src/Z80/hwz.c  ------------------------------------------
1:                   #include "hwz.h"
2:                   #include <xc.h>
3:                   #include <plib.h>
4:                   #include <stdio.h>
5:                   #include <fcntl.h>
6:                   #include <sys/appio.h>
7:                   
8:                   #include "sim.h"
9:                   #include "simglb.h"
10:                  #include "../hw.h"
11:                  
12:                  extern const uint8_t rom_image[65536];
13:                  extern const uint8_t rd_image[131072];
14:                  extern const uint8_t rd_image2[ROMDISK2_SIZE];
15:                  uint8_t drive, sector, track,disk_temp_pointer;
16:                  uint8_t disk_temp[128],flash_buff[4096], conin_buffer[30], conin_buffer_pointer;
17:                  
18:                  uint32_t last_addr = 0xFFFFF000;
19:                  uint8_t unwritten;
20:                  
21:                  uint8_t fl_rdsr(void);
22:                  uint32_t fl_rdid(void);
23:                  
24:                  #ifdef	USE_RAM_IMAGE
25:                  extern const uint8_t ram_image[65536];
26:                  #endif
27:                  
28:                  #ifdef	USE_RAMDISK
29:                  uint8_t ram_disk[RAMDISK_SIZE];
30:                  #endif
31:                  
32:                  //void reload_cpm_warm (void)
33:                  //{
34:                  //uint16_t i;
35:                  //#ifdef	USE_RAM_IMAGE	
36:                  //	for (i=0xD400;i<(0xD400+0x1EFF);i++) ram[i] = ram_image[i];
37:                  //#endif
38:                  //}
39:                  
40:                  //-------------------device at 0x68-----------------
41:                  uint8_t rxm_sta (void)
42:                  {
43:                  /*
44:                  if (U3BSTAbits.URXDA==1) return 0xFF;
45:                  	else return 0x00;
46:                   */
47:                  }
9D02DEF8  03E00008   JR RA
9D02DEFC  00000000   NOP
48:                  uint8_t rxm_read (void)
49:                  {
50:                  /*
51:                  return U3BRXREG;
52:                   */
53:                  }
9D02DF00  03E00008   JR RA
9D02DF04  00000000   NOP
54:                  void txm_write (uint8_t data)
55:                  {
9D02DF08  03E00008   JR RA
9D02DF0C  00000000   NOP
56:                  /*
57:                  U3BTXREG = data;
58:                  while (U3BSTAbits.UTXBF==1);
59:                   */
60:                  }
61:                  
62:                  void set_drive (uint8_t dat)
63:                  {
64:                  drive = dat;
9D02DF10  A38481A0   SB A0, -32352(GP)
65:                  disk_temp_pointer = 0;
9D02DF14  03E00008   JR RA
9D02DF18  A380819F   SB ZERO, -32353(GP)
66:                  }
67:                  void set_sector (uint8_t dat)
68:                  {
69:                  sector = dat;
9D02DF1C  A384819E   SB A0, -32354(GP)
70:                  disk_temp_pointer = 0;
9D02DF20  03E00008   JR RA
9D02DF24  A380819F   SB ZERO, -32353(GP)
71:                  }
72:                  void set_track (uint8_t dat)
73:                  {
74:                  track = dat;
9D02DF28  A38481A8   SB A0, -32344(GP)
75:                  disk_temp_pointer = 0;
9D02DF2C  03E00008   JR RA
9D02DF30  A380819F   SB ZERO, -32353(GP)
76:                  }
77:                  
78:                  //uint8_t read_disk_byte (void)
79:                  //{
80:                  //uint8_t temp;
81:                  //uint32_t  base,ptr;
82:                  //base = (((uint32_t )(track))*16) + sector;
83:                  //if (drive==0)
84:                  //	{
85:                  //	base = base*128;
86:                  //#ifdef USE_RAMDISK
87:                  //	ptr = base + disk_temp_pointer;
88:                  //	if (ptr<RAMDISK_SIZE)
89:                  //		temp = ram_disk[ptr];
90:                  //#endif
91:                  //#ifndef	USE_RAMDISK
92:                  //	temp = 0xA5;
93:                  //#endif
94:                  //	}
95:                  //if (drive==1)
96:                  //	{
97:                  //	base = base*128;
98:                  //#ifdef	USE_ROMDISK
99:                  //	temp = rd_image[base + disk_temp_pointer];
100:                 //#endif
101:                 //	}
102:                 //if (drive==2)
103:                 //	{
104:                 //#ifdef USE_EEPROM
105:                 //	if (disk_temp_pointer==0) read_sector(disk_temp,base);
106:                 //	temp = disk_temp[disk_temp_pointer];
107:                 //#endif
108:                 //	base = base*128;
109:                 //#ifdef	USE_ROMDISK2
110:                 //	temp = rd_image2[base + disk_temp_pointer];
111:                 //#endif
112:                 //	}
113:                 //
114:                 //if (drive==3)
115:                 //	{
116:                 //	if (disk_temp_pointer==0) fl_read_128(base+(CPM1_DISK1_OFFSET),disk_temp);
117:                 //	temp = disk_temp[disk_temp_pointer];
118:                 //	}
119:                 //if (drive==4)
120:                 //	{
121:                 //	}
122:                 //if (drive==5)
123:                 //	{
124:                 //	}
125:                 //if (drive==6)
126:                 //	{
127:                 //	}
128:                 //
129:                 //disk_temp_pointer++;
130:                 //return temp;
131:                 //}
132:                 //
133:                 //void write_disk_byte (uint8_t dat)
134:                 //{
135:                 //uint8_t temp;
136:                 //uint32_t base;
137:                 //uint32_t  ptr;
138:                 //base = (((unsigned int)(track))*16) + sector;
139:                 //if (drive==0)
140:                 //	{
141:                 //#ifdef	USE_RAMDISK
142:                 //	base = base*128;
143:                 //	ptr = base + disk_temp_pointer;
144:                 //	if (ptr<RAMDISK_SIZE)
145:                 //		ram_disk[ptr] = dat;
146:                 //#endif
147:                 //	}
148:                 //if (drive==1)
149:                 //	{
150:                 //	//rom disk, no writes allowed
151:                 //	}
152:                 //if (drive==2)
153:                 //	{
154:                 //#ifdef USE_EEPROM
155:                 //	disk_temp[disk_temp_pointer] = dat;
156:                 //	if (disk_temp_pointer==127) 
157:                 //		{
158:                 //		ee_wren();
159:                 //		write_sector(disk_temp,base);
160:                 //		}
161:                 //#endif
162:                 //	}
163:                 //if (drive==3)
164:                 //	{
165:                 //	disk_temp[disk_temp_pointer] = dat;
166:                 //	if (disk_temp_pointer==127) 
167:                 //		{
168:                 //		fl_write_128(base+(CPM1_DISK1_OFFSET),disk_temp);
169:                 //		}
170:                 //	}
171:                 //if (drive==4)
172:                 //	{
173:                 //	}
174:                 //if (drive==5)
175:                 //	{
176:                 //	}
177:                 //if (drive==6)
178:                 //	{
179:                 //	}
180:                 //disk_temp_pointer++;
181:                 //}
182:                 
183:                 uint8_t fl_rdsr(void)
184:                 {
9D02DF34  27BDFFE0   ADDIU SP, SP, -32
9D02DF38  AFBF001C   SW RA, 28(SP)
9D02DF3C  AFB00018   SW S0, 24(SP)
185:                 volatile uint8_t temp;
186:                 CS_FLASH = 0;
9D02DF40  3C10BF88   LUI S0, -16504
9D02DF44  92026530   LBU V0, 25904(S0)
9D02DF48  7C021084   INS V0, ZERO, 2, 1
9D02DF4C  A2026530   SB V0, 25904(S0)
187:                 SPI_dat(0x05);
9D02DF50  0F40A004   JAL SPI_dat
9D02DF54  24040005   ADDIU A0, ZERO, 5
188:                 temp = SPI_dat(0xFF);
9D02DF58  0F40A004   JAL SPI_dat
9D02DF5C  240400FF   ADDIU A0, ZERO, 255
9D02DF60  A3A20010   SB V0, 16(SP)
189:                 CS_FLASH = 1;
9D02DF64  92046530   LBU A0, 25904(S0)
9D02DF68  24030001   ADDIU V1, ZERO, 1
9D02DF6C  7C641084   INS A0, V1, 2, 1
9D02DF70  A2046530   SB A0, 25904(S0)
190:                 return temp;
9D02DF74  93A50010   LBU A1, 16(SP)
191:                 }
9D02DF78  30A200FF   ANDI V0, A1, 255
9D02DF7C  8FBF001C   LW RA, 28(SP)
9D02DF80  8FB00018   LW S0, 24(SP)
9D02DF84  03E00008   JR RA
9D02DF88  27BD0020   ADDIU SP, SP, 32
192:                 
193:                 
194:                 uint32_t fl_rdid(void)
195:                 {
9D02DF8C  27BDFFE0   ADDIU SP, SP, -32
9D02DF90  AFBF001C   SW RA, 28(SP)
9D02DF94  AFB20018   SW S2, 24(SP)
9D02DF98  AFB10014   SW S1, 20(SP)
9D02DF9C  AFB00010   SW S0, 16(SP)
196:                 uint8_t temp1,temp2,temp3;
197:                 uint32_t retval;
198:                 CS_FLASH = 0;
9D02DFA0  3C10BF88   LUI S0, -16504
9D02DFA4  92026530   LBU V0, 25904(S0)
9D02DFA8  7C021084   INS V0, ZERO, 2, 1
9D02DFAC  A2026530   SB V0, 25904(S0)
199:                 SPI_dat(0x9F);
9D02DFB0  0F40A004   JAL SPI_dat
9D02DFB4  2404009F   ADDIU A0, ZERO, 159
200:                 temp3 = SPI_dat(0xFF);
9D02DFB8  0F40A004   JAL SPI_dat
9D02DFBC  240400FF   ADDIU A0, ZERO, 255
9D02DFC0  00409021   ADDU S2, V0, ZERO
201:                 temp2 = SPI_dat(0x55);
9D02DFC4  0F40A004   JAL SPI_dat
9D02DFC8  24040055   ADDIU A0, ZERO, 85
9D02DFCC  00408821   ADDU S1, V0, ZERO
202:                 temp1 = SPI_dat(0xAA);
9D02DFD0  0F40A004   JAL SPI_dat
9D02DFD4  240400AA   ADDIU A0, ZERO, 170
203:                 CS_FLASH = 1;
9D02DFD8  92036530   LBU V1, 25904(S0)
9D02DFDC  24040001   ADDIU A0, ZERO, 1
9D02DFE0  7C831084   INS V1, A0, 2, 1
9D02DFE4  A2036530   SB V1, 25904(S0)
204:                 retval = (((uint32_t)(temp3))<<16)|(((uint32_t)(temp2))<<8)|(((uint32_t)(temp1))<<0);
9D02DFE8  00122C00   SLL A1, S2, 16
9D02DFEC  00113200   SLL A2, S1, 8
9D02DFF0  00A63825   OR A3, A1, A2
205:                 return retval;
206:                 }
9D02DFF4  00E21025   OR V0, A3, V0
9D02DFF8  8FBF001C   LW RA, 28(SP)
9D02DFFC  8FB20018   LW S2, 24(SP)
9D02E000  8FB10014   LW S1, 20(SP)
9D02E004  8FB00010   LW S0, 16(SP)
9D02E008  03E00008   JR RA
9D02E00C  27BD0020   ADDIU SP, SP, 32
207:                 
208:                 void fl_read_4k(uint32_t  addr, uint8_t * data)
209:                 {
9D02E010  27BDFFE0   ADDIU SP, SP, -32
9D02E014  AFBF001C   SW RA, 28(SP)
9D02E018  AFB20018   SW S2, 24(SP)
9D02E01C  AFB10014   SW S1, 20(SP)
9D02E020  AFB00010   SW S0, 16(SP)
9D02E024  00808821   ADDU S1, A0, ZERO
9D02E028  00A08021   ADDU S0, A1, ZERO
210:                 uint16_t i;
211:                 CS_FLASH = 0;
9D02E02C  3C02BF88   LUI V0, -16504
9D02E030  90436530   LBU V1, 25904(V0)
9D02E034  7C031084   INS V1, ZERO, 2, 1
9D02E038  A0436530   SB V1, 25904(V0)
212:                 SPI_dat(0x03);
9D02E03C  0F40A004   JAL SPI_dat
9D02E040  24040003   ADDIU A0, ZERO, 3
213:                 SPI_dat((addr>>16)&0xFF);
9D02E044  0F40A004   JAL SPI_dat
9D02E048  7E243C00   EXT A0, S1, 16, 8
214:                 SPI_dat((addr>>8)&0xFF);
9D02E04C  0F40A004   JAL SPI_dat
9D02E050  7E243A00   EXT A0, S1, 8, 8
215:                 SPI_dat((addr>>0)&0xFF);
9D02E054  0F40A004   JAL SPI_dat
9D02E058  322400FF   ANDI A0, S1, 255
9D02E05C  26121000   ADDIU S2, S0, 4096
216:                 for (i=0;i<4096;i++) *data++ = SPI_dat(0xFF);
9D02E060  0F40A004   JAL SPI_dat
9D02E064  240400FF   ADDIU A0, ZERO, 255
9D02E068  A2020000   SB V0, 0(S0)
9D02E06C  0F40A004   JAL SPI_dat
9D02E070  240400FF   ADDIU A0, ZERO, 255
9D02E074  A2020001   SB V0, 1(S0)
9D02E078  0F40A004   JAL SPI_dat
9D02E07C  240400FF   ADDIU A0, ZERO, 255
9D02E080  A2020002   SB V0, 2(S0)
9D02E084  0F40A004   JAL SPI_dat
9D02E088  240400FF   ADDIU A0, ZERO, 255
9D02E08C  A2020003   SB V0, 3(S0)
9D02E090  0F40A004   JAL SPI_dat
9D02E094  240400FF   ADDIU A0, ZERO, 255
9D02E098  A2020004   SB V0, 4(S0)
9D02E09C  0F40A004   JAL SPI_dat
9D02E0A0  240400FF   ADDIU A0, ZERO, 255
9D02E0A4  A2020005   SB V0, 5(S0)
9D02E0A8  0F40A004   JAL SPI_dat
9D02E0AC  240400FF   ADDIU A0, ZERO, 255
9D02E0B0  A2020006   SB V0, 6(S0)
9D02E0B4  26100008   ADDIU S0, S0, 8
9D02E0B8  0F40A004   JAL SPI_dat
9D02E0BC  240400FF   ADDIU A0, ZERO, 255
9D02E0C0  1612FFE7   BNE S0, S2, 0x9D02E060
9D02E0C4  A202FFFF   SB V0, -1(S0)
217:                 CS_FLASH = 1;
9D02E0C8  3C05BF88   LUI A1, -16504
9D02E0CC  90A66530   LBU A2, 25904(A1)
9D02E0D0  24040001   ADDIU A0, ZERO, 1
9D02E0D4  7C861084   INS A2, A0, 2, 1
9D02E0D8  A0A66530   SB A2, 25904(A1)
218:                 }
9D02E0DC  8FBF001C   LW RA, 28(SP)
9D02E0E0  8FB20018   LW S2, 24(SP)
9D02E0E4  8FB10014   LW S1, 20(SP)
9D02E0E8  8FB00010   LW S0, 16(SP)
9D02E0EC  03E00008   JR RA
9D02E0F0  27BD0020   ADDIU SP, SP, 32
219:                 
220:                 void fl_read_nk(uint32_t  addr, uint8_t * data, uint16_t n)
221:                 {
9D02E0F4  27BDFFE0   ADDIU SP, SP, -32
9D02E0F8  AFBF001C   SW RA, 28(SP)
9D02E0FC  AFB20018   SW S2, 24(SP)
9D02E100  AFB10014   SW S1, 20(SP)
9D02E104  AFB00010   SW S0, 16(SP)
9D02E108  00808821   ADDU S1, A0, ZERO
9D02E10C  00A08021   ADDU S0, A1, ZERO
9D02E110  00C09021   ADDU S2, A2, ZERO
222:                 uint16_t i;
223:                 CS_FLASH = 0;
9D02E114  3C02BF88   LUI V0, -16504
9D02E118  90436530   LBU V1, 25904(V0)
9D02E11C  7C031084   INS V1, ZERO, 2, 1
9D02E120  A0436530   SB V1, 25904(V0)
224:                 SPI_dat(0x03);
9D02E124  0F40A004   JAL SPI_dat
9D02E128  24040003   ADDIU A0, ZERO, 3
225:                 SPI_dat((addr>>16)&0xFF);
9D02E12C  0F40A004   JAL SPI_dat
9D02E130  7E243C00   EXT A0, S1, 16, 8
226:                 SPI_dat((addr>>8)&0xFF);
9D02E134  0F40A004   JAL SPI_dat
9D02E138  7E243A00   EXT A0, S1, 8, 8
227:                 SPI_dat((addr>>0)&0xFF);
9D02E13C  0F40A004   JAL SPI_dat
9D02E140  322400FF   ANDI A0, S1, 255
228:                 for (i=0;i<n;i++) *data++ = SPI_dat(0xFF);
9D02E144  12400028   BEQ S2, ZERO, 0x9D02E1E8
9D02E148  00103827   NOR A3, ZERO, S0
9D02E14C  2644FFFF   ADDIU A0, S2, -1
9D02E150  3085FFFF   ANDI A1, A0, -1
9D02E154  24A60001   ADDIU A2, A1, 1
9D02E158  02069021   ADDU S2, S0, A2
9D02E15C  02474021   ADDU T0, S2, A3
9D02E160  31110007   ANDI S1, T0, 7
9D02E164  26100001   ADDIU S0, S0, 1
9D02E168  0F40A004   JAL SPI_dat
9D02E16C  240400FF   ADDIU A0, ZERO, 255
9D02E170  16120028   BNE S0, S2, 0x9D02E214
9D02E174  A202FFFF   SB V0, -1(S0)
9D02E180  0F40A004   JAL SPI_dat
9D02E184  240400FF   ADDIU A0, ZERO, 255
9D02E188  A2020000   SB V0, 0(S0)
9D02E18C  0F40A004   JAL SPI_dat
9D02E190  240400FF   ADDIU A0, ZERO, 255
9D02E194  A2020001   SB V0, 1(S0)
9D02E198  0F40A004   JAL SPI_dat
9D02E19C  240400FF   ADDIU A0, ZERO, 255
9D02E1A0  A2020002   SB V0, 2(S0)
9D02E1A4  0F40A004   JAL SPI_dat
9D02E1A8  240400FF   ADDIU A0, ZERO, 255
9D02E1AC  A2020003   SB V0, 3(S0)
9D02E1B0  0F40A004   JAL SPI_dat
9D02E1B4  240400FF   ADDIU A0, ZERO, 255
9D02E1B8  A2020004   SB V0, 4(S0)
9D02E1BC  0F40A004   JAL SPI_dat
9D02E1C0  240400FF   ADDIU A0, ZERO, 255
9D02E1C4  A2020005   SB V0, 5(S0)
9D02E1C8  0F40A004   JAL SPI_dat
9D02E1CC  240400FF   ADDIU A0, ZERO, 255
9D02E1D0  A2020006   SB V0, 6(S0)
9D02E1D4  26100008   ADDIU S0, S0, 8
9D02E1D8  0F40A004   JAL SPI_dat
9D02E1DC  240400FF   ADDIU A0, ZERO, 255
9D02E1E0  1612FFE7   BNE S0, S2, 0x9D02E180
9D02E1E4  A202FFFF   SB V0, -1(S0)
9D02E24C  0F40A004   JAL SPI_dat
9D02E250  240400FF   ADDIU A0, ZERO, 255
9D02E254  A2020000   SB V0, 0(S0)
9D02E258  26100001   ADDIU S0, S0, 1
9D02E25C  0F40A004   JAL SPI_dat
9D02E260  240400FF   ADDIU A0, ZERO, 255
9D02E264  A2020000   SB V0, 0(S0)
9D02E268  26100001   ADDIU S0, S0, 1
9D02E26C  0F40A004   JAL SPI_dat
9D02E270  240400FF   ADDIU A0, ZERO, 255
9D02E274  A2020000   SB V0, 0(S0)
9D02E278  26100001   ADDIU S0, S0, 1
9D02E27C  0F40A004   JAL SPI_dat
9D02E280  240400FF   ADDIU A0, ZERO, 255
9D02E284  A2020000   SB V0, 0(S0)
9D02E288  26100001   ADDIU S0, S0, 1
9D02E28C  0F40A004   JAL SPI_dat
9D02E290  240400FF   ADDIU A0, ZERO, 255
9D02E294  A2020000   SB V0, 0(S0)
9D02E298  26100001   ADDIU S0, S0, 1
9D02E29C  0F40A004   JAL SPI_dat
9D02E2A0  240400FF   ADDIU A0, ZERO, 255
9D02E2A4  A2020000   SB V0, 0(S0)
9D02E2A8  26100001   ADDIU S0, S0, 1
9D02E2AC  26100001   ADDIU S0, S0, 1
9D02E2B0  0F40A004   JAL SPI_dat
9D02E2B4  240400FF   ADDIU A0, ZERO, 255
9D02E2B8  1612FFB1   BNE S0, S2, 0x9D02E180
9D02E2BC  A202FFFF   SB V0, -1(S0)
229:                 CS_FLASH = 1;
9D02E178  0B40B87B   J 0x9D02E1EC
9D02E17C  3C0FBF88   LUI T7, -16504
9D02E1E8  3C0FBF88   LUI T7, -16504
9D02E1EC  91F86530   LBU T8, 25904(T7)
9D02E1F0  24190001   ADDIU T9, ZERO, 1
9D02E1F4  7F381084   INS T8, T9, 2, 1
9D02E1F8  A1F86530   SB T8, 25904(T7)
9D02E2C0  0B40B87B   J 0x9D02E1EC
9D02E2C4  3C0FBF88   LUI T7, -16504
230:                 }
9D02E1FC  8FBF001C   LW RA, 28(SP)
9D02E200  8FB20018   LW S2, 24(SP)
9D02E204  8FB10014   LW S1, 20(SP)
9D02E208  8FB00010   LW S0, 16(SP)
9D02E20C  03E00008   JR RA
9D02E210  27BD0020   ADDIU SP, SP, 32
9D02E214  1220FFDA   BEQ S1, ZERO, 0x9D02E180
9D02E218  24090001   ADDIU T1, ZERO, 1
9D02E21C  12290023   BEQ S1, T1, 0x9D02E2AC
9D02E220  240A0002   ADDIU T2, ZERO, 2
9D02E224  122A001D   BEQ S1, T2, 0x9D02E29C
9D02E228  240B0003   ADDIU T3, ZERO, 3
9D02E22C  122B0017   BEQ S1, T3, 0x9D02E28C
9D02E230  240C0004   ADDIU T4, ZERO, 4
9D02E234  122C0011   BEQ S1, T4, 0x9D02E27C
9D02E238  240D0005   ADDIU T5, ZERO, 5
9D02E23C  122D000B   BEQ S1, T5, 0x9D02E26C
9D02E240  240E0006   ADDIU T6, ZERO, 6
9D02E244  122E0005   BEQ S1, T6, 0x9D02E25C
9D02E248  00000000   NOP
9D02E24C  0F40A004   JAL SPI_dat
9D02E250  240400FF   ADDIU A0, ZERO, 255
9D02E254  A2020000   SB V0, 0(S0)
9D02E258  26100001   ADDIU S0, S0, 1
9D02E25C  0F40A004   JAL SPI_dat
9D02E260  240400FF   ADDIU A0, ZERO, 255
9D02E264  A2020000   SB V0, 0(S0)
9D02E268  26100001   ADDIU S0, S0, 1
9D02E26C  0F40A004   JAL SPI_dat
9D02E270  240400FF   ADDIU A0, ZERO, 255
9D02E274  A2020000   SB V0, 0(S0)
9D02E278  26100001   ADDIU S0, S0, 1
9D02E27C  0F40A004   JAL SPI_dat
9D02E280  240400FF   ADDIU A0, ZERO, 255
9D02E284  A2020000   SB V0, 0(S0)
9D02E288  26100001   ADDIU S0, S0, 1
9D02E28C  0F40A004   JAL SPI_dat
9D02E290  240400FF   ADDIU A0, ZERO, 255
9D02E294  A2020000   SB V0, 0(S0)
9D02E298  26100001   ADDIU S0, S0, 1
9D02E29C  0F40A004   JAL SPI_dat
9D02E2A0  240400FF   ADDIU A0, ZERO, 255
9D02E2A4  A2020000   SB V0, 0(S0)
9D02E2A8  26100001   ADDIU S0, S0, 1
9D02E2AC  26100001   ADDIU S0, S0, 1
9D02E2B0  0F40A004   JAL SPI_dat
9D02E2B4  240400FF   ADDIU A0, ZERO, 255
9D02E2B8  1612FFB1   BNE S0, S2, 0x9D02E180
9D02E2BC  A202FFFF   SB V0, -1(S0)
9D02E2C0  0B40B87B   J 0x9D02E1EC
9D02E2C4  3C0FBF88   LUI T7, -16504
231:                 
232:                 
233:                 void fl_erase_4k(uint32_t  addr)
234:                 {
9D02E30C  27BDFFE0   ADDIU SP, SP, -32
9D02E310  AFBF001C   SW RA, 28(SP)
9D02E314  AFB10018   SW S1, 24(SP)
9D02E318  AFB00014   SW S0, 20(SP)
235:                 uint16_t i;
236:                 fl_wren();
9D02E31C  0F40B8B2   JAL fl_wren
9D02E320  00808821   ADDU S1, A0, ZERO
237:                 CS_FLASH = 0;
9D02E324  3C10BF88   LUI S0, -16504
9D02E328  92026530   LBU V0, 25904(S0)
9D02E32C  7C021084   INS V0, ZERO, 2, 1
9D02E330  A2026530   SB V0, 25904(S0)
238:                 SPI_dat(0x20);
9D02E334  0F40A004   JAL SPI_dat
9D02E338  24040020   ADDIU A0, ZERO, 32
239:                 SPI_dat((addr>>16)&0xFF);
9D02E33C  0F40A004   JAL SPI_dat
9D02E340  7E243C00   EXT A0, S1, 16, 8
240:                 SPI_dat((addr>>8)&0xFF);
9D02E344  0F40A004   JAL SPI_dat
9D02E348  7E243A00   EXT A0, S1, 8, 8
241:                 SPI_dat((addr>>0)&0xFF);
9D02E34C  0F40A004   JAL SPI_dat
9D02E350  322400FF   ANDI A0, S1, 255
242:                 CS_FLASH = 1;
9D02E354  92046530   LBU A0, 25904(S0)
9D02E358  24030001   ADDIU V1, ZERO, 1
9D02E35C  7C641084   INS A0, V1, 2, 1
9D02E360  A2046530   SB A0, 25904(S0)
243:                 while ((fl_rdsr())&0x01);
9D02E364  0F40B7CD   JAL fl_rdsr
9D02E368  00000000   NOP
9D02E36C  30450001   ANDI A1, V0, 1
9D02E370  14A0FFFC   BNE A1, ZERO, 0x9D02E364
9D02E374  8FBF001C   LW RA, 28(SP)
244:                 }
9D02E378  8FB10018   LW S1, 24(SP)
9D02E37C  8FB00014   LW S0, 20(SP)
9D02E380  03E00008   JR RA
9D02E384  27BD0020   ADDIU SP, SP, 32
245:                 
246:                 
247:                 void fl_write(uint32_t  addr,uint8_t data)
248:                 {
9D02E388  27BDFFE0   ADDIU SP, SP, -32
9D02E38C  AFBF001C   SW RA, 28(SP)
9D02E390  AFB20018   SW S2, 24(SP)
9D02E394  AFB10014   SW S1, 20(SP)
9D02E398  AFB00010   SW S0, 16(SP)
9D02E39C  00808821   ADDU S1, A0, ZERO
249:                 uint16_t i;
250:                 fl_wren();
9D02E3A0  0F40B8B2   JAL fl_wren
9D02E3A4  00A09021   ADDU S2, A1, ZERO
251:                 CS_FLASH = 0;
9D02E3A8  3C10BF88   LUI S0, -16504
9D02E3AC  92026530   LBU V0, 25904(S0)
9D02E3B0  7C021084   INS V0, ZERO, 2, 1
9D02E3B4  A2026530   SB V0, 25904(S0)
252:                 SPI_dat(0x02);
9D02E3B8  0F40A004   JAL SPI_dat
9D02E3BC  24040002   ADDIU A0, ZERO, 2
253:                 SPI_dat((addr>>16)&0xFF);
9D02E3C0  0F40A004   JAL SPI_dat
9D02E3C4  7E243C00   EXT A0, S1, 16, 8
254:                 SPI_dat((addr>>8)&0xFF);
9D02E3C8  0F40A004   JAL SPI_dat
9D02E3CC  7E243A00   EXT A0, S1, 8, 8
255:                 SPI_dat((addr>>0)&0xFF);
9D02E3D0  0F40A004   JAL SPI_dat
9D02E3D4  322400FF   ANDI A0, S1, 255
256:                 SPI_dat(data);
9D02E3D8  0F40A004   JAL SPI_dat
9D02E3DC  02402021   ADDU A0, S2, ZERO
257:                 CS_FLASH = 1;
9D02E3E0  92046530   LBU A0, 25904(S0)
9D02E3E4  24030001   ADDIU V1, ZERO, 1
9D02E3E8  7C641084   INS A0, V1, 2, 1
9D02E3EC  A2046530   SB A0, 25904(S0)
258:                 }
9D02E3F0  8FBF001C   LW RA, 28(SP)
9D02E3F4  8FB20018   LW S2, 24(SP)
9D02E3F8  8FB10014   LW S1, 20(SP)
9D02E3FC  8FB00010   LW S0, 16(SP)
9D02E400  03E00008   JR RA
9D02E404  27BD0020   ADDIU SP, SP, 32
259:                 
260:                 void fl_rst_pb(void)
261:                 {
9D02E408  27BDFFE8   ADDIU SP, SP, -24
9D02E40C  AFBF0014   SW RA, 20(SP)
262:                 /*
263:                 CS_FLASH = 0;
264:                 SPI_dat(0x50);
265:                 CS_FLASH = 1;
266:                 */
267:                 fl_wren();
9D02E410  0F40B8B2   JAL fl_wren
9D02E414  AFB00010   SW S0, 16(SP)
268:                 CS_FLASH = 0;
9D02E418  3C10BF88   LUI S0, -16504
9D02E41C  92026530   LBU V0, 25904(S0)
9D02E420  7C021084   INS V0, ZERO, 2, 1
9D02E424  A2026530   SB V0, 25904(S0)
269:                 SPI_dat(0x01);
9D02E428  0F40A004   JAL SPI_dat
9D02E42C  24040001   ADDIU A0, ZERO, 1
270:                 SPI_dat(0x00);
9D02E430  0F40A004   JAL SPI_dat
9D02E434  00002021   ADDU A0, ZERO, ZERO
271:                 CS_FLASH = 1;
9D02E438  92046530   LBU A0, 25904(S0)
9D02E43C  24030001   ADDIU V1, ZERO, 1
9D02E440  7C641084   INS A0, V1, 2, 1
9D02E444  A2046530   SB A0, 25904(S0)
272:                 }
9D02E448  8FBF0014   LW RA, 20(SP)
9D02E44C  8FB00010   LW S0, 16(SP)
9D02E450  03E00008   JR RA
9D02E454  27BD0018   ADDIU SP, SP, 24
273:                 
274:                 void fl_wren(void)
275:                 {
9D02E2C8  27BDFFE8   ADDIU SP, SP, -24
9D02E2CC  AFBF0014   SW RA, 20(SP)
9D02E2D0  AFB00010   SW S0, 16(SP)
276:                 CS_FLASH = 0;
9D02E2D4  3C10BF88   LUI S0, -16504
9D02E2D8  92026530   LBU V0, 25904(S0)
9D02E2DC  7C021084   INS V0, ZERO, 2, 1
9D02E2E0  A2026530   SB V0, 25904(S0)
277:                 SPI_dat(0x06);
9D02E2E4  0F40A004   JAL SPI_dat
9D02E2E8  24040006   ADDIU A0, ZERO, 6
278:                 CS_FLASH = 1;
9D02E2EC  92046530   LBU A0, 25904(S0)
9D02E2F0  24030001   ADDIU V1, ZERO, 1
9D02E2F4  7C641084   INS A0, V1, 2, 1
9D02E2F8  A2046530   SB A0, 25904(S0)
279:                 }
9D02E2FC  8FBF0014   LW RA, 20(SP)
9D02E300  8FB00010   LW S0, 16(SP)
9D02E304  03E00008   JR RA
9D02E308  27BD0018   ADDIU SP, SP, 24
280:                 
281:                 
282:                 void fl_write_4k(uint32_t  addr, uint8_t * data)
283:                 {
9D02E458  27BDFFE0   ADDIU SP, SP, -32
9D02E45C  AFBF001C   SW RA, 28(SP)
9D02E460  AFB20018   SW S2, 24(SP)
9D02E464  AFB10014   SW S1, 20(SP)
9D02E468  AFB00010   SW S0, 16(SP)
9D02E46C  24B21000   ADDIU S2, A1, 4096
9D02E470  00A08021   ADDU S0, A1, ZERO
9D02E474  00858823   SUBU S1, A0, A1
9D02E478  02112021   ADDU A0, S0, S1
284:                 uint16_t i;
285:                 for (i=0;i<4096;i++) 
9D02E49C  1612FFF7   BNE S0, S2, 0x9D02E47C
9D02E4A0  02112021   ADDU A0, S0, S1
286:                 	{
287:                 	fl_write(addr+i,*data++);
9D02E47C  26100001   ADDIU S0, S0, 1
9D02E480  0F40B8E2   JAL fl_write
9D02E484  9205FFFF   LBU A1, -1(S0)
288:                 	while ((fl_rdsr())&0x01);
9D02E488  0F40B7CD   JAL fl_rdsr
9D02E48C  00000000   NOP
9D02E490  30420001   ANDI V0, V0, 1
9D02E494  1440FFFC   BNE V0, ZERO, .LVL86
9D02E498  00000000   NOP
289:                 	}
290:                 }
9D02E4A4  8FBF001C   LW RA, 28(SP)
9D02E4A8  8FB20018   LW S2, 24(SP)
9D02E4AC  8FB10014   LW S1, 20(SP)
9D02E4B0  8FB00010   LW S0, 16(SP)
9D02E4B4  03E00008   JR RA
9D02E4B8  27BD0020   ADDIU SP, SP, 32
291:                 
292:                 void fl_write_128(uint32_t sector,uint8_t * data)
293:                 {
9D02E4BC  27BDFFE0   ADDIU SP, SP, -32
9D02E4C0  AFBF001C   SW RA, 28(SP)
9D02E4C4  AFB20018   SW S2, 24(SP)
9D02E4C8  AFB10014   SW S1, 20(SP)
9D02E4CC  AFB00010   SW S0, 16(SP)
294:                 uint32_t  addr;
295:                 uint8_t i;
296:                 addr = ((uint32_t )(sector))*128UL;
9D02E4D0  000491C0   SLL S2, A0, 7
297:                 addr = addr&0xFFFFF000;
9D02E4D4  2402F000   ADDIU V0, ZERO, -4096
9D02E4D8  02428824   AND S1, S2, V0
298:                 #ifdef	FLASH_BUFFERING	
299:                 if (last_addr!=addr)
9D02E4DC  8F848010   LW A0, -32752(GP)
9D02E4E0  1091003B   BEQ A0, S1, 0x9D02E5D0
9D02E4E4  00A08021   ADDU S0, A1, ZERO
300:                 	{
301:                 	if (last_addr!=0xFFFFF000)
9D02E4E8  50820008   BEQL A0, V0, 0x9D02E50C
9D02E4EC  02202021   ADDU A0, S1, ZERO
302:                 		{
303:                 		fl_erase_4k(last_addr);
9D02E4F0  0F40B8C3   JAL fl_erase_4k
9D02E4F4  00000000   NOP
304:                 		fl_write_4k(last_addr,flash_buff);
9D02E4F8  8F848010   LW A0, -32752(GP)
9D02E4FC  3C05A000   LUI A1, -24576
9D02E500  0F40B916   JAL fl_write_4k
9D02E504  24A50488   ADDIU A1, A1, 1160
305:                 		}
306:                 	fl_read_4k(addr,flash_buff);
9D02E508  02202021   ADDU A0, S1, ZERO
9D02E50C  3C03A000   LUI V1, -24576
9D02E510  0F40B804   JAL fl_read_4k
9D02E514  24650488   ADDIU A1, V1, 1160
307:                 	last_addr = addr;
9D02E518  0B40B974   J 0x9D02E5D0
9D02E51C  AF918010   SW S1, -32752(GP)
9D02E520  02076021   ADDU T4, S0, A3
308:                 	}
309:                 unwritten = 1;
9D02E5D0  24040001   ADDIU A0, ZERO, 1
9D02E5D4  A384819D   SB A0, -32355(GP)
310:                 #endif
311:                 #ifndef	FLASH_BUFFERING	
312:                 fl_read_4k(addr,flash_buff);
313:                 #endif
314:                 addr = ((uint32_t )(sector))*128UL;
315:                 addr = addr&0x00000FFF;
9D02E5D8  32460FFF   ANDI A2, S2, 4095
9D02E5DC  00003821   ADDU A3, ZERO, ZERO
9D02E5E0  3C08A000   LUI T0, -24576
9D02E5E4  25090488   ADDIU T1, T0, 1160
9D02E5E8  01265021   ADDU T2, T1, A2
316:                 for (i=0;i<128;i++) flash_buff[addr+i] = data[i];
9D02E524  918D0000   LBU T5, 0(T4)
9D02E528  01477021   ADDU T6, T2, A3
9D02E52C  A1CD0000   SB T5, 0(T6)
9D02E530  24EF0001   ADDIU T7, A3, 1
9D02E534  020FC821   ADDU T9, S0, T7
9D02E538  933F0000   LBU RA, 0(T9)
9D02E53C  014F9021   ADDU S2, T2, T7
9D02E540  A25F0000   SB RA, 0(S2)
9D02E544  25E20001   ADDIU V0, T7, 1
9D02E548  02028821   ADDU S1, S0, V0
9D02E54C  92250000   LBU A1, 0(S1)
9D02E550  01421821   ADDU V1, T2, V0
9D02E554  A0650000   SB A1, 0(V1)
9D02E558  25E40002   ADDIU A0, T7, 2
9D02E55C  02043021   ADDU A2, S0, A0
9D02E560  90C70000   LBU A3, 0(A2)
9D02E564  01444021   ADDU T0, T2, A0
9D02E568  A1070000   SB A3, 0(T0)
9D02E56C  25E90003   ADDIU T1, T7, 3
9D02E570  02096021   ADDU T4, S0, T1
9D02E574  918D0000   LBU T5, 0(T4)
9D02E578  01497021   ADDU T6, T2, T1
9D02E57C  A1CD0000   SB T5, 0(T6)
9D02E580  25F80004   ADDIU T8, T7, 4
9D02E584  0218C821   ADDU T9, S0, T8
9D02E588  933F0000   LBU RA, 0(T9)
9D02E58C  01589021   ADDU S2, T2, T8
9D02E590  A25F0000   SB RA, 0(S2)
9D02E594  25E20005   ADDIU V0, T7, 5
9D02E598  02028821   ADDU S1, S0, V0
9D02E59C  92250000   LBU A1, 0(S1)
9D02E5A0  01421821   ADDU V1, T2, V0
9D02E5A4  A0650000   SB A1, 0(V1)
9D02E5A8  25E40006   ADDIU A0, T7, 6
9D02E5AC  02043021   ADDU A2, S0, A0
9D02E5B0  90C70000   LBU A3, 0(A2)
9D02E5B4  01444021   ADDU T0, T2, A0
9D02E5B8  A1070000   SB A3, 0(T0)
9D02E5BC  25E70007   ADDIU A3, T7, 7
9D02E5C0  14EBFFD8   BNE A3, T3, 0x9D02E524
9D02E5C4  02076021   ADDU T4, S0, A3
9D02E5EC  0B40B948   J 0x9D02E520
9D02E5F0  240B0080   ADDIU T3, ZERO, 128
317:                 addr = ((uint32_t )(sector))*128UL;
318:                 addr = addr&0xFFFFF000;
319:                 #ifndef	FLASH_BUFFERING	
320:                 fl_erase_4k(addr);
321:                 fl_write_4k(addr,flash_buff);
322:                 #endif
323:                 }
9D02E5C8  0B40B97D   J 0x9D02E5F4
9D02E5CC  8FBF001C   LW RA, 28(SP)
9D02E5F4  8FB20018   LW S2, 24(SP)
9D02E5F8  8FB10014   LW S1, 20(SP)
9D02E5FC  8FB00010   LW S0, 16(SP)
9D02E600  03E00008   JR RA
9D02E604  27BD0020   ADDIU SP, SP, 32
324:                 
325:                 void fl_read_128(uint32_t sector,uint8_t * data)
326:                 {
9D02E608  27BDFFE0   ADDIU SP, SP, -32
9D02E60C  AFBF001C   SW RA, 28(SP)
9D02E610  AFB10018   SW S1, 24(SP)
9D02E614  AFB00014   SW S0, 20(SP)
9D02E618  00808821   ADDU S1, A0, ZERO
327:                 uint32_t  addr;
328:                 #ifdef	FLASH_BUFFERING	
329:                 if (unwritten == 1)
9D02E61C  9383819D   LBU V1, -32355(GP)
9D02E620  24020001   ADDIU V0, ZERO, 1
9D02E624  1462000A   BNE V1, V0, 0x9D02E650
9D02E628  00A08021   ADDU S0, A1, ZERO
330:                 	{
331:                 	fl_erase_4k(last_addr);
9D02E62C  0F40B8C3   JAL fl_erase_4k
9D02E630  8F848010   LW A0, -32752(GP)
332:                 	fl_write_4k(last_addr,flash_buff);
9D02E634  8F848010   LW A0, -32752(GP)
9D02E638  3C05A000   LUI A1, -24576
9D02E63C  0F40B916   JAL fl_write_4k
9D02E640  24A50488   ADDIU A1, A1, 1160
333:                 	unwritten = 0;	
9D02E644  A380819D   SB ZERO, -32355(GP)
334:                 	last_addr = 0xFFFFF000;
9D02E648  2404F000   ADDIU A0, ZERO, -4096
9D02E64C  AF848010   SW A0, -32752(GP)
335:                 	}
336:                 #endif
337:                 addr = ((uint32_t )(sector))*128UL;
338:                 fl_read_nk(addr,data,128);
9D02E650  001121C0   SLL A0, S1, 7
9D02E654  02002821   ADDU A1, S0, ZERO
9D02E658  0F40B83D   JAL fl_read_nk
9D02E65C  24060080   ADDIU A2, ZERO, 128
339:                 }
9D02E660  8FBF001C   LW RA, 28(SP)
9D02E664  8FB10018   LW S1, 24(SP)
9D02E668  8FB00014   LW S0, 20(SP)
9D02E66C  03E00008   JR RA
9D02E670  27BD0020   ADDIU SP, SP, 32
340:                 
341:                 uint8_t init_first_x_sects (uint8_t i, uint8_t verify)			//format directory area
342:                 {
9D02E674  27BDFFD0   ADDIU SP, SP, -48
9D02E678  AFBF002C   SW RA, 44(SP)
9D02E67C  AFB60028   SW S6, 40(SP)
9D02E680  AFB50024   SW S5, 36(SP)
9D02E684  AFB40020   SW S4, 32(SP)
9D02E688  AFB3001C   SW S3, 28(SP)
9D02E68C  AFB20018   SW S2, 24(SP)
9D02E690  AFB10014   SW S1, 20(SP)
9D02E694  AFB00010   SW S0, 16(SP)
9D02E698  00809821   ADDU S3, A0, ZERO
9D02E69C  00A0A021   ADDU S4, A1, ZERO
9D02E6A0  3C06A000   LUI A2, -24576
9D02E6A4  24C403E8   ADDIU A0, A2, 1000
9D02E6A8  24920080   ADDIU S2, A0, 128
343:                 uint32_t j,k;
344:                 for (j=0;j<128;j++) disk_temp[j]=0xE5;
9D02E6AC  2402FFE5   ADDIU V0, ZERO, -27
9D02E6B0  A0820000   SB V0, 0(A0)
9D02E6B4  A0820001   SB V0, 1(A0)
9D02E6B8  A0820002   SB V0, 2(A0)
9D02E6BC  A0820003   SB V0, 3(A0)
9D02E6C0  A0820004   SB V0, 4(A0)
9D02E6C4  A0820005   SB V0, 5(A0)
9D02E6C8  A0820006   SB V0, 6(A0)
9D02E6CC  A0820007   SB V0, 7(A0)
9D02E6D0  24840008   ADDIU A0, A0, 8
9D02E6D4  5492FFF7   BNEL A0, S2, 0x9D02E6B4
9D02E6D8  A0820000   SB V0, 0(A0)
345:                 #ifdef USE_EEPROM
346:                 for (j=0;j<i;j++) 
347:                 	{
348:                 	ee_wren();
349:                 	write_sector(disk_temp,j);
350:                 	}
351:                 #endif
352:                 for (j=0;j<i;j++) 
9D02E6DC  12600047   BEQ S3, ZERO, 0x9D02E7FC
9D02E6E0  26761000   ADDIU S6, S3, 4096
9D02E708  1616006C   BNE S0, S6, 0x9D02E8BC
9D02E70C  00000000   NOP
9D02E710  0B40BA07   J 0x9D02E81C
9D02E714  00000000   NOP
9D02E780  1616FFE6   BNE S0, S6, 0x9D02E71C
9D02E784  02002021   ADDU A0, S0, ZERO
9D02E788  0B40BA07   J 0x9D02E81C
9D02E78C  00000000   NOP
9D02E960  1616FF6E   BNE S0, S6, 0x9D02E71C
353:                 	{
354:                 	fl_write_128(j+(1*4096),disk_temp);
9D02E6E4  3C11A000   LUI S1, -24576
9D02E6E8  263103E8   ADDIU S1, S1, 1000
9D02E6EC  24101000   ADDIU S0, ZERO, 4096
9D02E6F0  26D5EFFF   ADDIU S5, S6, -4097
9D02E6F4  32B50007   ANDI S5, S5, 7
9D02E6F8  02002021   ADDU A0, S0, ZERO
9D02E6FC  0F40B92F   JAL fl_write_128
9D02E700  02202821   ADDU A1, S1, ZERO
9D02E704  26100001   ADDIU S0, S0, 1
9D02E718  02002021   ADDU A0, S0, ZERO
9D02E71C  0F40B92F   JAL fl_write_128
9D02E720  02202821   ADDU A1, S1, ZERO
9D02E724  26150001   ADDIU S5, S0, 1
9D02E728  02A02021   ADDU A0, S5, ZERO
9D02E72C  0F40B92F   JAL fl_write_128
9D02E730  02202821   ADDU A1, S1, ZERO
9D02E734  26A40001   ADDIU A0, S5, 1
9D02E738  0F40B92F   JAL fl_write_128
9D02E73C  02202821   ADDU A1, S1, ZERO
9D02E740  26A40002   ADDIU A0, S5, 2
9D02E744  0F40B92F   JAL fl_write_128
9D02E748  02202821   ADDU A1, S1, ZERO
9D02E74C  26A40003   ADDIU A0, S5, 3
9D02E750  0F40B92F   JAL fl_write_128
9D02E754  02202821   ADDU A1, S1, ZERO
9D02E758  26A40004   ADDIU A0, S5, 4
9D02E75C  0F40B92F   JAL fl_write_128
9D02E760  02202821   ADDU A1, S1, ZERO
9D02E764  26A40005   ADDIU A0, S5, 5
9D02E768  0F40B92F   JAL fl_write_128
9D02E76C  02202821   ADDU A1, S1, ZERO
9D02E770  26A40006   ADDIU A0, S5, 6
9D02E774  0F40B92F   JAL fl_write_128
9D02E778  02202821   ADDU A1, S1, ZERO
9D02E77C  26B00007   ADDIU S0, S5, 7
9D02E8EC  12AA0005   BEQ S5, T2, 0x9D02E904
9D02E8F0  02002021   ADDU A0, S0, ZERO
9D02E8F4  0F40B92F   JAL fl_write_128
9D02E8F8  02202821   ADDU A1, S1, ZERO
9D02E8FC  26100001   ADDIU S0, S0, 1
9D02E900  02002021   ADDU A0, S0, ZERO
9D02E904  0F40B92F   JAL fl_write_128
9D02E908  02202821   ADDU A1, S1, ZERO
9D02E90C  26100001   ADDIU S0, S0, 1
9D02E910  02002021   ADDU A0, S0, ZERO
9D02E914  0F40B92F   JAL fl_write_128
9D02E918  02202821   ADDU A1, S1, ZERO
9D02E91C  26100001   ADDIU S0, S0, 1
9D02E920  02002021   ADDU A0, S0, ZERO
9D02E924  0F40B92F   JAL fl_write_128
9D02E928  02202821   ADDU A1, S1, ZERO
9D02E92C  26100001   ADDIU S0, S0, 1
9D02E930  02002021   ADDU A0, S0, ZERO
9D02E934  0F40B92F   JAL fl_write_128
9D02E938  02202821   ADDU A1, S1, ZERO
9D02E93C  26100001   ADDIU S0, S0, 1
9D02E940  02002021   ADDU A0, S0, ZERO
9D02E944  0F40B92F   JAL fl_write_128
9D02E948  02202821   ADDU A1, S1, ZERO
9D02E94C  26100001   ADDIU S0, S0, 1
9D02E950  02002021   ADDU A0, S0, ZERO
9D02E954  0F40B92F   JAL fl_write_128
9D02E958  02202821   ADDU A1, S1, ZERO
9D02E95C  26100001   ADDIU S0, S0, 1
355:                 	}
356:                 
357:                 if (verify!=0)
9D02E790  24151000   ADDIU S5, ZERO, 4096
9D02E81C  1680FFDC   BNE S4, ZERO, 0x9D02E790
9D02E820  26731000   ADDIU S3, S3, 4096
358:                 	{
359:                 	for (j=0;j<i;j++) 
9D02E7EC  16B3FFEE   BNE S5, S3, 0x9D02E7A8
9D02E7F0  02A02021   ADDU A0, S5, ZERO
9D02E7F4  0B40BA05   J 0x9D02E814
9D02E7F8  00001021   ADDU V0, ZERO, ZERO
360:                 		{
361:                 		fl_read_128(j+(1*4096),disk_temp);
9D02E794  3C14A000   LUI S4, -24576
9D02E798  269603E8   ADDIU S6, S4, 1000
9D02E7A4  02A02021   ADDU A0, S5, ZERO
9D02E7A8  0F40B982   JAL fl_read_128
9D02E7AC  02C02821   ADDU A1, S6, ZERO
362:                 		for (k=0;k<128;k++) 
9D02E8AC  5647FFC8   BNEL S2, A3, 0x9D02E7D0
9D02E8B0  90EE0000   LBU T6, 0(A3)
9D02E8B4  0B40B9FB   J 0x9D02E7EC
9D02E8B8  26B50001   ADDIU S5, S5, 1
9D02E8BC  12A0FF96   BEQ S5, ZERO, 0x9D02E718
9D02E8C0  24030001   ADDIU V1, ZERO, 1
9D02E8C4  12A30022   BEQ S5, V1, 0x9D02E950
9D02E8C8  24050002   ADDIU A1, ZERO, 2
9D02E8CC  12A5001C   BEQ S5, A1, 0x9D02E940
9D02E8D0  24070003   ADDIU A3, ZERO, 3
9D02E8D4  12A70016   BEQ S5, A3, 0x9D02E930
9D02E8D8  24080004   ADDIU T0, ZERO, 4
9D02E8DC  12A80010   BEQ S5, T0, 0x9D02E920
9D02E8E0  24090005   ADDIU T1, ZERO, 5
9D02E8E4  12A9000A   BEQ S5, T1, 0x9D02E910
9D02E8E8  240A0006   ADDIU T2, ZERO, 6
363:                 			{
364:                 			if (disk_temp[k]!=0xE5)
9D02E79C  241000E5   ADDIU S0, ZERO, 229
9D02E7A0  3C11A000   LUI S1, -24576
9D02E7B0  928B03E8   LBU T3, 1000(S4)
9D02E7B4  15700013   BNE T3, S0, 0x9D02E804
9D02E7B8  922D03E9   LBU T5, 1001(S1)
9D02E7BC  11B00024   BEQ T5, S0, 0x9D02E850
9D02E7C0  262C03E9   ADDIU T4, S1, 1001
9D02E7CC  90EE0000   LBU T6, 0(A3)
9D02E7D0  15D00015   BNE T6, S0, 0x9D02E828
9D02E7D4  24020001   ADDIU V0, ZERO, 1
9D02E7D8  90F80001   LBU T8, 1(A3)
9D02E7DC  1310001E   BEQ T8, S0, 0x9D02E858
9D02E7E0  24EF0001   ADDIU T7, A3, 1
9D02E858  91F90001   LBU T9, 1(T7)
9D02E85C  1730FFF2   BNE T9, S0, 0x9D02E828
9D02E860  24020001   ADDIU V0, ZERO, 1
9D02E864  91FF0002   LBU RA, 2(T7)
9D02E868  57F0FFF0   BNEL RA, S0, 0x9D02E82C
9D02E86C  8FBF002C   LW RA, 44(SP)
9D02E870  91E60003   LBU A2, 3(T7)
9D02E874  54D0FFED   BNEL A2, S0, 0x9D02E82C
9D02E878  8FBF002C   LW RA, 44(SP)
9D02E87C  91E20004   LBU V0, 4(T7)
9D02E880  5450FFE9   BNEL V0, S0, 0x9D02E828
9D02E884  24020001   ADDIU V0, ZERO, 1
9D02E888  91E40005   LBU A0, 5(T7)
9D02E88C  5490FFE6   BNEL A0, S0, 0x9D02E828
9D02E890  24020001   ADDIU V0, ZERO, 1
9D02E894  91E30006   LBU V1, 6(T7)
9D02E898  5470FFE3   BNEL V1, S0, 0x9D02E828
9D02E89C  24020001   ADDIU V0, ZERO, 1
9D02E8A0  91E50007   LBU A1, 7(T7)
9D02E8A4  14B0FFD9   BNE A1, S0, 0x9D02E80C
9D02E8A8  25E70008   ADDIU A3, T7, 8
365:                 				{
366:                 				return 1;
9D02E7C4  0B40BA0A   J 0x9D02E828
9D02E7C8  24020001   ADDIU V0, ZERO, 1
9D02E804  0B40BA0A   J 0x9D02E828
9D02E808  24020001   ADDIU V0, ZERO, 1
9D02E80C  0B40BA0A   J 0x9D02E828
9D02E810  24020001   ADDIU V0, ZERO, 1
367:                 				}
368:                 			}
369:                 		}
370:                 	}
371:                 return 0;
9D02E7FC  0B40BA0A   J 0x9D02E828
9D02E800  00001021   ADDU V0, ZERO, ZERO
9D02E824  00001021   ADDU V0, ZERO, ZERO
372:                 }
9D02E7E4  0B40BA0B   J 0x9D02E82C
9D02E7E8  8FBF002C   LW RA, 44(SP)
9D02E814  0B40BA0B   J 0x9D02E82C
9D02E818  8FBF002C   LW RA, 44(SP)
9D02E828  8FBF002C   LW RA, 44(SP)
9D02E82C  8FB60028   LW S6, 40(SP)
9D02E830  8FB50024   LW S5, 36(SP)
9D02E834  8FB40020   LW S4, 32(SP)
9D02E838  8FB3001C   LW S3, 28(SP)
9D02E83C  8FB20018   LW S2, 24(SP)
9D02E840  8FB10014   LW S1, 20(SP)
9D02E844  8FB00010   LW S0, 16(SP)
9D02E848  03E00008   JR RA
9D02E84C  27BD0030   ADDIU SP, SP, 48
9D02E850  0B40B9F3   J 0x9D02E7CC
9D02E854  25870001   ADDIU A3, T4, 1
9D02E858  91F90001   LBU T9, 1(T7)
9D02E85C  1730FFF2   BNE T9, S0, 0x9D02E828
9D02E860  24020001   ADDIU V0, ZERO, 1
9D02E864  91FF0002   LBU RA, 2(T7)
9D02E868  57F0FFF0   BNEL RA, S0, 0x9D02E82C
9D02E86C  8FBF002C   LW RA, 44(SP)
9D02E870  91E60003   LBU A2, 3(T7)
9D02E874  54D0FFED   BNEL A2, S0, 0x9D02E82C
9D02E878  8FBF002C   LW RA, 44(SP)
9D02E87C  91E20004   LBU V0, 4(T7)
9D02E880  5450FFE9   BNEL V0, S0, 0x9D02E828
9D02E884  24020001   ADDIU V0, ZERO, 1
9D02E888  91E40005   LBU A0, 5(T7)
9D02E88C  5490FFE6   BNEL A0, S0, 0x9D02E828
9D02E890  24020001   ADDIU V0, ZERO, 1
9D02E894  91E30006   LBU V1, 6(T7)
9D02E898  5470FFE3   BNEL V1, S0, 0x9D02E828
9D02E89C  24020001   ADDIU V0, ZERO, 1
9D02E8A0  91E50007   LBU A1, 7(T7)
9D02E8A4  14B0FFD9   BNE A1, S0, 0x9D02E80C
9D02E8A8  25E70008   ADDIU A3, T7, 8
9D02E8AC  5647FFC8   BNEL S2, A3, 0x9D02E7D0
9D02E8B0  90EE0000   LBU T6, 0(A3)
9D02E8B4  0B40B9FB   J 0x9D02E7EC
9D02E8B8  26B50001   ADDIU S5, S5, 1
9D02E8BC  12A0FF96   BEQ S5, ZERO, 0x9D02E718
9D02E8C0  24030001   ADDIU V1, ZERO, 1
9D02E8C4  12A30022   BEQ S5, V1, 0x9D02E950
9D02E8C8  24050002   ADDIU A1, ZERO, 2
9D02E8CC  12A5001C   BEQ S5, A1, 0x9D02E940
9D02E8D0  24070003   ADDIU A3, ZERO, 3
9D02E8D4  12A70016   BEQ S5, A3, 0x9D02E930
9D02E8D8  24080004   ADDIU T0, ZERO, 4
9D02E8DC  12A80010   BEQ S5, T0, 0x9D02E920
9D02E8E0  24090005   ADDIU T1, ZERO, 5
9D02E8E4  12A9000A   BEQ S5, T1, 0x9D02E910
9D02E8E8  240A0006   ADDIU T2, ZERO, 6
9D02E8EC  12AA0005   BEQ S5, T2, 0x9D02E904
9D02E8F0  02002021   ADDU A0, S0, ZERO
9D02E8F4  0F40B92F   JAL fl_write_128
9D02E8F8  02202821   ADDU A1, S1, ZERO
9D02E8FC  26100001   ADDIU S0, S0, 1
9D02E900  02002021   ADDU A0, S0, ZERO
9D02E904  0F40B92F   JAL fl_write_128
9D02E908  02202821   ADDU A1, S1, ZERO
9D02E90C  26100001   ADDIU S0, S0, 1
9D02E910  02002021   ADDU A0, S0, ZERO
9D02E914  0F40B92F   JAL fl_write_128
9D02E918  02202821   ADDU A1, S1, ZERO
9D02E91C  26100001   ADDIU S0, S0, 1
9D02E920  02002021   ADDU A0, S0, ZERO
9D02E924  0F40B92F   JAL fl_write_128
9D02E928  02202821   ADDU A1, S1, ZERO
9D02E92C  26100001   ADDIU S0, S0, 1
9D02E930  02002021   ADDU A0, S0, ZERO
9D02E934  0F40B92F   JAL fl_write_128
9D02E938  02202821   ADDU A1, S1, ZERO
9D02E93C  26100001   ADDIU S0, S0, 1
9D02E940  02002021   ADDU A0, S0, ZERO
9D02E944  0F40B92F   JAL fl_write_128
9D02E948  02202821   ADDU A1, S1, ZERO
9D02E94C  26100001   ADDIU S0, S0, 1
9D02E950  02002021   ADDU A0, S0, ZERO
9D02E954  0F40B92F   JAL fl_write_128
9D02E958  02202821   ADDU A1, S1, ZERO
9D02E95C  26100001   ADDIU S0, S0, 1
9D02E960  1616FF6E   BNE S0, S6, 0x9D02E71C
9D02E964  02002021   ADDU A0, S0, ZERO
9D02E968  0B40BA07   J 0x9D02E81C
9D02E96C  00000000   NOP
373:                 
374:                 
375:                 
376:                 #ifdef USE_EEPROM
377:                 void write_sector (unsigned char *data, unsigned int addr)
378:                 {
379:                 unsigned char i,temp;
380:                 CS_MEM = 0;
381:                 SPI_dat(0x02);
382:                 temp = (addr>>9);
383:                 SPI_dat(temp);
384:                 temp = (addr>>1);
385:                 SPI_dat(temp);
386:                 temp = (addr<<7);
387:                 SPI_dat(temp);
388:                 
389:                 for (i=0;i<128;i++) 
390:                 	SPI_dat(data[i]);
391:                 
392:                 CS_MEM = 1;
393:                 temp = ee_rs();
394:                 temp = temp&0x01;
395:                 
396:                 while (temp>0)
397:                 	{
398:                 	temp = ee_rs();
399:                 	temp = temp&0x01;
400:                 	}
401:                 }
402:                 
403:                 void read_sector (unsigned char *data, unsigned int addr)
404:                 {
405:                 unsigned char i,temp;
406:                 CS_MEM = 0;
407:                 SPI_dat(0x03);
408:                 temp = (addr>>9);
409:                 SPI_dat(temp);
410:                 temp = (addr>>1);
411:                 SPI_dat(temp);
412:                 temp = (addr<<7);
413:                 SPI_dat(temp);
414:                 
415:                 
416:                 for (i=0;i<128;i++) 
417:                 	{
418:                 	*data = SPI_dat(0xFF);
419:                 	*data++;
420:                 	}
421:                 
422:                 CS_MEM = 1;
423:                 }
424:                 unsigned char ee_rs (void)
425:                 {
426:                 unsigned char temp;
427:                 CS_MEM = 0;
428:                 SPI_dat(0x05);
429:                 temp = SPI_dat(0xFF);
430:                 CS_MEM = 1;
431:                 return temp;
432:                 }
433:                 
434:                 void ee_wren (void)
435:                 {
436:                 CS_MEM = 0;
437:                 SPI_dat(0x06);
438:                 CS_MEM = 1;
439:                 }
440:                 
441:                 void ee_wrdi (void)
442:                 {
443:                 CS_MEM = 0;
444:                 SPI_dat(0x04);
445:                 CS_MEM = 1;
446:                 }
447:                 
448:                 #endif
---  /Users/bamboo/Applications/Bamboo-agent/build/bamboo-agent1/xml-data/build-dir/XC32-TBC-TY/builddir/pic32m-source/src48x/gcc/libgcc/libgcc2.c
9D041FC4  10C00009   BEQ A2, ZERO, 0x9D041FEC
9D041FC8  00801021   ADDU V0, A0, ZERO
9D041FCC  24020020   ADDIU V0, ZERO, 32
9D041FD0  00461023   SUBU V0, V0, A2
9D041FD4  18400007   BLEZ V0, 0x9D041FF4
9D041FD8  00C42006   SRLV A0, A0, A2
9D041FF8  00001821   ADDU V1, ZERO, ZERO
9D041FF4  00021023   SUBU V0, ZERO, V0
9D041FDC  00451004   SLLV V0, A1, V0
9D041FE0  00C51806   SRLV V1, A1, A2
9D041FE4  03E00008   JR RA
9D041FE8  00441025   OR V0, V0, A0
9D041FEC  03E00008   JR RA
9D041FF0  00A01821   ADDU V1, A1, ZERO
9D041FF4  00021023   SUBU V0, ZERO, V0
9D041FF8  00001821   ADDU V1, ZERO, ZERO
9D041FFC  03E00008   JR RA
9D042000  00451006   SRLV V0, A1, V0
9D042004  10C00009   BEQ A2, ZERO, 0x9D04202C
9D042008  00801021   ADDU V0, A0, ZERO
9D04200C  24030020   ADDIU V1, ZERO, 32
9D042010  00661823   SUBU V1, V1, A2
9D042014  18600007   BLEZ V1, 0x9D042034
9D042018  00C52804   SLLV A1, A1, A2
9D042038  00001021   ADDU V0, ZERO, ZERO
9D042034  00031823   SUBU V1, ZERO, V1
9D04201C  00641806   SRLV V1, A0, V1
9D042020  00C41004   SLLV V0, A0, A2
9D042024  03E00008   JR RA
9D042028  00651825   OR V1, V1, A1
9D04202C  03E00008   JR RA
9D042030  00A01821   ADDU V1, A1, ZERO
9D042034  00031823   SUBU V1, ZERO, V1
9D042038  00001021   ADDU V0, ZERO, ZERO
9D04203C  03E00008   JR RA
9D042040  00641804   SLLV V1, A0, V1
9D033E98  00C04021   ADDU T0, A2, ZERO
9D0347A8  00C04021   ADDU T0, A2, ZERO
9D034C0C  00C04021   ADDU T0, A2, ZERO
9D033E9C  00805021   ADDU T2, A0, ZERO
9D0347AC  00804821   ADDU T1, A0, ZERO
9D034C10  00801021   ADDU V0, A0, ZERO
9D033EA0  14E00046   BNE A3, ZERO, 0x9D033FBC
9D033EA4  00A01821   ADDU V1, A1, ZERO
9D0347B0  14E0003B   BNE A3, ZERO, 0x9D0348A0
9D0347B4  00A01821   ADDU V1, A1, ZERO
9D034C14  14E0003F   BNE A3, ZERO, 0x9D034D14
9D034C18  00A04821   ADDU T1, A1, ZERO
9D033EA8  00A6102B   SLTU V0, A1, A2
9D033EAC  1040005D   BEQ V0, ZERO, 0x9D034024
9D033EB0  70C21020   CLZ V0, A2
9D0347B8  00A6102B   SLTU V0, A1, A2
9D0347BC  10400048   BEQ V0, ZERO, 0x9D0348E0
9D0347C0  70C21020   CLZ V0, A2
9D034C1C  00A6182B   SLTU V1, A1, A2
9D034C20  10600047   BEQ V1, ZERO, 0x9D034D40
9D034C24  70C31820   CLZ V1, A2
9D033EB4  50400008   BEQL V0, ZERO, 0x9D033ED8
9D033EB8  00082C02   SRL A1, T0, 16
9D0347C4  50400008   BEQL V0, ZERO, 0x9D0347E8
9D0347C8  00083402   SRL A2, T0, 16
9D034C28  50600008   BEQL V1, ZERO, 0x9D034C4C
9D034C2C  00081C02   SRL V1, T0, 16
9D033EC8  00464004   SLLV T0, A2, V0
9D0347D8  00464004   SLLV T0, A2, V0
9D034C3C  00664004   SLLV T0, A2, V1
9D033EBC  00022023   SUBU A0, ZERO, V0
9D033EC0  008A2006   SRLV A0, T2, A0
9D033EC4  00451804   SLLV V1, A1, V0
9D033ECC  00831825   OR V1, A0, V1
9D0347CC  00021823   SUBU V1, ZERO, V0
9D0347D0  00452804   SLLV A1, A1, V0
9D0347D4  00641806   SRLV V1, A0, V1
9D0347DC  00651825   OR V1, V1, A1
9D034C30  00034823   SUBU T1, ZERO, V1
9D034C34  00652804   SLLV A1, A1, V1
9D034C38  01244806   SRLV T1, A0, T1
9D034C40  01254825   OR T1, T1, A1
9D033ED0  004A5004   SLLV T2, T2, V0
9D0347E0  00444804   SLLV T1, A0, V0
9D034C44  00641004   SLLV V0, A0, V1
9D033ED4  00082C02   SRL A1, T0, 16
9D033ED8  0065001B   DIVU V1, A1
9D033EDC  00A001F4   TEQ A1, ZERO
9D033EE0  00006010   MFHI T4
9D033EE4  00005812   MFLO T3
9D033EE8  3107FFFF   ANDI A3, T0, -1
9D033EEC  000A2402   SRL A0, T2, 16
9D033EF0  00001012   MFLO V0
9D033EF4  71673002   MUL A2, T3, A3
9D033EF8  000C6400   SLL T4, T4, 16
9D033EFC  01842025   OR A0, T4, A0
9D033F00  0086602B   SLTU T4, A0, A2
9D033F04  0065001B   DIVU V1, A1
9D033F08  00A001F4   TEQ A1, ZERO
9D033F0C  1180000B   BEQ T4, ZERO, 0x9D033F3C
9D033F10  00861823   SUBU V1, A0, A2
9D033F14  00882021   ADDU A0, A0, T0
9D033F18  0088182B   SLTU V1, A0, T0
9D033F1C  14600006   BNE V1, ZERO, 0x9D033F38
9D033F20  2562FFFF   ADDIU V0, T3, -1
9D033F24  0086182B   SLTU V1, A0, A2
9D033F28  10600004   BEQ V1, ZERO, 0x9D033F3C
9D033F2C  00861823   SUBU V1, A0, A2
9D033F30  2562FFFE   ADDIU V0, T3, -2
9D033F34  00882021   ADDU A0, A0, T0
9D033F38  00861823   SUBU V1, A0, A2
9D033F3C  314AFFFF   ANDI T2, T2, -1
9D033F40  0065001B   DIVU V1, A1
9D033F44  00A001F4   TEQ A1, ZERO
9D033F48  00005810   MFHI T3
9D033F4C  00003012   MFLO A2
9D033F50  00002012   MFLO A0
9D033F54  70C73802   MUL A3, A2, A3
9D033F58  000B5C00   SLL T3, T3, 16
9D033F5C  016A5025   OR T2, T3, T2
9D033F60  0147582B   SLTU T3, T2, A3
9D033F64  0065001B   DIVU V1, A1
9D033F68  00A001F4   TEQ A1, ZERO
9D033F6C  51600009   BEQL T3, ZERO, 0x9D033F94
9D033F70  00021400   SLL V0, V0, 16
9D033F74  01485021   ADDU T2, T2, T0
9D033F78  0148402B   SLTU T0, T2, T0
9D033F7C  15000004   BNE T0, ZERO, 0x9D033F90
9D033F80  24C4FFFF   ADDIU A0, A2, -1
9D033F84  0147382B   SLTU A3, T2, A3
9D033F88  24C6FFFE   ADDIU A2, A2, -2
9D033F8C  00C7200B   MOVN A0, A2, A3
9D033F90  00021400   SLL V0, V0, 16
9D033F94  00821025   OR V0, A0, V0
9D033F98  00001821   ADDU V1, ZERO, ZERO
9D0347E4  00083402   SRL A2, T0, 16
9D0347E8  0066001B   DIVU V1, A2
9D0347EC  00C001F4   TEQ A2, ZERO
9D0347F0  00002010   MFHI A0
9D0347F4  00005812   MFLO T3
9D0347F8  310CFFFF   ANDI T4, T0, -1
9D0347FC  00095402   SRL T2, T1, 16
9D034800  716C5802   MUL T3, T3, T4
9D034804  00042400   SLL A0, A0, 16
9D034808  008A5025   OR T2, A0, T2
9D03480C  014B682B   SLTU T5, T2, T3
9D034810  0066001B   DIVU V1, A2
9D034814  00C001F4   TEQ A2, ZERO
9D034818  51A00009   BEQL T5, ZERO, 0x9D034840
9D03481C  014B5023   SUBU T2, T2, T3
9D034820  01485021   ADDU T2, T2, T0
9D034824  0148182B   SLTU V1, T2, T0
9D034828  54600005   BNEL V1, ZERO, 0x9D034840
9D03482C  014B5023   SUBU T2, T2, T3
9D034830  014B202B   SLTU A0, T2, T3
9D034834  01481821   ADDU V1, T2, T0
9D034838  0064500B   MOVN T2, V1, A0
9D03483C  014B5023   SUBU T2, T2, T3
9D034840  3123FFFF   ANDI V1, T1, -1
9D034844  0146001B   DIVU T2, A2
9D034848  00C001F4   TEQ A2, ZERO
9D03484C  00004810   MFHI T1
9D034850  00002012   MFLO A0
9D034854  708C2002   MUL A0, A0, T4
9D034858  00094C00   SLL T1, T1, 16
9D03485C  01234825   OR T1, T1, V1
9D034860  0124182B   SLTU V1, T1, A0
9D034864  0146001B   DIVU T2, A2
9D034868  00C001F4   TEQ A2, ZERO
9D03486C  50600009   BEQL V1, ZERO, .LBE15
9D034870  01244823   SUBU T1, T1, A0
9D034874  01284821   ADDU T1, T1, T0
9D034878  0128182B   SLTU V1, T1, T0
9D03487C  54600005   BNEL V1, ZERO, .LBE15
9D034880  01244823   SUBU T1, T1, A0
9D034884  0124182B   SLTU V1, T1, A0
9D034888  01284021   ADDU T0, T1, T0
9D03488C  0103480B   MOVN T1, T0, V1
9D034890  01244823   SUBU T1, T1, A0
9D034C48  00081C02   SRL V1, T0, 16
9D034C4C  0123001B   DIVU T1, V1
9D034C50  006001F4   TEQ V1, ZERO
9D034C54  00006010   MFHI T4
9D034C58  00005812   MFLO T3
9D034C5C  310AFFFF   ANDI T2, T0, -1
9D034C60  00022402   SRL A0, V0, 16
9D034C64  00003012   MFLO A2
9D034C68  716A3802   MUL A3, T3, T2
9D034C6C  000C6400   SLL T4, T4, 16
9D034C70  01842025   OR A0, T4, A0
9D034C74  0087602B   SLTU T4, A0, A3
9D034C78  0123001B   DIVU T1, V1
9D034C7C  006001F4   TEQ V1, ZERO
9D034C80  1180000B   BEQ T4, ZERO, 0x9D034CB0
9D034C84  00872823   SUBU A1, A0, A3
9D034C88  00882021   ADDU A0, A0, T0
9D034C8C  0088282B   SLTU A1, A0, T0
9D034C90  14A00006   BNE A1, ZERO, 0x9D034CAC
9D034C94  2566FFFF   ADDIU A2, T3, -1
9D034C98  0087282B   SLTU A1, A0, A3
9D034C9C  10A00004   BEQ A1, ZERO, 0x9D034CB0
9D034CA0  00872823   SUBU A1, A0, A3
9D034CA4  2566FFFE   ADDIU A2, T3, -2
9D034CA8  00882021   ADDU A0, A0, T0
9D034CAC  00872823   SUBU A1, A0, A3
9D034CB0  3042FFFF   ANDI V0, V0, -1
9D034CB4  00A3001B   DIVU A1, V1
9D034CB8  006001F4   TEQ V1, ZERO
9D034CBC  00004810   MFHI T1
9D034CC0  00003812   MFLO A3
9D034CC4  00002012   MFLO A0
9D034CC8  70EA5002   MUL T2, A3, T2
9D034CCC  00094C00   SLL T1, T1, 16
9D034CD0  01221025   OR V0, T1, V0
9D034CD4  004A482B   SLTU T1, V0, T2
9D034CD8  00A3001B   DIVU A1, V1
9D034CDC  006001F4   TEQ V1, ZERO
9D034CE0  51200009   BEQL T1, ZERO, 0x9D034D08
9D034CE4  00061400   SLL V0, A2, 16
9D034CE8  00481021   ADDU V0, V0, T0
9D034CEC  0048402B   SLTU T0, V0, T0
9D034CF0  15000004   BNE T0, ZERO, 0x9D034D04
9D034CF4  24E4FFFF   ADDIU A0, A3, -1
9D034CF8  004A502B   SLTU T2, V0, T2
9D034CFC  24E7FFFE   ADDIU A3, A3, -2
9D034D00  00EA200B   MOVN A0, A3, T2
9D034D04  00061400   SLL V0, A2, 16
9D034D08  00821025   OR V0, A0, V0
9D034D0C  03E00008   JR RA
9D034D10  00001821   ADDU V1, ZERO, ZERO
9D034024  14C00006   BNE A2, ZERO, 0x9D034040
9D034028  71021020   CLZ V0, T0
9D0348E0  14C00006   BNE A2, ZERO, 0x9D0348FC
9D0348E4  71021020   CLZ V0, T0
9D034D40  14C00006   BNE A2, ZERO, 0x9D034D5C
9D034D44  71031820   CLZ V1, T0
9D03402C  24080001   ADDIU T0, ZERO, 1
9D034030  0107001B   DIVU T0, A3
9D034034  00E001F4   TEQ A3, ZERO
9D034038  00004012   MFLO T0
9D0348E8  24020001   ADDIU V0, ZERO, 1
9D0348EC  0046001B   DIVU V0, A2
9D0348F0  00C001F4   TEQ A2, ZERO
9D0348F4  00004012   MFLO T0
9D034D48  24030001   ADDIU V1, ZERO, 1
9D034D4C  0066001B   DIVU V1, A2
9D034D50  00C001F4   TEQ A2, ZERO
9D034D54  00004012   MFLO T0
9D03403C  71021020   CLZ V0, T0
9D0348F8  71021020   CLZ V0, T0
9D034D58  71031820   CLZ V1, T0
9D034040  54400033   BNEL V0, ZERO, 0x9D034110
9D034044  00484004   SLLV T0, T0, V0
9D0348FC  5440007D   BNEL V0, ZERO, 0x9D034AF4
9D034900  00484004   SLLV T0, T0, V0
9D034D5C  5460007B   BNEL V1, ZERO, 0x9D034F4C
9D034D60  00684004   SLLV T0, T0, V1
9D034048  00A82023   SUBU A0, A1, T0
9D03404C  00083C02   SRL A3, T0, 16
9D034050  310CFFFF   ANDI T4, T0, -1
9D034054  24030001   ADDIU V1, ZERO, 1
9D034904  00A82823   SUBU A1, A1, T0
9D034908  00081C02   SRL V1, T0, 16
9D03490C  3107FFFF   ANDI A3, T0, -1
9D034D64  00A82023   SUBU A0, A1, T0
9D034D68  00083C02   SRL A3, T0, 16
9D034D6C  310BFFFF   ANDI T3, T0, -1
9D034D70  24030001   ADDIU V1, ZERO, 1
9D034110  24030020   ADDIU V1, ZERO, 32
9D034114  00621823   SUBU V1, V1, V0
9D034AF4  24090020   ADDIU T1, ZERO, 32
9D034AF8  01224823   SUBU T1, T1, V0
9D034F4C  24020020   ADDIU V0, ZERO, 32
9D034F50  00431023   SUBU V0, V0, V1
9D034118  00653006   SRLV A2, A1, V1
9D034AFC  01255006   SRLV T2, A1, T1
9D034F54  00454806   SRLV T1, A1, V0
9D034134  00452804   SLLV A1, A1, V0
9D034138  00641806   SRLV V1, A0, V1
9D03413C  00652825   OR A1, V1, A1
9D034B18  00452804   SLLV A1, A1, V0
9D034B1C  01244806   SRLV T1, A0, T1
9D034B20  01252825   OR A1, T1, A1
9D034F70  00652804   SLLV A1, A1, V1
9D034F74  00441006   SRLV V0, A0, V0
9D034F78  00452825   OR A1, V0, A1
9D034144  00445004   SLLV T2, A0, V0
9D034B28  00444804   SLLV T1, A0, V0
9D034F80  00641004   SLLV V0, A0, V1
9D03411C  00083C02   SRL A3, T0, 16
9D034120  00C7001B   DIVU A2, A3
9D034124  00E001F4   TEQ A3, ZERO
9D034128  00007810   MFHI T7
9D03412C  00006812   MFLO T5
9D034130  310CFFFF   ANDI T4, T0, -1
9D034140  00057402   SRL T6, A1, 16
9D034148  00001812   MFLO V1
9D03414C  71AC5802   MUL T3, T5, T4
9D034150  000F1400   SLL V0, T7, 16
9D034154  01C21025   OR V0, T6, V0
9D034158  004B202B   SLTU A0, V0, T3
9D03415C  00C7001B   DIVU A2, A3
9D034160  00E001F4   TEQ A3, ZERO
9D034164  5080000B   BEQL A0, ZERO, 0x9D034194
9D034168  004B1023   SUBU V0, V0, T3
9D03416C  00481021   ADDU V0, V0, T0
9D034170  0048202B   SLTU A0, V0, T0
9D034174  14800006   BNE A0, ZERO, 0x9D034190
9D034178  25A3FFFF   ADDIU V1, T5, -1
9D03417C  004B202B   SLTU A0, V0, T3
9D034180  50800004   BEQL A0, ZERO, 0x9D034194
9D034184  004B1023   SUBU V0, V0, T3
9D034188  25A3FFFE   ADDIU V1, T5, -2
9D03418C  00481021   ADDU V0, V0, T0
9D034190  004B1023   SUBU V0, V0, T3
9D034194  30ADFFFF   ANDI T5, A1, -1
9D034198  0047001B   DIVU V0, A3
9D03419C  00E001F4   TEQ A3, ZERO
9D0341A0  00002010   MFHI A0
9D0341A4  00005812   MFLO T3
9D0341A8  00003012   MFLO A2
9D0341AC  716C2802   MUL A1, T3, T4
9D0341B0  00042400   SLL A0, A0, 16
9D0341B4  008D2025   OR A0, A0, T5
9D0341B8  0085682B   SLTU T5, A0, A1
9D0341BC  0047001B   DIVU V0, A3
9D0341C0  00E001F4   TEQ A3, ZERO
9D0341C4  51A0000B   BEQL T5, ZERO, 0x9D0341F4
9D0341C8  00031C00   SLL V1, V1, 16
9D0341CC  00882021   ADDU A0, A0, T0
9D0341D0  0088102B   SLTU V0, A0, T0
9D0341D4  14400006   BNE V0, ZERO, 0x9D0341F0
9D0341D8  2566FFFF   ADDIU A2, T3, -1
9D0341DC  0085102B   SLTU V0, A0, A1
9D0341E0  50400004   BEQL V0, ZERO, 0x9D0341F4
9D0341E4  00031C00   SLL V1, V1, 16
9D0341E8  2566FFFE   ADDIU A2, T3, -2
9D0341EC  00882021   ADDU A0, A0, T0
9D0341F0  00031C00   SLL V1, V1, 16
9D0341F4  00852023   SUBU A0, A0, A1
9D0341F8  0B40D016   J .LBB16
9D0341FC  00C31825   OR V1, A2, V1
9D034B00  00081C02   SRL V1, T0, 16
9D034B04  0143001B   DIVU T2, V1
9D034B08  006001F4   TEQ V1, ZERO
9D034B0C  00003010   MFHI A2
9D034B10  00005812   MFLO T3
9D034B14  3107FFFF   ANDI A3, T0, -1
9D034B24  00056402   SRL T4, A1, 16
9D034B2C  71675802   MUL T3, T3, A3
9D034B30  00063400   SLL A2, A2, 16
9D034B34  01863025   OR A2, T4, A2
9D034B38  00CB202B   SLTU A0, A2, T3
9D034B3C  0143001B   DIVU T2, V1
9D034B40  006001F4   TEQ V1, ZERO
9D034B44  50800006   BEQL A0, ZERO, 0x9D034B60
9D034B48  00CB3023   SUBU A2, A2, T3
9D034B4C  00C83021   ADDU A2, A2, T0
9D034B50  00C8202B   SLTU A0, A2, T0
9D034B54  10800024   BEQ A0, ZERO, 0x9D034BE8
9D034B58  00CB502B   SLTU T2, A2, T3
9D034B5C  00CB3023   SUBU A2, A2, T3
9D034B60  30AAFFFF   ANDI T2, A1, -1
9D034B64  00C3001B   DIVU A2, V1
9D034B68  006001F4   TEQ V1, ZERO
9D034B6C  00002010   MFHI A0
9D034B70  00002812   MFLO A1
9D034B74  70A72802   MUL A1, A1, A3
9D034B78  00042400   SLL A0, A0, 16
9D034B7C  008A2025   OR A0, A0, T2
9D034B80  0085502B   SLTU T2, A0, A1
9D034B84  00C3001B   DIVU A2, V1
9D034B88  006001F4   TEQ V1, ZERO
9D034B8C  5140FF60   BEQL T2, ZERO, .LBB17
9D034B90  00852823   SUBU A1, A0, A1
9D034B94  00882021   ADDU A0, A0, T0
9D034B98  0088302B   SLTU A2, A0, T0
9D034B9C  54C0FF5C   BNEL A2, ZERO, .LBB17
9D034BA0  00852823   SUBU A1, A0, A1
9D034BA4  0085502B   SLTU T2, A0, A1
9D034BA8  00883021   ADDU A2, A0, T0
9D034BAC  00CA200B   MOVN A0, A2, T2
9D034BB0  0B40D244   J .LBB17
9D034BB4  00852823   SUBU A1, A0, A1
9D034BE8  00C82021   ADDU A0, A2, T0
9D034BEC  0B40D2D7   J 0x9D034B5C
9D034BF0  008A300B   MOVN A2, A0, T2
9D034F58  00083C02   SRL A3, T0, 16
9D034F5C  0127001B   DIVU T1, A3
9D034F60  00E001F4   TEQ A3, ZERO
9D034F64  00003010   MFHI A2
9D034F68  00006012   MFLO T4
9D034F6C  310BFFFF   ANDI T3, T0, -1
9D034F7C  00056C02   SRL T5, A1, 16
9D034F84  00001812   MFLO V1
9D034F88  718B5002   MUL T2, T4, T3
9D034F8C  00063400   SLL A2, A2, 16
9D034F90  01A63025   OR A2, T5, A2
9D034F94  00CA202B   SLTU A0, A2, T2
9D034F98  0127001B   DIVU T1, A3
9D034F9C  00E001F4   TEQ A3, ZERO
9D034FA0  5080000B   BEQL A0, ZERO, 0x9D034FD0
9D034FA4  00CA3023   SUBU A2, A2, T2
9D034FA8  00C83021   ADDU A2, A2, T0
9D034FAC  00C8202B   SLTU A0, A2, T0
9D034FB0  14800006   BNE A0, ZERO, 0x9D034FCC
9D034FB4  2583FFFF   ADDIU V1, T4, -1
9D034FB8  00CA202B   SLTU A0, A2, T2
9D034FBC  50800004   BEQL A0, ZERO, 0x9D034FD0
9D034FC0  00CA3023   SUBU A2, A2, T2
9D034FC4  2583FFFE   ADDIU V1, T4, -2
9D034FC8  00C83021   ADDU A2, A2, T0
9D034FCC  00CA3023   SUBU A2, A2, T2
9D034FD0  30ACFFFF   ANDI T4, A1, -1
9D034FD4  00C7001B   DIVU A2, A3
9D034FD8  00E001F4   TEQ A3, ZERO
9D034FDC  00002010   MFHI A0
9D034FE0  00005012   MFLO T2
9D034FE4  00004812   MFLO T1
9D034FE8  714B2802   MUL A1, T2, T3
9D034FEC  00042400   SLL A0, A0, 16
9D034FF0  008C2025   OR A0, A0, T4
9D034FF4  0085602B   SLTU T4, A0, A1
9D034FF8  00C7001B   DIVU A2, A3
9D034FFC  00E001F4   TEQ A3, ZERO
9D035000  5180000B   BEQL T4, ZERO, 0x9D035030
9D035004  00031C00   SLL V1, V1, 16
9D035008  00882021   ADDU A0, A0, T0
9D03500C  0088302B   SLTU A2, A0, T0
9D035010  14C00006   BNE A2, ZERO, 0x9D03502C
9D035014  2549FFFF   ADDIU T1, T2, -1
9D035018  0085302B   SLTU A2, A0, A1
9D03501C  50C00004   BEQL A2, ZERO, 0x9D035030
9D035020  00031C00   SLL V1, V1, 16
9D035024  2549FFFE   ADDIU T1, T2, -2
9D035028  00882021   ADDU A0, A0, T0
9D03502C  00031C00   SLL V1, V1, 16
9D035030  00852023   SUBU A0, A0, A1
9D035034  0B40D35D   J .LBB16
9D035038  01231825   OR V1, T1, V1
9D034058  000A3402   SRL A2, T2, 16
9D03405C  0087001B   DIVU A0, A3
9D034060  00E001F4   TEQ A3, ZERO
9D034064  00007010   MFHI T6
9D034068  00006812   MFLO T5
9D03406C  00001012   MFLO V0
9D034070  71AC5802   MUL T3, T5, T4
9D034074  000E7400   SLL T6, T6, 16
9D034078  01C63025   OR A2, T6, A2
9D03407C  00CB702B   SLTU T6, A2, T3
9D034080  0087001B   DIVU A0, A3
9D034084  00E001F4   TEQ A3, ZERO
9D034088  11C00009   BEQ T6, ZERO, 0x9D0340B0
9D03408C  00CB2823   SUBU A1, A2, T3
9D034090  00C83021   ADDU A2, A2, T0
9D034094  00C8202B   SLTU A0, A2, T0
9D034098  14800004   BNE A0, ZERO, 0x9D0340AC
9D03409C  25A2FFFF   ADDIU V0, T5, -1
9D0340A0  00CB202B   SLTU A0, A2, T3
9D0340A4  548000A3   BNEL A0, ZERO, 0x9D034334
9D0340A8  25A2FFFE   ADDIU V0, T5, -2
9D0340AC  00CB2823   SUBU A1, A2, T3
9D0340B0  314AFFFF   ANDI T2, T2, -1
9D0340B4  00A7001B   DIVU A1, A3
9D0340B8  00E001F4   TEQ A3, ZERO
9D0340BC  00005810   MFHI T3
9D0340C0  00003012   MFLO A2
9D0340C4  00002012   MFLO A0
9D0340C8  70CC6002   MUL T4, A2, T4
9D0340CC  000B5C00   SLL T3, T3, 16
9D0340D0  016A5025   OR T2, T3, T2
9D0340D4  014C582B   SLTU T3, T2, T4
9D0340D8  00A7001B   DIVU A1, A3
9D0340DC  00E001F4   TEQ A3, ZERO
9D0340E0  51600009   BEQL T3, ZERO, .LBE16
9D0340E4  00021400   SLL V0, V0, 16
9D0340E8  01485021   ADDU T2, T2, T0
9D0340EC  0148402B   SLTU T0, T2, T0
9D0340F0  15000004   BNE T0, ZERO, 0x9D034104
9D0340F4  24C4FFFF   ADDIU A0, A2, -1
9D0340F8  014C502B   SLTU T2, T2, T4
9D0340FC  24C6FFFE   ADDIU A2, A2, -2
9D034100  00CA200B   MOVN A0, A2, T2
9D034104  00021400   SLL V0, V0, 16
9D034108  0B40CFE7   J .LBE15
9D03410C  00821025   OR V0, A0, V0
9D034334  0B40D02B   J 0x9D0340AC
9D034910  00092402   SRL A0, T1, 16
9D034914  00A3001B   DIVU A1, V1
9D034918  006001F4   TEQ V1, ZERO
9D03491C  00005010   MFHI T2
9D034920  00003012   MFLO A2
9D034924  70C73002   MUL A2, A2, A3
9D034928  000A5400   SLL T2, T2, 16
9D03492C  01442025   OR A0, T2, A0
9D034930  0086502B   SLTU T2, A0, A2
9D034934  00A3001B   DIVU A1, V1
9D034938  006001F4   TEQ V1, ZERO
9D03493C  51400009   BEQL T2, ZERO, 0x9D034964
9D034940  00862023   SUBU A0, A0, A2
9D034944  00882021   ADDU A0, A0, T0
9D034948  0088282B   SLTU A1, A0, T0
9D03494C  54A00005   BNEL A1, ZERO, 0x9D034964
9D034950  00862023   SUBU A0, A0, A2
9D034954  0086502B   SLTU T2, A0, A2
9D034958  00882821   ADDU A1, A0, T0
9D03495C  00AA200B   MOVN A0, A1, T2
9D034960  00862023   SUBU A0, A0, A2
9D034964  3126FFFF   ANDI A2, T1, -1
9D034968  0083001B   DIVU A0, V1
9D03496C  006001F4   TEQ V1, ZERO
9D034970  00004810   MFHI T1
9D034974  00002812   MFLO A1
9D034978  70A72802   MUL A1, A1, A3
9D03497C  00094C00   SLL T1, T1, 16
9D034980  01264825   OR T1, T1, A2
9D034984  0125302B   SLTU A2, T1, A1
9D034988  0083001B   DIVU A0, V1
9D03498C  006001F4   TEQ V1, ZERO
9D034990  50C00009   BEQL A2, ZERO, .LBE17
9D034994  01254823   SUBU T1, T1, A1
9D034998  01284821   ADDU T1, T1, T0
9D03499C  0128182B   SLTU V1, T1, T0
9D0349A0  54600005   BNEL V1, ZERO, .LBE17
9D0349A4  01254823   SUBU T1, T1, A1
9D0349A8  0125182B   SLTU V1, T1, A1
9D0349AC  01284021   ADDU T0, T1, T0
9D0349B0  0103480B   MOVN T1, T0, V1
9D0349B4  01254823   SUBU T1, T1, A1
9D034D74  00023402   SRL A2, V0, 16
9D034D78  0087001B   DIVU A0, A3
9D034D7C  00E001F4   TEQ A3, ZERO
9D034D80  00006810   MFHI T5
9D034D84  00006012   MFLO T4
9D034D88  00004812   MFLO T1
9D034D8C  718B5002   MUL T2, T4, T3
9D034D90  000D6C00   SLL T5, T5, 16
9D034D94  01A63025   OR A2, T5, A2
9D034D98  00CA682B   SLTU T5, A2, T2
9D034D9C  0087001B   DIVU A0, A3
9D034DA0  00E001F4   TEQ A3, ZERO
9D034DA4  11A00009   BEQ T5, ZERO, 0x9D034DCC
9D034DA8  00CA2823   SUBU A1, A2, T2
9D034DAC  00C83021   ADDU A2, A2, T0
9D034DB0  00C8202B   SLTU A0, A2, T0
9D034DB4  14800004   BNE A0, ZERO, 0x9D034DC8
9D034DB8  2589FFFF   ADDIU T1, T4, -1
9D034DBC  00CA202B   SLTU A0, A2, T2
9D034DC0  548000A6   BNEL A0, ZERO, 0x9D03505C
9D034DC4  2589FFFE   ADDIU T1, T4, -2
9D034DC8  00CA2823   SUBU A1, A2, T2
9D034DCC  3042FFFF   ANDI V0, V0, -1
9D034DD0  00A7001B   DIVU A1, A3
9D034DD4  00E001F4   TEQ A3, ZERO
9D034DD8  00005010   MFHI T2
9D034DDC  00003012   MFLO A2
9D034DE0  00002012   MFLO A0
9D034DE4  70CB5802   MUL T3, A2, T3
9D034DE8  000A5400   SLL T2, T2, 16
9D034DEC  01421025   OR V0, T2, V0
9D034DF0  004B502B   SLTU T2, V0, T3
9D034DF4  00A7001B   DIVU A1, A3
9D034DF8  00E001F4   TEQ A3, ZERO
9D034DFC  51400009   BEQL T2, ZERO, .LBE16
9D034E00  00091400   SLL V0, T1, 16
9D034E04  00481021   ADDU V0, V0, T0
9D034E08  0048402B   SLTU T0, V0, T0
9D034E0C  15000004   BNE T0, ZERO, 0x9D034E20
9D034E10  24C4FFFF   ADDIU A0, A2, -1
9D034E14  004B582B   SLTU T3, V0, T3
9D034E18  24C6FFFE   ADDIU A2, A2, -2
9D034E1C  00CB200B   MOVN A0, A2, T3
9D034E20  00091400   SLL V0, T1, 16
9D034E24  03E00008   JR RA
9D034E28  00821025   OR V0, A0, V0
9D03505C  0B40D372   J 0x9D034DC8
9D034894  00491006   SRLV V0, T1, V0
9D0349B8  00491006   SRLV V0, T1, V0
9D034898  03E00008   JR RA
9D03489C  00001821   ADDU V1, ZERO, ZERO
9D0349BC  03E00008   JR RA
9D0349C0  00001821   ADDU V1, ZERO, ZERO
9D033FBC  00A7102B   SLTU V0, A1, A3
9D033FC0  10400010   BEQ V0, ZERO, 0x9D034004
9D033FC4  70E84020   CLZ T0, A3
9D033FC8  00001821   ADDU V1, ZERO, ZERO
9D033FCC  0B40CFE7   J .LBE15
9D033FD0  00001021   ADDU V0, ZERO, ZERO
9D0348A0  00A7102B   SLTU V0, A1, A3
9D0348A4  14400047   BNE V0, ZERO, 0x9D0349C4
9D0348A8  70EA5020   CLZ T2, A3
9D034D14  00A7102B   SLTU V0, A1, A3
9D034D18  14400044   BNE V0, ZERO, 0x9D034E2C
9D034D1C  70E84020   CLZ T0, A3
9D034E2C  00001821   ADDU V1, ZERO, ZERO
9D034E30  03E00008   JR RA
9D034E34  00001021   ADDU V0, ZERO, ZERO
9D0349C4  00801021   ADDU V0, A0, ZERO
9D0349C8  03E00008   JR RA
9D0349CC  00A01821   ADDU V1, A1, ZERO
9D034004  1500007E   BNE T0, ZERO, 0x9D034200
9D034008  24020020   ADDIU V0, ZERO, 32
9D0348AC  15400048   BNE T2, ZERO, 0x9D0349D0
9D0348B0  240B0020   ADDIU T3, ZERO, 32
9D034D20  55000045   BNEL T0, ZERO, 0x9D034E38
9D034D24  24020020   ADDIU V0, ZERO, 32
9D03400C  00E5282B   SLTU A1, A3, A1
9D034010  14A000C6   BNE A1, ZERO, 0x9D03432C
9D034014  00001821   ADDU V1, ZERO, ZERO
9D034018  0086102B   SLTU V0, A0, A2
9D03401C  0B40CFE7   J .LBE15
9D034020  38420001   XORI V0, V0, 1
9D03432C  0B40CFE7   J .LBE15
9D034330  24020001   ADDIU V0, ZERO, 1
9D0348B4  00E5102B   SLTU V0, A3, A1
9D0348B8  14400005   BNE V0, ZERO, 0x9D0348D0
9D0348BC  00861023   SUBU V0, A0, A2
9D0348C0  0086402B   SLTU T0, A0, A2
9D0348C4  15000089   BNE T0, ZERO, 0x9D034AEC
9D0348C8  00801021   ADDU V0, A0, ZERO
9D034D28  00E5282B   SLTU A1, A3, A1
9D034D2C  14A000C8   BNE A1, ZERO, 0x9D035050
9D034D30  0086302B   SLTU A2, A0, A2
9D034D34  38C20001   XORI V0, A2, 1
9D034D38  03E00008   JR RA
9D034D3C  00001821   ADDU V1, ZERO, ZERO
9D035050  00001821   ADDU V1, ZERO, ZERO
9D0348CC  00861023   SUBU V0, A0, A2
9D0348D0  00A72823   SUBU A1, A1, A3
9D0348D4  0082202B   SLTU A0, A0, V0
9D0348D8  03E00008   JR RA
9D0348DC  00A41823   SUBU V1, A1, A0
9D034200  00481023   SUBU V0, V0, T0
9D0349D0  016A5823   SUBU T3, T3, T2
9D034E38  00481023   SUBU V0, V0, T0
9D034204  01073804   SLLV A3, A3, T0
9D034208  00461806   SRLV V1, A2, V0
9D03420C  00673825   OR A3, V1, A3
9D0349D4  01473804   SLLV A3, A3, T2
9D0349D8  01661006   SRLV V0, A2, T3
9D0349DC  00473825   OR A3, V0, A3
9D034E3C  01073804   SLLV A3, A3, T0
9D034E40  00461806   SRLV V1, A2, V0
9D034E44  00673825   OR A3, V1, A3
9D034A0C  01463004   SLLV A2, A2, T2
9D034210  00455806   SRLV T3, A1, V0
9D0349E0  01656806   SRLV T5, A1, T3
9D034E48  00455006   SRLV T2, A1, V0
9D03422C  01052804   SLLV A1, A1, T0
9D034230  00441006   SRLV V0, A0, V0
9D034234  00452825   OR A1, V0, A1
9D0349FC  01452804   SLLV A1, A1, T2
9D034A00  01641006   SRLV V0, A0, T3
9D034A04  00451025   OR V0, V0, A1
9D034E64  01052804   SLLV A1, A1, T0
9D034E68  00441006   SRLV V0, A0, V0
9D034E6C  00452825   OR A1, V0, A1
9D034214  00071C02   SRL V1, A3, 16
9D034218  0163001B   DIVU T3, V1
9D03421C  006001F4   TEQ V1, ZERO
9D034220  00005010   MFHI T2
9D034224  00007012   MFLO T6
9D034228  30ECFFFF   ANDI T4, A3, -1
9D034238  00057C02   SRL T7, A1, 16
9D03423C  00001012   MFLO V0
9D034240  71CC6802   MUL T5, T6, T4
9D034244  000A5400   SLL T2, T2, 16
9D034248  014F5025   OR T2, T2, T7
9D03424C  014D782B   SLTU T7, T2, T5
9D034250  0163001B   DIVU T3, V1
9D034254  006001F4   TEQ V1, ZERO
9D034258  11E0000A   BEQ T7, ZERO, 0x9D034284
9D03425C  01063004   SLLV A2, A2, T0
9D034260  01475021   ADDU T2, T2, A3
9D034264  0147582B   SLTU T3, T2, A3
9D034268  15600006   BNE T3, ZERO, 0x9D034284
9D03426C  25C2FFFF   ADDIU V0, T6, -1
9D034270  014D582B   SLTU T3, T2, T5
9D034274  51600004   BEQL T3, ZERO, 0x9D034288
9D034278  014D5023   SUBU T2, T2, T5
9D03427C  25C2FFFE   ADDIU V0, T6, -2
9D034280  01475021   ADDU T2, T2, A3
9D034284  014D5023   SUBU T2, T2, T5
9D034288  30A5FFFF   ANDI A1, A1, -1
9D03428C  0143001B   DIVU T2, V1
9D034290  006001F4   TEQ V1, ZERO
9D034294  00007010   MFHI T6
9D034298  00006812   MFLO T5
9D03429C  00005812   MFLO T3
9D0342A0  71AC6002   MUL T4, T5, T4
9D0342A4  000E7400   SLL T6, T6, 16
9D0342A8  01C52825   OR A1, T6, A1
9D0342AC  00AC702B   SLTU T6, A1, T4
9D0342B0  0143001B   DIVU T2, V1
9D0342B4  006001F4   TEQ V1, ZERO
9D0342B8  51C0000B   BEQL T6, ZERO, 0x9D0342E8
9D0342BC  00021400   SLL V0, V0, 16
9D0342C0  00A72821   ADDU A1, A1, A3
9D0342C4  00A7182B   SLTU V1, A1, A3
9D0342C8  14600006   BNE V1, ZERO, 0x9D0342E4
9D0342CC  25ABFFFF   ADDIU T3, T5, -1
9D0342D0  00AC182B   SLTU V1, A1, T4
9D0342D4  50600004   BEQL V1, ZERO, 0x9D0342E8
9D0342D8  00021400   SLL V0, V0, 16
9D0342DC  25ABFFFE   ADDIU T3, T5, -2
9D0342E0  00A72821   ADDU A1, A1, A3
9D0342E4  00021400   SLL V0, V0, 16
9D0342E8  01621025   OR V0, T3, V0
9D0342EC  00AC2823   SUBU A1, A1, T4
9D0349E4  00074C02   SRL T1, A3, 16
9D0349E8  01A9001B   DIVU T5, T1
9D0349EC  012001F4   TEQ T1, ZERO
9D0349F0  00006010   MFHI T4
9D0349F4  00001812   MFLO V1
9D0349F8  30EEFFFF   ANDI T6, A3, -1
9D034A08  00022C02   SRL A1, V0, 16
9D034A10  00004012   MFLO T0
9D034A14  706E7802   MUL T7, V1, T6
9D034A18  000C6400   SLL T4, T4, 16
9D034A1C  01856025   OR T4, T4, A1
9D034A20  018F282B   SLTU A1, T4, T7
9D034A24  01A9001B   DIVU T5, T1
9D034A28  012001F4   TEQ T1, ZERO
9D034A2C  10A0000A   BEQ A1, ZERO, 0x9D034A58
9D034A30  01442004   SLLV A0, A0, T2
9D034A34  01876021   ADDU T4, T4, A3
9D034A38  0187282B   SLTU A1, T4, A3
9D034A3C  14A00006   BNE A1, ZERO, 0x9D034A58
9D034A40  2468FFFF   ADDIU T0, V1, -1
9D034A44  018F282B   SLTU A1, T4, T7
9D034A48  50A00004   BEQL A1, ZERO, 0x9D034A5C
9D034A4C  018F6023   SUBU T4, T4, T7
9D034A50  2468FFFE   ADDIU T0, V1, -2
9D034A54  01876021   ADDU T4, T4, A3
9D034A58  018F6023   SUBU T4, T4, T7
9D034A5C  3042FFFF   ANDI V0, V0, -1
9D034A60  0189001B   DIVU T4, T1
9D034A64  012001F4   TEQ T1, ZERO
9D034A68  00002810   MFHI A1
9D034A6C  00001812   MFLO V1
9D034A70  00006812   MFLO T5
9D034A74  706E7002   MUL T6, V1, T6
9D034A78  00052C00   SLL A1, A1, 16
9D034A7C  00A21025   OR V0, A1, V0
9D034A80  004E282B   SLTU A1, V0, T6
9D034A84  0189001B   DIVU T4, T1
9D034A88  012001F4   TEQ T1, ZERO
9D034A8C  50A00006   BEQL A1, ZERO, 0x9D034AA8
9D034A90  00084400   SLL T0, T0, 16
9D034A94  00471021   ADDU V0, V0, A3
9D034A98  0047282B   SLTU A1, V0, A3
9D034A9C  10A0004C   BEQ A1, ZERO, .LBE25
9D034AA0  246DFFFF   ADDIU T5, V1, -1
9D034AA4  00084400   SLL T0, T0, 16
9D034AA8  01A84025   OR T0, T5, T0
9D034AAC  004E1023   SUBU V0, V0, T6
9D034BD0  004E282B   SLTU A1, V0, T6
9D034BD4  50A0FFB4   BEQL A1, ZERO, 0x9D034AA8
9D034BD8  00084400   SLL T0, T0, 16
9D034BDC  246DFFFE   ADDIU T5, V1, -2
9D034BE0  0B40D2A9   J 0x9D034AA4
9D034BE4  00471021   ADDU V0, V0, A3
9D034E4C  00071C02   SRL V1, A3, 16
9D034E50  0143001B   DIVU T2, V1
9D034E54  006001F4   TEQ V1, ZERO
9D034E58  00004810   MFHI T1
9D034E5C  00006812   MFLO T5
9D034E60  30EBFFFF   ANDI T3, A3, -1
9D034E70  00057402   SRL T6, A1, 16
9D034E74  00001012   MFLO V0
9D034E78  71AB6002   MUL T4, T5, T3
9D034E7C  00094C00   SLL T1, T1, 16
9D034E80  012E4825   OR T1, T1, T6
9D034E84  012C702B   SLTU T6, T1, T4
9D034E88  0143001B   DIVU T2, V1
9D034E8C  006001F4   TEQ V1, ZERO
9D034E90  11C0000A   BEQ T6, ZERO, 0x9D034EBC
9D034E94  01063004   SLLV A2, A2, T0
9D034E98  01274821   ADDU T1, T1, A3
9D034E9C  0127502B   SLTU T2, T1, A3
9D034EA0  15400006   BNE T2, ZERO, 0x9D034EBC
9D034EA4  25A2FFFF   ADDIU V0, T5, -1
9D034EA8  012C502B   SLTU T2, T1, T4
9D034EAC  51400004   BEQL T2, ZERO, 0x9D034EC0
9D034EB0  012C4823   SUBU T1, T1, T4
9D034EB4  25A2FFFE   ADDIU V0, T5, -2
9D034EB8  01274821   ADDU T1, T1, A3
9D034EBC  012C4823   SUBU T1, T1, T4
9D034EC0  30A5FFFF   ANDI A1, A1, -1
9D034EC4  0123001B   DIVU T1, V1
9D034EC8  006001F4   TEQ V1, ZERO
9D034ECC  00006810   MFHI T5
9D034ED0  00006012   MFLO T4
9D034ED4  00005012   MFLO T2
9D034ED8  718B5802   MUL T3, T4, T3
9D034EDC  000D6C00   SLL T5, T5, 16
9D034EE0  01A52825   OR A1, T5, A1
9D034EE4  00AB682B   SLTU T5, A1, T3
9D034EE8  0123001B   DIVU T1, V1
9D034EEC  006001F4   TEQ V1, ZERO
9D034EF0  51A0000B   BEQL T5, ZERO, 0x9D034F20
9D034EF4  00021400   SLL V0, V0, 16
9D034EF8  00A72821   ADDU A1, A1, A3
9D034EFC  00A7182B   SLTU V1, A1, A3
9D034F00  14600006   BNE V1, ZERO, 0x9D034F1C
9D034F04  258AFFFF   ADDIU T2, T4, -1
9D034F08  00AB182B   SLTU V1, A1, T3
9D034F0C  50600004   BEQL V1, ZERO, 0x9D034F20
9D034F10  00021400   SLL V0, V0, 16
9D034F14  258AFFFE   ADDIU T2, T4, -2
9D034F18  00A72821   ADDU A1, A1, A3
9D034F1C  00021400   SLL V0, V0, 16
9D034F20  01421025   OR V0, T2, V0
9D034F24  00AB2823   SUBU A1, A1, T3
9D0342F0  00460019   MULTU 0, V0, A2
9D0342F4  00003810   MFHI A3
9D034AB0  01060019   MULTU 0, T0, A2
9D034AB4  00004810   MFHI T1
9D034ACC  00003012   MFLO A2
9D034F28  00460019   MULTU 0, V0, A2
9D034F2C  00003810   MFHI A3
9D0342F8  00A7182B   SLTU V1, A1, A3
9D0342FC  14600008   BNE V1, ZERO, 0x9D034320
9D034300  00003012   MFLO A2
9D034304  50A70003   BEQL A1, A3, 0x9D034314
9D034308  01042004   SLLV A0, A0, T0
9D034314  0086302B   SLTU A2, A0, A2
9D034318  50C0FF20   BEQL A2, ZERO, .LBE15
9D03431C  00001821   ADDU V1, ZERO, ZERO
9D034AB8  0049182B   SLTU V1, V0, T1
9D034ABC  1460003E   BNE V1, ZERO, .LBB25
9D034AC0  00004012   MFLO T0
9D034AC4  1049004B   BEQ V0, T1, 0x9D034BF4
9D034AC8  00491823   SUBU V1, V0, T1
9D034BF4  0088182B   SLTU V1, A0, T0
9D034F30  00A7182B   SLTU V1, A1, A3
9D034F34  14600044   BNE V1, ZERO, 0x9D035048
9D034F38  00003012   MFLO A2
9D034F3C  10A7003F   BEQ A1, A3, 0x9D03503C
9D034F40  01042004   SLLV A0, A0, T0
9D03503C  0086302B   SLTU A2, A0, A2
9D035040  10C0FFC0   BEQ A2, ZERO, 0x9D034F44
9D035044  00000000   NOP
9D03430C  0B40CFE7   J .LBE15
9D034310  00001821   ADDU V1, ZERO, ZERO
9D034320  2442FFFF   ADDIU V0, V0, -1
9D034324  0B40CFE7   J .LBE15
9D034328  00001821   ADDU V1, ZERO, ZERO
9D034F44  03E00008   JR RA
9D034F48  00001821   ADDU V1, ZERO, ZERO
9D035048  0B40D3D1   J 0x9D034F44
9D03504C  2442FFFF   ADDIU V0, V0, -1
9D034BB8  01063023   SUBU A2, T0, A2
9D034BBC  01271823   SUBU V1, T1, A3
9D034BC0  0106402B   SLTU T0, T0, A2
9D034BC4  00681823   SUBU V1, V1, T0
9D034BC8  0B40D2B4   J .LBB24
9D034BCC  00431823   SUBU V1, V0, V1
9D034AD0  00863023   SUBU A2, A0, A2
9D034AD4  0086202B   SLTU A0, A0, A2
9D034AD8  00641823   SUBU V1, V1, A0
9D034ADC  01631004   SLLV V0, V1, T3
9D034AE0  01463006   SRLV A2, A2, T2
9D034AE4  00461025   OR V0, V0, A2
9D034AE8  01431806   SRLV V1, V1, T2
9D033E88  04A00052   BLTZ A1, 0x9D033FD4
9D033E8C  00004821   ADDU T1, ZERO, ZERO
9D033FD4  00042023   SUBU A0, ZERO, A0
9D033FD8  0004102B   SLTU V0, ZERO, A0
9D033FDC  00052823   SUBU A1, ZERO, A1
9D033FE0  00A22823   SUBU A1, A1, V0
9D033E90  04E20057   BLTZL A3, 0x9D033FF0
9D033E94  00063023   SUBU A2, ZERO, A2
9D033FE4  04E1FFAC   BGEZ A3, .LBB13
9D033FE8  2409FFFF   ADDIU T1, ZERO, -1
9D033FF8  00094827   NOR T1, ZERO, T1
9D033FEC  00063023   SUBU A2, ZERO, A2
9D033FF0  0006102B   SLTU V0, ZERO, A2
9D033FF4  00073823   SUBU A3, ZERO, A3
9D033FFC  0B40CFA6   J .LBB13
9D034000  00E23823   SUBU A3, A3, V0
9D033F9C  11200005   BEQ T1, ZERO, 0x9D033FB4
9D033FA0  00000000   NOP
9D033FA4  00021023   SUBU V0, ZERO, V0
9D033FA8  0002202B   SLTU A0, ZERO, V0
9D033FAC  00031823   SUBU V1, ZERO, V1
9D033FB0  00641823   SUBU V1, V1, A0
9D033FB4  03E00008   JR RA
9D033FB8  00000000   NOP
9D033FBC  00A7102B   SLTU V0, A1, A3
9D033FC0  10400010   BEQ V0, ZERO, 0x9D034004
9D033FC4  70E84020   CLZ T0, A3
9D033FC8  00001821   ADDU V1, ZERO, ZERO
9D033FCC  0B40CFE7   J .LBE15
9D033FD0  00001021   ADDU V0, ZERO, ZERO
9D033FD4  00042023   SUBU A0, ZERO, A0
9D033FD8  0004102B   SLTU V0, ZERO, A0
9D033FDC  00052823   SUBU A1, ZERO, A1
9D033FE0  00A22823   SUBU A1, A1, V0
9D033FE4  04E1FFAC   BGEZ A3, .LBB13
9D033FE8  2409FFFF   ADDIU T1, ZERO, -1
9D033FEC  00063023   SUBU A2, ZERO, A2
9D033FF0  0006102B   SLTU V0, ZERO, A2
9D033FF4  00073823   SUBU A3, ZERO, A3
9D033FF8  00094827   NOR T1, ZERO, T1
9D033FFC  0B40CFA6   J .LBB13
9D034000  00E23823   SUBU A3, A3, V0
9D034004  1500007E   BNE T0, ZERO, 0x9D034200
9D034008  24020020   ADDIU V0, ZERO, 32
9D03400C  00E5282B   SLTU A1, A3, A1
9D034010  14A000C6   BNE A1, ZERO, 0x9D03432C
9D034014  00001821   ADDU V1, ZERO, ZERO
9D034018  0086102B   SLTU V0, A0, A2
9D03401C  0B40CFE7   J .LBE15
9D034020  38420001   XORI V0, V0, 1
9D034024  14C00006   BNE A2, ZERO, 0x9D034040
9D034028  71021020   CLZ V0, T0
9D03402C  24080001   ADDIU T0, ZERO, 1
9D034030  0107001B   DIVU T0, A3
9D034034  00E001F4   TEQ A3, ZERO
9D034038  00004012   MFLO T0
9D03403C  71021020   CLZ V0, T0
9D034040  54400033   BNEL V0, ZERO, 0x9D034110
9D034044  00484004   SLLV T0, T0, V0
9D034048  00A82023   SUBU A0, A1, T0
9D03404C  00083C02   SRL A3, T0, 16
9D034050  310CFFFF   ANDI T4, T0, -1
9D034054  24030001   ADDIU V1, ZERO, 1
9D034058  000A3402   SRL A2, T2, 16
9D03405C  0087001B   DIVU A0, A3
9D034060  00E001F4   TEQ A3, ZERO
9D034064  00007010   MFHI T6
9D034068  00006812   MFLO T5
9D03406C  00001012   MFLO V0
9D034070  71AC5802   MUL T3, T5, T4
9D034074  000E7400   SLL T6, T6, 16
9D034078  01C63025   OR A2, T6, A2
9D03407C  00CB702B   SLTU T6, A2, T3
9D034080  0087001B   DIVU A0, A3
9D034084  00E001F4   TEQ A3, ZERO
9D034088  11C00009   BEQ T6, ZERO, 0x9D0340B0
9D03408C  00CB2823   SUBU A1, A2, T3
9D034090  00C83021   ADDU A2, A2, T0
9D034094  00C8202B   SLTU A0, A2, T0
9D034098  14800004   BNE A0, ZERO, 0x9D0340AC
9D03409C  25A2FFFF   ADDIU V0, T5, -1
9D0340A0  00CB202B   SLTU A0, A2, T3
9D0340A4  548000A3   BNEL A0, ZERO, 0x9D034334
9D0340A8  25A2FFFE   ADDIU V0, T5, -2
9D0340AC  00CB2823   SUBU A1, A2, T3
9D0340B0  314AFFFF   ANDI T2, T2, -1
9D0340B4  00A7001B   DIVU A1, A3
9D0340B8  00E001F4   TEQ A3, ZERO
9D0340BC  00005810   MFHI T3
9D0340C0  00003012   MFLO A2
9D0340C4  00002012   MFLO A0
9D0340C8  70CC6002   MUL T4, A2, T4
9D0340CC  000B5C00   SLL T3, T3, 16
9D0340D0  016A5025   OR T2, T3, T2
9D0340D4  014C582B   SLTU T3, T2, T4
9D0340D8  00A7001B   DIVU A1, A3
9D0340DC  00E001F4   TEQ A3, ZERO
9D0340E0  51600009   BEQL T3, ZERO, .LBE16
9D0340E4  00021400   SLL V0, V0, 16
9D0340E8  01485021   ADDU T2, T2, T0
9D0340EC  0148402B   SLTU T0, T2, T0
9D0340F0  15000004   BNE T0, ZERO, 0x9D034104
9D0340F4  24C4FFFF   ADDIU A0, A2, -1
9D0340F8  014C502B   SLTU T2, T2, T4
9D0340FC  24C6FFFE   ADDIU A2, A2, -2
9D034100  00CA200B   MOVN A0, A2, T2
9D034104  00021400   SLL V0, V0, 16
9D034108  0B40CFE7   J .LBE15
9D03410C  00821025   OR V0, A0, V0
9D034110  24030020   ADDIU V1, ZERO, 32
9D034114  00621823   SUBU V1, V1, V0
9D034118  00653006   SRLV A2, A1, V1
9D03411C  00083C02   SRL A3, T0, 16
9D034120  00C7001B   DIVU A2, A3
9D034124  00E001F4   TEQ A3, ZERO
9D034128  00007810   MFHI T7
9D03412C  00006812   MFLO T5
9D034130  310CFFFF   ANDI T4, T0, -1
9D034134  00452804   SLLV A1, A1, V0
9D034138  00641806   SRLV V1, A0, V1
9D03413C  00652825   OR A1, V1, A1
9D034140  00057402   SRL T6, A1, 16
9D034144  00445004   SLLV T2, A0, V0
9D034148  00001812   MFLO V1
9D03414C  71AC5802   MUL T3, T5, T4
9D034150  000F1400   SLL V0, T7, 16
9D034154  01C21025   OR V0, T6, V0
9D034158  004B202B   SLTU A0, V0, T3
9D03415C  00C7001B   DIVU A2, A3
9D034160  00E001F4   TEQ A3, ZERO
9D034164  5080000B   BEQL A0, ZERO, 0x9D034194
9D034168  004B1023   SUBU V0, V0, T3
9D03416C  00481021   ADDU V0, V0, T0
9D034170  0048202B   SLTU A0, V0, T0
9D034174  14800006   BNE A0, ZERO, 0x9D034190
9D034178  25A3FFFF   ADDIU V1, T5, -1
9D03417C  004B202B   SLTU A0, V0, T3
9D034180  50800004   BEQL A0, ZERO, 0x9D034194
9D034184  004B1023   SUBU V0, V0, T3
9D034188  25A3FFFE   ADDIU V1, T5, -2
9D03418C  00481021   ADDU V0, V0, T0
9D034190  004B1023   SUBU V0, V0, T3
9D034194  30ADFFFF   ANDI T5, A1, -1
9D034198  0047001B   DIVU V0, A3
9D03419C  00E001F4   TEQ A3, ZERO
9D0341A0  00002010   MFHI A0
9D0341A4  00005812   MFLO T3
9D0341A8  00003012   MFLO A2
9D0341AC  716C2802   MUL A1, T3, T4
9D0341B0  00042400   SLL A0, A0, 16
9D0341B4  008D2025   OR A0, A0, T5
9D0341B8  0085682B   SLTU T5, A0, A1
9D0341BC  0047001B   DIVU V0, A3
9D0341C0  00E001F4   TEQ A3, ZERO
9D0341C4  51A0000B   BEQL T5, ZERO, 0x9D0341F4
9D0341C8  00031C00   SLL V1, V1, 16
9D0341CC  00882021   ADDU A0, A0, T0
9D0341D0  0088102B   SLTU V0, A0, T0
9D0341D4  14400006   BNE V0, ZERO, 0x9D0341F0
9D0341D8  2566FFFF   ADDIU A2, T3, -1
9D0341DC  0085102B   SLTU V0, A0, A1
9D0341E0  50400004   BEQL V0, ZERO, 0x9D0341F4
9D0341E4  00031C00   SLL V1, V1, 16
9D0341E8  2566FFFE   ADDIU A2, T3, -2
9D0341EC  00882021   ADDU A0, A0, T0
9D0341F0  00031C00   SLL V1, V1, 16
9D0341F4  00852023   SUBU A0, A0, A1
9D0341F8  0B40D016   J .LBB16
9D0341FC  00C31825   OR V1, A2, V1
9D034200  00481023   SUBU V0, V0, T0
9D034204  01073804   SLLV A3, A3, T0
9D034208  00461806   SRLV V1, A2, V0
9D03420C  00673825   OR A3, V1, A3
9D034210  00455806   SRLV T3, A1, V0
9D034214  00071C02   SRL V1, A3, 16
9D034218  0163001B   DIVU T3, V1
9D03421C  006001F4   TEQ V1, ZERO
9D034220  00005010   MFHI T2
9D034224  00007012   MFLO T6
9D034228  30ECFFFF   ANDI T4, A3, -1
9D03422C  01052804   SLLV A1, A1, T0
9D034230  00441006   SRLV V0, A0, V0
9D034234  00452825   OR A1, V0, A1
9D034238  00057C02   SRL T7, A1, 16
9D03423C  00001012   MFLO V0
9D034240  71CC6802   MUL T5, T6, T4
9D034244  000A5400   SLL T2, T2, 16
9D034248  014F5025   OR T2, T2, T7
9D03424C  014D782B   SLTU T7, T2, T5
9D034250  0163001B   DIVU T3, V1
9D034254  006001F4   TEQ V1, ZERO
9D034258  11E0000A   BEQ T7, ZERO, 0x9D034284
9D03425C  01063004   SLLV A2, A2, T0
9D034260  01475021   ADDU T2, T2, A3
9D034264  0147582B   SLTU T3, T2, A3
9D034268  15600006   BNE T3, ZERO, 0x9D034284
9D03426C  25C2FFFF   ADDIU V0, T6, -1
9D034270  014D582B   SLTU T3, T2, T5
9D034274  51600004   BEQL T3, ZERO, 0x9D034288
9D034278  014D5023   SUBU T2, T2, T5
9D03427C  25C2FFFE   ADDIU V0, T6, -2
9D034280  01475021   ADDU T2, T2, A3
9D034284  014D5023   SUBU T2, T2, T5
9D034288  30A5FFFF   ANDI A1, A1, -1
9D03428C  0143001B   DIVU T2, V1
9D034290  006001F4   TEQ V1, ZERO
9D034294  00007010   MFHI T6
9D034298  00006812   MFLO T5
9D03429C  00005812   MFLO T3
9D0342A0  71AC6002   MUL T4, T5, T4
9D0342A4  000E7400   SLL T6, T6, 16
9D0342A8  01C52825   OR A1, T6, A1
9D0342AC  00AC702B   SLTU T6, A1, T4
9D0342B0  0143001B   DIVU T2, V1
9D0342B4  006001F4   TEQ V1, ZERO
9D0342B8  51C0000B   BEQL T6, ZERO, 0x9D0342E8
9D0342BC  00021400   SLL V0, V0, 16
9D0342C0  00A72821   ADDU A1, A1, A3
9D0342C4  00A7182B   SLTU V1, A1, A3
9D0342C8  14600006   BNE V1, ZERO, 0x9D0342E4
9D0342CC  25ABFFFF   ADDIU T3, T5, -1
9D0342D0  00AC182B   SLTU V1, A1, T4
9D0342D4  50600004   BEQL V1, ZERO, 0x9D0342E8
9D0342D8  00021400   SLL V0, V0, 16
9D0342DC  25ABFFFE   ADDIU T3, T5, -2
9D0342E0  00A72821   ADDU A1, A1, A3
9D0342E4  00021400   SLL V0, V0, 16
9D0342E8  01621025   OR V0, T3, V0
9D0342EC  00AC2823   SUBU A1, A1, T4
9D0342F0  00460019   MULTU 0, V0, A2
9D0342F4  00003810   MFHI A3
9D0342F8  00A7182B   SLTU V1, A1, A3
9D0342FC  14600008   BNE V1, ZERO, 0x9D034320
9D034300  00003012   MFLO A2
9D034304  50A70003   BEQL A1, A3, 0x9D034314
9D034308  01042004   SLLV A0, A0, T0
9D03430C  0B40CFE7   J .LBE15
9D034310  00001821   ADDU V1, ZERO, ZERO
9D034314  0086302B   SLTU A2, A0, A2
9D034318  50C0FF20   BEQL A2, ZERO, .LBE15
9D03431C  00001821   ADDU V1, ZERO, ZERO
9D034320  2442FFFF   ADDIU V0, V0, -1
9D034324  0B40CFE7   J .LBE15
9D034328  00001821   ADDU V1, ZERO, ZERO
9D03432C  0B40CFE7   J .LBE15
9D034330  24020001   ADDIU V0, ZERO, 1
9D034334  0B40D02B   J 0x9D0340AC
9D034338  00C83021   ADDU A2, A2, T0
9D034AEC  03E00008   JR RA
9D034AF0  00000000   NOP
9D034AF4  24090020   ADDIU T1, ZERO, 32
9D034AF8  01224823   SUBU T1, T1, V0
9D034AFC  01255006   SRLV T2, A1, T1
9D034B00  00081C02   SRL V1, T0, 16
9D034B04  0143001B   DIVU T2, V1
9D034B08  006001F4   TEQ V1, ZERO
9D034B0C  00003010   MFHI A2
9D034B10  00005812   MFLO T3
9D034B14  3107FFFF   ANDI A3, T0, -1
9D034B18  00452804   SLLV A1, A1, V0
9D034B1C  01244806   SRLV T1, A0, T1
9D034B20  01252825   OR A1, T1, A1
9D034B24  00056402   SRL T4, A1, 16
9D034B28  00444804   SLLV T1, A0, V0
9D034B2C  71675802   MUL T3, T3, A3
9D034B30  00063400   SLL A2, A2, 16
9D034B34  01863025   OR A2, T4, A2
9D034B38  00CB202B   SLTU A0, A2, T3
9D034B3C  0143001B   DIVU T2, V1
9D034B40  006001F4   TEQ V1, ZERO
9D034B44  50800006   BEQL A0, ZERO, 0x9D034B60
9D034B48  00CB3023   SUBU A2, A2, T3
9D034B4C  00C83021   ADDU A2, A2, T0
9D034B50  00C8202B   SLTU A0, A2, T0
9D034B54  10800024   BEQ A0, ZERO, 0x9D034BE8
9D034B58  00CB502B   SLTU T2, A2, T3
9D034B5C  00CB3023   SUBU A2, A2, T3
9D034B60  30AAFFFF   ANDI T2, A1, -1
9D034B64  00C3001B   DIVU A2, V1
9D034B68  006001F4   TEQ V1, ZERO
9D034B6C  00002010   MFHI A0
9D034B70  00002812   MFLO A1
9D034B74  70A72802   MUL A1, A1, A3
9D034B78  00042400   SLL A0, A0, 16
9D034B7C  008A2025   OR A0, A0, T2
9D034B80  0085502B   SLTU T2, A0, A1
9D034B84  00C3001B   DIVU A2, V1
9D034B88  006001F4   TEQ V1, ZERO
9D034B8C  5140FF60   BEQL T2, ZERO, .LBB17
9D034B90  00852823   SUBU A1, A0, A1
9D034B94  00882021   ADDU A0, A0, T0
9D034B98  0088302B   SLTU A2, A0, T0
9D034B9C  54C0FF5C   BNEL A2, ZERO, .LBB17
9D034BA0  00852823   SUBU A1, A0, A1
9D034BA4  0085502B   SLTU T2, A0, A1
9D034BA8  00883021   ADDU A2, A0, T0
9D034BAC  00CA200B   MOVN A0, A2, T2
9D034BB0  0B40D244   J .LBB17
9D034BB4  00852823   SUBU A1, A0, A1
9D034BB8  01063023   SUBU A2, T0, A2
9D034BBC  01271823   SUBU V1, T1, A3
9D034BC0  0106402B   SLTU T0, T0, A2
9D034BC4  00681823   SUBU V1, V1, T0
9D034BC8  0B40D2B4   J .LBB24
9D034BCC  00431823   SUBU V1, V0, V1
9D034BD0  004E282B   SLTU A1, V0, T6
9D034BD4  50A0FFB4   BEQL A1, ZERO, 0x9D034AA8
9D034BD8  00084400   SLL T0, T0, 16
9D034BDC  246DFFFE   ADDIU T5, V1, -2
9D034BE0  0B40D2A9   J 0x9D034AA4
9D034BE4  00471021   ADDU V0, V0, A3
9D034BE8  00C82021   ADDU A0, A2, T0
9D034BEC  0B40D2D7   J 0x9D034B5C
9D034BF0  008A300B   MOVN A2, A0, T2
9D034BF4  0088182B   SLTU V1, A0, T0
9D034BF8  5460FFF0   BNEL V1, ZERO, 0x9D034BBC
9D034BFC  01063023   SUBU A2, T0, A2
9D034C00  00003012   MFLO A2
9D034C04  0B40D2B4   J .LBB24
9D034C08  00001821   ADDU V1, ZERO, ZERO
9D035054  03E00008   JR RA
9D035058  24020001   ADDIU V0, ZERO, 1
9D03505C  0B40D372   J 0x9D034DC8
9D035060  00C83021   ADDU A2, A2, T0
---  /Applications/microchip/xc32/v2.05/pic32mx/include/lega-c/peripheral/system.h  ---------------------
1:                   /********************************************************************
2:                   
3:                   	System Library Interface Definition
4:                   	
5:                   	Summary:
6:                   		This file contains the interface definition for the System
7:                   		peripheral library.
8:                   		
9:                   	Description:
10:                  		This library provides functions for configuring the peripheral
11:                  		clock, cache settings, and wait states.  For details on the
12:                  		register and bit settings used by these functions, refer to the
13:                  		PIC32 Family Reference Manual.
14:                  
15:                  
16:                   ********************************************************************/
17:                  //DOM-IGNORE-BEGIN
18:                  /********************************************************************
19:                   * FileName:		System.h
20:                   * Dependencies:
21:                   * Processor:		PIC32
22:                   * Hardware:		N/A
23:                   * Assembler:		N/A
24:                   * Linker:		    N/A
25:                   * Company:		    Microchip Technology Inc.
26:                   *
27:                   * Software License Agreement:
28:                   * The software supplied herewith by Microchip Technology Incorporated
29:                   * (the Company) for its PICmicro Microcontroller is intended and
30:                   * supplied to you, the Companys customer, for use solely and
31:                   * exclusively on Microchip PICmicro Microcontroller products. The
32:                   * software is owned by the Company and/or its supplier, and is
33:                   * protected under applicable copyright laws. All rights are reserved.
34:                   * Any use in violation of the foregoing restrictions may subject the
35:                   * user to criminal sanctions under applicable laws, as well as to
36:                   * civil liability for the breach of the terms and conditions of this
37:                   * license.
38:                   *
39:                   * THIS SOFTWARE IS PROVIDED IN AN AS IS CONDITION. NO WARRANTIES,
40:                   * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED
41:                   * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
42:                   * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,
43:                   * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR
44:                   * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.
45:                   *
46:                   * $Id: CoreTimer.h,v 1.2 2006/11/03 15:07:21 C12923 Exp $
47:                   * $Name:  $
48:                   ********************************************************************/
49:                  //DOM-IGNORE-END
50:                   
51:                   
52:                  #ifndef _SYSTEM_HEADER_FILE
53:                  #define _SYSTEM_HEADER_FILE
54:                  
55:                  #include <xc.h>
56:                  #include <peripheral/int.h>
57:                  #include <peripheral/pcache.h>
58:                  #include <peripheral/osc.h>
59:                  #include <peripheral/dma.h>
60:                  #include <peripheral/bmx.h>
61:                  #include <peripheral/lock.h>
62:                  #ifdef __cplusplus
63:                  extern "C"
64:                    {
65:                  #endif
66:                  
67:                  /*
68:                  *  WARNING: All the Peripheral Library (PLIB) functions, including those in this file,
69:                  *  will be removed from future releases of MPLAB XC32 C/C++ Compiler.
70:                  *  Please refer to the MPLAB Harmony Libraries for new projects.  For legacy support,
71:                  *  these PLIB Libraries will be available for download from: www.microchip.com/pic32_peripheral_lib
72:                  */
73:                  #ifndef _SUPPRESS_PLIB_WARNING
74:                    #warning The PLIB functions and macros in this file will be removed from the MPLAB XC32 C/C++ Compiler in future releases
75:                  #endif
76:                  
77:                  
78:                  
79:                  #define FLASH_SPEED_HZ          30000000 //Max Flash speed
80:                  #define PB_BUS_MAX_FREQ_HZ      80000000 //Max Peripheral bus speed
81:                  
82:                  /*********************************************************************
83:                   * SYSTEMConfig Flags
84:                   *********************************************************************/
85:                  #define SYS_CFG_WAIT_STATES     0x00000001 //SYSTEMConfig wait states
86:                  #define SYS_CFG_PB_BUS          0x00000002 //SYSTEMConfig pb bus
87:                  #define SYS_CFG_PCACHE          0x00000004 //SYSTEMConfig cache
88:                  #define SYS_CFG_ALL             0xFFFFFFFF //SYSTEMConfig All
89:                  
90:                  /*********************************************************************
91:                   Function:       
92:                  	unsigned int SYSTEMConfigPB(unsigned int sys_clock)
93:                   
94:                   Description:
95:                  	The function sets the PB divider to the optimum value.
96:                   
97:                   PreCondition:    
98:                  	None
99:                   
100:                  Parameters:           
101:                 	sys_clock - system clock in Hz
102:                  
103:                  Returns:          
104:                 	the PB clock frequency in Hz
105:                  
106:                  Side Effects:
107:                 	The PB clock may be changed
108:                 	
109:                  Overview:	    
110:                 	The function sets the PB divider to the optimum value.
111:                  
112:                  Remarks:            
113:                 	The interrupts are disabled briefly, the DMA is suspended and the system is unlocked while performing the operation.
114:                     Upon return the previous status of the interrupts and the DMA are restored. The system is re-locked.
115:                  
116:                  Example:
117:                 	<code>
118:                 	SYSTEMConfigPB(72000000);
119:                 	</code>
120:                  ********************************************************************/
121:                 extern inline unsigned int __attribute__((always_inline)) SYSTEMConfigPB(unsigned int sys_clock)
122:                 {
123:                     unsigned int pb_div;
124:                     unsigned int pb_clock;
125:                 
126:                     pb_clock = sys_clock;
127:                 
128:                     if(sys_clock > PB_BUS_MAX_FREQ_HZ)
129:                     {
130:                         pb_div=OSC_PB_DIV_2;
131:                         pb_clock >>= 1;
132:                     }
133:                     else
134:                     {
135:                         pb_div=OSC_PB_DIV_1;
136:                     }
137:                 
138:                     OSCSetPBDIV(pb_div);
139:                 
140:                     return pb_clock;
141:                 }
142:                 
143:                 
144:                 /*********************************************************************
145:                   Function:        
146:                 	void SYSTEMConfigWaitStates(unsigned int sys_clock)
147:                  
148:                   Description:
149:                 	The function sets the Flash Wait states to the optimum value.
150:                  
151:                   PreCondition:    
152:                 	None
153:                  
154:                   Parameters:           
155:                 	sys_clock - system clock in Hz
156:                  
157:                   Returns:          
158:                 	None
159:                  
160:                   Side Effects:    
161:                 	The Wait States may be changed  
162:                  
163:                   Remarks:         
164:                 	The interrupts are disabled briefly, the DMA is suspended and the system is unlocked while performing the operation.
165:                     Upon return the previous status of the interrupts and the DMA are restored. The system is re-locked.
166:                  
167:                   Example:
168:                 	<code>
169:                 	SYSTEMConfigWaitStates(72000000);
170:                 	</code>
171:                  ********************************************************************/
172:                 extern inline void __attribute__((always_inline)) SYSTEMConfigWaitStates(unsigned int sys_clock)
173:                 {
174:                 #ifdef _PCACHE
175:                     unsigned int wait_states;
176:                     unsigned int int_status;
177:                 #endif
178:                 
179:                 #ifdef _PCACHE
180:                     wait_states = 0;
181:                 
182:                     while(sys_clock > FLASH_SPEED_HZ)
183:                     {
184:                         wait_states++;
185:                         sys_clock -= FLASH_SPEED_HZ;
186:                     }
187:                 
188:                     int_status=INTDisableInterrupts();
189:                     mCheConfigure(wait_states);
190:                     INTRestoreInterrupts(int_status);
191:                 
192:                 #endif
193:                 }
194:                 
195:                 /*********************************************************************
196:                   Function:        
197:                 		unsigned int SYSTEMConfigWaitStatesAndPB(unsigned int sys_clock)
198:                   
199:                   Description:
200:                 	The function sets the PB divider and the Flash Wait states to the optimum value.
201:                  
202:                   PreCondition:    
203:                 	None
204:                  
205:                   Parameters:           
206:                 	sys_clock - system clock in Hz
207:                  
208:                   Returns:          
209:                 	the PB clock frequency in Hz
210:                  
211:                   Side Effects:    
212:                 	The PB clock and wait states may be changed
213:                 
214:                   Remarks:            
215:                 	The interrupts are disabled briefly, the DMA is suspended and the system is unlocked while performing the operation.
216:                     Upon return the previous status of the interrupts and the DMA are restored. The system is re-locked.
217:                  
218:                   Example:
219:                 	<code>
220:                 	SYSTEMConfigWaitStatesAndPB(72000000);
221:                 	</code>
222:                  ********************************************************************/
223:                 extern inline unsigned int __attribute__((always_inline)) SYSTEMConfigWaitStatesAndPB(unsigned int sys_clock)
224:                 {
225:                 #ifdef _PCACHE
226:                     unsigned int wait_states;
227:                 #endif
228:                     unsigned int pb_clock;
229:                     unsigned int int_status;
230:                 
231:                     pb_clock = SYSTEMConfigPB(sys_clock);
232:                 
233:                 
234:                     // set the flash wait states based on 1 wait state
235:                     // for every 20 MHz
236:                 #ifdef _PCACHE
237:                     wait_states = 0;
238:                 
239:                     while(sys_clock > FLASH_SPEED_HZ)
240:                     {
241:                         wait_states++;
242:                         sys_clock -= FLASH_SPEED_HZ;
243:                     }
244:                 
245:                     int_status=INTDisableInterrupts();
9D027464  0F410A1F   JAL INTDisableInterrupts
9D027468  3C11BF88   LUI S1, -16504
246:                     mCheConfigure(wait_states);
9D02746C  24100001   ADDIU S0, ZERO, 1
9D027470  AE304000   SW S0, 16384(S1)
247:                     INTRestoreInterrupts(int_status);
9D027474  0F410916   JAL INTRestoreInterrupts
9D027478  00402021   ADDU A0, V0, ZERO
248:                 
249:                 #endif
250:                 
251:                     return pb_clock;
252:                 }
253:                 /*********************************************************************
254:                   Function:       
255:                 	unsigned int SYSTEMConfigPerformance(unsigned int sys_clock)
256:                  
257:                   Description:
258:                 	The function sets the PB divider, the Flash Wait states and the DRM wait states to the optimum value.
259:                     It also enables the cacheability for the K0 segment.
260:                 	
261:                   PreCondition:    
262:                 	None
263:                  
264:                   Parameters:           
265:                 	sys_clock - system clock in Hz
266:                  
267:                   Output:          
268:                 	the PB clock frequency in Hz
269:                  
270:                   Side Effects:    
271:                 	Sets the PB and Flash Wait states
272:                  	
273:                   Remarks:            
274:                 	The interrupts are disabled briefly, the DMA is suspended and the system is unlocked while performing the operation.
275:                     Upon return the previous status of the interrupts and the DMA are restored. The system is re-locked.
276:                  
277:                   Example:
278:                 	<code>
279:                 	SYSTEMConfigPerformance(72000000);
280:                 	</code>
281:                  ********************************************************************/
282:                 extern inline unsigned int __attribute__((always_inline)) SYSTEMConfigPerformance(unsigned int sys_clock)
283:                 {
284:                     // set up the wait states
285:                     unsigned int pb_clk;
286:                 #ifdef _PCACHE
287:                     unsigned int cache_status;
288:                 #endif
289:                     unsigned int int_status;
290:                 
291:                     pb_clk = SYSTEMConfigWaitStatesAndPB(sys_clock);
292:                 
293:                     int_status=INTDisableInterrupts();
9D02747C  0F410A1F   JAL INTDisableInterrupts
9D027480  00000000   NOP
9D027484  00409021   ADDU S2, V0, ZERO
294:                 
295:                     mBMXDisableDRMWaitState();
9D027488  24190040   ADDIU T9, ZERO, 64
9D02748C  3C02BF88   LUI V0, -16504
9D027490  AC592004   SW T9, 8196(V0)
296:                 
297:                 #ifdef _PCACHE
298:                     cache_status = mCheGetCon();
9D027494  8E234000   LW V1, 16384(S1)
299:                     cache_status |= CHE_CONF_PF_ALL;
9D027498  34640030   ORI A0, V1, 48
300:                     mCheConfigure(cache_status);
9D02749C  AE244000   SW A0, 16384(S1)
301:                     CheKseg0CacheOn();
9D0274A0  0F410967   JAL CheKseg0CacheOn
9D0274A4  00000000   NOP
302:                 #endif
303:                 
304:                     INTRestoreInterrupts(int_status);
9D0274A8  0F410916   JAL INTRestoreInterrupts
9D0274AC  02402021   ADDU A0, S2, ZERO
305:                 
306:                     return pb_clk;
307:                 
308:                 }
309:                 /*********************************************************************
310:                   Function:       
311:                 	unsigned int SYSTEMConfig(unsigned int sys_clock, unsigned int flags)
312:                  
313:                   Description:
314:                 	The function sets the PB divider, the Flash Wait states or the DRM wait states to the optimum value, 
315:                 	based on the flags selected and on the frequency of the system clock.
316:                     It also enables the cacheability for the K0 segment.
317:                 				   
318:                   PreCondition:    
319:                 	None
320:                  
321:                   Parameters:           
322:                 	sys_clock - system clock frequency in Hz
323:                     flags -
324:                 		*    SYS_CFG_WAIT_STATES  - configure the flash wait states from the system clock
325:                         *    SYS_CFG_PB_BUS       - configure the PB bus from the system clock
326:                         *    SYS_CFG_PCACHE      - configure the pCache (if used)
327:                         *    SYS_CFG_ALL          - configure all based on system clock
328:                  
329:                   Returns:          
330:                 	the PB clock frequency in Hz
331:                  
332:                   Side Effects:    
333:                 	Could change the wait state, pb clock and turn on the pre-fetch buffer and cache. Sets the RAM
334:                     wait state to 0.
335:                   
336:                  
337:                   Remarks:
338:                 	The interrupts are disabled shortly, the DMA is suspended and the system is unlocked while performing the operation.
339:                     Upon return the previous status of the interrupts and the DMA are restored. The system is re-locked.
340:                  
341:                   Example:
342:                 	<code>
343:                 	SYSTEMConfig(72000000, SYS_CFG_ALL);
344:                 	</code>
345:                  ********************************************************************/
346:                 extern inline unsigned int __attribute__((always_inline)) SYSTEMConfig(unsigned int sys_clock, unsigned int flags)
347:                 {
348:                     unsigned int pb_clk;
349:                     unsigned int int_status;
350:                 #ifdef _PCACHE
351:                     unsigned int cache_status;
352:                 #endif
353:                 
354:                     int_status=INTDisableInterrupts();
355:                 
356:                     mBMXDisableDRMWaitState();
357:                 
358:                     if(flags & SYS_CFG_WAIT_STATES)
359:                     {
360:                         SYSTEMConfigWaitStates(sys_clock);
361:                     }
362:                 
363:                     if(flags & SYS_CFG_PB_BUS)
364:                     {
365:                         SYSTEMConfigPB(sys_clock);
366:                     }
367:                 
368:                 
369:                 #ifdef _PCACHE
370:                     if(flags & SYS_CFG_PCACHE)
371:                     {
372:                         cache_status = mCheGetCon();
373:                         cache_status |= CHE_CONF_PF_ALL;
374:                         mCheConfigure(cache_status);
375:                         CheKseg0CacheOn();
376:                     }
377:                 #endif
378:                 
379:                     pb_clk = sys_clock;
380:                     pb_clk >>= OSCCONbits.PBDIV;
381:                 
382:                     INTRestoreInterrupts(int_status);
383:                 
384:                     return pb_clk;
385:                 
386:                 }
387:                 #ifdef __cplusplus
388:                   }
389:                 #endif
390:                 #endif
391:                 
---  /Applications/microchip/xc32/v2.05/pic32mx/include/lega-c/peripheral/osc.h  ------------------------
1:                   /*********************************************************************
2:                    *
3:                    *                  OSC API definitions
4:                    *
5:                    *********************************************************************
6:                    * FileName:        OSC.h
7:                    * Dependencies:
8:                    * Processor:       PIC32
9:                    *
10:                   *
11:                   * Compiler:        MPLAB XC32
12:                   *                  MPLAB IDE
13:                   * Company:         Microchip Technology Inc.
14:                   *
15:                   * Software License Agreement
16:                   *
17:                   * The software supplied herewith by Microchip Technology Incorporated
18:                   * (the Company) for its PIC Microcontroller is intended
19:                   * and supplied to you, the Companys customer, for use solely and
20:                   * exclusively on Microchip PIC Microcontroller products.
21:                   * The software is owned by the Company and/or its supplier, and is
22:                   * protected under applicable copyright laws. All rights are reserved.
23:                   * Any use in violation of the foregoing restrictions may subject the
24:                   * user to criminal sanctions under applicable laws, as well as to
25:                   * civil liability for the breach of the terms and conditions of this
26:                   * license.
27:                   *
28:                   * THIS SOFTWARE IS PROVIDED IN AN AS IS CONDITION. NO WARRANTIES,
29:                   * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED
30:                   * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
31:                   * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,
32:                   * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR
33:                   * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.
34:                   *
35:                   *
36:                   * $Id: OSC.h,v 1.6 2006/10/13 21:24:31 C12532 Exp $
37:                   * $Name:  $
38:                   ********************************************************************/
39:                  
40:                  #ifndef OSC_H_
41:                  #define OSC_H_
42:                  
43:                  #include <xc.h>
44:                  #include <peripheral/lock.h>
45:                  
46:                  /*
47:                  *  WARNING: All the Peripheral Library (PLIB) functions, including those in this file,
48:                  *  will be removed from future releases of MPLAB XC32 C/C++ Compiler.
49:                  *  Please refer to the MPLAB Harmony Libraries for new projects.  For legacy support,
50:                  *  these PLIB Libraries will be available for download from: www.microchip.com/pic32_peripheral_lib
51:                  */
52:                  #ifndef _SUPPRESS_PLIB_WARNING
53:                    #warning The PLIB functions and macros in this file will be removed from the MPLAB XC32 C/C++ Compiler in future releases
54:                  #endif
55:                  
56:                  
57:                  #define _OSC_
58:                  
59:                  /*********************************************************************
60:                   * Function:        OSCConfig(unsigned long int source, unsigned long int mult, unsigned long int post, unsigned long int div)
61:                   *
62:                   * Description:     Sets Osc options and clock source
63:                   *
64:                   * PreCondition:    Interrupts must be disabled and DMA suspended or disabled
65:                   *
66:                   * Inputs:          Clock source, PLL multiplier, PLL postscaler, FRC divisor - see below
67:                   *
68:                   * Output:          None
69:                   *
70:                   * Example:         OSCConfig( OSC_POSC, OSC_PLL_MULT_24, OSC_PLL_POST_256, OSC_FRC_POST_64 )
71:                   *
72:                   * Note:            Forces cpu clock source to FRC(no divisor, no PLL), configures new clock
73:                   *                  source and then switches to the new clock source
74:                   *
75:                   *                  Unused parameters are set to zero/default values.
76:                   ********************************************************************/
77:                  void OSCConfig(unsigned long int source, unsigned long int mult, unsigned long int post, unsigned long int div);
78:                  
79:                      /******************************************************************************
80:                       * Available options for source parameter
81:                       *****************************************************************************/
82:                          // CPU Oscillator modes - values are mutually exclusive
83:                          #define OSC_FRC_DIV     (7 << _OSCCON_NOSC_POSITION)
84:                          #define OSC_FRC_DIV16   (6 << _OSCCON_NOSC_POSITION)
85:                          #define OSC_LPRC        (5 << _OSCCON_NOSC_POSITION)
86:                          #define OSC_SOSC        (4 << _OSCCON_NOSC_POSITION)
87:                          #define OSC_POSC_PLL    (3 << _OSCCON_NOSC_POSITION)
88:                          #define OSC_POSC        (2 << _OSCCON_NOSC_POSITION)
89:                          #define OSC_FRC_PLL     (1 << _OSCCON_NOSC_POSITION)
90:                          #define OSC_FRC         (0 << _OSCCON_NOSC_POSITION)
91:                  
92:                      /******************************************************************************
93:                       * Available options for mult parameter
94:                       *****************************************************************************/
95:                          // CPU PLL multiplier values - values are mutually exclusive
96:                          #define OSC_PLL_MULT_24 (7 << _OSCCON_PLLMULT_POSITION)
97:                          #define OSC_PLL_MULT_21 (6 << _OSCCON_PLLMULT_POSITION)
98:                          #define OSC_PLL_MULT_20 (5 << _OSCCON_PLLMULT_POSITION)
99:                          #define OSC_PLL_MULT_19 (4 << _OSCCON_PLLMULT_POSITION)
100:                         #define OSC_PLL_MULT_18 (3 << _OSCCON_PLLMULT_POSITION)
101:                         #define OSC_PLL_MULT_17 (2 << _OSCCON_PLLMULT_POSITION)
102:                         #define OSC_PLL_MULT_16 (1 << _OSCCON_PLLMULT_POSITION)
103:                         #define OSC_PLL_MULT_15 (0 << _OSCCON_PLLMULT_POSITION)
104:                 
105:                     /******************************************************************************
106:                      * Available options for post parameter
107:                      *****************************************************************************/
108:                         // CPU PLL output divisor values - values are mutuallye exclusive
109:                         #define OSC_PLL_POST_256 (7 << _OSCCON_PLLODIV_POSITION)
110:                         #define OSC_PLL_POST_64  (6 << _OSCCON_PLLODIV_POSITION)
111:                         #define OSC_PLL_POST_32  (5 << _OSCCON_PLLODIV_POSITION)
112:                         #define OSC_PLL_POST_16  (4 << _OSCCON_PLLODIV_POSITION)
113:                         #define OSC_PLL_POST_8   (3 << _OSCCON_PLLODIV_POSITION)
114:                         #define OSC_PLL_POST_4   (2 << _OSCCON_PLLODIV_POSITION)
115:                         #define OSC_PLL_POST_2   (1 << _OSCCON_PLLODIV_POSITION)
116:                         #define OSC_PLL_POST_1   (0 << _OSCCON_PLLODIV_POSITION)
117:                 
118:                     /******************************************************************************
119:                      * Available options for div parameter
120:                      *****************************************************************************/
121:                         // CPU FRC output divisor values - values are mutually exclusive
122:                         #define OSC_FRC_POST_256 (7 << _OSCCON_FRCDIV_POSITION)
123:                         #define OSC_FRC_POST_64  (6 << _OSCCON_FRCDIV_POSITION)
124:                         #define OSC_FRC_POST_32  (5 << _OSCCON_FRCDIV_POSITION)
125:                         #define OSC_FRC_POST_16  (4 << _OSCCON_FRCDIV_POSITION)
126:                         #define OSC_FRC_POST_8   (3 << _OSCCON_FRCDIV_POSITION)
127:                         #define OSC_FRC_POST_4   (2 << _OSCCON_FRCDIV_POSITION)
128:                         #define OSC_FRC_POST_2   (1 << _OSCCON_FRCDIV_POSITION)
129:                         #define OSC_FRC_POST_1   (0 << _OSCCON_FRCDIV_POSITION)
130:                     /***********************************
131:                      * End parameter values
132:                      ************************************/
133:                 
134:                 #if defined(__32MX120F064H__) || \
135:                     defined(__32MX130F128H__) || \
136:                     defined(__32MX130F128L__) || \
137:                     defined(__32MX150F256H__) || \
138:                     defined(__32MX150F256L__) || \
139:                     defined(__32MX170F512H__) || \
140:                     defined(__32MX170F512L__) || \
141:                     defined(__32MX230F128H__) || \
142:                     defined(__32MX230F128L__) || \
143:                     defined(__32MX250F256H__) || \
144:                     defined(__32MX250F256L__) || \
145:                     defined(__32MX270F512H__) || \
146:                     defined(__32MX270F512L__) || \
147:                     defined(__32MX530F128H__) || \
148:                     defined(__32MX530F128L__) || \
149:                     defined(__32MX550F256H__) || \
150:                     defined(__32MX550F256L__) || \
151:                     defined(__32MX570F512H__) || \
152:                     defined(__32MX570F512L__)
153:                   #define NEED_OSCREFCONFIG_FLAGS
154:                 #elif (__PIC32_FEATURE_SET__ >= 100) && (__PIC32_FEATURE_SET__ <= 299)
155:                   #define NEED_OSCREFCONFIG_FLAGS
156:                 #elif (__PIC32_FEATURE_SET__ == 330) || \
157:                       (__PIC32_FEATURE_SET__ == 350) || \
158:                       (__PIC32_FEATURE_SET__ == 370) || \
159:                       (__PIC32_FEATURE_SET__ == 430) || \
160:                       (__PIC32_FEATURE_SET__ == 450) || \
161:                       (__PIC32_FEATURE_SET__ == 470)
162:                   #define NEED_OSCREFCONFIG_FLAGS
163:                 #else
164:                   #undef  NEED_OSCREFCONFIG_FLAGS
165:                 #endif
166:                 
167:                 #if defined( NEED_OSCREFCONFIG_FLAGS )
168:                   // Reference Oscillator Source Select bits - values are mutually exclusive
169:                   #define OSC_REFOCON_REFCLKI     (7 << _REFOCON_ROSEL_POSITION )
170:                   #define OSC_REFOCON_SYSPLL      (7 << _REFOCON_ROSEL_POSITION )
171:                   #define OSC_REFOCON_USBPLL      (6 << _REFOCON_ROSEL_POSITION )
172:                   #define OSC_REFOCON_SOSC        (5 << _REFOCON_ROSEL_POSITION )
173:                   #define OSC_REFOCON_LPRC        (4 << _REFOCON_ROSEL_POSITION )
174:                   #define OSC_REFOCON_FRC         (3 << _REFOCON_ROSEL_POSITION )
175:                   #define OSC_REFOCON_POSC        (2 << _REFOCON_ROSEL_POSITION )
176:                   #define OSC_REFOCON_PBCLK       (1 << _REFOCON_ROSEL_POSITION )
177:                   #define OSC_REFOCON_SYSCLK      (0 << _REFOCON_ROSEL_POSITION )
178:                 
179:                   typedef enum
180:                   {
181:                       OSC_REFOCON_RLSPEN      =(1 << _REFOCON_RSLP_POSITION ) ,
182:                       OSC_REFOCON_OE          =(1 << _REFOCON_OE_POSITION ),
183:                       OSC_REFOCON_SIDLEN      =(1 << _REFOCON_SIDL_POSITION ),
184:                       OSC_REFOCON_ON          =(1 << _REFOCON_ON_POSITION )
185:                   } OSCREFConfigFlags;
186:                 
187:                   void OSCREFConfig(unsigned long int source, OSCREFConfigFlags config, unsigned long int div);
188:                 
189:                   #define mOSCREFOTRIMSet(trim)       (REFOTRIM = (trim << _REFOTRIM_ROTRIM_POSITION))
190:                 
191:                 #endif//defined( NEED_OSCREFCONFIG_FLAGS )
192:                 
193:                 #undef  NEED_OSCREFCONFIG_FLAGS
194:                 
195:                 
196:                 /*********************************************************************
197:                  * Function:    OSCSetPBDIV(unsigned int oscPbDiv)
198:                  *
199:                  * Description: Configures peripheral bus divisor
200:                  *
201:                  * PreCondition: oscPbDiv one of the OSC_PB_DIV_X valid values
202:                  *
203:                  * Inputs:    oscPbDiv - desired PB divider
204:                  *
205:                  * Output:      None
206:                  *
207:                  * Example:   OSCSetPBDIV(  OSC_PB_DIV_8 )
208:                  *
209:                  ********************************************************************/
210:                 extern inline void __attribute__((always_inline)) OSCSetPBDIV(unsigned int oscPbDiv)
211:                 {
212:                     unsigned int dma_status;
213:                     unsigned int int_status;
214:                     __OSCCONbits_t oscBits;
215:                 
216:                     mSYSTEMUnlock(int_status, dma_status);
9D027400  0F410A1F   JAL INTDisableInterrupts
9D027404  AFB00010   SW S0, 16(SP)
9D027848  AD20F230   SW ZERO, -3536(T1)
9D02784C  3C0AAA99   LUI T2, -21863
9D027850  254B6655   ADDIU T3, T2, 26197
9D027854  AD2BF230   SW T3, -3536(T1)
9D027858  3C0C5566   LUI T4, 21862
9D02785C  358D99AA   ORI T5, T4, -26198
9D027860  AD2DF230   SW T5, -3536(T1)
9D027898  ACC0F230   SW ZERO, -3536(A2)
9D02789C  3C07AA99   LUI A3, -21863
9D0278A0  24E86655   ADDIU T0, A3, 26197
9D0278A4  ACC8F230   SW T0, -3536(A2)
9D0278A8  3C095566   LUI T1, 21862
9D0278AC  352A99AA   ORI T2, T1, -26198
9D0278B0  ACCAF230   SW T2, -3536(A2)
217:                 
218:                     oscBits.w=OSCCON;       // read to be in sync. flush any pending write
9D027864  3C0EBF81   LUI T6, -16511
9D027868  8DCFF000   LW T7, -4096(T6)
9D0278B4  3C0BBF81   LUI T3, -16511
9D0278B8  8D6CF000   LW T4, -4096(T3)
219:                     oscBits.PBDIV=0;
9D02786C  7C0FA4C4   INS T7, ZERO, 19, 2
9D0278BC  7C0CA4C4   INS T4, ZERO, 19, 2
220:                     oscBits.w|=oscPbDiv;
221:                     OSCCON=oscBits.w;       // write back
9D027870  ADCFF000   SW T7, -4096(T6)
9D0278C0  AD6CF000   SW T4, -4096(T3)
222:                     oscBits.w=OSCCON;       // make sure the write occurred before returning from this function
9D027874  8DC4F000   LW A0, -4096(T6)
9D0278C4  8D64F000   LW A0, -4096(T3)
223:                 
224:                     mSYSTEMLock(int_status, dma_status);
9D02745C  0F410916   JAL INTRestoreInterrupts
9D027460  00402021   ADDU A0, V0, ZERO
9D027878  3C103333   LUI S0, 13107
9D02787C  26113333   ADDIU S1, S0, 13107
9D027880  AD31F230   SW S1, -3536(T1)
9D0278C8  3C0D3333   LUI T5, 13107
9D0278CC  25AE3333   ADDIU T6, T5, 13107
9D0278D0  ACCEF230   SW T6, -3536(A2)
225:                 }
226:                 
227:                 #define     mOSCSetPBDIV        OSCSetPBDIV     // backward compatibility
228:                 
229:                 
230:                 
231:                     /******************************************************************************
232:                      * Available options for config parameter
233:                      *****************************************************************************/
234:                         // CPU Peripheral Bus divisor values - values are mutually exclusive
235:                         #define OSC_PB_DIV_8    (3 << _OSCCON_PBDIV_POSITION)
236:                         #define OSC_PB_DIV_4    (2 << _OSCCON_PBDIV_POSITION)
237:                         #define OSC_PB_DIV_2    (1 << _OSCCON_PBDIV_POSITION)
238:                         #define OSC_PB_DIV_1    (0 << _OSCCON_PBDIV_POSITION)
239:                     /***********************************
240:                      * End config parameter values
241:                      ************************************/
242:                 
243:                 
244:                 /*********************************************************************
245:                  * Function:    mOSCGetPBDIV()
246:                  *
247:                  * Description: Reads peripheral bus divisor
248:                  *
249:                  * PreCondition:None
250:                  *
251:                  * Inputs:      None
252:                  *
253:                  * Output:      None
254:                  *
255:                  * Example:     mOSCGetPBDIV()
256:                  *
257:                  ********************************************************************/
258:                 #define mOSCGetPBDIV() (OSCCONbits.PBDIV)
259:                 
260:                 
261:                 /*********************************************************************
262:                  * Function:    mOSCClockFailStatus()
263:                  *
264:                  * Description: Returns Clock Fail status. 1 = clock fail, 0 = no clock fail
265:                  *
266:                  * PreCondition: None
267:                  *
268:                  * Inputs:      None
269:                  *
270:                  * Output:      None
271:                  *
272:                  * Example:     mOSCClockFailStatus()
273:                  *
274:                  ********************************************************************/
275:                 #define mOSCClockFailStatus (OSCCONbits.CF)
276:                 
277:                 
278:                 /*********************************************************************
279:                  * Function:        mOSCEnableSOSC()
280:                  *
281:                  * Description:     Enables the LPRC
282:                  *
283:                  * PreCondition:    Interrupts must be disabled and DMA suspended or disabled
284:                  *
285:                  * Inputs:          None
286:                  *
287:                  * Output:          None
288:                  *
289:                  * Example:         mOSCEnableSOSC()
290:                  *
291:                  ********************************************************************/
292:                 #define mOSCEnableSOSC() mSysUnlockOpLock(OSCCONSET = _OSCCON_SOSCEN_MASK)
293:                 
294:                 
295:                 /*********************************************************************
296:                  * Function:        mOSCDisableSOSC(config)
297:                  *
298:                  * Description:     Disables SOSC
299:                  *
300:                  * PreCondition:    Interrupts must be disabled and DMA suspended or disabled
301:                  *
302:                  * Inputs:          None
303:                  *
304:                  * Output:          None
305:                  *
306:                  * Example:         mOSCDisableSOSC()
307:                  *
308:                  ********************************************************************/
309:                 #define mOSCDisableSOSC() mSysUnlockOpLock(OSCCONCLR = _OSCCON_SOSCEN_MASK)
310:                 
311:                 
312:                 
313:                 #endif
---  /Applications/microchip/xc32/v2.05/pic32mx/include/lega-c/peripheral/dma_1xx_2xx.h  ----------------
1:                   /*********************************************************************
2:                    *
3:                    *                  DMA API definitions
4:                    *
5:                    *********************************************************************
6:                    * FileName:        Dma.h
7:                    * Dependencies:    xc.h
8:                    *                  int.h
9:                    *
10:                   * Processor:       PIC32
11:                   *
12:                   * Compiler:        MPLAB XC32
13:                   *                  MPLAB IDE
14:                   * Company:         Microchip Technology Inc.
15:                   *
16:                   * Software License Agreement
17:                   *
18:                   * The software supplied herewith by Microchip Technology Incorporated
19:                   * (the Company) for its PIC32/PIC24F Microcontroller is intended
20:                   * and supplied to you, the Companys customer, for use solely and
21:                   * exclusively on Microchip PIC32/PIC24F Microcontroller products.
22:                   * The software is owned by the Company and/or its supplier, and is
23:                   * protected under applicable copyright laws. All rights are reserved.
24:                   * Any use in violation of the foregoing restrictions may subject the
25:                   * user to criminal sanctions under applicable laws, as well as to
26:                   * civil liability for the breach of the terms and conditions of this
27:                   * license.
28:                   *
29:                   * THIS SOFTWARE IS PROVIDED IN AN AS IS CONDITION. NO WARRANTIES,
30:                   * WHETHER EXPRESS, IMPLIED OR STATUTORY, INCLUDING, BUT NOT LIMITED
31:                   * TO, IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A
32:                   * PARTICULAR PURPOSE APPLY TO THIS SOFTWARE. THE COMPANY SHALL NOT,
33:                   * IN ANY CIRCUMSTANCES, BE LIABLE FOR SPECIAL, INCIDENTAL OR
34:                   * CONSEQUENTIAL DAMAGES, FOR ANY REASON WHATSOEVER.
35:                   *
36:                   *
37:                   * $Id: Dma.h,v 1.9 2007/01/17 21:35:46 C12878 Exp $
38:                   * $Name:  $
39:                   *
40:                   ********************************************************************/
41:                  
42:                  #ifndef _DMA_1XX_2XX_H_
43:                  #define _DMA_1XX_2XX_H_
44:                  
45:                  #include <xc.h>
46:                  
47:                  /*
48:                  *  WARNING: All the Peripheral Library (PLIB) functions, including those in this file,
49:                  *  will be removed from future releases of MPLAB XC32 C/C++ Compiler.
50:                  *  Please refer to the MPLAB Harmony Libraries for new projects.  For legacy support,
51:                  *  these PLIB Libraries will be available for download from: www.microchip.com/pic32_peripheral_lib
52:                  */
53:                  #ifndef _SUPPRESS_PLIB_WARNING
54:                    #warning The PLIB functions and macros in this file will be removed from the MPLAB XC32 C/C++ Compiler in future releases
55:                  #endif
56:                  
57:                  
58:                  // DMA definitions
59:                  
60:                  #ifdef _DMAC0
61:                      #define _DMA_CHANNELS       // DMA channels exist
62:                  
63:                  
64:                  // existent DMA channels
65:                      typedef enum
66:                      {
67:                          DMA_CHANNEL0,
68:                      #ifdef _DMAC1
69:                          DMA_CHANNEL1,
70:                      # ifdef _DMAC2
71:                          DMA_CHANNEL2,
72:                      #  ifdef _DMAC3
73:                          DMA_CHANNEL3,
74:                      #  endif// _DMAC3
75:                      # endif // _DMAC2
76:                      #endif  // _DMAC1
77:                          //  add/remove DMA channel as needed here
78:                  
79:                          DMA_CHANNELS    // number of current available channels
80:                      }DmaChannel;
81:                  
82:                  
83:                      // Relative Dma channels priority, between each other
84:                      typedef enum
85:                      {
86:                          DMA_CHN_PRI0,
87:                          DMA_CHN_PRI1,
88:                          DMA_CHN_PRI2,
89:                          DMA_CHN_PRI3
90:                      }DmaChannelPri;
91:                  
92:                  
93:                  
94:                      // high level definitions for the API functions
95:                  
96:                      typedef enum
97:                      {
98:                          DMA_OPEN_DEFAULT = 0,                                   // DMA default operation
99:                          DMA_OPEN_AUTO   = _DCH0CON_CHAEN_MASK,                  // DMA channel is auto enabled
100:                         DMA_OPEN_CHAIN_LOW  = (_DCH0CON_CHCHN_MASK|_DCH0CON_CHCHNS_MASK),   // DMA channel is chained to lower channel
101:                         DMA_OPEN_CHAIN_HI  = (_DCH0CON_CHCHN_MASK),             // DMA channel is chained to higher channel
102:                         DMA_OPEN_DET_EN = _DCH0CON_CHAED_MASK,                  // events detection enabled while channel off
103:                         DMA_OPEN_ENABLE = _DCH0CON_CHEN_MASK,                   // DMA channel is enabled after open
104:                         DMA_OPEN_MATCH  = 0x80000000,                           // DMA channel stops on match
105:                     }DmaOpenFlags;  // flags for the channel open
106:                 
107:                 
108:                     typedef enum
109:                     {
110:                         DMA_EV_ERR =            0x1,        // address error event
111:                         DMA_EV_ABORT =          0x2,        // transfer abort event
112:                         DMA_EV_CELL_DONE =      0x4,        // cell transfer complete event
113:                         DMA_EV_BLOCK_DONE =     0x8,        // block transfer complete event
114:                         DMA_EV_DST_HALF =       0x10,       // destination half event
115:                         DMA_EV_DST_FULL =       0x20,       // destination full event
116:                         DMA_EV_SRC_HALF =       0x40,       // source half event
117:                         DMA_EV_SRC_FULL =       0x80,       // source full event
118:                 
119:                         DMA_EV_ALL_EVNTS=       (DMA_EV_ERR|DMA_EV_ABORT|DMA_EV_CELL_DONE|DMA_EV_BLOCK_DONE|DMA_EV_DST_HALF|
120:                                                     DMA_EV_DST_FULL|DMA_EV_SRC_HALF|DMA_EV_SRC_FULL)                // all available events
121:                     }DmaEvFlags;    // flags for controlling the DMA channel events; Bit fields from the processor header file.
122:                 
123:                 
124:                     typedef enum
125:                     {
126:                         DMA_TXFER_OK,           // the transfer was performed successfully
127:                         DMA_TXFER_ADD_ERR,      // address error while performing the transfer
128:                         DMA_TXFER_ABORT,        // the DMA transfer was aborted
129:                         DMA_TXFER_BC_ERR,       // block complete not set after the DMA transfer performed
130:                         DMA_TXFER_CC_ERR,       // cell complete not set after the DMA transfer performed
131:                         DMA_TXFER_TMO           // DMA transfer timeout
132:                     }DmaTxferRes;       // DMA transfer result
133:                 
134:                     typedef enum
135:                     {
136:                         DMA_WAIT_NOT,       // don't wait for the transfer to complete, return immediately
137:                         DMA_WAIT_CELL,      // wait for the cell transfer to complete, than return
138:                         DMA_WAIT_BLOCK      // wait for the block transfer to complete, than return
139:                     }DmaWaitMode;       // DMA transfer wait mode
140:                 
141:                     typedef enum
142:                     {
143:                         DMA_CHKSUM_CRC,     // LFSR CRC
144:                         DMA_CHKSUM_IP,      // IP Checksum
145:                     }DmaChksumType;     // DMA SFM supported checksum types
146:                 
147:                     typedef enum
148:                     {
149:                         DMA_BITO_MSb,       // MSb first (not reflected)
150:                         DMA_BITO_LSb,       // LSb first (reflected)
151:                     }DmaBitOrder;       // DMA SFM supported bit ordering
152:                 
153:                     typedef enum
154:                     {
155:                         DMA_REORDER_NOT,    // no reordering, destination matches the source
156:                         DMA_REORDER_ENDIAN, // change endianess on word (32 bit) boundaries: LE<->BE
157:                         DMA_REORDER_SWAP_HALF,  // swap half words (16 bit) within word (32 bit)
158:                         DMA_REORDER_SWAP_BYTE,  // swap bytes within half word (16 bit)
159:                     }DmaReorderMode;    // DMA SFM supported re-ordering modes
160:                 
161:                 
162:                     /*********************************************************************
163:                      * Function:        void DmaChnOpen(DmaChannel chn, DmaChannelPri chPri, DmaOpenFlags oFlags)
164:                      *
165:                      * PreCondition:    chPri  - valid channel priority, 0-3
166:                      *
167:                      * Input:           chn    - channel to be configured in the DMA controller
168:                      *                  chPri  - the priority given to the channel, 0-3
169:                      *                  oFlags - orred flags specifying the open mode:
170:                      *                           DMA_OPEN_DEFAULT: DMA default operation mode
171:                      *                           DMA_OPEN_AUTO: DMA channel is auto enabled
172:                      *                           DMA_OPEN_CHAIN_LOW: DMA channel is chained to lower channel
173:                      *                           DMA_OPEN_CHAIN_HI: DMA channel is chained to higher channel
174:                      *                           DMA_OPEN_DET_EN: events detection enabled while channel off
175:                      *                           DMA_OPEN_ENABLE: DMA channel is enabled when opened
176:                      *                           DMA_OPEN_MATCH:    DMA channel stops on match
177:                      *
178:                      *
179:                      *
180:                      * Output:          None
181:                      *
182:                      * Side Effects:    None
183:                      *
184:                      * Overview:        The function opens and configures the selected DMA channel using the supplied user flags and priority.
185:                      *
186:                      * Note:            - This is a high level access function that doesn't give access to all the settings possible for a DMA channel.
187:                      *                  Use the low level functions to address special settings.
188:                      *                  - The channel is turned off, the pending interrupts are cleared, interrupts are disabled.
189:                      *                  After that the channel is configured.
190:                      *                  - After calling this function, the channel should be enabled using DmaChnEnable(chn) call
191:                      *                  if DMA_OPEN_ENABLE flag was not specified.
192:                      *                  - If the CRC is attached to the submitted channel, the CRC append mode will be turned off.
193:                      *                  This way, the transfer will occur correctly together with CRC calculation.
194:                      *                  - The start and abort Irqs will be disabled and the channel event enable flags are disabled.
195:                      *                  User has to call event channel functions to enable the event flags if needed.
196:                      *
197:                      * Example:         DmaChnOpen(DMA_CHANNEL2, DMA_CHN_PRI2, DMA_OPEN_AUTO|DMA_OPEN_MATCH|DMA_OPEN_ENABLE);
198:                      ********************************************************************/
199:                      void           DmaChnOpen(DmaChannel chn, DmaChannelPri chPri, DmaOpenFlags oFlags);
200:                 
201:                     /*********************************************************************
202:                      * Function:        void DmaChnEnable(DmaChannel chn)
203:                      *
204:                      * PreCondition:    None
205:                      *
206:                      * Input:           chn     - channel to be enabled
207:                      *
208:                      * Output:          None
209:                      *
210:                      * Side Effects:    None
211:                      *
212:                      * Overview:        The function enables a previously configured DMA channel.
213:                      *
214:                      * Note:            DmaChnOpen()/DmaChnConfigure() should have been called before.
215:                      *
216:                      * Example:         DmaChnEnable(DMA_CHANNEL3);
217:                      ********************************************************************/
218:                      void           DmaChnEnable(DmaChannel chn);
219:                 
220:                     /*********************************************************************
221:                      * Function:        void DmaChnDisable(DmaChannel chn)
222:                      *
223:                      * PreCondition:    None
224:                      *
225:                      * Input:           chn     - selected channel in the DMA controller
226:                      *
227:                      * Output:          None
228:                      *
229:                      * Side Effects:    None
230:                      *
231:                      * Overview:        The function disables a DMA channel. The channel operation stops.
232:                      *
233:                      * Note:            None.
234:                      *
235:                      * Example:         DmaChnDisable(DMA_CHANNEL3);
236:                      ********************************************************************/
237:                      void           DmaChnDisable(DmaChannel chn);
238:                 
239:                     /*********************************************************************
240:                      * Function:        void DmaChnSetTxfer(DmaChannel chn, const void* vSrcAdd, void* vDstAdd, int srcSize, int dstSize, int cellSize)
241:                      *
242:                      * PreCondition:    chn     - valid DMA channel
243:                      *              - vSrcAdd, vDstAdd  - valid pointers
244:                      *                              - 0 < srcSize <= DmaGetMaxTxferSize()
245:                      *                              - 0 < dstSize <= DmaGetMaxTxferSize()
246:                      *                              - 0 < cellSize <= DmaGetMaxTxferSize()
247:                      *
248:                      * Input:           chn         - DMA channel number
249:                      *                              - vSrcAdd: source of the DMA transfer
250:                      *                              - vDstAdd: destination of the DMA transfer
251:                      *                              - srcSize: source buffer size, 1 to DmaGetMaxTxferSize() bytes, wrapped arround
252:                      *                              - dstSize: destination buffer size, 1 to DmaGetMaxTxferSize() bytes, wrapped around
253:                      *                              - cellSize: cell transfer size, 1 to DmaGetMaxTxferSize() bytes.
254:                      *
255:                      * Output:          None
256:                      *
257:                      * Side Effects:    None
258:                      *
259:                      * Overview:        The function sets the transfer characteristics for a DMA channel transfer:
260:                      *                  the source and the destination addresses.
261:                      *                  the source and destination lengths
262:                      *                  and the number of bytes transferred per event.
263:                      *
264:                      * Note:            The function clears the existing DMA channel event flags.
265:                      *                  The source to destination byte re-ordering is affected by DmaSfmConfigure(), DmaSfmTxferReorder().
266:                      *
267:                      * Example:         DmaChnSetTxfer(DMA_CHANNEL3, &U2RXREG, dstBuff, 1, 200, 1);
268:                      ********************************************************************/
269:                      void           DmaChnSetTxfer(DmaChannel chn, const void* vSrcAdd, void* vDstAdd, int srcSize, int dstSize, int cellSize);
270:                 
271:                 
272:                     /*********************************************************************
273:                      * Function:        void DmaChnSetSrcAdd(DmaChannel chn, const void* vSrcAdd)
274:                      *
275:                      * PreCondition:    chn     - valid DMA channel
276:                      *
277:                      * Input:           chn     - DMA channel number
278:                      *              - vSrcAdd: source (virtual) of the DMA transfer
279:                      * Output:          None
280:                      *
281:                      * Side Effects:    None
282:                      *
283:                      * Overview:        The function is a helper to set directly the transfer source address.
284:                      *
285:                      * Note:            None.
286:                      *
287:                      * Example:         DmaChnSetSrcAdd(DMA_CHANNEL2, srcBuff+sizeof(srcBuff));
288:                      ********************************************************************/
289:                      void           DmaChnSetSrcAdd(DmaChannel chn, const void* vSrcAdd);
290:                 
291:                     /*********************************************************************
292:                      * Function:        void DmaChnSetDstAdd(DmaChannel chn, void* vDstAdd)
293:                      *
294:                      * PreCondition:    chn     - valid DMA channel
295:                      *
296:                      * Input:           chn         - DMA channel number
297:                      *                              - vDstAdd: destination (virtual) of the DMA transfer
298:                      * Output:          None
299:                      *
300:                      * Side Effects:    None
301:                      *
302:                      * Overview:        The function is a helper to set directly the transfer destination address.
303:                      *
304:                      * Note:            None
305:                      *
306:                      * Example:         DmaChnSetDstAdd(DMA_CHANNEL2, dstBuff+sizeof(dstBuff));
307:                      ********************************************************************/
308:                      void           DmaChnSetDstAdd(DmaChannel chn, void* vDstAdd);
309:                 
310:                     /*********************************************************************
311:                      * Function:        void DmaChnSetMatchPattern(DmaChannel chn, int pattern)
312:                      *
313:                      * PreCondition:    chn - valid DMA channel
314:                      *
315:                      * Input:           chn     - DMA channel number
316:                      *                  pattern -  the match pattern
317:                      *
318:                      * Output:          None
319:                      *
320:                      * Side Effects:    None
321:                      *
322:                      * Overview:        The function sets the curent match pattern for the selected DMA channel.
323:                      *
324:                      * Note:            None.
325:                      *
326:                      * Example:         DmaChnSetMatchPattern(DMA_CHANNEL3, '\r');
327:                      ********************************************************************/
328:                      void           DmaChnSetMatchPattern(DmaChannel chn, int pattern);
329:                 
330:                     /*********************************************************************
331:                      * Function:        int DmaChnGetMatchPattern(DmaChannel chn)
332:                      *
333:                      * PreCondition:    chn - valid DMA channel
334:                      *
335:                      * Input:           chn     - DMA channel number
336:                      *
337:                      * Output:          The channel match pattern.
338:                      *
339:                      * Side Effects:    None
340:                      *
341:                      * Overview:        The function retrieves the curent match pattern for the selected DMA channel.
342:                      *
343:                      * Note:            None.
344:                      *
345:                      * Example:         int pattern=DmaChnGetMatchPattern(DMA_CHANNEL3);
346:                      ********************************************************************/
347:                      int            DmaChnGetMatchPattern(DmaChannel chn);
348:                 
349:                     /*********************************************************************
350:                      * Function:        DmaTxferRes DmaChnStartTxfer(DmaChannel chn, DmaWaitMode wMode, unsigned long retries)
351:                      *
352:                      * PreCondition:    chn - valid DMA channel
353:                      *
354:                      * Input:           chn     - DMA channel number
355:                      *                  wMode   - if DMA_WAIT_NOT, return immediately
356:                      *                          - if DMA_WAIT_CELL, return after the cell transfer complete
357:                      *                          - if DMA_WAIT_BLOCK, return after the whole transfer is done
358:                      *                  retries - retry counter: if transfer not complete after so many retries, return with tmo.
359:                      *                              If 0, wait forever.
360:                      *
361:                      * Output:          DMA_TXFER_OK if not waiting for the transfer completion or if the transfer ended normally,
362:                      *                  an DmaTxferRes error code  otherwise
363:                      *
364:                      * Side Effects:    None
365:                      *
366:                      * Overview:        The function initiates (forces) a DMA transfer for the selected DMA channel.
367:                      *                  The DMA channel is enabled.
368:                      *                  If waiting for the transfer completion needed (user doesn't use an ISR to catch
369:                      *                  this event) the function will periodically query the DMA controller for the
370:                      *                  transfer completion status.
371:                      *                  If DMA_WAIT_BLOCK is specified and multiple cell transfers are needed to complete
372:                      *                  the block transfer than the function will re-force the transfer for each cell.
373:                      *
374:                      * Note:            This function can not ne used when the DMA channel is triggerred
375:                      *                  by hardware interrupt requests.
376:                      *                  This is because the transfers are software forced, theere is no
377:                      *                  wait for the occurrence of the hardware trigger.
378:                      *
379:                      * Example:         DmaChnStartTxfer(DMA_CHANNEL2, DMA_WAIT_BLOCK, 0);
380:                      ********************************************************************/
381:                      DmaTxferRes DmaChnStartTxfer(DmaChannel chn, DmaWaitMode wMode, unsigned long retries);
382:                 
383:                     /*********************************************************************
384:                      * Function:        void DmaChnForceTxfer(DmaChannel chn)
385:                      *
386:                      * PreCondition:    chn - valid DMA channel
387:                      *
388:                      * Input:           chn     - DMA channel number
389:                      *
390:                      * Output:          None
391:                      *
392:                      * Side Effects:    None
393:                      *
394:                      * Overview:        The function forces a DMA transfer to occur for the selected DMA channel.
395:                      *
396:                      * Note:            None.
397:                      *
398:                      * Example:         DmaChnForceTxfer(DMA_CHANNEL3);
399:                      ********************************************************************/
400:                      void           DmaChnForceTxfer(DmaChannel chn);
401:                 
402:                     /*********************************************************************
403:                      * Function:        void DmaChnAbortTxfer(DmaChannel chn)
404:                      *
405:                      * PreCondition:    chn - valid DMA channel
406:                      *
407:                      * Input:           chn     - DMA channel number
408:                      *
409:                      * Output:          None
410:                      *
411:                      * Side Effects:    None
412:                      *
413:                      * Overview:        The function aborts a current undergoing DMA transfer for the selected DMA channel.
414:                      *
415:                      * Note:            None.
416:                      *
417:                      * Example:         DmaChnAbortTxfer(DMA_CHANNEL3);
418:                      ********************************************************************/
419:                      void           DmaChnAbortTxfer(DmaChannel chn);
420:                 
421:                     // High level channel event and interrupt control functions
422:                 
423:                     /*********************************************************************
424:                      * Function:        void DmaChnSetEvEnableFlags(DmaChannel chn, DmaEvFlags eFlags)
425:                      *
426:                      * PreCondition:    chn - valid DMA channel
427:                      *
428:                      * Input:           chn     - DMA channel number
429:                      *                  eFlags  - event flags with the following significance:
430:                      *                              - DMA_EV_ERR: address error event
431:                      *                              - DMA_EV_ABORT: transfer abort event
432:                      *                              - DMA_EV_CELL_DONE: cell transfer complete event
433:                      *                              - DMA_EV_BLOCK_DONE: block transfer complete event
434:                      *                              - DMA_EV_DST_HALF: destination half event
435:                      *                              - DMA_EV_DST_FULL: destination full event
436:                      *                              - DMA_EV_SRC_HALF: source half event
437:                      *                              - DMA_EV_SRC_FULL: source full event
438:                      *                              - DMA_EV_ALL_EVNTS: all of the above flags
439:                      *
440:                      * Output:          None
441:                      *
442:                      * Side Effects:    None
443:                      *
444:                      * Overview:        The function sets the event enable flags for the selected DMA channel.
445:                      *                  Multiple flags can be orr-ed together. Any flag that is set in the eFlags will be
446:                      *                  enabled for the selected channel, the other channel event flags won't be touched.
447:                      *
448:                      * Note:            None.
449:                      *
450:                      * Example:         DmaChnSetEvEnableFlags(DMA_CHANNEL3, DMA_EV_ERR|DMA_EV_ABORT|DMA_EV_BLOCK_DONE|DMA_EV_SRC_FULL);
451:                      ********************************************************************/
452:                      void           DmaChnSetEvEnableFlags(DmaChannel chn, DmaEvFlags eFlags);
453:                 
454:                     /*********************************************************************
455:                      * Function:        void DmaChnClrEvEnableFlags(DmaChannel chn, DmaEvFlags eFlags)
456:                      *
457:                      * PreCondition:    chn - valid DMA channel
458:                      *
459:                      * Input:           chn     - DMA channel number
460:                      *                  eFlags  - event flags with the following significance:
461:                      *                              - DMA_EV_ERR: address error event
462:                      *                              - DMA_EV_ABORT: transfer abort event
463:                      *                              - DMA_EV_CELL_DONE: cell transfer complete event
464:                      *                              - DMA_EV_BLOCK_DONE: block transfer complete event
465:                      *                              - DMA_EV_DST_HALF: destination half event
466:                      *                              - DMA_EV_DST_FULL: destination full event
467:                      *                              - DMA_EV_SRC_HALF: source half event
468:                      *                              - DMA_EV_SRC_FULL: source full event
469:                      *                              - DMA_EV_ALL_EVNTS: all of the above flags
470:                      *
471:                      * Output:          None
472:                      *
473:                      * Side Effects:    None
474:                      *
475:                      * Overview:        The function clears the event enable flags for the selected DMA channel.
476:                      *                  Multiple flags can be orr-ed together. Any flag that is set in the eFlags will be
477:                      *                  disabled for the selected channel, the other channel event flags won't be touched.
478:                      *
479:                      * Note:            None.
480:                      *
481:                      * Example:         DmaChnClrEvEnableFlags(DMA_CHANNEL3, DMA_EV_ERR|DMA_EV_ABORT|DMA_EV_BLOCK_DONE|DMA_EV_SRC_FULL);
482:                      ********************************************************************/
483:                      void           DmaChnClrEvEnableFlags(DmaChannel chn, DmaEvFlags eFlags);
484:                 
485:                     /*********************************************************************
486:                      * Function:        void DmaChnWriteEvEnableFlags(DmaChannel chn, DmaEvFlags eFlags)
487:                      *
488:                      * PreCondition:    chn - valid DMA channel
489:                      *
490:                      * Input:           chn     - DMA channel number
491:                      *                  eFlags  - event flags with the following significance:
492:                      *                              - DMA_EV_ERR: address error event
493:                      *                              - DMA_EV_ABORT: transfer abort event
494:                      *                              - DMA_EV_CELL_DONE: cell transfer complete event
495:                      *                              - DMA_EV_BLOCK_DONE: block transfer complete event
496:                      *                              - DMA_EV_DST_HALF: destination half event
497:                      *                              - DMA_EV_DST_FULL: destination full event
498:                      *                              - DMA_EV_SRC_HALF: source half event
499:                      *                              - DMA_EV_SRC_FULL: source full event
500:                      *                              - DMA_EV_ALL_EVNTS: all of the above flags
501:                      *
502:                      * Output:          None
503:                      *
504:                      * Side Effects:    None
505:                      *
506:                      * Overview:        The function sets the event enable flags for the selected DMA channel.
507:                      *                  The channel event flags are forced to the eFlags value.
508:                      *
509:                      * Note:            None.
510:                      *
511:                      * Example:         DmaChnWriteEvEnableFlags(DMA_CHANNEL3, DMA_EV_ALL_EVNTS);
512:                      ********************************************************************/
513:                      void           DmaChnWriteEvEnableFlags(DmaChannel chn, DmaEvFlags eFlags);
514:                 
515:                     /*********************************************************************
516:                      * Function:        DmaEvFlags DmaChnGetEvEnableFlags(DmaChannel chn)
517:                      *
518:                      * PreCondition:    chn - valid DMA channel
519:                      *
520:                      * Input:           chn     - DMA channel number
521:                      *
522:                      * Output:          - event flags with the following significance:
523:                      *                      - DMA_EV_ERR: address error event
524:                      *                      - DMA_EV_ABORT: transfer abort event
525:                      *                      - DMA_EV_CELL_DONE: cell transfer complete event
526:                      *                      - DMA_EV_BLOCK_DONE: block transfer complete event
527:                      *                      - DMA_EV_DST_HALF: destination half event
528:                      *                      - DMA_EV_DST_FULL: destination full event
529:                      *                      - DMA_EV_SRC_HALF: source half event
530:                      *                      - DMA_EV_SRC_FULL: source full event
531:                      *                      - DMA_EV_ALL_EVNTS: all of the above flags
532:                      *
533:                      * Side Effects:    None
534:                      *
535:                      * Overview:        The function returns the event enabled flags for the selected DMA channel.
536:                      *
537:                      * Note:            None.
538:                      *
539:                      * Example:         DmaEvFlags enabledFlags=DmaChnGetEvEnableFlags(DMA_CHANNEL3);
540:                      ********************************************************************/
541:                      DmaEvFlags DmaChnGetEvEnableFlags(DmaChannel chn);
542:                 
543:                     /*********************************************************************
544:                      * Function:        void DmaChnClrEvFlags(DmaChannel chn, DmaEvFlags eFlags)
545:                      *
546:                      * PreCondition:    chn - valid DMA channel
547:                      *
548:                      * Input:           chn     - DMA channel number
549:                      *                  eFlags  - event flags with the following significance:
550:                      *                              - DMA_EV_ERR: address error event
551:                      *                              - DMA_EV_ABORT: transfer abort event
552:                      *                              - DMA_EV_CELL_DONE: cell transfer complete event
553:                      *                              - DMA_EV_BLOCK_DONE: block transfer complete event
554:                      *                              - DMA_EV_DST_HALF: destination half event
555:                      *                              - DMA_EV_DST_FULL: destination full event
556:                      *                              - DMA_EV_SRC_HALF: source half event
557:                      *                              - DMA_EV_SRC_FULL: source full event
558:                      *                              - DMA_EV_ALL_EVNTS: all of the above flags
559:                      *
560:                      * Output:          None
561:                      *
562:                      * Side Effects:    None
563:                      *
564:                      * Overview:        The function clears the event flags for the selected DMA channel.
565:                      *                  Multiple flags can be orr-ed together. Any flag that is set in the eFlags will be
566:                      *                  cleared for the selected channel, the other channel event flags won't be touched.
567:                      *
568:                      * Note:            None.
569:                      *
570:                      * Example:         DmaChnClrEvFlags(DMA_CHANNEL3, DMA_EV_ALL_EVNTS);
571:                      ********************************************************************/
572:                      void           DmaChnClrEvFlags(DmaChannel chn, DmaEvFlags eFlags);
573:                 
574:                     /*********************************************************************
575:                      * Function:        DmaEvFlags DmaChnGetEvFlags(DmaChannel chn)
576:                      *
577:                      * PreCondition:    chn - valid DMA channel
578:                      *
579:                      * Input:           chn     - DMA channel number
580:                      *
581:                      * Output:          event flags with the following significance:
582:                      *                      - DMA_EV_ERR: address error event
583:                      *                      - DMA_EV_ABORT: transfer abort event
584:                      *                      - DMA_EV_CELL_DONE: cell transfer complete event
585:                      *                      - DMA_EV_BLOCK_DONE: block transfer complete event
586:                      *                      - DMA_EV_DST_HALF: destination half event
587:                      *                      - DMA_EV_DST_FULL: destination full event
588:                      *                      - DMA_EV_SRC_HALF: source half event
589:                      *                      - DMA_EV_SRC_FULL: source full event
590:                      *                      - DMA_EV_ALL_EVNTS: all of the above flags
591:                      *
592:                      * Side Effects:    None
593:                      *
594:                      * Overview:        The function returns the event flags for the selected DMA channel.
595:                      *
596:                      * Note:            None.
597:                      *
598:                      * Example:         DmaEvFlags intSetFlags=DmaChnGetEvFlags(DMA_CHANNEL3);
599:                      ********************************************************************/
600:                      DmaEvFlags DmaChnGetEvFlags(DmaChannel chn);
601:                 
602:                 
603:                     // high level helpers for fast strcpy/memcpy transfers
604:                 
605:                     /*********************************************************************
606:                      * Function:        DmaTxferRes DmaChnMemcpy(void* s1, const void* s2, int n, DmaChannel chn, DmaChannelPri chPri)
607:                      *
608:                      * PreCondition:    chn     - a valid DMA channel
609:                      *                  s1, s2  - valid memory pointers
610:                      *                  n>0, n<=DmaGetMaxTxferSize()
611:                      *
612:                      * Input:           s1      - destination pointer
613:                      *                  s2      - source pointer
614:                      *                  n       - number of bytes to transfer
615:                      *                  chn     - the DMA channel to perform the transfer
616:                      *                  chPri   - the desired channel priority
617:                      *
618:                      * Output:          DMA_TXFER_OK if the transfer ended normally,
619:                      *                  an DmaTxferRes error code  otherwise
620:                      *
621:                      * Side Effects:    None
622:                      *
623:                      * Overview:        The function configures a DMA channel for a fast memory transfer.
624:                      *          Then it copies one block of memory from source to destination.
625:                      *
626:                      *
627:                      * Note:            - If the SFM is attached to the submitted channel, the SFM append mode will be turned off.
628:                      *                    This way, the transfer will occur correctly together with checksum calculation.
629:                      *                  - The start and abort Irqs will be disabled and the channel event enable flags are disabled.
630:                      *                  - Multiple channels could be opened to perform fast memory transfers, if necessary.
631:                      *                  - The function clears the suspend state and resumes the operation of the DMA controller.
632:                      *                  - The source to destination byte re-ordering is affected by DmaSfmConfigure(), DmaSfmTxferReorder().
633:                      *
634:                      * Example:     res=DmaChnMemcpy(pDst, pSrc, buffSz, DMA_CHANNEL0, DMA_CHN_PRI3);
635:                      ********************************************************************/
636:                      DmaTxferRes    DmaChnMemcpy(void* s1, const void* s2, int n, DmaChannel chn, DmaChannelPri chPri);
637:                 
638:                     /*********************************************************************
639:                      * Function:        DmaTxferRes DmaChnStrcpy(char* s1, const char* s2, DmaChannel chn, DmaChannelPri chPri)
640:                      *
641:                      * PreCondition:    chn     - a valid DMA channel
642:                      *                  s1, s2  - valid memory pointers
643:                      *
644:                      * Input:           s1      - destination pointer
645:                      *                  s2      - source pointer
646:                      *                  chn     - the DMA channel to perform the transfer
647:                      *                  chPri   - the desired channel priority
648:                      *
649:                      * Output:          DMA_TXFER_OK if the transfer ended normally,
650:                      *                  an DmaTxferRes error code  otherwise
651:                      *
652:                      * Side Effects:    None
653:                      *
654:                      * Overview:        The function configures a DMA channel for a fast memory transfer.
655:                      *          Then it copies one zero terminated string from source to destination.
656:                      *
657:                      *
658:                      * Note:            - If the SFM is attached to the submitted channel, the SFM append mode will be turned off.
659:                      *                    This way, the transfer will occur correctly together with checksum calculation.
660:                      *                  - The start and abort Irqs will be disabled and the channel event enable flags are disabled.
661:                      *                  - Multiple channels could be opened to perform fast memory transfers, if necessary.
662:                      *                  - The function clears the suspend state and resumes the operation of the DMA controller.
663:                      *                  - The source to destination byte re-ordering is affected by DmaSfmConfigure(), DmaSfmTxferReorder().
664:                      *
665:                      *
666:                      * Example:     res=DmaChnStrcpy(str1, str2, DMA_CHANNEL1, DMA_CHN_PRI3);
667:                      *********************************************************************/
668:                      DmaTxferRes    DmaChnStrcpy(char* s1, const char* s2, DmaChannel chn, DmaChannelPri chPri);
669:                 
670:                     /*********************************************************************
671:                      * Function:        DmaTxferRes DmaChnStrncpy(char* s1, const char* s2, int n, DmaChannel chn, DmaChannelPri chPri)
672:                      *
673:                      * PreCondition:    chn     - a valid DMA channel
674:                      *              - s1, s2    - valid memory pointers
675:                      *                              - 0 < n <= DmaGetMaxTxferSize()
676:                      *
677:                      * Input:           s1      - destination pointer
678:                      *                  s2      - source pointer
679:                      *                  n   - max number of bytes to transfer
680:                      *                  chn     - the DMA channel to perform the transfer
681:                      *                  chPri   - the desired channel priority
682:                      *
683:                      * Output:          DMA_TXFER_OK if the transfer ended normally,
684:                      *                  an DmaTxferRes error code  otherwise
685:                      *
686:                      * Side Effects:    None
687:                      *
688:                      * Overview:        The function configures a DMA channel for a fast memory transfer.
689:                      *          Then it copies one zero terminated string from source to destination.
690:                      *          It copies no more than n characters from s2.
691:                      *
692:                      *
693:                      * Note:            - If the SFM is attached to the submitted channel, the SFM append mode will be turned off.
694:                      *                    This way, the transfer will occur correctly together with checksum calculation.
695:                      *                  - The start and abort Irqs will be disabled and the channel event enable flags are disabled.
696:                      *                  - Multiple channels could be opened to perform fast memory transfers, if necessary.
697:                      *                  - The function clears the suspend state and resumes the operation of the DMA controller.
698:                      *                  - The source to destination byte re-ordering is affected by DmaSfmConfigure(), DmaSfmTxferReorder().
699:                      *
700:                      *
701:                      * Example:     res=DmaChnStrncpy(str1, str2, MAX_STR_LEN, DMA_CHANNEL1, DMA_CHN_PRI3);
702:                      ********************************************************************/
703:                      DmaTxferRes DmaChnStrncpy(char* s1, const char* s2, int n, DmaChannel chn, DmaChannelPri chPri);
704:                 
705:                     /*********************************************************************
706:                      * Function:        DmaTxferRes DmaChnMemCrc(void* d, const void* s, int n, DmaChannel chn, DmaChannelPri chPri)
707:                      *
708:                      * PreCondition:    chn    - a valid DMA channel
709:                      *                  d, s   - valid memory pointer
710:                      *                  n>0, n<=DmaGetMaxTxferSize()
711:                      *
712:                      * Input:           d     - address where to deposit the result
713:                      *                  s     - source buffer pointer
714:                      *                  n     - number of bytes in the pointer
715:                      *                  chn   - the DMA channel to use
716:                      *                  chPri - the desired channel priority
717:                      *
718:                      * Output:          DMA_TXFER_OK if the transfer ended normally,
719:                      *                  an DmaTxferRes error code  otherwise
720:                      *
721:                      * Side Effects:    None
722:                      *
723:                      * Overview:        The function is a helper that calculates the CRC of a memory block.
724:                      *                  The function configures the DMA channel for a fast memory transfer and calculates the CRC.
725:                      *
726:                      *
727:                      * Note:            - The CRC generator must have been previously configured using DmaSfmCrcConfigure()
728:                      *                  - No transfer is done, just the CRC is calculated.
729:                      *                  - The start and abort Irqs will be disabled and the channel event enable flags are disabled.
730:                      *                  - Append mode is enabled and the data transfer re-ordering is disabled (illegal combination, see DmaSfmTxferReorder()).
731:                      *                  - The checksum type is switched to CRC.
732:                      *                  - The way the data is fed into the checksum calculation block is affected by DmaSfmConfigure().
733:                      *
734:                      * Example:          int myCrc; DmaChnMemCrc(&myCrc, srcBuff, sizeof(srcBuff), DMA_CHANNEL2, DMA_CHN_PRI3);
735:                      ********************************************************************/
736:                      DmaTxferRes    DmaChnMemCrc(void* d, const void* s, int n, DmaChannel chn, DmaChannelPri chPri);
737:                 
738:                     /*********************************************************************
739:                      * Function:        DmaTxferRes DmaChnMemChecksum(void* d, const void* s, int n, DmaChannel chn, DmaChannelPri chPri)
740:                      *
741:                      * PreCondition:    chn    - a valid DMA channel
742:                      *                  d, s   - valid memory pointer
743:                      *                  n>0, n<=DmaGetMaxTxferSize()
744:                      *
745:                      * Input:           d     - address where to deposit the result
746:                      *                  s     - source buffer pointer
747:                      *                  n     - number of bytes in the pointer
748:                      *                  chn   - the DMA channel to use
749:                      *                  chPri - the desired channel priority
750:                      *
751:                      * Output:          DMA_TXFER_OK if the transfer ended normally,
752:                      *                  an DmaTxferRes error code  otherwise
753:                      *
754:                      * Side Effects:    None
755:                      *
756:                      * Overview:        The function is a helper that calculates the IP checksum of a memory block.
757:                      *                  The function configures the DMA channel for a fast memory transfer and calculates the IP checksum.
758:                      *
759:                      *
760:                      * Note:            - The checksum generator must have been previously seeded using DmaSfmSetSeed()
761:                      *                  - No transfer is done, just the checksum is calculated.
762:                      *                  - The start and abort Irqs will be disabled and the channel event enable flags are disabled.
763:                      *                  - Append mode is enabled and the data transfer re-ordering is disabled (illegal combination, see DmaSfmTxferReorder()).
764:                      *                  - The checksum type is switched to IP checksum.
765:                      *                  - The way the data is fed into the checksum calculation block is affected by DmaSfmConfigure().
766:                      *
767:                      * Example:          int myChecksum; DmaChnMemChecksum(&myChecksum, srcBuff, sizeof(srcBuff), DMA_CHANNEL1, DMA_CHN_PRI3);
768:                      ********************************************************************/
769:                      DmaTxferRes    DmaChnMemChecksum(void* d, const void* s, int n, DmaChannel chn, DmaChannelPri chPri);
770:                 
771:                     // High level Special Function Module (SFM) functions
772:                 
773:                     /*********************************************************************
774:                      * Function:        void DmaSfmConfigure(DmaChksumType cType, DmaBitOrder bitO, DmaReorderMode rMode)
775:                      *
776:                      * PreCondition:    cType, bitO, rMode - valid values
777:                      *
778:                      * Input:           cType - checksum type to be calculated: CRC or IP Checksum
779:                      *                  bitO  - the bit order to be used MSb or LSb first
780:                      *                  rMode - the reordering mode of the bytes when calculating the checksum
781:                      *
782:                      * Output:          None
783:                      *
784:                      * Side Effects:    Whenever the Transfer re-ordering is enabled the rMode setting will influence the destination data layout
785:                      *
786:                      * Overview:        The function configures the SFM module by setting the parameters that define the behavior:
787:                      *                      - the type of the checksum to be calculated (either CRC or IP checksum are supported)
788:                      *                      - the bit ordering (how a specific byte is used in the checksum calculation: MSb or LSb first)
789:                      *                      - the data re-ordering (how bytes are re-ordered before calculating the checksum).
790:                      *                      All these values affect the way the checksum is calculated.
791:                      *
792:                      * Note:            None
793:                      *
794:                      * Example:         DmaSfmConfigure(DMA_CHKSUM_CRC, DMA_BITO_LSb, DMA_REORDER_ENDIAN);
795:                      ********************************************************************/
796:                     extern __inline__ void __attribute__((always_inline)) DmaSfmConfigure(DmaChksumType cType, DmaBitOrder bitO, DmaReorderMode rMode)
797:                     {
798:                         DCRCCONCLR=_DCRCCON_CRCTYP_MASK|_DCRCCON_BITO_MASK|_DCRCCON_BYTO_MASK;
799:                         DCRCCONSET=(cType<<_DCRCCON_CRCTYP_POSITION)|(bitO<<_DCRCCON_BITO_POSITION)|(rMode<<_DCRCCON_BYTO_POSITION);
800:                     }
801:                 
802:                     /*********************************************************************
803:                      * Function:        void DmaSfmTxferReorder(int enable)
804:                      *
805:                      * PreCondition:    None
806:                      *
807:                      * Input:           enable - boolean to enable/disable the re-ordering of the data transfer
808:                      *
809:                      * Output:          None
810:                      *
811:                      * Side Effects:    None
812:                      *
813:                      * Overview:        The function configures the data transfer re-ordering of the SFM module.
814:                      *                  If the re-ordering is enabled, the data is read from the source, re-ordered accordingly and then written to the destination.
815:                      *                  Otherwise the data is written to the destination un-modified.
816:                      *                  The re-ordering is the one specified by the DmaReorderMode parameter in the DmaSfmConfigure() call.
817:                      *
818:                      *
819:                      * Note:            - The data transfer re-ordering should be used only for normal (background mode) data transfers.
820:                      *                  - In append mode the data transfer re-ordering should not be enabled (undefined behavior)!
821:                      *                  - Whenever the data re-ordering is enabled, the transfer should be aligned at both ends (source and destination).
822:                      *                    Un-aligned transfers are not supported (undefined behavior)!
823:                      *
824:                      * Example:         DmaSfmTxferReorder();
825:                      ********************************************************************/
826:                     extern __inline__ void __attribute__((always_inline)) DmaSfmTxferReorder(int enable)
827:                     {
828:                         DCRCCONCLR=_DCRCCON_WBO_MASK;
829:                         DCRCCONSET=(enable<<_DCRCCON_WBO_POSITION);
830:                     }
831:                 
832:                 
833:                      /*********************************************************************
834:                      * Function:        void DmaSfmCrcConfigure(unsigned int polynomial, int pLen, unsigned int seed)
835:                      *
836:                      * PreCondition:    pLen   - valid polynomial length within 1-32
837:                      *
838:                      * Input:           polynomial  - the layout of the CRC generator
839:                      *                  pLen        - the length of the CRC generator polynomial
840:                      *                  seed        - the initial seed of the CRC generator
841:                      *
842:                      * Output:          None
843:                      *
844:                      * Side Effects:    None
845:                      *
846:                      * Overview:        The function configures the SFM CRC module by setting the parameters that define the generator polynomial:
847:                      *                  - the length of the CRC generator polynomial, pLen;
848:                      *                  - the function sets the layout of the shift stages that take place in the CRC generation.
849:                      *                    Setting a bit to 1 enables the XOR input from the MSb (pLen bit) to the selected stage in the shift register.
850:                      *                    If bit is cleared, the selected shift stage gets data directly from the previous stage in the shift register.
851:                      *                    Note that in a proper CRC polynomial, both the most significant bit (MSb) and least significant bit(LSb)
852:                      *                    are always a '1'. Considering the generator polynomial: X^16+X^15+X^2+1, the value to be written as
853:                      *                    feedback should be 0x8005, or 0x8004, but not 0x018005;
854:                      *                  - the function sets the seed of the CRC generator. This is the initial data present in the
855:                      *                   CRC shift register before the CRC calculation begins. A good initial value is usually 0xffffffff.
856:                      *
857:                      * Note:            - Bit 0 of the generator polynomial is always XOR'ed.
858:                      *                  - When the append mode is set, the attached DMA channel has to have destination size <=4.
859:                      *                    Upon the transfer completion the calculated CRC is stored at the destination address.
860:                      *                  - When append mode is cleared, the DMA transfer occurs normally, and the CRC value is available using
861:                      *                    the CrcResult() function.
862:                      *                  - The CRC module should be configured before enabled.
863:                      *                  - These settings are relevant only when the SFM is configured for the CRC type of checksum.
864:                      *                  - The checksum register is the same for CRC or IP checksum mode. Therefore, this function changes also the seed for the IP checksum.
865:                      *                  - The way the data is fed into the checksum calculation block and the type of the checksum performed is affected by DmaSfmConfigure().
866:                      *
867:                      * Example:         DmaSfmCrcConfigure(0x04c11db7, 32, 0xffffffff);
868:                      ********************************************************************/
869:                     extern __inline__ void __attribute__((always_inline)) DmaSfmCrcConfigure(unsigned int polynomial, int pLen, unsigned int seed)
870:                     {
871:                         DCRCCONCLR=_DCRCCON_PLEN_MASK;
872:                         DCRCCONSET=(pLen-1)<<_DCRCCON_PLEN_POSITION;
873:                         DCRCDATA=seed;
874:                         DCRCXOR=polynomial;
875:                     }
876:                 
877:                     #define DmaCrcConfigure DmaSfmCrcConfigure  // PIC32_3xx backward compatibility name
878:                 
879:                 
880:                     /*********************************************************************
881:                      * Function:        void DmaSfmAttachChannel(DmaChannel chn, int appendMode)
882:                      *
883:                      * PreCondition:    chn    - valid DMA channel
884:                      *
885:                      * Input:           chn         - the DMA channel to be attached to the checksum module.
886:                      *                  appendMode  - if TRUE the data passed to the checksum generator is not transferred to destination
887:                      *                                but it's written to the destination address when the block transfer is complete.
888:                      *                              - if FALSE the data is transferred normally while the checksum is calculated.
889:                      *                                The checksum will be available using the DmaSfmChecksum function.
890:                      *
891:                      * Output:          None
892:                      *
893:                      * Side Effects:    None
894:                      *
895:                      * Overview:        The function attaches the SFM checksum module to a DMA channel and enables the checksum generator.
896:                      *                  From now on, all the DMA traffic is directed to the SFM checksum generator. Once the DMA block transfer
897:                      *                  is complete, the checksum result is available in the checksum data register.
898:                      *                  If append mode is enabled, no data transfer takes place but the checksum result will be deposited at the DMA destination address.
899:                 
900:                      *
901:                      * Note:            If append mode is enabled the data transfer re-ordering is disabled (illegal combination, see DmaSfmTxferReorder()).
902:                      *
903:                      * Example:         DmaSfmAttachChannel(DMA_CHANNEL0, TRUE);
904:                      ********************************************************************/
905:                     void            DmaSfmAttachChannel(DmaChannel chn, int appendMode);
906:                     #define         CrcAttachChannel    DmaSfmAttachChannel     // PIC32_3xx backward compatibility name
907:                 
908:                     /*********************************************************************
909:                      * Function:        unsigned int DmaSfmChecksum(void)
910:                      *
911:                      * PreCondition:    None
912:                      *
913:                      * Input:           None
914:                      *
915:                      * Output:          the current value of the checksum generator.
916:                      *
917:                      * Side Effects:    None
918:                      *
919:                      * Overview:        The function returns the calculated checksum value.
920:                      *
921:                      * Note:            - The function returns the valid checksum result. The masking out the unused MSbits in the checksum register is done by the hardware.
922:                      *                  - The way the data is fed into the checksum calculation block and the type of the checksum performed is affected by DmaSfmConfigure().
923:                      *
924:                      * Example:         unsigned int myChk=DmaSfmChecksum();
925:                      ********************************************************************/
926:                     extern __inline__ int __attribute__((always_inline)) DmaSfmChecksum(void)
927:                     {
928:                         return DCRCDATA;
929:                     }
930:                     #define     CrcResult   DmaSfmChecksum      // PIC32_3xx backward compatibility name
931:                     #define     DmaCrcGetValue  DmaSfmChecksum      // PIC32_3xx backward compatibility name
932:                 
933:                 
934:                     /*********************************************************************
935:                      * Function:        void DmaSfmSetSeed(unsigned int seed)
936:                      *
937:                      * PreCondition:    None
938:                      *
939:                      * Input:           seed    - the initial seed of the checksum generator
940:                      *
941:                      * Output:          None
942:                      *
943:                      * Side Effects:    None
944:                      *
945:                      * Overview:        The function sets the seed of the checksum generator. This is the initial data present in the
946:                      *                  CRC shift register or the IP checksum calculator before the actual transfer/calculation begins.
947:                      *
948:                      * Note:            When the SFM is configured for IP checksum mode, only the least significant 16 bits are relevant.
949:                      *
950:                      * Example:         DmaSfmSetSeed(0xffffffff);
951:                      ********************************************************************/
952:                     extern __inline__ void __attribute__((always_inline)) DmaSfmSetSeed(unsigned int seed)
953:                     {
954:                         DCRCDATA=seed;
955:                     }
956:                     #define     DmaCrcSetSeed   DmaSfmSetSeed       // PIC32_3xx backward compatibility name
957:                 
958:                 
959:                 /*********************  end of high level functions ****************************************/
960:                 
961:                     // low level definitions for the API functions
962:                 
963:                 
964:                     typedef struct
965:                     {
966:                         union
967:                         {
968:                             struct
969:                             {
970:                                 unsigned int chn:   3;      // last active DMA channel
971:                                 unsigned int rdOp:  1;      // last DMA operation, read if 1, write if 0
972:                             };
973:                             unsigned int    w;                      // word access
974:                         }lastAccess;
975:                         void*   lastAddress;        // most recent DMA address
976:                     }DmaStatus;         // DMA controller status
977:                 
978:                     typedef enum
979:                     {
980:                         DMA_GFLG_SUSPEND =  _DMACON_SUSPEND_MASK,   // suspend DMA controller operation
981:                         DMA_GFLG_ON =       _DMACON_ON_MASK,        // DMA module enabled/desabled
982:                         //
983:                         DMA_GFLG_ALL_FLAGS= DMA_GFLG_SUSPEND|DMA_GFLG_ON        // all flags
984:                     }DmaGlblFlags;  // flags for controlling global DMA controller behavior. From processor header file.
985:                 
986:                 
987:                 
988:                 
989:                     typedef enum
990:                     {
991:                         DMA_EV_ABORT_IRQ_EN =       _DCH0ECON_AIRQEN_MASK,
992:                         DMA_EV_START_IRQ_EN =       _DCH0ECON_SIRQEN_MASK,
993:                         // use DMA_EV_START_IRQ() and DMA_EV_ABORT_IRQ() below for selecting
994:                         // the start and abort IRQ signals
995:                         DMA_EV_MATCH_EN =           _DCH0ECON_PATEN_MASK,
996:                 
997:                 
998:                         // compiler use only field
999:                         _DMA_EV_MAX_MASK =     _DCH0ECON_CHAIRQ_MASK,
1000:                    }DmaEvCtrlFlags;    // DMA channel event control fields accessibile as flags
1001:                    // also part of DmaEvCtrlFlags:
1002:                    #define DMA_EV_START_IRQ(irq)   (DMA_EV_START_IRQ_EN | ((irq)<<_DCH0ECON_CHSIRQ_POSITION))  // NOTE: irq has to be a symbol from the processor header file
1003:                    #define DMA_EV_ABORT_IRQ(irq)   (DMA_EV_ABORT_IRQ_EN | ((irq)<<_DCH0ECON_CHAIRQ_POSITION))  // NOTE: irq has to be a symbol from the processor header file
1004:                
1005:                    // DMA channel event control as a structure:
1006:                    #define DmaEvCtrl   __DCH0ECONbits_t
1007:                
1008:                
1009:                
1010:                
1011:                    typedef enum
1012:                    {
1013:                        DMA_CTL_AUTO_EN =       _DCH0CON_CHAEN_MASK,
1014:                        DMA_CTL_CHAIN_EN =      _DCH0CON_CHCHN_MASK,
1015:                        DMA_CTL_DET_EN =        _DCH0CON_CHAED_MASK,
1016:                        DMA_CTL_CHN_EN =        _DCH0CON_CHEN_MASK,
1017:                        DMA_CTL_CHAIN_DIR =     _DCH0CON_CHCHNS_MASK,
1018:                        // use the DMA_CTL_PRI() below for selecting the DMA
1019:                        // channel priority
1020:                    }DmaChnCtrlFlags;   // controlling the DMA channel with flags
1021:                    // also part of DmaChnCtrlFlags:
1022:                    #define DMA_CTL_PRI(pri)    ((pri)&_DCH0CON_CHPRI_MASK) // DMA Control channel priority
1023:                
1024:                    // DMA channel control as a structure:
1025:                    #define DmaChnCtrl      __DCH0CONbits_t
1026:                
1027:                    typedef struct
1028:                    {
1029:                        void*   vSrcAdd;        // source of the DMA transfer, virtual
1030:                        void*   vDstAdd;        // destination of the DMA transfer, virtual
1031:                        int srcSize;        // source buffer size, 1 to DmaGetMaxTxferSize() bytes. Wrapped around.
1032:                        int dstSize;        // destination buffer size, 1 to DmaGetMaxTxferSize() bytes. Wrapped around.
1033:                        int cellSize;       // no of bytes txferred per event, 1 to DmaGetMaxTxferSize().
1034:                    }DmaTxferCtrl;      // transfer setting: the transfer source, destination addresses and size, cell size
1035:                
1036:                
1037:                    /********************** low level DMA channel functions *******************************/
1038:                
1039:                
1040:                
1041:                    // Global DMA controller functions
1042:                
1043:                    /*********************************************************************
1044:                     * Function:        void DmaEnable(int enable)
1045:                     *
1046:                     * PreCondition:    None
1047:                     *
1048:                     * Input:           enable - boolean to enable/disable the DMA controller
1049:                     *
1050:                     * Output:          None
1051:                     *
1052:                     * Side Effects:    None
1053:                     *
1054:                     * Overview:       The function enables/disables the DMA controller.
1055:                     *
1056:                     * Note:           None.
1057:                     *
1058:                     * Example:        DmaEnable(1);
1059:                     ********************************************************************/
1060:                    extern __inline__ void __attribute__((always_inline)) DmaEnable(int enable)
1061:                    {
1062:                        if(enable)
1063:                        {
1064:                            DMACONSET=_DMACON_ON_MASK;
1065:                        }
1066:                        else
1067:                        {
1068:                            DMACONCLR=_DMACON_ON_MASK;
1069:                            while(DMACONbits.ON);       // wait to take effect
1070:                        }
1071:                    }
1072:                
1073:                    /*********************************************************************
1074:                     * Function:        void DmaReset(void)
1075:                     *
1076:                     * PreCondition:    None
1077:                     *
1078:                     * Input:       None
1079:                     *
1080:                     * Output:          None
1081:                     *
1082:                     * Side Effects:    None
1083:                     *
1084:                     * Overview:        The function resets the DMA controller.
1085:                     *
1086:                     * Note:            None.
1087:                     *
1088:                     * Example:        DmaReset();
1089:                     ********************************************************************/
1090:                    #define            DmaReset()   DmaEnable(0)
1091:                
1092:                
1093:                    /*********************************************************************
1094:                     * Function:        int DmaSuspend(void)
1095:                     *
1096:                     * PreCondition:    None
1097:                     *
1098:                     * Input:       None
1099:                     *
1100:                     * Output:          true if the DMA was previously suspended, false otherwise
1101:                     *
1102:                     *
1103:                     * Side Effects:    None
1104:                     *
1105:                     * Overview:        The function suspends the DMA controller.
1106:                     *
1107:                     * Note:            After the execution of this function the DMA operation is supposed to be suspended.
1108:                     *                  I.e. the function has to wait for the suspension to take place!
1109:                     *
1110:                     * Example:         int susp=DmaSuspend();
1111:                     ********************************************************************/
1112:                        extern __inline__ int __attribute__((always_inline)) DmaSuspend(void)
1113:                    {
1114:                        int suspSt;
1115:                        if(!(suspSt=DMACONbits.SUSPEND))
9D027408  3C03BF88   LUI V1, -16504
9D0278D4  3C0FBF88   LUI T7, -16504
9D0278D8  8DF03000   LW S0, 12288(T7)
9D0278DC  7E110300   EXT S1, S0, 12, 1
9D0278E0  1620FEDE   BNE S1, ZERO, 0x9D02745C
9D0278E4  24121000   ADDIU S2, ZERO, 4096
1116:                        {
1117:                            DMACONSET=_DMACON_SUSPEND_MASK;     // suspend
9D02741C  24041000   ADDIU A0, ZERO, 4096
9D027444  AF123008   SW S2, 12296(T8)
9D0278E8  0B409D11   J .LBE63, .LBE62, .LBB64, .LBB66
9D0278EC  3C18BF88   LUI T8, -16504
1118:                            while((DMACONbits.DMABUSY));    // wait to be actually suspended
9D027428  3C06BF88   LUI A2, -16504
9D027448  3C19BF88   LUI T9, -16504
9D02744C  8F3F3000   LW RA, 12288(T9)
9D027450  33E30800   ANDI V1, RA, 2048
9D027454  1460FFFD   BNE V1, ZERO, 0x9D02744C
9D027458  00000000   NOP
1119:                        }
1120:                        return suspSt;
1121:                    }
1122:                
1123:                
1124:                
1125:                    /*********************************************************************
1126:                     * Function:        void DmaResume(int susp)
1127:                     *
1128:                     * PreCondition:    None
1129:                     *
1130:                     * Input:       the desired DMA suspended state.
1131:                     *
1132:                     * Output:          None
1133:                     *
1134:                     * Side Effects:    None
1135:                     *
1136:                     * Overview:        The function restores the DMA controller activity to the old suspended mode.
1137:                     *
1138:                     * Note:            None.
1139:                     *
1140:                     * Example:         int isSusp=DmaSuspend(); {....}; DmaResume(isSusp);
1141:                     ********************************************************************/
1142:                        extern __inline__ void __attribute__((always_inline)) DmaResume(int susp)
1143:                    {
1144:                        if(susp)
1145:                        {
1146:                            DmaSuspend();
1147:                        }
1148:                        else
1149:                        {
1150:                            DMACONCLR=_DMACON_SUSPEND_MASK;     // resume DMA activity
9D027884  24121000   ADDIU S2, ZERO, 4096
9D027888  3C18BF88   LUI T8, -16504
9D02788C  AF123004   SW S2, 12292(T8)
9D027890  0B409D17   J 0x9D02745C
9D027894  00000000   NOP
1151:                        }
1152:                    }
1153:                
1154:                    /*********************************************************************
1155:                     * Function:        void DmaGetStatus(DmaStatus* pStat)
1156:                     *
1157:                     * PreCondition:    pStat   - valid pointer
1158:                     *
1159:                     * Input:           pStat   - pointer to a DmaStatus structure to store the current DMA controller
1160:                     *                          status, carrying the following info:
1161:                     *                              - chn:  the last active DMA channel
1162:                     *                              - rdOp: the last DMA operation, read/write
1163:                     *                              - lastAddress: the most recent DMA address
1164:                     *
1165:                     * Output:          None
1166:                     *
1167:                     * Side Effects:    None
1168:                     *
1169:                     * Overview:        The function updates the info for the current DMA controller status.
1170:                     *                  It updates the last DMA: operation, channel used and address.
1171:                     *
1172:                     * Note:            None.
1173:                     *
1174:                     * Example:         DmaStatus stat; DmaGetStatus(&stat);
1175:                     ********************************************************************/
1176:                     void           DmaGetStatus(DmaStatus* pStat);
1177:                
1178:                    /*********************************************************************
1179:                     * Function:        void DmaSetGlobalFlags(DmaGlblFlags gFlags)
1180:                     *
1181:                     * PreCondition:    None
1182:                     *
1183:                     * Input:           gFlags - flags to be set, having the following fields:
1184:                     *          - DMA_GFLG_SUSPEND: DMA controller operation suspend
1185:                     *          - DMA_GFLG_ON: DMA controller enabled/desabled
1186:                     *          - DMA_GFLG_ALL_FLAGS: all flags
1187:                     *
1188:                     * Output:          None
1189:                     *
1190:                     * Side Effects:    None
1191:                     *
1192:                     * Overview:        The function affects the global behavior of the DMA controller.
1193:                     *                  It sets the specified flags. Any flag that is set in the gFlags will be
1194:                     *                  enabled, the other flags won't be touched.
1195:                     *
1196:                     * Note:            None.
1197:                     *
1198:                     * Example:         DmaSetGlobalFlags(DMA_GFLG_ON);
1199:                     ********************************************************************/
1200:                        extern __inline__ void __attribute__((always_inline)) DmaSetGlobalFlags(DmaGlblFlags gFlags)
1201:                    {
1202:                        DMACONSET=gFlags;
1203:                    }
1204:                
1205:                    /*********************************************************************
1206:                     * Function:        void DmaClrGlobalFlags(DmaGlblFlags gFlags)
1207:                     *
1208:                     * PreCondition:    None
1209:                     *
1210:                     * Input:           gFlags - flags to be cleared, having the following fields:
1211:                     *                               - DMA_GFLG_SUSPEND: DMA controller operation suspend
1212:                     *                               - DMA_GFLG_ON: DMA controller enabled/desabled
1213:                     *                               - DMA_GFLG_ALL_FLAGS: all flags
1214:                     *
1215:                     * Output:          None
1216:                     *
1217:                     * Side Effects:    None
1218:                     *
1219:                     * Overview:        The function affects the global behavior of the DMA controller.
1220:                     *                  It clears the specified flags. Any flag that is set in the gFlags will be
1221:                     *                  cleared, the other flags won't be touched.
1222:                     *
1223:                     * Note:            None.
1224:                     *
1225:                     * Example:         DmaClrGlobalFlags(DMA_GFLG_SUSPEND);
1226:                     ********************************************************************/
1227:                        extern __inline__ void __attribute__((always_inline)) DmaClrGlobalFlags(DmaGlblFlags gFlags)
1228:                    {
1229:                        DMACONCLR=gFlags;
1230:                    }
1231:                
1232:                
1233:                    /*********************************************************************
1234:                     * Function:        void DmaWriteGlobalFlags(DmaGlblFlags gFlags)
1235:                     *
1236:                     * PreCondition:    None
1237:                     *
1238:                     * Input:           gFlags - flags to be set, having the following fields:
1239:                     *                                 - DMA_GFLG_SUSPEND: DMA controller operation suspend
1240:                     *                                 - DMA_GFLG_ON: DMA controller enabled/desabled
1241:                     *                                 - DMA_GFLG_ALL_FLAGS: all flags
1242:                     *
1243:                     * Output:          None
1244:                     *
1245:                     * Side Effects:    None
1246:                     *
1247:                     * Overview:        The function affects the global behavior of the DMA controller.
1248:                     *                  It forces the flags to have the specified gFlags value.
1249:                     *
1250:                     * Note:            None.
1251:                     *
1252:                     * Example:         DmaWriteGlobalFlags(DMA_GFLG_ALL_FLAGS);
1253:                     ********************************************************************/
1254:                        extern __inline__ void __attribute__((always_inline)) DmaWriteGlobalFlags(DmaGlblFlags gFlags)
1255:                    {
1256:                        DMACON=gFlags;
1257:                    }
1258:                
1259:                    /*********************************************************************
1260:                     * Function:        DmaGlblFlags DmaGetGlobalFlags(void)
1261:                     *
1262:                     * PreCondition:    None
1263:                     *
1264:                     * Input:           None
1265:                     *
1266:                     * Output:          The current DMA controller flags settings.
1267:                     *                              - DMA_GFLG_SUSPEND: DMA controller operation suspend
1268:                     *                              - DMA_GFLG_ON: DMA controller enabled/desabled
1269:                     *
1270:                     * Side Effects:    None
1271:                     *
1272:                     * Overview:        The function returns the global flags of the DMA controller.
1273:                     *
1274:                     * Note:            None.
1275:                     *
1276:                     * Example:         DmaGlblFlags dmaFlags=DmaGetGlobalFlags();
1277:                     ********************************************************************/
1278:                        extern __inline__ DmaGlblFlags __attribute__((always_inline)) DmaGetGlobalFlags(void)
1279:                    {
1280:                        return (DmaGlblFlags)DMACON;
1281:                    }
1282:                
1283:                
1284:                    /*********************************************************************
1285:                     * Function:        int DmaGetMaxTxferSize(void)
1286:                     *
1287:                     * PreCondition:    None
1288:                     *
1289:                     * Input:           None
1290:                     *
1291:                     * Output:          The maximum transfer capacity for a DMA channel, in bytes.
1292:                     *
1293:                     * Side Effects:    None
1294:                     *
1295:                     * Overview:        The function returns the maximum number of bytes that can be transferred by a DMA channel.
1296:                     *
1297:                     * Note:            Revision dependant.
1298:                     *
1299:                     * Example:         int dmaMaxSz=DmaGetMaxTxferSize();
1300:                     ********************************************************************/
1301:                    extern __inline__ int __attribute__((always_inline)) DmaGetMaxTxferSize(void)
1302:                    {
1303:                        return 65536;
1304:                    }
1305:                
1306:                    // Direct Channel control functions
1307:                
1308:                    typedef enum
1309:                    {
1310:                        DMA_CONFIG_DEFAULT = 0,                             // DMA default operation
1311:                        DMA_CONFIG_AUTO = _DCH0CON_CHAEN_MASK,              // DMA channel is auto enabled
1312:                        DMA_CONFIG_CHAIN_LOW  = (_DCH0CON_CHCHN_MASK|_DCH0CON_CHCHNS_MASK), // DMA channel is chained to lower channel
1313:                        DMA_CONFIG_CHAIN_HI  = (_DCH0CON_CHCHN_MASK),       // DMA channel is chained to higher channel
1314:                        DMA_CONFIG_DET_EN = _DCH0CON_CHAED_MASK,            // events detection enabled while channel off
1315:                        DMA_CONFIG_ENABLE = _DCH0CON_CHEN_MASK,             // DMA channel is enabled after open
1316:                        DMA_CONFIG_MATCH    = 0x80000000,                   // DMA channel stops on match
1317:                    }DmaConfigFlags;    // flags for the channel configuration
1318:                
1319:                
1320:                
1321:                    /*********************************************************************
1322:                     * Function:        void DmaChnConfigure(DmaChannel chn, DmaChannelPri chPri, DmaConfigFlags cFlags)
1323:                     *
1324:                     * PreCondition:    chPri  - valid channel priority, 0-3
1325:                     *
1326:                     * Input:           chn    - channel to be configured in the DMA controller
1327:                     *                  chPri  - the priority given to the channel, 0-3
1328:                     *                  cFlags - orred flags specifying the configuration:
1329:                     *                           DMA_CONFIG_DEFAULT: DMA default operation mode
1330:                     *                           DMA_CONFIG_AUTO:   DMA channel is auto enabled
1331:                     *                           DMA_CONFIG_CHAIN_LOW: DMA channel is chained to lower channel
1332:                     *                           DMA_CONFIG_CHAIN_HI: DMA channel is chained to higher channel
1333:                     *                           DMA_CONFIG_DET_EN: events detection enabled while channel off
1334:                     *                           DMA_CONFIG_ENABLE: DMA channel is enabled when opened
1335:                     *                           DMA_CONFIG_MATCH:  DMA channel stops on match
1336:                     *
1337:                     *
1338:                     *
1339:                     * Output:          None
1340:                     *
1341:                     * Side Effects:    None
1342:                     *
1343:                     * Overview:        The function configures the selected DMA channel using the supplied user flags and priority.
1344:                     *
1345:                     * Note:            - The channel is NOT turned off. It should be turned off before calling this function.
1346:                     *                  The channel is just configured.
1347:                     *                  - After calling this function, the channel should be enabled using DmaChnEnable(chn) call
1348:                     *                  if DMA_CONFIG_ENABLE flag was not specified.
1349:                     *                  - The function does not touch the interrupt flags, interrupt enables, etc.
1350:                     *                  The interrupt flags should have been previously cleared and interrupts disabled before calling this function.
1351:                     *                  - The start and abort Irqs, the channel event enable flags are not touched/cleared by this function.
1352:                     *                  User has to call event channel functions to clear/enable the event flags if needed.
1353:                     *
1354:                     * Example:         DmaChnDisable(DMA_CHANNEL2); DmaChnConfigure(DMA_CHANNEL2, DMA_CHN_PRI2, DMA_CONFIG_AUTO|DMA_CONFIG_MATCH|DMA_CONFIG_ENABLE);
1355:                     ********************************************************************/
1356:                    void            DmaChnConfigure(DmaChannel chn, DmaChannelPri chPri, DmaConfigFlags cFlags);
1357:                
1358:                
1359:                    /*********************************************************************
1360:                     * Function:        int DmaChnGetSrcPnt(DmaChannel chn)
1361:                     *
1362:                     * PreCondition:    chn - valid DMA channel
1363:                     *
1364:                     * Input:           chn     - DMA channel number
1365:                     *
1366:                     * Output:          Current channel source pointer.
1367:                     *
1368:                     * Side Effects:    None
1369:                     *
1370:                     * Overview:        The function retrieves the current source pointer for the selected DMA channel.
1371:                     *                  It is the current offset, 0 to DmaGetMaxTxferSize()-1, in the source transfer buffer.
1372:                     *
1373:                     * Note:            None
1374:                     *
1375:                     * Example:         int srcPnt=DmaChnGetSrcPnt(DMA_CHANNEL3);
1376:                     ********************************************************************/
1377:                     int            DmaChnGetSrcPnt(DmaChannel chn);
1378:                
1379:                    /*********************************************************************
1380:                     * Function:        int DmaChnGetDstPnt(DmaChannel chn)
1381:                     *
1382:                     * PreCondition:    chn - valid DMA channel
1383:                     *
1384:                     * Input:           chn     - DMA channel number
1385:                     *
1386:                     * Output:          Current channel destination pointer.
1387:                     *
1388:                     * Side Effects:    None
1389:                     *
1390:                     * Overview:        The function retrieves the current destination pointer for the selected DMA channel.
1391:                     *                  It is the current offset, 0 to DmaGetMaxTxferSize()-1, in the destination transfer buffer.
1392:                     *
1393:                     * Note:            None
1394:                     *
1395:                     * Example:         int dstPnt=DmaChnGetDstPnt(DMA_CHANNEL3);
1396:                     ********************************************************************/
1397:                     int            DmaChnGetDstPnt(DmaChannel chn);
1398:                
1399:                    /*********************************************************************
1400:                     * Function:        int DmaChnGetCellPnt(DmaChannel chn)
1401:                     *
1402:                     * PreCondition:    chn - valid DMA channel
1403:                     *
1404:                     * Input:           chn     - DMA channel number
1405:                     *
1406:                     * Output:          Current channel transfer pointer.
1407:                     *
1408:                     * Side Effects:    None
1409:                     *
1410:                     * Overview:        The function retrieves the current transfer progress pointer for the selected DMA channel.
1411:                     *                  It ranges 0 to DmaGetMaxTxferSize()-1.
1412:                     *
1413:                     * Note:            None
1414:                     *
1415:                     * Example:         int cellPnt=DmaChnGetCellPnt(DMA_CHANNEL3);
1416:                     ********************************************************************/
1417:                     int            DmaChnGetCellPnt(DmaChannel chn);
1418:                
1419:                
1420:                
1421:                    /*********************************************************************
1422:                     * Function:        void DmaChnSetEventControlFlags(DmaChannel chn, DmaEvCtrlFlags dmaEvCtrl)
1423:                     *
1424:                     * PreCondition:    chn - valid DMA channel
1425:                     *
1426:                     * Input:           chn         - DMA channel number
1427:                     *                  dmaEvCtrl   -   either a DmaEvCtrl structure field, carrying the following info:
1428:                     *                                      - AIRQEN: enable/disable the abort IRQ action
1429:                     *                                      - SIRQEN: enable/disable the start IRQ action
1430:                     *                                      - PATEN: enable/disable the pattern match and abort
1431:                     *                                  or any of the DmaEvCtrlFlags:
1432:                     *                                      DMA_EV_ABORT_IRQ_EN|DMA_EV_START_IRQ_EN|DMA_EV_MATCH_EN
1433:                     *
1434:                     *
1435:                     * Output:          None
1436:                     *
1437:                     * Side Effects:    None
1438:                     *
1439:                     * Overview:        The function sets the events that start and abort the transfer
1440:                     *                  for the selected DMA channel.
1441:                     *                  Multiple flags can be orr-ed together. Any flag that is set in the eFlags will be
1442:                     *                  enabled for the selected channel, the other channel event flags won't be touched.
1443:                     *
1444:                     * Note:            None.
1445:                     *
1446:                     * Example:         either:
1447:                     *                      DmaChnSetEventControlFlags(DMA_CHANNEL3, DMA_EV_MATCH_EN|DMA_EV_START_IRQ_EN;
1448:                     *                  or:
1449:                     *                      DmaEvCtrl evCtrl; evCtrl.w=0; evCtrl.PATEN=1; evCtrl.SIRQEN=1;
1450:                     *                      DmaChnSetEventControlFlags(DMA_CHANNEL3, evCtrl.w);
1451:                     *
1452:                     ********************************************************************/
1453:                     void           DmaChnSetEventControlFlags(DmaChannel chn, DmaEvCtrlFlags dmaEvCtrl);
1454:                
1455:                
1456:                    /*********************************************************************
1457:                     * Function:        void DmaChnClrEventControlFlags(DmaChannel chn, DmaEvCtrlFlags dmaEvCtrl)
1458:                     *
1459:                     * PreCondition:    chn - valid DMA channel
1460:                     *
1461:                     * Input:           chn         - DMA channel number
1462:                     *                  dmaEvCtrl   -   either a DmaEvCtrl structure field, carrying the following info:
1463:                     *                                      - AIRQEN: enable/disable the abort IRQ action
1464:                     *                                      - SIRQEN: enable/disable the start IRQ action
1465:                     *                                      - PATEN: enable/disable the pattern match and abort
1466:                     *                                  or any of the DmaEvCtrlFlags:
1467:                     *                                      DMA_EV_ABORT_IRQ_EN|DMA_EV_START_IRQ_EN|DMA_EV_MATCH_EN
1468:                     *
1469:                     *
1470:                     * Output:          None
1471:                     *
1472:                     * Side Effects:    None
1473:                     *
1474:                     * Overview:        The function clears the events that start and abort the transfer
1475:                     *                  for the selected DMA channel.
1476:                     *                  Multiple flags can be orr-ed together. Any flag that is set in the eFlags will be
1477:                     *                  disabled for the selected channel, the other channel event flags won't be touched.
1478:                     *
1479:                     * Note:            None.
1480:                     *
1481:                     * Example:         either:
1482:                     *                      DmaChnClrEventControlFlags(DMA_CHANNEL3, DMA_EV_MATCH_EN|DMA_EV_START_IRQ_EN);
1483:                     *                  or:
1484:                     *                      DmaEvCtrl evCtrl; evCtrl.w=0; evCtrl.PATEN=1; evCtrl.AIRQEN=1;
1485:                     *                      DmaChnClrEventControlFlags(DMA_CHANNEL3, evCtrl.w);
1486:                     *
1487:                     ********************************************************************/
1488:                     void           DmaChnClrEventControlFlags(DmaChannel chn, DmaEvCtrlFlags dmaEvCtrl);
1489:                
1490:                
1491:                
1492:                    /*********************************************************************
1493:                     * Function:        void DmaChnWriteEventControlFlags(DmaChannel chn, DmaEvCtrlFlags dmaEvCtrl)
1494:                     *
1495:                     * PreCondition:    chn - valid DMA channel
1496:                     *
1497:                     * Input:           chn         - DMA channel number
1498:                     *                  dmaEvCtrl   -   either a DmaEvCtrl structure field, carrying the following info:
1499:                     *                                      - AIRQEN: enable/disable the abort IRQ action
1500:                     *                                      - SIRQEN: enable/disable the start IRQ action
1501:                     *                                      - PATEN: enable/disable the pattern match and abort
1502:                     *                                      - CHSIRQ: IRQ number to start the DMA channel transfer
1503:                     *                                      - CHAIRQ: IRQ number to abort the DMA channel transfer
1504:                     *                                  or any of the DmaEvCtrlFlags:
1505:                     *                                      DMA_EV_ABORT_IRQ_EN|DMA_EV_START_IRQ_EN|DMA_EV_MATCH_EN|DMA_EV_START_IRQ(irq)|DMA_EV_ABORT_IRQ(irq)
1506:                     *
1507:                     *
1508:                     * Output:          None
1509:                     *
1510:                     * Side Effects:    None
1511:                     *
1512:                     * Overview:        The function writes the events that start and abort the transfer
1513:                     *                  for the selected DMA channel.
1514:                     *
1515:                     * Note:            None.
1516:                     *
1517:                     * Example:         either:
1518:                     *                      DmaChnWriteEventControlFlags(DMA_CHANNEL3, DMA_EV_MATCH_EN|DMA_EV_START_IRQ(_UART2_RX_IRQ));
1519:                     *                  or:
1520:                     *                      DmaEvCtrl evCtrl; evCtrl.w=0; evCtrl.AIRQEN=1; evCtrl.PATEN=1; evCtrl.CHSIRQ=_UART2_RX_IRQ;
1521:                     *                      DmaChnWriteEventControlFlags(DMA_CHANNEL3, evCtrl.w);
1522:                     *
1523:                     ********************************************************************/
1524:                     void           DmaChnWriteEventControlFlags(DmaChannel chn, DmaEvCtrlFlags dmaEvCtrl);
1525:                
1526:                
1527:                
1528:                    /*********************************************************************
1529:                     * Function:        void DmaChnSetEventControl(DmaChannel chn, DmaEvCtrlFlags dmaEvCtrl)
1530:                     *
1531:                     * PreCondition:    chn - valid DMA channel
1532:                     *
1533:                     * Input:           chn         - DMA channel number
1534:                     *                  dmaEvCtrl   -   either a DmaEvCtrl structure field, carrying the following info:
1535:                     *                                      - AIRQEN: enable/disable the abort IRQ action
1536:                     *                                      - SIRQEN: enable/disable the start IRQ action
1537:                     *                                      - PATEN: enable/disable the pattern match and abort
1538:                     *                                      - CHSIRQ: IRQ number to start the DMA channel transfer
1539:                     *                                      - CHAIRQ: IRQ number to abort the DMA channel transfer
1540:                     *                                  or any of the DmaEvCtrlFlags:
1541:                     *                                      DMA_EV_ABORT_IRQ_EN|DMA_EV_START_IRQ_EN|DMA_EV_MATCH_EN|DMA_EV_START_IRQ(irq)|DMA_EV_ABORT_IRQ(irq)
1542:                     *
1543:                     *
1544:                     * Output:          None
1545:                     *
1546:                     * Side Effects:    None
1547:                     *
1548:                     * Overview:        The function sets the events that start and abort the transfer
1549:                     *                  for the selected DMA channel.
1550:                     *                  Multiple flags can be orr-ed together. Any flag that is set in the eFlags will be
1551:                     *                  enabled for the selected channel, the other channel event flags won't be touched.
1552:                     *
1553:                     * Note:           A shorter name for DmaChnWriteEventControlFlags();
1554:                     *
1555:                     * Example:         either:
1556:                     *                      DmaChnSetEventControl(DMA_CHANNEL3, DMA_EV_MATCH_EN|DMA_EV_START_IRQ(_UART2_RX_IRQ));
1557:                     *                  or:
1558:                     *                      DmaEvCtrl evCtrl; evCtrl.w=0; evCtrl.AIRQEN=1; evCtrl.PATEN=1; evCtrl.CHSIRQ=_UART2_RX_IRQ;
1559:                     *                      DmaChnSetEventControl(DMA_CHANNEL3, evCtrl.w);
1560:                     *
1561:                     ********************************************************************/
1562:                    #define         DmaChnSetEventControl(chn, dmaEvCtrl)   DmaChnWriteEventControlFlags(chn, dmaEvCtrl)
1563:                
1564:                
1565:                    /*********************************************************************
1566:                     * Function:        DmaEvCtrlFlags DmaChnGetEventControl(DmaChannel chn)
1567:                     *
1568:                     * PreCondition:    chn - valid DMA channel
1569:                     *
1570:                     * Input:           chn     - DMA channel number
1571:                     *
1572:                     * Output:          -   either a DmaEvCtrl structure field, carrying the following info:
1573:                     *                          - AIRQEN: enable/disable the abort IRQ action
1574:                     *                          - SIRQEN: enable/disable the start IRQ action
1575:                     *                          - PATEN: enable/disable the pattern match and abort
1576:                     *                          - CHSIRQ: IRQ number to start the DMA channel transfer
1577:                     *                          - CHAIRQ: IRQ number to abort the DMA channel transfer
1578:                     *                      or any of the DmaEvCtrlFlags:
1579:                     *                          DMA_EV_ABORT_IRQ_EN|DMA_EV_START_IRQ_EN|DMA_EV_MATCH_EN|DMA_EV_START_IRQ(irq)|DMA_EV_ABORT_IRQ(irq)
1580:                     *
1581:                     *
1582:                     * Side Effects:    None
1583:                     *
1584:                     * Overview:        The function retrieves the events that start and abort the transfer
1585:                     *                  for the selected DMA channel.
1586:                     *
1587:                     * Note:            None.
1588:                     *
1589:                     * Example:         either:
1590:                     *                      DmaEvCtrlFlags evCtrlW=DmaChnGetEventControl(DMA_CHANNEL3); if(evCtrlW&DMA_EV_MATCH_EN) {...}
1591:                     *                  or:
1592:                     *                      DmaEvCtrl evCtrl; evCtrl.w=DmaChnGetEventControl(DMA_CHANNEL3); if(evCtrl.PATEN){...}
1593:                     *
1594:                     ********************************************************************/
1595:                     DmaEvCtrlFlags DmaChnGetEventControl(DmaChannel chn);
1596:                
1597:                
1598:                    /*********************************************************************
1599:                     * Function:        void DmaChnSetControlFlags(DmaChannel chn, DmaChnCtrlFlags dmaChnCtrl)
1600:                     *
1601:                     * PreCondition:    chn - valid DMA channel
1602:                     *
1603:                     * Input:           chn         - DMA channel number
1604:                     *                  dmaChnCtrl  -   either a DmaChnCtrl structure field, carrying the following info:
1605:                     *                                      - autoEn: enable/disable the automatic mode
1606:                     *                                      - chainEn: enable/disable channel chaining
1607:                     *                                      - detectEn: enable/disable events detection when channel disabled
1608:                     *                                      - chEn: enable/disable channel functionality
1609:                     *                                      - chainDir: chain direction: chain to lower(1)/higher(0),pri channel
1610:                     *                                  or any of the DmaChnCtrlFlags flags:
1611:                     *                                      DMA_CTL_AUTO_EN|DMA_CTL_CHAIN_EN|DMA_CTL_DET_EN|DMA_CTL_CHN_EN|DMA_CTL_CHAIN_DIR
1612:                     *
1613:                     * Output:          None
1614:                     *
1615:                     * Side Effects:    None
1616:                     *
1617:                     * Overview:        The function sets the selected DMA channel control flags:
1618:                     *                  the chaining or auto mode, and events detection.
1619:                     *                  Multiple flags can be orr-ed together. Any flag that is set in the dmaChnCtrl will be
1620:                     *                  set for the selected channel, the other channel control flags won't be touched.
1621:                     *
1622:                     * Note:            None.
1623:                     *
1624:                     * Example:         either:
1625:                     *                      DmaChnSetControlFlags(DMA_CHANNEL3, DMA_CTL_AUTO_EN|DMA_CTL_CHAIN_EN);
1626:                     *                  or:
1627:                     *                      DmaChnCtrl chCtrl; chCtrl.w=0; chCtrl.autoEn=1; chCtrl.chainEn=1;
1628:                     *                      DmaChnSetControlFlags(DMA_CHANNEL3, chCtrl.w);
1629:                     *
1630:                     ********************************************************************/
1631:                     void           DmaChnSetControlFlags(DmaChannel chn, DmaChnCtrlFlags dmaChnCtrl);
1632:                
1633:                    /*********************************************************************
1634:                     * Function:        void DmaChnClrControlFlags(DmaChannel chn, DmaChnCtrlFlags dmaChnCtrl)
1635:                     *
1636:                     * PreCondition:    chn - valid DMA channel
1637:                     *
1638:                     * Input:           chn         - DMA channel number
1639:                     *                  dmaChnCtrl  -   either a DmaChnCtrl structure field, carrying the following info:
1640:                     *                                      - autoEn: enable/disable the automatic mode
1641:                     *                                      - chainEn: enable/disable channel chaining
1642:                     *                                      - detectEn: enable/disable events detection when channel disabled
1643:                     *                                      - chEn: enable/disable channel functionality
1644:                     *                                      - chainDir: chain direction: chain to lower(1)/higher(0),pri channel
1645:                     *                                  or any of the DmaChnCtrlFlags flags:
1646:                     *                                      DMA_CTL_AUTO_EN|DMA_CTL_CHAIN_EN|DMA_CTL_DET_EN|DMA_CTL_CHN_EN|DMA_CTL_CHAIN_DIR
1647:                     *
1648:                     * Output:          None
1649:                     *
1650:                     * Side Effects:    None
1651:                     *
1652:                     * Overview:        The function clears the selected DMA channel control flags:
1653:                     *                  the chaining or auto mode and events detection.
1654:                     *                  Multiple flags can be orr-ed together. Any flag that is set in the dmaChnCtrl will be
1655:                     *                  cleared for the selected channel, the other channel control flags won't be touched.
1656:                     *
1657:                     * Note:            None.
1658:                     *
1659:                     * Example:         either:
1660:                     *                      DmaChnClrControlFlags(DMA_CHANNEL3, DMA_CTL_AUTO_EN|DMA_CTL_CHAIN_EN);
1661:                     *                  or:
1662:                     *                      DmaChnCtrl chCtrl; chCtrl.w=0; chCtrl.autoEn=1; chCtrl.chainEn=1;
1663:                     *                      DmaChnClrControlFlags(DMA_CHANNEL3, chCtrl.w);
1664:                     *
1665:                     ********************************************************************/
1666:                     void           DmaChnClrControlFlags(DmaChannel chn, DmaChnCtrlFlags dmaChnCtrl);
1667:                
1668:                    /*********************************************************************
1669:                     * Function:        void DmaChnWriteControlFlags(DmaChannel chn, DmaChnCtrlFlags dmaChnCtrl)
1670:                     *
1671:                     * PreCondition:    chn - valid DMA channel
1672:                     *
1673:                     * Input:           chn         - DMA channel number
1674:                     *                  dmaChnCtrl  -   either a DmaChnCtrl structure field, carrying the following info:
1675:                     *                                      - chPri: channel priority 0-3
1676:                     *                                      - autoEn: enable/disable the automatic mode
1677:                     *                                      - chainEn: enable/disable channel chaining
1678:                     *                                      - detectEn: enable/disable events detection when channel disabled
1679:                     *                                      - chEn: enable/disable channel functionality
1680:                     *                                      - chainDir: chain direction: chain to lower(1)/higher(0),pri channel
1681:                     *                                  or any of the DmaChnCtrlFlags flags:
1682:                     *                                      DMA_CTL_PRI(pri)|DMA_CTL_AUTO_EN|DMA_CTL_CHAIN_EN|DMA_CTL_DET_EN|DMA_CTL_CHN_EN|DMA_CTL_CHAIN_DIR
1683:                     *
1684:                     * Output:          None
1685:                     *
1686:                     * Side Effects:    None
1687:                     *
1688:                     * Overview:        The function enables/disables the selected DMA channel and also sets
1689:                     *                  the channel priority, chaining mode or auto and events detection.
1690:                     *
1691:                     * Note:            None.
1692:                     *
1693:                     * Example:         either:
1694:                     *                      DmaChnWriteControlFlags(DMA_CHANNEL3, DMA_CTL_PRI(DMA_CHN_PRI2)|DMA_CTL_AUTO_EN|DMA_CTL_CHAIN_EN);
1695:                     *                  or:
1696:                     *                      DmaChnCtrl chCtrl; chCtrl.w=0; chCtrl.chPri=DMA_CHN_PRI2; chCtrl.autoEn=1; chCtrl.chainEn=1;
1697:                     *                      DmaChnWriteControlFlags(DMA_CHANNEL3, chCtrl.w);
1698:                     *
1699:                     ********************************************************************/
1700:                     void           DmaChnWriteControlFlags(DmaChannel chn, DmaChnCtrlFlags dmaChnCtrl);
1701:                
1702:                    /*********************************************************************
1703:                     * Function:        void DmaChnSetControl(DmaChannel chn, DmaChnCtrlFlags dmaChnCtrl)
1704:                     *
1705:                     * PreCondition:    chn - valid DMA channel
1706:                     *
1707:                     * Input:       chn     - DMA channel number
1708:                     *                  dmaChnCtrl  -   either a DmaChnCtrl structure field, carrying the following info:
1709:                     *                      - chPri: channel priority 0-3
1710:                     *                      - autoEn: enable/disable the automatic mode
1711:                     *                      - chainEn: enable/disable channel chaining
1712:                     *                      - detectEn: enable/disable events detection when channel disabled
1713:                     *                      - chEn: enable/disable channel functionality
1714:                     *                      - chainDir: chain direction: chain to lower(1)/higher(0),pri channel
1715:                     *                  or any of the DmaChnCtrlFlags flags:
1716:                     *                      DMA_CTL_PRI(pri)|DMA_CTL_AUTO_EN|DMA_CTL_CHAIN_EN|DMA_CTL_DET_EN|DMA_CTL_CHN_EN|DMA_CTL_CHAIN_DIR
1717:                     *
1718:                     * Output:          None
1719:                     *
1720:                     * Side Effects:    None
1721:                     *
1722:                     * Overview:        The function enables/disables the selected DMA channel and also sets
1723:                     *                  the channel priority, chaining mode or auto and events detection.
1724:                     *
1725:                     * Note:            Another name ( backward compatible) for DmaChnWriteControlFlags().
1726:                     *
1727:                     * Example:         either:
1728:                     *                      DmaChnSetControl(DMA_CHANNEL3, DMA_CTL_PRI(DMA_CHN_PRI2)|DMA_CTL_AUTO_EN|DMA_CTL_CHAIN_EN);
1729:                     *                  or:
1730:                     *                      DmaChnCtrl chCtrl; chCtrl.w=0; chCtrl.chPri=DMA_CHN_PRI2; chCtrl.autoEn=1; chCtrl.chainEn=1;
1731:                     *          DmaChnSetControl(DMA_CHANNEL3, chCtrl.w);
1732:                     *
1733:                     ********************************************************************/
1734:                    #define     DmaChnSetControl(chn, dmaChnCtrl)   DmaChnWriteControlFlags(chn, dmaChnCtrl)
1735:                
1736:                    /*********************************************************************
1737:                     * Function:        DmaChnCtrlFlags DmaChnGetControlFlags(DmaChannel chn)
1738:                     *
1739:                     * PreCondition:    chn - valid DMA channel
1740:                     *
1741:                     * Input:           chn         - DMA channel number
1742:                     *
1743:                     * Output:          - either a DmaChnCtrl structure field, carrying the following info:
1744:                     *                          - chPri: channel priority 0-3
1745:                     *                          - autoEn: enable/disable the automatic mode
1746:                     *                          - chainEn: enable/disable channel chaining
1747:                     *                          - detectEn: enable/disable events detection when channel disabled
1748:                     *                          - chEn: enable/disable channel functionality
1749:                     *                          - chainDir: chain direction: chain to lower(1)/higher(0),pri channel
1750:                     *                      or any of the DmaChnCtrlFlags flags:
1751:                     *                          DMA_CTL_PRI(pri)|DMA_CTL_AUTO_EN|DMA_CTL_CHAIN_EN|DMA_CTL_DET_EN|DMA_CTL_CHN_EN|DMA_CTL_CHAIN_DIR
1752:                     *
1753:                     * Side Effects:    None
1754:                     *
1755:                     * Overview:        The function retrieves the current control settings for the selected DMA channel,
1756:                     *                  including the channel enable/disable status, the channel priority,
1757:                     *                  chaining mode, auto mode and events detection.
1758:                     *
1759:                     * Note:            None.
1760:                     *
1761:                     * Example:         either:
1762:                     *                      DmaChnCtrlFlags ctrl=DmaChnGetControlFlags(DMA_CHANNEL3); if(ctrl&DMA_CTL_AUTO_EN) {...}
1763:                     *                  or:
1764:                     *                      DmaChnCtrl chnCtrl; chnCtrl.w=DmaChnGetControlFlags(DMA_CHANNEL3); if(chnCtrl.autoEn) {...}
1765:                     *
1766:                     ********************************************************************/
1767:                     DmaChnCtrlFlags    DmaChnGetControlFlags(DmaChannel chn);
1768:                
1769:                
1770:                    /*********************************************************************
1771:                     * Function:        int DmaChnGetEvDetect(DmaChannel chn)
1772:                     *
1773:                     * PreCondition:    chn - valid DMA channel
1774:                     *
1775:                     * Input:           chn     - DMA channel number
1776:                     *
1777:                     * Output:          TRUE if an DMA event was detected, FALSE otherwise.
1778:                     *
1779:                     * Side Effects:    None
1780:                     *
1781:                     * Overview:        The function returns the current event detection for the selected DMA channel.
1782:                     *
1783:                     * Note:            None.
1784:                     *
1785:                     * Example:         int evDetect=DmaChnGetEvDetect(DMA_CHANNEL3);
1786:                     *
1787:                     ********************************************************************/
1788:                     int            DmaChnGetEvDetect(DmaChannel chn);
1789:                
1790:                    /*********************************************************************
1791:                     * Function:        void DmaChnGetTxfer(DmaChannel chn, DmaTxferCtrl* pTxCtrl, int mapToK0)
1792:                     *
1793:                     * PreCondition:    chn     - valid DMA channel
1794:                     *                  pTxCtrl - valid pointer
1795:                     *
1796:                     * Input:           chn         - DMA channel number
1797:                     *                  pTxCtrl     - pointer to a DmaTxferCtrl that will carry the following info:
1798:                     *                              - vSrcAdd: source of the DMA transfer
1799:                     *                              - vDstAdd: destination of the DMA transfer
1800:                     *                              - srcSize: source buffer size, 1 to DmaGetMaxTxferSize() bytes, wrapped arround
1801:                     *                              - dstSize: destination buffer size, 1 to DmaGetMaxTxferSize() bytes, wrapped around
1802:                     *                              - cellSize: cell transfer size, 1 to DmaGetMaxTxferSize() bytes.
1803:                     *                  mapToK0     - if TRUE, a Kernel address is mapped to KSeg0, else KSeg1.
1804:                     *
1805:                     * Output:          None
1806:                     *
1807:                     * Side Effects:    None
1808:                     *
1809:                     * Overview:        The function retrieves the transfer characteristics for a DMA channel transfer:
1810:                     *                  the source and the destination addresses.
1811:                     *                  It also retrieves the source and destination lengths
1812:                     *                  and the number of bytes transferred per event.
1813:                     *
1814:                     * Note:            None
1815:                     *
1816:                     * Example:         DmaTxferCtrl txCtl; DmaChnGetTxfer(DMA_CHANNEL3, &txCtl, FALSE);
1817:                     ********************************************************************/
1818:                     void           DmaChnGetTxfer(DmaChannel chn, DmaTxferCtrl* pTxCtrl, int mapToK0);
1819:                
1820:                    // Low level checksum functions
1821:                
1822:                    /*********************************************************************
1823:                     * Function:        void DmaSfmEnable(int enable)
1824:                     *
1825:                     * PreCondition:    None
1826:                     *
1827:                     * Input:           enable _ boolean to enable/disable the SFM functionality
1828:                     *
1829:                     * Output:          None
1830:                     *
1831:                     * Side Effects:    None
1832:                     *
1833:                     * Overview:        The function enables/diables the checksum module functionality.
1834:                     *                  When enabled the attached DMA channel transfers are routed to the SFM module.
1835:                     *
1836:                     * Note:            The SFM module should be properly configured before enabled.
1837:                     *
1838:                     * Example:         DmaSfmEnable(1);
1839:                     ********************************************************************/
1840:                    extern __inline__ void __attribute__((always_inline)) DmaSfmEnable(int enable)
1841:                    {
1842:                        if(enable)
1843:                        {
1844:                            DCRCCONSET=_DCRCCON_CRCEN_MASK;
1845:                        }
1846:                        else
1847:                        {
1848:                            DCRCCONCLR=_DCRCCON_CRCEN_MASK;
1849:                        }
1850:                    }
1851:                    #define DmaCrcEnable    DmaSfmEnable        // PIC32_3xx backward compatibility
1852:                
1853:                
1854:                    /*********************************************************************
1855:                     * Function:        int DmaSfmGetEnable(void)
1856:                     *
1857:                     * PreCondition:    None
1858:                     *
1859:                     * Input:           None
1860:                     *
1861:                     * Output:          TRUE, if the SFM module is enabled
1862:                     *          FALSE otherwise
1863:                     *
1864:                     * Side Effects:    None
1865:                     *
1866:                     * Overview:        The function returns the SFM module enabling status.
1867:                     *
1868:                     * Note:            None
1869:                     *
1870:                     * Example:     int isSfmEnabled=DmaSfmGetEnable();
1871:                     ********************************************************************/
1872:                    extern __inline__ int __attribute__((always_inline)) DmaSfmGetEnable(void)
1873:                    {
1874:                        return DCRCCONbits.CRCEN!=0;
1875:                    }
1876:                    #define     DmaCrcGetEnable     DmaSfmGetEnable     // PIC32_3xx backward compatibility
1877:                
1878:                
1879:                    /*********************************************************************
1880:                     * Function:        void DmaSfmAppendEnable(int enable)
1881:                     *
1882:                     * PreCondition:    None
1883:                     *
1884:                     * Input:           enable _ boolean to enable/disable the SFM append mode
1885:                     *
1886:                     * Output:          None
1887:                     *
1888:                     * Side Effects:    None
1889:                     *
1890:                     * Overview:        The function enables the SFM append mode. In this mode, the attached DMA channel reads
1891:                     *                  the source data but does not write it to the destination address. The data it's just passed
1892:                     *                  to the checksum generator for CRC/IP checksum calculation.
1893:                     *                  When the block transfer is completed, the checksum result is written to the
1894:                     *                  DMA channel destination address.
1895:                     *
1896:                     * Note:            The SFM module should be properly configured before enabled.
1897:                     *
1898:                     * Example:         DmaSfmAppendModeEnable(TRUE);
1899:                     ********************************************************************/
1900:                    extern __inline__ void __attribute__((always_inline)) DmaSfmAppendEnable(int enable)
1901:                    {
1902:                        if(enable)
1903:                        {
1904:                            DCRCCONSET=_DCRCCON_CRCAPP_MASK;
1905:                        }
1906:                        else
1907:                        {
1908:                            DCRCCONCLR=_DCRCCON_CRCAPP_MASK;
1909:                        }
1910:                    }
1911:                    #define     DmaCrcAppendModeEnable  DmaSfmAppendEnable  // PIC32_3xx backward compatibility
1912:                
1913:                
1914:                    /*********************************************************************
1915:                     * Function:        int DmaSfmGetAppendMode(void)
1916:                     *
1917:                     * PreCondition:    None
1918:                     *
1919:                     * Input:           None
1920:                     *
1921:                     * Output:          TRUE, if the SFM append mode is enabled
1922:                     *                  FALSE otherwise
1923:                     *
1924:                     * Side Effects:    None
1925:                     *
1926:                     * Overview:        The function returns the SFM module enabling status.
1927:                     *
1928:                     * Note:            None
1929:                     *
1930:                     * Example:         int isAppendEnabled=DmaSfmGetAppendMode();
1931:                     ********************************************************************/
1932:                    extern __inline__ int __attribute__((always_inline)) DmaSfmGetAppendMode(void)
1933:                    {
1934:                        return DCRCCONbits.CRCAPP!=0;
1935:                    }
1936:                    #define DmaCrcGetAppendMode DmaSfmGetAppendMode     // PIC32_3xx backward compatibility
1937:                
1938:                
1939:                    /*********************************************************************
1940:                     * Function:        void DmaSfmSetAttach(DmaChannel chn)
1941:                     *
1942:                     * PreCondition:    chn     - valid DMA channel
1943:                     *
1944:                     * Input:           chn - the DMA channel to be attached to the SFM module (the DMA channel transfers will be routed to the SFM module)
1945:                     *
1946:                     * Output:          None
1947:                     *
1948:                     * Side Effects:    None
1949:                     *
1950:                     * Overview:        The function directly attaches a DMA channel to the SFM module.
1951:                     *
1952:                     * Note:            None
1953:                     *
1954:                     * Example:         DmaSfmSetAttach(DMA_CHANNEL3);
1955:                     ********************************************************************/
1956:                    extern __inline__ void __attribute__((always_inline)) DmaSfmSetAttach(DmaChannel chn)
1957:                    {
1958:                        DCRCCONCLR=_DCRCCON_CRCCH_MASK;
1959:                        DCRCCONSET=chn;
1960:                    }
1961:                    #define     DmaCrcSetAttach     DmaSfmSetAttach     // PIC32_3xx backward compatibility
1962:                
1963:                
1964:                    /*********************************************************************
1965:                     * Function:        DmaChannel DmaSfmGetAttach(void)
1966:                     *
1967:                     * PreCondition:    None
1968:                     *
1969:                     * Input:           None
1970:                     *
1971:                     * Output:          the DMA channel that is currently attached to the CRC module
1972:                     *
1973:                     * Side Effects:    None
1974:                     *
1975:                     * Overview:        The function returns the DMA channel number that is currently attached to the SFM module.
1976:                     *
1977:                     * Note:            None
1978:                     *
1979:                     * Example:         DmaChannel chn=DmaSfmGetAttach();
1980:                     ********************************************************************/
1981:                    extern __inline__ DmaChannel __attribute__((always_inline)) DmaSfmGetAttach(void)
1982:                    {
1983:                        return (DmaChannel)DCRCCONbits.CRCCH;
1984:                    }
1985:                    #define     DmaCrcGetAttach     DmaSfmGetAttach     // PIC32_3xx backward compatibility
1986:                
1987:                    /*********************************************************************
1988:                     * Function:        void DmaCrcSetPLen(int pLen)
1989:                     *
1990:                     * PreCondition:    pLen - valid polynomial length within 1-32
1991:                     *
1992:                     * Input:           pLen    - the length of the CRC generator polynomial
1993:                     *
1994:                     * Output:          None
1995:                     *
1996:                     * Side Effects:    None
1997:                     *
1998:                     * Overview:        The length of the CRC generator polynomial is set as being pLen;
1999:                     *
2000:                     * Note:            None
2001:                     *
2002:                     * Example:         DmaCrcSetPLen(32);
2003:                     ********************************************************************/
2004:                    extern __inline__ void __attribute__((always_inline)) DmaCrcSetPLen(int pLen)
2005:                    {
2006:                        DCRCCONCLR=_DCRCCON_PLEN_MASK;
2007:                        DCRCCONSET=(pLen)-1;
2008:                    }
2009:                
2010:                    /*********************************************************************
2011:                     * Function:        int DmaCrcGetPLen(void)
2012:                     *
2013:                     * PreCondition:    None
2014:                     *
2015:                     * Input:           None
2016:                     *
2017:                     * Output:          the length of the CRC generator polynomial
2018:                     *
2019:                     * Side Effects:    None
2020:                     *
2021:                     * Overview:        The function returns the current length of the CRC generator polynomial.
2022:                     *                  It's always a number between 1 and 32.
2023:                     *
2024:                     * Note:            None
2025:                     *
2026:                     * Example:         int polyLen=DmaCrcGetPLen();
2027:                     ********************************************************************/
2028:                    extern __inline__ int __attribute__((always_inline)) DmaCrcGetPLen(void)
2029:                    {
2030:                        return  DCRCCONbits.PLEN+1;
2031:                    }
2032:                
2033:                    /*********************************************************************
2034:                     * Function:        void DmaCrcSetShiftFeedback(unsigned int feedback)
2035:                     *
2036:                     * PreCondition:    None
2037:                     *
2038:                     * Input:           feedback - the layout of the CRC generator
2039:                     *
2040:                     * Output:          None
2041:                     *
2042:                     * Side Effects:    None
2043:                     *
2044:                     * Overview:        The function sets the layout of the shift stages that take place in the CRC generation.
2045:                     *                  Setting a bit to 1 enables the XOR input from the MSb (pLen bit) to the selected stage in the shift register.
2046:                     *                  If bit is cleared, the selected shift stage gets data directly from the previous stage in the shift register.
2047:                     *
2048:                     * Note:            Bit 0 of the generator polynomial is always XOR'ed.
2049:                     *
2050:                     * Example:         DmaCrcSetShiftFeedback(0x04c11db7);
2051:                     ********************************************************************/
2052:                    extern __inline__ void __attribute__((always_inline)) DmaCrcSetShiftFeedback(unsigned int feedback)
2053:                    {
2054:                        DCRCXOR=feedback;
2055:                    }
2056:                
2057:                
2058:                    /*********************************************************************
2059:                     * Function:        unsigned int DmaCrcGetShiftFeedback(void)
2060:                     *
2061:                     * PreCondition:    None
2062:                     *
2063:                     * Input:           None
2064:                     *
2065:                     * Output:          the current layout of the CRC generator
2066:                     *
2067:                     * Side Effects:    None
2068:                     *
2069:                     * Overview:        The function returns the layout of the shift stages that take place in the CRC generation.
2070:                     *                  A bit set to 1 enables the XOR input from the MSb (pLen bit) to the selected stage in the shift register.
2071:                     *                  If a bit is cleared, the selected shift stage gets data directly from the previous stage in the shift register.
2072:                     *
2073:                     * Note:            Bit 0 of the generator polynomial is always XOR'ed.
2074:                     *
2075:                     * Example:         int feedback=DmaCrcGetShiftFeedback();
2076:                     ********************************************************************/
2077:                    extern __inline__ unsigned int __attribute__((always_inline)) DmaCrcGetShiftFeedback(void)
2078:                    {
2079:                        return DCRCXOR;
2080:                    }
2081:                
2082:                
2083:                
2084:                    // Channel test/debug and special functions
2085:                
2086:                    /*********************************************************************
2087:                     * Function:        void DmaChnSetEvFlags(DmaChannel chn, DmaEvFlags eFlags)
2088:                     *
2089:                     * PreCondition:    chn - valid DMA channel
2090:                     *
2091:                     * Input:           chn     - DMA channel number
2092:                     *                  eFlags  - event flags with the following significance:
2093:                     *                              - DMA_EV_ERR: address error event
2094:                     *                              - DMA_EV_ABORT: transfer abort event
2095:                     *                              - DMA_EV_CELL_DONE: cell transfer complete event
2096:                     *                              - DMA_EV_BLOCK_DONE: block transfer complete event
2097:                     *                              - DMA_EV_DST_HALF: destination half event
2098:                     *                              - DMA_EV_DST_FULL: destination full event
2099:                     *                              - DMA_EV_SRC_HALF: source half event
2100:                     *                              - DMA_EV_SRC_FULL: source full event
2101:                     *                              - DMA_EV_ALL_EVNTS: all of the above flags
2102:                     *
2103:                     * Output:          None
2104:                     *
2105:                     * Side Effects:    None
2106:                     *
2107:                     * Overview:        The function sets the event flags for the selected DMA channel.
2108:                     *                  Multiple flags can be orr-ed together. Any flag that is set in the eFlags will be
2109:                     *                  set for the selected channel, the other channel event flags won't be touched.
2110:                     *
2111:                     * Note:            This is intended as a channel test function.
2112:                     *
2113:                     * Example:         DmaChnSetEvFlags(DMA_CHANNEL0, DMA_EV_ERR|DMA_EV_ABORT|DMA_EV_BLOCK_DONE|DMA_EV_SRC_FULL);
2114:                     ********************************************************************/
2115:                     void           DmaChnSetEvFlags(DmaChannel chn, DmaEvFlags eFlags);
2116:                
2117:                    /*********************************************************************
2118:                     * Function:        void DmaChnWriteEvFlags(DmaChannel chn, DmaEvFlags eFlags)
2119:                     *
2120:                     * PreCondition:    chn - valid DMA channel
2121:                     *
2122:                     * Input:           chn     - DMA channel number
2123:                     *                  eFlags  - event flags with the following significance:
2124:                     *                              - DMA_EV_ERR: address error event
2125:                     *                              - DMA_EV_ABORT: transfer abort event
2126:                     *                              - DMA_EV_CELL_DONE: cell transfer complete event
2127:                     *                              - DMA_EV_BLOCK_DONE: block transfer complete event
2128:                     *                              - DMA_EV_DST_HALF: destination half event
2129:                     *                              - DMA_EV_DST_FULL: destination full event
2130:                     *                              - DMA_EV_SRC_HALF: source half event
2131:                     *                              - DMA_EV_SRC_FULL: source full event
2132:                     *                              - DMA_EV_ALL_EVNTS: all of the above flags
2133:                     *
2134:                     * Output:          None
2135:                     *
2136:                     * Side Effects:    None
2137:                     *
2138:                     * Overview:        The function writes the event flags for the selected DMA channel.
2139:                     *                  The channel event flags are forced to the eFlags value.
2140:                     *
2141:                     * Note:            This is intended as a channel test function.
2142:                     *
2143:                     * Example:         DmaChnWriteEvFlags(DMA_CHANNEL0, DMA_EV_ERR|DMA_EV_ABORT|DMA_EV_BLOCK_DONE|DMA_EV_SRC_FULL);
2144:                     ********************************************************************/
2145:                     void           DmaChnWriteEvFlags(DmaChannel chn, DmaEvFlags eFlags);
2146:                
2147:                
2148:                    /********************************************************************
2149:                     * Include legacy DMA functions
2150:                     * New projects should not use them!
2151:                     * Note that interrupt functions are no longer provided.
2152:                     * The functions in the int.h should be used instead.
2153:                     ********************************************************************/
2154:                    #ifndef _PLIB_DISABLE_LEGACY
2155:                        #include <peripheral/legacy/dma_legacy.h>
2156:                    #endif
2157:                
2158:                
2159:                #else
2160:                    #undef _DMA_CHANNELS        // no DMA channels
2161:                #endif  // _DMAC0
2162:                
2163:                #endif /*_DMA_1XX_2XX_H_*/
2164:                
2165:                
